var nu=Object.create;var l1=Object.defineProperty;var du=Object.getOwnPropertyDescriptor;var cu=Object.getOwnPropertyNames;var ou=Object.getPrototypeOf,ru=Object.prototype.hasOwnProperty;var tZ=(x,g)=>()=>(g||x((g={exports:{}}).exports,g),g.exports),su=(x,g)=>{for(var Y in g)l1(x,Y,{get:g[Y],enumerable:!0})},bu=(x,g,Y,D)=>{if(g&&typeof g=="object"||typeof g=="function")for(let I of cu(g))!ru.call(x,I)&&I!==Y&&l1(x,I,{get:()=>g[I],enumerable:!(D=du(g,I))||D.enumerable});return x};var eZ=(x,g,Y)=>(Y=x!=null?nu(ou(x)):{},bu(g||!x||!x.__esModule?l1(Y,"default",{value:x,enumerable:!0}):Y,x));var lZ=tZ((a1,n1)=>{(function(x,g){typeof a1=="object"&&typeof n1<"u"?n1.exports=g():typeof define=="function"&&define.amd?define(g):(x=typeof globalThis<"u"?globalThis:x||self,x.maplibregl=g())})(a1,(function(){"use strict";var x={},g={};function Y(I,o,st){if(g[I]=st,I==="index"){var Ct="var sharedModule = {}; ("+g.shared+")(sharedModule); ("+g.worker+")(sharedModule);",vt={};return g.shared(vt),g.index(x,vt),typeof window<"u"&&x.setWorkerUrl(window.URL.createObjectURL(new Blob([Ct],{type:"text/javascript"}))),x}}Y("shared",["exports"],(function(I){"use strict";function o(l,t,i,n){return new(i||(i=Promise))((function(d,r){function b(R){try{V(n.next(R))}catch(N){r(N)}}function h(R){try{V(n.throw(R))}catch(N){r(N)}}function V(R){var N;R.done?d(R.value):(N=R.value,N instanceof i?N:new i((function(M){M(N)}))).then(b,h)}V((n=n.apply(l,t||[])).next())}))}function st(l,t){this.x=l,this.y=t}function Ct(l){return l&&l.__esModule&&Object.prototype.hasOwnProperty.call(l,"default")?l.default:l}var vt,de;typeof SuppressedError=="function"&&SuppressedError,st.prototype={clone(){return new st(this.x,this.y)},add(l){return this.clone()._add(l)},sub(l){return this.clone()._sub(l)},multByPoint(l){return this.clone()._multByPoint(l)},divByPoint(l){return this.clone()._divByPoint(l)},mult(l){return this.clone()._mult(l)},div(l){return this.clone()._div(l)},rotate(l){return this.clone()._rotate(l)},rotateAround(l,t){return this.clone()._rotateAround(l,t)},matMult(l){return this.clone()._matMult(l)},unit(){return this.clone()._unit()},perp(){return this.clone()._perp()},round(){return this.clone()._round()},mag(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals(l){return this.x===l.x&&this.y===l.y},dist(l){return Math.sqrt(this.distSqr(l))},distSqr(l){let t=l.x-this.x,i=l.y-this.y;return t*t+i*i},angle(){return Math.atan2(this.y,this.x)},angleTo(l){return Math.atan2(this.y-l.y,this.x-l.x)},angleWith(l){return this.angleWithSep(l.x,l.y)},angleWithSep(l,t){return Math.atan2(this.x*t-this.y*l,this.x*l+this.y*t)},_matMult(l){let t=l[2]*this.x+l[3]*this.y;return this.x=l[0]*this.x+l[1]*this.y,this.y=t,this},_add(l){return this.x+=l.x,this.y+=l.y,this},_sub(l){return this.x-=l.x,this.y-=l.y,this},_mult(l){return this.x*=l,this.y*=l,this},_div(l){return this.x/=l,this.y/=l,this},_multByPoint(l){return this.x*=l.x,this.y*=l.y,this},_divByPoint(l){return this.x/=l.x,this.y/=l.y,this},_unit(){return this._div(this.mag()),this},_perp(){let l=this.y;return this.y=this.x,this.x=-l,this},_rotate(l){let t=Math.cos(l),i=Math.sin(l),n=i*this.x+t*this.y;return this.x=t*this.x-i*this.y,this.y=n,this},_rotateAround(l,t){let i=Math.cos(l),n=Math.sin(l),d=t.y+n*(this.x-t.x)+i*(this.y-t.y);return this.x=t.x+i*(this.x-t.x)-n*(this.y-t.y),this.y=d,this},_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},constructor:st},st.convert=function(l){if(l instanceof st)return l;if(Array.isArray(l))return new st(+l[0],+l[1]);if(l.x!==void 0&&l.y!==void 0)return new st(+l.x,+l.y);throw new Error("Expected [x, y] or {x, y} point format")};var ee=(function(){if(de)return vt;function l(t,i,n,d){this.cx=3*t,this.bx=3*(n-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*i,this.by=3*(d-i)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=i,this.p2x=n,this.p2y=d}return de=1,vt=l,l.prototype={sampleCurveX:function(t){return((this.ax*t+this.bx)*t+this.cx)*t},sampleCurveY:function(t){return((this.ay*t+this.by)*t+this.cy)*t},sampleCurveDerivativeX:function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},solveCurveX:function(t,i){if(i===void 0&&(i=1e-6),t<0)return 0;if(t>1)return 1;for(var n=t,d=0;d<8;d++){var r=this.sampleCurveX(n)-t;if(Math.abs(r)<i)return n;var b=this.sampleCurveDerivativeX(n);if(Math.abs(b)<1e-6)break;n-=r/b}var h=0,V=1;for(n=t,d=0;d<20&&(r=this.sampleCurveX(n),!(Math.abs(r-t)<i));d++)t>r?h=n:V=n,n=.5*(V-h)+h;return n},solve:function(t,i){return this.sampleCurveY(this.solveCurveX(t,i))}},vt})(),ge=Ct(ee);let ye,jt;function gt(){return ye==null&&(ye=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),ye}function Ie(){if(jt==null&&(jt=!1,gt())){let t=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(t){for(let n=0;n<25;n++){let d=4*n;t.fillStyle=`rgb(${d},${d+1},${d+2})`,t.fillRect(n%5,Math.floor(n/5),1,1)}let i=t.getImageData(0,0,5,5).data;for(let n=0;n<100;n++)if(n%4!=3&&i[n]!==n){jt=!0;break}}}return jt||!1}var te=1e-6,Ue=typeof Float32Array<"u"?Float32Array:Array;function di(){var l=new Ue(9);return Ue!=Float32Array&&(l[1]=0,l[2]=0,l[3]=0,l[5]=0,l[6]=0,l[7]=0),l[0]=1,l[4]=1,l[8]=1,l}function li(l){return l[0]=1,l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[5]=1,l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[10]=1,l[11]=0,l[12]=0,l[13]=0,l[14]=0,l[15]=1,l}function ze(){var l=new Ue(3);return Ue!=Float32Array&&(l[0]=0,l[1]=0,l[2]=0),l}function je(l){var t=l[0],i=l[1],n=l[2];return Math.sqrt(t*t+i*i+n*n)}function B(l,t,i){var n=new Ue(3);return n[0]=l,n[1]=t,n[2]=i,n}function ii(l,t,i){return l[0]=t[0]+i[0],l[1]=t[1]+i[1],l[2]=t[2]+i[2],l}function Me(l,t,i){return l[0]=t[0]*i,l[1]=t[1]*i,l[2]=t[2]*i,l}function ui(l,t,i){var n=t[0],d=t[1],r=t[2],b=i[0],h=i[1],V=i[2];return l[0]=d*V-r*h,l[1]=r*b-n*V,l[2]=n*h-d*b,l}var ri,xi=je;function Qe(l,t,i){var n=t[0],d=t[1],r=t[2],b=t[3];return l[0]=i[0]*n+i[4]*d+i[8]*r+i[12]*b,l[1]=i[1]*n+i[5]*d+i[9]*r+i[13]*b,l[2]=i[2]*n+i[6]*d+i[10]*r+i[14]*b,l[3]=i[3]*n+i[7]*d+i[11]*r+i[15]*b,l}function Ui(){var l=new Ue(4);return Ue!=Float32Array&&(l[0]=0,l[1]=0,l[2]=0),l[3]=1,l}function sa(l,t,i,n){var d=arguments.length>4&&arguments[4]!==void 0?arguments[4]:"zyx",r=Math.PI/360;t*=r,n*=r,i*=r;var b=Math.sin(t),h=Math.cos(t),V=Math.sin(i),R=Math.cos(i),N=Math.sin(n),M=Math.cos(n);switch(d){case"xyz":l[0]=b*R*M+h*V*N,l[1]=h*V*M-b*R*N,l[2]=h*R*N+b*V*M,l[3]=h*R*M-b*V*N;break;case"xzy":l[0]=b*R*M-h*V*N,l[1]=h*V*M-b*R*N,l[2]=h*R*N+b*V*M,l[3]=h*R*M+b*V*N;break;case"yxz":l[0]=b*R*M+h*V*N,l[1]=h*V*M-b*R*N,l[2]=h*R*N-b*V*M,l[3]=h*R*M+b*V*N;break;case"yzx":l[0]=b*R*M+h*V*N,l[1]=h*V*M+b*R*N,l[2]=h*R*N-b*V*M,l[3]=h*R*M-b*V*N;break;case"zxy":l[0]=b*R*M-h*V*N,l[1]=h*V*M+b*R*N,l[2]=h*R*N+b*V*M,l[3]=h*R*M-b*V*N;break;case"zyx":l[0]=b*R*M-h*V*N,l[1]=h*V*M+b*R*N,l[2]=h*R*N-b*V*M,l[3]=h*R*M+b*V*N;break;default:throw new Error("Unknown angle order "+d)}return l}function cl(){var l=new Ue(2);return Ue!=Float32Array&&(l[0]=0,l[1]=0),l}function Ri(l,t){var i=new Ue(2);return i[0]=l,i[1]=t,i}ze(),ri=new Ue(4),Ue!=Float32Array&&(ri[0]=0,ri[1]=0,ri[2]=0,ri[3]=0),ze(),B(1,0,0),B(0,1,0),Ui(),Ui(),di(),cl();let Le=8192;function Yl(l,t,i){return t*(Le/(l.tileSize*Math.pow(2,i-l.tileID.overscaledZ)))}function ol(l,t){return(l%t+t)%t}function ba(l,t,i){return l*(1-i)+t*i}function dn(l){if(l<=0)return 0;if(l>=1)return 1;let t=l*l,i=t*l;return 4*(l<.5?i:3*(l-t)+i-.75)}function xl(l,t,i,n){let d=new ge(l,t,i,n);return r=>d.solve(r)}let _l=xl(.25,.1,.25,1);function Ci(l,t,i){return Math.min(i,Math.max(t,l))}function qi(l,t,i){let n=i-t,d=((l-t)%n+n)%n+t;return d===t?i:d}function ki(l,...t){for(let i of t)for(let n in i)l[n]=i[n];return l}let Sa=1;function Fl(l,t,i){let n={};for(let d in l)n[d]=t.call(this,l[d],d,l);return n}function $i(l,t,i){let n={};for(let d in l)t.call(this,l[d],d,l)&&(n[d]=l[d]);return n}function Pl(l){return Array.isArray(l)?l.map(Pl):typeof l=="object"&&l?Fl(l,Pl):l}let Kl={};function ci(l){Kl[l]||(typeof console<"u"&&console.warn(l),Kl[l]=!0)}function El(l,t,i){return(i.y-l.y)*(t.x-l.x)>(t.y-l.y)*(i.x-l.x)}function Na(l){return typeof WorkerGlobalScope<"u"&&l!==void 0&&l instanceof WorkerGlobalScope}let si=null;function Tl(l){return typeof ImageBitmap<"u"&&l instanceof ImageBitmap}let wi="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function Rn(l,t,i,n,d){return o(this,void 0,void 0,(function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");let r=new VideoFrame(l,{timestamp:0});try{let b=r?.format;if(!b||!b.startsWith("BGR")&&!b.startsWith("RGB"))throw new Error(`Unrecognized format ${b}`);let h=b.startsWith("BGR"),V=new Uint8ClampedArray(n*d*4);if(yield r.copyTo(V,(function(R,N,M,J,S){let C=4*Math.max(-N,0),L=(Math.max(0,M)-M)*J*4+C,w=4*J,_=Math.max(0,N),lt=Math.max(0,M);return{rect:{x:_,y:lt,width:Math.min(R.width,N+J)-_,height:Math.min(R.height,M+S)-lt},layout:[{offset:L,stride:w}]}})(l,t,i,n,d)),h)for(let R=0;R<V.length;R+=4){let N=V[R];V[R]=V[R+2],V[R+2]=N}return V}finally{r.close()}}))}let Ha,hl;function Qi(l,t,i,n){return l.addEventListener(t,i,n),{unsubscribe:()=>{l.removeEventListener(t,i,n)}}}function ql(l){return l*Math.PI/180}function vi(l){return l/Math.PI*180}let We={touchstart:!0,touchmove:!0,touchmoveWindow:!0,touchend:!0,touchcancel:!0},Hi={dblclick:!0,click:!0,mouseover:!0,mouseout:!0,mousedown:!0,mousemove:!0,mousemoveWindow:!0,mouseup:!0,mouseupWindow:!0,contextmenu:!0,wheel:!0},Da="AbortError";function cn(){return new Error(Da)}let Ca={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function En(l){return Ca.REGISTERED_PROTOCOLS[l.substring(0,l.indexOf("://"))]}let Fn="global-dispatcher";class zl extends Error{constructor(t,i,n,d){super(`AJAXError: ${i} (${t}): ${n}`),this.status=t,this.statusText=i,this.url=n,this.body=d}}let Di=()=>Na(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,ht=function(l,t){if(/:\/\//.test(l.url)&&!/^https?:|^file:/.test(l.url)){let n=En(l.url);if(n)return n(l,t);if(Na(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:l,targetMapId:Fn},t)}if(!(/^file:/.test(i=l.url)||/^file:/.test(Di())&&!/^\w+:/.test(i))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return(function(n,d){return o(this,void 0,void 0,(function*(){let r=new Request(n.url,{method:n.method||"GET",body:n.body,credentials:n.credentials,headers:n.headers,cache:n.cache,referrer:Di(),signal:d.signal}),b,h;n.type!=="json"||r.headers.has("Accept")||r.headers.set("Accept","application/json");try{b=yield fetch(r)}catch(R){throw new zl(0,R.message,n.url,new Blob)}if(!b.ok){let R=yield b.blob();throw new zl(b.status,b.statusText,n.url,R)}h=n.type==="arrayBuffer"||n.type==="image"?b.arrayBuffer():n.type==="json"?b.json():b.text();let V=yield h;if(d.signal.aborted)throw cn();return{data:V,cacheControl:b.headers.get("Cache-Control"),expires:b.headers.get("Expires")}}))})(l,t);if(Na(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:l,mustQueue:!0,targetMapId:Fn},t)}var i;return(function(n,d){return new Promise(((r,b)=>{var h;let V=new XMLHttpRequest;V.open(n.method||"GET",n.url,!0),n.type!=="arrayBuffer"&&n.type!=="image"||(V.responseType="arraybuffer");for(let R in n.headers)V.setRequestHeader(R,n.headers[R]);n.type==="json"&&(V.responseType="text",!((h=n.headers)===null||h===void 0)&&h.Accept||V.setRequestHeader("Accept","application/json")),V.withCredentials=n.credentials==="include",V.onerror=()=>{b(new Error(V.statusText))},V.onload=()=>{if(!d.signal.aborted)if((V.status>=200&&V.status<300||V.status===0)&&V.response!==null){let R=V.response;if(n.type==="json")try{R=JSON.parse(V.response)}catch(N){return void b(N)}r({data:R,cacheControl:V.getResponseHeader("Cache-Control"),expires:V.getResponseHeader("Expires")})}else{let R=new Blob([V.response],{type:V.getResponseHeader("Content-Type")});b(new zl(V.status,V.statusText,n.url,R))}},d.signal.addEventListener("abort",(()=>{V.abort(),b(cn())})),V.send(n.body)}))})(l,t)};function z(l){if(!l||l.indexOf("://")<=0||l.indexOf("data:image/")===0||l.indexOf("blob:")===0)return!0;let t=new URL(l),i=window.location;return t.protocol===i.protocol&&t.host===i.host}function v(l,t,i){i[l]&&i[l].indexOf(t)!==-1||(i[l]=i[l]||[],i[l].push(t))}function O(l,t,i){if(i&&i[l]){let n=i[l].indexOf(t);n!==-1&&i[l].splice(n,1)}}class dt{constructor(t,i={}){ki(this,i),this.type=t}}class rt extends dt{constructor(t,i={}){super("error",ki({error:t},i))}}class Nt{on(t,i){return this._listeners=this._listeners||{},v(t,i,this._listeners),{unsubscribe:()=>{this.off(t,i)}}}off(t,i){return O(t,i,this._listeners),O(t,i,this._oneTimeListeners),this}once(t,i){return i?(this._oneTimeListeners=this._oneTimeListeners||{},v(t,i,this._oneTimeListeners),this):new Promise((n=>this.once(t,n)))}fire(t,i){typeof t=="string"&&(t=new dt(t,i||{}));let n=t.type;if(this.listens(n)){t.target=this;let d=this._listeners&&this._listeners[n]?this._listeners[n].slice():[];for(let h of d)h.call(this,t);let r=this._oneTimeListeners&&this._oneTimeListeners[n]?this._oneTimeListeners[n].slice():[];for(let h of r)O(n,h,this._oneTimeListeners),h.call(this,t);let b=this._eventedParent;b&&(ki(t,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),b.fire(t))}else t instanceof rt&&console.error(t.error);return this}listens(t){return this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t)}setEventedParent(t,i){return this._eventedParent=t,this._eventedParentData=i,this}}var K={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},centerAltitude:{type:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},roll:{type:"number",default:0,units:"degrees"},state:{type:"state",default:{}},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},"font-faces":{type:"array",value:"fontFaces"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},encoding:{type:"enum",values:{mvt:{},mlt:{}},default:"mvt"},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},"color-relief":{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_color-relief","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_color-relief":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"projectionDefinition",default:"mercator","property-type":"data-constant",transition:!1,expression:{interpolated:!0,parameters:["zoom"]}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_color-relief","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"numberArray",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-altitude":{type:"numberArray",default:45,minimum:0,maximum:90,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"colorArray",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"colorArray",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-method":{type:"enum",values:{standard:{},basic:{},combined:{},igor:{},multidirectional:{}},default:"standard",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},"paint_color-relief":{"color-relief-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"color-relief-color":{type:"color",transition:!1,expression:{interpolated:!0,parameters:["elevation"]},"property-type":"color-ramp"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};let ut=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function Tt(l,t){let i={};for(let n in l)n!=="ref"&&(i[n]=l[n]);return ut.forEach((n=>{n in t&&(i[n]=t[n])})),i}function Bt(l,t){if(Array.isArray(l)){if(!Array.isArray(t)||l.length!==t.length)return!1;for(let i=0;i<l.length;i++)if(!Bt(l[i],t[i]))return!1;return!0}if(typeof l=="object"&&l!==null&&t!==null){if(typeof t!="object"||Object.keys(l).length!==Object.keys(t).length)return!1;for(let i in l)if(!Bt(l[i],t[i]))return!1;return!0}return l===t}function Jt(l,t){l.push(t)}function le(l,t,i){Jt(i,{command:"addSource",args:[l,t[l]]})}function he(l,t,i){Jt(t,{command:"removeSource",args:[l]}),i[l]=!0}function Be(l,t,i,n){he(l,i,n),le(l,t,i)}function Ti(l,t,i){let n;for(n in l[i])if(Object.prototype.hasOwnProperty.call(l[i],n)&&n!=="data"&&!Bt(l[i][n],t[i][n]))return!1;for(n in t[i])if(Object.prototype.hasOwnProperty.call(t[i],n)&&n!=="data"&&!Bt(l[i][n],t[i][n]))return!1;return!0}function Ae(l,t,i,n,d,r){l=l||{},t=t||{};for(let b in l)Object.prototype.hasOwnProperty.call(l,b)&&(Bt(l[b],t[b])||i.push({command:r,args:[n,b,t[b],d]}));for(let b in t)Object.prototype.hasOwnProperty.call(t,b)&&!Object.prototype.hasOwnProperty.call(l,b)&&(Bt(l[b],t[b])||i.push({command:r,args:[n,b,t[b],d]}))}function Oe(l){return l.id}function ai(l,t){return l[t.id]=t,l}class ft{constructor(t,i,n,d){this.message=(t?`${t}: `:"")+n,d&&(this.identifier=d),i!=null&&i.__line__&&(this.line=i.__line__)}}function oi(l,...t){for(let i of t)for(let n in i)l[n]=i[n];return l}class hi extends Error{constructor(t,i){super(i),this.message=i,this.key=t}}class tl{constructor(t,i=[]){this.parent=t,this.bindings={};for(let[n,d]of i)this.bindings[n]=d}concat(t){return new tl(this,t)}get(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(`${t} not found in scope.`)}has(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)}}let Zi={kind:"null"},Ot={kind:"number"},be={kind:"string"},ue={kind:"boolean"},jl={kind:"color"},zn={kind:"projectionDefinition"},Ji={kind:"object"},Ne={kind:"value"},ka={kind:"collator"},Gn={kind:"formatted"},on={kind:"padding"},Ia={kind:"colorArray"},jn={kind:"numberArray"},fa={kind:"resolvedImage"},An={kind:"variableAnchorOffsetCollection"};function $l(l,t){return{kind:"array",itemType:l,N:t}}function bi(l){if(l.kind==="array"){let t=bi(l.itemType);return typeof l.N=="number"?`array<${t}, ${l.N}>`:l.itemType.kind==="value"?"array":`array<${t}>`}return l.kind}let Qo=[Zi,Ot,be,ue,jl,zn,Gn,Ji,$l(Ne),on,jn,Ia,fa,An];function Oa(l,t){if(t.kind==="error")return null;if(l.kind==="array"){if(t.kind==="array"&&(t.N===0&&t.itemType.kind==="value"||!Oa(l.itemType,t.itemType))&&(typeof l.N!="number"||l.N===t.N))return null}else{if(l.kind===t.kind)return null;if(l.kind==="value"){for(let i of Qo)if(!Oa(i,t))return null}}return`Expected ${bi(l)} but found ${bi(t)} instead.`}function wn(l,t){return t.some((i=>i.kind===l.kind))}function Xi(l,t){return t.some((i=>i==="null"?l===null:i==="array"?Array.isArray(l):i==="object"?l&&!Array.isArray(l)&&typeof l=="object":i===typeof l))}function Nn(l,t){return l.kind==="array"&&t.kind==="array"?l.itemType.kind===t.itemType.kind&&typeof l.N=="number":l.kind===t.kind}let cc=.96422,vn=.82521,yd=4/29,Hn=6/29,Al=3*Hn*Hn,Dn=Hn*Hn*Hn,oc=Math.PI/180,Lo=180/Math.PI;function Eo(l){return(l%=360)<0&&(l+=360),l}function rc([l,t,i,n]){let d,r,b=Zd((.2225045*(l=sc(l))+.7168786*(t=sc(t))+.0606169*(i=sc(i)))/1);l===t&&t===i?d=r=b:(d=Zd((.4360747*l+.3850649*t+.1430804*i)/cc),r=Zd((.0139322*l+.0971045*t+.7141733*i)/vn));let h=116*b-16;return[h<0?0:h,500*(d-b),200*(b-r),n]}function sc(l){return l<=.04045?l/12.92:Math.pow((l+.055)/1.055,2.4)}function Zd(l){return l>Dn?Math.pow(l,1/3):l/Al+yd}function Lc([l,t,i,n]){let d=(l+16)/116,r=isNaN(t)?d:d+t/500,b=isNaN(i)?d:d-i/200;return d=1*zc(d),r=cc*zc(r),b=vn*zc(b),[Ec(3.1338561*r-1.6168667*d-.4906146*b),Ec(-.9787684*r+1.9161415*d+.033454*b),Ec(.0719453*r-.2289914*d+1.4052427*b),n]}function Ec(l){return(l=l<=.00304?12.92*l:1.055*Math.pow(l,1/2.4)-.055)<0?0:l>1?1:l}function zc(l){return l>Hn?l*l*l:Al*(l-yd)}let Ua=Object.hasOwn||function(l,t){return Object.prototype.hasOwnProperty.call(l,t)};function _a(l,t){return Ua(l,t)?l[t]:void 0}function In(l){return parseInt(l.padEnd(2,l),16)/255}function zo(l,t){return Pa(t?l/100:l,0,1)}function Pa(l,t,i){return Math.min(Math.max(t,l),i)}function Un(l){return!l.some(Number.isNaN)}let fn={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};function Ka(l,t,i){return l+i*(t-l)}function On(l,t,i){return l.map(((n,d)=>Ka(n,t[d],i)))}class Ee{constructor(t,i,n,d=1,r=!0){this.r=t,this.g=i,this.b=n,this.a=d,r||(this.r*=d,this.g*=d,this.b*=d,d||this.overwriteGetter("rgb",[t,i,n,d]))}static parse(t){if(t instanceof Ee)return t;if(typeof t!="string")return;let i=(function(n){if((n=n.toLowerCase().trim())==="transparent")return[0,0,0,0];let d=_a(fn,n);if(d){let[b,h,V]=d;return[b/255,h/255,V/255,1]}if(n.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(n)){let b=n.length<6?1:2,h=1;return[In(n.slice(h,h+=b)),In(n.slice(h,h+=b)),In(n.slice(h,h+=b)),In(n.slice(h,h+b)||"ff")]}if(n.startsWith("rgb")){let b=n.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(b){let[h,V,R,N,M,J,S,C,L,w,_,lt]=b,P=[N||" ",S||" ",w].join("");if(P==="  "||P==="  /"||P===",,"||P===",,,"){let tt=[R,J,L].join(""),pt=tt==="%%%"?100:tt===""?255:0;if(pt){let Vt=[Pa(+V/pt,0,1),Pa(+M/pt,0,1),Pa(+C/pt,0,1),_?zo(+_,lt):1];if(Un(Vt))return Vt}}return}}let r=n.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(r){let[b,h,V,R,N,M,J,S,C]=r,L=[V||" ",N||" ",J].join("");if(L==="  "||L==="  /"||L===",,"||L===",,,"){let w=[+h,Pa(+R,0,100),Pa(+M,0,100),S?zo(+S,C):1];if(Un(w))return(function([_,lt,P,tt]){function pt(Vt){let Yt=(Vt+_/30)%12,wt=lt*Math.min(P,1-P);return P-wt*Math.max(-1,Math.min(Yt-3,9-Yt,1))}return _=Eo(_),lt/=100,P/=100,[pt(0),pt(8),pt(4),tt]})(w)}}})(t);return i?new Ee(...i,!1):void 0}get rgb(){let{r:t,g:i,b:n,a:d}=this,r=d||1/0;return this.overwriteGetter("rgb",[t/r,i/r,n/r,d])}get hcl(){return this.overwriteGetter("hcl",(function(t){let[i,n,d,r]=rc(t),b=Math.sqrt(n*n+d*d);return[Math.round(1e4*b)?Eo(Math.atan2(d,n)*Lo):NaN,b,i,r]})(this.rgb))}get lab(){return this.overwriteGetter("lab",rc(this.rgb))}overwriteGetter(t,i){return Object.defineProperty(this,t,{value:i}),i}toString(){let[t,i,n,d]=this.rgb;return`rgba(${[t,i,n].map((r=>Math.round(255*r))).join(",")},${d})`}static interpolate(t,i,n,d="rgb"){switch(d){case"rgb":{let[r,b,h,V]=On(t.rgb,i.rgb,n);return new Ee(r,b,h,V,!1)}case"hcl":{let[r,b,h,V]=t.hcl,[R,N,M,J]=i.hcl,S,C;if(isNaN(r)||isNaN(R))isNaN(r)?isNaN(R)?S=NaN:(S=R,h!==1&&h!==0||(C=N)):(S=r,M!==1&&M!==0||(C=b));else{let P=R-r;R>r&&P>180?P-=360:R<r&&r-R>180&&(P+=360),S=r+n*P}let[L,w,_,lt]=(function([P,tt,pt,Vt]){return P=isNaN(P)?0:P*oc,Lc([pt,Math.cos(P)*tt,Math.sin(P)*tt,Vt])})([S,C??Ka(b,N,n),Ka(h,M,n),Ka(V,J,n)]);return new Ee(L,w,_,lt,!1)}case"lab":{let[r,b,h,V]=Lc(On(t.lab,i.lab,n));return new Ee(r,b,h,V,!1)}}}}Ee.black=new Ee(0,0,0,1),Ee.white=new Ee(1,1,1,1),Ee.transparent=new Ee(0,0,0,0),Ee.red=new Ee(1,0,0,1);class ma{constructor(t,i,n){this.sensitivity=t?i?"variant":"case":i?"accent":"base",this.locale=n,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(t,i){return this.collator.compare(t,i)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}let De=["bottom","center","top"];class rn{constructor(t,i,n,d,r,b){this.text=t,this.image=i,this.scale=n,this.fontStack=d,this.textColor=r,this.verticalAlign=b}}class fi{constructor(t){this.sections=t}static fromString(t){return new fi([new rn(t,null,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some((t=>t.text.length!==0||t.image&&t.image.name.length!==0))}static factory(t){return t instanceof fi?t:fi.fromString(t)}toString(){return this.sections.length===0?"":this.sections.map((t=>t.text)).join("")}}class Xl{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof Xl)return t;if(typeof t=="number")return new Xl([t,t,t,t]);if(Array.isArray(t)&&!(t.length<1||t.length>4)){for(let i of t)if(typeof i!="number")return;switch(t.length){case 1:t=[t[0],t[0],t[0],t[0]];break;case 2:t=[t[0],t[1],t[0],t[1]];break;case 3:t=[t[0],t[1],t[2],t[1]]}return new Xl(t)}}toString(){return JSON.stringify(this.values)}static interpolate(t,i,n){return new Xl(On(t.values,i.values,n))}}class Gl{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof Gl)return t;if(typeof t=="number")return new Gl([t]);if(Array.isArray(t)){for(let i of t)if(typeof i!="number")return;return new Gl(t)}}toString(){return JSON.stringify(this.values)}static interpolate(t,i,n){return new Gl(On(t.values,i.values,n))}}class rl{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof rl)return t;if(typeof t=="string"){let n=Ee.parse(t);return n?new rl([n]):void 0}if(!Array.isArray(t))return;let i=[];for(let n of t){if(typeof n!="string")return;let d=Ee.parse(n);if(!d)return;i.push(d)}return new rl(i)}toString(){return JSON.stringify(this.values)}static interpolate(t,i,n,d="rgb"){let r=[];if(t.values.length!=i.values.length)throw new Error(`colorArray: Arrays have mismatched length (${t.values.length} vs. ${i.values.length}), cannot interpolate.`);for(let b=0;b<t.values.length;b++)r.push(Ee.interpolate(t.values[b],i.values[b],n,d));return new rl(r)}}class pi extends Error{constructor(t){super(t),this.name="RuntimeError"}toJSON(){return this.message}}let pd=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class wl{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof wl)return t;if(Array.isArray(t)&&!(t.length<1)&&t.length%2==0){for(let i=0;i<t.length;i+=2){let n=t[i],d=t[i+1];if(typeof n!="string"||!pd.has(n)||!Array.isArray(d)||d.length!==2||typeof d[0]!="number"||typeof d[1]!="number")return}return new wl(t)}}toString(){return JSON.stringify(this.values)}static interpolate(t,i,n){let d=t.values,r=i.values;if(d.length!==r.length)throw new pi(`Cannot interpolate values of different length. from: ${t.toString()}, to: ${i.toString()}`);let b=[];for(let h=0;h<d.length;h+=2){if(d[h]!==r[h])throw new pi(`Cannot interpolate values containing mismatched anchors. from[${h}]: ${d[h]}, to[${h}]: ${r[h]}`);b.push(d[h]);let[V,R]=d[h+1],[N,M]=r[h+1];b.push([Ka(V,N,n),Ka(R,M,n)])}return new wl(b)}}class ta{constructor(t){this.name=t.name,this.available=t.available}toString(){return this.name}static fromString(t){return t?new ta({name:t,available:!1}):null}}class Jl{constructor(t,i,n){this.from=t,this.to=i,this.transition=n}static interpolate(t,i,n){return new Jl(t,i,n)}static parse(t){return t instanceof Jl?t:Array.isArray(t)&&t.length===3&&typeof t[0]=="string"&&typeof t[1]=="string"&&typeof t[2]=="number"?new Jl(t[0],t[1],t[2]):typeof t=="object"&&typeof t.from=="string"&&typeof t.to=="string"&&typeof t.transition=="number"?new Jl(t.from,t.to,t.transition):typeof t=="string"?new Jl(t,t,1):void 0}}function jo(l,t,i,n){return typeof l=="number"&&l>=0&&l<=255&&typeof t=="number"&&t>=0&&t<=255&&typeof i=="number"&&i>=0&&i<=255?n===void 0||typeof n=="number"&&n>=0&&n<=1?null:`Invalid rgba value [${[l,t,i,n].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof n=="number"?[l,t,i,n]:[l,t,i]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Mn(l){if(l===null||typeof l=="string"||typeof l=="boolean"||typeof l=="number"||l instanceof Jl||l instanceof Ee||l instanceof ma||l instanceof fi||l instanceof Xl||l instanceof Gl||l instanceof rl||l instanceof wl||l instanceof ta)return!0;if(Array.isArray(l)){for(let t of l)if(!Mn(t))return!1;return!0}if(typeof l=="object"){for(let t in l)if(!Mn(l[t]))return!1;return!0}return!1}function Fi(l){if(l===null)return Zi;if(typeof l=="string")return be;if(typeof l=="boolean")return ue;if(typeof l=="number")return Ot;if(l instanceof Ee)return jl;if(l instanceof Jl)return zn;if(l instanceof ma)return ka;if(l instanceof fi)return Gn;if(l instanceof Xl)return on;if(l instanceof Gl)return jn;if(l instanceof rl)return Ia;if(l instanceof wl)return An;if(l instanceof ta)return fa;if(Array.isArray(l)){let t=l.length,i;for(let n of l){let d=Fi(n);if(i){if(i===d)continue;i=Ne;break}i=d}return $l(i||Ne,t)}return Ji}function Vd(l){let t=typeof l;return l===null?"":t==="string"||t==="number"||t==="boolean"?String(l):l instanceof Ee||l instanceof Jl||l instanceof fi||l instanceof Xl||l instanceof Gl||l instanceof rl||l instanceof wl||l instanceof ta?l.toString():JSON.stringify(l)}class sn{constructor(t,i){this.type=t,this.value=i}static parse(t,i){if(t.length!==2)return i.error(`'literal' expression requires exactly one argument, but found ${t.length-1} instead.`);if(!Mn(t[1]))return i.error("invalid value");let n=t[1],d=Fi(n),r=i.expectedType;return d.kind!=="array"||d.N!==0||!r||r.kind!=="array"||typeof r.N=="number"&&r.N!==0||(d=r),new sn(d,n)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}let _n={string:be,number:Ot,boolean:ue,object:Ji};class vl{constructor(t,i){this.type=t,this.args=i}static parse(t,i){if(t.length<2)return i.error("Expected at least one argument.");let n,d=1,r=t[0];if(r==="array"){let h,V;if(t.length>2){let R=t[1];if(typeof R!="string"||!(R in _n)||R==="object")return i.error('The item type argument of "array" must be one of string, number, boolean',1);h=_n[R],d++}else h=Ne;if(t.length>3){if(t[2]!==null&&(typeof t[2]!="number"||t[2]<0||t[2]!==Math.floor(t[2])))return i.error('The length argument to "array" must be a positive integer literal',2);V=t[2],d++}n=$l(h,V)}else{if(!_n[r])throw new Error(`Types doesn't contain name = ${r}`);n=_n[r]}let b=[];for(;d<t.length;d++){let h=i.parse(t[d],d,Ne);if(!h)return null;b.push(h)}return new vl(n,b)}evaluate(t){for(let i=0;i<this.args.length;i++){let n=this.args[i].evaluate(t);if(!Oa(this.type,Fi(n)))return n;if(i===this.args.length-1)throw new pi(`Expected value to be of type ${bi(this.type)}, but found ${bi(Fi(n))} instead.`)}throw new Error}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every((t=>t.outputDefined()))}}let mi={"to-boolean":ue,"to-color":jl,"to-number":Ot,"to-string":be};class Qa{constructor(t,i){this.type=t,this.args=i}static parse(t,i){if(t.length<2)return i.error("Expected at least one argument.");let n=t[0];if(!mi[n])throw new Error(`Can't parse ${n} as it is not part of the known types`);if((n==="to-boolean"||n==="to-string")&&t.length!==2)return i.error("Expected one argument.");let d=mi[n],r=[];for(let b=1;b<t.length;b++){let h=i.parse(t[b],b,Ne);if(!h)return null;r.push(h)}return new Qa(d,r)}evaluate(t){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(t);case"color":{let i,n;for(let d of this.args){if(i=d.evaluate(t),n=null,i instanceof Ee)return i;if(typeof i=="string"){let r=t.parseColor(i);if(r)return r}else if(Array.isArray(i)&&(n=i.length<3||i.length>4?`Invalid rgba value ${JSON.stringify(i)}: expected an array containing either three or four numeric values.`:jo(i[0],i[1],i[2],i[3]),!n))return new Ee(i[0]/255,i[1]/255,i[2]/255,i[3])}throw new pi(n||`Could not parse color from value '${typeof i=="string"?i:JSON.stringify(i)}'`)}case"padding":{let i;for(let n of this.args){i=n.evaluate(t);let d=Xl.parse(i);if(d)return d}throw new pi(`Could not parse padding from value '${typeof i=="string"?i:JSON.stringify(i)}'`)}case"numberArray":{let i;for(let n of this.args){i=n.evaluate(t);let d=Gl.parse(i);if(d)return d}throw new pi(`Could not parse numberArray from value '${typeof i=="string"?i:JSON.stringify(i)}'`)}case"colorArray":{let i;for(let n of this.args){i=n.evaluate(t);let d=rl.parse(i);if(d)return d}throw new pi(`Could not parse colorArray from value '${typeof i=="string"?i:JSON.stringify(i)}'`)}case"variableAnchorOffsetCollection":{let i;for(let n of this.args){i=n.evaluate(t);let d=wl.parse(i);if(d)return d}throw new pi(`Could not parse variableAnchorOffsetCollection from value '${typeof i=="string"?i:JSON.stringify(i)}'`)}case"number":{let i=null;for(let n of this.args){if(i=n.evaluate(t),i===null)return 0;let d=Number(i);if(!isNaN(d))return d}throw new pi(`Could not convert ${JSON.stringify(i)} to number.`)}case"formatted":return fi.fromString(Vd(this.args[0].evaluate(t)));case"resolvedImage":return ta.fromString(Vd(this.args[0].evaluate(t)));case"projectionDefinition":return this.args[0].evaluate(t);default:return Vd(this.args[0].evaluate(t))}}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every((t=>t.outputDefined()))}}let $e=["Unknown","Point","LineString","Polygon"];class Se{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache=new Map,this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?$e[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(t){let i=this._parseColorCache.get(t);return i||(i=Ee.parse(t),this._parseColorCache.set(t,i)),i}}class gd{constructor(t,i,n=[],d,r=new tl,b=[]){this.registry=t,this.path=n,this.key=n.map((h=>`[${h}]`)).join(""),this.scope=r,this.errors=b,this.expectedType=d,this._isConstant=i}parse(t,i,n,d,r={}){return i?this.concat(i,n,d)._parse(t,r):this._parse(t,r)}_parse(t,i){function n(d,r,b){return b==="assert"?new vl(r,[d]):b==="coerce"?new Qa(r,[d]):d}if(t!==null&&typeof t!="string"&&typeof t!="boolean"&&typeof t!="number"||(t=["literal",t]),Array.isArray(t)){if(t.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');let d=t[0];if(typeof d!="string")return this.error(`Expression name must be a string, but found ${typeof d} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;let r=this.registry[d];if(r){let b=r.parse(t,this);if(!b)return null;if(this.expectedType){let h=this.expectedType,V=b.type;if(h.kind!=="string"&&h.kind!=="number"&&h.kind!=="boolean"&&h.kind!=="object"&&h.kind!=="array"||V.kind!=="value"){if(h.kind==="projectionDefinition"&&["string","array"].includes(V.kind)||["color","formatted","resolvedImage"].includes(h.kind)&&["value","string"].includes(V.kind)||["padding","numberArray"].includes(h.kind)&&["value","number","array"].includes(V.kind)||h.kind==="colorArray"&&["value","string","array"].includes(V.kind)||h.kind==="variableAnchorOffsetCollection"&&["value","array"].includes(V.kind))b=n(b,h,i.typeAnnotation||"coerce");else if(this.checkSubtype(h,V))return null}else b=n(b,h,i.typeAnnotation||"assert")}if(!(b instanceof sn)&&b.type.kind!=="resolvedImage"&&this._isConstant(b)){let h=new Se;try{b=new sn(b.type,b.evaluate(h))}catch(V){return this.error(V.message),null}}return b}return this.error(`Unknown expression "${d}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(t===void 0?"'undefined' value invalid. Use null instead.":typeof t=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof t} instead.`)}concat(t,i,n){let d=typeof t=="number"?this.path.concat(t):this.path,r=n?this.scope.concat(n):this.scope;return new gd(this.registry,this._isConstant,d,i||null,r,this.errors)}error(t,...i){let n=`${this.key}${i.map((d=>`[${d}]`)).join("")}`;this.errors.push(new hi(n,t))}checkSubtype(t,i){let n=Oa(t,i);return n&&this.error(n),n}}class Ke{constructor(t,i){this.type=i.type,this.bindings=[].concat(t),this.result=i}evaluate(t){return this.result.evaluate(t)}eachChild(t){for(let i of this.bindings)t(i[1]);t(this.result)}static parse(t,i){if(t.length<4)return i.error(`Expected at least 3 arguments, but found ${t.length-1} instead.`);let n=[];for(let r=1;r<t.length-1;r+=2){let b=t[r];if(typeof b!="string")return i.error(`Expected string, but found ${typeof b} instead.`,r);if(/[^a-zA-Z0-9_]/.test(b))return i.error("Variable names must contain only alphanumeric characters or '_'.",r);let h=i.parse(t[r+1],r+1);if(!h)return null;n.push([b,h])}let d=i.parse(t[t.length-1],t.length-1,i.expectedType,n);return d?new Ke(n,d):null}outputDefined(){return this.result.outputDefined()}}class ud{constructor(t,i){this.type=i.type,this.name=t,this.boundExpression=i}static parse(t,i){if(t.length!==2||typeof t[1]!="string")return i.error("'var' expression requires exactly one string literal argument.");let n=t[1];return i.scope.has(n)?new ud(n,i.scope.get(n)):i.error(`Unknown variable "${n}". Make sure "${n}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(t){return this.boundExpression.evaluate(t)}eachChild(){}outputDefined(){return!1}}class Hl{constructor(t,i,n){this.type=t,this.index=i,this.input=n}static parse(t,i){if(t.length!==3)return i.error(`Expected 2 arguments, but found ${t.length-1} instead.`);let n=i.parse(t[1],1,Ot),d=i.parse(t[2],2,$l(i.expectedType||Ne));return n&&d?new Hl(d.type.itemType,n,d):null}evaluate(t){let i=this.index.evaluate(t),n=this.input.evaluate(t);if(i<0)throw new pi(`Array index out of bounds: ${i} < 0.`);if(i>=n.length)throw new pi(`Array index out of bounds: ${i} > ${n.length-1}.`);if(i!==Math.floor(i))throw new pi(`Array index must be an integer, but found ${i} instead.`);return n[i]}eachChild(t){t(this.index),t(this.input)}outputDefined(){return!1}}class Rd{constructor(t,i){this.type=ue,this.needle=t,this.haystack=i}static parse(t,i){if(t.length!==3)return i.error(`Expected 2 arguments, but found ${t.length-1} instead.`);let n=i.parse(t[1],1,Ne),d=i.parse(t[2],2,Ne);return n&&d?wn(n.type,[ue,be,Ot,Zi,Ne])?new Rd(n,d):i.error(`Expected first argument to be of type boolean, string, number or null, but found ${bi(n.type)} instead`):null}evaluate(t){let i=this.needle.evaluate(t),n=this.haystack.evaluate(t);if(!n)return!1;if(!Xi(i,["boolean","string","number","null"]))throw new pi(`Expected first argument to be of type boolean, string, number or null, but found ${bi(Fi(i))} instead.`);if(!Xi(n,["string","array"]))throw new pi(`Expected second argument to be of type array or string, but found ${bi(Fi(n))} instead.`);return n.indexOf(i)>=0}eachChild(t){t(this.needle),t(this.haystack)}outputDefined(){return!0}}class bn{constructor(t,i,n){this.type=Ot,this.needle=t,this.haystack=i,this.fromIndex=n}static parse(t,i){if(t.length<=2||t.length>=5)return i.error(`Expected 2 or 3 arguments, but found ${t.length-1} instead.`);let n=i.parse(t[1],1,Ne),d=i.parse(t[2],2,Ne);if(!n||!d)return null;if(!wn(n.type,[ue,be,Ot,Zi,Ne]))return i.error(`Expected first argument to be of type boolean, string, number or null, but found ${bi(n.type)} instead`);if(t.length===4){let r=i.parse(t[3],3,Ot);return r?new bn(n,d,r):null}return new bn(n,d)}evaluate(t){let i=this.needle.evaluate(t),n=this.haystack.evaluate(t);if(!Xi(i,["boolean","string","number","null"]))throw new pi(`Expected first argument to be of type boolean, string, number or null, but found ${bi(Fi(i))} instead.`);let d;if(this.fromIndex&&(d=this.fromIndex.evaluate(t)),Xi(n,["string"])){let r=n.indexOf(i,d);return r===-1?-1:[...n.slice(0,r)].length}if(Xi(n,["array"]))return n.indexOf(i,d);throw new pi(`Expected second argument to be of type array or string, but found ${bi(Fi(n))} instead.`)}eachChild(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)}outputDefined(){return!1}}class bc{constructor(t,i,n,d,r,b){this.inputType=t,this.type=i,this.input=n,this.cases=d,this.outputs=r,this.otherwise=b}static parse(t,i){if(t.length<5)return i.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if(t.length%2!=1)return i.error("Expected an even number of arguments.");let n,d;i.expectedType&&i.expectedType.kind!=="value"&&(d=i.expectedType);let r={},b=[];for(let R=2;R<t.length-1;R+=2){let N=t[R],M=t[R+1];Array.isArray(N)||(N=[N]);let J=i.concat(R);if(N.length===0)return J.error("Expected at least one branch label.");for(let C of N){if(typeof C!="number"&&typeof C!="string")return J.error("Branch labels must be numbers or strings.");if(typeof C=="number"&&Math.abs(C)>Number.MAX_SAFE_INTEGER)return J.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof C=="number"&&Math.floor(C)!==C)return J.error("Numeric branch labels must be integer values.");if(n){if(J.checkSubtype(n,Fi(C)))return null}else n=Fi(C);if(r[String(C)]!==void 0)return J.error("Branch labels must be unique.");r[String(C)]=b.length}let S=i.parse(M,R,d);if(!S)return null;d=d||S.type,b.push(S)}let h=i.parse(t[1],1,Ne);if(!h)return null;let V=i.parse(t[t.length-1],t.length-1,d);return V?h.type.kind!=="value"&&i.concat(1).checkSubtype(n,h.type)?null:new bc(n,d,h,r,b,V):null}evaluate(t){let i=this.input.evaluate(t);return(Fi(i)===this.inputType&&this.outputs[this.cases[i]]||this.otherwise).evaluate(t)}eachChild(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)}outputDefined(){return this.outputs.every((t=>t.outputDefined()))&&this.otherwise.outputDefined()}}class Bd{constructor(t,i,n){this.type=t,this.branches=i,this.otherwise=n}static parse(t,i){if(t.length<4)return i.error(`Expected at least 3 arguments, but found only ${t.length-1}.`);if(t.length%2!=0)return i.error("Expected an odd number of arguments.");let n;i.expectedType&&i.expectedType.kind!=="value"&&(n=i.expectedType);let d=[];for(let b=1;b<t.length-1;b+=2){let h=i.parse(t[b],b,ue);if(!h)return null;let V=i.parse(t[b+1],b+1,n);if(!V)return null;d.push([h,V]),n=n||V.type}let r=i.parse(t[t.length-1],t.length-1,n);if(!r)return null;if(!n)throw new Error("Can't infer output type");return new Bd(n,d,r)}evaluate(t){for(let[i,n]of this.branches)if(i.evaluate(t))return n.evaluate(t);return this.otherwise.evaluate(t)}eachChild(t){for(let[i,n]of this.branches)t(i),t(n);t(this.otherwise)}outputDefined(){return this.branches.every((([t,i])=>i.outputDefined()))&&this.otherwise.outputDefined()}}class Sd{constructor(t,i,n,d){this.type=t,this.input=i,this.beginIndex=n,this.endIndex=d}static parse(t,i){if(t.length<=2||t.length>=5)return i.error(`Expected 2 or 3 arguments, but found ${t.length-1} instead.`);let n=i.parse(t[1],1,Ne),d=i.parse(t[2],2,Ot);if(!n||!d)return null;if(!wn(n.type,[$l(Ne),be,Ne]))return i.error(`Expected first argument to be of type array or string, but found ${bi(n.type)} instead`);if(t.length===4){let r=i.parse(t[3],3,Ot);return r?new Sd(n.type,n,d,r):null}return new Sd(n.type,n,d)}evaluate(t){let i=this.input.evaluate(t),n=this.beginIndex.evaluate(t),d;if(this.endIndex&&(d=this.endIndex.evaluate(t)),Xi(i,["string"]))return[...i].slice(n,d).join("");if(Xi(i,["array"]))return i.slice(n,d);throw new pi(`Expected first argument to be of type array or string, but found ${bi(Fi(i))} instead.`)}eachChild(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)}outputDefined(){return!1}}function p(l,t){let i=l.length-1,n,d,r=0,b=i,h=0;for(;r<=b;)if(h=Math.floor((r+b)/2),n=l[h],d=l[h+1],n<=t){if(h===i||t<d)return h;r=h+1}else{if(!(n>t))throw new pi("Input is not a number.");b=h-1}return 0}class F{constructor(t,i,n){this.type=t,this.input=i,this.labels=[],this.outputs=[];for(let[d,r]of n)this.labels.push(d),this.outputs.push(r)}static parse(t,i){if(t.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return i.error("Expected an even number of arguments.");let n=i.parse(t[1],1,Ot);if(!n)return null;let d=[],r=null;i.expectedType&&i.expectedType.kind!=="value"&&(r=i.expectedType);for(let b=1;b<t.length;b+=2){let h=b===1?-1/0:t[b],V=t[b+1],R=b,N=b+1;if(typeof h!="number")return i.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',R);if(d.length&&d[d.length-1][0]>=h)return i.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',R);let M=i.parse(V,N,r);if(!M)return null;r=r||M.type,d.push([h,M])}return new F(r,n,d)}evaluate(t){let i=this.labels,n=this.outputs;if(i.length===1)return n[0].evaluate(t);let d=this.input.evaluate(t);if(d<=i[0])return n[0].evaluate(t);let r=i.length;return d>=i[r-1]?n[r-1].evaluate(t):n[p(i,d)].evaluate(t)}eachChild(t){t(this.input);for(let i of this.outputs)t(i)}outputDefined(){return this.outputs.every((t=>t.outputDefined()))}}function T(l){return l&&l.__esModule&&Object.prototype.hasOwnProperty.call(l,"default")?l.default:l}var y,E,A=(function(){if(E)return y;function l(t,i,n,d){this.cx=3*t,this.bx=3*(n-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*i,this.by=3*(d-i)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=i,this.p2x=n,this.p2y=d}return E=1,y=l,l.prototype={sampleCurveX:function(t){return((this.ax*t+this.bx)*t+this.cx)*t},sampleCurveY:function(t){return((this.ay*t+this.by)*t+this.cy)*t},sampleCurveDerivativeX:function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},solveCurveX:function(t,i){if(i===void 0&&(i=1e-6),t<0)return 0;if(t>1)return 1;for(var n=t,d=0;d<8;d++){var r=this.sampleCurveX(n)-t;if(Math.abs(r)<i)return n;var b=this.sampleCurveDerivativeX(n);if(Math.abs(b)<1e-6)break;n-=r/b}var h=0,V=1;for(n=t,d=0;d<20&&(r=this.sampleCurveX(n),!(Math.abs(r-t)<i));d++)t>r?h=n:V=n,n=.5*(V-h)+h;return n},solve:function(t,i){return this.sampleCurveY(this.solveCurveX(t,i))}},y})(),f=T(A);class bt{constructor(t,i,n,d,r){this.type=t,this.operator=i,this.interpolation=n,this.input=d,this.labels=[],this.outputs=[];for(let[b,h]of r)this.labels.push(b),this.outputs.push(h)}static interpolationFactor(t,i,n,d){let r=0;if(t.name==="exponential")r=ct(i,t.base,n,d);else if(t.name==="linear")r=ct(i,1,n,d);else if(t.name==="cubic-bezier"){let b=t.controlPoints;r=new f(b[0],b[1],b[2],b[3]).solve(ct(i,1,n,d))}return r}static parse(t,i){let[n,d,r,...b]=t;if(!Array.isArray(d)||d.length===0)return i.error("Expected an interpolation type expression.",1);if(d[0]==="linear")d={name:"linear"};else if(d[0]==="exponential"){let R=d[1];if(typeof R!="number")return i.error("Exponential interpolation requires a numeric base.",1,1);d={name:"exponential",base:R}}else{if(d[0]!=="cubic-bezier")return i.error(`Unknown interpolation type ${String(d[0])}`,1,0);{let R=d.slice(1);if(R.length!==4||R.some((N=>typeof N!="number"||N<0||N>1)))return i.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);d={name:"cubic-bezier",controlPoints:R}}}if(t.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return i.error("Expected an even number of arguments.");if(r=i.parse(r,2,Ot),!r)return null;let h=[],V=null;n!=="interpolate-hcl"&&n!=="interpolate-lab"||i.expectedType==Ia?i.expectedType&&i.expectedType.kind!=="value"&&(V=i.expectedType):V=jl;for(let R=0;R<b.length;R+=2){let N=b[R],M=b[R+1],J=R+3,S=R+4;if(typeof N!="number")return i.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',J);if(h.length&&h[h.length-1][0]>=N)return i.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',J);let C=i.parse(M,S,V);if(!C)return null;V=V||C.type,h.push([N,C])}return Nn(V,Ot)||Nn(V,zn)||Nn(V,jl)||Nn(V,on)||Nn(V,jn)||Nn(V,Ia)||Nn(V,An)||Nn(V,$l(Ot))?new bt(V,n,d,r,h):i.error(`Type ${bi(V)} is not interpolatable.`)}evaluate(t){let i=this.labels,n=this.outputs;if(i.length===1)return n[0].evaluate(t);let d=this.input.evaluate(t);if(d<=i[0])return n[0].evaluate(t);let r=i.length;if(d>=i[r-1])return n[r-1].evaluate(t);let b=p(i,d),h=bt.interpolationFactor(this.interpolation,d,i[b],i[b+1]),V=n[b].evaluate(t),R=n[b+1].evaluate(t);switch(this.operator){case"interpolate":switch(this.type.kind){case"number":return Ka(V,R,h);case"color":return Ee.interpolate(V,R,h);case"padding":return Xl.interpolate(V,R,h);case"colorArray":return rl.interpolate(V,R,h);case"numberArray":return Gl.interpolate(V,R,h);case"variableAnchorOffsetCollection":return wl.interpolate(V,R,h);case"array":return On(V,R,h);case"projectionDefinition":return Jl.interpolate(V,R,h)}case"interpolate-hcl":switch(this.type.kind){case"color":return Ee.interpolate(V,R,h,"hcl");case"colorArray":return rl.interpolate(V,R,h,"hcl")}case"interpolate-lab":switch(this.type.kind){case"color":return Ee.interpolate(V,R,h,"lab");case"colorArray":return rl.interpolate(V,R,h,"lab")}}}eachChild(t){t(this.input);for(let i of this.outputs)t(i)}outputDefined(){return this.outputs.every((t=>t.outputDefined()))}}function ct(l,t,i,n){let d=n-i,r=l-i;return d===0?0:t===1?r/d:(Math.pow(t,r)-1)/(Math.pow(t,d)-1)}let Gt={color:Ee.interpolate,number:Ka,padding:Xl.interpolate,numberArray:Gl.interpolate,colorArray:rl.interpolate,variableAnchorOffsetCollection:wl.interpolate,array:On};class kt{constructor(t,i){this.type=t,this.args=i}static parse(t,i){if(t.length<2)return i.error("Expected at least one argument.");let n=null,d=i.expectedType;d&&d.kind!=="value"&&(n=d);let r=[];for(let h of t.slice(1)){let V=i.parse(h,1+r.length,n,void 0,{typeAnnotation:"omit"});if(!V)return null;n=n||V.type,r.push(V)}if(!n)throw new Error("No output type");let b=d&&r.some((h=>Oa(d,h.type)));return new kt(b?Ne:n,r)}evaluate(t){let i,n=null,d=0;for(let r of this.args)if(d++,n=r.evaluate(t),n&&n instanceof ta&&!n.available&&(i||(i=n.name),n=null,d===this.args.length&&(n=i)),n!==null)break;return n}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every((t=>t.outputDefined()))}}function Et(l,t){return l==="=="||l==="!="?t.kind==="boolean"||t.kind==="string"||t.kind==="number"||t.kind==="null"||t.kind==="value":t.kind==="string"||t.kind==="number"||t.kind==="value"}function yt(l,t,i,n){return n.compare(t,i)===0}function _t(l,t,i){let n=l!=="=="&&l!=="!=";return class iZ{constructor(r,b,h){this.type=ue,this.lhs=r,this.rhs=b,this.collator=h,this.hasUntypedArgument=r.type.kind==="value"||b.type.kind==="value"}static parse(r,b){if(r.length!==3&&r.length!==4)return b.error("Expected two or three arguments.");let h=r[0],V=b.parse(r[1],1,Ne);if(!V)return null;if(!Et(h,V.type))return b.concat(1).error(`"${h}" comparisons are not supported for type '${bi(V.type)}'.`);let R=b.parse(r[2],2,Ne);if(!R)return null;if(!Et(h,R.type))return b.concat(2).error(`"${h}" comparisons are not supported for type '${bi(R.type)}'.`);if(V.type.kind!==R.type.kind&&V.type.kind!=="value"&&R.type.kind!=="value")return b.error(`Cannot compare types '${bi(V.type)}' and '${bi(R.type)}'.`);n&&(V.type.kind==="value"&&R.type.kind!=="value"?V=new vl(R.type,[V]):V.type.kind!=="value"&&R.type.kind==="value"&&(R=new vl(V.type,[R])));let N=null;if(r.length===4){if(V.type.kind!=="string"&&R.type.kind!=="string"&&V.type.kind!=="value"&&R.type.kind!=="value")return b.error("Cannot use collator to compare non-string types.");if(N=b.parse(r[3],3,ka),!N)return null}return new iZ(V,R,N)}evaluate(r){let b=this.lhs.evaluate(r),h=this.rhs.evaluate(r);if(n&&this.hasUntypedArgument){let V=Fi(b),R=Fi(h);if(V.kind!==R.kind||V.kind!=="string"&&V.kind!=="number")throw new pi(`Expected arguments for "${l}" to be (string, string) or (number, number), but found (${V.kind}, ${R.kind}) instead.`)}if(this.collator&&!n&&this.hasUntypedArgument){let V=Fi(b),R=Fi(h);if(V.kind!=="string"||R.kind!=="string")return t(r,b,h)}return this.collator?i(r,b,h,this.collator.evaluate(r)):t(r,b,h)}eachChild(r){r(this.lhs),r(this.rhs),this.collator&&r(this.collator)}outputDefined(){return!0}}}let Ye=_t("==",(function(l,t,i){return t===i}),yt),ti=_t("!=",(function(l,t,i){return t!==i}),(function(l,t,i,n){return!yt(0,t,i,n)})),we=_t("<",(function(l,t,i){return t<i}),(function(l,t,i,n){return n.compare(t,i)<0})),Zl=_t(">",(function(l,t,i){return t>i}),(function(l,t,i,n){return n.compare(t,i)>0})),Li=_t("<=",(function(l,t,i){return t<=i}),(function(l,t,i,n){return n.compare(t,i)<=0})),Wa=_t(">=",(function(l,t,i){return t>=i}),(function(l,t,i,n){return n.compare(t,i)>=0}));class yi{constructor(t,i,n){this.type=ka,this.locale=n,this.caseSensitive=t,this.diacriticSensitive=i}static parse(t,i){if(t.length!==2)return i.error("Expected one argument.");let n=t[1];if(typeof n!="object"||Array.isArray(n))return i.error("Collator options argument must be an object.");let d=i.parse(n["case-sensitive"]!==void 0&&n["case-sensitive"],1,ue);if(!d)return null;let r=i.parse(n["diacritic-sensitive"]!==void 0&&n["diacritic-sensitive"],1,ue);if(!r)return null;let b=null;return n.locale&&(b=i.parse(n.locale,1,be),!b)?null:new yi(d,r,b)}evaluate(t){return new ma(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)}eachChild(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)}outputDefined(){return!1}}class fe{constructor(t,i,n,d,r){this.type=be,this.number=t,this.locale=i,this.currency=n,this.minFractionDigits=d,this.maxFractionDigits=r}static parse(t,i){if(t.length!==3)return i.error("Expected two arguments.");let n=i.parse(t[1],1,Ot);if(!n)return null;let d=t[2];if(typeof d!="object"||Array.isArray(d))return i.error("NumberFormat options argument must be an object.");let r=null;if(d.locale&&(r=i.parse(d.locale,1,be),!r))return null;let b=null;if(d.currency&&(b=i.parse(d.currency,1,be),!b))return null;let h=null;if(d["min-fraction-digits"]&&(h=i.parse(d["min-fraction-digits"],1,Ot),!h))return null;let V=null;return d["max-fraction-digits"]&&(V=i.parse(d["max-fraction-digits"],1,Ot),!V)?null:new fe(n,r,b,h,V)}evaluate(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))}eachChild(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)}outputDefined(){return!1}}class ha{constructor(t){this.type=Gn,this.sections=t}static parse(t,i){if(t.length<2)return i.error("Expected at least one argument.");let n=t[1];if(!Array.isArray(n)&&typeof n=="object")return i.error("First argument must be an image or text section.");let d=[],r=!1;for(let b=1;b<=t.length-1;++b){let h=t[b];if(r&&typeof h=="object"&&!Array.isArray(h)){r=!1;let V=null;if(h["font-scale"]&&(V=i.parse(h["font-scale"],1,Ot),!V))return null;let R=null;if(h["text-font"]&&(R=i.parse(h["text-font"],1,$l(be)),!R))return null;let N=null;if(h["text-color"]&&(N=i.parse(h["text-color"],1,jl),!N))return null;let M=null;if(h["vertical-align"]){if(typeof h["vertical-align"]=="string"&&!De.includes(h["vertical-align"]))return i.error(`'vertical-align' must be one of: 'bottom', 'center', 'top' but found '${h["vertical-align"]}' instead.`);if(M=i.parse(h["vertical-align"],1,be),!M)return null}let J=d[d.length-1];J.scale=V,J.font=R,J.textColor=N,J.verticalAlign=M}else{let V=i.parse(t[b],1,Ne);if(!V)return null;let R=V.type.kind;if(R!=="string"&&R!=="value"&&R!=="null"&&R!=="resolvedImage")return i.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");r=!0,d.push({content:V,scale:null,font:null,textColor:null,verticalAlign:null})}}return new ha(d)}evaluate(t){return new fi(this.sections.map((i=>{let n=i.content.evaluate(t);return Fi(n)===fa?new rn("",n,null,null,null,i.verticalAlign?i.verticalAlign.evaluate(t):null):new rn(Vd(n),null,i.scale?i.scale.evaluate(t):null,i.font?i.font.evaluate(t).join(","):null,i.textColor?i.textColor.evaluate(t):null,i.verticalAlign?i.verticalAlign.evaluate(t):null)})))}eachChild(t){for(let i of this.sections)t(i.content),i.scale&&t(i.scale),i.font&&t(i.font),i.textColor&&t(i.textColor),i.verticalAlign&&t(i.verticalAlign)}outputDefined(){return!1}}class ei{constructor(t){this.type=fa,this.input=t}static parse(t,i){if(t.length!==2)return i.error("Expected two arguments.");let n=i.parse(t[1],1,be);return n?new ei(n):i.error("No image name provided.")}evaluate(t){let i=this.input.evaluate(t),n=ta.fromString(i);return n&&t.availableImages&&(n.available=t.availableImages.indexOf(i)>-1),n}eachChild(t){t(this.input)}outputDefined(){return!1}}class Gi{constructor(t){this.type=Ot,this.input=t}static parse(t,i){if(t.length!==2)return i.error(`Expected 1 argument, but found ${t.length-1} instead.`);let n=i.parse(t[1],1);return n?n.type.kind!=="array"&&n.type.kind!=="string"&&n.type.kind!=="value"?i.error(`Expected argument of type string or array, but found ${bi(n.type)} instead.`):new Gi(n):null}evaluate(t){let i=this.input.evaluate(t);if(typeof i=="string")return[...i].length;if(Array.isArray(i))return i.length;throw new pi(`Expected value to be of type string or array, but found ${bi(Fi(i))} instead.`)}eachChild(t){t(this.input)}outputDefined(){return!1}}let ea=8192;function jc(l,t){let i=(180+l[0])/360,n=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+l[1]*Math.PI/360)))/360,d=Math.pow(2,t.z);return[Math.round(i*d*ea),Math.round(n*d*ea)]}function Ma(l,t){let i=Math.pow(2,t.z);return[(d=(l[0]/ea+t.x)/i,360*d-180),(n=(l[1]/ea+t.y)/i,360/Math.PI*Math.atan(Math.exp((180-360*n)*Math.PI/180))-90)];var n,d}function mn(l,t){l[0]=Math.min(l[0],t[0]),l[1]=Math.min(l[1],t[1]),l[2]=Math.max(l[2],t[0]),l[3]=Math.max(l[3],t[1])}function Nl(l,t){return!(l[0]<=t[0]||l[2]>=t[2]||l[1]<=t[1]||l[3]>=t[3])}function Yn(l,t,i){let n=l[0]-t[0],d=l[1]-t[1],r=l[0]-i[0],b=l[1]-i[1];return n*b-r*d==0&&n*r<=0&&d*b<=0}function Ya(l,t,i,n){return(d=[n[0]-i[0],n[1]-i[1]])[0]*(r=[t[0]-l[0],t[1]-l[1]])[1]-d[1]*r[0]!=0&&!(!Ao(l,t,i,n)||!Ao(i,n,l,t));var d,r}function Za(l,t,i){for(let n of i)for(let d=0;d<n.length-1;++d)if(Ya(l,t,n[d],n[d+1]))return!0;return!1}function xn(l,t,i=!1){let n=!1;for(let h of t)for(let V=0;V<h.length-1;V++){if(Yn(l,h[V],h[V+1]))return i;(r=h[V])[1]>(d=l)[1]!=(b=h[V+1])[1]>d[1]&&d[0]<(b[0]-r[0])*(d[1]-r[1])/(b[1]-r[1])+r[0]&&(n=!n)}var d,r,b;return n}function qa(l,t){for(let i of t)if(xn(l,i))return!0;return!1}function $a(l,t){for(let i of l)if(!xn(i,t))return!1;for(let i=0;i<l.length-1;++i)if(Za(l[i],l[i+1],t))return!1;return!0}function Pr(l,t){for(let i of t)if($a(l,i))return!0;return!1}function Ao(l,t,i,n){let d=n[0]-i[0],r=n[1]-i[1],b=(l[0]-i[0])*r-d*(l[1]-i[1]),h=(t[0]-i[0])*r-d*(t[1]-i[1]);return b>0&&h<0||b<0&&h>0}function Ac(l,t,i){let n=[];for(let d=0;d<l.length;d++){let r=[];for(let b=0;b<l[d].length;b++){let h=jc(l[d][b],i);mn(t,h),r.push(h)}n.push(r)}return n}function ni(l,t,i){let n=[];for(let d=0;d<l.length;d++){let r=Ac(l[d],t,i);n.push(r)}return n}function Fd(l,t,i,n){if(l[0]<i[0]||l[0]>i[2]){let d=.5*n,r=l[0]-i[0]>d?-n:i[0]-l[0]>d?n:0;r===0&&(r=l[0]-i[2]>d?-n:i[2]-l[0]>d?n:0),l[0]+=r}mn(t,l)}function pa(l,t,i,n){let d=Math.pow(2,n.z)*ea,r=[n.x*ea,n.y*ea],b=[];for(let h of l)for(let V of h){let R=[V.x+r[0],V.y+r[1]];Fd(R,t,i,d),b.push(R)}return b}function Tn(l,t,i,n){let d=Math.pow(2,n.z)*ea,r=[n.x*ea,n.y*ea],b=[];for(let V of l){let R=[];for(let N of V){let M=[N.x+r[0],N.y+r[1]];mn(t,M),R.push(M)}b.push(R)}if(t[2]-t[0]<=d/2){(h=t)[0]=h[1]=1/0,h[2]=h[3]=-1/0;for(let V of b)for(let R of V)Fd(R,t,i,d)}var h;return b}class Pn{constructor(t,i){this.type=ue,this.geojson=t,this.geometries=i}static parse(t,i){if(t.length!==2)return i.error(`'within' expression requires exactly one argument, but found ${t.length-1} instead.`);if(Mn(t[1])){let n=t[1];if(n.type==="FeatureCollection"){let d=[];for(let r of n.features){let{type:b,coordinates:h}=r.geometry;b==="Polygon"&&d.push(h),b==="MultiPolygon"&&d.push(...h)}if(d.length)return new Pn(n,{type:"MultiPolygon",coordinates:d})}else if(n.type==="Feature"){let d=n.geometry.type;if(d==="Polygon"||d==="MultiPolygon")return new Pn(n,n.geometry)}else if(n.type==="Polygon"||n.type==="MultiPolygon")return new Pn(n,n)}return i.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return(function(i,n){let d=[1/0,1/0,-1/0,-1/0],r=[1/0,1/0,-1/0,-1/0],b=i.canonicalID();if(n.type==="Polygon"){let h=Ac(n.coordinates,r,b),V=pa(i.geometry(),d,r,b);if(!Nl(d,r))return!1;for(let R of V)if(!xn(R,h))return!1}if(n.type==="MultiPolygon"){let h=ni(n.coordinates,r,b),V=pa(i.geometry(),d,r,b);if(!Nl(d,r))return!1;for(let R of V)if(!qa(R,h))return!1}return!0})(t,this.geometries);if(t.geometryType()==="LineString")return(function(i,n){let d=[1/0,1/0,-1/0,-1/0],r=[1/0,1/0,-1/0,-1/0],b=i.canonicalID();if(n.type==="Polygon"){let h=Ac(n.coordinates,r,b),V=Tn(i.geometry(),d,r,b);if(!Nl(d,r))return!1;for(let R of V)if(!$a(R,h))return!1}if(n.type==="MultiPolygon"){let h=ni(n.coordinates,r,b),V=Tn(i.geometry(),d,r,b);if(!Nl(d,r))return!1;for(let R of V)if(!Pr(R,h))return!1}return!0})(t,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let wo=class{constructor(l=[],t=(i,n)=>i<n?-1:i>n?1:0){if(this.data=l,this.length=this.data.length,this.compare=t,this.length>0)for(let i=(this.length>>1)-1;i>=0;i--)this._down(i)}push(l){this.data.push(l),this._up(this.length++)}pop(){if(this.length===0)return;let l=this.data[0],t=this.data.pop();return--this.length>0&&(this.data[0]=t,this._down(0)),l}peek(){return this.data[0]}_up(l){let{data:t,compare:i}=this,n=t[l];for(;l>0;){let d=l-1>>1,r=t[d];if(i(n,r)>=0)break;t[l]=r,l=d}t[l]=n}_down(l){let{data:t,compare:i}=this,n=this.length>>1,d=t[l];for(;l<n;){let r=1+(l<<1),b=r+1;if(b<this.length&&i(t[b],t[r])<0&&(r=b),i(t[r],d)>=0)break;t[l]=t[r],l=r}t[l]=d}};function wc(l,t,i=0,n=l.length-1,d=Gd){for(;n>i;){if(n-i>600){let V=n-i+1,R=t-i+1,N=Math.log(V),M=.5*Math.exp(2*N/3),J=.5*Math.sqrt(N*M*(V-M)/V)*(R-V/2<0?-1:1);wc(l,t,Math.max(i,Math.floor(t-R*M/V+J)),Math.min(n,Math.floor(t+(V-R)*M/V+J)),d)}let r=l[t],b=i,h=n;for(La(l,i,t),d(l[n],r)>0&&La(l,i,n);b<h;){for(La(l,b,h),b++,h--;d(l[b],r)<0;)b++;for(;d(l[h],r)>0;)h--}d(l[i],r)===0?La(l,i,h):(h++,La(l,h,n)),h<=t&&(i=h+1),t<=h&&(n=h-1)}}function La(l,t,i){let n=l[t];l[t]=l[i],l[i]=n}function Gd(l,t){return l<t?-1:l>t?1:0}function xa(l,t){if(l.length<=1)return[l];let i=[],n,d;for(let r of l){let b=Cd(r);b!==0&&(r.area=Math.abs(b),d===void 0&&(d=b<0),d===b<0?(n&&i.push(n),n=[r]):n.push(r))}if(n&&i.push(n),t>1)for(let r=0;r<i.length;r++)i[r].length<=t||(wc(i[r],t,1,i[r].length-1,vo),i[r]=i[r].slice(0,t));return i}function vo(l,t){return t.area-l.area}function Cd(l){let t=0;for(let i,n,d=0,r=l.length,b=r-1;d<r;b=d++)i=l[d],n=l[b],t+=(n.x-i.x)*(i.y+n.y);return t}let kd=1/298.257223563,Kn=kd*(2-kd),Qd=Math.PI/180;class vc{constructor(t){let i=6378.137*Qd*1e3,n=Math.cos(t*Qd),d=1/(1-Kn*(1-n*n)),r=Math.sqrt(d);this.kx=i*r*n,this.ky=i*r*d*(1-Kn)}distance(t,i){let n=this.wrap(t[0]-i[0])*this.kx,d=(t[1]-i[1])*this.ky;return Math.sqrt(n*n+d*d)}pointOnLine(t,i){let n,d,r,b,h=1/0;for(let V=0;V<t.length-1;V++){let R=t[V][0],N=t[V][1],M=this.wrap(t[V+1][0]-R)*this.kx,J=(t[V+1][1]-N)*this.ky,S=0;M===0&&J===0||(S=(this.wrap(i[0]-R)*this.kx*M+(i[1]-N)*this.ky*J)/(M*M+J*J),S>1?(R=t[V+1][0],N=t[V+1][1]):S>0&&(R+=M/this.kx*S,N+=J/this.ky*S)),M=this.wrap(i[0]-R)*this.kx,J=(i[1]-N)*this.ky;let C=M*M+J*J;C<h&&(h=C,n=R,d=N,r=V,b=S)}return{point:[n,d],index:r,t:Math.max(0,Math.min(1,b))}}wrap(t){for(;t<-180;)t+=360;for(;t>180;)t-=360;return t}}function Ld(l,t){return t[0]-l[0]}function qn(l){return l[1]-l[0]+1}function Ta(l,t){return l[1]>=l[0]&&l[1]<t}function Hc(l,t){if(l[0]>l[1])return[null,null];let i=qn(l);if(t){if(i===2)return[l,null];let d=Math.floor(i/2);return[[l[0],l[0]+d],[l[0]+d,l[1]]]}if(i===1)return[l,null];let n=Math.floor(i/2)-1;return[[l[0],l[0]+n],[l[0]+n+1,l[1]]]}function Ed(l,t){if(!Ta(t,l.length))return[1/0,1/0,-1/0,-1/0];let i=[1/0,1/0,-1/0,-1/0];for(let n=t[0];n<=t[1];++n)mn(i,l[n]);return i}function mc(l){let t=[1/0,1/0,-1/0,-1/0];for(let i of l)for(let n of i)mn(t,n);return t}function it(l){return l[0]!==-1/0&&l[1]!==-1/0&&l[2]!==1/0&&l[3]!==1/0}function Rt(l,t,i){if(!it(l)||!it(t))return NaN;let n=0,d=0;return l[2]<t[0]&&(n=t[0]-l[2]),l[0]>t[2]&&(n=l[0]-t[2]),l[1]>t[3]&&(d=l[1]-t[3]),l[3]<t[1]&&(d=t[1]-l[3]),i.distance([0,0],[n,d])}function Mt(l,t,i){let n=i.pointOnLine(t,l);return i.distance(l,n.point)}function St(l,t,i,n,d){let r=Math.min(Mt(l,[i,n],d),Mt(t,[i,n],d)),b=Math.min(Mt(i,[l,t],d),Mt(n,[l,t],d));return Math.min(r,b)}function zt(l,t,i,n,d){if(!Ta(t,l.length)||!Ta(n,i.length))return 1/0;let r=1/0;for(let b=t[0];b<t[1];++b){let h=l[b],V=l[b+1];for(let R=n[0];R<n[1];++R){let N=i[R],M=i[R+1];if(Ya(h,V,N,M))return 0;r=Math.min(r,St(h,V,N,M,d))}}return r}function Dt(l,t,i,n,d){if(!Ta(t,l.length)||!Ta(n,i.length))return NaN;let r=1/0;for(let b=t[0];b<=t[1];++b)for(let h=n[0];h<=n[1];++h)if(r=Math.min(r,d.distance(l[b],i[h])),r===0)return r;return r}function oe(l,t,i){if(xn(l,t,!0))return 0;let n=1/0;for(let d of t){let r=d[0],b=d[d.length-1];if(r!==b&&(n=Math.min(n,Mt(l,[b,r],i)),n===0))return n;let h=i.pointOnLine(d,l);if(n=Math.min(n,i.distance(l,h.point)),n===0)return n}return n}function Ve(l,t,i,n){if(!Ta(t,l.length))return NaN;for(let r=t[0];r<=t[1];++r)if(xn(l[r],i,!0))return 0;let d=1/0;for(let r=t[0];r<t[1];++r){let b=l[r],h=l[r+1];for(let V of i)for(let R=0,N=V.length,M=N-1;R<N;M=R++){let J=V[M],S=V[R];if(Ya(b,h,J,S))return 0;d=Math.min(d,St(b,h,J,S,n))}}return d}function ce(l,t){for(let i of l)for(let n of i)if(xn(n,t,!0))return!0;return!1}function qe(l,t,i,n=1/0){let d=mc(l),r=mc(t);if(n!==1/0&&Rt(d,r,i)>=n)return n;if(Nl(d,r)){if(ce(l,t))return 0}else if(ce(t,l))return 0;let b=1/0;for(let h of l)for(let V=0,R=h.length,N=R-1;V<R;N=V++){let M=h[N],J=h[V];for(let S of t)for(let C=0,L=S.length,w=L-1;C<L;w=C++){let _=S[w],lt=S[C];if(Ya(M,J,_,lt))return 0;b=Math.min(b,St(M,J,_,lt,i))}}return b}function xe(l,t,i,n,d,r){if(!r)return;let b=Rt(Ed(n,r),d,i);b<t&&l.push([b,r,[0,0]])}function Xe(l,t,i,n,d,r,b){if(!r||!b)return;let h=Rt(Ed(n,r),Ed(d,b),i);h<t&&l.push([h,r,b])}function ve(l,t,i,n,d=1/0){let r=Math.min(n.distance(l[0],i[0][0]),d);if(r===0)return r;let b=new wo([[0,[0,l.length-1],[0,0]]],Ld),h=mc(i);for(;b.length>0;){let V=b.pop();if(V[0]>=r)continue;let R=V[1],N=t?50:100;if(qn(R)<=N){if(!Ta(R,l.length))return NaN;if(t){let M=Ve(l,R,i,n);if(isNaN(M)||M===0)return M;r=Math.min(r,M)}else for(let M=R[0];M<=R[1];++M){let J=oe(l[M],i,n);if(r=Math.min(r,J),r===0)return 0}}else{let M=Hc(R,t);xe(b,r,n,l,h,M[0]),xe(b,r,n,l,h,M[1])}}return r}function Ge(l,t,i,n,d,r=1/0){let b=Math.min(r,d.distance(l[0],i[0]));if(b===0)return b;let h=new wo([[0,[0,l.length-1],[0,i.length-1]]],Ld);for(;h.length>0;){let V=h.pop();if(V[0]>=b)continue;let R=V[1],N=V[2],M=t?50:100,J=n?50:100;if(qn(R)<=M&&qn(N)<=J){if(!Ta(R,l.length)&&Ta(N,i.length))return NaN;let S;if(t&&n)S=zt(l,R,i,N,d),b=Math.min(b,S);else if(t&&!n){let C=l.slice(R[0],R[1]+1);for(let L=N[0];L<=N[1];++L)if(S=Mt(i[L],C,d),b=Math.min(b,S),b===0)return b}else if(!t&&n){let C=i.slice(N[0],N[1]+1);for(let L=R[0];L<=R[1];++L)if(S=Mt(l[L],C,d),b=Math.min(b,S),b===0)return b}else S=Dt(l,R,i,N,d),b=Math.min(b,S)}else{let S=Hc(R,t),C=Hc(N,n);Xe(h,b,d,l,i,S[0],C[0]),Xe(h,b,d,l,i,S[0],C[1]),Xe(h,b,d,l,i,S[1],C[0]),Xe(h,b,d,l,i,S[1],C[1])}}return b}function Wi(l){return l.type==="MultiPolygon"?l.coordinates.map((t=>({type:"Polygon",coordinates:t}))):l.type==="MultiLineString"?l.coordinates.map((t=>({type:"LineString",coordinates:t}))):l.type==="MultiPoint"?l.coordinates.map((t=>({type:"Point",coordinates:t}))):[l]}class el{constructor(t,i){this.type=Ot,this.geojson=t,this.geometries=i}static parse(t,i){if(t.length!==2)return i.error(`'distance' expression requires exactly one argument, but found ${t.length-1} instead.`);if(Mn(t[1])){let n=t[1];if(n.type==="FeatureCollection")return new el(n,n.features.map((d=>Wi(d.geometry))).flat());if(n.type==="Feature")return new el(n,Wi(n.geometry));if("type"in n&&"coordinates"in n)return new el(n,Wi(n))}return i.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return(function(i,n){let d=i.geometry(),r=d.flat().map((V=>Ma([V.x,V.y],i.canonical)));if(d.length===0)return NaN;let b=new vc(r[0][1]),h=1/0;for(let V of n){switch(V.type){case"Point":h=Math.min(h,Ge(r,!1,[V.coordinates],!1,b,h));break;case"LineString":h=Math.min(h,Ge(r,!1,V.coordinates,!0,b,h));break;case"Polygon":h=Math.min(h,ve(r,!1,V.coordinates,b,h))}if(h===0)return h}return h})(t,this.geometries);if(t.geometryType()==="LineString")return(function(i,n){let d=i.geometry(),r=d.flat().map((V=>Ma([V.x,V.y],i.canonical)));if(d.length===0)return NaN;let b=new vc(r[0][1]),h=1/0;for(let V of n){switch(V.type){case"Point":h=Math.min(h,Ge(r,!0,[V.coordinates],!1,b,h));break;case"LineString":h=Math.min(h,Ge(r,!0,V.coordinates,!0,b,h));break;case"Polygon":h=Math.min(h,ve(r,!0,V.coordinates,b,h))}if(h===0)return h}return h})(t,this.geometries);if(t.geometryType()==="Polygon")return(function(i,n){let d=i.geometry();if(d.length===0||d[0].length===0)return NaN;let r=xa(d,0).map((V=>V.map((R=>R.map((N=>Ma([N.x,N.y],i.canonical))))))),b=new vc(r[0][0][0][1]),h=1/0;for(let V of n)for(let R of r){switch(V.type){case"Point":h=Math.min(h,ve([V.coordinates],!1,R,b,h));break;case"LineString":h=Math.min(h,ve(V.coordinates,!0,R,b,h));break;case"Polygon":h=Math.min(h,qe(R,V.coordinates,b,h))}if(h===0)return h}return h})(t,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}class il{constructor(t){this.type=Ne,this.key=t}static parse(t,i){if(t.length!==2)return i.error(`Expected 1 argument, but found ${t.length-1} instead.`);let n=t[1];return n==null?i.error("Global state property must be defined."):typeof n!="string"?i.error(`Global state property must be string, but found ${typeof t[1]} instead.`):new il(n)}evaluate(t){var i;let n=(i=t.globals)===null||i===void 0?void 0:i.globalState;return n&&Object.keys(n).length!==0?_a(n,this.key):null}eachChild(){}outputDefined(){return!1}}let Il={"==":Ye,"!=":ti,">":Zl,"<":we,">=":Wa,"<=":Li,array:vl,at:Hl,boolean:vl,case:Bd,coalesce:kt,collator:yi,format:ha,image:ei,in:Rd,"index-of":bn,interpolate:bt,"interpolate-hcl":bt,"interpolate-lab":bt,length:Gi,let:Ke,literal:sn,match:bc,number:vl,"number-format":fe,object:vl,slice:Sd,step:F,string:vl,"to-boolean":Qa,"to-color":Qa,"to-number":Qa,"to-string":Qa,var:ud,within:Pn,distance:el,"global-state":il};class Oi{constructor(t,i,n,d){this.name=t,this.type=i,this._evaluate=n,this.args=d}evaluate(t){return this._evaluate(t,this.args)}eachChild(t){this.args.forEach(t)}outputDefined(){return!1}static parse(t,i){let n=t[0],d=Oi.definitions[n];if(!d)return i.error(`Unknown expression "${n}". If you wanted a literal array, use ["literal", [...]].`,0);let r=Array.isArray(d)?d[0]:d.type,b=Array.isArray(d)?[[d[1],d[2]]]:d.overloads,h=b.filter((([R])=>!Array.isArray(R)||R.length===t.length-1)),V=null;for(let[R,N]of h){V=new gd(i.registry,Ho,i.path,null,i.scope);let M=[],J=!1;for(let S=1;S<t.length;S++){let C=t[S],L=Array.isArray(R)?R[S-1]:R.type,w=V.parse(C,1+M.length,L);if(!w){J=!0;break}M.push(w)}if(!J)if(Array.isArray(R)&&R.length!==M.length)V.error(`Expected ${R.length} arguments, but found ${M.length} instead.`);else{for(let S=0;S<M.length;S++){let C=Array.isArray(R)?R[S]:R.type,L=M[S];V.concat(S+1).checkSubtype(C,L.type)}if(V.errors.length===0)return new Oi(n,r,N,M)}}if(h.length===1)i.errors.push(...V.errors);else{let R=(h.length?h:b).map((([M])=>{return J=M,Array.isArray(J)?`(${J.map(bi).join(", ")})`:`(${bi(J.type)}...)`;var J})).join(" | "),N=[];for(let M=1;M<t.length;M++){let J=i.parse(t[M],1+N.length);if(!J)return null;N.push(bi(J.type))}i.error(`Expected arguments of type ${R}, but found (${N.join(", ")}) instead.`)}return null}static register(t,i){Oi.definitions=i;for(let n in i)t[n]=Oi}}function $n(l,[t,i,n,d]){t=t.evaluate(l),i=i.evaluate(l),n=n.evaluate(l);let r=d?d.evaluate(l):1,b=jo(t,i,n,r);if(b)throw new pi(b);return new Ee(t/255,i/255,n/255,r,!1)}function yl(l,t){return l in t}function Kr(l,t){let i=t[l];return i===void 0?null:i}function zd(l){return{type:l}}function Ho(l){if(l instanceof ud)return Ho(l.boundExpression);if(l instanceof Oi&&l.name==="error"||l instanceof yi||l instanceof Pn||l instanceof el||l instanceof il)return!1;let t=l instanceof Qa||l instanceof vl,i=!0;return l.eachChild((n=>{i=t?i&&Ho(n):i&&n instanceof sn})),!!i&&Do(l)&&fo(l,["zoom","heatmap-density","elevation","line-progress","accumulated","is-supported-script"])}function Do(l){if(l instanceof Oi&&(l.name==="get"&&l.args.length===1||l.name==="feature-state"||l.name==="has"&&l.args.length===1||l.name==="properties"||l.name==="geometry-type"||l.name==="id"||/^filter-/.test(l.name))||l instanceof Pn||l instanceof el)return!1;let t=!0;return l.eachChild((i=>{t&&!Do(i)&&(t=!1)})),t}function Dc(l){if(l instanceof Oi&&l.name==="feature-state")return!1;let t=!0;return l.eachChild((i=>{t&&!Dc(i)&&(t=!1)})),t}function fo(l,t){if(l instanceof Oi&&t.indexOf(l.name)>=0)return!1;let i=!0;return l.eachChild((n=>{i&&!fo(n,t)&&(i=!1)})),i}function W0(l){return{result:"success",value:l}}function Wc(l){return{result:"error",value:l}}function hc(l){return l["property-type"]==="data-driven"||l["property-type"]==="cross-faded-data-driven"}function h0(l){return!!l.expression&&l.expression.parameters.indexOf("zoom")>-1}function qr(l){return!!l.expression&&l.expression.interpolated}function _e(l){return l instanceof Number?"number":l instanceof String?"string":l instanceof Boolean?"boolean":Array.isArray(l)?"array":l===null?"null":typeof l}function Oo(l){return typeof l=="object"&&l!==null&&!Array.isArray(l)&&Fi(l)===Ji}function Ob(l){return l}function Z0(l,t){let i=l.stops&&typeof l.stops[0][0]=="object",n=i||!(i||l.property!==void 0),d=l.type||(qr(t)?"exponential":"interval"),r=(function(N){switch(N.type){case"color":return Ee.parse;case"padding":return Xl.parse;case"numberArray":return Gl.parse;case"colorArray":return rl.parse;default:return null}})(t);if(r&&((l=oi({},l)).stops&&(l.stops=l.stops.map((N=>[N[0],r(N[1])]))),l.default=r(l.default?l.default:t.default)),l.colorSpace&&(b=l.colorSpace)!=="rgb"&&b!=="hcl"&&b!=="lab")throw new Error(`Unknown color space: "${l.colorSpace}"`);var b;let h=(function(N){switch(N){case"exponential":return p0;case"interval":return _b;case"categorical":return $r;case"identity":return Pb;default:throw new Error(`Unknown function type "${N}"`)}})(d),V,R;if(d==="categorical"){V=Object.create(null);for(let N of l.stops)V[N[0]]=N[1];R=typeof l.stops[0][0]}if(i){let N={},M=[];for(let C=0;C<l.stops.length;C++){let L=l.stops[C],w=L[0].zoom;N[w]===void 0&&(N[w]={zoom:w,type:l.type,property:l.property,default:l.default,stops:[]},M.push(w)),N[w].stops.push([L[0].value,L[1]])}let J=[];for(let C of M)J.push([N[C].zoom,Z0(N[C],t)]);let S={name:"linear"};return{kind:"composite",interpolationType:S,interpolationFactor:bt.interpolationFactor.bind(void 0,S),zoomStops:J.map((C=>C[0])),evaluate:({zoom:C},L)=>p0({stops:J,base:l.base},t,C).evaluate(C,L)}}if(n){let N=d==="exponential"?{name:"exponential",base:l.base!==void 0?l.base:1}:null;return{kind:"camera",interpolationType:N,interpolationFactor:bt.interpolationFactor.bind(void 0,N),zoomStops:l.stops.map((M=>M[0])),evaluate:({zoom:M})=>h(l,t,M,V,R)}}return{kind:"source",evaluate(N,M){let J=M&&M.properties?M.properties[l.property]:void 0;return J===void 0?fc(l.default,t.default):h(l,t,J,V,R)}}}function fc(l,t,i){return l!==void 0?l:t!==void 0?t:i!==void 0?i:void 0}function $r(l,t,i,n,d){return fc(typeof i===d?n[i]:void 0,l.default,t.default)}function _b(l,t,i){if(_e(i)!=="number")return fc(l.default,t.default);let n=l.stops.length;if(n===1||i<=l.stops[0][0])return l.stops[0][1];if(i>=l.stops[n-1][0])return l.stops[n-1][1];let d=p(l.stops.map((r=>r[0])),i);return l.stops[d][1]}function p0(l,t,i){let n=l.base!==void 0?l.base:1;if(_e(i)!=="number")return fc(l.default,t.default);let d=l.stops.length;if(d===1||i<=l.stops[0][0])return l.stops[0][1];if(i>=l.stops[d-1][0])return l.stops[d-1][1];let r=p(l.stops.map((N=>N[0])),i),b=(function(N,M,J,S){let C=S-J,L=N-J;return C===0?0:M===1?L/C:(Math.pow(M,L)-1)/(Math.pow(M,C)-1)})(i,n,l.stops[r][0],l.stops[r+1][0]),h=l.stops[r][1],V=l.stops[r+1][1],R=Gt[t.type]||Ob;return typeof h.evaluate=="function"?{evaluate(...N){let M=h.evaluate.apply(void 0,N),J=V.evaluate.apply(void 0,N);if(M!==void 0&&J!==void 0)return R(M,J,b,l.colorSpace)}}:R(h,V,b,l.colorSpace)}function Pb(l,t,i){switch(t.type){case"color":i=Ee.parse(i);break;case"formatted":i=fi.fromString(i.toString());break;case"resolvedImage":i=ta.fromString(i.toString());break;case"padding":i=Xl.parse(i);break;case"colorArray":i=rl.parse(i);break;case"numberArray":i=Gl.parse(i);break;default:_e(i)===t.type||t.type==="enum"&&t.values[i]||(i=void 0)}return fc(i,l.default,t.default)}Oi.register(Il,{error:[{kind:"error"},[be],(l,[t])=>{throw new pi(t.evaluate(l))}],typeof:[be,[Ne],(l,[t])=>bi(Fi(t.evaluate(l)))],"to-rgba":[$l(Ot,4),[jl],(l,[t])=>{let[i,n,d,r]=t.evaluate(l).rgb;return[255*i,255*n,255*d,r]}],rgb:[jl,[Ot,Ot,Ot],$n],rgba:[jl,[Ot,Ot,Ot,Ot],$n],has:{type:ue,overloads:[[[be],(l,[t])=>yl(t.evaluate(l),l.properties())],[[be,Ji],(l,[t,i])=>yl(t.evaluate(l),i.evaluate(l))]]},get:{type:Ne,overloads:[[[be],(l,[t])=>Kr(t.evaluate(l),l.properties())],[[be,Ji],(l,[t,i])=>Kr(t.evaluate(l),i.evaluate(l))]]},"feature-state":[Ne,[be],(l,[t])=>Kr(t.evaluate(l),l.featureState||{})],properties:[Ji,[],l=>l.properties()],"geometry-type":[be,[],l=>l.geometryType()],id:[Ne,[],l=>l.id()],zoom:[Ot,[],l=>l.globals.zoom],"heatmap-density":[Ot,[],l=>l.globals.heatmapDensity||0],elevation:[Ot,[],l=>l.globals.elevation||0],"line-progress":[Ot,[],l=>l.globals.lineProgress||0],accumulated:[Ne,[],l=>l.globals.accumulated===void 0?null:l.globals.accumulated],"+":[Ot,zd(Ot),(l,t)=>{let i=0;for(let n of t)i+=n.evaluate(l);return i}],"*":[Ot,zd(Ot),(l,t)=>{let i=1;for(let n of t)i*=n.evaluate(l);return i}],"-":{type:Ot,overloads:[[[Ot,Ot],(l,[t,i])=>t.evaluate(l)-i.evaluate(l)],[[Ot],(l,[t])=>-t.evaluate(l)]]},"/":[Ot,[Ot,Ot],(l,[t,i])=>t.evaluate(l)/i.evaluate(l)],"%":[Ot,[Ot,Ot],(l,[t,i])=>t.evaluate(l)%i.evaluate(l)],ln2:[Ot,[],()=>Math.LN2],pi:[Ot,[],()=>Math.PI],e:[Ot,[],()=>Math.E],"^":[Ot,[Ot,Ot],(l,[t,i])=>Math.pow(t.evaluate(l),i.evaluate(l))],sqrt:[Ot,[Ot],(l,[t])=>Math.sqrt(t.evaluate(l))],log10:[Ot,[Ot],(l,[t])=>Math.log(t.evaluate(l))/Math.LN10],ln:[Ot,[Ot],(l,[t])=>Math.log(t.evaluate(l))],log2:[Ot,[Ot],(l,[t])=>Math.log(t.evaluate(l))/Math.LN2],sin:[Ot,[Ot],(l,[t])=>Math.sin(t.evaluate(l))],cos:[Ot,[Ot],(l,[t])=>Math.cos(t.evaluate(l))],tan:[Ot,[Ot],(l,[t])=>Math.tan(t.evaluate(l))],asin:[Ot,[Ot],(l,[t])=>Math.asin(t.evaluate(l))],acos:[Ot,[Ot],(l,[t])=>Math.acos(t.evaluate(l))],atan:[Ot,[Ot],(l,[t])=>Math.atan(t.evaluate(l))],min:[Ot,zd(Ot),(l,t)=>Math.min(...t.map((i=>i.evaluate(l))))],max:[Ot,zd(Ot),(l,t)=>Math.max(...t.map((i=>i.evaluate(l))))],abs:[Ot,[Ot],(l,[t])=>Math.abs(t.evaluate(l))],round:[Ot,[Ot],(l,[t])=>{let i=t.evaluate(l);return i<0?-Math.round(-i):Math.round(i)}],floor:[Ot,[Ot],(l,[t])=>Math.floor(t.evaluate(l))],ceil:[Ot,[Ot],(l,[t])=>Math.ceil(t.evaluate(l))],"filter-==":[ue,[be,Ne],(l,[t,i])=>l.properties()[t.value]===i.value],"filter-id-==":[ue,[Ne],(l,[t])=>l.id()===t.value],"filter-type-==":[ue,[be],(l,[t])=>l.geometryType()===t.value],"filter-<":[ue,[be,Ne],(l,[t,i])=>{let n=l.properties()[t.value],d=i.value;return typeof n==typeof d&&n<d}],"filter-id-<":[ue,[Ne],(l,[t])=>{let i=l.id(),n=t.value;return typeof i==typeof n&&i<n}],"filter->":[ue,[be,Ne],(l,[t,i])=>{let n=l.properties()[t.value],d=i.value;return typeof n==typeof d&&n>d}],"filter-id->":[ue,[Ne],(l,[t])=>{let i=l.id(),n=t.value;return typeof i==typeof n&&i>n}],"filter-<=":[ue,[be,Ne],(l,[t,i])=>{let n=l.properties()[t.value],d=i.value;return typeof n==typeof d&&n<=d}],"filter-id-<=":[ue,[Ne],(l,[t])=>{let i=l.id(),n=t.value;return typeof i==typeof n&&i<=n}],"filter->=":[ue,[be,Ne],(l,[t,i])=>{let n=l.properties()[t.value],d=i.value;return typeof n==typeof d&&n>=d}],"filter-id->=":[ue,[Ne],(l,[t])=>{let i=l.id(),n=t.value;return typeof i==typeof n&&i>=n}],"filter-has":[ue,[Ne],(l,[t])=>t.value in l.properties()],"filter-has-id":[ue,[],l=>l.id()!==null&&l.id()!==void 0],"filter-type-in":[ue,[$l(be)],(l,[t])=>t.value.indexOf(l.geometryType())>=0],"filter-id-in":[ue,[$l(Ne)],(l,[t])=>t.value.indexOf(l.id())>=0],"filter-in-small":[ue,[be,$l(Ne)],(l,[t,i])=>i.value.indexOf(l.properties()[t.value])>=0],"filter-in-large":[ue,[be,$l(Ne)],(l,[t,i])=>(function(n,d,r,b){for(;r<=b;){let h=r+b>>1;if(d[h]===n)return!0;d[h]>n?b=h-1:r=h+1}return!1})(l.properties()[t.value],i.value,0,i.value.length-1)],all:{type:ue,overloads:[[[ue,ue],(l,[t,i])=>t.evaluate(l)&&i.evaluate(l)],[zd(ue),(l,t)=>{for(let i of t)if(!i.evaluate(l))return!1;return!0}]]},any:{type:ue,overloads:[[[ue,ue],(l,[t,i])=>t.evaluate(l)||i.evaluate(l)],[zd(ue),(l,t)=>{for(let i of t)if(i.evaluate(l))return!0;return!1}]]},"!":[ue,[ue],(l,[t])=>!t.evaluate(l)],"is-supported-script":[ue,[be],(l,[t])=>{let i=l.globals&&l.globals.isSupportedScript;return!i||i(t.evaluate(l))}],upcase:[be,[be],(l,[t])=>t.evaluate(l).toUpperCase()],downcase:[be,[be],(l,[t])=>t.evaluate(l).toLowerCase()],concat:[be,zd(Ne),(l,t)=>t.map((i=>Vd(i.evaluate(l)))).join("")],"resolved-locale":[be,[ka],(l,[t])=>t.evaluate(l).resolvedLocale()]});class _o{constructor(t,i,n){this.expression=t,this._warningHistory={},this._evaluator=new Se,this._defaultValue=i?(function(d){if(d.type==="color"&&Oo(d.default))return new Ee(0,0,0,0);switch(d.type){case"color":return Ee.parse(d.default)||null;case"padding":return Xl.parse(d.default)||null;case"numberArray":return Gl.parse(d.default)||null;case"colorArray":return rl.parse(d.default)||null;case"variableAnchorOffsetCollection":return wl.parse(d.default)||null;case"projectionDefinition":return Jl.parse(d.default)||null;default:return d.default===void 0?null:d.default}})(i):null,this._enumValues=i&&i.type==="enum"?i.values:null,this._globalState=n}evaluateWithoutErrorHandling(t,i,n,d,r,b){return this._globalState&&(t=Zc(t,this._globalState)),this._evaluator.globals=t,this._evaluator.feature=i,this._evaluator.featureState=n,this._evaluator.canonical=d,this._evaluator.availableImages=r||null,this._evaluator.formattedSection=b,this.expression.evaluate(this._evaluator)}evaluate(t,i,n,d,r,b){this._globalState&&(t=Zc(t,this._globalState)),this._evaluator.globals=t,this._evaluator.feature=i||null,this._evaluator.featureState=n||null,this._evaluator.canonical=d,this._evaluator.availableImages=r||null,this._evaluator.formattedSection=b||null;try{let h=this.expression.evaluate(this._evaluator);if(h==null||typeof h=="number"&&h!=h)return this._defaultValue;if(this._enumValues&&!(h in this._enumValues))throw new pi(`Expected value to be one of ${Object.keys(this._enumValues).map((V=>JSON.stringify(V))).join(", ")}, but found ${JSON.stringify(h)} instead.`);return h}catch(h){return this._warningHistory[h.message]||(this._warningHistory[h.message]=!0,typeof console<"u"&&console.warn(h.message)),this._defaultValue}}}function Po(l){return Array.isArray(l)&&l.length>0&&typeof l[0]=="string"&&l[0]in Il}function Ko(l,t,i){let n=new gd(Il,Ho,[],t?(function(r){let b={color:jl,string:be,number:Ot,enum:be,boolean:ue,formatted:Gn,padding:on,numberArray:jn,colorArray:Ia,projectionDefinition:zn,resolvedImage:fa,variableAnchorOffsetCollection:An};return r.type==="array"?$l(b[r.value]||Ne,r.length):b[r.type]})(t):void 0),d=n.parse(l,void 0,void 0,void 0,t&&t.type==="string"?{typeAnnotation:"coerce"}:void 0);return d?W0(new _o(d,t,i)):Wc(n.errors)}class jd{constructor(t,i,n){this.kind=t,this._styleExpression=i,this.isStateDependent=t!=="constant"&&!Dc(i.expression),this.globalStateRefs=er(i.expression),this._globalState=n}evaluateWithoutErrorHandling(t,i,n,d,r,b){return this._globalState&&(t=Zc(t,this._globalState)),this._styleExpression.evaluateWithoutErrorHandling(t,i,n,d,r,b)}evaluate(t,i,n,d,r,b){return this._globalState&&(t=Zc(t,this._globalState)),this._styleExpression.evaluate(t,i,n,d,r,b)}}class qo{constructor(t,i,n,d,r){this.kind=t,this.zoomStops=n,this._styleExpression=i,this.isStateDependent=t!=="camera"&&!Dc(i.expression),this.globalStateRefs=er(i.expression),this.interpolationType=d,this._globalState=r}evaluateWithoutErrorHandling(t,i,n,d,r,b){return this._globalState&&(t=Zc(t,this._globalState)),this._styleExpression.evaluateWithoutErrorHandling(t,i,n,d,r,b)}evaluate(t,i,n,d,r,b){return this._globalState&&(t=Zc(t,this._globalState)),this._styleExpression.evaluate(t,i,n,d,r,b)}interpolationFactor(t,i,n){return this.interpolationType?bt.interpolationFactor(this.interpolationType,t,i,n):0}}function V0(l,t,i){let n=Ko(l,t,i);if(n.result==="error")return n;let d=n.value.expression,r=Do(d);if(!r&&!hc(t))return Wc([new hi("","data expressions not supported")]);let b=fo(d,["zoom"]);if(!b&&!h0(t))return Wc([new hi("","zoom expressions not supported")]);let h=tr(d);return h||b?h instanceof hi?Wc([h]):h instanceof bt&&!qr(t)?Wc([new hi("",'"interpolate" expressions cannot be used with this property')]):W0(h?new qo(r?"camera":"composite",n.value,h.labels,h instanceof bt?h.interpolation:void 0,i):new jd(r?"constant":"source",n.value,i)):Wc([new hi("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class $o{constructor(t,i){this._parameters=t,this._specification=i,oi(this,Z0(this._parameters,this._specification))}static deserialize(t){return new $o(t._parameters,t._specification)}static serialize(t){return{_parameters:t._parameters,_specification:t._specification}}}function tr(l){let t=null;if(l instanceof Ke)t=tr(l.result);else if(l instanceof kt){for(let i of l.args)if(t=tr(i),t)break}else(l instanceof F||l instanceof bt)&&l.input instanceof Oi&&l.input.name==="zoom"&&(t=l);return t instanceof hi||l.eachChild((i=>{let n=tr(i);n instanceof hi?t=n:!t&&n?t=new hi("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):t&&n&&t!==n&&(t=new hi("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))})),t}function er(l,t=new Set){return l instanceof il&&t.add(l.key),l.eachChild((i=>{er(i,t)})),t}function Zc(l,t){let{zoom:i,heatmapDensity:n,elevation:d,lineProgress:r,isSupportedScript:b,accumulated:h}=l??{};return{zoom:i,heatmapDensity:n,elevation:d,lineProgress:r,isSupportedScript:b,accumulated:h,globalState:t}}function ir(l){if(l===!0||l===!1)return!0;if(!Array.isArray(l)||l.length===0)return!1;switch(l[0]){case"has":return l.length>=2&&l[1]!=="$id"&&l[1]!=="$type";case"in":return l.length>=3&&(typeof l[1]!="string"||Array.isArray(l[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return l.length!==3||Array.isArray(l[1])||Array.isArray(l[2]);case"any":case"all":for(let t of l.slice(1))if(!ir(t)&&typeof t!="boolean")return!1;return!0;default:return!0}}let g0={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Oc(l,t){if(l==null)return{filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set};ir(l)||(l=_c(l));let i=Ko(l,g0,t);if(i.result==="error")throw new Error(i.value.map((n=>`${n.key}: ${n.message}`)).join(", "));return{filter:(n,d,r)=>i.value.evaluate(n,d,{},r),needGeometry:ts(l),getGlobalStateRefs:()=>er(i.value.expression)}}function Kb(l,t){return l<t?-1:l>t?1:0}function ts(l){if(!Array.isArray(l))return!1;if(l[0]==="within"||l[0]==="distance")return!0;for(let t=1;t<l.length;t++)if(ts(l[t]))return!0;return!1}function _c(l){if(!l)return!0;let t=l[0];return l.length<=1?t!=="any":t==="=="?lr(l[1],l[2],"=="):t==="!="?ar(lr(l[1],l[2],"==")):t==="<"||t===">"||t==="<="||t===">="?lr(l[1],l[2],t):t==="any"?(i=l.slice(1),["any"].concat(i.map(_c))):t==="all"?["all"].concat(l.slice(1).map(_c)):t==="none"?["all"].concat(l.slice(1).map(_c).map(ar)):t==="in"?u0(l[1],l.slice(2)):t==="!in"?ar(u0(l[1],l.slice(2))):t==="has"?R0(l[1]):t!=="!has"||ar(R0(l[1]));var i}function lr(l,t,i){switch(l){case"$type":return[`filter-type-${i}`,t];case"$id":return[`filter-id-${i}`,t];default:return[`filter-${i}`,l,t]}}function u0(l,t){if(t.length===0)return!1;switch(l){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some((i=>typeof i!=typeof t[0]))?["filter-in-large",l,["literal",t.sort(Kb)]]:["filter-in-small",l,["literal",t]]}}function R0(l){switch(l){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",l]}}function ar(l){return["!",l]}function es(l){let t=typeof l;if(t==="number"||t==="boolean"||t==="string"||l==null)return JSON.stringify(l);if(Array.isArray(l)){let d="[";for(let r of l)d+=`${es(r)},`;return`${d}]`}let i=Object.keys(l).sort(),n="{";for(let d=0;d<i.length;d++)n+=`${JSON.stringify(i[d])}:${es(l[i[d]])},`;return`${n}}`}function F0(l){let t="";for(let i of ut)t+=`/${es(l[i])}`;return t}function is(l){let t=l.value;return t?[new ft(l.key,t,"constants have been deprecated as of v8")]:[]}function Ei(l){return l instanceof Number||l instanceof String||l instanceof Boolean?l.valueOf():l}function td(l){if(Array.isArray(l))return l.map(td);if(l instanceof Object&&!(l instanceof Number||l instanceof String||l instanceof Boolean)){let t={};for(let i in l)t[i]=td(l[i]);return t}return Ei(l)}function Xa(l){let t=l.key,i=l.value,n=l.valueSpec||{},d=l.objectElementValidators||{},r=l.style,b=l.styleSpec,h=l.validateSpec,V=[],R=_e(i);if(R!=="object")return[new ft(t,i,`object expected, ${R} found`)];for(let N in i){let M=N.split(".")[0],J=_a(n,M)||n["*"],S;if(_a(d,M))S=d[M];else if(_a(n,M))S=h;else if(d["*"])S=d["*"];else{if(!n["*"]){V.push(new ft(t,i[N],`unknown property "${N}"`));continue}S=h}V=V.concat(S({key:(t&&`${t}.`)+N,value:i[N],valueSpec:J,style:r,styleSpec:b,object:i,objectKey:N,validateSpec:h},i))}for(let N in n)d[N]||n[N].required&&n[N].default===void 0&&i[N]===void 0&&V.push(new ft(t,i,`missing required property "${N}"`));return V}function Pc(l){let t=l.value,i=l.valueSpec,n=l.style,d=l.styleSpec,r=l.key,b=l.arrayElementValidator||l.validateSpec;if(_e(t)!=="array")return[new ft(r,t,`array expected, ${_e(t)} found`)];if(i.length&&t.length!==i.length)return[new ft(r,t,`array length ${i.length} expected, length ${t.length} found`)];if(i["min-length"]&&t.length<i["min-length"])return[new ft(r,t,`array length at least ${i["min-length"]} expected, length ${t.length} found`)];let h={type:i.value,values:i.values};d.$version<7&&(h.function=i.function),_e(i.value)==="object"&&(h=i.value);let V=[];for(let R=0;R<t.length;R++)V=V.concat(b({array:t,arrayIndex:R,value:t[R],valueSpec:h,validateSpec:l.validateSpec,style:n,styleSpec:d,key:`${r}[${R}]`}));return V}function Ad(l){let t=l.key,i=l.value,n=l.valueSpec,d=_e(i);return d==="number"&&i!=i&&(d="NaN"),d!=="number"?[new ft(t,i,`number expected, ${d} found`)]:"minimum"in n&&i<n.minimum?[new ft(t,i,`${i} is less than the minimum value ${n.minimum}`)]:"maximum"in n&&i>n.maximum?[new ft(t,i,`${i} is greater than the maximum value ${n.maximum}`)]:[]}function G0(l){let t=l.valueSpec,i=Ei(l.value.type),n,d,r,b={},h=i!=="categorical"&&l.value.property===void 0,V=!h,R=_e(l.value.stops)==="array"&&_e(l.value.stops[0])==="array"&&_e(l.value.stops[0][0])==="object",N=Xa({key:l.key,value:l.value,valueSpec:l.styleSpec.function,validateSpec:l.validateSpec,style:l.style,styleSpec:l.styleSpec,objectElementValidators:{stops:function(S){if(i==="identity")return[new ft(S.key,S.value,'identity function may not have a "stops" property')];let C=[],L=S.value;return C=C.concat(Pc({key:S.key,value:L,valueSpec:S.valueSpec,validateSpec:S.validateSpec,style:S.style,styleSpec:S.styleSpec,arrayElementValidator:M})),_e(L)==="array"&&L.length===0&&C.push(new ft(S.key,L,"array must have at least one stop")),C},default:function(S){return S.validateSpec({key:S.key,value:S.value,valueSpec:t,validateSpec:S.validateSpec,style:S.style,styleSpec:S.styleSpec})}}});return i==="identity"&&h&&N.push(new ft(l.key,l.value,'missing required property "property"')),i==="identity"||l.value.stops||N.push(new ft(l.key,l.value,'missing required property "stops"')),i==="exponential"&&l.valueSpec.expression&&!qr(l.valueSpec)&&N.push(new ft(l.key,l.value,"exponential functions not supported")),l.styleSpec.$version>=8&&(V&&!hc(l.valueSpec)?N.push(new ft(l.key,l.value,"property functions not supported")):h&&!h0(l.valueSpec)&&N.push(new ft(l.key,l.value,"zoom functions not supported"))),i!=="categorical"&&!R||l.value.property!==void 0||N.push(new ft(l.key,l.value,'"property" property is required')),N;function M(S){let C=[],L=S.value,w=S.key;if(_e(L)!=="array")return[new ft(w,L,`array expected, ${_e(L)} found`)];if(L.length!==2)return[new ft(w,L,`array length 2 expected, length ${L.length} found`)];if(R){if(_e(L[0])!=="object")return[new ft(w,L,`object expected, ${_e(L[0])} found`)];if(L[0].zoom===void 0)return[new ft(w,L,"object stop key must have zoom")];if(L[0].value===void 0)return[new ft(w,L,"object stop key must have value")];if(r&&r>Ei(L[0].zoom))return[new ft(w,L[0].zoom,"stop zoom values must appear in ascending order")];Ei(L[0].zoom)!==r&&(r=Ei(L[0].zoom),d=void 0,b={}),C=C.concat(Xa({key:`${w}[0]`,value:L[0],valueSpec:{zoom:{}},validateSpec:S.validateSpec,style:S.style,styleSpec:S.styleSpec,objectElementValidators:{zoom:Ad,value:J}}))}else C=C.concat(J({key:`${w}[0]`,value:L[0],validateSpec:S.validateSpec,style:S.style,styleSpec:S.styleSpec},L));return Po(td(L[1]))?C.concat([new ft(`${w}[1]`,L[1],"expressions are not allowed in function stops.")]):C.concat(S.validateSpec({key:`${w}[1]`,value:L[1],valueSpec:t,validateSpec:S.validateSpec,style:S.style,styleSpec:S.styleSpec}))}function J(S,C){let L=_e(S.value),w=Ei(S.value),_=S.value!==null?S.value:C;if(n){if(L!==n)return[new ft(S.key,_,`${L} stop domain type must match previous stop domain type ${n}`)]}else n=L;if(L!=="number"&&L!=="string"&&L!=="boolean")return[new ft(S.key,_,"stop domain value must be a number, string, or boolean")];if(L!=="number"&&i!=="categorical"){let lt=`number expected, ${L} found`;return hc(t)&&i===void 0&&(lt+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new ft(S.key,_,lt)]}return i!=="categorical"||L!=="number"||isFinite(w)&&Math.floor(w)===w?i!=="categorical"&&L==="number"&&d!==void 0&&w<d?[new ft(S.key,_,"stop domain values must appear in ascending order")]:(d=w,i==="categorical"&&w in b?[new ft(S.key,_,"stop domain values must be unique")]:(b[w]=!0,[])):[new ft(S.key,_,`integer expected, found ${w}`)]}}function pc(l){let t=(l.expressionContext==="property"?V0:Ko)(td(l.value),l.valueSpec);if(t.result==="error")return t.value.map((n=>new ft(`${l.key}${n.key}`,l.value,n.message)));let i=t.value.expression||t.value._styleExpression.expression;if(l.expressionContext==="property"&&l.propertyKey==="text-font"&&!i.outputDefined())return[new ft(l.key,l.value,`Invalid data expression for "${l.propertyKey}". Output values must be contained as literals within the expression.`)];if(l.expressionContext==="property"&&l.propertyType==="layout"&&!Dc(i))return[new ft(l.key,l.value,'"feature-state" data expressions are not supported with layout properties.')];if(l.expressionContext==="filter"&&!Dc(i))return[new ft(l.key,l.value,'"feature-state" data expressions are not supported with filters.')];if(l.expressionContext&&l.expressionContext.indexOf("cluster")===0){if(!fo(i,["zoom","feature-state"]))return[new ft(l.key,l.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(l.expressionContext==="cluster-initial"&&!Do(i))return[new ft(l.key,l.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function ls(l){let t=l.key,i=l.value,n=_e(i);return n!=="string"?[new ft(t,i,`color expected, ${n} found`)]:Ee.parse(String(i))?[]:[new ft(t,i,`color expected, "${i}" found`)]}function Kc(l){let t=l.key,i=l.value,n=l.valueSpec,d=[];return Array.isArray(n.values)?n.values.indexOf(Ei(i))===-1&&d.push(new ft(t,i,`expected one of [${n.values.join(", ")}], ${JSON.stringify(i)} found`)):Object.keys(n.values).indexOf(Ei(i))===-1&&d.push(new ft(t,i,`expected one of [${Object.keys(n.values).join(", ")}], ${JSON.stringify(i)} found`)),d}function as(l){return ir(td(l.value))?pc(oi({},l,{expressionContext:"filter",valueSpec:{value:"boolean"}})):N0(l)}function N0(l){let t=l.value,i=l.key;if(_e(t)!=="array")return[new ft(i,t,`array expected, ${_e(t)} found`)];let n=l.styleSpec,d,r=[];if(t.length<1)return[new ft(i,t,"filter array must have at least 1 element")];switch(r=r.concat(Kc({key:`${i}[0]`,value:t[0],valueSpec:n.filter_operator,style:l.style,styleSpec:l.styleSpec})),Ei(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&Ei(t[1])==="$type"&&r.push(new ft(i,t,`"$type" cannot be use with operator "${t[0]}"`));case"==":case"!=":t.length!==3&&r.push(new ft(i,t,`filter array for operator "${t[0]}" must have 3 elements`));case"in":case"!in":t.length>=2&&(d=_e(t[1]),d!=="string"&&r.push(new ft(`${i}[1]`,t[1],`string expected, ${d} found`)));for(let b=2;b<t.length;b++)d=_e(t[b]),Ei(t[1])==="$type"?r=r.concat(Kc({key:`${i}[${b}]`,value:t[b],valueSpec:n.geometry_type,style:l.style,styleSpec:l.styleSpec})):d!=="string"&&d!=="number"&&d!=="boolean"&&r.push(new ft(`${i}[${b}]`,t[b],`string, number, or boolean expected, ${d} found`));break;case"any":case"all":case"none":for(let b=1;b<t.length;b++)r=r.concat(N0({key:`${i}[${b}]`,value:t[b],style:l.style,styleSpec:l.styleSpec}));break;case"has":case"!has":d=_e(t[1]),t.length!==2?r.push(new ft(i,t,`filter array for "${t[0]}" operator must have 2 elements`)):d!=="string"&&r.push(new ft(`${i}[1]`,t[1],`string expected, ${d} found`))}return r}function ns(l,t){let i=l.key,n=l.validateSpec,d=l.style,r=l.styleSpec,b=l.value,h=l.objectKey,V=r[`${t}_${l.layerType}`];if(!V)return[];let R=h.match(/^(.*)-transition$/);if(t==="paint"&&R&&V[R[1]]&&V[R[1]].transition)return n({key:i,value:b,valueSpec:r.transition,style:d,styleSpec:r});let N=l.valueSpec||V[h];if(!N)return[new ft(i,b,`unknown property "${h}"`)];let M;if(_e(b)==="string"&&hc(N)&&!N.tokens&&(M=/^{([^}]+)}$/.exec(b)))return[new ft(i,b,`"${h}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(M[1])} }\`.`)];let J=[];return l.layerType==="symbol"&&h==="text-font"&&Oo(td(b))&&Ei(b.type)==="identity"&&J.push(new ft(i,b,'"text-font" does not support identity functions')),J.concat(n({key:l.key,value:b,valueSpec:N,style:d,styleSpec:r,expressionContext:"property",propertyType:t,propertyKey:h}))}function ds(l){return ns(l,"paint")}function qc(l){return ns(l,"layout")}function I0(l){let t=[],i=l.value,n=l.key,d=l.style,r=l.styleSpec;if(_e(i)!=="object")return[new ft(n,i,`object expected, ${_e(i)} found`)];i.type||i.ref||t.push(new ft(n,i,'either "type" or "ref" is required'));let b=Ei(i.type),h=Ei(i.ref);if(i.id){let V=Ei(i.id);for(let R=0;R<l.arrayIndex;R++){let N=d.layers[R];Ei(N.id)===V&&t.push(new ft(n,i.id,`duplicate layer id "${i.id}", previously used at line ${N.id.__line__}`))}}if("ref"in i){let V;["type","source","source-layer","filter","layout"].forEach((R=>{R in i&&t.push(new ft(n,i[R],`"${R}" is prohibited for ref layers`))})),d.layers.forEach((R=>{Ei(R.id)===h&&(V=R)})),V?V.ref?t.push(new ft(n,i.ref,"ref cannot reference another ref layer")):b=Ei(V.type):t.push(new ft(n,i.ref,`ref layer "${h}" not found`))}else if(b!=="background")if(i.source){let V=d.sources&&d.sources[i.source],R=V&&Ei(V.type);V?R==="vector"&&b==="raster"?t.push(new ft(n,i.source,`layer "${i.id}" requires a raster source`)):R!=="raster-dem"&&b==="hillshade"||R!=="raster-dem"&&b==="color-relief"?t.push(new ft(n,i.source,`layer "${i.id}" requires a raster-dem source`)):R==="raster"&&b!=="raster"?t.push(new ft(n,i.source,`layer "${i.id}" requires a vector source`)):R!=="vector"||i["source-layer"]?R==="raster-dem"&&b!=="hillshade"&&b!=="color-relief"?t.push(new ft(n,i.source,"raster-dem source can only be used with layer type 'hillshade' or 'color-relief'.")):b!=="line"||!i.paint||!i.paint["line-gradient"]||R==="geojson"&&V.lineMetrics||t.push(new ft(n,i,`layer "${i.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):t.push(new ft(n,i,`layer "${i.id}" must specify a "source-layer"`)):t.push(new ft(n,i.source,`source "${i.source}" not found`))}else t.push(new ft(n,i,'missing required property "source"'));return t=t.concat(Xa({key:n,value:i,valueSpec:r.layer,style:l.style,styleSpec:l.styleSpec,validateSpec:l.validateSpec,objectElementValidators:{"*":()=>[],type:()=>l.validateSpec({key:`${n}.type`,value:i.type,valueSpec:r.layer.type,style:l.style,styleSpec:l.styleSpec,validateSpec:l.validateSpec,object:i,objectKey:"type"}),filter:as,layout:V=>Xa({layer:i,key:V.key,value:V.value,style:V.style,styleSpec:V.styleSpec,validateSpec:V.validateSpec,objectElementValidators:{"*":R=>qc(oi({layerType:b},R))}}),paint:V=>Xa({layer:i,key:V.key,value:V.value,style:V.style,styleSpec:V.styleSpec,validateSpec:V.validateSpec,objectElementValidators:{"*":R=>ds(oi({layerType:b},R))}})}})),t}function Nd(l){let t=l.value,i=l.key,n=_e(t);return n!=="string"?[new ft(i,t,`string expected, ${n} found`)]:[]}let cs={promoteId:function({key:l,value:t}){if(_e(t)==="string")return Nd({key:l,value:t});{let i=[];for(let n in t)i.push(...Nd({key:`${l}.${n}`,value:t[n]}));return i}}};function U0(l){let t=l.value,i=l.key,n=l.styleSpec,d=l.style,r=l.validateSpec;if(!t.type)return[new ft(i,t,'"type" is required')];let b=Ei(t.type),h;switch(b){case"vector":case"raster":return h=Xa({key:i,value:t,valueSpec:n[`source_${b.replace("-","_")}`],style:l.style,styleSpec:n,objectElementValidators:cs,validateSpec:r}),h;case"raster-dem":return h=(function(V){var R;let N=(R=V.sourceName)!==null&&R!==void 0?R:"",M=V.value,J=V.styleSpec,S=J.source_raster_dem,C=V.style,L=[],w=_e(M);if(M===void 0)return L;if(w!=="object")return L.push(new ft("source_raster_dem",M,`object expected, ${w} found`)),L;let _=Ei(M.encoding)==="custom",lt=["redFactor","greenFactor","blueFactor","baseShift"],P=V.value.encoding?`"${V.value.encoding}"`:"Default";for(let tt in M)!_&&lt.includes(tt)?L.push(new ft(tt,M[tt],`In "${N}": "${tt}" is only valid when "encoding" is set to "custom". ${P} encoding found`)):S[tt]?L=L.concat(V.validateSpec({key:tt,value:M[tt],valueSpec:S[tt],validateSpec:V.validateSpec,style:C,styleSpec:J})):L.push(new ft(tt,M[tt],`unknown property "${tt}"`));return L})({sourceName:i,value:t,style:l.style,styleSpec:n,validateSpec:r}),h;case"geojson":if(h=Xa({key:i,value:t,valueSpec:n.source_geojson,style:d,styleSpec:n,validateSpec:r,objectElementValidators:cs}),t.cluster)for(let V in t.clusterProperties){let[R,N]=t.clusterProperties[V],M=typeof R=="string"?[R,["accumulated"],["get",V]]:R;h.push(...pc({key:`${i}.${V}.map`,value:N,expressionContext:"cluster-map"})),h.push(...pc({key:`${i}.${V}.reduce`,value:M,expressionContext:"cluster-reduce"}))}return h;case"video":return Xa({key:i,value:t,valueSpec:n.source_video,style:d,validateSpec:r,styleSpec:n});case"image":return Xa({key:i,value:t,valueSpec:n.source_image,style:d,validateSpec:r,styleSpec:n});case"canvas":return[new ft(i,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Kc({key:`${i}.type`,value:t.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]}})}}function os(l){let t=l.value,i=l.styleSpec,n=i.light,d=l.style,r=[],b=_e(t);if(t===void 0)return r;if(b!=="object")return r=r.concat([new ft("light",t,`object expected, ${b} found`)]),r;for(let h in t){let V=h.match(/^(.*)-transition$/);r=r.concat(V&&n[V[1]]&&n[V[1]].transition?l.validateSpec({key:h,value:t[h],valueSpec:i.transition,validateSpec:l.validateSpec,style:d,styleSpec:i}):n[h]?l.validateSpec({key:h,value:t[h],valueSpec:n[h],validateSpec:l.validateSpec,style:d,styleSpec:i}):[new ft(h,t[h],`unknown property "${h}"`)])}return r}function rs(l){let t=l.value,i=l.styleSpec,n=i.sky,d=l.style,r=_e(t);if(t===void 0)return[];if(r!=="object")return[new ft("sky",t,`object expected, ${r} found`)];let b=[];for(let h in t)b=b.concat(n[h]?l.validateSpec({key:h,value:t[h],valueSpec:n[h],style:d,styleSpec:i}):[new ft(h,t[h],`unknown property "${h}"`)]);return b}function Vc(l){let t=l.value,i=l.styleSpec,n=i.terrain,d=l.style,r=[],b=_e(t);if(t===void 0)return r;if(b!=="object")return r=r.concat([new ft("terrain",t,`object expected, ${b} found`)]),r;for(let h in t)r=r.concat(n[h]?l.validateSpec({key:h,value:t[h],valueSpec:n[h],validateSpec:l.validateSpec,style:d,styleSpec:i}):[new ft(h,t[h],`unknown property "${h}"`)]);return r}function M0(l){let t=[],i=l.value,n=l.key;if(Array.isArray(i)){let d=[],r=[];for(let b in i)i[b].id&&d.includes(i[b].id)&&t.push(new ft(n,i,`all the sprites' ids must be unique, but ${i[b].id} is duplicated`)),d.push(i[b].id),i[b].url&&r.includes(i[b].url)&&t.push(new ft(n,i,`all the sprites' URLs must be unique, but ${i[b].url} is duplicated`)),r.push(i[b].url),t=t.concat(Xa({key:`${n}[${b}]`,value:i[b],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:l.validateSpec}));return t}return Nd({key:n,value:i})}function Y0(l){return t=l.value,t&&t.constructor===Object?[]:[new ft(l.key,l.value,`object expected, ${_e(l.value)} found`)];var t}let x0={"*":()=>[],array:Pc,boolean:function(l){let t=l.value,i=l.key,n=_e(t);return n!=="boolean"?[new ft(i,t,`boolean expected, ${n} found`)]:[]},number:Ad,color:ls,constants:is,enum:Kc,filter:as,function:G0,layer:I0,object:Xa,source:U0,light:os,sky:rs,terrain:Vc,projection:function(l){let t=l.value,i=l.styleSpec,n=i.projection,d=l.style,r=_e(t);if(t===void 0)return[];if(r!=="object")return[new ft("projection",t,`object expected, ${r} found`)];let b=[];for(let h in t)b=b.concat(n[h]?l.validateSpec({key:h,value:t[h],valueSpec:n[h],style:d,styleSpec:i}):[new ft(h,t[h],`unknown property "${h}"`)]);return b},projectionDefinition:function(l){let t=l.key,i=l.value;i=i instanceof String?i.valueOf():i;let n=_e(i);return n!=="array"||(function(d){return Array.isArray(d)&&d.length===3&&typeof d[0]=="string"&&typeof d[1]=="string"&&typeof d[2]=="number"})(i)||(function(d){return!!["interpolate","step","literal"].includes(d[0])})(i)?["array","string"].includes(n)?[]:[new ft(t,i,`projection expected, invalid type "${n}" found`)]:[new ft(t,i,`projection expected, invalid array ${JSON.stringify(i)} found`)]},string:Nd,formatted:function(l){return Nd(l).length===0?[]:pc(l)},resolvedImage:function(l){return Nd(l).length===0?[]:pc(l)},padding:function(l){let t=l.key,i=l.value;if(_e(i)==="array"){if(i.length<1||i.length>4)return[new ft(t,i,`padding requires 1 to 4 values; ${i.length} values found`)];let n={type:"number"},d=[];for(let r=0;r<i.length;r++)d=d.concat(l.validateSpec({key:`${t}[${r}]`,value:i[r],validateSpec:l.validateSpec,valueSpec:n}));return d}return Ad({key:t,value:i,valueSpec:{}})},numberArray:function(l){let t=l.key,i=l.value;if(_e(i)==="array"){let n={type:"number"};if(i.length<1)return[new ft(t,i,"array length at least 1 expected, length 0 found")];let d=[];for(let r=0;r<i.length;r++)d=d.concat(l.validateSpec({key:`${t}[${r}]`,value:i[r],validateSpec:l.validateSpec,valueSpec:n}));return d}return Ad({key:t,value:i,valueSpec:{}})},colorArray:function(l){let t=l.key,i=l.value;if(_e(i)==="array"){if(i.length<1)return[new ft(t,i,"array length at least 1 expected, length 0 found")];let n=[];for(let d=0;d<i.length;d++)n=n.concat(ls({key:`${t}[${d}]`,value:i[d]}));return n}return ls({key:t,value:i})},variableAnchorOffsetCollection:function(l){let t=l.key,i=l.value,n=_e(i),d=l.styleSpec;if(n!=="array"||i.length<1||i.length%2!=0)return[new ft(t,i,"variableAnchorOffsetCollection requires a non-empty array of even length")];let r=[];for(let b=0;b<i.length;b+=2)r=r.concat(Kc({key:`${t}[${b}]`,value:i[b],valueSpec:d.layout_symbol["text-anchor"]})),r=r.concat(Pc({key:`${t}[${b+1}]`,value:i[b+1],valueSpec:{length:2,value:"number"},validateSpec:l.validateSpec,style:l.style,styleSpec:d}));return r},sprite:M0,state:Y0};function nr(l){let t=l.value,i=l.valueSpec,n=l.styleSpec;return l.validateSpec=nr,i.expression&&Oo(Ei(t))?G0(l):i.expression&&Po(td(t))?pc(l):i.type&&x0[i.type]?x0[i.type](l):Xa(oi({},l,{valueSpec:i.type?n[i.type]:i}))}function T0(l){let t=l.value,i=l.key,n=Nd(l);return n.length||(t.indexOf("{fontstack}")===-1&&n.push(new ft(i,t,'"glyphs" url must include a "{fontstack}" token')),t.indexOf("{range}")===-1&&n.push(new ft(i,t,'"glyphs" url must include a "{range}" token'))),n}function tn(l,t=K){let i=[];return i=i.concat(nr({key:"",value:l,valueSpec:t.$root,styleSpec:t,style:l,validateSpec:nr,objectElementValidators:{glyphs:T0,"*":()=>[]}})),l.constants&&(i=i.concat(is({key:"constants",value:l.constants}))),gc(i)}function Va(l){return function(t){return l(Object.assign({},t,{validateSpec:nr}))}}function gc(l){return[].concat(l).sort(((t,i)=>t.line-i.line))}function _i(l){return function(...t){return gc(l.apply(this,t))}}tn.source=_i(Va(U0)),tn.sprite=_i(Va(M0)),tn.glyphs=_i(Va(T0)),tn.light=_i(Va(os)),tn.sky=_i(Va(rs)),tn.terrain=_i(Va(Vc)),tn.state=_i(Va(Y0)),tn.layer=_i(Va(I0)),tn.filter=_i(Va(as)),tn.paintProperty=_i(Va(ds)),tn.layoutProperty=_i(Va(qc));let $c=K,wd=tn,qb=wd.light,$b=wd.sky,to=wd.paintProperty,X0=wd.layoutProperty;function dr(l,t){let i=!1;if(t&&t.length)for(let n of t)l.fire(new rt(new Error(n.message))),i=!0;return i}class eo{constructor(t,i,n){let d=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;let b=new Int32Array(this.arrayBuffer);t=b[0],this.d=(i=b[1])+2*(n=b[2]);for(let V=0;V<this.d*this.d;V++){let R=b[3+V],N=b[3+V+1];d.push(R===N?null:b.subarray(R,N))}let h=b[3+d.length+1];this.keys=b.subarray(b[3+d.length],h),this.bboxes=b.subarray(h),this.insert=this._insertReadonly}else{this.d=i+2*n;for(let b=0;b<this.d*this.d;b++)d.push([]);this.keys=[],this.bboxes=[]}this.n=i,this.extent=t,this.padding=n,this.scale=i/t,this.uid=0;let r=n/i*t;this.min=-r,this.max=t+r}insert(t,i,n,d,r){this._forEachCell(i,n,d,r,this._insertCell,this.uid++,void 0,void 0),this.keys.push(t),this.bboxes.push(i),this.bboxes.push(n),this.bboxes.push(d),this.bboxes.push(r)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(t,i,n,d,r,b){this.cells[r].push(b)}query(t,i,n,d,r){let b=this.min,h=this.max;if(t<=b&&i<=b&&h<=n&&h<=d&&!r)return Array.prototype.slice.call(this.keys);{let V=[];return this._forEachCell(t,i,n,d,this._queryCell,V,{},r),V}}_queryCell(t,i,n,d,r,b,h,V){let R=this.cells[r];if(R!==null){let N=this.keys,M=this.bboxes;for(let J=0;J<R.length;J++){let S=R[J];if(h[S]===void 0){let C=4*S;(V?V(M[C+0],M[C+1],M[C+2],M[C+3]):t<=M[C+2]&&i<=M[C+3]&&n>=M[C+0]&&d>=M[C+1])?(h[S]=!0,b.push(N[S])):h[S]=!1}}}}_forEachCell(t,i,n,d,r,b,h,V){let R=this._convertToCellCoord(t),N=this._convertToCellCoord(i),M=this._convertToCellCoord(n),J=this._convertToCellCoord(d);for(let S=R;S<=M;S++)for(let C=N;C<=J;C++){let L=this.d*C+S;if((!V||V(this._convertFromCellCoord(S),this._convertFromCellCoord(C),this._convertFromCellCoord(S+1),this._convertFromCellCoord(C+1)))&&r.call(this,t,i,n,d,L,b,h,V))return}}_convertFromCellCoord(t){return(t-this.padding)/this.scale}_convertToCellCoord(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;let t=this.cells,i=3+this.cells.length+1+1,n=0;for(let b=0;b<this.cells.length;b++)n+=this.cells[b].length;let d=new Int32Array(i+n+this.keys.length+this.bboxes.length);d[0]=this.extent,d[1]=this.n,d[2]=this.padding;let r=i;for(let b=0;b<t.length;b++){let h=t[b];d[3+b]=r,d.set(h,r),r+=h.length}return d[3+t.length]=r,d.set(this.keys,r),r+=this.keys.length,d[3+t.length+1]=r,d.set(this.bboxes,r),r+=this.bboxes.length,d.buffer}static serialize(t,i){let n=t.toArrayBuffer();return i&&i.push(n),{buffer:n}}static deserialize(t){return new eo(t.buffer)}}let Wn={};function ne(l,t,i={}){if(Wn[l])throw new Error(`${l} is already registered.`);Object.defineProperty(t,"_classRegistryKey",{value:l,writeable:!1}),Wn[l]={klass:t,omit:i.omit||[],shallow:i.shallow||[]}}ne("Object",Object),ne("Set",Set),ne("TransferableGridIndex",eo),ne("Color",Ee),ne("Error",Error),ne("AJAXError",zl),ne("ResolvedImage",ta),ne("StylePropertyFunction",$o),ne("StyleExpression",_o,{omit:["_evaluator"]}),ne("ZoomDependentExpression",qo),ne("ZoomConstantExpression",jd),ne("CompoundExpression",Oi,{omit:["_evaluate"]});for(let l in Il)Il[l]._classRegistryKey||ne(`Expression_${l}`,Il[l]);function uc(l){return l&&typeof ArrayBuffer<"u"&&(l instanceof ArrayBuffer||l.constructor&&l.constructor.name==="ArrayBuffer")}function ss(l){return l.$name||l.constructor._classRegistryKey}function J0(l){return!(function(t){if(t===null||typeof t!="object")return!1;let i=ss(t);return!(!i||i==="Object")})(l)&&(l==null||typeof l=="boolean"||typeof l=="number"||typeof l=="string"||l instanceof Boolean||l instanceof Number||l instanceof String||l instanceof Date||l instanceof RegExp||l instanceof Blob||l instanceof Error||uc(l)||Tl(l)||ArrayBuffer.isView(l)||l instanceof ImageData)}function io(l,t){if(J0(l))return(uc(l)||Tl(l))&&t&&t.push(l),ArrayBuffer.isView(l)&&t&&t.push(l.buffer),l instanceof ImageData&&t&&t.push(l.data.buffer),l;if(Array.isArray(l)){let r=[];for(let b of l)r.push(io(b,t));return r}if(typeof l!="object")throw new Error("can't serialize object of type "+typeof l);let i=ss(l);if(!i)throw new Error(`can't serialize object of unregistered class ${l.constructor.name}`);if(!Wn[i])throw new Error(`${i} is not registered.`);let{klass:n}=Wn[i],d=n.serialize?n.serialize(l,t):{};if(n.serialize){if(t&&d===t[t.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(let r in l){if(!l.hasOwnProperty(r)||Wn[i].omit.indexOf(r)>=0)continue;let b=l[r];d[r]=Wn[i].shallow.indexOf(r)>=0?b:io(b,t)}l instanceof Error&&(d.message=l.message)}if(d.$name)throw new Error("$name property is reserved for worker serialization logic.");return i!=="Object"&&(d.$name=i),d}function ed(l){if(J0(l))return l;if(Array.isArray(l))return l.map(ed);if(typeof l!="object")throw new Error("can't deserialize object of type "+typeof l);let t=ss(l)||"Object";if(!Wn[t])throw new Error(`can't deserialize unregistered class ${t}`);let{klass:i}=Wn[t];if(!i)throw new Error(`can't deserialize unregistered class ${t}`);if(i.deserialize)return i.deserialize(l);let n=Object.create(i.prototype);for(let d of Object.keys(l)){if(d==="$name")continue;let r=l[d];n[d]=Wn[t].shallow.indexOf(d)>=0?r:ed(r)}return n}class bs{constructor(){this.first=!0}update(t,i){let n=Math.floor(t);return this.first?(this.first=!1,this.lastIntegerZoom=n,this.lastIntegerZoomTime=0,this.lastZoom=t,this.lastFloorZoom=n,!0):(this.lastFloorZoom>n?(this.lastIntegerZoom=n+1,this.lastIntegerZoomTime=i):this.lastFloorZoom<n&&(this.lastIntegerZoom=n,this.lastIntegerZoomTime=i),t!==this.lastZoom&&(this.lastZoom=t,this.lastFloorZoom=n,!0))}}function tm(l){return/[\u02EA\u02EB\u2E80-\u2FDF\u2FF0-\u303F\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FD-\u30FF\u3105-\u312F\u31A0-\u4DBF\u4E00-\uA48C\uA490-\uA4C6\uF900-\uFA6D\uFA70-\uFAD9\uFE10-\uFE1F\uFE30-\uFE4F\uFF00-\uFFEF]|\uD81B[\uDFE0-\uDFFF]|[\uD81C-\uD822\uD840-\uD868\uD86A-\uD86D\uD86F-\uD872\uD874-\uD879\uD880-\uD883\uD885-\uD88C][\uDC00-\uDFFF]|\uD823[\uDC00-\uDCD5\uDCFF-\uDD1E\uDD80-\uDDF2]|\uD82B[\uDFF0-\uDFFF]|\uD82C[\uDC00-\uDEFB]|\uD83C[\uDE00-\uDEFF]|\uD869[\uDC00-\uDEDF\uDF00-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEAD\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0\uDFF0-\uDFFF]|\uD87B[\uDC00-\uDE5D]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A\uDF50-\uDFFF]|\uD88D[\uDC00-\uDC79]/gim.test(String.fromCodePoint(l))}function Rc(l){return/[\u02EA\u02EB\u1100-\u11FF\u1400-\u167F\u18B0-\u18F5\u2E80-\u2E99\u2E9B-\u2EF3\u2F00-\u2FD5\u2FF0-\u3007\u3012\u3013\u3020-\u302F\u3031-\u303F\u3041-\u3096\u309D-\u30FB\u30FD-\u30FF\u3105-\u312F\u3131-\u318E\u3190-\uA48C\uA490-\uA4C6\uA960-\uA97C\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFE10-\uFE1F\uFE30-\uFE48\uFE50-\uFE57\uFE5F-\uFE62\uFE67-\uFE6F\uFF00-\uFF07\uFF0A-\uFF0C\uFF0E-\uFF19\uFF1F-\uFF3A\uFF3C\uFF3E\uFF40-\uFF5A\uFFE0-\uFFE2\uFFE4-\uFFE7]|\uD802[\uDD80-\uDD9F]|\uD805[\uDD80-\uDDFF]|\uD806[\uDE00-\uDEBF]|\uD811[\uDC00-\uDE7F]|\uD81B[\uDFE0-\uDFE4\uDFF0-\uDFF6]|[\uD81C-\uD822\uD83D\uD840-\uD868\uD86A-\uD86D\uD86F-\uD872\uD874-\uD879\uD880-\uD883\uD885-\uD88C][\uDC00-\uDFFF]|\uD823[\uDC00-\uDCD5\uDCFF-\uDD1E\uDD80-\uDDF2]|\uD82B[\uDFF0-\uDFF3\uDFF5-\uDFFB\uDFFD\uDFFE]|\uD82C[\uDC00-\uDD22\uDD30-\uDEFB]|\uD833[\uDEC0-\uDFCF]|\uD834[\uDC00-\uDDFF\uDEE0-\uDF7F]|\uD836[\uDC00-\uDEAF]|\uD83C[\uDC00-\uDE00\uDF00-\uDFFF]|\uD83E[\uDD00-\uDEFF]|\uD869[\uDC00-\uDEDF\uDF00-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEAD\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0\uDFF0-\uDFFF]|\uD87B[\uDC00-\uDE5D]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A\uDF50-\uDFFF]|\uD88D[\uDC00-\uDC79]/gim.test(String.fromCodePoint(l))}function y0(l){return/\s/u.test(String.fromCodePoint(l))}function lo(l){for(let t of l)if(Rc(t.codePointAt(0)))return!0;return!1}function cr(l){for(let t of l)if(!S0(t.codePointAt(0)))return!1;return!0}function ms(l){let t=l.map((i=>{try{return new RegExp(`\\p{sc=${i}}`,"u").source}catch{return null}})).filter((i=>i));return new RegExp(t.join("|"),"u")}let B0=ms(["Arab","Dupl","Mong","Ougr","Syrc"]);function S0(l){return!B0.test(String.fromCodePoint(l))}function Ws(l){return!(Rc(l)||(t=l,/[\xA7\xA9\xAE\xB1\xBC-\xBE\xD7\xF7\u2016\u2020\u2021\u2030\u2031\u203B\u203C\u2042\u2047-\u2049\u2051\u2100-\u218F\u221E\u2234\u2235\u2300-\u2307\u230C-\u231F\u2324-\u2328\u232B\u237D-\u239A\u23BE-\u23CD\u23CF\u23D1-\u23DB\u23E2-\u2422\u2424-\u24FF\u25A0-\u2619\u2620-\u2767\u2776-\u2793\u2B12-\u2B2F\u2B50-\u2B59\u2BB8-\u2BEB\u3000-\u303F\u30A0-\u30FF\uE000-\uF8FF\uFE30-\uFE6F\uFF00-\uFFEF\uFFFC\uFFFD]|[\uDB80-\uDBFF][\uDC00-\uDFFF]/gim.test(String.fromCodePoint(t))));var t}let hs=ms(["Adlm","Arab","Armi","Avst","Chrs","Cprt","Egyp","Elym","Gara","Hatr","Hebr","Hung","Khar","Lydi","Mand","Mani","Mend","Merc","Mero","Narb","Nbat","Nkoo","Orkh","Palm","Phli","Phlp","Phnx","Prti","Rohg","Samr","Sarb","Sogo","Syrc","Thaa","Todr","Yezi"]);function Zs(l){return hs.test(String.fromCodePoint(l))}function em(l,t){return!(!t&&Zs(l)||/[\u0900-\u0DFF\u0F00-\u109F\u1780-\u17FF]/gim.test(String.fromCodePoint(l)))}function C0(l){for(let t of l)if(Zs(t.codePointAt(0)))return!0;return!1}let Id=new class{constructor(){this.TIMEOUT=5e3,this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null,this.loadScriptResolve=()=>{}}setState(l){this.pluginStatus=l.pluginStatus,this.pluginURL=l.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(l){if(Id.isParsed())throw new Error("RTL text plugin already registered.");this.applyArabicShaping=l.applyArabicShaping,this.processBidirectionalText=l.processBidirectionalText,this.processStyledBidirectionalText=l.processStyledBidirectionalText,this.loadScriptResolve()}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getRTLTextPluginStatus(){return this.pluginStatus}syncState(l,t){return o(this,void 0,void 0,(function*(){if(this.isParsed())return this.getState();if(l.pluginStatus!=="loading")return this.setState(l),l;let i=l.pluginURL,n=new Promise((r=>{this.loadScriptResolve=r}));t(i);let d=new Promise((r=>setTimeout((()=>r()),this.TIMEOUT)));if(yield Promise.race([n,d]),this.isParsed()){let r={pluginStatus:"loaded",pluginURL:i};return this.setState(r),r}throw this.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${i}`)}))}};class Vi{constructor(t,i){this.isSupportedScript=im,this.zoom=t,i?(this.now=i.now||0,this.fadeDuration=i.fadeDuration||0,this.zoomHistory=i.zoomHistory||new bs,this.transition=i.transition||{}):(this.now=0,this.fadeDuration=0,this.zoomHistory=new bs,this.transition={})}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){let t=this.zoom,i=t-Math.floor(t),n=this.crossFadingFactor();return t>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:i+(1-i)*n}:{fromScale:.5,toScale:1,t:1-(1-n)*i}}}function im(l){return(function(t,i){for(let n of t)if(!em(n.codePointAt(0),i))return!1;return!0})(l,Id.getRTLTextPluginStatus()==="loaded")}let ao="-transition";class no{constructor(t,i,n){this.property=t,this.value=i,this.expression=(function(d,r,b){if(Oo(d))return new $o(d,r);if(Po(d)){let h=V0(d,r,b);if(h.result==="error")throw new Error(h.value.map((V=>`${V.key}: ${V.message}`)).join(", "));return h.value}{let h=d;return r.type==="color"&&typeof d=="string"?h=Ee.parse(d):r.type!=="padding"||typeof d!="number"&&!Array.isArray(d)?r.type!=="numberArray"||typeof d!="number"&&!Array.isArray(d)?r.type!=="colorArray"||typeof d!="string"&&!Array.isArray(d)?r.type==="variableAnchorOffsetCollection"&&Array.isArray(d)?h=wl.parse(d):r.type==="projectionDefinition"&&typeof d=="string"&&(h=Jl.parse(d)):h=rl.parse(d):h=Gl.parse(d):h=Xl.parse(d),{globalStateRefs:new Set,_globalState:null,kind:"constant",evaluate:()=>h}}})(i===void 0?t.specification.default:i,t.specification,n)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}getGlobalStateRefs(){return this.expression.globalStateRefs||new Set}possiblyEvaluate(t,i,n){return this.property.possiblyEvaluate(this,t,i,n)}}class ps{constructor(t,i){this.property=t,this.value=new no(t,void 0,i)}transitioned(t,i){return new Vs(this.property,this.value,i,ki({},t.transition,this.transition),t.now)}untransitioned(){return new Vs(this.property,this.value,null,{},0)}}class k0{constructor(t,i){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues),this._globalState=i}getValue(t){return Pl(this._values[t].value.value)}setValue(t,i){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new ps(this._values[t].property,this._globalState)),this._values[t].value=new no(this._values[t].property,i===null?void 0:Pl(i),this._globalState)}getTransition(t){return Pl(this._values[t].transition)}setTransition(t,i){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new ps(this._values[t].property,this._globalState)),this._values[t].transition=Pl(i)||void 0}serialize(){let t={};for(let i of Object.keys(this._values)){let n=this.getValue(i);n!==void 0&&(t[i]=n);let d=this.getTransition(i);d!==void 0&&(t[`${i}${ao}`]=d)}return t}transitioned(t,i){let n=new gs(this._properties);for(let d of Object.keys(this._values))n._values[d]=this._values[d].transitioned(t,i._values[d]);return n}untransitioned(){let t=new gs(this._properties);for(let i of Object.keys(this._values))t._values[i]=this._values[i].untransitioned();return t}}class Vs{constructor(t,i,n,d,r){this.property=t,this.value=i,this.begin=r+d.delay||0,this.end=this.begin+d.duration||0,t.specification.transition&&(d.delay||d.duration)&&(this.prior=n)}possiblyEvaluate(t,i,n){let d=t.now||0,r=this.value.possiblyEvaluate(t,i,n),b=this.prior;if(b){if(d>this.end)return this.prior=null,r;if(this.value.isDataDriven())return this.prior=null,r;if(d<this.begin)return b.possiblyEvaluate(t,i,n);{let h=(d-this.begin)/(this.end-this.begin);return this.property.interpolate(b.possiblyEvaluate(t,i,n),r,dn(h))}}return r}}class gs{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)}possiblyEvaluate(t,i,n){let d=new vd(this._properties);for(let r of Object.keys(this._values))d._values[r]=this._values[r].possiblyEvaluate(t,i,n);return d}hasTransition(){for(let t of Object.keys(this._values))if(this._values[t].prior)return!0;return!1}}class Q0{constructor(t,i){this._properties=t,this._values=Object.create(t.defaultPropertyValues),this._globalState=i}hasValue(t){return this._values[t].value!==void 0}getValue(t){return Pl(this._values[t].value)}setValue(t,i){this._values[t]=new no(this._values[t].property,i===null?void 0:Pl(i),this._globalState)}serialize(){let t={};for(let i of Object.keys(this._values)){let n=this.getValue(i);n!==void 0&&(t[i]=n)}return t}possiblyEvaluate(t,i,n){let d=new vd(this._properties);for(let r of Object.keys(this._values))d._values[r]=this._values[r].possiblyEvaluate(t,i,n);return d}}class hn{constructor(t,i,n){this.property=t,this.value=i,this.parameters=n}isConstant(){return this.value.kind==="constant"}constantOr(t){return this.value.kind==="constant"?this.value.value:t}evaluate(t,i,n,d){return this.property.evaluate(this.value,this.parameters,t,i,n,d)}}class vd{constructor(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)}get(t){return this._values[t]}}class me{constructor(t){this.specification=t}possiblyEvaluate(t,i){if(t.isDataDriven())throw new Error("Value should not be data driven");return t.expression.evaluate(i)}interpolate(t,i,n){let d=Gt[this.specification.type];return d?d(t,i,n):t}}class Re{constructor(t,i){this.specification=t,this.overrides=i}possiblyEvaluate(t,i,n,d){return new hn(this,t.expression.kind==="constant"||t.expression.kind==="camera"?{kind:"constant",value:t.expression.evaluate(i,null,{},n,d)}:t.expression,i)}interpolate(t,i,n){if(t.value.kind!=="constant"||i.value.kind!=="constant")return t;if(t.value.value===void 0||i.value.value===void 0)return new hn(this,{kind:"constant",value:void 0},t.parameters);let d=Gt[this.specification.type];if(d){let r=d(t.value.value,i.value.value,n);return new hn(this,{kind:"constant",value:r},t.parameters)}return t}evaluate(t,i,n,d,r,b){return t.kind==="constant"?t.value:t.evaluate(i,n,d,r,b)}}class co extends Re{possiblyEvaluate(t,i,n,d){if(t.value===void 0)return new hn(this,{kind:"constant",value:void 0},i);if(t.expression.kind==="constant"){let r=t.expression.evaluate(i,null,{},n,d),b=t.property.specification.type==="resolvedImage"&&typeof r!="string"?r.name:r,h=this._calculate(b,b,b,i);return new hn(this,{kind:"constant",value:h},i)}if(t.expression.kind==="camera"){let r=this._calculate(t.expression.evaluate({zoom:i.zoom-1}),t.expression.evaluate({zoom:i.zoom}),t.expression.evaluate({zoom:i.zoom+1}),i);return new hn(this,{kind:"constant",value:r},i)}return new hn(this,t.expression,i)}evaluate(t,i,n,d,r,b){if(t.kind==="source"){let h=t.evaluate(i,n,d,r,b);return this._calculate(h,h,h,i)}return t.kind==="composite"?this._calculate(t.evaluate({zoom:Math.floor(i.zoom)-1},n,d),t.evaluate({zoom:Math.floor(i.zoom)},n,d),t.evaluate({zoom:Math.floor(i.zoom)+1},n,d),i):t.value}_calculate(t,i,n,d){return d.zoom>d.zoomHistory.lastIntegerZoom?{from:t,to:i}:{from:n,to:i}}interpolate(t){return t}}class L0{constructor(t){this.specification=t}possiblyEvaluate(t,i,n,d){if(t.value!==void 0){if(t.expression.kind==="constant"){let r=t.expression.evaluate(i,null,{},n,d);return this._calculate(r,r,r,i)}return this._calculate(t.expression.evaluate(new Vi(Math.floor(i.zoom-1),i)),t.expression.evaluate(new Vi(Math.floor(i.zoom),i)),t.expression.evaluate(new Vi(Math.floor(i.zoom+1),i)),i)}}_calculate(t,i,n,d){return d.zoom>d.zoomHistory.lastIntegerZoom?{from:t,to:i}:{from:n,to:i}}interpolate(t){return t}}class oo{constructor(t){this.specification=t}possiblyEvaluate(t,i,n,d){return!!t.expression.evaluate(i,null,{},n,d)}interpolate(){return!1}}class ia{constructor(t){this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(let i in t){let n=t[i];n.specification.overridable&&this.overridableProperties.push(i);let d=this.defaultPropertyValues[i]=new no(n,void 0,void 0),r=this.defaultTransitionablePropertyValues[i]=new ps(n,void 0);this.defaultTransitioningPropertyValues[i]=r.untransitioned(),this.defaultPossiblyEvaluatedValues[i]=d.possiblyEvaluate({})}}}ne("DataDrivenProperty",Re),ne("DataConstantProperty",me),ne("CrossFadedDataDrivenProperty",co),ne("CrossFadedProperty",L0),ne("ColorRampProperty",oo);class en extends Nt{constructor(t,i,n){if(super(),this.id=t.id,this.type=t.type,this._globalState=n,this._featureFilter={filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set},t.type!=="custom"&&(this.metadata=t.metadata,this.minzoom=t.minzoom,this.maxzoom=t.maxzoom,t.type!=="background"&&(this.source=t.source,this.sourceLayer=t["source-layer"],this.filter=t.filter,this._featureFilter=Oc(t.filter,n)),i.layout&&(this._unevaluatedLayout=new Q0(i.layout,n)),i.paint)){this._transitionablePaint=new k0(i.paint,n);for(let d in t.paint)this.setPaintProperty(d,t.paint[d],{validate:!1});for(let d in t.layout)this.setLayoutProperty(d,t.layout[d],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new vd(i.paint)}}setFilter(t){this.filter=t,this._featureFilter=Oc(t,this._globalState)}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(t){return t==="visibility"?this.visibility:this._unevaluatedLayout.getValue(t)}getLayoutAffectingGlobalStateRefs(){let t=new Set;if(this._unevaluatedLayout)for(let i in this._unevaluatedLayout._values){let n=this._unevaluatedLayout._values[i];for(let d of n.getGlobalStateRefs())t.add(d)}for(let i of this._featureFilter.getGlobalStateRefs())t.add(i);return t}getPaintAffectingGlobalStateRefs(){var t;let i=new globalThis.Map;if(this._transitionablePaint)for(let n in this._transitionablePaint._values){let d=this._transitionablePaint._values[n].value;for(let r of d.getGlobalStateRefs()){let b=(t=i.get(r))!==null&&t!==void 0?t:[];b.push({name:n,value:d.value}),i.set(r,b)}}return i}setLayoutProperty(t,i,n={}){i!=null&&this._validate(X0,`layers.${this.id}.layout.${t}`,t,i,n)||(t!=="visibility"?this._unevaluatedLayout.setValue(t,i):this.visibility=i)}getPaintProperty(t){return t.endsWith(ao)?this._transitionablePaint.getTransition(t.slice(0,-11)):this._transitionablePaint.getValue(t)}setPaintProperty(t,i,n={}){if(i!=null&&this._validate(to,`layers.${this.id}.paint.${t}`,t,i,n))return!1;if(t.endsWith(ao))return this._transitionablePaint.setTransition(t.slice(0,-11),i||void 0),!1;{let d=this._transitionablePaint._values[t],r=d.property.specification["property-type"]==="cross-faded-data-driven",b=d.value.isDataDriven(),h=d.value;this._transitionablePaint.setValue(t,i),this._handleSpecialPaintPropertyUpdate(t);let V=this._transitionablePaint._values[t].value;return V.isDataDriven()||b||r||this._handleOverridablePaintPropertyUpdate(t,h,V)}}_handleSpecialPaintPropertyUpdate(t){}_handleOverridablePaintPropertyUpdate(t,i,n){return!1}isHidden(t,i=!1){return!!(this.minzoom&&t<(i?Math.floor(this.minzoom):this.minzoom))||!!(this.maxzoom&&t>=this.maxzoom)||this.visibility==="none"}updateTransitions(t){this._transitioningPaint=this._transitionablePaint.transitioned(t,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(t,i){t.getCrossfadeParameters&&(this._crossfadeParameters=t.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(t,void 0,i)),this.paint=this._transitioningPaint.possiblyEvaluate(t,void 0,i)}serialize(){let t={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(t.layout=t.layout||{},t.layout.visibility=this.visibility),$i(t,((i,n)=>!(i===void 0||n==="layout"&&!Object.keys(i).length||n==="paint"&&!Object.keys(i).length)))}_validate(t,i,n,d,r={}){return(!r||r.validate!==!1)&&dr(this,t.call(wd,{key:i,layerType:this.type,objectKey:n,value:d,styleSpec:K,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(let t in this.paint._values){let i=this.paint.get(t);if(i instanceof hn&&hc(i.property.specification)&&(i.value.kind==="source"||i.value.kind==="composite")&&i.value.isStateDependent)return!0}return!1}}let E0;var lm={get paint(){return E0=E0||new ia({"raster-opacity":new me(K.paint_raster["raster-opacity"]),"raster-hue-rotate":new me(K.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new me(K.paint_raster["raster-brightness-min"]),"raster-brightness-max":new me(K.paint_raster["raster-brightness-max"]),"raster-saturation":new me(K.paint_raster["raster-saturation"]),"raster-contrast":new me(K.paint_raster["raster-contrast"]),"raster-resampling":new me(K.paint_raster["raster-resampling"]),"raster-fade-duration":new me(K.paint_raster["raster-fade-duration"])})}};class am extends en{constructor(t,i){super(t,lm,i)}}let nm={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class ro{constructor(t,i){this._structArray=t,this._pos1=i*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class gi{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(t,i){return t._trim(),i&&(t.isTransferred=!0,i.push(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}}static deserialize(t){let i=Object.create(this.prototype);return i.arrayBuffer=t.arrayBuffer,i.length=t.length,i.capacity=t.arrayBuffer.byteLength/i.bytesPerElement,i._refreshViews(),i}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(t){this.reserve(t),this.length=t}reserve(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);let i=this.uint8;this._refreshViews(),i&&this.uint8.set(i)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function ll(l,t=1){let i=0,n=0;return{members:l.map((d=>{let r=nm[d.type].BYTES_PER_ELEMENT,b=i=z0(i,Math.max(t,r)),h=d.components||1;return n=Math.max(n,r),i+=r*h,{name:d.name,type:d.type,components:h,offset:b}})),size:z0(i,Math.max(n,t)),alignment:t}}function z0(l,t){return Math.ceil(l/t)*t}class so extends gi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,i){let n=this.length;return this.resize(n+1),this.emplace(n,t,i)}emplace(t,i,n){let d=2*t;return this.int16[d+0]=i,this.int16[d+1]=n,t}}so.prototype.bytesPerElement=4,ne("StructArrayLayout2i4",so);class bo extends gi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,i,n){let d=this.length;return this.resize(d+1),this.emplace(d,t,i,n)}emplace(t,i,n,d){let r=3*t;return this.int16[r+0]=i,this.int16[r+1]=n,this.int16[r+2]=d,t}}bo.prototype.bytesPerElement=6,ne("StructArrayLayout3i6",bo);class us extends gi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,i,n,d){let r=this.length;return this.resize(r+1),this.emplace(r,t,i,n,d)}emplace(t,i,n,d,r){let b=4*t;return this.int16[b+0]=i,this.int16[b+1]=n,this.int16[b+2]=d,this.int16[b+3]=r,t}}us.prototype.bytesPerElement=8,ne("StructArrayLayout4i8",us);class Rs extends gi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,i,n,d,r,b){let h=this.length;return this.resize(h+1),this.emplace(h,t,i,n,d,r,b)}emplace(t,i,n,d,r,b,h){let V=6*t;return this.int16[V+0]=i,this.int16[V+1]=n,this.int16[V+2]=d,this.int16[V+3]=r,this.int16[V+4]=b,this.int16[V+5]=h,t}}Rs.prototype.bytesPerElement=12,ne("StructArrayLayout2i4i12",Rs);class id extends gi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,i,n,d,r,b){let h=this.length;return this.resize(h+1),this.emplace(h,t,i,n,d,r,b)}emplace(t,i,n,d,r,b,h){let V=4*t,R=8*t;return this.int16[V+0]=i,this.int16[V+1]=n,this.uint8[R+4]=d,this.uint8[R+5]=r,this.uint8[R+6]=b,this.uint8[R+7]=h,t}}id.prototype.bytesPerElement=8,ne("StructArrayLayout2i4ub8",id);class Fc extends gi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i){let n=this.length;return this.resize(n+1),this.emplace(n,t,i)}emplace(t,i,n){let d=2*t;return this.float32[d+0]=i,this.float32[d+1]=n,t}}Fc.prototype.bytesPerElement=8,ne("StructArrayLayout2f8",Fc);class mo extends gi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,i,n,d,r,b,h,V,R,N){let M=this.length;return this.resize(M+1),this.emplace(M,t,i,n,d,r,b,h,V,R,N)}emplace(t,i,n,d,r,b,h,V,R,N,M){let J=10*t;return this.uint16[J+0]=i,this.uint16[J+1]=n,this.uint16[J+2]=d,this.uint16[J+3]=r,this.uint16[J+4]=b,this.uint16[J+5]=h,this.uint16[J+6]=V,this.uint16[J+7]=R,this.uint16[J+8]=N,this.uint16[J+9]=M,t}}mo.prototype.bytesPerElement=20,ne("StructArrayLayout10ui20",mo);class or extends gi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,i,n,d,r,b,h,V){let R=this.length;return this.resize(R+1),this.emplace(R,t,i,n,d,r,b,h,V)}emplace(t,i,n,d,r,b,h,V,R){let N=8*t;return this.uint16[N+0]=i,this.uint16[N+1]=n,this.uint16[N+2]=d,this.uint16[N+3]=r,this.uint16[N+4]=b,this.uint16[N+5]=h,this.uint16[N+6]=V,this.uint16[N+7]=R,t}}or.prototype.bytesPerElement=16,ne("StructArrayLayout8ui16",or);class Wo extends gi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,i,n,d,r,b,h,V,R,N,M,J){let S=this.length;return this.resize(S+1),this.emplace(S,t,i,n,d,r,b,h,V,R,N,M,J)}emplace(t,i,n,d,r,b,h,V,R,N,M,J,S){let C=12*t;return this.int16[C+0]=i,this.int16[C+1]=n,this.int16[C+2]=d,this.int16[C+3]=r,this.uint16[C+4]=b,this.uint16[C+5]=h,this.uint16[C+6]=V,this.uint16[C+7]=R,this.int16[C+8]=N,this.int16[C+9]=M,this.int16[C+10]=J,this.int16[C+11]=S,t}}Wo.prototype.bytesPerElement=24,ne("StructArrayLayout4i4ui4i24",Wo);class Fs extends gi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i,n){let d=this.length;return this.resize(d+1),this.emplace(d,t,i,n)}emplace(t,i,n,d){let r=3*t;return this.float32[r+0]=i,this.float32[r+1]=n,this.float32[r+2]=d,t}}Fs.prototype.bytesPerElement=12,ne("StructArrayLayout3f12",Fs);class Gc extends gi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t){let i=this.length;return this.resize(i+1),this.emplace(i,t)}emplace(t,i){return this.uint32[1*t+0]=i,t}}Gc.prototype.bytesPerElement=4,ne("StructArrayLayout1ul4",Gc);class Hd extends gi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,i,n,d,r,b,h,V,R){let N=this.length;return this.resize(N+1),this.emplace(N,t,i,n,d,r,b,h,V,R)}emplace(t,i,n,d,r,b,h,V,R,N){let M=10*t,J=5*t;return this.int16[M+0]=i,this.int16[M+1]=n,this.int16[M+2]=d,this.int16[M+3]=r,this.int16[M+4]=b,this.int16[M+5]=h,this.uint32[J+3]=V,this.uint16[M+8]=R,this.uint16[M+9]=N,t}}Hd.prototype.bytesPerElement=20,ne("StructArrayLayout6i1ul2ui20",Hd);class Gs extends gi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,i,n,d,r,b){let h=this.length;return this.resize(h+1),this.emplace(h,t,i,n,d,r,b)}emplace(t,i,n,d,r,b,h){let V=6*t;return this.int16[V+0]=i,this.int16[V+1]=n,this.int16[V+2]=d,this.int16[V+3]=r,this.int16[V+4]=b,this.int16[V+5]=h,t}}Gs.prototype.bytesPerElement=12,ne("StructArrayLayout2i2i2i12",Gs);class rr extends gi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,i,n,d,r){let b=this.length;return this.resize(b+1),this.emplace(b,t,i,n,d,r)}emplace(t,i,n,d,r,b){let h=4*t,V=8*t;return this.float32[h+0]=i,this.float32[h+1]=n,this.float32[h+2]=d,this.int16[V+6]=r,this.int16[V+7]=b,t}}rr.prototype.bytesPerElement=16,ne("StructArrayLayout2f1f2i16",rr);class Dd extends gi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,i,n,d,r,b){let h=this.length;return this.resize(h+1),this.emplace(h,t,i,n,d,r,b)}emplace(t,i,n,d,r,b,h){let V=16*t,R=4*t,N=8*t;return this.uint8[V+0]=i,this.uint8[V+1]=n,this.float32[R+1]=d,this.float32[R+2]=r,this.int16[N+6]=b,this.int16[N+7]=h,t}}Dd.prototype.bytesPerElement=16,ne("StructArrayLayout2ub2f2i16",Dd);class sr extends gi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,i,n){let d=this.length;return this.resize(d+1),this.emplace(d,t,i,n)}emplace(t,i,n,d){let r=3*t;return this.uint16[r+0]=i,this.uint16[r+1]=n,this.uint16[r+2]=d,t}}sr.prototype.bytesPerElement=6,ne("StructArrayLayout3ui6",sr);class Ns extends gi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i,n,d,r,b,h,V,R,N,M,J,S,C,L,w,_){let lt=this.length;return this.resize(lt+1),this.emplace(lt,t,i,n,d,r,b,h,V,R,N,M,J,S,C,L,w,_)}emplace(t,i,n,d,r,b,h,V,R,N,M,J,S,C,L,w,_,lt){let P=24*t,tt=12*t,pt=48*t;return this.int16[P+0]=i,this.int16[P+1]=n,this.uint16[P+2]=d,this.uint16[P+3]=r,this.uint32[tt+2]=b,this.uint32[tt+3]=h,this.uint32[tt+4]=V,this.uint16[P+10]=R,this.uint16[P+11]=N,this.uint16[P+12]=M,this.float32[tt+7]=J,this.float32[tt+8]=S,this.uint8[pt+36]=C,this.uint8[pt+37]=L,this.uint8[pt+38]=w,this.uint32[tt+10]=_,this.int16[P+22]=lt,t}}Ns.prototype.bytesPerElement=48,ne("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",Ns);class br extends gi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i,n,d,r,b,h,V,R,N,M,J,S,C,L,w,_,lt,P,tt,pt,Vt,Yt,wt,Qt,Ht,ae,Kt){let qt=this.length;return this.resize(qt+1),this.emplace(qt,t,i,n,d,r,b,h,V,R,N,M,J,S,C,L,w,_,lt,P,tt,pt,Vt,Yt,wt,Qt,Ht,ae,Kt)}emplace(t,i,n,d,r,b,h,V,R,N,M,J,S,C,L,w,_,lt,P,tt,pt,Vt,Yt,wt,Qt,Ht,ae,Kt,qt){let Lt=32*t,Ze=16*t;return this.int16[Lt+0]=i,this.int16[Lt+1]=n,this.int16[Lt+2]=d,this.int16[Lt+3]=r,this.int16[Lt+4]=b,this.int16[Lt+5]=h,this.int16[Lt+6]=V,this.int16[Lt+7]=R,this.uint16[Lt+8]=N,this.uint16[Lt+9]=M,this.uint16[Lt+10]=J,this.uint16[Lt+11]=S,this.uint16[Lt+12]=C,this.uint16[Lt+13]=L,this.uint16[Lt+14]=w,this.uint16[Lt+15]=_,this.uint16[Lt+16]=lt,this.uint16[Lt+17]=P,this.uint16[Lt+18]=tt,this.uint16[Lt+19]=pt,this.uint16[Lt+20]=Vt,this.uint16[Lt+21]=Yt,this.uint16[Lt+22]=wt,this.uint32[Ze+12]=Qt,this.float32[Ze+13]=Ht,this.float32[Ze+14]=ae,this.uint16[Lt+30]=Kt,this.uint16[Lt+31]=qt,t}}br.prototype.bytesPerElement=64,ne("StructArrayLayout8i15ui1ul2f2ui64",br);class mr extends gi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t){let i=this.length;return this.resize(i+1),this.emplace(i,t)}emplace(t,i){return this.float32[1*t+0]=i,t}}mr.prototype.bytesPerElement=4,ne("StructArrayLayout1f4",mr);class m extends gi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i,n){let d=this.length;return this.resize(d+1),this.emplace(d,t,i,n)}emplace(t,i,n,d){let r=3*t;return this.uint16[6*t+0]=i,this.float32[r+1]=n,this.float32[r+2]=d,t}}m.prototype.bytesPerElement=12,ne("StructArrayLayout1ui2f12",m);class e extends gi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,i,n){let d=this.length;return this.resize(d+1),this.emplace(d,t,i,n)}emplace(t,i,n,d){let r=4*t;return this.uint32[2*t+0]=i,this.uint16[r+2]=n,this.uint16[r+3]=d,t}}e.prototype.bytesPerElement=8,ne("StructArrayLayout1ul2ui8",e);class a extends gi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,i){let n=this.length;return this.resize(n+1),this.emplace(n,t,i)}emplace(t,i,n){let d=2*t;return this.uint16[d+0]=i,this.uint16[d+1]=n,t}}a.prototype.bytesPerElement=4,ne("StructArrayLayout2ui4",a);class c extends gi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t){let i=this.length;return this.resize(i+1),this.emplace(i,t)}emplace(t,i){return this.uint16[1*t+0]=i,t}}c.prototype.bytesPerElement=2,ne("StructArrayLayout1ui2",c);class s extends gi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i,n,d){let r=this.length;return this.resize(r+1),this.emplace(r,t,i,n,d)}emplace(t,i,n,d,r){let b=4*t;return this.float32[b+0]=i,this.float32[b+1]=n,this.float32[b+2]=d,this.float32[b+3]=r,t}}s.prototype.bytesPerElement=16,ne("StructArrayLayout4f16",s);class W extends ro{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new st(this.anchorPointX,this.anchorPointY)}}W.prototype.size=20;class Z extends Hd{get(t){return new W(this,t)}}ne("CollisionBoxArray",Z);class u extends ro{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(t){this._structArray.uint8[this._pos1+37]=t}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(t){this._structArray.uint8[this._pos1+38]=t}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(t){this._structArray.uint32[this._pos4+10]=t}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}u.prototype.size=48;class G extends Ns{get(t){return new u(this,t)}}ne("PlacedSymbolArray",G);class U extends ro{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(t){this._structArray.uint32[this._pos4+12]=t}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}U.prototype.size=64;class X extends br{get(t){return new U(this,t)}}ne("SymbolInstanceArray",X);class Q extends mr{getoffsetX(t){return this.float32[1*t+0]}}ne("GlyphOffsetArray",Q);class k extends bo{getx(t){return this.int16[3*t+0]}gety(t){return this.int16[3*t+1]}gettileUnitDistanceFromAnchor(t){return this.int16[3*t+2]}}ne("SymbolLineVertexArray",k);class j extends ro{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}j.prototype.size=12;class H extends m{get(t){return new j(this,t)}}ne("TextAnchorOffsetArray",H);class q extends ro{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}q.prototype.size=8;class $ extends e{get(t){return new q(this,t)}}ne("FeatureIndexArray",$);class et extends so{}class nt extends so{}class mt extends so{}class at extends Rs{}class Wt extends id{}class Zt extends Fc{}class ot extends mo{}class Ft extends or{}class Xt extends Wo{}class It extends Fs{}class Ut extends Gc{}class xt extends Gs{}class $t extends Dd{}class Pt extends sr{}class At extends a{}let se=ll([{name:"a_pos",components:2,type:"Int16"}],4),{members:Ce}=se;class Je{constructor(t=[]){this._forceNewSegmentOnNextPrepare=!1,this.segments=t}prepareSegment(t,i,n,d){let r=this.segments[this.segments.length-1];return t>Je.MAX_VERTEX_ARRAY_LENGTH&&ci(`Max vertices per segment is ${Je.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${t}. Consider using the \`fillLargeMeshArrays\` function if you require meshes with more than ${Je.MAX_VERTEX_ARRAY_LENGTH} vertices.`),this._forceNewSegmentOnNextPrepare||!r||r.vertexLength+t>Je.MAX_VERTEX_ARRAY_LENGTH||r.sortKey!==d?this.createNewSegment(i,n,d):r}createNewSegment(t,i,n){let d={vertexOffset:t.length,primitiveOffset:i.length,vertexLength:0,primitiveLength:0,vaos:{}};return n!==void 0&&(d.sortKey=n),this._forceNewSegmentOnNextPrepare=!1,this.segments.push(d),d}getOrCreateLatestSegment(t,i,n){return this.prepareSegment(0,t,i,n)}forceNewSegmentOnNextPrepare(){this._forceNewSegmentOnNextPrepare=!0}get(){return this.segments}destroy(){for(let t of this.segments)for(let i in t.vaos)t.vaos[i].destroy()}static simpleSegment(t,i,n,d){return new Je([{vertexOffset:t,primitiveOffset:i,vertexLength:n,primitiveLength:d,vaos:{},sortKey:0}])}}function Mi(l,t){return 256*(l=Ci(Math.floor(l),0,255))+Ci(Math.floor(t),0,255)}Je.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,ne("SegmentVector",Je);let Yi=ll([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]),zi=ll([{name:"a_dasharray_from",components:4,type:"Uint16"},{name:"a_dasharray_to",components:4,type:"Uint16"}]);var Ni,pl,Bi,sl={exports:{}},al={exports:{}},bl={exports:{}},Ja=(function(){if(Bi)return sl.exports;Bi=1;var l=(Ni||(Ni=1,al.exports=function(i,n){var d,r,b,h,V,R,N,M;for(r=i.length-(d=3&i.length),b=n,V=3432918353,R=461845907,M=0;M<r;)N=255&i.charCodeAt(M)|(255&i.charCodeAt(++M))<<8|(255&i.charCodeAt(++M))<<16|(255&i.charCodeAt(++M))<<24,++M,b=27492+(65535&(h=5*(65535&(b=(b^=N=(65535&(N=(N=(65535&N)*V+(((N>>>16)*V&65535)<<16)&4294967295)<<15|N>>>17))*R+(((N>>>16)*R&65535)<<16)&4294967295)<<13|b>>>19))+((5*(b>>>16)&65535)<<16)&4294967295))+((58964+(h>>>16)&65535)<<16);switch(N=0,d){case 3:N^=(255&i.charCodeAt(M+2))<<16;case 2:N^=(255&i.charCodeAt(M+1))<<8;case 1:b^=N=(65535&(N=(N=(65535&(N^=255&i.charCodeAt(M)))*V+(((N>>>16)*V&65535)<<16)&4294967295)<<15|N>>>17))*R+(((N>>>16)*R&65535)<<16)&4294967295}return b^=i.length,b=2246822507*(65535&(b^=b>>>16))+((2246822507*(b>>>16)&65535)<<16)&4294967295,b=3266489909*(65535&(b^=b>>>13))+((3266489909*(b>>>16)&65535)<<16)&4294967295,(b^=b>>>16)>>>0}),al.exports),t=(pl||(pl=1,bl.exports=function(i,n){for(var d,r=i.length,b=n^r,h=0;r>=4;)d=1540483477*(65535&(d=255&i.charCodeAt(h)|(255&i.charCodeAt(++h))<<8|(255&i.charCodeAt(++h))<<16|(255&i.charCodeAt(++h))<<24))+((1540483477*(d>>>16)&65535)<<16),b=1540483477*(65535&b)+((1540483477*(b>>>16)&65535)<<16)^(d=1540483477*(65535&(d^=d>>>24))+((1540483477*(d>>>16)&65535)<<16)),r-=4,++h;switch(r){case 3:b^=(255&i.charCodeAt(h+2))<<16;case 2:b^=(255&i.charCodeAt(h+1))<<8;case 1:b=1540483477*(65535&(b^=255&i.charCodeAt(h)))+((1540483477*(b>>>16)&65535)<<16)}return b=1540483477*(65535&(b^=b>>>13))+((1540483477*(b>>>16)&65535)<<16),(b^=b>>>15)>>>0}),bl.exports);return sl.exports=l,sl.exports.murmur3=l,sl.exports.murmur2=t,sl.exports})(),ld=Ct(Ja);class Xn{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(t,i,n,d){this.ids.push(Ud(t)),this.positions.push(i,n,d)}getPositions(t){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");let i=Ud(t),n=0,d=this.ids.length-1;for(;n<d;){let b=n+d>>1;this.ids[b]>=i?d=b:n=b+1}let r=[];for(;this.ids[n]===i;)r.push({index:this.positions[3*n],start:this.positions[3*n+1],end:this.positions[3*n+2]}),n++;return r}static serialize(t,i){let n=new Float64Array(t.ids),d=new Uint32Array(t.positions);return Md(n,d,0,n.length-1),i&&i.push(n.buffer,d.buffer),{ids:n,positions:d}}static deserialize(t){let i=new Xn;return i.ids=t.ids,i.positions=t.positions,i.indexed=!0,i}}function Ud(l){let t=+l;return!isNaN(t)&&t<=Number.MAX_SAFE_INTEGER?t:ld(String(l))}function Md(l,t,i,n){for(;i<n;){let d=l[i+n>>1],r=i-1,b=n+1;for(;;){do r++;while(l[r]<d);do b--;while(l[b]>d);if(r>=b)break;fd(l,r,b),fd(t,3*r,3*b),fd(t,3*r+1,3*b+1),fd(t,3*r+2,3*b+2)}b-i<n-b?(Md(l,t,i,b),i=b+1):(Md(l,t,b+1,n),n=b)}}function fd(l,t,i){let n=l[t];l[t]=l[i],l[i]=n}ne("FeaturePositionMap",Xn);class ln{constructor(t,i){this.gl=t.gl,this.location=i}}class ad extends ln{constructor(t,i){super(t,i),this.current=0}set(t){this.current!==t&&(this.current=t,this.gl.uniform1f(this.location,t))}}class Ea extends ln{constructor(t,i){super(t,i),this.current=[0,0,0,0]}set(t){t[0]===this.current[0]&&t[1]===this.current[1]&&t[2]===this.current[2]&&t[3]===this.current[3]||(this.current=t,this.gl.uniform4f(this.location,t[0],t[1],t[2],t[3]))}}class nd extends ln{constructor(t,i){super(t,i),this.current=Ee.transparent}set(t){t.r===this.current.r&&t.g===this.current.g&&t.b===this.current.b&&t.a===this.current.a||(this.current=t,this.gl.uniform4f(this.location,t.r,t.g,t.b,t.a))}}let Od=new Float32Array(16);function _d(l){return[Mi(255*l.r,255*l.g),Mi(255*l.b,255*l.a)]}class Pi{constructor(t,i,n){this.value=t,this.uniformNames=i.map((d=>`u_${d}`)),this.type=n}setUniform(t,i,n){t.set(n.constantOr(this.value))}getBinding(t,i,n){return this.type==="color"?new nd(t,i):new ad(t,i)}}class ji{constructor(t,i){this.uniformNames=i.map((n=>`u_${n}`)),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(t,i){this.pixelRatioFrom=i.pixelRatio,this.pixelRatioTo=t.pixelRatio,this.patternFrom=i.tlbr,this.patternTo=t.tlbr}setConstantDashPositions(t,i){this.dashTo=[0,t.y,t.height,t.width],this.dashFrom=[0,i.y,i.height,i.width]}setUniform(t,i,n,d){let r=null;d==="u_pattern_to"?r=this.patternTo:d==="u_pattern_from"?r=this.patternFrom:d==="u_dasharray_to"?r=this.dashTo:d==="u_dasharray_from"?r=this.dashFrom:d==="u_pixel_ratio_to"?r=this.pixelRatioTo:d==="u_pixel_ratio_from"&&(r=this.pixelRatioFrom),r!==null&&t.set(r)}getBinding(t,i,n){return n.substr(0,9)==="u_pattern"||n.substr(0,12)==="u_dasharray_"?new Ea(t,i):new ad(t,i)}}class Vl{constructor(t,i,n,d){this.expression=t,this.type=n,this.maxValue=0,this.paintVertexAttributes=i.map((r=>({name:`a_${r}`,type:"Float32",components:n==="color"?2:1,offset:0}))),this.paintVertexArray=new d}populatePaintArray(t,i,n){let d=this.paintVertexArray.length,r=this.expression.evaluate(new Vi(0,n),i,{},n.canonical,[],n.formattedSection);this.paintVertexArray.resize(t),this._setPaintValue(d,t,r)}updatePaintArray(t,i,n,d,r){let b=this.expression.evaluate(new Vi(0,r),n,d);this._setPaintValue(t,i,b)}_setPaintValue(t,i,n){if(this.type==="color"){let d=_d(n);for(let r=t;r<i;r++)this.paintVertexArray.emplace(r,d[0],d[1])}else{for(let d=t;d<i;d++)this.paintVertexArray.emplace(d,n);this.maxValue=Math.max(this.maxValue,Math.abs(n))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Ii{constructor(t,i,n,d,r,b){this.expression=t,this.uniformNames=i.map((h=>`u_${h}_t`)),this.type=n,this.useIntegerZoom=d,this.zoom=r,this.maxValue=0,this.paintVertexAttributes=i.map((h=>({name:`a_${h}`,type:"Float32",components:n==="color"?4:2,offset:0}))),this.paintVertexArray=new b}populatePaintArray(t,i,n){let d=this.expression.evaluate(new Vi(this.zoom,n),i,{},n.canonical,[],n.formattedSection),r=this.expression.evaluate(new Vi(this.zoom+1,n),i,{},n.canonical,[],n.formattedSection),b=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(b,t,d,r)}updatePaintArray(t,i,n,d,r){let b=this.expression.evaluate(new Vi(this.zoom,r),n,d),h=this.expression.evaluate(new Vi(this.zoom+1,r),n,d);this._setPaintValue(t,i,b,h)}_setPaintValue(t,i,n,d){if(this.type==="color"){let r=_d(n),b=_d(d);for(let h=t;h<i;h++)this.paintVertexArray.emplace(h,r[0],r[1],b[0],b[1])}else{for(let r=t;r<i;r++)this.paintVertexArray.emplace(r,n,d);this.maxValue=Math.max(this.maxValue,Math.abs(n),Math.abs(d))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(t,i){let n=this.useIntegerZoom?Math.floor(i.zoom):i.zoom,d=Ci(this.expression.interpolationFactor(n,this.zoom,this.zoom+1),0,1);t.set(d)}getBinding(t,i,n){return new ad(t,i)}}class Yd{constructor(t,i,n,d,r,b){this.expression=t,this.type=i,this.useIntegerZoom=n,this.zoom=d,this.layerId=b,this.zoomInPaintVertexArray=new r,this.zoomOutPaintVertexArray=new r}populatePaintArray(t,i,n){let d=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(t),this.zoomOutPaintVertexArray.resize(t),this._setPaintValues(d,t,this.getPositionIds(i),n)}updatePaintArray(t,i,n,d,r){this._setPaintValues(t,i,this.getPositionIds(n),r)}_setPaintValues(t,i,n,d){let r=this.getPositions(d);if(!r||!n)return;let b=r[n.min],h=r[n.mid],V=r[n.max];if(b&&h&&V)for(let R=t;R<i;R++)this.emplace(this.zoomInPaintVertexArray,R,h,b),this.emplace(this.zoomOutPaintVertexArray,R,h,V)}upload(t){if(this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer){let i=this.getVertexAttributes();this.zoomInPaintVertexBuffer=t.createVertexBuffer(this.zoomInPaintVertexArray,i,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=t.createVertexBuffer(this.zoomOutPaintVertexArray,i,this.expression.isStateDependent)}}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class j0 extends Yd{getPositions(t){return t.imagePositions}getPositionIds(t){return t.patterns&&t.patterns[this.layerId]}getVertexAttributes(){return Yi.members}emplace(t,i,n,d){t.emplace(i,n.tlbr[0],n.tlbr[1],n.tlbr[2],n.tlbr[3],d.tlbr[0],d.tlbr[1],d.tlbr[2],d.tlbr[3],n.pixelRatio,d.pixelRatio)}}class A0 extends Yd{getPositions(t){return t.dashPositions}getPositionIds(t){return t.dashes&&t.dashes[this.layerId]}getVertexAttributes(){return zi.members}emplace(t,i,n,d){t.emplace(i,0,n.y,n.height,n.width,0,d.y,d.height,d.width)}}class w0{constructor(t,i,n){this.binders={},this._buffers=[];let d=[];for(let r in t.paint._values){if(!n(r))continue;let b=t.paint.get(r);if(!(b instanceof hn&&hc(b.property.specification)))continue;let h=dm(r,t.type),V=b.value,R=b.property.specification.type,N=b.property.useIntegerZoom,M=b.property.specification["property-type"],J=M==="cross-faded"||M==="cross-faded-data-driven";if(V.kind==="constant")this.binders[r]=J?new ji(V.value,h):new Pi(V.value,h,R),d.push(`/u_${r}`);else if(V.kind==="source"||J){let S=xd(r,R,"source");this.binders[r]=J?r==="line-dasharray"?new A0(V,R,N,i,S,t.id):new j0(V,R,N,i,S,t.id):new Vl(V,h,R,S),d.push(`/a_${r}`)}else{let S=xd(r,R,"composite");this.binders[r]=new Ii(V,h,R,N,i,S),d.push(`/z_${r}`)}}this.cacheKey=d.sort().join("")}getMaxValue(t){let i=this.binders[t];return i instanceof Vl||i instanceof Ii?i.maxValue:0}populatePaintArrays(t,i,n){for(let d in this.binders){let r=this.binders[d];(r instanceof Vl||r instanceof Ii||r instanceof Yd)&&r.populatePaintArray(t,i,n)}}setConstantPatternPositions(t,i){for(let n in this.binders){let d=this.binders[n];d instanceof ji&&d.setConstantPatternPositions(t,i)}}setConstantDashPositions(t,i){for(let n in this.binders){let d=this.binders[n];d instanceof ji&&d.setConstantDashPositions(t,i)}}updatePaintArrays(t,i,n,d,r){let b=!1;for(let h in t){let V=i.getPositions(h);for(let R of V){let N=n.feature(R.index);for(let M in this.binders){let J=this.binders[M];if((J instanceof Vl||J instanceof Ii||J instanceof Yd)&&J.expression.isStateDependent===!0){let S=d.paint.get(M);J.expression=S.value,J.updatePaintArray(R.start,R.end,N,t[h],r),b=!0}}}}return b}defines(){let t=[];for(let i in this.binders){let n=this.binders[i];(n instanceof Pi||n instanceof ji)&&t.push(...n.uniformNames.map((d=>`#define HAS_UNIFORM_${d}`)))}return t}getBinderAttributes(){let t=[];for(let i in this.binders){let n=this.binders[i];if(n instanceof Vl||n instanceof Ii)for(let d=0;d<n.paintVertexAttributes.length;d++)t.push(n.paintVertexAttributes[d].name);else if(n instanceof Yd){let d=n.getVertexAttributes();for(let r of d)t.push(r.name)}}return t}getBinderUniforms(){let t=[];for(let i in this.binders){let n=this.binders[i];if(n instanceof Pi||n instanceof ji||n instanceof Ii)for(let d of n.uniformNames)t.push(d)}return t}getPaintVertexBuffers(){return this._buffers}getUniforms(t,i){let n=[];for(let d in this.binders){let r=this.binders[d];if(r instanceof Pi||r instanceof ji||r instanceof Ii){for(let b of r.uniformNames)if(i[b]){let h=r.getBinding(t,i[b],b);n.push({name:b,property:d,binding:h})}}}return n}setUniforms(t,i,n,d){for(let{name:r,property:b,binding:h}of i)this.binders[b].setUniform(h,d,n.get(b),r)}updatePaintBuffers(t){this._buffers=[];for(let i in this.binders){let n=this.binders[i];if(t&&n instanceof Yd){let d=t.fromScale===2?n.zoomInPaintVertexBuffer:n.zoomOutPaintVertexBuffer;d&&this._buffers.push(d)}else(n instanceof Vl||n instanceof Ii)&&n.paintVertexBuffer&&this._buffers.push(n.paintVertexBuffer)}}upload(t){for(let i in this.binders){let n=this.binders[i];(n instanceof Vl||n instanceof Ii||n instanceof Yd)&&n.upload(t)}this.updatePaintBuffers()}destroy(){for(let t in this.binders){let i=this.binders[t];(i instanceof Vl||i instanceof Ii||i instanceof Yd)&&i.destroy()}}}class Pd{constructor(t,i,n=()=>!0){this.programConfigurations={};for(let d of t)this.programConfigurations[d.id]=new w0(d,i,n);this.needsUpload=!1,this._featureMap=new Xn,this._bufferOffset=0}populatePaintArrays(t,i,n,d){for(let r in this.programConfigurations)this.programConfigurations[r].populatePaintArrays(t,i,d);i.id!==void 0&&this._featureMap.add(i.id,n,this._bufferOffset,t),this._bufferOffset=t,this.needsUpload=!0}updatePaintArrays(t,i,n,d){for(let r of n)this.needsUpload=this.programConfigurations[r.id].updatePaintArrays(t,this._featureMap,i,r,d)||this.needsUpload}get(t){return this.programConfigurations[t]}upload(t){if(this.needsUpload){for(let i in this.programConfigurations)this.programConfigurations[i].upload(t);this.needsUpload=!1}}destroy(){for(let t in this.programConfigurations)this.programConfigurations[t].destroy()}}function dm(l,t){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-dasharray":["dasharray_to","dasharray_from"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[l]||[l.replace(`${t}-`,"").replace(/-/g,"_")]}function xd(l,t,i){let n={color:{source:Fc,composite:s},number:{source:mr,composite:Fc}},d=(function(r){return{"line-pattern":{source:ot,composite:ot},"fill-pattern":{source:ot,composite:ot},"fill-extrusion-pattern":{source:ot,composite:ot},"line-dasharray":{source:Ft,composite:Ft}}[r]})(l);return d&&d[i]||n[t][i]}ne("ConstantBinder",Pi),ne("CrossFadedConstantBinder",ji),ne("SourceExpressionBinder",Vl),ne("CrossFadedPatternBinder",j0),ne("CrossFadedDasharrayBinder",A0),ne("CompositeExpressionBinder",Ii),ne("ProgramConfiguration",w0,{omit:["_buffers"]}),ne("ProgramConfigurationSet",Pd);let Wr=Math.pow(2,14)-1,Is=-Wr-1;function Td(l){let t=Le/l.extent,i=l.loadGeometry();for(let n=0;n<i.length;n++){let d=i[n];for(let r=0;r<d.length;r++){let b=d[r],h=Math.round(b.x*t),V=Math.round(b.y*t);b.x=Ci(h,Is,Wr),b.y=Ci(V,Is,Wr),(h<b.x||h>b.x+1||V<b.y||V>b.y+1)&&ci("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return i}function dd(l,t){return{type:l.type,id:l.id,properties:l.properties,geometry:t?Td(l):[]}}let Us=-32768;function Ms(l,t,i,n,d){l.emplaceBack(Us+8*t+n,Us+8*i+d)}class cm{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((i=>i.id)),this.index=t.index,this.hasDependencies=!1,this.layoutVertexArray=new nt,this.indexArray=new Pt,this.segments=new Je,this.programConfigurations=new Pd(t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter((i=>i.isStateDependent())).map((i=>i.id))}populate(t,i,n){let d=this.layers[0],r=[],b=null,h=!1,V=d.type==="heatmap";if(d.type==="circle"){let N=d;b=N.layout.get("circle-sort-key"),h=!b.isConstant(),V=V||N.paint.get("circle-pitch-alignment")==="map"}let R=V?i.subdivisionGranularity.circle:1;for(let{feature:N,id:M,index:J,sourceLayerIndex:S}of t){let C=this.layers[0]._featureFilter.needGeometry,L=dd(N,C);if(!this.layers[0]._featureFilter.filter(new Vi(this.zoom),L,n))continue;let w=h?b.evaluate(L,{},n):void 0,_={id:M,properties:N.properties,type:N.type,sourceLayerIndex:S,index:J,geometry:C?L.geometry:Td(N),patterns:{},sortKey:w};r.push(_)}h&&r.sort(((N,M)=>N.sortKey-M.sortKey));for(let N of r){let{geometry:M,index:J,sourceLayerIndex:S}=N,C=t[J].feature;this.addFeature(N,M,J,n,R),i.featureIndex.insert(C,M,J,S,this.index)}}update(t,i,n){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,i,this.stateDependentLayers,{imagePositions:n})}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Ce),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(t,i,n,d,r=1){let b;switch(r){case 1:b=[0,7];break;case 3:b=[0,2,5,7];break;case 5:b=[0,1,3,4,6,7];break;case 7:b=[0,1,2,3,4,5,6,7];break;default:throw new Error(`Invalid circle bucket granularity: ${r}; valid values are 1, 3, 5, 7.`)}let h=b.length;for(let V of i)for(let R of V){let N=R.x,M=R.y;if(N<0||N>=Le||M<0||M>=Le)continue;let J=this.segments.prepareSegment(h*h,this.layoutVertexArray,this.indexArray,t.sortKey),S=J.vertexLength;for(let C=0;C<h;C++)for(let L=0;L<h;L++)Ms(this.layoutVertexArray,N,M,b[L],b[C]);for(let C=0;C<h-1;C++)for(let L=0;L<h-1;L++){let w=S+C*h+L,_=S+(C+1)*h+L;this.indexArray.emplaceBack(w,_+1,w+1),this.indexArray.emplaceBack(w,_,_+1)}J.vertexLength+=h*h,J.primitiveLength+=(h-1)*(h-1)*2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,n,{imagePositions:{},canonical:d})}}function q1(l,t){for(let i=0;i<l.length;i++)if(hr(t,l[i]))return!0;for(let i=0;i<t.length;i++)if(hr(l,t[i]))return!0;return!!om(l,t)}function v0(l,t,i){return!!hr(l,t)||!!rm(t,l,i)}function $1(l,t){if(l.length===1)return eW(t,l[0]);for(let i=0;i<t.length;i++){let n=t[i];for(let d=0;d<n.length;d++)if(hr(l,n[d]))return!0}for(let i=0;i<l.length;i++)if(eW(t,l[i]))return!0;for(let i=0;i<t.length;i++)if(om(l,t[i]))return!0;return!1}function vp(l,t,i){if(l.length>1){if(om(l,t))return!0;for(let n=0;n<t.length;n++)if(rm(t[n],l,i))return!0}for(let n=0;n<l.length;n++)if(rm(l[n],t,i))return!0;return!1}function om(l,t){if(l.length===0||t.length===0)return!1;for(let i=0;i<l.length-1;i++){let n=l[i],d=l[i+1];for(let r=0;r<t.length-1;r++)if(Hp(n,d,t[r],t[r+1]))return!0}return!1}function Hp(l,t,i,n){return El(l,i,n)!==El(t,i,n)&&El(l,t,i)!==El(l,t,n)}function rm(l,t,i){let n=i*i;if(t.length===1)return l.distSqr(t[0])<n;for(let d=1;d<t.length;d++)if(tW(l,t[d-1],t[d])<n)return!0;return!1}function tW(l,t,i){let n=t.distSqr(i);if(n===0)return l.distSqr(t);let d=((l.x-t.x)*(i.x-t.x)+(l.y-t.y)*(i.y-t.y))/n;return l.distSqr(d<0?t:d>1?i:i.sub(t)._mult(d)._add(t))}function eW(l,t){let i,n,d,r=!1;for(let b=0;b<l.length;b++){i=l[b];for(let h=0,V=i.length-1;h<i.length;V=h++)n=i[h],d=i[V],n.y>t.y!=d.y>t.y&&t.x<(d.x-n.x)*(t.y-n.y)/(d.y-n.y)+n.x&&(r=!r)}return r}function hr(l,t){let i=!1;for(let n=0,d=l.length-1;n<l.length;d=n++){let r=l[n],b=l[d];r.y>t.y!=b.y>t.y&&t.x<(b.x-r.x)*(t.y-r.y)/(b.y-r.y)+r.x&&(i=!i)}return i}function Dp(l,t,i){let n=i[0],d=i[2];if(l.x<n.x&&t.x<n.x||l.x>d.x&&t.x>d.x||l.y<n.y&&t.y<n.y||l.y>d.y&&t.y>d.y)return!1;let r=El(l,t,i[0]);return r!==El(l,t,i[1])||r!==El(l,t,i[2])||r!==El(l,t,i[3])}function Zr(l,t,i){let n=t.paint.get(l).value;return n.kind==="constant"?n.value:i.programConfigurations.get(t.id).getMaxValue(l)}function H0(l){return Math.sqrt(l[0]*l[0]+l[1]*l[1])}function D0(l,t,i,n,d){if(!t[0]&&!t[1])return l;let r=st.convert(t)._mult(d);i==="viewport"&&r._rotate(-n);let b=[];for(let h=0;h<l.length;h++)b.push(l[h].sub(r));return b}function fp({queryGeometry:l,size:t},i){return v0(l,i,t)}function Op({queryGeometry:l,size:t,transform:i,unwrappedTileID:n,getElevation:d},r){return v0(l,r,t*(i.projectTileCoordinates(r.x,r.y,n,d).signedDistanceFromCamera/i.cameraToCenterDistance))}function _p({queryGeometry:l,size:t,transform:i,unwrappedTileID:n,getElevation:d},r){let b=i.projectTileCoordinates(r.x,r.y,n,d).signedDistanceFromCamera,h=t*(i.cameraToCenterDistance/b);return v0(l,sm(r,i,n,d),h)}function Pp({queryGeometry:l,size:t,transform:i,unwrappedTileID:n,getElevation:d},r){return v0(l,sm(r,i,n,d),t)}function iW({queryGeometry:l,size:t,transform:i,unwrappedTileID:n,getElevation:d,pitchAlignment:r="map",pitchScale:b="map"},h){let V=r==="map"?b==="map"?fp:Op:b==="map"?_p:Pp,R={queryGeometry:l,size:t,transform:i,unwrappedTileID:n,getElevation:d};for(let N of h)for(let M of N)if(V(R,M))return!0;return!1}function sm(l,t,i,n){let d=t.projectTileCoordinates(l.x,l.y,i,n).point;return new st((.5*d.x+.5)*t.width,(.5*-d.y+.5)*t.height)}let lW,aW;ne("CircleBucket",cm,{omit:["layers"]});var Kp={get paint(){return aW=aW||new ia({"circle-radius":new Re(K.paint_circle["circle-radius"]),"circle-color":new Re(K.paint_circle["circle-color"]),"circle-blur":new Re(K.paint_circle["circle-blur"]),"circle-opacity":new Re(K.paint_circle["circle-opacity"]),"circle-translate":new me(K.paint_circle["circle-translate"]),"circle-translate-anchor":new me(K.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new me(K.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new me(K.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Re(K.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Re(K.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Re(K.paint_circle["circle-stroke-opacity"])})},get layout(){return lW=lW||new ia({"circle-sort-key":new Re(K.layout_circle["circle-sort-key"])})}};class qp extends en{constructor(t,i){super(t,Kp,i)}createBucket(t){return new cm(t)}queryRadius(t){let i=t;return Zr("circle-radius",this,i)+Zr("circle-stroke-width",this,i)+H0(this.paint.get("circle-translate"))}queryIntersectsFeature({queryGeometry:t,feature:i,featureState:n,geometry:d,transform:r,pixelsToTileUnits:b,unwrappedTileID:h,getElevation:V}){let R=D0(t,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),-r.bearingInRadians,b),N=this.paint.get("circle-radius").evaluate(i,n)+this.paint.get("circle-stroke-width").evaluate(i,n),M=this.paint.get("circle-pitch-scale"),J=this.paint.get("circle-pitch-alignment"),S,C;return J==="map"?(S=R,C=N*b):(S=(function(L,w,_,lt){return L.map((P=>sm(P,w,_,lt)))})(R,r,h,V),C=N),iW({queryGeometry:S,size:C,transform:r,unwrappedTileID:h,getElevation:V,pitchAlignment:J,pitchScale:M},d)}}class nW extends cm{}let dW;ne("HeatmapBucket",nW,{omit:["layers"]});var $p={get paint(){return dW=dW||new ia({"heatmap-radius":new Re(K.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Re(K.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new me(K.paint_heatmap["heatmap-intensity"]),"heatmap-color":new oo(K.paint_heatmap["heatmap-color"]),"heatmap-opacity":new me(K.paint_heatmap["heatmap-opacity"])})}};function bm(l,{width:t,height:i},n,d){if(d){if(d instanceof Uint8ClampedArray)d=new Uint8Array(d.buffer);else if(d.length!==t*i*n)throw new RangeError(`mismatched image size. expected: ${d.length} but got: ${t*i*n}`)}else d=new Uint8Array(t*i*n);return l.width=t,l.height=i,l.data=d,l}function cW(l,{width:t,height:i},n){if(t===l.width&&i===l.height)return;let d=bm({},{width:t,height:i},n);mm(l,d,{x:0,y:0},{x:0,y:0},{width:Math.min(l.width,t),height:Math.min(l.height,i)},n),l.width=t,l.height=i,l.data=d.data}function mm(l,t,i,n,d,r){if(d.width===0||d.height===0)return t;if(d.width>l.width||d.height>l.height||i.x>l.width-d.width||i.y>l.height-d.height)throw new RangeError("out of range source coordinates for image copy");if(d.width>t.width||d.height>t.height||n.x>t.width-d.width||n.y>t.height-d.height)throw new RangeError("out of range destination coordinates for image copy");let b=l.data,h=t.data;if(b===h)throw new Error("srcData equals dstData, so image is already copied");for(let V=0;V<d.height;V++){let R=((i.y+V)*l.width+i.x)*r,N=((n.y+V)*t.width+n.x)*r;for(let M=0;M<d.width*r;M++)h[N+M]=b[R+M]}return t}class Ys{constructor(t,i){bm(this,t,1,i)}resize(t){cW(this,t,1)}clone(){return new Ys({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,i,n,d,r){mm(t,i,n,d,r,1)}}class za{constructor(t,i){bm(this,t,4,i)}resize(t){cW(this,t,4)}replace(t,i){i?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t}clone(){return new za({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,i,n,d,r){mm(t,i,n,d,r,4)}setPixel(t,i,n){let d=4*(t*this.width+i);this.data[d+0]=Math.round(255*n.r/n.a),this.data[d+1]=Math.round(255*n.g/n.a),this.data[d+2]=Math.round(255*n.b/n.a),this.data[d+3]=Math.round(255*n.a)}}function oW(l){let t={},i=l.resolution||256,n=l.clips?l.clips.length:1,d=l.image||new za({width:i,height:n});if(Math.log(i)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${i}`);let r=(b,h,V)=>{t[l.evaluationKey]=V;let R=l.expression.evaluate(t);d.setPixel(b/4/i,h/4,R)};if(l.clips)for(let b=0,h=0;b<n;++b,h+=4*i)for(let V=0,R=0;V<i;V++,R+=4){let N=V/(i-1),{start:M,end:J}=l.clips[b];r(h,R,M*(1-N)+J*N)}else for(let b=0,h=0;b<i;b++,h+=4)r(0,h,b/(i-1));return d}ne("AlphaImage",Ys),ne("RGBAImage",za);let Wm="big-fb";class tV extends en{createBucket(t){return new nW(t)}constructor(t,i){super(t,$p,i),this.heatmapFbos=new Map,this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){t==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=oW({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbos.has(Wm)&&this.heatmapFbos.delete(Wm)}queryRadius(t){return Zr("heatmap-radius",this,t)}queryIntersectsFeature({queryGeometry:t,feature:i,featureState:n,geometry:d,transform:r,pixelsToTileUnits:b,unwrappedTileID:h,getElevation:V}){return iW({queryGeometry:t,size:this.paint.get("heatmap-radius").evaluate(i,n)*b,transform:r,unwrappedTileID:h,getElevation:V},d)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let rW;var eV={get paint(){return rW=rW||new ia({"hillshade-illumination-direction":new me(K.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-altitude":new me(K.paint_hillshade["hillshade-illumination-altitude"]),"hillshade-illumination-anchor":new me(K.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new me(K.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new me(K.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new me(K.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new me(K.paint_hillshade["hillshade-accent-color"]),"hillshade-method":new me(K.paint_hillshade["hillshade-method"])})}};class iV extends en{constructor(t,i){super(t,eV,i),this.recalculate({zoom:0,zoomHistory:{}},void 0)}getIlluminationProperties(){let t=this.paint.get("hillshade-illumination-direction").values,i=this.paint.get("hillshade-illumination-altitude").values,n=this.paint.get("hillshade-highlight-color").values,d=this.paint.get("hillshade-shadow-color").values,r=Math.max(t.length,i.length,n.length,d.length);t=t.concat(Array(r-t.length).fill(t.at(-1))),i=i.concat(Array(r-i.length).fill(i.at(-1))),n=n.concat(Array(r-n.length).fill(n.at(-1))),d=d.concat(Array(r-d.length).fill(d.at(-1)));let b=i.map(ql);return{directionRadians:t.map(ql),altitudeRadians:b,shadowColor:d,highlightColor:n}}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}let sW;var lV={get paint(){return sW=sW||new ia({"color-relief-opacity":new me(K["paint_color-relief"]["color-relief-opacity"]),"color-relief-color":new oo(K["paint_color-relief"]["color-relief-color"])})}};class hm{constructor(t,i,n,d){this.context=t,this.format=n,this.texture=t.gl.createTexture(),this.update(i,d)}update(t,i,n){let{width:d,height:r}=t,b=!(this.size&&this.size[0]===d&&this.size[1]===r||n),{context:h}=this,{gl:V}=h;if(this.useMipmap=!!(i&&i.useMipmap),V.bindTexture(V.TEXTURE_2D,this.texture),h.pixelStoreUnpackFlipY.set(!1),h.pixelStoreUnpack.set(1),h.pixelStoreUnpackPremultiplyAlpha.set(this.format===V.RGBA&&(!i||i.premultiply!==!1)),b)this.size=[d,r],t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||Tl(t)?V.texImage2D(V.TEXTURE_2D,0,this.format,this.format,V.UNSIGNED_BYTE,t):V.texImage2D(V.TEXTURE_2D,0,this.format,d,r,0,this.format,V.UNSIGNED_BYTE,t.data);else{let{x:R,y:N}=n||{x:0,y:0};t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||Tl(t)?V.texSubImage2D(V.TEXTURE_2D,0,R,N,V.RGBA,V.UNSIGNED_BYTE,t):V.texSubImage2D(V.TEXTURE_2D,0,R,N,d,r,V.RGBA,V.UNSIGNED_BYTE,t.data)}this.useMipmap&&this.isSizePowerOfTwo()&&V.generateMipmap(V.TEXTURE_2D),h.pixelStoreUnpackFlipY.setDefault(),h.pixelStoreUnpack.setDefault(),h.pixelStoreUnpackPremultiplyAlpha.setDefault()}bind(t,i,n){let{context:d}=this,{gl:r}=d;r.bindTexture(r.TEXTURE_2D,this.texture),n!==r.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(n=r.LINEAR),t!==this.filter&&(r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,t),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,n||t),this.filter=t),i!==this.wrap&&(r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,i),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,i),this.wrap=i)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){let{gl:t}=this.context;t.deleteTexture(this.texture),this.texture=null}}class bW{constructor(t,i,n,d=1,r=1,b=1,h=0){if(this.uid=t,i.height!==i.width)throw new RangeError("DEM tiles must be square");if(n&&!["mapbox","terrarium","custom"].includes(n))return void ci(`"${n}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=i.height;let V=this.dim=i.height-2;switch(this.data=new Uint32Array(i.data.buffer),n){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=d,this.greenFactor=r,this.blueFactor=b,this.baseShift=h;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let R=0;R<V;R++)this.data[this._idx(-1,R)]=this.data[this._idx(0,R)],this.data[this._idx(V,R)]=this.data[this._idx(V-1,R)],this.data[this._idx(R,-1)]=this.data[this._idx(R,0)],this.data[this._idx(R,V)]=this.data[this._idx(R,V-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(V,-1)]=this.data[this._idx(V-1,0)],this.data[this._idx(-1,V)]=this.data[this._idx(0,V-1)],this.data[this._idx(V,V)]=this.data[this._idx(V-1,V-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let R=0;R<V;R++)for(let N=0;N<V;N++){let M=this.get(R,N);M>this.max&&(this.max=M),M<this.min&&(this.min=M)}}get(t,i){let n=new Uint8Array(this.data.buffer),d=4*this._idx(t,i);return this.unpack(n[d],n[d+1],n[d+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(t,i){if(t<-1||t>=this.dim+1||i<-1||i>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(i+1)*this.stride+(t+1)}unpack(t,i,n){return t*this.redFactor+i*this.greenFactor+n*this.blueFactor-this.baseShift}pack(t){return mW(t,this.getUnpackVector())}getPixels(){return new za({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(t,i,n){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");let d=i*this.dim,r=i*this.dim+this.dim,b=n*this.dim,h=n*this.dim+this.dim;switch(i){case-1:d=r-1;break;case 1:r=d+1}switch(n){case-1:b=h-1;break;case 1:h=b+1}let V=-i*this.dim,R=-n*this.dim;for(let N=b;N<h;N++)for(let M=d;M<r;M++)this.data[this._idx(M,N)]=t.data[this._idx(M+V,N+R)]}}function mW(l,t){let i=t[0],n=t[1],d=t[2],r=t[3],b=Math.min(i,n,d),h=Math.round((l+r)/b);return{r:Math.floor(h*b/i)%256,g:Math.floor(h*b/n)%256,b:Math.floor(h*b/d)%256}}ne("DEMData",bW);class aV extends en{constructor(t,i){super(t,lV,i)}_createColorRamp(t){let i={elevationStops:[],colorStops:[]},n=this._transitionablePaint._values["color-relief-color"].value.expression;if(n instanceof jd&&n._styleExpression.expression instanceof bt){this.colorRampExpression=n;let b=n._styleExpression.expression;i.elevationStops=b.labels,i.colorStops=[];for(let h of i.elevationStops)i.colorStops.push(b.evaluate({globals:{elevation:h}}))}if(i.elevationStops.length<1&&(i.elevationStops=[0],i.colorStops=[Ee.transparent]),i.elevationStops.length<2&&(i.elevationStops.push(i.elevationStops[0]+1),i.colorStops.push(i.colorStops[0])),i.elevationStops.length<=t)return i;let d={elevationStops:[],colorStops:[]},r=(i.elevationStops.length-1)/(t-1);for(let b=0;b<i.elevationStops.length-.5;b+=r)d.elevationStops.push(i.elevationStops[Math.round(b)]),d.colorStops.push(i.colorStops[Math.round(b)]);return ci(`Too many colors in specification of ${this.id} color-relief layer, may not render properly. Max possible colors: ${t}, provided: ${i.elevationStops.length}`),d}_colorRampChanged(){return this.colorRampExpression!=this._transitionablePaint._values["color-relief-color"].value.expression}getColorRampTextures(t,i,n){if(this.colorRampTextures&&!this._colorRampChanged())return this.colorRampTextures;let d=this._createColorRamp(i),r=new za({width:d.colorStops.length,height:1}),b=new za({width:d.colorStops.length,height:1});for(let h=0;h<d.elevationStops.length;h++){let V=mW(d.elevationStops[h],n);b.setPixel(0,h,new Ee(V.r/255,V.g/255,V.b/255,1)),r.setPixel(0,h,d.colorStops[h])}return this.colorRampTextures={elevationTexture:new hm(t,b,t.gl.RGBA),colorTexture:new hm(t,r,t.gl.RGBA)},this.colorRampTextures}hasOffscreenPass(){return this.visibility!=="none"&&!!this.colorRampTextures}}let nV=ll([{name:"a_pos",components:2,type:"Int16"}],4),{members:dV}=nV;function f0(l,t,i){let n=i.patternDependencies,d=!1;for(let r of t){let b=r.paint.get(`${l}-pattern`);b.isConstant()||(d=!0);let h=b.constantOr(null);h&&(d=!0,n[h.to]=!0,n[h.from]=!0)}return d}function Zm(l,t,i,n,d){let{zoom:r}=n,b=d.patternDependencies;for(let h of t){let V=h.paint.get(`${l}-pattern`).value;if(V.kind!=="constant"){let R=V.evaluate({zoom:r-1},i,{},d.availableImages),N=V.evaluate({zoom:r},i,{},d.availableImages),M=V.evaluate({zoom:r+1},i,{},d.availableImages);R=R&&R.name?R.name:R,N=N&&N.name?N.name:N,M=M&&M.name?M.name:M,b[R]=!0,b[N]=!0,b[M]=!0,i.patterns[h.id]={min:R,mid:N,max:M}}}return i}function WW(l,t,i,n,d){let r;if(d===(function(b,h,V,R){let N=0;for(let M=h,J=V-R;M<V;M+=R)N+=(b[J]-b[M])*(b[M+1]+b[J+1]),J=M;return N})(l,t,i,n)>0)for(let b=t;b<i;b+=n)r=VW(b/n|0,l[b],l[b+1],r);else for(let b=i-n;b>=t;b-=n)r=VW(b/n|0,l[b],l[b+1],r);return r&&pr(r,r.next)&&(Js(r),r=r.next),r}function ho(l,t){if(!l)return l;t||(t=l);let i,n=l;do if(i=!1,n.steiner||!pr(n,n.next)&&ml(n.prev,n,n.next)!==0)n=n.next;else{if(Js(n),n=t=n.prev,n===n.next)break;i=!0}while(i||n!==t);return t}function xs(l,t,i,n,d,r,b){if(!l)return;!b&&r&&(function(V,R,N,M){let J=V;do J.z===0&&(J.z=pm(J.x,J.y,R,N,M)),J.prevZ=J.prev,J.nextZ=J.next,J=J.next;while(J!==V);J.prevZ.nextZ=null,J.prevZ=null,(function(S){let C,L=1;do{let w,_=S;S=null;let lt=null;for(C=0;_;){C++;let P=_,tt=0;for(let Vt=0;Vt<L&&(tt++,P=P.nextZ,P);Vt++);let pt=L;for(;tt>0||pt>0&&P;)tt!==0&&(pt===0||!P||_.z<=P.z)?(w=_,_=_.nextZ,tt--):(w=P,P=P.nextZ,pt--),lt?lt.nextZ=w:S=w,w.prevZ=lt,lt=w;_=P}lt.nextZ=null,L*=2}while(C>1)})(J)})(l,n,d,r);let h=l;for(;l.prev!==l.next;){let V=l.prev,R=l.next;if(r?oV(l,n,d,r):cV(l))t.push(V.i,l.i,R.i),Js(l),l=R.next,h=R.next;else if((l=R)===h){b?b===1?xs(l=rV(ho(l),t),t,i,n,d,r,2):b===2&&sV(l,t,i,n,d,r):xs(ho(l),t,i,n,d,r,1);break}}}function cV(l){let t=l.prev,i=l,n=l.next;if(ml(t,i,n)>=0)return!1;let d=t.x,r=i.x,b=n.x,h=t.y,V=i.y,R=n.y,N=Math.min(d,r,b),M=Math.min(h,V,R),J=Math.max(d,r,b),S=Math.max(h,V,R),C=n.next;for(;C!==t;){if(C.x>=N&&C.x<=J&&C.y>=M&&C.y<=S&&Ts(d,h,r,V,b,R,C.x,C.y)&&ml(C.prev,C,C.next)>=0)return!1;C=C.next}return!0}function oV(l,t,i,n){let d=l.prev,r=l,b=l.next;if(ml(d,r,b)>=0)return!1;let h=d.x,V=r.x,R=b.x,N=d.y,M=r.y,J=b.y,S=Math.min(h,V,R),C=Math.min(N,M,J),L=Math.max(h,V,R),w=Math.max(N,M,J),_=pm(S,C,t,i,n),lt=pm(L,w,t,i,n),P=l.prevZ,tt=l.nextZ;for(;P&&P.z>=_&&tt&&tt.z<=lt;){if(P.x>=S&&P.x<=L&&P.y>=C&&P.y<=w&&P!==d&&P!==b&&Ts(h,N,V,M,R,J,P.x,P.y)&&ml(P.prev,P,P.next)>=0||(P=P.prevZ,tt.x>=S&&tt.x<=L&&tt.y>=C&&tt.y<=w&&tt!==d&&tt!==b&&Ts(h,N,V,M,R,J,tt.x,tt.y)&&ml(tt.prev,tt,tt.next)>=0))return!1;tt=tt.nextZ}for(;P&&P.z>=_;){if(P.x>=S&&P.x<=L&&P.y>=C&&P.y<=w&&P!==d&&P!==b&&Ts(h,N,V,M,R,J,P.x,P.y)&&ml(P.prev,P,P.next)>=0)return!1;P=P.prevZ}for(;tt&&tt.z<=lt;){if(tt.x>=S&&tt.x<=L&&tt.y>=C&&tt.y<=w&&tt!==d&&tt!==b&&Ts(h,N,V,M,R,J,tt.x,tt.y)&&ml(tt.prev,tt,tt.next)>=0)return!1;tt=tt.nextZ}return!0}function rV(l,t){let i=l;do{let n=i.prev,d=i.next.next;!pr(n,d)&&ZW(n,i,i.next,d)&&Xs(n,d)&&Xs(d,n)&&(t.push(n.i,i.i,d.i),Js(i),Js(i.next),i=l=d),i=i.next}while(i!==l);return ho(i)}function sV(l,t,i,n,d,r){let b=l;do{let h=b.next.next;for(;h!==b.prev;){if(b.i!==h.i&&ZV(b,h)){let V=pW(b,h);return b=ho(b,b.next),V=ho(V,V.next),xs(b,t,i,n,d,r,0),void xs(V,t,i,n,d,r,0)}h=h.next}b=b.next}while(b!==l)}function bV(l,t){let i=l.x-t.x;return i===0&&(i=l.y-t.y,i===0)&&(i=(l.next.y-l.y)/(l.next.x-l.x)-(t.next.y-t.y)/(t.next.x-t.x)),i}function mV(l,t){let i=(function(d,r){let b=r,h=d.x,V=d.y,R,N=-1/0;if(pr(d,b))return b;do{if(pr(d,b.next))return b.next;if(V<=b.y&&V>=b.next.y&&b.next.y!==b.y){let L=b.x+(V-b.y)*(b.next.x-b.x)/(b.next.y-b.y);if(L<=h&&L>N&&(N=L,R=b.x<b.next.x?b:b.next,L===h))return R}b=b.next}while(b!==r);if(!R)return null;let M=R,J=R.x,S=R.y,C=1/0;b=R;do{if(h>=b.x&&b.x>=J&&h!==b.x&&hW(V<S?h:N,V,J,S,V<S?N:h,V,b.x,b.y)){let L=Math.abs(V-b.y)/(h-b.x);Xs(b,d)&&(L<C||L===C&&(b.x>R.x||b.x===R.x&&WV(R,b)))&&(R=b,C=L)}b=b.next}while(b!==M);return R})(l,t);if(!i)return t;let n=pW(i,l);return ho(n,n.next),ho(i,i.next)}function WV(l,t){return ml(l.prev,l,t.prev)<0&&ml(t.next,l,l.next)<0}function pm(l,t,i,n,d){return(l=1431655765&((l=858993459&((l=252645135&((l=16711935&((l=(l-i)*d|0)|l<<8))|l<<4))|l<<2))|l<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-n)*d|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function hV(l){let t=l,i=l;do(t.x<i.x||t.x===i.x&&t.y<i.y)&&(i=t),t=t.next;while(t!==l);return i}function hW(l,t,i,n,d,r,b,h){return(d-b)*(t-h)>=(l-b)*(r-h)&&(l-b)*(n-h)>=(i-b)*(t-h)&&(i-b)*(r-h)>=(d-b)*(n-h)}function Ts(l,t,i,n,d,r,b,h){return!(l===b&&t===h)&&hW(l,t,i,n,d,r,b,h)}function ZV(l,t){return l.next.i!==t.i&&l.prev.i!==t.i&&!(function(i,n){let d=i;do{if(d.i!==i.i&&d.next.i!==i.i&&d.i!==n.i&&d.next.i!==n.i&&ZW(d,d.next,i,n))return!0;d=d.next}while(d!==i);return!1})(l,t)&&(Xs(l,t)&&Xs(t,l)&&(function(i,n){let d=i,r=!1,b=(i.x+n.x)/2,h=(i.y+n.y)/2;do d.y>h!=d.next.y>h&&d.next.y!==d.y&&b<(d.next.x-d.x)*(h-d.y)/(d.next.y-d.y)+d.x&&(r=!r),d=d.next;while(d!==i);return r})(l,t)&&(ml(l.prev,l,t.prev)||ml(l,t.prev,t))||pr(l,t)&&ml(l.prev,l,l.next)>0&&ml(t.prev,t,t.next)>0)}function ml(l,t,i){return(t.y-l.y)*(i.x-t.x)-(t.x-l.x)*(i.y-t.y)}function pr(l,t){return l.x===t.x&&l.y===t.y}function ZW(l,t,i,n){let d=_0(ml(l,t,i)),r=_0(ml(l,t,n)),b=_0(ml(i,n,l)),h=_0(ml(i,n,t));return d!==r&&b!==h||!(d!==0||!O0(l,i,t))||!(r!==0||!O0(l,n,t))||!(b!==0||!O0(i,l,n))||!(h!==0||!O0(i,t,n))}function O0(l,t,i){return t.x<=Math.max(l.x,i.x)&&t.x>=Math.min(l.x,i.x)&&t.y<=Math.max(l.y,i.y)&&t.y>=Math.min(l.y,i.y)}function _0(l){return l>0?1:l<0?-1:0}function Xs(l,t){return ml(l.prev,l,l.next)<0?ml(l,t,l.next)>=0&&ml(l,l.prev,t)>=0:ml(l,t,l.prev)<0||ml(l,l.next,t)<0}function pW(l,t){let i=Vm(l.i,l.x,l.y),n=Vm(t.i,t.x,t.y),d=l.next,r=t.prev;return l.next=t,t.prev=l,i.next=d,d.prev=i,n.next=i,i.prev=n,r.next=n,n.prev=r,n}function VW(l,t,i,n){let d=Vm(l,t,i);return n?(d.next=n.next,d.prev=n,n.next.prev=d,n.next=d):(d.prev=d,d.next=d),d}function Js(l){l.next.prev=l.prev,l.prev.next=l.next,l.prevZ&&(l.prevZ.nextZ=l.nextZ),l.nextZ&&(l.nextZ.prevZ=l.prevZ)}function Vm(l,t,i){return{i:l,x:t,y:i,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}class Vr{constructor(t,i){if(i>t)throw new Error("Min granularity must not be greater than base granularity.");this._baseZoomGranularity=t,this._minGranularity=i}getGranularityForZoomLevel(t){return Math.max(Math.floor(this._baseZoomGranularity/(1<<t)),this._minGranularity,1)}}class P0{constructor(t){this.fill=t.fill,this.line=t.line,this.tile=t.tile,this.stencil=t.stencil,this.circle=t.circle}}P0.noSubdivision=new P0({fill:new Vr(0,0),line:new Vr(0,0),tile:new Vr(0,0),stencil:new Vr(0,0),circle:1}),ne("SubdivisionGranularityExpression",Vr),ne("SubdivisionGranularitySetting",P0);let gr=-32768,ys=32767;class pV{constructor(t,i){this._vertexBuffer=[],this._vertexDictionary=new Map,this._used=!1,this._granularity=t,this._granularityCellSize=Le/t,this._canonical=i}_getKey(t,i){return(t+=32768)<<16|i+32768}_vertexToIndex(t,i){if(t<-32768||i<-32768||t>32767||i>32767)throw new Error("Vertex coordinates are out of signed 16 bit integer range.");let n=0|Math.round(t),d=0|Math.round(i),r=this._getKey(n,d);if(this._vertexDictionary.has(r))return this._vertexDictionary.get(r);let b=this._vertexBuffer.length/2;return this._vertexDictionary.set(r,b),this._vertexBuffer.push(n,d),b}_subdivideTrianglesScanline(t){if(this._granularity<2)return(function(d,r){let b=[];for(let h=0;h<r.length;h+=3){let V=r[h],R=r[h+1],N=r[h+2],M=d[2*V],J=d[2*V+1];(d[2*R]-M)*(d[2*N+1]-J)-(d[2*R+1]-J)*(d[2*N]-M)>0?(b.push(V),b.push(N),b.push(R)):(b.push(V),b.push(R),b.push(N))}return b})(this._vertexBuffer,t);let i=[],n=t.length;for(let d=0;d<n;d+=3){let r=[t[d+0],t[d+1],t[d+2]],b=[this._vertexBuffer[2*t[d+0]+0],this._vertexBuffer[2*t[d+0]+1],this._vertexBuffer[2*t[d+1]+0],this._vertexBuffer[2*t[d+1]+1],this._vertexBuffer[2*t[d+2]+0],this._vertexBuffer[2*t[d+2]+1]],h=1/0,V=1/0,R=-1/0,N=-1/0;for(let L=0;L<3;L++){let w=b[2*L],_=b[2*L+1];h=Math.min(h,w),R=Math.max(R,w),V=Math.min(V,_),N=Math.max(N,_)}if(h===R||V===N)continue;let M=Math.floor(h/this._granularityCellSize),J=Math.ceil(R/this._granularityCellSize),S=Math.floor(V/this._granularityCellSize),C=Math.ceil(N/this._granularityCellSize);if(M!==J||S!==C)for(let L=S;L<C;L++){let w=this._scanlineGenerateVertexRingForCellRow(L,b,r);VV(this._vertexBuffer,w,i)}else i.push(...r)}return i}_scanlineGenerateVertexRingForCellRow(t,i,n){let d=t*this._granularityCellSize,r=d+this._granularityCellSize,b=[];for(let h=0;h<3;h++){let V=i[2*h],R=i[2*h+1],N=i[2*(h+1)%6],M=i[(2*(h+1)+1)%6],J=i[2*(h+2)%6],S=i[(2*(h+2)+1)%6],C=N-V,L=M-R,w=C===0,_=L===0,lt=(d-R)/L,P=(r-R)/L,tt=Math.min(lt,P),pt=Math.max(lt,P);if(!_&&(tt>=1||pt<=0)||_&&(R<d||R>r)){M>=d&&M<=r&&b.push(n[(h+1)%3]);continue}!_&&tt>0&&b.push(this._vertexToIndex(V+C*tt,R+L*tt));let Vt=V+C*Math.max(tt,0),Yt=V+C*Math.min(pt,1);w||this._generateIntraEdgeVertices(b,V,R,N,M,Vt,Yt),!_&&pt<1&&b.push(this._vertexToIndex(V+C*pt,R+L*pt)),(_||M>=d&&M<=r)&&b.push(n[(h+1)%3]),!_&&(M<=d||M>=r)&&this._generateInterEdgeVertices(b,V,R,N,M,J,S,Yt,d,r)}return b}_generateIntraEdgeVertices(t,i,n,d,r,b,h){let V=d-i,R=r-n,N=R===0,M=N?Math.min(i,d):Math.min(b,h),J=N?Math.max(i,d):Math.max(b,h),S=Math.floor(M/this._granularityCellSize)+1,C=Math.ceil(J/this._granularityCellSize)-1;if(N?i<d:b<h)for(let L=S;L<=C;L++){let w=L*this._granularityCellSize;t.push(this._vertexToIndex(w,n+R*(w-i)/V))}else for(let L=C;L>=S;L--){let w=L*this._granularityCellSize;t.push(this._vertexToIndex(w,n+R*(w-i)/V))}}_generateInterEdgeVertices(t,i,n,d,r,b,h,V,R,N){let M=r-n,J=b-d,S=h-r,C=(R-r)/S,L=(N-r)/S,w=Math.min(C,L),_=Math.max(C,L),lt=d+J*w,P=Math.floor(Math.min(lt,V)/this._granularityCellSize)+1,tt=Math.ceil(Math.max(lt,V)/this._granularityCellSize)-1,pt=V<lt,Vt=S===0;if(Vt&&(h===R||h===N))return;if(Vt||w>=1||_<=0){let wt=n-h,Qt=b+(i-b)*Math.min((R-h)/wt,(N-h)/wt);P=Math.floor(Math.min(Qt,V)/this._granularityCellSize)+1,tt=Math.ceil(Math.max(Qt,V)/this._granularityCellSize)-1,pt=V<Qt}let Yt=M>0?N:R;if(pt)for(let wt=P;wt<=tt;wt++)t.push(this._vertexToIndex(wt*this._granularityCellSize,Yt));else for(let wt=tt;wt>=P;wt--)t.push(this._vertexToIndex(wt*this._granularityCellSize,Yt))}_generateOutline(t){let i=[];for(let n of t){let d=Zo(n,this._granularity,!0),r=this._pointArrayToIndices(d),b=[];for(let h=1;h<r.length;h++)b.push(r[h-1]),b.push(r[h]);i.push(b)}return i}_handlePoles(t){let i=!1,n=!1;this._canonical&&(this._canonical.y===0&&(i=!0),this._canonical.y===(1<<this._canonical.z)-1&&(n=!0)),(i||n)&&this._fillPoles(t,i,n)}_ensureNoPoleVertices(){let t=this._vertexBuffer;for(let i=0;i<t.length;i+=2){let n=t[i+1];n===gr&&(t[i+1]=-32767),n===ys&&(t[i+1]=32766)}}_generatePoleQuad(t,i,n,d,r,b){d>r!=(b===gr)?(t.push(i),t.push(n),t.push(this._vertexToIndex(d,b)),t.push(n),t.push(this._vertexToIndex(r,b)),t.push(this._vertexToIndex(d,b))):(t.push(n),t.push(i),t.push(this._vertexToIndex(d,b)),t.push(this._vertexToIndex(r,b)),t.push(n),t.push(this._vertexToIndex(d,b)))}_fillPoles(t,i,n){let d=this._vertexBuffer,r=Le,b=t.length;for(let h=2;h<b;h+=3){let V=t[h-2],R=t[h-1],N=t[h],M=d[2*V],J=d[2*V+1],S=d[2*R],C=d[2*R+1],L=d[2*N],w=d[2*N+1];i&&(J===0&&C===0&&this._generatePoleQuad(t,V,R,M,S,gr),C===0&&w===0&&this._generatePoleQuad(t,R,N,S,L,gr),w===0&&J===0&&this._generatePoleQuad(t,N,V,L,M,gr)),n&&(J===r&&C===r&&this._generatePoleQuad(t,V,R,M,S,ys),C===r&&w===r&&this._generatePoleQuad(t,R,N,S,L,ys),w===r&&J===r&&this._generatePoleQuad(t,N,V,L,M,ys))}}_initializeVertices(t){for(let i=0;i<t.length;i+=2)this._vertexToIndex(t[i],t[i+1])}subdividePolygonInternal(t,i){if(this._used)throw new Error("Subdivision: multiple use not allowed.");this._used=!0;let{flattened:n,holeIndices:d}=(function(h){let V=[],R=[];for(let N of h)if(N.length!==0){N!==h[0]&&V.push(R.length/2);for(let M=0;M<N.length;M++)R.push(N[M].x),R.push(N[M].y)}return{flattened:R,holeIndices:V}})(t),r;this._initializeVertices(n);try{let h=(function(R,N,M=2){let J=N&&N.length,S=J?N[0]*M:R.length,C=WW(R,0,S,M,!0),L=[];if(!C||C.next===C.prev)return L;let w,_,lt;if(J&&(C=(function(P,tt,pt,Vt){let Yt=[];for(let wt=0,Qt=tt.length;wt<Qt;wt++){let Ht=WW(P,tt[wt]*Vt,wt<Qt-1?tt[wt+1]*Vt:P.length,Vt,!1);Ht===Ht.next&&(Ht.steiner=!0),Yt.push(hV(Ht))}Yt.sort(bV);for(let wt=0;wt<Yt.length;wt++)pt=mV(Yt[wt],pt);return pt})(R,N,C,M)),R.length>80*M){w=R[0],_=R[1];let P=w,tt=_;for(let pt=M;pt<S;pt+=M){let Vt=R[pt],Yt=R[pt+1];Vt<w&&(w=Vt),Yt<_&&(_=Yt),Vt>P&&(P=Vt),Yt>tt&&(tt=Yt)}lt=Math.max(P-w,tt-_),lt=lt!==0?32767/lt:0}return xs(C,L,M,w,_,lt,0),L})(n,d),V=this._convertIndices(n,h);r=this._subdivideTrianglesScanline(V)}catch(h){console.error(h)}let b=[];return i&&(b=this._generateOutline(t)),this._ensureNoPoleVertices(),this._handlePoles(r),{verticesFlattened:this._vertexBuffer,indicesTriangles:r,indicesLineList:b}}_convertIndices(t,i){let n=[];for(let d=0;d<i.length;d++)n.push(this._vertexToIndex(t[2*i[d]],t[2*i[d]+1]));return n}_pointArrayToIndices(t){let i=[];for(let n=0;n<t.length;n++){let d=t[n];i.push(this._vertexToIndex(d.x,d.y))}return i}}function gW(l,t,i,n=!0){return new pV(i,t).subdividePolygonInternal(l,n)}function Zo(l,t,i=!1){if(!l||l.length<1)return[];if(l.length<2)return[];let n=l[0],d=l[l.length-1],r=i&&(n.x!==d.x||n.y!==d.y);if(t<2)return r?[...l,l[0]]:[...l];let b=Math.floor(Le/t),h=[];h.push(new st(l[0].x,l[0].y));let V=l.length,R=r?V:V-1;for(let N=0;N<R;N++){let M=l[N],J=N<V-1?l[N+1]:l[0],S=M.x,C=M.y,L=J.x,w=J.y,_=S!==L,lt=C!==w;if(!_&&!lt)continue;let P=L-S,tt=w-C,pt=Math.abs(P),Vt=Math.abs(tt),Yt=S,wt=C;for(;;){let Ht=P>0?(Math.floor(Yt/b)+1)*b:(Math.ceil(Yt/b)-1)*b,ae=tt>0?(Math.floor(wt/b)+1)*b:(Math.ceil(wt/b)-1)*b,Kt=Math.abs(Yt-Ht),qt=Math.abs(wt-ae),Lt=Math.abs(Yt-L),Ze=Math.abs(wt-w),pe=_?Kt/pt:Number.POSITIVE_INFINITY,Fe=lt?qt/Vt:Number.POSITIVE_INFINITY;if((Lt<=Kt||!_)&&(Ze<=qt||!lt))break;if(pe<Fe&&_||!lt){Yt=Ht,wt+=tt*pe;let re=new st(Yt,Math.round(wt));h[h.length-1].x===re.x&&h[h.length-1].y===re.y||h.push(re)}else{Yt+=P*Fe,wt=ae;let re=new st(Math.round(Yt),wt);h[h.length-1].x===re.x&&h[h.length-1].y===re.y||h.push(re)}}let Qt=new st(L,w);h[h.length-1].x===Qt.x&&h[h.length-1].y===Qt.y||h.push(Qt)}return h}function VV(l,t,i){if(t.length===0)throw new Error("Subdivision vertex ring is empty.");let n=0,d=l[2*t[0]];for(let V=1;V<t.length;V++){let R=l[2*t[V]];R<d&&(d=R,n=V)}let r=t.length,b=n,h=(b+1)%r;for(;;){let V=b-1>=0?b-1:r-1,R=(h+1)%r,N=l[2*t[V]],M=l[2*t[R]],J=l[2*t[b]],S=l[2*t[b]+1],C=l[2*t[h]+1],L=!1;if(N<M)L=!0;else if(N>M)L=!1;else{let w=C-S,_=-(l[2*t[h]]-J),lt=S<C?1:-1;((N-J)*w+(l[2*t[V]+1]-S)*_)*lt>((M-J)*w+(l[2*t[R]+1]-S)*_)*lt&&(L=!0)}if(L){let w=t[V],_=t[b],lt=t[h];w!==_&&w!==lt&&_!==lt&&i.push(lt,_,w),b--,b<0&&(b=r-1)}else{let w=t[R],_=t[b],lt=t[h];w!==_&&w!==lt&&_!==lt&&i.push(lt,_,w),h++,h>=r&&(h=0)}if(V===R)break}}function uW(l,t,i,n,d,r,b,h,V){let R=d.length/2,N=b&&h&&V;if(R<Je.MAX_VERTEX_ARRAY_LENGTH){let M=t.prepareSegment(R,i,n),J=M.vertexLength;for(let L=0;L<r.length;L+=3)n.emplaceBack(J+r[L],J+r[L+1],J+r[L+2]);let S,C;M.vertexLength+=R,M.primitiveLength+=r.length/3,N&&(C=b.prepareSegment(R,i,h),S=C.vertexLength,C.vertexLength+=R);for(let L=0;L<d.length;L+=2)l(d[L],d[L+1]);if(N)for(let L=0;L<V.length;L++){let w=V[L];for(let _=1;_<w.length;_+=2)h.emplaceBack(S+w[_-1],S+w[_]);C.primitiveLength+=w.length/2}}else(function(M,J,S,C,L,w){let _=[];for(let Vt=0;Vt<C.length/2;Vt++)_.push(-1);let lt={count:0},P=0,tt=M.getOrCreateLatestSegment(J,S),pt=tt.vertexLength;for(let Vt=2;Vt<L.length;Vt+=3){let Yt=L[Vt-2],wt=L[Vt-1],Qt=L[Vt],Ht=_[Yt]<P,ae=_[wt]<P,Kt=_[Qt]<P;tt.vertexLength+((Ht?1:0)+(ae?1:0)+(Kt?1:0))>Je.MAX_VERTEX_ARRAY_LENGTH&&(tt=M.createNewSegment(J,S),P=lt.count,Ht=!0,ae=!0,Kt=!0,pt=0);let qt=Bs(_,C,w,lt,Yt,Ht,tt),Lt=Bs(_,C,w,lt,wt,ae,tt),Ze=Bs(_,C,w,lt,Qt,Kt,tt);S.emplaceBack(pt+qt-P,pt+Lt-P,pt+Ze-P),tt.primitiveLength++}})(t,i,n,d,r,l),N&&(function(M,J,S,C,L,w){let _=[];for(let Vt=0;Vt<C.length/2;Vt++)_.push(-1);let lt={count:0},P=0,tt=M.getOrCreateLatestSegment(J,S),pt=tt.vertexLength;for(let Vt=0;Vt<L.length;Vt++){let Yt=L[Vt];for(let wt=1;wt<L[Vt].length;wt+=2){let Qt=Yt[wt-1],Ht=Yt[wt],ae=_[Qt]<P,Kt=_[Ht]<P;tt.vertexLength+((ae?1:0)+(Kt?1:0))>Je.MAX_VERTEX_ARRAY_LENGTH&&(tt=M.createNewSegment(J,S),P=lt.count,ae=!0,Kt=!0,pt=0);let qt=Bs(_,C,w,lt,Qt,ae,tt),Lt=Bs(_,C,w,lt,Ht,Kt,tt);S.emplaceBack(pt+qt-P,pt+Lt-P),tt.primitiveLength++}}})(b,i,h,d,V,l),t.forceNewSegmentOnNextPrepare(),b?.forceNewSegmentOnNextPrepare()}function Bs(l,t,i,n,d,r,b){if(r){let h=n.count;return i(t[2*d],t[2*d+1]),l[d]=n.count,n.count++,b.vertexLength++,h}return l[d]}class gm{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((i=>i.id)),this.index=t.index,this.hasDependencies=!1,this.patternFeatures=[],this.layoutVertexArray=new mt,this.indexArray=new Pt,this.indexArray2=new At,this.programConfigurations=new Pd(t.layers,t.zoom),this.segments=new Je,this.segments2=new Je,this.stateDependentLayerIds=this.layers.filter((i=>i.isStateDependent())).map((i=>i.id))}populate(t,i,n){this.hasDependencies=f0("fill",this.layers,i);let d=this.layers[0].layout.get("fill-sort-key"),r=!d.isConstant(),b=[];for(let{feature:h,id:V,index:R,sourceLayerIndex:N}of t){let M=this.layers[0]._featureFilter.needGeometry,J=dd(h,M);if(!this.layers[0]._featureFilter.filter(new Vi(this.zoom),J,n))continue;let S=r?d.evaluate(J,{},n,i.availableImages):void 0,C={id:V,properties:h.properties,type:h.type,sourceLayerIndex:N,index:R,geometry:M?J.geometry:Td(h),patterns:{},sortKey:S};b.push(C)}r&&b.sort(((h,V)=>h.sortKey-V.sortKey));for(let h of b){let{geometry:V,index:R,sourceLayerIndex:N}=h;if(this.hasDependencies){let M=Zm("fill",this.layers,h,{zoom:this.zoom},i);this.patternFeatures.push(M)}else this.addFeature(h,V,R,n,{},i.subdivisionGranularity);i.featureIndex.insert(t[R].feature,V,R,N,this.index)}}update(t,i,n){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,i,this.stateDependentLayers,{imagePositions:n})}addFeatures(t,i,n){for(let d of this.patternFeatures)this.addFeature(d,d.geometry,d.index,i,n,t.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,dV),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(t,i,n,d,r,b){for(let h of xa(i,500)){let V=gW(h,d,b.fill.getGranularityForZoomLevel(d.z)),R=this.layoutVertexArray;uW(((N,M)=>{R.emplaceBack(N,M)}),this.segments,this.layoutVertexArray,this.indexArray,V.verticesFlattened,V.indicesTriangles,this.segments2,this.indexArray2,V.indicesLineList)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,n,{imagePositions:r,canonical:d})}}let RW,FW;ne("FillBucket",gm,{omit:["layers","patternFeatures"]});var gV={get paint(){return FW=FW||new ia({"fill-antialias":new me(K.paint_fill["fill-antialias"]),"fill-opacity":new Re(K.paint_fill["fill-opacity"]),"fill-color":new Re(K.paint_fill["fill-color"]),"fill-outline-color":new Re(K.paint_fill["fill-outline-color"]),"fill-translate":new me(K.paint_fill["fill-translate"]),"fill-translate-anchor":new me(K.paint_fill["fill-translate-anchor"]),"fill-pattern":new co(K.paint_fill["fill-pattern"])})},get layout(){return RW=RW||new ia({"fill-sort-key":new Re(K.layout_fill["fill-sort-key"])})}};class uV extends en{constructor(t,i){super(t,gV,i)}recalculate(t,i){super.recalculate(t,i);let n=this.paint._values["fill-outline-color"];n.value.kind==="constant"&&n.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(t){return new gm(t)}queryRadius(){return H0(this.paint.get("fill-translate"))}queryIntersectsFeature({queryGeometry:t,geometry:i,transform:n,pixelsToTileUnits:d}){return $1(D0(t,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),-n.bearingInRadians,d),i)}isTileClipped(){return!0}}let RV=ll([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),FV=ll([{name:"a_centroid",components:2,type:"Int16"}],4),{members:GV}=RV;class ur{constructor(t,i,n,d,r){this.properties={},this.extent=n,this.type=0,this.id=void 0,this._pbf=t,this._geometry=-1,this._keys=d,this._values=r,t.readFields(NV,this,i)}loadGeometry(){let t=this._pbf;t.pos=this._geometry;let i=t.readVarint()+t.pos,n=[],d,r=1,b=0,h=0,V=0;for(;t.pos<i;){if(b<=0){let R=t.readVarint();r=7&R,b=R>>3}if(b--,r===1||r===2)h+=t.readSVarint(),V+=t.readSVarint(),r===1&&(d&&n.push(d),d=[]),d&&d.push(new st(h,V));else{if(r!==7)throw new Error(`unknown command ${r}`);d&&d.push(d[0].clone())}}return d&&n.push(d),n}bbox(){let t=this._pbf;t.pos=this._geometry;let i=t.readVarint()+t.pos,n=1,d=0,r=0,b=0,h=1/0,V=-1/0,R=1/0,N=-1/0;for(;t.pos<i;){if(d<=0){let M=t.readVarint();n=7&M,d=M>>3}if(d--,n===1||n===2)r+=t.readSVarint(),b+=t.readSVarint(),r<h&&(h=r),r>V&&(V=r),b<R&&(R=b),b>N&&(N=b);else if(n!==7)throw new Error(`unknown command ${n}`)}return[h,R,V,N]}toGeoJSON(t,i,n){let d=this.extent*Math.pow(2,n),r=this.extent*t,b=this.extent*i,h=this.loadGeometry();function V(J){return[360*(J.x+r)/d-180,360/Math.PI*Math.atan(Math.exp((1-2*(J.y+b)/d)*Math.PI))-90]}function R(J){return J.map(V)}let N;if(this.type===1){let J=[];for(let C of h)J.push(C[0]);let S=R(J);N=J.length===1?{type:"Point",coordinates:S[0]}:{type:"MultiPoint",coordinates:S}}else if(this.type===2){let J=h.map(R);N=J.length===1?{type:"LineString",coordinates:J[0]}:{type:"MultiLineString",coordinates:J}}else{if(this.type!==3)throw new Error("unknown feature type");{let J=(function(C){let L=C.length;if(L<=1)return[C];let w=[],_,lt;for(let P=0;P<L;P++){let tt=IV(C[P]);tt!==0&&(lt===void 0&&(lt=tt<0),lt===tt<0?(_&&w.push(_),_=[C[P]]):_&&_.push(C[P]))}return _&&w.push(_),w})(h),S=[];for(let C of J)S.push(C.map(R));N=S.length===1?{type:"Polygon",coordinates:S[0]}:{type:"MultiPolygon",coordinates:S}}}let M={type:"Feature",geometry:N,properties:this.properties};return this.id!=null&&(M.id=this.id),M}}function NV(l,t,i){l===1?t.id=i.readVarint():l===2?(function(n,d){let r=n.readVarint()+n.pos;for(;n.pos<r;){let b=d._keys[n.readVarint()],h=d._values[n.readVarint()];d.properties[b]=h}})(i,t):l===3?t.type=i.readVarint():l===4&&(t._geometry=i.pos)}function IV(l){let t=0;for(let i,n,d=0,r=l.length,b=r-1;d<r;b=d++)i=l[d],n=l[b],t+=(n.x-i.x)*(i.y+n.y);return t}ur.types=["Unknown","Point","LineString","Polygon"];class GW{constructor(t,i){this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(UV,this,i),this.length=this._features.length}feature(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];let i=this._pbf.readVarint()+this._pbf.pos;return new ur(this._pbf,i,this.extent,this._keys,this._values)}}function UV(l,t,i){l===15?t.version=i.readVarint():l===1?t.name=i.readString():l===5?t.extent=i.readVarint():l===2?t._features.push(i.pos):l===3?t._keys.push(i.readString()):l===4&&t._values.push((function(n){let d=null,r=n.readVarint()+n.pos;for(;n.pos<r;){let b=n.readVarint()>>3;d=b===1?n.readString():b===2?n.readFloat():b===3?n.readDouble():b===4?n.readVarint64():b===5?n.readVarint():b===6?n.readSVarint():b===7?n.readBoolean():null}if(d==null)throw new Error("unknown feature value");return d})(i))}class NW{constructor(t,i){this.layers=t.readFields(MV,{},i)}}function MV(l,t,i){if(l===3){let n=new GW(i,i.readVarint()+i.pos);n.length&&(t[n.name]=n)}}let um=Math.pow(2,13);function Ss(l,t,i,n,d,r,b,h){l.emplaceBack(t,i,2*Math.floor(n*um)+b,d*um*2,r*um*2,Math.round(h))}class Rm{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((i=>i.id)),this.index=t.index,this.hasDependencies=!1,this.layoutVertexArray=new at,this.centroidVertexArray=new et,this.indexArray=new Pt,this.programConfigurations=new Pd(t.layers,t.zoom),this.segments=new Je,this.stateDependentLayerIds=this.layers.filter((i=>i.isStateDependent())).map((i=>i.id))}populate(t,i,n){this.features=[],this.hasDependencies=f0("fill-extrusion",this.layers,i);for(let{feature:d,id:r,index:b,sourceLayerIndex:h}of t){let V=this.layers[0]._featureFilter.needGeometry,R=dd(d,V);if(!this.layers[0]._featureFilter.filter(new Vi(this.zoom),R,n))continue;let N={id:r,sourceLayerIndex:h,index:b,geometry:V?R.geometry:Td(d),properties:d.properties,type:d.type,patterns:{}};this.hasDependencies?this.features.push(Zm("fill-extrusion",this.layers,N,{zoom:this.zoom},i)):this.addFeature(N,N.geometry,b,n,{},i.subdivisionGranularity),i.featureIndex.insert(d,N.geometry,b,h,this.index,!0)}}addFeatures(t,i,n){for(let d of this.features){let{geometry:r}=d;this.addFeature(d,r,d.index,i,n,t.subdivisionGranularity)}}update(t,i,n){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,i,this.stateDependentLayers,{imagePositions:n})}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,GV),this.centroidVertexBuffer=t.createVertexBuffer(this.centroidVertexArray,FV.members,!0),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(t,i,n,d,r,b){for(let h of xa(i,500)){let V={x:0,y:0,sampleCount:0},R=this.layoutVertexArray.length;this.processPolygon(V,d,t,h,b);let N=this.layoutVertexArray.length-R,M=Math.floor(V.x/V.sampleCount),J=Math.floor(V.y/V.sampleCount);for(let S=0;S<N;S++)this.centroidVertexArray.emplaceBack(M,J)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,n,{imagePositions:r,canonical:d})}processPolygon(t,i,n,d,r){if(d.length<1||IW(d[0]))return;for(let M of d)M.length!==0&&YV(t,M);let b={segment:this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray)},h=r.fill.getGranularityForZoomLevel(i.z),V=ur.types[n.type]==="Polygon";for(let M of d){if(M.length===0||IW(M))continue;let J=Zo(M,h,V);this._generateSideFaces(J,b)}if(!V)return;let R=gW(d,i,h,!1),N=this.layoutVertexArray;uW(((M,J)=>{Ss(N,M,J,0,0,1,1,0)}),this.segments,this.layoutVertexArray,this.indexArray,R.verticesFlattened,R.indicesTriangles)}_generateSideFaces(t,i){let n=0;for(let d=1;d<t.length;d++){let r=t[d],b=t[d-1];if(xV(r,b))continue;i.segment.vertexLength+4>Je.MAX_VERTEX_ARRAY_LENGTH&&(i.segment=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));let h=r.sub(b)._perp()._unit(),V=b.dist(r);n+V>32768&&(n=0),Ss(this.layoutVertexArray,r.x,r.y,h.x,h.y,0,0,n),Ss(this.layoutVertexArray,r.x,r.y,h.x,h.y,0,1,n),n+=V,Ss(this.layoutVertexArray,b.x,b.y,h.x,h.y,0,0,n),Ss(this.layoutVertexArray,b.x,b.y,h.x,h.y,0,1,n);let R=i.segment.vertexLength;this.indexArray.emplaceBack(R,R+2,R+1),this.indexArray.emplaceBack(R+1,R+2,R+3),i.segment.vertexLength+=4,i.segment.primitiveLength+=2}}}function YV(l,t){for(let i=0;i<t.length;i++){let n=t[i];i===t.length-1&&t[0].x===n.x&&t[0].y===n.y||(l.x+=n.x,l.y+=n.y,l.sampleCount++)}}function xV(l,t){return l.x===t.x&&(l.x<0||l.x>Le)||l.y===t.y&&(l.y<0||l.y>Le)}function IW(l){return l.every((t=>t.x<0))||l.every((t=>t.x>Le))||l.every((t=>t.y<0))||l.every((t=>t.y>Le))}let UW;ne("FillExtrusionBucket",Rm,{omit:["layers","features"]});var TV={get paint(){return UW=UW||new ia({"fill-extrusion-opacity":new me(K["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Re(K["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new me(K["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new me(K["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new co(K["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Re(K["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Re(K["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new me(K["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class XV extends en{constructor(t,i){super(t,TV,i)}createBucket(t){return new Rm(t)}queryRadius(){return H0(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature({queryGeometry:t,feature:i,featureState:n,geometry:d,transform:r,pixelsToTileUnits:b,pixelPosMatrix:h}){let V=D0(t,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),-r.bearingInRadians,b),R=this.paint.get("fill-extrusion-height").evaluate(i,n),N=this.paint.get("fill-extrusion-base").evaluate(i,n),M=(function(S,C){let L=[];for(let w of S){let _=[w.x,w.y,0,1];Qe(_,_,C),L.push(new st(_[0]/_[3],_[1]/_[3]))}return L})(V,h),J=(function(S,C,L,w){let _=[],lt=[],P=w[8]*C,tt=w[9]*C,pt=w[10]*C,Vt=w[11]*C,Yt=w[8]*L,wt=w[9]*L,Qt=w[10]*L,Ht=w[11]*L;for(let ae of S){let Kt=[],qt=[];for(let Lt of ae){let Ze=Lt.x,pe=Lt.y,Fe=w[0]*Ze+w[4]*pe+w[12],re=w[1]*Ze+w[5]*pe+w[13],He=w[2]*Ze+w[6]*pe+w[14],Si=w[3]*Ze+w[7]*pe+w[15],gl=He+pt,na=Si+Vt,Jn=Fe+Yt,ya=re+wt,Dl=He+Qt,da=Si+Ht,nl=new st((Fe+P)/na,(re+tt)/na);nl.z=gl/na,Kt.push(nl);let fl=new st(Jn/da,ya/da);fl.z=Dl/da,qt.push(fl)}_.push(Kt),lt.push(qt)}return[_,lt]})(d,N,R,h);return(function(S,C,L){let w=1/0;$1(L,C)&&(w=MW(L,C[0]));for(let _=0;_<C.length;_++){let lt=C[_],P=S[_];for(let tt=0;tt<lt.length-1;tt++){let pt=lt[tt],Vt=[pt,lt[tt+1],P[tt+1],P[tt],pt];q1(L,Vt)&&(w=Math.min(w,MW(L,Vt)))}}return w!==1/0&&w})(J[0],J[1],M)}}function Cs(l,t){return l.x*t.x+l.y*t.y}function MW(l,t){if(l.length===1){let i=0,n=t[i++],d;for(;!d||n.equals(d);)if(d=t[i++],!d)return 1/0;for(;i<t.length;i++){let r=t[i],b=l[0],h=d.sub(n),V=r.sub(n),R=b.sub(n),N=Cs(h,h),M=Cs(h,V),J=Cs(V,V),S=Cs(R,h),C=Cs(R,V),L=N*J-M*M,w=(J*S-M*C)/L,_=(N*C-M*S)/L,lt=n.z*(1-w-_)+d.z*w+r.z*_;if(isFinite(lt))return lt}return 1/0}{let i=1/0;for(let n of t)i=Math.min(i,n.z);return i}}let JV=ll([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:yV}=JV,BV=ll([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:SV}=BV,CV=Math.cos(Math.PI/180*37.5),YW=Math.pow(2,14)/.5;class Fm{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((i=>i.id)),this.index=t.index,this.hasDependencies=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach((i=>{this.gradients[i.id]={}})),this.layoutVertexArray=new Wt,this.layoutVertexArray2=new Zt,this.indexArray=new Pt,this.programConfigurations=new Pd(t.layers,t.zoom),this.segments=new Je,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter((i=>i.isStateDependent())).map((i=>i.id))}populate(t,i,n){this.hasDependencies=f0("line",this.layers,i)||this.hasLineDasharray(this.layers);let d=this.layers[0].layout.get("line-sort-key"),r=!d.isConstant(),b=[];for(let{feature:h,id:V,index:R,sourceLayerIndex:N}of t){let M=this.layers[0]._featureFilter.needGeometry,J=dd(h,M);if(!this.layers[0]._featureFilter.filter(new Vi(this.zoom),J,n))continue;let S=r?d.evaluate(J,{},n):void 0,C={id:V,properties:h.properties,type:h.type,sourceLayerIndex:N,index:R,geometry:M?J.geometry:Td(h),patterns:{},dashes:{},sortKey:S};b.push(C)}r&&b.sort(((h,V)=>h.sortKey-V.sortKey));for(let h of b){let{geometry:V,index:R,sourceLayerIndex:N}=h;this.hasDependencies?(f0("line",this.layers,i)?Zm("line",this.layers,h,{zoom:this.zoom},i):this.hasLineDasharray(this.layers)&&this.addLineDashDependencies(this.layers,h,this.zoom,i),this.patternFeatures.push(h)):this.addFeature(h,V,R,n,{},{},i.subdivisionGranularity),i.featureIndex.insert(t[R].feature,V,R,N,this.index)}}update(t,i,n,d){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,i,this.stateDependentLayers,{imagePositions:n,dashPositions:d})}addFeatures(t,i,n,d){for(let r of this.patternFeatures)this.addFeature(r,r.geometry,r.index,i,n,d,t.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,SV)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,yV),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(t){if(t.properties&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_end"))return{start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}}addFeature(t,i,n,d,r,b,h){let V=this.layers[0].layout,R=V.get("line-join").evaluate(t,{}),N=V.get("line-cap"),M=V.get("line-miter-limit"),J=V.get("line-round-limit");this.lineClips=this.lineFeatureClips(t);for(let S of i)this.addLine(S,t,R,N,M,J,d,h);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,n,{imagePositions:r,dashPositions:b,canonical:d})}addLine(t,i,n,d,r,b,h,V){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,t=Zo(t,h?V.line.getGranularityForZoomLevel(h.z):1),this.lineClips){this.lineClipsArray.push(this.lineClips);for(let P=0;P<t.length-1;P++)this.totalDistance+=t[P].dist(t[P+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}let R=ur.types[i.type]==="Polygon",N=t.length;for(;N>=2&&t[N-1].equals(t[N-2]);)N--;let M=0;for(;M<N-1&&t[M].equals(t[M+1]);)M++;if(N<(R?3:2))return;n==="bevel"&&(r=1.05);let J=this.overscaling<=16?122880/(512*this.overscaling):0,S=this.segments.prepareSegment(10*N,this.layoutVertexArray,this.indexArray),C,L,w,_,lt;this.e1=this.e2=-1,R&&(C=t[N-2],lt=t[M].sub(C)._unit()._perp());for(let P=M;P<N;P++){if(w=P===N-1?R?t[M+1]:void 0:t[P+1],w&&t[P].equals(w))continue;lt&&(_=lt),C&&(L=C),C=t[P],lt=w?w.sub(C)._unit()._perp():_,_=_||lt;let tt=_.add(lt);tt.x===0&&tt.y===0||tt._unit();let pt=_.x*lt.x+_.y*lt.y,Vt=tt.x*lt.x+tt.y*lt.y,Yt=Vt!==0?1/Vt:1/0,wt=2*Math.sqrt(2-2*Vt),Qt=Vt<CV&&L&&w,Ht=_.x*lt.y-_.y*lt.x>0;if(Qt&&P>M){let qt=C.dist(L);if(qt>2*J){let Lt=C.sub(C.sub(L)._mult(J/qt)._round());this.updateDistance(L,Lt),this.addCurrentVertex(Lt,_,0,0,S),L=Lt}}let ae=L&&w,Kt=ae?n:R?"butt":d;if(ae&&Kt==="round"&&(Yt<b?Kt="miter":Yt<=2&&(Kt="fakeround")),Kt==="miter"&&Yt>r&&(Kt="bevel"),Kt==="bevel"&&(Yt>2&&(Kt="flipbevel"),Yt<r&&(Kt="miter")),L&&this.updateDistance(L,C),Kt==="miter")tt._mult(Yt),this.addCurrentVertex(C,tt,0,0,S);else if(Kt==="flipbevel"){if(Yt>100)tt=lt.mult(-1);else{let qt=Yt*_.add(lt).mag()/_.sub(lt).mag();tt._perp()._mult(qt*(Ht?-1:1))}this.addCurrentVertex(C,tt,0,0,S),this.addCurrentVertex(C,tt.mult(-1),0,0,S)}else if(Kt==="bevel"||Kt==="fakeround"){let qt=-Math.sqrt(Yt*Yt-1),Lt=Ht?qt:0,Ze=Ht?0:qt;if(L&&this.addCurrentVertex(C,_,Lt,Ze,S),Kt==="fakeround"){let pe=Math.round(180*wt/Math.PI/20);for(let Fe=1;Fe<pe;Fe++){let re=Fe/pe;if(re!==.5){let Si=re-.5;re+=re*Si*(re-1)*((1.0904+pt*(pt*(3.55645-1.43519*pt)-3.2452))*Si*Si+(.848013+pt*(.215638*pt-1.06021)))}let He=lt.sub(_)._mult(re)._add(_)._unit()._mult(Ht?-1:1);this.addHalfVertex(C,He.x,He.y,!1,Ht,0,S)}}w&&this.addCurrentVertex(C,lt,-Lt,-Ze,S)}else if(Kt==="butt")this.addCurrentVertex(C,tt,0,0,S);else if(Kt==="square"){let qt=L?1:-1;this.addCurrentVertex(C,tt,qt,qt,S)}else Kt==="round"&&(L&&(this.addCurrentVertex(C,_,0,0,S),this.addCurrentVertex(C,_,1,1,S,!0)),w&&(this.addCurrentVertex(C,lt,-1,-1,S,!0),this.addCurrentVertex(C,lt,0,0,S)));if(Qt&&P<N-1){let qt=C.dist(w);if(qt>2*J){let Lt=C.add(w.sub(C)._mult(J/qt)._round());this.updateDistance(C,Lt),this.addCurrentVertex(Lt,lt,0,0,S),C=Lt}}}}addCurrentVertex(t,i,n,d,r,b=!1){let h=i.y*d-i.x,V=-i.y-i.x*d;this.addHalfVertex(t,i.x+i.y*n,i.y-i.x*n,b,!1,n,r),this.addHalfVertex(t,h,V,b,!0,-d,r),this.distance>YW/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(t,i,n,d,r,b))}addHalfVertex({x:t,y:i},n,d,r,b,h,V){let R=.5*(this.lineClips?this.scaledDistance*(YW-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((t<<1)+(r?1:0),(i<<1)+(b?1:0),Math.round(63*n)+128,Math.round(63*d)+128,1+(h===0?0:h<0?-1:1)|(63&R)<<2,R>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);let N=V.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,N,this.e2),V.primitiveLength++),b?this.e2=N:this.e1=N}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(t,i){this.distance+=t.dist(i),this.updateScaledDistance()}hasLineDasharray(t){for(let i of t){let n=i.paint.get("line-dasharray");if(n&&!n.isConstant())return!0}return!1}addLineDashDependencies(t,i,n,d){for(let r of t){let b=r.paint.get("line-dasharray");if(!b||b.value.kind==="constant")continue;let h=r.layout.get("line-cap")==="round",V={dasharray:b.value.evaluate({zoom:n-1},i,{}),round:h},R={dasharray:b.value.evaluate({zoom:n},i,{}),round:h},N={dasharray:b.value.evaluate({zoom:n+1},i,{}),round:h},M=`${V.dasharray.join(",")},${V.round}`,J=`${R.dasharray.join(",")},${R.round}`,S=`${N.dasharray.join(",")},${N.round}`;d.dashDependencies[M]=V,d.dashDependencies[J]=R,d.dashDependencies[S]=N,i.dashes[r.id]={min:M,mid:J,max:S}}}}let xW,TW;ne("LineBucket",Fm,{omit:["layers","patternFeatures"]});var XW={get paint(){return TW=TW||new ia({"line-opacity":new Re(K.paint_line["line-opacity"]),"line-color":new Re(K.paint_line["line-color"]),"line-translate":new me(K.paint_line["line-translate"]),"line-translate-anchor":new me(K.paint_line["line-translate-anchor"]),"line-width":new Re(K.paint_line["line-width"]),"line-gap-width":new Re(K.paint_line["line-gap-width"]),"line-offset":new Re(K.paint_line["line-offset"]),"line-blur":new Re(K.paint_line["line-blur"]),"line-dasharray":new co(K.paint_line["line-dasharray"]),"line-pattern":new co(K.paint_line["line-pattern"]),"line-gradient":new oo(K.paint_line["line-gradient"])})},get layout(){return xW=xW||new ia({"line-cap":new me(K.layout_line["line-cap"]),"line-join":new Re(K.layout_line["line-join"]),"line-miter-limit":new me(K.layout_line["line-miter-limit"]),"line-round-limit":new me(K.layout_line["line-round-limit"]),"line-sort-key":new Re(K.layout_line["line-sort-key"])})}};class kV extends Re{possiblyEvaluate(t,i){return i=new Vi(Math.floor(i.zoom),{now:i.now,fadeDuration:i.fadeDuration,zoomHistory:i.zoomHistory,transition:i.transition}),super.possiblyEvaluate(t,i)}evaluate(t,i,n,d){return i=ki({},i,{zoom:Math.floor(i.zoom)}),super.evaluate(t,i,n,d)}}let K0;class QV extends en{constructor(t,i){super(t,XW,i),this.gradientVersion=0,K0||(K0=new kV(XW.paint.properties["line-width"].specification),K0.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(t){if(t==="line-gradient"){let i=this.gradientExpression();this.stepInterpolant=!!(function(n){return n._styleExpression!==void 0})(i)&&i._styleExpression.expression instanceof F,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(t,i){super.recalculate(t,i),this.paint._values["line-floorwidth"]=K0.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,t)}createBucket(t){return new Fm(t)}queryRadius(t){let i=t,n=JW(Zr("line-width",this,i),Zr("line-gap-width",this,i)),d=Zr("line-offset",this,i);return n/2+Math.abs(d)+H0(this.paint.get("line-translate"))}queryIntersectsFeature({queryGeometry:t,feature:i,featureState:n,geometry:d,transform:r,pixelsToTileUnits:b}){let h=D0(t,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),-r.bearingInRadians,b),V=b/2*JW(this.paint.get("line-width").evaluate(i,n),this.paint.get("line-gap-width").evaluate(i,n)),R=this.paint.get("line-offset").evaluate(i,n);return R&&(d=(function(N,M){let J=[];for(let S=0;S<N.length;S++){let C=N[S],L=[];for(let w=0;w<C.length;w++){let _=C[w-1],lt=C[w],P=C[w+1],tt=w===0?new st(0,0):lt.sub(_)._unit()._perp(),pt=w===C.length-1?new st(0,0):P.sub(lt)._unit()._perp(),Vt=tt._add(pt)._unit(),Yt=Vt.x*pt.x+Vt.y*pt.y;Yt!==0&&Vt._mult(1/Yt),L.push(Vt._mult(M)._add(lt))}J.push(L)}return J})(d,R*b)),(function(N,M,J){for(let S=0;S<M.length;S++){let C=M[S];if(N.length>=3){for(let L=0;L<C.length;L++)if(hr(N,C[L]))return!0}if(vp(N,C,J))return!0}return!1})(h,d,V)}isTileClipped(){return!0}}function JW(l,t){return t>0?t+2*l:l}let LV=ll([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),EV=ll([{name:"a_projected_pos",components:3,type:"Float32"}],4);ll([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);let zV=ll([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);ll([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);let yW=ll([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),jV=ll([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function AV(l,t,i){return l.sections.forEach((n=>{n.text=(function(d,r,b){let h=r.layout.get("text-transform").evaluate(b,{});return h==="uppercase"?d=d.toLocaleUpperCase():h==="lowercase"&&(d=d.toLocaleLowerCase()),Id.applyArabicShaping&&(d=Id.applyArabicShaping(d)),d})(n.text,t,i)})),l}ll([{name:"triangle",components:3,type:"Uint16"}]),ll([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),ll([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),ll([{type:"Float32",name:"offsetX"}]),ll([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),ll([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);var Bl=24;let ks={"!":"\uFE15","#":"\uFF03",$:"\uFF04","%":"\uFF05","&":"\uFF06","(":"\uFE35",")":"\uFE36","*":"\uFF0A","+":"\uFF0B",",":"\uFE10","-":"\uFE32",".":"\u30FB","/":"\uFF0F",":":"\uFE13",";":"\uFE14","<":"\uFE3F","=":"\uFF1D",">":"\uFE40","?":"\uFE16","@":"\uFF20","[":"\uFE47","\\":"\uFF3C","]":"\uFE48","^":"\uFF3E",_:"\uFE33","`":"\uFF40","{":"\uFE37","|":"\u2015","}":"\uFE38","~":"\uFF5E","\xA2":"\uFFE0","\xA3":"\uFFE1","\xA5":"\uFFE5","\xA6":"\uFFE4","\xAC":"\uFFE2","\xAF":"\uFFE3","\u2013":"\uFE32","\u2014":"\uFE31","\u2018":"\uFE43","\u2019":"\uFE44","\u201C":"\uFE41","\u201D":"\uFE42","\u2026":"\uFE19","\u22EF":"\uFE19","\u2027":"\u30FB","\u20A9":"\uFFE6","\u3001":"\uFE11","\u3002":"\uFE12","\u3008":"\uFE3F","\u3009":"\uFE40","\u300A":"\uFE3D","\u300B":"\uFE3E","\u300C":"\uFE41","\u300D":"\uFE42","\u300E":"\uFE43","\u300F":"\uFE44","\u3010":"\uFE3B","\u3011":"\uFE3C","\u3014":"\uFE39","\u3015":"\uFE3A","\u3016":"\uFE17","\u3017":"\uFE18","\uFF01":"\uFE15","\uFF08":"\uFE35","\uFF09":"\uFE36","\uFF0C":"\uFE10","\uFF0D":"\uFE32","\uFF0E":"\u30FB","\uFF1A":"\uFE13","\uFF1B":"\uFE14","\uFF1C":"\uFE3F","\uFF1E":"\uFE40","\uFF1F":"\uFE16","\uFF3B":"\uFE47","\uFF3D":"\uFE48","\uFF3F":"\uFE33","\uFF5B":"\uFE37","\uFF5C":"\u2015","\uFF5D":"\uFE38","\uFF5F":"\uFE35","\uFF60":"\uFE36","\uFF61":"\uFE12","\uFF62":"\uFE41","\uFF63":"\uFE42"},wV={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},vV={40:!0};function BW(l,t,i,n,d,r){if("fontStack"in t){let b=i[t.fontStack],h=b&&b[l];return h?h.metrics.advance*t.scale+d:0}{let b=n[t.imageName];return b?b.displaySize[0]*t.scale*Bl/r+d:0}}function SW(l,t,i,n){let d=Math.pow(l-t,2);return n?l<t?d/2:2*d:d+Math.abs(i)*i}function HV(l,t,i){let n=0;return l===10&&(n-=1e4),i&&(n+=150),l!==40&&l!==65288||(n+=50),t!==41&&t!==65289||(n+=50),n}function CW(l,t,i,n,d,r){let b=null,h=SW(t,i,d,r);for(let V of n){let R=SW(t-V.x,i,d,r)+V.badness;R<=h&&(b=V,h=R)}return{index:l,x:t,priorBreak:b,badness:h}}function kW(l){return l?kW(l.priorBreak).concat(l.index):[]}class Rr{constructor(t="",i=[],n=[]){this.text=t,this.sections=i,this.sectionIndex=n,this.imageSectionID=null}static fromFeature(t,i){let n=new Rr;for(let d=0;d<t.sections.length;d++){let r=t.sections[d];r.image?n.addImageSection(r):n.addTextSection(r,i)}return n}length(){return[...this.text].length}getSection(t){return this.sections[this.sectionIndex[t]]}getSectionIndex(t){return this.sectionIndex[t]}verticalizePunctuation(){this.text=(function(t){let i="",n={premature:!0,value:void 0},d=t[Symbol.iterator](),r=d.next(),b=t[Symbol.iterator]();b.next();let h=b.next();for(;!r.done;)i+=!h.done&&Ws(h.value.codePointAt(0))&&!ks[h.value]||!n.premature&&Ws(n.value.codePointAt(0))&&!ks[n.value]||!ks[r.value]?r.value:ks[r.value],n={value:r.value,premature:!1},r=d.next(),h=b.next();return i})(this.text)}hasZeroWidthSpaces(){return this.text.includes("\u200B")}trim(){let t=this.text.match(/^\s*/),i=t?t[0].length:0,n=this.text.match(/\S\s*$/),d=n?n[0].length-1:0;this.text=this.text.substring(i,this.text.length-d),this.sectionIndex=this.sectionIndex.slice(i,this.sectionIndex.length-d)}substring(t,i){let n=[...this.text].slice(t,i).join(""),d=this.sectionIndex.slice(t,i);return new Rr(n,this.sections,d)}toCodeUnitIndex(t){return[...this.text].slice(0,t).join("").length}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce(((t,i)=>Math.max(t,this.sections[i].scale)),0)}getMaxImageSize(t){let i=0,n=0;for(let d=0;d<this.length();d++){let r=this.getSection(d);if("imageName"in r){let b=t[r.imageName];if(!b)continue;let h=b.displaySize;i=Math.max(i,h[0]),n=Math.max(n,h[1])}}return{maxImageWidth:i,maxImageHeight:n}}addTextSection(t,i){this.text+=t.text,this.sections.push({scale:t.scale||1,verticalAlign:t.verticalAlign||"bottom",fontStack:t.fontStack||i});let n=this.sections.length-1;this.sectionIndex.push(...[...t.text].map((()=>n)))}addImageSection(t){let i=t.image?t.image.name:"";if(i.length===0)return void ci("Can't add FormattedSection with an empty image.");let n=this.getNextImageSectionCharCode();n?(this.text+=String.fromCharCode(n),this.sections.push({scale:1,verticalAlign:t.verticalAlign||"bottom",imageName:i}),this.sectionIndex.push(this.sections.length-1)):ci("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}determineLineBreaks(t,i,n,d,r){let b=[],h=this.determineAverageLineWidth(t,i,n,d,r),V=this.hasZeroWidthSpaces(),R=0,N=0,M=this.text[Symbol.iterator](),J=M.next(),S=this.text[Symbol.iterator]();S.next();let C=S.next(),L=this.text[Symbol.iterator]();L.next(),L.next();let w=L.next();for(;!J.done;){let _=this.getSection(N),lt=J.value.codePointAt(0);if(y0(lt)||(R+=BW(lt,_,n,d,t,r)),!C.done){let P=tm(lt),tt=C.value.codePointAt(0);(wV[lt]||P||"imageName"in _||!w.done&&vV[tt])&&b.push(CW(N+1,R,h,b,HV(lt,tt,P&&V),!1))}N++,J=M.next(),C=S.next(),w=L.next()}return kW(CW(this.length(),R,h,b,0,!0))}determineAverageLineWidth(t,i,n,d,r){let b=0,h=0;for(let V of this.text){let R=this.getSection(h);b+=BW(V.codePointAt(0),R,n,d,t,r),h++}return b/Math.max(1,Math.ceil(b/i))}}let Gm=4294967296,QW=1/Gm,LW=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");class Nm{constructor(t=new Uint8Array(16)){this.buf=ArrayBuffer.isView(t)?t:new Uint8Array(t),this.dataView=new DataView(this.buf.buffer),this.pos=0,this.type=0,this.length=this.buf.length}readFields(t,i,n=this.length){for(;this.pos<n;){let d=this.readVarint(),r=d>>3,b=this.pos;this.type=7&d,t(r,i,this),this.pos===b&&this.skip(d)}return i}readMessage(t,i){return this.readFields(t,i,this.readVarint()+this.pos)}readFixed32(){let t=this.dataView.getUint32(this.pos,!0);return this.pos+=4,t}readSFixed32(){let t=this.dataView.getInt32(this.pos,!0);return this.pos+=4,t}readFixed64(){let t=this.dataView.getUint32(this.pos,!0)+this.dataView.getUint32(this.pos+4,!0)*Gm;return this.pos+=8,t}readSFixed64(){let t=this.dataView.getUint32(this.pos,!0)+this.dataView.getInt32(this.pos+4,!0)*Gm;return this.pos+=8,t}readFloat(){let t=this.dataView.getFloat32(this.pos,!0);return this.pos+=4,t}readDouble(){let t=this.dataView.getFloat64(this.pos,!0);return this.pos+=8,t}readVarint(t){let i=this.buf,n,d;return d=i[this.pos++],n=127&d,d<128?n:(d=i[this.pos++],n|=(127&d)<<7,d<128?n:(d=i[this.pos++],n|=(127&d)<<14,d<128?n:(d=i[this.pos++],n|=(127&d)<<21,d<128?n:(d=i[this.pos],n|=(15&d)<<28,(function(r,b,h){let V=h.buf,R,N;if(N=V[h.pos++],R=(112&N)>>4,N<128||(N=V[h.pos++],R|=(127&N)<<3,N<128)||(N=V[h.pos++],R|=(127&N)<<10,N<128)||(N=V[h.pos++],R|=(127&N)<<17,N<128)||(N=V[h.pos++],R|=(127&N)<<24,N<128)||(N=V[h.pos++],R|=(1&N)<<31,N<128))return Fr(r,R,b);throw new Error("Expected varint not more than 10 bytes")})(n,t,this)))))}readVarint64(){return this.readVarint(!0)}readSVarint(){let t=this.readVarint();return t%2==1?(t+1)/-2:t/2}readBoolean(){return!!this.readVarint()}readString(){let t=this.readVarint()+this.pos,i=this.pos;return this.pos=t,t-i>=12&&LW?LW.decode(this.buf.subarray(i,t)):(function(n,d,r){let b="",h=d;for(;h<r;){let V=n[h],R,N,M,J=null,S=V>239?4:V>223?3:V>191?2:1;if(h+S>r)break;S===1?V<128&&(J=V):S===2?(R=n[h+1],(192&R)==128&&(J=(31&V)<<6|63&R,J<=127&&(J=null))):S===3?(R=n[h+1],N=n[h+2],(192&R)==128&&(192&N)==128&&(J=(15&V)<<12|(63&R)<<6|63&N,(J<=2047||J>=55296&&J<=57343)&&(J=null))):S===4&&(R=n[h+1],N=n[h+2],M=n[h+3],(192&R)==128&&(192&N)==128&&(192&M)==128&&(J=(15&V)<<18|(63&R)<<12|(63&N)<<6|63&M,(J<=65535||J>=1114112)&&(J=null))),J===null?(J=65533,S=1):J>65535&&(J-=65536,b+=String.fromCharCode(J>>>10&1023|55296),J=56320|1023&J),b+=String.fromCharCode(J),h+=S}return b})(this.buf,i,t)}readBytes(){let t=this.readVarint()+this.pos,i=this.buf.subarray(this.pos,t);return this.pos=t,i}readPackedVarint(t=[],i){let n=this.readPackedEnd();for(;this.pos<n;)t.push(this.readVarint(i));return t}readPackedSVarint(t=[]){let i=this.readPackedEnd();for(;this.pos<i;)t.push(this.readSVarint());return t}readPackedBoolean(t=[]){let i=this.readPackedEnd();for(;this.pos<i;)t.push(this.readBoolean());return t}readPackedFloat(t=[]){let i=this.readPackedEnd();for(;this.pos<i;)t.push(this.readFloat());return t}readPackedDouble(t=[]){let i=this.readPackedEnd();for(;this.pos<i;)t.push(this.readDouble());return t}readPackedFixed32(t=[]){let i=this.readPackedEnd();for(;this.pos<i;)t.push(this.readFixed32());return t}readPackedSFixed32(t=[]){let i=this.readPackedEnd();for(;this.pos<i;)t.push(this.readSFixed32());return t}readPackedFixed64(t=[]){let i=this.readPackedEnd();for(;this.pos<i;)t.push(this.readFixed64());return t}readPackedSFixed64(t=[]){let i=this.readPackedEnd();for(;this.pos<i;)t.push(this.readSFixed64());return t}readPackedEnd(){return this.type===2?this.readVarint()+this.pos:this.pos+1}skip(t){let i=7&t;if(i===0)for(;this.buf[this.pos++]>127;);else if(i===2)this.pos=this.readVarint()+this.pos;else if(i===5)this.pos+=4;else{if(i!==1)throw new Error(`Unimplemented type: ${i}`);this.pos+=8}}writeTag(t,i){this.writeVarint(t<<3|i)}realloc(t){let i=this.length||16;for(;i<this.pos+t;)i*=2;if(i!==this.length){let n=new Uint8Array(i);n.set(this.buf),this.buf=n,this.dataView=new DataView(n.buffer),this.length=i}}finish(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)}writeFixed32(t){this.realloc(4),this.dataView.setInt32(this.pos,t,!0),this.pos+=4}writeSFixed32(t){this.realloc(4),this.dataView.setInt32(this.pos,t,!0),this.pos+=4}writeFixed64(t){this.realloc(8),this.dataView.setInt32(this.pos,-1&t,!0),this.dataView.setInt32(this.pos+4,Math.floor(t*QW),!0),this.pos+=8}writeSFixed64(t){this.realloc(8),this.dataView.setInt32(this.pos,-1&t,!0),this.dataView.setInt32(this.pos+4,Math.floor(t*QW),!0),this.pos+=8}writeVarint(t){(t=+t||0)>268435455||t<0?(function(i,n){let d,r;if(i>=0?(d=i%4294967296|0,r=i/4294967296|0):(d=~(-i%4294967296),r=~(-i/4294967296),4294967295^d?d=d+1|0:(d=0,r=r+1|0)),i>=18446744073709552e3||i<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");n.realloc(10),(function(b,h,V){V.buf[V.pos++]=127&b|128,b>>>=7,V.buf[V.pos++]=127&b|128,b>>>=7,V.buf[V.pos++]=127&b|128,b>>>=7,V.buf[V.pos++]=127&b|128,V.buf[V.pos]=127&(b>>>=7)})(d,0,n),(function(b,h){let V=(7&b)<<4;h.buf[h.pos++]|=V|((b>>>=3)?128:0),b&&(h.buf[h.pos++]=127&b|((b>>>=7)?128:0),b&&(h.buf[h.pos++]=127&b|((b>>>=7)?128:0),b&&(h.buf[h.pos++]=127&b|((b>>>=7)?128:0),b&&(h.buf[h.pos++]=127&b|((b>>>=7)?128:0),b&&(h.buf[h.pos++]=127&b)))))})(r,n)})(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))}writeSVarint(t){this.writeVarint(t<0?2*-t-1:2*t)}writeBoolean(t){this.writeVarint(+t)}writeString(t){t=String(t),this.realloc(4*t.length),this.pos++;let i=this.pos;this.pos=(function(d,r,b){for(let h,V,R=0;R<r.length;R++){if(h=r.charCodeAt(R),h>55295&&h<57344){if(!V){h>56319||R+1===r.length?(d[b++]=239,d[b++]=191,d[b++]=189):V=h;continue}if(h<56320){d[b++]=239,d[b++]=191,d[b++]=189,V=h;continue}h=V-55296<<10|h-56320|65536,V=null}else V&&(d[b++]=239,d[b++]=191,d[b++]=189,V=null);h<128?d[b++]=h:(h<2048?d[b++]=h>>6|192:(h<65536?d[b++]=h>>12|224:(d[b++]=h>>18|240,d[b++]=h>>12&63|128),d[b++]=h>>6&63|128),d[b++]=63&h|128)}return b})(this.buf,t,this.pos);let n=this.pos-i;n>=128&&EW(i,n,this),this.pos=i-1,this.writeVarint(n),this.pos+=n}writeFloat(t){this.realloc(4),this.dataView.setFloat32(this.pos,t,!0),this.pos+=4}writeDouble(t){this.realloc(8),this.dataView.setFloat64(this.pos,t,!0),this.pos+=8}writeBytes(t){let i=t.length;this.writeVarint(i),this.realloc(i);for(let n=0;n<i;n++)this.buf[this.pos++]=t[n]}writeRawMessage(t,i){this.pos++;let n=this.pos;t(i,this);let d=this.pos-n;d>=128&&EW(n,d,this),this.pos=n-1,this.writeVarint(d),this.pos+=d}writeMessage(t,i,n){this.writeTag(t,2),this.writeRawMessage(i,n)}writePackedVarint(t,i){i.length&&this.writeMessage(t,DV,i)}writePackedSVarint(t,i){i.length&&this.writeMessage(t,fV,i)}writePackedBoolean(t,i){i.length&&this.writeMessage(t,PV,i)}writePackedFloat(t,i){i.length&&this.writeMessage(t,OV,i)}writePackedDouble(t,i){i.length&&this.writeMessage(t,_V,i)}writePackedFixed32(t,i){i.length&&this.writeMessage(t,KV,i)}writePackedSFixed32(t,i){i.length&&this.writeMessage(t,qV,i)}writePackedFixed64(t,i){i.length&&this.writeMessage(t,$V,i)}writePackedSFixed64(t,i){i.length&&this.writeMessage(t,tg,i)}writeBytesField(t,i){this.writeTag(t,2),this.writeBytes(i)}writeFixed32Field(t,i){this.writeTag(t,5),this.writeFixed32(i)}writeSFixed32Field(t,i){this.writeTag(t,5),this.writeSFixed32(i)}writeFixed64Field(t,i){this.writeTag(t,1),this.writeFixed64(i)}writeSFixed64Field(t,i){this.writeTag(t,1),this.writeSFixed64(i)}writeVarintField(t,i){this.writeTag(t,0),this.writeVarint(i)}writeSVarintField(t,i){this.writeTag(t,0),this.writeSVarint(i)}writeStringField(t,i){this.writeTag(t,2),this.writeString(i)}writeFloatField(t,i){this.writeTag(t,5),this.writeFloat(i)}writeDoubleField(t,i){this.writeTag(t,1),this.writeDouble(i)}writeBooleanField(t,i){this.writeVarintField(t,+i)}}function Fr(l,t,i){return i?4294967296*t+(l>>>0):4294967296*(t>>>0)+(l>>>0)}function EW(l,t,i){let n=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(7*Math.LN2));i.realloc(n);for(let d=i.pos-1;d>=l;d--)i.buf[d+n]=i.buf[d]}function DV(l,t){for(let i=0;i<l.length;i++)t.writeVarint(l[i])}function fV(l,t){for(let i=0;i<l.length;i++)t.writeSVarint(l[i])}function OV(l,t){for(let i=0;i<l.length;i++)t.writeFloat(l[i])}function _V(l,t){for(let i=0;i<l.length;i++)t.writeDouble(l[i])}function PV(l,t){for(let i=0;i<l.length;i++)t.writeBoolean(l[i])}function KV(l,t){for(let i=0;i<l.length;i++)t.writeFixed32(l[i])}function qV(l,t){for(let i=0;i<l.length;i++)t.writeSFixed32(l[i])}function $V(l,t){for(let i=0;i<l.length;i++)t.writeFixed64(l[i])}function tg(l,t){for(let i=0;i<l.length;i++)t.writeSFixed64(l[i])}function eg(l,t,i){l===1&&i.readMessage(ig,t)}function ig(l,t,i){if(l===3){let{id:n,bitmap:d,width:r,height:b,left:h,top:V,advance:R}=i.readMessage(lg,{});t.push({id:n,bitmap:new Ys({width:r+6,height:b+6},d),metrics:{width:r,height:b,left:h,top:V,advance:R}})}}function lg(l,t,i){l===1?t.id=i.readVarint():l===2?t.bitmap=i.readBytes():l===3?t.width=i.readVarint():l===4?t.height=i.readVarint():l===5?t.left=i.readSVarint():l===6?t.top=i.readSVarint():l===7&&(t.advance=i.readVarint())}function zW(l){let t=0,i=0;for(let b of l)t+=b.w*b.h,i=Math.max(i,b.w);l.sort(((b,h)=>h.h-b.h));let n=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),i),h:1/0}],d=0,r=0;for(let b of l)for(let h=n.length-1;h>=0;h--){let V=n[h];if(!(b.w>V.w||b.h>V.h)){if(b.x=V.x,b.y=V.y,r=Math.max(r,b.y+b.h),d=Math.max(d,b.x+b.w),b.w===V.w&&b.h===V.h){let R=n.pop();R&&h<n.length&&(n[h]=R)}else b.h===V.h?(V.x+=b.w,V.w-=b.w):b.w===V.w?(V.y+=b.h,V.h-=b.h):(n.push({x:V.x+b.w,y:V.y,w:V.w-b.w,h:b.h}),V.y+=b.h,V.h-=b.h);break}}return{w:d,h:r,fill:t/(d*r)||0}}class Im{constructor(t,{pixelRatio:i,version:n,stretchX:d,stretchY:r,content:b,textFitWidth:h,textFitHeight:V}){this.paddedRect=t,this.pixelRatio=i,this.stretchX=d,this.stretchY=r,this.content=b,this.version=n,this.textFitWidth=h,this.textFitHeight=V}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class jW{constructor(t,i){let n={},d={};this.haveRenderCallbacks=[];let r=[];this.addImages(t,n,r),this.addImages(i,d,r);let{w:b,h}=zW(r),V=new za({width:b||1,height:h||1});for(let R in t){let N=t[R],M=n[R].paddedRect;za.copy(N.data,V,{x:0,y:0},{x:M.x+1,y:M.y+1},N.data)}for(let R in i){let N=i[R],M=d[R].paddedRect,J=M.x+1,S=M.y+1,C=N.data.width,L=N.data.height;za.copy(N.data,V,{x:0,y:0},{x:J,y:S},N.data),za.copy(N.data,V,{x:0,y:L-1},{x:J,y:S-1},{width:C,height:1}),za.copy(N.data,V,{x:0,y:0},{x:J,y:S+L},{width:C,height:1}),za.copy(N.data,V,{x:C-1,y:0},{x:J-1,y:S},{width:1,height:L}),za.copy(N.data,V,{x:0,y:0},{x:J+C,y:S},{width:1,height:L})}this.image=V,this.iconPositions=n,this.patternPositions=d}addImages(t,i,n){for(let d in t){let r=t[d],b={x:0,y:0,w:r.data.width+2,h:r.data.height+2};n.push(b),i[d]=new Im(b,r),r.hasRenderCallback&&this.haveRenderCallbacks.push(d)}}patchUpdatedImages(t,i){t.dispatchRenderCallbacks(this.haveRenderCallbacks);for(let n in t.updatedImages)this.patchUpdatedImage(this.iconPositions[n],t.getImage(n),i),this.patchUpdatedImage(this.patternPositions[n],t.getImage(n),i)}patchUpdatedImage(t,i,n){if(!t||!i||t.version===i.version)return;t.version=i.version;let[d,r]=t.tl;n.update(i.data,void 0,{x:d,y:r})}}var Nc;function q0(l,t,i,n,d,r,b,h,V,R,N,M,J,S,C){let L=Rr.fromFeature(l,d),w;M===I.ay.vertical&&L.verticalizePunctuation();let _=L.determineLineBreaks(R,r,t,n,S),{processBidirectionalText:lt,processStyledBidirectionalText:P}=Id;if(lt&&L.sections.length===1){w=[],_=_.map((Yt=>L.toCodeUnitIndex(Yt)));let Vt=lt(L.toString(),_);for(let Yt of Vt){let wt=[...Yt].map((()=>0));w.push(new Rr(Yt,L.sections,wt))}}else if(P){w=[],_=_.map((Qt=>L.toCodeUnitIndex(Qt)));let Vt=0,Yt=[];for(let Qt of L.text)Yt.push(...Array(Qt.length).fill(L.sectionIndex[Vt])),Vt++;let wt=P(L.text,Yt,_);for(let Qt of wt){let Ht=[],ae="";for(let Kt of Qt[0])Ht.push(Qt[1][ae.length]),ae+=Kt;w.push(new Rr(Qt[0],L.sections,Ht))}}else w=(function(Vt,Yt){let wt=[],Qt=0;for(let Ht of Yt)wt.push(Vt.substring(Qt,Ht)),Qt=Ht;return Qt<Vt.length()&&wt.push(Vt.substring(Qt,Vt.length())),wt})(L,_);let tt=[],pt={positionedLines:tt,text:L.toString(),top:N[1],bottom:N[1],left:N[0],right:N[0],writingMode:M,iconsInText:!1,verticalizable:!1};return(function(Vt,Yt,wt,Qt,Ht,ae,Kt,qt,Lt,Ze,pe,Fe){let re=0,He=0,Si=0,gl=0,na=qt==="right"?1:qt==="left"?0:.5,Jn=Bl/Fe,ya=0;for(let nl of Ht){nl.trim();let fl=nl.getMaxScale(),ua={positionedGlyphs:[],lineOffset:0};Vt.positionedLines[ya]=ua;let Ra=ua.positionedGlyphs,ja=0;if(!nl.length()){He+=ae,++ya;continue}let ca=ag(Qt,nl,Jn),Aa=0;for(let kl of nl.text){let Ai=nl.getSection(Aa),ul=kl.codePointAt(0),Ki=ng(Lt,pe,ul),Ql={glyph:ul,imageName:null,x:re,y:He+-17,vertical:Ki,scale:1,fontStack:"",sectionIndex:nl.getSectionIndex(Aa),metrics:null,rect:null},$d;if("fontStack"in Ai){if($d=dg(Ai,ul,Ki,ca,Yt,wt),!$d)continue;Ql.fontStack=Ai.fontStack}else{if(Vt.iconsInText=!0,Ai.scale*=Jn,$d=cg(Ai,Ki,fl,ca,Qt),!$d)continue;ja=Math.max(ja,$d.imageOffset),Ql.imageName=Ai.imageName}let{rect:rd,metrics:fs,baselineOffset:xc}=$d;Ql.y+=xc,Ql.scale=Ai.scale,Ql.metrics=fs,Ql.rect=rd,Ra.push(Ql),Ki?(Vt.verticalizable=!0,re+=("imageName"in Ai?fs.advance:Bl)*Ai.scale+Ze):re+=fs.advance*Ai.scale+Ze,Aa++}Ra.length!==0&&(Si=Math.max(re-Ze,Si),og(Ra,0,Ra.length-1,na)),re=0,ua.lineOffset=Math.max(ja,(fl-1)*Bl);let yn=ae*fl+ja;He+=yn,gl=Math.max(yn,gl),++ya}let{horizontalAlign:Dl,verticalAlign:da}=Um(Kt);(function(nl,fl,ua,Ra,ja,ca,Aa,yn,kl){let Ai=(fl-ua)*ja,ul=0;ul=ca!==Aa?-yn*Ra- -17:-Ra*kl*Aa+.5*Aa;for(let Ki of nl)for(let Ql of Ki.positionedGlyphs)Ql.x+=Ai,Ql.y+=ul})(Vt.positionedLines,na,Dl,da,Si,gl,ae,He,Ht.length),Vt.top+=-da*He,Vt.bottom=Vt.top+He,Vt.left+=-Dl*Si,Vt.right=Vt.left+Si})(pt,t,i,n,w,b,h,V,M,R,J,C),!(function(Vt){for(let Yt of Vt)if(Yt.positionedGlyphs.length!==0)return!1;return!0})(tt)&&pt}function Um(l){let t=.5,i=.5;switch(l){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(l){case"bottom":case"bottom-right":case"bottom-left":i=1;break;case"top":case"top-right":case"top-left":i=0}return{horizontalAlign:t,verticalAlign:i}}function ag(l,t,i){let n=t.getMaxScale()*Bl,{maxImageWidth:d,maxImageHeight:r}=t.getMaxImageSize(l),b=Math.max(n,r*i);return{verticalLineContentWidth:Math.max(n,d*i),horizontalLineContentHeight:b}}function AW(l){switch(l){case"top":return 0;case"center":return .5;default:return 1}}function ng(l,t,i){return!(l===I.ay.horizontal||!t&&!Rc(i)||t&&(y0(i)||(n=i,/\p{sc=Arab}/u.test(String.fromCodePoint(n)))));var n}function dg(l,t,i,n,d,r){let b=r[l.fontStack],h=(function(R,N,M,J){if(R&&R.rect)return R;let S=N[M.fontStack],C=S&&S[J];return C?{rect:null,metrics:C.metrics}:null})(b&&b[t],d,l,t);if(h===null)return null;let V;if(i)V=n.verticalLineContentWidth-l.scale*Bl;else{let R=AW(l.verticalAlign);V=(n.horizontalLineContentHeight-l.scale*Bl)*R}return{rect:h.rect,metrics:h.metrics,baselineOffset:V}}function cg(l,t,i,n,d){let r=d[l.imageName];if(!r)return null;let b=r.paddedRect,h=r.displaySize,V={width:h[0],height:h[1],left:1,top:-3,advance:t?h[1]:h[0]},R;if(t)R=n.verticalLineContentWidth-h[1]*l.scale;else{let N=AW(l.verticalAlign);R=(n.horizontalLineContentHeight-h[1]*l.scale)*N}return{rect:b,metrics:V,baselineOffset:R,imageOffset:(t?h[0]:h[1])*l.scale-Bl*i}}function og(l,t,i,n){if(n===0)return;let d=l[i],r=(l[i].x+d.metrics.advance*d.scale)*n;for(let b=t;b<=i;b++)l[b].x-=r}function rg(l,t,i){let{horizontalAlign:n,verticalAlign:d}=Um(i),r=t[0]-l.displaySize[0]*n,b=t[1]-l.displaySize[1]*d;return{image:l,top:b,bottom:b+l.displaySize[1],left:r,right:r+l.displaySize[0]}}function wW(l){var t,i;let n=l.left,d=l.top,r=l.right-n,b=l.bottom-d,h=(t=l.image.textFitWidth)!==null&&t!==void 0?t:"stretchOrShrink",V=(i=l.image.textFitHeight)!==null&&i!==void 0?i:"stretchOrShrink",R=(l.image.content[2]-l.image.content[0])/(l.image.content[3]-l.image.content[1]);if(V==="proportional"){if(h==="stretchOnly"&&r/b<R||h==="proportional"){let N=Math.ceil(b*R);n*=N/r,r=N}}else if(h==="proportional"&&V==="stretchOnly"&&R!==0&&r/b>R){let N=Math.ceil(r/R);d*=N/b,b=N}return{x1:n,y1:d,x2:n+r,y2:d+b}}function vW(l,t,i,n,d,r){let b=l.image,h;if(b.content){let w=b.content,_=b.pixelRatio||1;h=[w[0]/_,w[1]/_,b.displaySize[0]-w[2]/_,b.displaySize[1]-w[3]/_]}let V=t.left*r,R=t.right*r,N,M,J,S;i==="width"||i==="both"?(S=d[0]+V-n[3],M=d[0]+R+n[1]):(S=d[0]+(V+R-b.displaySize[0])/2,M=S+b.displaySize[0]);let C=t.top*r,L=t.bottom*r;return i==="height"||i==="both"?(N=d[1]+C-n[0],J=d[1]+L+n[2]):(N=d[1]+(C+L-b.displaySize[1])/2,J=N+b.displaySize[1]),{image:b,top:N,right:M,bottom:J,left:S,collisionPadding:h}}ne("ImagePosition",Im),ne("ImageAtlas",jW),I.ay=void 0,(Nc=I.ay||(I.ay={}))[Nc.none=0]="none",Nc[Nc.horizontal=1]="horizontal",Nc[Nc.vertical=2]="vertical",Nc[Nc.horizontalOnly=3]="horizontalOnly";let Kd=128,Ic=32640;function HW(l,t){let{expression:i}=t;if(i.kind==="constant")return{kind:"constant",layoutSize:i.evaluate(new Vi(l+1))};if(i.kind==="source")return{kind:"source"};{let{zoomStops:n,interpolationType:d}=i,r=0;for(;r<n.length&&n[r]<=l;)r++;r=Math.max(0,r-1);let b=r;for(;b<n.length&&n[b]<l+1;)b++;b=Math.min(n.length-1,b);let h=n[r],V=n[b];return i.kind==="composite"?{kind:"composite",minZoom:h,maxZoom:V,interpolationType:d}:{kind:"camera",minZoom:h,maxZoom:V,minSize:i.evaluate(new Vi(h)),maxSize:i.evaluate(new Vi(V)),interpolationType:d}}}function Mm(l,t,i){let n="never",d=l.get(t);return d?n=d:l.get(i)&&(n="always"),n}let sg=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function $0(l,t,i,n,d,r,b,h,V,R,N,M,J){let S=h?Math.min(Ic,Math.round(h[0])):0,C=h?Math.min(Ic,Math.round(h[1])):0;l.emplaceBack(t,i,Math.round(32*n),Math.round(32*d),r,b,(S<<1)+(V?1:0),C,16*R,16*N,256*M,256*J)}function Ym(l,t,i){l.emplaceBack(t.x,t.y,i),l.emplaceBack(t.x,t.y,i),l.emplaceBack(t.x,t.y,i),l.emplaceBack(t.x,t.y,i)}function bg(l){for(let t of l.sections)if(C0(t.text))return!0;return!1}class xm{constructor(t){this.layoutVertexArray=new Xt,this.indexArray=new Pt,this.programConfigurations=t,this.segments=new Je,this.dynamicLayoutVertexArray=new It,this.opacityVertexArray=new Ut,this.hasVisibleVertices=!1,this.placedSymbolArray=new G}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(t,i,n,d){this.isEmpty()||(n&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,LV.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,i),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,EV.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,sg,!0),this.opacityVertexBuffer.itemSize=1),(n||d)&&this.programConfigurations.upload(t))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}ne("SymbolBuffers",xm);class Tm{constructor(t,i,n){this.layoutVertexArray=new t,this.layoutAttributes=i,this.indexArray=new n,this.segments=new Je,this.collisionVertexArray=new $t}upload(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,zV.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}ne("CollisionBuffers",Tm);class Gr{constructor(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((b=>b.id)),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasDependencies=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[];let i=this.layers[0]._unevaluatedLayout._values;this.textSizeData=HW(this.zoom,i["text-size"]),this.iconSizeData=HW(this.zoom,i["icon-size"]);let n=this.layers[0].layout,d=n.get("symbol-sort-key"),r=n.get("symbol-z-order");this.canOverlap=Mm(n,"text-overlap","text-allow-overlap")!=="never"||Mm(n,"icon-overlap","icon-allow-overlap")!=="never"||n.get("text-ignore-placement")||n.get("icon-ignore-placement"),this.sortFeaturesByKey=r!=="viewport-y"&&!d.isConstant(),this.sortFeaturesByY=(r==="viewport-y"||r==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,n.get("symbol-placement")==="point"&&(this.writingModes=n.get("text-writing-mode").map((b=>I.ay[b]))),this.stateDependentLayerIds=this.layers.filter((b=>b.isStateDependent())).map((b=>b.id)),this.sourceID=t.sourceID}createArrays(){this.text=new xm(new Pd(this.layers,this.zoom,(t=>/^text/.test(t)))),this.icon=new xm(new Pd(this.layers,this.zoom,(t=>/^icon/.test(t)))),this.glyphOffsetArray=new Q,this.lineVertexArray=new k,this.symbolInstances=new X,this.textAnchorOffsets=new H}calculateGlyphDependencies(t,i,n,d,r){for(let b of t)if(i[b.codePointAt(0)]=!0,(n||d)&&r){let h=ks[b];h&&(i[h.codePointAt(0)]=!0)}}populate(t,i,n){let d=this.layers[0],r=d.layout,b=r.get("text-font"),h=r.get("text-field"),V=r.get("icon-image"),R=(h.value.kind!=="constant"||h.value.value instanceof fi&&!h.value.value.isEmpty()||h.value.value.toString().length>0)&&(b.value.kind!=="constant"||b.value.value.length>0),N=V.value.kind!=="constant"||!!V.value.value||Object.keys(V.parameters).length>0,M=r.get("symbol-sort-key");if(this.features=[],!R&&!N)return;let J=i.iconDependencies,S=i.glyphDependencies,C=i.availableImages,L=new Vi(this.zoom);for(let{feature:w,id:_,index:lt,sourceLayerIndex:P}of t){let tt=d._featureFilter.needGeometry,pt=dd(w,tt);if(!d._featureFilter.filter(L,pt,n))continue;let Vt,Yt;if(tt||(pt.geometry=Td(w)),R){let Qt=d.getValueAndResolveTokens("text-field",pt,n,C),Ht=fi.factory(Qt),ae=this.hasRTLText=this.hasRTLText||bg(Ht);(!ae||Id.getRTLTextPluginStatus()==="unavailable"||ae&&Id.isParsed())&&(Vt=AV(Ht,d,pt))}if(N){let Qt=d.getValueAndResolveTokens("icon-image",pt,n,C);Yt=Qt instanceof ta?Qt:ta.fromString(Qt)}if(!Vt&&!Yt)continue;let wt=this.sortFeaturesByKey?M.evaluate(pt,{},n):void 0;if(this.features.push({id:_,text:Vt,icon:Yt,index:lt,sourceLayerIndex:P,geometry:pt.geometry,properties:w.properties,type:ur.types[w.type],sortKey:wt}),Yt&&(J[Yt.name]=!0),Vt){let Qt=b.evaluate(pt,{},n).join(","),Ht=r.get("text-rotation-alignment")!=="viewport"&&r.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(I.ay.vertical)>=0;for(let ae of Vt.sections)if(ae.image)J[ae.image.name]=!0;else{let Kt=lo(Vt.toString()),qt=ae.fontStack||Qt,Lt=S[qt]=S[qt]||{};this.calculateGlyphDependencies(ae.text,Lt,Ht,this.allowVerticalPlacement,Kt)}}}r.get("symbol-placement")==="line"&&(this.features=(function(w){let _={},lt={},P=[],tt=0;function pt(Qt){P.push(w[Qt]),tt++}function Vt(Qt,Ht,ae){let Kt=lt[Qt];return delete lt[Qt],lt[Ht]=Kt,P[Kt].geometry[0].pop(),P[Kt].geometry[0]=P[Kt].geometry[0].concat(ae[0]),Kt}function Yt(Qt,Ht,ae){let Kt=_[Ht];return delete _[Ht],_[Qt]=Kt,P[Kt].geometry[0].shift(),P[Kt].geometry[0]=ae[0].concat(P[Kt].geometry[0]),Kt}function wt(Qt,Ht,ae){let Kt=ae?Ht[0][Ht[0].length-1]:Ht[0][0];return`${Qt}:${Kt.x}:${Kt.y}`}for(let Qt=0;Qt<w.length;Qt++){let Ht=w[Qt],ae=Ht.geometry,Kt=Ht.text?Ht.text.toString():null;if(!Kt){pt(Qt);continue}let qt=wt(Kt,ae),Lt=wt(Kt,ae,!0);if(qt in lt&&Lt in _&&lt[qt]!==_[Lt]){let Ze=Yt(qt,Lt,ae),pe=Vt(qt,Lt,P[Ze].geometry);delete _[qt],delete lt[Lt],lt[wt(Kt,P[pe].geometry,!0)]=pe,P[Ze].geometry=null}else qt in lt?Vt(qt,Lt,ae):Lt in _?Yt(qt,Lt,ae):(pt(Qt),_[qt]=tt-1,lt[Lt]=tt-1)}return P.filter((Qt=>Qt.geometry))})(this.features)),this.sortFeaturesByKey&&this.features.sort(((w,_)=>w.sortKey-_.sortKey))}update(t,i,n){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(t,i,this.layers,{imagePositions:n}),this.icon.programConfigurations.updatePaintArrays(t,i,this.layers,{imagePositions:n}))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(t,i){let n=this.lineVertexArray.length;if(t.segment!==void 0){let d=t.dist(i[t.segment+1]),r=t.dist(i[t.segment]),b={};for(let h=t.segment+1;h<i.length;h++)b[h]={x:i[h].x,y:i[h].y,tileUnitDistanceFromAnchor:d},h<i.length-1&&(d+=i[h+1].dist(i[h]));for(let h=t.segment||0;h>=0;h--)b[h]={x:i[h].x,y:i[h].y,tileUnitDistanceFromAnchor:r},h>0&&(r+=i[h-1].dist(i[h]));for(let h=0;h<i.length;h++){let V=b[h];this.lineVertexArray.emplaceBack(V.x,V.y,V.tileUnitDistanceFromAnchor)}}return{lineStartIndex:n,lineLength:this.lineVertexArray.length-n}}addSymbols(t,i,n,d,r,b,h,V,R,N,M,J){let S=t.indexArray,C=t.layoutVertexArray,L=t.segments.prepareSegment(4*i.length,C,S,this.canOverlap?b.sortKey:void 0),w=this.glyphOffsetArray.length,_=L.vertexLength,lt=this.allowVerticalPlacement&&h===I.ay.vertical?Math.PI/2:0,P=b.text&&b.text.sections;for(let tt=0;tt<i.length;tt++){let{tl:pt,tr:Vt,bl:Yt,br:wt,tex:Qt,pixelOffsetTL:Ht,pixelOffsetBR:ae,minFontScaleX:Kt,minFontScaleY:qt,glyphOffset:Lt,isSDF:Ze,sectionIndex:pe}=i[tt],Fe=L.vertexLength,re=Lt[1];$0(C,V.x,V.y,pt.x,re+pt.y,Qt.x,Qt.y,n,Ze,Ht.x,Ht.y,Kt,qt),$0(C,V.x,V.y,Vt.x,re+Vt.y,Qt.x+Qt.w,Qt.y,n,Ze,ae.x,Ht.y,Kt,qt),$0(C,V.x,V.y,Yt.x,re+Yt.y,Qt.x,Qt.y+Qt.h,n,Ze,Ht.x,ae.y,Kt,qt),$0(C,V.x,V.y,wt.x,re+wt.y,Qt.x+Qt.w,Qt.y+Qt.h,n,Ze,ae.x,ae.y,Kt,qt),Ym(t.dynamicLayoutVertexArray,V,lt),S.emplaceBack(Fe,Fe+2,Fe+1),S.emplaceBack(Fe+1,Fe+2,Fe+3),L.vertexLength+=4,L.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Lt[0]),tt!==i.length-1&&pe===i[tt+1].sectionIndex||t.programConfigurations.populatePaintArrays(C.length,b,b.index,{imagePositions:{},canonical:J,formattedSection:P&&P[pe]})}t.placedSymbolArray.emplaceBack(V.x,V.y,w,this.glyphOffsetArray.length-w,_,R,N,V.segment,n?n[0]:0,n?n[1]:0,d[0],d[1],h,0,!1,0,M)}_addCollisionDebugVertex(t,i,n,d,r,b){return i.emplaceBack(0,0),t.emplaceBack(n.x,n.y,d,r,Math.round(b.x),Math.round(b.y))}addCollisionDebugVertices(t,i,n,d,r,b,h){let V=r.segments.prepareSegment(4,r.layoutVertexArray,r.indexArray),R=V.vertexLength,N=r.layoutVertexArray,M=r.collisionVertexArray,J=h.anchorX,S=h.anchorY;this._addCollisionDebugVertex(N,M,b,J,S,new st(t,i)),this._addCollisionDebugVertex(N,M,b,J,S,new st(n,i)),this._addCollisionDebugVertex(N,M,b,J,S,new st(n,d)),this._addCollisionDebugVertex(N,M,b,J,S,new st(t,d)),V.vertexLength+=4;let C=r.indexArray;C.emplaceBack(R,R+1),C.emplaceBack(R+1,R+2),C.emplaceBack(R+2,R+3),C.emplaceBack(R+3,R),V.primitiveLength+=4}addDebugCollisionBoxes(t,i,n,d){for(let r=t;r<i;r++){let b=this.collisionBoxArray.get(r);this.addCollisionDebugVertices(b.x1,b.y1,b.x2,b.y2,d?this.textCollisionBox:this.iconCollisionBox,b.anchorPoint,n)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Tm(xt,yW.members,At),this.iconCollisionBox=new Tm(xt,yW.members,At);for(let t=0;t<this.symbolInstances.length;t++){let i=this.symbolInstances.get(t);this.addDebugCollisionBoxes(i.textBoxStartIndex,i.textBoxEndIndex,i,!0),this.addDebugCollisionBoxes(i.verticalTextBoxStartIndex,i.verticalTextBoxEndIndex,i,!0),this.addDebugCollisionBoxes(i.iconBoxStartIndex,i.iconBoxEndIndex,i,!1),this.addDebugCollisionBoxes(i.verticalIconBoxStartIndex,i.verticalIconBoxEndIndex,i,!1)}}_deserializeCollisionBoxesForSymbol(t,i,n,d,r,b,h,V,R){let N={};for(let M=i;M<n;M++){let J=t.get(M);N.textBox={x1:J.x1,y1:J.y1,x2:J.x2,y2:J.y2,anchorPointX:J.anchorPointX,anchorPointY:J.anchorPointY},N.textFeatureIndex=J.featureIndex;break}for(let M=d;M<r;M++){let J=t.get(M);N.verticalTextBox={x1:J.x1,y1:J.y1,x2:J.x2,y2:J.y2,anchorPointX:J.anchorPointX,anchorPointY:J.anchorPointY},N.verticalTextFeatureIndex=J.featureIndex;break}for(let M=b;M<h;M++){let J=t.get(M);N.iconBox={x1:J.x1,y1:J.y1,x2:J.x2,y2:J.y2,anchorPointX:J.anchorPointX,anchorPointY:J.anchorPointY},N.iconFeatureIndex=J.featureIndex;break}for(let M=V;M<R;M++){let J=t.get(M);N.verticalIconBox={x1:J.x1,y1:J.y1,x2:J.x2,y2:J.y2,anchorPointX:J.anchorPointX,anchorPointY:J.anchorPointY},N.verticalIconFeatureIndex=J.featureIndex;break}return N}deserializeCollisionBoxes(t){this.collisionArrays=[];for(let i=0;i<this.symbolInstances.length;i++){let n=this.symbolInstances.get(i);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,n.textBoxStartIndex,n.textBoxEndIndex,n.verticalTextBoxStartIndex,n.verticalTextBoxEndIndex,n.iconBoxStartIndex,n.iconBoxEndIndex,n.verticalIconBoxStartIndex,n.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(t,i){let n=t.placedSymbolArray.get(i),d=n.vertexStartIndex+4*n.numGlyphs;for(let r=n.vertexStartIndex;r<d;r+=4)t.indexArray.emplaceBack(r,r+2,r+1),t.indexArray.emplaceBack(r+1,r+2,r+3)}getSortedSymbolIndexes(t){if(this.sortedAngle===t&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;let i=Math.sin(t),n=Math.cos(t),d=[],r=[],b=[];for(let h=0;h<this.symbolInstances.length;++h){b.push(h);let V=this.symbolInstances.get(h);d.push(0|Math.round(i*V.anchorX+n*V.anchorY)),r.push(V.featureIndex)}return b.sort(((h,V)=>d[h]-d[V]||r[V]-r[h])),b}addToSortKeyRanges(t,i){let n=this.sortKeyRanges[this.sortKeyRanges.length-1];n&&n.sortKey===i?n.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:i,symbolInstanceStart:t,symbolInstanceEnd:t+1})}sortFeatures(t){if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(let i of this.symbolInstanceIndexes){let n=this.symbolInstances.get(i);this.featureSortOrder.push(n.featureIndex),[n.rightJustifiedTextSymbolIndex,n.centerJustifiedTextSymbolIndex,n.leftJustifiedTextSymbolIndex].forEach(((d,r,b)=>{d>=0&&b.indexOf(d)===r&&this.addIndicesForPlacedSymbol(this.text,d)})),n.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,n.verticalPlacedTextSymbolIndex),n.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,n.placedIconSymbolIndex),n.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,n.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let DW,fW;ne("SymbolBucket",Gr,{omit:["layers","collisionBoxArray","features","compareText"]}),Gr.MAX_GLYPHS=65535,Gr.addDynamicAttributes=Ym;var Xm={get paint(){return fW=fW||new ia({"icon-opacity":new Re(K.paint_symbol["icon-opacity"]),"icon-color":new Re(K.paint_symbol["icon-color"]),"icon-halo-color":new Re(K.paint_symbol["icon-halo-color"]),"icon-halo-width":new Re(K.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Re(K.paint_symbol["icon-halo-blur"]),"icon-translate":new me(K.paint_symbol["icon-translate"]),"icon-translate-anchor":new me(K.paint_symbol["icon-translate-anchor"]),"text-opacity":new Re(K.paint_symbol["text-opacity"]),"text-color":new Re(K.paint_symbol["text-color"],{runtimeType:jl,getOverride:l=>l.textColor,hasOverride:l=>!!l.textColor}),"text-halo-color":new Re(K.paint_symbol["text-halo-color"]),"text-halo-width":new Re(K.paint_symbol["text-halo-width"]),"text-halo-blur":new Re(K.paint_symbol["text-halo-blur"]),"text-translate":new me(K.paint_symbol["text-translate"]),"text-translate-anchor":new me(K.paint_symbol["text-translate-anchor"])})},get layout(){return DW=DW||new ia({"symbol-placement":new me(K.layout_symbol["symbol-placement"]),"symbol-spacing":new me(K.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new me(K.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Re(K.layout_symbol["symbol-sort-key"]),"symbol-z-order":new me(K.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new me(K.layout_symbol["icon-allow-overlap"]),"icon-overlap":new me(K.layout_symbol["icon-overlap"]),"icon-ignore-placement":new me(K.layout_symbol["icon-ignore-placement"]),"icon-optional":new me(K.layout_symbol["icon-optional"]),"icon-rotation-alignment":new me(K.layout_symbol["icon-rotation-alignment"]),"icon-size":new Re(K.layout_symbol["icon-size"]),"icon-text-fit":new me(K.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new me(K.layout_symbol["icon-text-fit-padding"]),"icon-image":new Re(K.layout_symbol["icon-image"]),"icon-rotate":new Re(K.layout_symbol["icon-rotate"]),"icon-padding":new Re(K.layout_symbol["icon-padding"]),"icon-keep-upright":new me(K.layout_symbol["icon-keep-upright"]),"icon-offset":new Re(K.layout_symbol["icon-offset"]),"icon-anchor":new Re(K.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new me(K.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new me(K.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new me(K.layout_symbol["text-rotation-alignment"]),"text-field":new Re(K.layout_symbol["text-field"]),"text-font":new Re(K.layout_symbol["text-font"]),"text-size":new Re(K.layout_symbol["text-size"]),"text-max-width":new Re(K.layout_symbol["text-max-width"]),"text-line-height":new me(K.layout_symbol["text-line-height"]),"text-letter-spacing":new Re(K.layout_symbol["text-letter-spacing"]),"text-justify":new Re(K.layout_symbol["text-justify"]),"text-radial-offset":new Re(K.layout_symbol["text-radial-offset"]),"text-variable-anchor":new me(K.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new Re(K.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new Re(K.layout_symbol["text-anchor"]),"text-max-angle":new me(K.layout_symbol["text-max-angle"]),"text-writing-mode":new me(K.layout_symbol["text-writing-mode"]),"text-rotate":new Re(K.layout_symbol["text-rotate"]),"text-padding":new me(K.layout_symbol["text-padding"]),"text-keep-upright":new me(K.layout_symbol["text-keep-upright"]),"text-transform":new Re(K.layout_symbol["text-transform"]),"text-offset":new Re(K.layout_symbol["text-offset"]),"text-allow-overlap":new me(K.layout_symbol["text-allow-overlap"]),"text-overlap":new me(K.layout_symbol["text-overlap"]),"text-ignore-placement":new me(K.layout_symbol["text-ignore-placement"]),"text-optional":new me(K.layout_symbol["text-optional"])})}};class OW{constructor(t){if(t.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=t.property.overrides?t.property.overrides.runtimeType:Zi,this.defaultValue=t}evaluate(t){if(t.formattedSection){let i=this.defaultValue.property.overrides;if(i&&i.hasOverride(t.formattedSection))return i.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default}eachChild(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}ne("FormatSectionOverride",OW,{omit:["defaultValue"]});class tb extends en{constructor(t,i){super(t,Xm,i)}recalculate(t,i){if(super.recalculate(t,i),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){let n=this.layout.get("text-writing-mode");if(n){let d=[];for(let r of n)d.indexOf(r)<0&&d.push(r);this.layout._values["text-writing-mode"]=d}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(t,i,n,d){let r=this.layout.get(t).evaluate(i,{},n,d),b=this._unevaluatedLayout._values[t];return b.isDataDriven()||Po(b.value)||!r?r:(function(h,V){return V.replace(/{([^{}]+)}/g,((R,N)=>h&&N in h?String(h[N]):""))})(i.properties,r)}createBucket(t){return new Gr(t)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(let t of Xm.paint.overridableProperties){if(!tb.hasPaintOverride(this.layout,t))continue;let i=this.paint.get(t),n=new OW(i),d=new _o(n,i.property.specification),r=null;r=i.value.kind==="constant"||i.value.kind==="source"?new jd("source",d):new qo("composite",d,i.value.zoomStops),this.paint._values[t]=new hn(i.property,r,i.parameters)}}_handleOverridablePaintPropertyUpdate(t,i,n){return!(!this.layout||i.isDataDriven()||n.isDataDriven())&&tb.hasPaintOverride(this.layout,t)}static hasPaintOverride(t,i){let n=t.get("text-field"),d=Xm.paint.properties[i],r=!1,b=h=>{for(let V of h)if(d.overrides&&d.overrides.hasOverride(V))return void(r=!0)};if(n.value.kind==="constant"&&n.value.value instanceof fi)b(n.value.value.sections);else if(n.value.kind==="source"||n.value.kind==="composite"){let h=R=>{r||(R instanceof sn&&Fi(R.value)===Gn?b(R.value.sections):R instanceof ha?b(R.sections):R.eachChild(h))},V=n.value;V._styleExpression&&h(V._styleExpression.expression)}return r}}let _W;var mg={get paint(){return _W=_W||new ia({"background-color":new me(K.paint_background["background-color"]),"background-pattern":new L0(K.paint_background["background-pattern"]),"background-opacity":new me(K.paint_background["background-opacity"])})}};class Wg extends en{constructor(t,i){super(t,mg,i)}}class hg extends en{constructor(t,i){super(t,{},i),this.onAdd=n=>{this.implementation.onAdd&&this.implementation.onAdd(n,n.painter.context.gl)},this.onRemove=n=>{this.implementation.onRemove&&this.implementation.onRemove(n,n.painter.context.gl)},this.implementation=t}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class Zg{constructor(t){this._methodToThrottle=t,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout((()=>{this._triggered=!1,this._methodToThrottle()}),0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}let pg={once:!0},Jm=63710088e-1;class Uc{constructor(t,i){if(isNaN(t)||isNaN(i))throw new Error(`Invalid LngLat object: (${t}, ${i})`);if(this.lng=+t,this.lat=+i,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Uc(qi(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(t){let i=Math.PI/180,n=this.lat*i,d=t.lat*i,r=Math.sin(n)*Math.sin(d)+Math.cos(n)*Math.cos(d)*Math.cos((t.lng-this.lng)*i);return Jm*Math.acos(Math.min(r,1))}static convert(t){if(t instanceof Uc)return t;if(Array.isArray(t)&&(t.length===2||t.length===3))return new Uc(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&typeof t=="object"&&t!==null)return new Uc(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}let PW=2*Math.PI*Jm;function KW(l){return PW*Math.cos(l*Math.PI/180)}function qW(l){return(180+l)/360}function $W(l){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+l*Math.PI/360)))/360}function th(l,t){return l/KW(t)}function eh(l){return 360*l-180}function eb(l){return 360/Math.PI*Math.atan(Math.exp((180-360*l)*Math.PI/180))-90}function ih(l,t){return l*KW(eb(t))}class Qs{constructor(t,i,n=0){this.x=+t,this.y=+i,this.z=+n}static fromLngLat(t,i=0){let n=Uc.convert(t);return new Qs(qW(n.lng),$W(n.lat),th(i,n.lat))}toLngLat(){return new Uc(eh(this.x),eb(this.y))}toAltitude(){return ih(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/PW*(t=eb(this.y),1/Math.cos(t*Math.PI/180));var t}}function lh(l,t,i){var n=2*Math.PI*6378137/256/Math.pow(2,i);return[l*n-2*Math.PI*6378137/2,t*n-2*Math.PI*6378137/2]}class ym{constructor(t,i,n){if(!(function(d,r,b){return!(d<0||d>25||b<0||b>=Math.pow(2,d)||r<0||r>=Math.pow(2,d))})(t,i,n))throw new Error(`x=${i}, y=${n}, z=${t} outside of bounds. 0<=x<${Math.pow(2,t)}, 0<=y<${Math.pow(2,t)} 0<=z<=25 `);this.z=t,this.x=i,this.y=n,this.key=Nr(0,t,t,i,n)}equals(t){return this.z===t.z&&this.x===t.x&&this.y===t.y}url(t,i,n){let d=(b=this.y,h=this.z,V=lh(256*(r=this.x),256*(b=Math.pow(2,h)-b-1),h),R=lh(256*(r+1),256*(b+1),h),V[0]+","+V[1]+","+R[0]+","+R[1]);var r,b,h,V,R;let N=(function(M,J,S){let C,L="";for(let w=M;w>0;w--)C=1<<w-1,L+=(J&C?1:0)+(S&C?2:0);return L})(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(n==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,i>1?"@2x":"").replace(/{quadkey}/g,N).replace(/{bbox-epsg-3857}/g,d)}isChildOf(t){let i=this.z-t.z;return i>0&&t.x===this.x>>i&&t.y===this.y>>i}getTilePoint(t){let i=Math.pow(2,this.z);return new st((t.x*i-this.x)*Le,(t.y*i-this.y)*Le)}toString(){return`${this.z}/${this.x}/${this.y}`}}class ah{constructor(t,i){this.wrap=t,this.canonical=i,this.key=Nr(t,i.z,i.z,i.x,i.y)}}class Zn{constructor(t,i,n,d,r){if(this.terrainRttPosMatrix32f=null,t<n)throw new Error(`overscaledZ should be >= z; overscaledZ = ${t}; z = ${n}`);this.overscaledZ=t,this.wrap=i,this.canonical=new ym(n,+d,+r),this.key=Nr(i,t,n,d,r)}clone(){return new Zn(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)}scaledTo(t){if(t>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${t}; overscaledZ = ${this.overscaledZ}`);let i=this.canonical.z-t;return t>this.canonical.z?new Zn(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Zn(t,this.wrap,t,this.canonical.x>>i,this.canonical.y>>i)}isOverscaled(){return this.overscaledZ>this.canonical.z}calculateScaledKey(t,i){if(t>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${t}; overscaledZ = ${this.overscaledZ}`);let n=this.canonical.z-t;return t>this.canonical.z?Nr(this.wrap*+i,t,this.canonical.z,this.canonical.x,this.canonical.y):Nr(this.wrap*+i,t,t,this.canonical.x>>n,this.canonical.y>>n)}isChildOf(t){if(t.wrap!==this.wrap||this.overscaledZ-t.overscaledZ<=0)return!1;if(t.overscaledZ===0)return this.overscaledZ>0;let i=this.canonical.z-t.canonical.z;return!(i<0)&&t.canonical.x===this.canonical.x>>i&&t.canonical.y===this.canonical.y>>i}children(t){if(this.overscaledZ>=t)return[new Zn(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];let i=this.canonical.z+1,n=2*this.canonical.x,d=2*this.canonical.y;return[new Zn(i,this.wrap,i,n,d),new Zn(i,this.wrap,i,n+1,d),new Zn(i,this.wrap,i,n,d+1),new Zn(i,this.wrap,i,n+1,d+1)]}isLessThan(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))}wrapped(){return new Zn(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(t){return new Zn(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new ah(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(t){return this.canonical.getTilePoint(new Qs(t.x-this.wrap,t.y))}}function Nr(l,t,i,n,d){(l*=2)<0&&(l=-1*l-1);let r=1<<i;return(r*r*l+r*d+n).toString(36)+i.toString(36)+t.toString(36)}function Ls(l,t){return t?l.properties[t]:l.id}function Vg(l,t){let i={id:l.id};if(t.removeAllProperties&&(delete l.removeProperties,delete l.addOrUpdateProperties,delete t.removeProperties),t.removeProperties)for(let n of t.removeProperties){let d=l.addOrUpdateProperties.findIndex((r=>r.key===n));d>-1&&l.addOrUpdateProperties.splice(d,1)}return(l.removeAllProperties||t.removeAllProperties)&&(i.removeAllProperties=!0),(l.removeProperties||t.removeProperties)&&(i.removeProperties=[...l.removeProperties||[],...t.removeProperties||[]]),(l.addOrUpdateProperties||t.addOrUpdateProperties)&&(i.addOrUpdateProperties=[...l.addOrUpdateProperties||[],...t.addOrUpdateProperties||[]]),(l.newGeometry||t.newGeometry)&&(i.newGeometry=t.newGeometry||l.newGeometry),i}function nh(l){var t,i;if(!l)return{};let n={};return n.removeAll=l.removeAll,n.remove=new Set(l.remove||[]),n.add=new Map((t=l.add)===null||t===void 0?void 0:t.map((d=>[d.id,d]))),n.update=new Map((i=l.update)===null||i===void 0?void 0:i.map((d=>[d.id,d]))),n}ne("CanonicalTileID",ym),ne("OverscaledTileID",Zn,{omit:["terrainRttPosMatrix32f"]});class dh{constructor(t){this._stringToNumber={},this._numberToString=[];for(let i=0;i<t.length;i++){let n=t[i];this._stringToNumber[n]=i,this._numberToString[i]=n}}encode(t){return this._stringToNumber[t]}decode(t){if(t>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${t} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[t]}}class ch{constructor(t,i,n,d,r){this.type="Feature",this._vectorTileFeature=t,t._z=i,t._x=n,t._y=d,this.properties=t.properties,this.id=r}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(t){this._geometry=t}toJSON(){let t={geometry:this.geometry};for(let i in this)i!=="_geometry"&&i!=="_vectorTileFeature"&&(t[i]=this[i]);return t}}class Ir{_name;dataBuffer;nullabilityBuffer;_size;constructor(t,i,n){this._name=t,this.dataBuffer=i,typeof n=="number"?this._size=n:(this.nullabilityBuffer=n,this._size=n.size())}getValue(t){return this.nullabilityBuffer&&!this.nullabilityBuffer.get(t)?null:this.getValueFromBuffer(t)}has(t){return this.nullabilityBuffer&&this.nullabilityBuffer.get(t)||!this.nullabilityBuffer}get name(){return this._name}get size(){return this._size}}class ib extends Ir{}class Bm extends ib{getValueFromBuffer(t){return this.dataBuffer[t]}}class Sm extends ib{getValueFromBuffer(t){return this.dataBuffer[t]}}class oh extends Ir{delta;constructor(t,i,n,d){super(t,i,d),this.delta=n}}class Cm extends oh{constructor(t,i,n,d){super(t,Int32Array.of(i),n,d)}getValueFromBuffer(t){return this.dataBuffer[0]+t*this.delta}}class km extends Ir{constructor(t,i,n){super(t,Int32Array.of(i),n)}getValueFromBuffer(t){return this.dataBuffer[0]}}class gg{_name;_geometryVector;_idVector;_propertyVectors;_extent;propertyVectorsMap;constructor(t,i,n,d,r=4096){this._name=t,this._geometryVector=i,this._idVector=n,this._propertyVectors=d,this._extent=r}get name(){return this._name}get idVector(){return this._idVector}get geometryVector(){return this._geometryVector}get propertyVectors(){return this._propertyVectors}getPropertyVector(t){return this.propertyVectorsMap||(this.propertyVectorsMap=new Map(this._propertyVectors.map((i=>[i.name,i])))),this.propertyVectorsMap.get(t)}*[Symbol.iterator](){let t=this.geometryVector[Symbol.iterator](),i=0;for(;i<this.numFeatures;){let n;this.idVector&&(n=this.containsMaxSaveIntegerValues(this.idVector)?Number(this.idVector.getValue(i)):this.idVector.getValue(i));let d=t?.next().value,r={};for(let b of this.propertyVectors){if(!b)continue;let h=b.name,V=b.getValue(i);V!==null&&(r[h]=V)}i++,yield{id:n,geometry:d,properties:r}}}get numFeatures(){return this.geometryVector.numGeometries}get extent(){return this._extent}getFeatures(){let t=[],i=this.geometryVector.getGeometries();for(let n=0;n<this.numFeatures;n++){let d;this.idVector&&(d=this.containsMaxSaveIntegerValues(this.idVector)?Number(this.idVector.getValue(n)):this.idVector.getValue(n));let r={coordinates:i[n],type:this.geometryVector.geometryType(n)},b={};for(let h of this.propertyVectors){if(!h)continue;let V=h.name,R=h.getValue(n);R!==null&&(b[V]=R)}t.push({id:d,geometry:r,properties:b})}return t}containsMaxSaveIntegerValues(t){return t instanceof Bm||t instanceof km&&t instanceof Cm||t instanceof Sm}}class ug{value;constructor(t){this.value=t}get(){return this.value}set(t){this.value=t}increment(){return this.value++}add(t){this.value+=t}}var la,Pe,qd,cd,po,an,Sl,Cl,rh,pn;(function(l){l.PRESENT="PRESENT",l.DATA="DATA",l.OFFSET="OFFSET",l.LENGTH="LENGTH"})(la||(la={}));class Qm{_dictionaryType;_offsetType;_lengthType;constructor(t,i,n){this._dictionaryType=t,this._offsetType=i,this._lengthType=n}get dictionaryType(){return this._dictionaryType}get offsetType(){return this._offsetType}get lengthType(){return this._lengthType}}function Ul(l,t,i){let n=new Int32Array(i),d=0,r=t.get();for(let b=0;b<n.length;b++){let h=l[r++],V=127&h;h<128||(h=l[r++],V|=(127&h)<<7,h<128||(h=l[r++],V|=(127&h)<<14,h<128||(h=l[r++],V|=(127&h)<<21,h<128||(h=l[r++],V|=(15&h)<<28)))),n[d++]=V}return t.set(r),n}function lb(l,t,i){let n=new BigInt64Array(i);for(let d=0;d<n.length;d++)n[d]=Fg(l,t);return n}function Rg(l,t){let i,n;return n=l[t.get()],t.increment(),i=127&n,n<128?i:(n=l[t.get()],t.increment(),i|=(127&n)<<7,n<128?i:(n=l[t.get()],t.increment(),i|=(127&n)<<14,n<128?i:(n=l[t.get()],t.increment(),i|=(127&n)<<21,n<128?i:(n=l[t.get()],i|=(15&n)<<28,(function(d,r,b){let h,V;if(V=r[b.get()],b.increment(),h=(112&V)>>4,V<128||(V=r[b.get()],b.increment(),h|=(127&V)<<3,V<128)||(V=r[b.get()],b.increment(),h|=(127&V)<<10,V<128)||(V=r[b.get()],b.increment(),h|=(127&V)<<17,V<128)||(V=r[b.get()],b.increment(),h|=(127&V)<<24,V<128)||(V=r[b.get()],b.increment(),h|=(1&V)<<31,V<128))return 4294967296*h+(d>>>0);throw new Error("Expected varint not more than 10 bytes")})(i,l,t)))))}function sh(l,t,i,n){throw new Error("FastPFor is not implemented yet.")}function Vo(l){return l>>>1^-(1&l)}function Ur(l){return l>>1n^-(1n&l)}function Fg(l,t){let i=0n,n=0,d=t.get();for(;d<l.length;){let r=l[d++];if(i|=BigInt(127&r)<<BigInt(n),!(128&r))break;if(n+=7,n>=64)throw new Error("Varint too long")}return t.set(d),i}function bh(l,t,i){let n=new Int32Array(i),d=0;for(let r=0;r<t;r++){let b=l[r];n.fill(l[r+t],d,d+b),d+=b}return n}function mh(l,t,i){let n=new BigInt64Array(i),d=0;for(let r=0;r<t;r++){let b=Number(l[r]);n.fill(l[r+t],d,d+b),d+=b}return n}function Wh(l,t,i){let n=new Float64Array(i),d=0;for(let r=0;r<t;r++){let b=l[r];n.fill(l[r+t],d,d+b),d+=b}return n}function Lm(l){let t=l.length/4*4,i=1;if(t>=4)for(let n=l[0];i<t-4;i+=4)n=l[i]+=n,n=l[i+1]+=n,n=l[i+2]+=n,n=l[i+3]+=n;for(;i!=l.length;)l[i]+=l[i-1],++i}function hh(l){l[0]=l[0]>>>1^-(1&l[0]),l[1]=l[1]>>>1^-(1&l[1]);let t=l.length/4*4,i=2;if(t>=4)for(;i<t-4;i+=4){let n=l[i],d=l[i+1],r=l[i+2],b=l[i+3];l[i]=(n>>>1^-(1&n))+l[i-2],l[i+1]=(d>>>1^-(1&d))+l[i-1],l[i+2]=(r>>>1^-(1&r))+l[i],l[i+3]=(b>>>1^-(1&b))+l[i+1]}for(;i!=l.length;i+=2)l[i]=(l[i]>>>1^-(1&l[i]))+l[i-2],l[i+1]=(l[i+1]>>>1^-(1&l[i+1]))+l[i-1]}function Mc(l,t,i){return Math.min(i,Math.max(t,l))}(function(l){l.NONE="NONE",l.DELTA="DELTA",l.COMPONENTWISE_DELTA="COMPONENTWISE_DELTA",l.RLE="RLE",l.MORTON="MORTON",l.PDE="PDE"})(Pe||(Pe={})),(function(l){l.NONE="NONE",l.FAST_PFOR="FAST_PFOR",l.VARINT="VARINT",l.ALP="ALP"})(qd||(qd={})),(function(l){l.NONE="NONE",l.SINGLE="SINGLE",l.SHARED="SHARED",l.VERTEX="VERTEX",l.MORTON="MORTON",l.FSST="FSST"})(cd||(cd={})),(function(l){l.VERTEX="VERTEX",l.INDEX="INDEX",l.STRING="STRING",l.KEY="KEY"})(po||(po={})),(function(l){l.VAR_BINARY="VAR_BINARY",l.GEOMETRIES="GEOMETRIES",l.PARTS="PARTS",l.RINGS="RINGS",l.TRIANGLES="TRIANGLES",l.SYMBOL="SYMBOL",l.DICTIONARY="DICTIONARY"})(an||(an={}));class go{_physicalStreamType;_logicalStreamType;_logicalLevelTechnique1;_logicalLevelTechnique2;_physicalLevelTechnique;_numValues;_byteLength;constructor(t,i,n,d,r,b,h){this._physicalStreamType=t,this._logicalStreamType=i,this._logicalLevelTechnique1=n,this._logicalLevelTechnique2=d,this._physicalLevelTechnique=r,this._numValues=b,this._byteLength=h}static decode(t,i){let n=t[i.get()],d=Object.values(la)[n>>4],r=null;switch(d){case la.DATA:r=new Qm(Object.values(cd)[15&n]);break;case la.OFFSET:r=new Qm(null,Object.values(po)[15&n]);break;case la.LENGTH:r=new Qm(null,null,Object.values(an)[15&n])}i.increment();let b=t[i.get()],h=Object.values(Pe)[b>>5],V=Object.values(Pe)[b>>2&7],R=Object.values(qd)[3&b];i.increment();let N=Ul(t,i,2);return new go(d,r,h,V,R,N[0],N[1])}get physicalStreamType(){return this._physicalStreamType}get logicalStreamType(){return this._logicalStreamType}get logicalLevelTechnique1(){return this._logicalLevelTechnique1}get logicalLevelTechnique2(){return this._logicalLevelTechnique2}get physicalLevelTechnique(){return this._physicalLevelTechnique}get numValues(){return this._numValues}get byteLength(){return this._byteLength}getDecompressedCount(){return this._numValues}}class ab extends go{num_bits;coordinate_shift;constructor(t,i,n,d,r,b,h,V,R){super(t,i,n,d,r,b,h),this.num_bits=V,this.coordinate_shift=R}static decode(t,i){let n=go.decode(t,i),d=Ul(t,i,2);return new ab(n.physicalStreamType,n.logicalStreamType,n.logicalLevelTechnique1,n.logicalLevelTechnique2,n.physicalLevelTechnique,n.numValues,n.byteLength,d[0],d[1])}static decodePartial(t,i,n){let d=Ul(i,n,2);return new ab(t.physicalStreamType,t.logicalStreamType,t.logicalLevelTechnique1,t.logicalLevelTechnique2,t.physicalLevelTechnique,t.numValues,t.byteLength,d[0],d[1])}numBits(){return this.num_bits}coordinateShift(){return this.coordinate_shift}}class Es extends go{_runs;_numRleValues;constructor(t,i,n,d,r,b,h,V,R){super(t,i,n,d,r,b,h),this._runs=V,this._numRleValues=R}static decode(t,i){let n=go.decode(t,i),d=Ul(t,i,2);return new Es(n.physicalStreamType,n.logicalStreamType,n.logicalLevelTechnique1,n.logicalLevelTechnique2,n.physicalLevelTechnique,n.numValues,n.byteLength,d[0],d[1])}static decodePartial(t,i,n){let d=Ul(i,n,2);return new Es(t.physicalStreamType,t.logicalStreamType,t.logicalLevelTechnique1,t.logicalLevelTechnique2,t.physicalLevelTechnique,t.numValues,t.byteLength,d[0],d[1])}get runs(){return this._runs}get numRleValues(){return this._numRleValues}getDecompressedCount(){return this._numRleValues}}class ga{static decode(t,i){let n=go.decode(t,i);return n.logicalLevelTechnique1===Pe.MORTON?ab.decodePartial(n,t,i):Pe.RLE!==n.logicalLevelTechnique1&&Pe.RLE!==n.logicalLevelTechnique2||qd.NONE===n.physicalLevelTechnique?n:Es.decodePartial(n,t,i)}}(function(l){l[l.FLAT=0]="FLAT",l[l.CONST=1]="CONST",l[l.SEQUENCE=2]="SEQUENCE",l[l.DICTIONARY=3]="DICTIONARY",l[l.FSST_DICTIONARY=4]="FSST_DICTIONARY"})(Sl||(Sl={}));class od{values;_size;constructor(t,i){this.values=t,this._size=i}get(t){let i=Math.floor(t/8);return(this.values[i]>>t%8&1)==1}set(t,i){let n=Math.floor(t/8);this.values[n]=this.values[n]|(i?1:0)<<t%8}getInt(t){let i=Math.floor(t/8);return this.values[i]>>t%8&1}size(){return this._size}getBuffer(){return this.values}}class ke{constructor(){}static decodeIntStream(t,i,n,d,r){let b=ke.decodePhysicalLevelTechnique(t,i,n);return this.decodeIntBuffer(b,n,d,r)}static decodeLengthStreamToOffsetBuffer(t,i,n){let d=ke.decodePhysicalLevelTechnique(t,i,n);return this.decodeLengthToOffsetBuffer(d,n)}static decodePhysicalLevelTechnique(t,i,n){let d=n.physicalLevelTechnique;if(d===qd.FAST_PFOR)return sh();if(d===qd.VARINT)return Ul(t,i,n.numValues);if(d===qd.NONE){let r=i.get();i.add(n.byteLength);let b=t.subarray(r,i.get());return new Int32Array(b)}throw new Error("Specified physicalLevelTechnique is not supported (yet).")}static decodeConstIntStream(t,i,n,d){let r=ke.decodePhysicalLevelTechnique(t,i,n);if(r.length===1){let b=r[0];return d?Vo(b):b}return d?(function(b){return Vo(b[1])})(r):(function(b){return b[1]})(r)}static decodeSequenceIntStream(t,i,n){return(function(d){if(d.length==2){let r=Vo(d[1]);return[r,r]}return[Vo(d[2]),Vo(d[3])]})(ke.decodePhysicalLevelTechnique(t,i,n))}static decodeSequenceLongStream(t,i,n){return(function(d){if(d.length==2){let r=Ur(d[1]);return[r,r]}return[Ur(d[2]),Ur(d[3])]})(lb(t,i,n.numValues))}static decodeLongStream(t,i,n,d){let r=lb(t,i,n.numValues);return this.decodeLongBuffer(r,n,d)}static decodeLongFloat64Stream(t,i,n,d){let r=(function(b,h,V){let R=new Float64Array(h);for(let N=0;N<h;N++)R[N]=Rg(b,V);return R})(t,n.numValues,i);return this.decodeFloat64Buffer(r,n,d)}static decodeConstLongStream(t,i,n,d){let r=lb(t,i,n.numValues);if(r.length===1){let b=r[0];return d?Ur(b):b}return d?(function(b){return Ur(b[1])})(r):(function(b){return b[1]})(r)}static decodeIntBuffer(t,i,n,d){switch(i.logicalLevelTechnique1){case Pe.DELTA:return i.logicalLevelTechnique2===Pe.RLE?(function(r,b,h){let V=new Int32Array(h),R=0,N=0;for(let M=0;M<b;M++){let J=r[M],S=Vo(r[M+b]);for(let C=0;C<J;C++)N+=S,V[R++]=N}return V})(t,i.runs,i.numRleValues):((function(r){r[0]=r[0]>>>1^-(1&r[0]);let b=r.length/4*4,h=1;if(b>=4)for(;h<b-4;h+=4){let V=r[h],R=r[h+1],N=r[h+2],M=r[h+3];r[h]=(V>>>1^-(1&V))+r[h-1],r[h+1]=(R>>>1^-(1&R))+r[h],r[h+2]=(N>>>1^-(1&N))+r[h+1],r[h+3]=(M>>>1^-(1&M))+r[h+2]}for(;h!=r.length;++h)r[h]=(r[h]>>>1^-(1&r[h]))+r[h-1]})(t),t);case Pe.RLE:return(function(r,b,h){return h?(function(V,R,N){let M=new Int32Array(N),J=0;for(let S=0;S<R;S++){let C=V[S],L=V[S+R];L=L>>>1^-(1&L),M.fill(L,J,J+C),J+=C}return M})(r,b.runs,b.numRleValues):bh(r,b.runs,b.numRleValues)})(t,i,n);case Pe.MORTON:return Lm(t),t;case Pe.COMPONENTWISE_DELTA:return d?((function(r,b,h,V){let R=r[0]>>>1^-(1&r[0]),N=r[1]>>>1^-(1&r[1]);r[0]=Mc(Math.round(R*b),h,V),r[1]=Mc(Math.round(N*b),h,V);let M=r.length/16,J=2;if(M>=4)for(;J<M-4;J+=4){let S=r[J],C=r[J+1],L=(S>>>1^-(1&S))+R,w=(C>>>1^-(1&C))+N;r[J]=Mc(Math.round(L*b),h,V),r[J+1]=Mc(Math.round(w*b),h,V);let _=r[J+2],lt=r[J+3];R=(_>>>1^-(1&_))+L,N=(lt>>>1^-(1&lt))+w,r[J+2]=Mc(Math.round(R*b),h,V),r[J+3]=Mc(Math.round(N*b),h,V)}for(;J!=r.length;J+=2)R+=r[J]>>>1^-(1&r[J]),N+=r[J+1]>>>1^-(1&r[J+1]),r[J]=Mc(Math.round(R*b),h,V),r[J+1]=Mc(Math.round(N*b),h,V)})(t,d.scale,d.min,d.max),t):(hh(t),t);case Pe.NONE:return n&&(function(r){for(let b=0;b<r.length;b++){let h=r[b];r[b]=h>>>1^-(1&h)}})(t),t;default:throw new Error(`The specified Logical level technique is not supported: ${i.logicalLevelTechnique1}`)}}static decodeLongBuffer(t,i,n){switch(i.logicalLevelTechnique1){case Pe.DELTA:return i.logicalLevelTechnique2===Pe.RLE?(function(d,r,b){let h=new BigInt64Array(b),V=0,R=0n;for(let N=0;N<r;N++){let M=Number(d[N]),J=Ur(d[N+r]);for(let S=0;S<M;S++)R+=J,h[V++]=R}return h})(t,i.runs,i.numRleValues):((function(d){d[0]=d[0]>>1n^-(1n&d[0]);let r=d.length/4*4,b=1;if(r>=4)for(;b<r-4;b+=4){let h=d[b],V=d[b+1],R=d[b+2],N=d[b+3];d[b]=(h>>1n^-(1n&h))+d[b-1],d[b+1]=(V>>1n^-(1n&V))+d[b],d[b+2]=(R>>1n^-(1n&R))+d[b+1],d[b+3]=(N>>1n^-(1n&N))+d[b+2]}for(;b!=d.length;++b)d[b]=(d[b]>>1n^-(1n&d[b]))+d[b-1]})(t),t);case Pe.RLE:return(function(d,r,b){return b?(function(h,V,R){let N=new BigInt64Array(R),M=0;for(let J=0;J<V;J++){let S=Number(h[J]),C=h[J+V];C=C>>1n^-(1n&C),N.fill(C,M,M+S),M+=S}return N})(d,r.runs,r.numRleValues):mh(d,r.runs,r.numRleValues)})(t,i,n);case Pe.NONE:return n&&(function(d){for(let r=0;r<d.length;r++){let b=d[r];d[r]=b>>1n^-(1n&b)}})(t),t;default:throw new Error(`The specified Logical level technique is not supported: ${i.logicalLevelTechnique1}`)}}static decodeFloat64Buffer(t,i,n){switch(i.logicalLevelTechnique1){case Pe.DELTA:return i.logicalLevelTechnique2===Pe.RLE&&(t=Wh(t,i.runs,i.numRleValues)),(function(d){d[0]=d[0]%2==1?(d[0]+1)/-2:d[0]/2;let r=d.length/4*4,b=1;if(r>=4)for(;b<r-4;b+=4){let h=d[b],V=d[b+1],R=d[b+2],N=d[b+3];d[b]=(h%2==1?(h+1)/-2:h/2)+d[b-1],d[b+1]=(V%2==1?(V+1)/-2:V/2)+d[b],d[b+2]=(R%2==1?(R+1)/-2:R/2)+d[b+1],d[b+3]=(N%2==1?(N+1)/-2:N/2)+d[b+2]}for(;b!=d.length;++b)d[b]=(d[b]%2==1?(d[b]+1)/-2:d[b]/2)+d[b-1]})(t),t;case Pe.RLE:return(function(d,r,b){return b?(function(h,V,R){let N=new Float64Array(R),M=0;for(let J=0;J<V;J++){let S=h[J],C=h[J+V];C=C%2==1?(C+1)/-2:C/2,N.fill(C,M,M+S),M+=S}return N})(d,r.runs,r.numRleValues):Wh(d,r.runs,r.numRleValues)})(t,i,n);case Pe.NONE:return n&&(function(d){for(let r=0;r<d.length;r++){let b=d[r];d[r]=b%2==1?(b+1)/-2:b/2}})(t),t;default:throw new Error(`The specified Logical level technique is not supported: ${i.logicalLevelTechnique1}`)}}static decodeLengthToOffsetBuffer(t,i){if(i.logicalLevelTechnique1===Pe.DELTA&&i.logicalLevelTechnique2===Pe.NONE)return(function(n){let d=new Int32Array(n.length+1);d[0]=0,d[1]=Vo(n[0]);let r=d[1],b=2;for(;b!=d.length;++b){let h=n[b-1];r+=h>>>1^-(1&h),d[b]=d[b-1]+r}return d})(t);if(i.logicalLevelTechnique1===Pe.RLE&&i.logicalLevelTechnique2===Pe.NONE)return(function(n,d,r){let b=new Int32Array(r+1);b[0]=0;let h=1,V=b[0];for(let R=0;R<d;R++){let N=n[R],M=n[R+d];for(let J=h;J<h+N;J++)b[J]=M+V,V=b[J];h+=N}return b})(t,i.runs,i.numRleValues);if(i.logicalLevelTechnique1===Pe.NONE&&i.logicalLevelTechnique2===Pe.NONE){(function(d){let r=0;for(let b=0;b<d.length;b++)d[b]+=r,r=d[b]})(t);let n=new Int32Array(i.numValues+1);return n[0]=0,n.set(t,1),n}if(i.logicalLevelTechnique1===Pe.DELTA&&i.logicalLevelTechnique2===Pe.RLE){let n=(function(d,r,b){let h=new Int32Array(b+1);h[0]=0;let V=1,R=h[0];for(let N=0;N<r;N++){let M=d[N],J=d[N+r];J=J>>>1^-(1&J);for(let S=V;S<V+M;S++)h[S]=J+R,R=h[S];V+=M}return h})(t,i.runs,i.numRleValues);return Lm(n),n}throw new Error("Only delta encoding is supported for transforming length to offset streams yet.")}static decodeNullableIntStream(t,i,n,d,r){let b=n.physicalLevelTechnique===qd.FAST_PFOR?sh():Ul(t,i,n.numValues);return this.decodeNullableIntBuffer(b,n,d,r)}static decodeNullableLongStream(t,i,n,d,r){let b=lb(t,i,n.numValues);return this.decodeNullableLongBuffer(b,n,d,r)}static decodeNullableIntBuffer(t,i,n,d){switch(i.logicalLevelTechnique1){case Pe.DELTA:return i.logicalLevelTechnique2===Pe.RLE&&(t=bh(t,i.runs,i.numRleValues)),(function(r,b){let h=new Int32Array(r.size()),V=0;r.get(0)?(h[0]=r.get(0)?b[0]>>>1^-(1&b[0]):0,V=1):h[0]=0;let R=1;for(;R!=h.length;++R)h[R]=r.get(R)?h[R-1]+(b[V]>>>1^-(1&b[V++])):h[R-1];return h})(d,t);case Pe.RLE:return(function(r,b,h,V){let R=b;return h?(function(N,M,J){let S=new Int32Array(N.size()),C=0;for(let L=0;L<J;L++){let w=M[L],_=M[L+J];_=_>>>1^-(1&_);for(let lt=C;lt<C+w;lt++)N.get(lt)?S[lt]=_:(S[lt]=0,C++);C+=w}return S})(V,r,R.runs):(function(N,M,J){let S=new Int32Array(N.size()),C=0;for(let L=0;L<J;L++){let w=M[L],_=M[L+J];for(let lt=C;lt<C+w;lt++)N.get(lt)?S[lt]=_:(S[lt]=0,C++);C+=w}return S})(V,r,R.runs)})(t,i,n,d);case Pe.MORTON:return Lm(t),t;case Pe.COMPONENTWISE_DELTA:return hh(t),t;case Pe.NONE:return t=n?(function(r,b){let h=new Int32Array(r.size()),V=0,R=0;for(;R!=h.length;++R)if(r.get(R)){let N=b[V++];h[R]=N>>>1^-(1&N)}else h[R]=0;return h})(d,t):(function(r,b){let h=new Int32Array(r.size()),V=0,R=0;for(;R!=h.length;++R)h[R]=r.get(R)?b[V++]:0;return h})(d,t),t;default:throw new Error("The specified Logical level technique is not supported")}}static decodeNullableLongBuffer(t,i,n,d){switch(i.logicalLevelTechnique1){case Pe.DELTA:return i.logicalLevelTechnique2===Pe.RLE&&(t=mh(t,i.runs,i.numRleValues)),(function(r,b){let h=new BigInt64Array(r.size()),V=0;r.get(0)?(h[0]=r.get(0)?b[0]>>1n^-(1n&b[0]):0n,V=1):h[0]=0n;let R=1;for(;R!=h.length;++R)h[R]=r.get(R)?h[R-1]+(b[V]>>1n^-(1n&b[V++])):h[R-1];return h})(d,t);case Pe.RLE:return(function(r,b,h,V){let R=b;return h?(function(N,M,J){let S=new BigInt64Array(N.size()),C=0;for(let L=0;L<J;L++){let w=Number(M[L]),_=M[L+J];_=_>>1n^-(1n&_);for(let lt=C;lt<C+w;lt++)N.get(lt)?S[lt]=_:(S[lt]=0n,C++);C+=w}return S})(V,r,R.runs):(function(N,M,J){let S=new BigInt64Array(N.size()),C=0;for(let L=0;L<J;L++){let w=Number(M[L]),_=M[L+J];for(let lt=C;lt<C+w;lt++)N.get(lt)?S[lt]=_:(S[lt]=0n,C++);C+=w}return S})(V,r,R.runs)})(t,i,n,d);case Pe.NONE:return t=n?(function(r,b){let h=new BigInt64Array(r.size()),V=0,R=0;for(;R!=h.length;++R)if(r.get(R)){let N=b[V++];h[R]=N>>1n^-(1n&N)}else h[R]=0n;return h})(d,t):(function(r,b){let h=new BigInt64Array(r.size()),V=0,R=0;for(;R!=h.length;++R)h[R]=r.get(R)?b[V++]:0n;return h})(d,t),t;default:throw new Error("The specified Logical level technique is not supported")}}static getVectorType(t,i,n,d){let r=t.logicalLevelTechnique1;if(r===Pe.RLE)return t.runs===1?Sl.CONST:Sl.FLAT;let b=i instanceof od?i.size():i;if(r===Pe.DELTA&&t.logicalLevelTechnique2===Pe.RLE){let h=t.runs,V=2;if(t.numRleValues!==b)return Sl.FLAT;if(h===1)return Sl.SEQUENCE;if(h===2){let R=d.get(),N;if(t.physicalLevelTechnique===qd.VARINT)N=Ul(n,d,4);else{let M=d.get();N=new Int32Array(n.buffer,n.byteOffset+M,4)}if(d.set(R),N[2]===V&&N[3]===V)return Sl.SEQUENCE}}return t.numValues===1?Sl.CONST:Sl.FLAT}}class Zh extends ib{getValueFromBuffer(t){return this.dataBuffer[t]}}class ph extends oh{constructor(t,i,n,d){super(t,BigInt64Array.of(i),n,d)}getValueFromBuffer(t){return this.dataBuffer[0]+BigInt(t)*this.delta}}class Mr{_geometryOffsets;_partOffsets;_ringOffsets;constructor(t,i,n){this._geometryOffsets=t,this._partOffsets=i,this._ringOffsets=n}get geometryOffsets(){return this._geometryOffsets}get partOffsets(){return this._partOffsets}get ringOffsets(){return this._ringOffsets}}class Gg{tileExtent;_numBits;_coordinateShift;minBound;maxBound;constructor(t,i){this._coordinateShift=t<0?Math.abs(t):0,this.tileExtent=i+this._coordinateShift,this._numBits=Math.ceil(Math.log2(this.tileExtent)),this.minBound=t,this.maxBound=i}validateCoordinates(t){if(t.x<this.minBound||t.y<this.minBound||t.x>this.maxBound||t.y>this.maxBound)throw new Error("The specified tile buffer size is currently not supported.")}numBits(){return this._numBits}coordinateShift(){return this._coordinateShift}}class Yr extends Gg{encode(t){this.validateCoordinates(t);let i=t.x+this._coordinateShift,n=t.y+this._coordinateShift,d=0;for(let r=0;r<this._numBits;r++)d|=(i&1<<r)<<r|(n&1<<r)<<r+1;return d}decode(t){return{x:this.decodeMorton(t)-this._coordinateShift,y:this.decodeMorton(t>>1)-this._coordinateShift}}decodeMorton(t){let i=0;for(let n=0;n<this._numBits;n++)i|=(t&1<<2*n)>>n;return i}static decode(t,i,n){return{x:Yr.decodeMorton(t,i)-n,y:Yr.decodeMorton(t>>1,i)-n}}static decodeMorton(t,i){let n=0;for(let d=0;d<i;d++)n|=(t&1<<2*d)>>d;return n}}(function(l){l[l.POINT=0]="POINT",l[l.LINESTRING=1]="LINESTRING",l[l.POLYGON=2]="POLYGON",l[l.MULTIPOINT=3]="MULTIPOINT",l[l.MULTILINESTRING=4]="MULTILINESTRING",l[l.MULTIPOLYGON=5]="MULTIPOLYGON"})(Cl||(Cl={})),(function(l){l[l.POINT=0]="POINT",l[l.LINESTRING=1]="LINESTRING",l[l.POLYGON=2]="POLYGON"})(rh||(rh={})),(function(l){l[l.MORTON=0]="MORTON",l[l.VEC_2=1]="VEC_2",l[l.VEC_3=2]="VEC_3"})(pn||(pn={}));class Ng{createPoint(t){return[[t]]}createMultiPoint(t){return t.map((i=>[i]))}createLineString(t){return[t]}createMultiLineString(t){return t}createPolygon(t,i){return[t,...i]}createMultiPolygon(t){return t.flat()}}function Vh(l){let t=new Array(l.numGeometries),i=1,n=1,d=1,r=0,b=new Ng,h=0,V=0,R=l.mortonSettings,N=l.topologyVector,M=N.geometryOffsets,J=N.partOffsets,S=N.ringOffsets,C=l.vertexOffsets,L=l.containsPolygonGeometry(),w=l.vertexBuffer;for(let _=0;_<l.numGeometries;_++){let lt=l.geometryType(_);if(lt===Cl.POINT){if(C&&C.length!==0)if(l.vertexBufferType===pn.VEC_2){let P=2*C[V++],tt=new st(w[P],w[P+1]);t[r++]=b.createPoint(tt)}else{let P=C[V++],tt=Yr.decode(w[P],R.numBits,R.coordinateShift),pt=new st(tt.x,tt.y);t[r++]=b.createPoint(pt)}else{let P=new st(w[h++],w[h++]);t[r++]=b.createPoint(P)}M&&d++,J&&i++,S&&n++}else if(lt===Cl.MULTIPOINT){let P=M[d]-M[d-1];d++;let tt=new Array(P);if(C&&C.length!==0){for(let pt=0;pt<P;pt++){let Vt=2*C[V++];tt[pt]=new st(w[Vt],w[Vt+1])}t[r++]=b.createMultiPoint(tt)}else{for(let pt=0;pt<P;pt++){let Vt=w[h++],Yt=w[h++];tt[pt]=new st(Vt,Yt)}t[r++]=b.createMultiPoint(tt)}}else if(lt===Cl.LINESTRING){let P,tt=0;L?(tt=S[n]-S[n-1],n++):tt=J[i]-J[i-1],i++,C&&C.length!==0?(P=l.vertexBufferType===pn.VEC_2?zm(w,C,V,tt,!1):jm(w,C,V,tt,!1,R),V+=tt):(P=Em(w,h,tt,!1),h+=2*tt),t[r++]=b.createLineString(P),M&&d++}else if(lt===Cl.POLYGON){let P=J[i]-J[i-1];i++;let tt=new Array(P-1),pt=S[n]-S[n-1];if(n++,C&&C.length!==0){let Vt=l.vertexBufferType===pn.VEC_2?db(w,C,V,pt):cb(w,C,V,pt,0,R);V+=pt;for(let Yt=0;Yt<tt.length;Yt++)pt=S[n]-S[n-1],n++,tt[Yt]=l.vertexBufferType===pn.VEC_2?db(w,C,V,pt):cb(w,C,V,pt,0,R),V+=pt;t[r++]=b.createPolygon(Vt,tt)}else{let Vt=nb(w,h,pt);h+=2*pt;for(let Yt=0;Yt<tt.length;Yt++)pt=S[n]-S[n-1],n++,tt[Yt]=nb(w,h,pt),h+=2*pt;t[r++]=b.createPolygon(Vt,tt)}M&&d++}else if(lt===Cl.MULTILINESTRING){let P=M[d]-M[d-1];d++;let tt=new Array(P);if(C&&C.length!==0){for(let pt=0;pt<P;pt++){let Vt=0;L?(Vt=S[n]-S[n-1],n++):Vt=J[i]-J[i-1],i++;let Yt=l.vertexBufferType===pn.VEC_2?zm(w,C,V,Vt,!1):jm(w,C,V,Vt,!1,R);tt[pt]=Yt,V+=Vt}t[r++]=b.createMultiLineString(tt)}else{for(let pt=0;pt<P;pt++){let Vt=0;L?(Vt=S[n]-S[n-1],n++):Vt=J[i]-J[i-1],i++,tt[pt]=Em(w,h,Vt,!1),h+=2*Vt}t[r++]=b.createMultiLineString(tt)}}else{if(lt!==Cl.MULTIPOLYGON)throw new Error("The specified geometry type is currently not supported.");{let P=M[d]-M[d-1];d++;let tt=new Array(P),pt=0;if(C&&C.length!==0){for(let Vt=0;Vt<P;Vt++){let Yt=J[i]-J[i-1];i++;let wt=new Array(Yt-1);pt=S[n]-S[n-1],n++;let Qt=l.vertexBufferType===pn.VEC_2?db(w,C,V,pt):cb(w,C,V,pt,0,R);V+=pt;for(let Ht=0;Ht<wt.length;Ht++)pt=S[n]-S[n-1],n++,wt[Ht]=l.vertexBufferType===pn.VEC_2?db(w,C,V,pt):cb(w,C,V,pt,0,R),V+=pt;tt[Vt]=b.createPolygon(Qt,wt)}t[r++]=b.createMultiPolygon(tt)}else{for(let Vt=0;Vt<P;Vt++){let Yt=J[i]-J[i-1];i++;let wt=new Array(Yt-1);pt=S[n]-S[n-1],n++;let Qt=nb(w,h,pt);h+=2*pt;for(let Ht=0;Ht<wt.length;Ht++){let ae=S[n]-S[n-1];n++,wt[Ht]=nb(w,h,ae),h+=2*ae}tt[Vt]=b.createPolygon(Qt,wt)}t[r++]=b.createMultiPolygon(tt)}}}}return t}function nb(l,t,i){return Em(l,t,i,!0)}function db(l,t,i,n){return zm(l,t,i,n,!0)}function cb(l,t,i,n,d,r){return jm(l,t,i,n,!0,r)}function Em(l,t,i,n){let d=new Array(n?i+1:i);for(let r=0;r<2*i;r+=2)d[r/2]=new st(l[t+r],l[t+r+1]);return n&&(d[d.length-1]=d[0]),d}function zm(l,t,i,n,d){let r=new Array(d?n+1:n);for(let b=0;b<2*n;b+=2){let h=2*t[i+b/2];r[b/2]=new st(l[h],l[h+1])}return d&&(r[r.length-1]=r[0]),r}function jm(l,t,i,n,d,r){let b=new Array(d?n+1:n);for(let h=0;h<n;h++){let V=Yr.decode(l[t[i+h]],r.numBits,r.coordinateShift);b[h]=new st(V.x,V.y)}return d&&(b[b.length-1]=b[0]),b}class gh{_vertexBufferType;_topologyVector;_vertexOffsets;_vertexBuffer;_mortonSettings;constructor(t,i,n,d,r){this._vertexBufferType=t,this._topologyVector=i,this._vertexOffsets=n,this._vertexBuffer=d,this._mortonSettings=r}get vertexBufferType(){return this._vertexBufferType}get topologyVector(){return this._topologyVector}get vertexOffsets(){return this._vertexOffsets}get vertexBuffer(){return this._vertexBuffer}*[Symbol.iterator](){let t=Vh(this),i=0;for(;i<this.numGeometries;)yield{coordinates:t[i],type:this.geometryType(i)},i++}getSimpleEncodedVertex(t){let i=this.vertexOffsets?2*this.vertexOffsets[t]:2*t;return[this.vertexBuffer[i],this.vertexBuffer[i+1]]}getVertex(t){if(this.vertexOffsets&&this.mortonSettings){let n=Yr.decode(this.vertexBuffer[this.vertexOffsets[t]],this.mortonSettings.numBits,this.mortonSettings.coordinateShift);return[n.x,n.y]}let i=this.vertexOffsets?2*this.vertexOffsets[t]:2*t;return[this.vertexBuffer[i],this.vertexBuffer[i+1]]}getGeometries(){return Vh(this)}get mortonSettings(){return this._mortonSettings}}class zs extends gh{_numGeometries;_geometryType;constructor(t,i,n,d,r,b,h){super(n,d,r,b,h),this._numGeometries=t,this._geometryType=i}static createMortonEncoded(t,i,n,d,r,b){return new zs(t,i,pn.MORTON,n,d,r,b)}static create(t,i,n,d,r){return new zs(t,i,pn.VEC_2,n,d,r)}geometryType(t){return this._geometryType}get numGeometries(){return this._numGeometries}containsPolygonGeometry(){return this._geometryType===Cl.POLYGON||this._geometryType===Cl.MULTIPOLYGON}containsSingleGeometryType(){return!0}}class js extends gh{_geometryTypes;constructor(t,i,n,d,r,b){super(t,n,d,r,b),this._geometryTypes=i}static createMortonEncoded(t,i,n,d,r){return new js(pn.MORTON,t,i,n,d,r)}static create(t,i,n,d){return new js(pn.VEC_2,t,i,n,d)}geometryType(t){return this._geometryTypes[t]}get numGeometries(){return this._geometryTypes.length}containsPolygonGeometry(){for(let t=0;t<this.numGeometries;t++)if(this.geometryType(t)===Cl.POLYGON||this.geometryType(t)===Cl.MULTIPOLYGON)return!0;return!1}containsSingleGeometryType(){return!1}}class uh{_triangleOffsets;_indexBuffer;_vertexBuffer;_topologyVector;constructor(t,i,n,d){this._triangleOffsets=t,this._indexBuffer=i,this._vertexBuffer=n,this._topologyVector=d}get triangleOffsets(){return this._triangleOffsets}get indexBuffer(){return this._indexBuffer}get vertexBuffer(){return this._vertexBuffer}get topologyVector(){return this._topologyVector}getGeometries(){if(!this._topologyVector)throw new Error("Cannot convert GpuVector to coordinates without topology information");let t=new Array(this.numGeometries),i=this._topologyVector,n=i.partOffsets,d=i.ringOffsets,r=i.geometryOffsets,b=0,h=1,V=1,R=1;for(let N=0;N<this.numGeometries;N++)switch(this.geometryType(N)){case Cl.POLYGON:{let M=n[h]-n[h-1];h++;let J=[];for(let S=0;S<M;S++){let C=d[V]-d[V-1];V++;let L=[];for(let w=0;w<C;w++){let _=this._vertexBuffer[b++],lt=this._vertexBuffer[b++];L.push(new st(_,lt))}L.length>0&&L.push(L[0]),J.push(L)}t[N]=J,r&&R++}break;case Cl.MULTIPOLYGON:{let M=r[R]-r[R-1];R++;let J=[];for(let S=0;S<M;S++){let C=n[h]-n[h-1];h++;for(let L=0;L<C;L++){let w=d[V]-d[V-1];V++;let _=[];for(let lt=0;lt<w;lt++){let P=this._vertexBuffer[b++],tt=this._vertexBuffer[b++];_.push(new st(P,tt))}_.length>0&&_.push(_[0]),J.push(_)}}t[N]=J}}return t}[Symbol.iterator](){return null}}class ob extends uh{_numGeometries;_geometryType;constructor(t,i,n,d,r,b){super(n,d,r,b),this._numGeometries=t,this._geometryType=i}static create(t,i,n,d,r,b){return new ob(t,i,n,d,r,b)}geometryType(t){return this._geometryType}get numGeometries(){return this._numGeometries}containsSingleGeometryType(){return!0}}class rb extends uh{_geometryTypes;constructor(t,i,n,d,r){super(i,n,d,r),this._geometryTypes=t}static create(t,i,n,d,r){return new rb(t,i,n,d,r)}geometryType(t){return this._geometryTypes[t]}get numGeometries(){return this._geometryTypes.length}containsSingleGeometryType(){return!1}}function Ig(l,t,i,n,d){let r=ga.decode(l,i),b=null,h=null,V=null,R=null,N=null,M=null,J=null,S=null;if(ke.getVectorType(r,n,l,i)===Sl.CONST){let L=ke.decodeConstIntStream(l,i,r,!1);for(let w=0;w<t-1;w++){let _=ga.decode(l,i);switch(_.physicalStreamType){case la.LENGTH:switch(_.logicalStreamType.lengthType){case an.GEOMETRIES:b=ke.decodeLengthStreamToOffsetBuffer(l,i,_);break;case an.PARTS:h=ke.decodeLengthStreamToOffsetBuffer(l,i,_);break;case an.RINGS:V=ke.decodeLengthStreamToOffsetBuffer(l,i,_);break;case an.TRIANGLES:J=ke.decodeLengthStreamToOffsetBuffer(l,i,_)}break;case la.OFFSET:switch(_.logicalStreamType.offsetType){case po.VERTEX:R=ke.decodeIntStream(l,i,_,!1);break;case po.INDEX:S=ke.decodeIntStream(l,i,_,!1)}break;case la.DATA:if(cd.VERTEX===_.logicalStreamType.dictionaryType)N=ke.decodeIntStream(l,i,_,!0,d);else{let lt=_;M={numBits:lt.numBits(),coordinateShift:lt.coordinateShift()},N=ke.decodeIntStream(l,i,_,!1,d)}}}if(S!==null){if(b!=null||h!=null){let w=new Mr(b,h,V);return ob.create(n,L,J,S,N,w)}return ob.create(n,L,J,S,N)}return M===null?zs.create(n,L,new Mr(b,h,V),R,N):zs.createMortonEncoded(n,L,new Mr(b,h,V),R,N,M)}let C=ke.decodeIntStream(l,i,r,!1);for(let L=0;L<t-1;L++){let w=ga.decode(l,i);switch(w.physicalStreamType){case la.LENGTH:switch(w.logicalStreamType.lengthType){case an.GEOMETRIES:b=ke.decodeIntStream(l,i,w,!1);break;case an.PARTS:h=ke.decodeIntStream(l,i,w,!1);break;case an.RINGS:V=ke.decodeIntStream(l,i,w,!1);break;case an.TRIANGLES:J=ke.decodeLengthStreamToOffsetBuffer(l,i,w)}break;case la.OFFSET:switch(w.logicalStreamType.offsetType){case po.VERTEX:R=ke.decodeIntStream(l,i,w,!1);break;case po.INDEX:S=ke.decodeIntStream(l,i,w,!1)}break;case la.DATA:if(cd.VERTEX===w.logicalStreamType.dictionaryType)N=ke.decodeIntStream(l,i,w,!0,d);else{let _=w;M={numBits:_.numBits(),coordinateShift:_.coordinateShift()},N=ke.decodeIntStream(l,i,w,!1,d)}}}return S!==null&&h===null?rb.create(C,J,S,N):(b!==null?(b=Am(C,b,2),h!==null&&V!==null?(h=Rh(C,b,h,!1),V=(function(L,w,_,lt){let P=new Int32Array(_[_.length-1]+1),tt=0;P[0]=tt;let pt=1,Vt=1,Yt=0;for(let wt=0;wt<L.length;wt++){let Qt=L[wt],Ht=w[wt+1]-w[wt];if(Qt!==0&&Qt!==3)for(let ae=0;ae<Ht;ae++){let Kt=_[pt]-_[pt-1];pt++;for(let qt=0;qt<Kt;qt++)tt=P[Vt++]=tt+lt[Yt++]}else for(let ae=0;ae<Ht;ae++)P[Vt++]=++tt,pt++}return P})(C,b,h,V)):h!==null&&(h=(function(L,w,_){let lt=new Int32Array(w[w.length-1]+1),P=0;lt[0]=P;let tt=1,pt=0;for(let Vt=0;Vt<L.length;Vt++){let Yt=L[Vt],wt=w[Vt+1]-w[Vt];if(Yt===4||Yt===1)for(let Qt=0;Qt<wt;Qt++)P=lt[tt++]=P+_[pt++];else for(let Qt=0;Qt<wt;Qt++)lt[tt++]=++P}return lt})(C,b,h))):h!==null&&V!==null?(h=Am(C,h,1),V=Rh(C,h,V,!0)):h!==null&&(h=Am(C,h,0)),S!==null?rb.create(C,J,S,N,new Mr(b,h,V)):M===null?js.create(C,new Mr(b,h,V),R,N):js.createMortonEncoded(C,new Mr(b,h,V),R,N,M))}function Am(l,t,i){let n=new Int32Array(l.length+1),d=0;n[0]=d;let r=0;for(let b=0;b<l.length;b++)d=n[b+1]=d+(l[b]>i?t[r++]:1);return n}function Rh(l,t,i,n){let d=new Int32Array(t[t.length-1]+1),r=0;d[0]=r;let b=1,h=0;for(let V=0;V<l.length;V++){let R=l[V],N=t[V+1]-t[V];if(R===5||R===2||n&&(R===4||R===1))for(let M=0;M<N;M++)r=d[b++]=r+i[h++];else for(let M=0;M<N;M++)d[b++]=++r}return d}class Ug extends Ir{dataVector;constructor(t,i,n){super(t,i.getBuffer(),n),this.dataVector=i}getValueFromBuffer(t){return this.dataVector.get(t)}}class Mg extends ib{getValueFromBuffer(t){return this.dataBuffer[t]}}class Fh extends Ir{constructor(t,i,n){super(t,BigInt64Array.of(i),n)}getValueFromBuffer(t){return this.dataBuffer[0]}}function Yg(l,t,i){for(let n=0;n<l;n++){let d=ga.decode(t,i);i.add(d.byteLength)}}function As(l,t,i){return Gh(l,Math.ceil(t/8),i)}function Gh(l,t,i){let n=new Uint8Array(t),d=0;for(;d<t;){let r=l[i.increment()];if(r<=127){let b=r+3,h=l[i.increment()],V=d+b;n.fill(h,d,V),d=V}else{let b=256-r;for(let h=0;h<b;h++)n[d++]=l[i.increment()]}}return n}let xg=new TextDecoder;function wm(l,t,i){return i-t>=12?xg.decode(l.subarray(t,i)):(function(n,d,r){let b="",h=d;for(;h<r;){let V=n[h],R,N,M,J=null,S=V>239?4:V>223?3:V>191?2:1;if(h+S>r)break;S===1?V<128&&(J=V):S===2?(R=n[h+1],(192&R)==128&&(J=(31&V)<<6|63&R,J<=127&&(J=null))):S===3?(R=n[h+1],N=n[h+2],(192&R)==128&&(192&N)==128&&(J=(15&V)<<12|(63&R)<<6|63&N,(J<=2047||J>=55296&&J<=57343)&&(J=null))):S===4&&(R=n[h+1],N=n[h+2],M=n[h+3],(192&R)==128&&(192&N)==128&&(192&M)==128&&(J=(15&V)<<18|(63&R)<<12|(63&N)<<6|63&M,(J<=65535||J>=1114112)&&(J=null))),J===null?(J=65533,S=1):J>65535&&(J-=65536,b+=String.fromCharCode(J>>>10&1023|55296),J=56320|1023&J),b+=String.fromCharCode(J),h+=S}return b})(l,t,i)}class vm extends Ir{offsetBuffer;constructor(t,i,n,d){super(t,n,d),this.offsetBuffer=i}}class Nh extends vm{textEncoder;constructor(t,i,n,d){super(t,i,n,d??i.length-1),this.textEncoder=new TextEncoder}getValueFromBuffer(t){return wm(this.dataBuffer,this.offsetBuffer[t],this.offsetBuffer[t+1])}}class xr extends vm{indexBuffer;textEncoder;constructor(t,i,n,d,r){super(t,n,d,r??i.length),this.indexBuffer=i,this.indexBuffer=i,this.textEncoder=new TextEncoder}getValueFromBuffer(t){let i=this.indexBuffer[t];return wm(this.dataBuffer,this.offsetBuffer[i],this.offsetBuffer[i+1])}}class Ih extends vm{indexBuffer;symbolOffsetBuffer;symbolTableBuffer;textEncoder;symbolLengthBuffer;lengthBuffer;decodedDictionary;constructor(t,i,n,d,r,b,h){super(t,n,d,h),this.indexBuffer=i,this.symbolOffsetBuffer=r,this.symbolTableBuffer=b,this.textEncoder=new TextEncoder}getValueFromBuffer(t){this.decodedDictionary==null&&(this.symbolLengthBuffer==null&&(this.symbolLengthBuffer=this.offsetToLengthBuffer(this.symbolOffsetBuffer),this.lengthBuffer=this.offsetToLengthBuffer(this.offsetBuffer)),this.decodedDictionary=(function(n,d,r){let b=[],h=new Array(d.length).fill(0);for(let V=1;V<d.length;V++)h[V]=h[V-1]+d[V-1];for(let V=0;V<r.length;V++)if(r[V]===255)b.push(r[++V]);else{let R=d[r[V]],N=h[r[V]];for(let M=0;M<R;M++)b.push(n[N+M])}return new Uint8Array(b)})(this.symbolTableBuffer,this.symbolLengthBuffer,this.dataBuffer));let i=this.indexBuffer[t];return wm(this.decodedDictionary,this.offsetBuffer[i],this.offsetBuffer[i+1])}offsetToLengthBuffer(t){let i=new Uint32Array(t.length-1),n=t[0];for(let d=1;d<t.length;d++){let r=t[d];i[d-1]=r-n,n=r}return i}}class ws{static ROOT_COLUMN_NAME="default";static NESTED_COLUMN_SEPARATOR=":";constructor(){}static decode(t,i,n,d,r){let b=null,h=null,V=null,R=null,N=null,M=null,J=null,S=null;for(let C=0;C<d;C++){let L=ga.decode(i,n);if(L.byteLength!==0)switch(L.physicalStreamType){case la.PRESENT:{let w=As(i,L.numValues,n);M=new od(w,L.numValues);break}case la.OFFSET:h=r!=null||M!=null?ke.decodeNullableIntStream(i,n,L,!1,r??M):ke.decodeIntStream(i,n,L,!1);break;case la.LENGTH:{let w=ke.decodeLengthStreamToOffsetBuffer(i,n,L);an.DICTIONARY===L.logicalStreamType.lengthType?b=w:an.SYMBOL===L.logicalStreamType.lengthType?R=w:J=w;break}case la.DATA:{let w=i.subarray(n.get(),n.get()+L.byteLength);n.add(L.byteLength);let _=L.logicalStreamType.dictionaryType;cd.FSST===_?N=w:cd.SINGLE===_||cd.SHARED===_?V=w:cd.NONE===_&&(S=w);break}}}return this.decodeFsstDictionaryVector(t,N,h,b,V,R,r??M)??this.decodeDictionaryVector(t,V,h,b,r??M)??this.decodePlainStringVector(t,J,S,h,r??M)}static decodeFsstDictionaryVector(t,i,n,d,r,b,h){return i?new Ih(t,n,d,r,b,i,h):null}static decodeDictionaryVector(t,i,n,d,r){return i?r?new xr(t,n,d,i,r):new xr(t,n,d,i):null}static decodePlainStringVector(t,i,n,d,r){if(!i||!n)return null;if(d)return r?new xr(t,d,i,n,r):new xr(t,d,i,n);if(r&&r.size()!==i.length-1){let b=new Int32Array(r.size()),h=0;for(let V=0;V<r.size();V++)b[V]=r.get(V)?h++:0;return new xr(t,b,i,n,r)}return r?new Nh(t,i,n,r):new Nh(t,i,n)}static decodeSharedDictionary(t,i,n,d,r){let b=null,h=null,V=null,R=null,N=!1;for(;!N;){let C=ga.decode(t,i);switch(C.physicalStreamType){case la.LENGTH:an.DICTIONARY===C.logicalStreamType.lengthType?b=ke.decodeLengthStreamToOffsetBuffer(t,i,C):V=ke.decodeLengthStreamToOffsetBuffer(t,i,C);break;case la.DATA:cd.SINGLE===C.logicalStreamType.dictionaryType||cd.SHARED===C.logicalStreamType.dictionaryType?(h=t.subarray(i.get(),i.get()+C.byteLength),N=!0):R=t.subarray(i.get(),i.get()+C.byteLength),i.add(C.byteLength)}}let M=n.complexType.children,J=[],S=0;for(let C of M){let L=Ul(t,i,1)[0];if(L==0)continue;let w=`${n.name}${C.name===ws.ROOT_COLUMN_NAME?"":ws.NESTED_COLUMN_SEPARATOR+C.name}`;if(r&&!r.has(w)){Yg(L,t,i);continue}if(L!==2||C.type!=="scalarField"||C.scalarField.physicalType!==9)throw new Error("Currently only optional string fields are implemented for a struct.");let _=ga.decode(t,i),lt=As(t,_.numValues,i),P=ga.decode(t,i),tt=(P instanceof Es?P.numRleValues:P.numValues)!==d?ke.decodeNullableIntStream(t,i,P,!1,new od(lt,_.numValues)):ke.decodeIntStream(t,i,P,!1);J[S++]=R?new Ih(w,tt,b,h,V,R,new od(lt,_.numValues)):new xr(w,tt,b,h,new od(lt,_.numValues))}return J}}function Tg(l,t,i,n,d,r){return i.type==="scalarType"?(function(b,h,V,R,N,M){let J=null,S=0;if(b===0)return null;if(M.nullable){let L=ga.decode(h,V);S=L.numValues;let w=V.get(),_=As(h,S,V);V.set(w+L.byteLength),J=new od(_,L.numValues)}let C=J??R;switch(N.physicalType){case 4:case 3:return(function(L,w,_,lt,P){let tt=ga.decode(L,w),pt=ke.getVectorType(tt,P,L,w),Vt=lt.physicalType===3;if(pt===Sl.FLAT){let Yt=vs(P)?ke.decodeNullableIntStream(L,w,tt,Vt,P):ke.decodeIntStream(L,w,tt,Vt);return new Bm(_.name,Yt,P)}if(pt===Sl.SEQUENCE){let Yt=ke.decodeSequenceIntStream(L,w,tt);return new Cm(_.name,Yt[0],Yt[1],tt.numRleValues)}{let Yt=ke.decodeConstIntStream(L,w,tt,Vt);return new km(_.name,Yt,P)}})(h,V,M,N,C);case 9:return ws.decode(M.name,h,V,M.nullable?b-1:b,J);case 0:return(function(L,w,_,lt,P){let tt=ga.decode(L,w),pt=tt.numValues,Vt=w.get(),Yt=vs(P)?(function(Qt,Ht,ae,Kt){let qt=Gh(Qt,Math.ceil(Ht/8),ae),Lt=new od(qt,Ht),Ze=Kt.size(),pe=new od(new Uint8Array(Ze),Ze),Fe=0;for(let re=0;re<Kt.size();re++){let He=!!Kt.get(re)&&Lt.get(Fe++);pe.set(re,He)}return pe.getBuffer()})(L,pt,w,P):As(L,pt,w);w.set(Vt+tt.byteLength);let wt=new od(Yt,pt);return new Ug(_.name,wt,P)})(h,V,M,0,C);case 6:case 5:return(function(L,w,_,lt,P){let tt=ga.decode(L,w),pt=ke.getVectorType(tt,lt,L,w),Vt=P.physicalType===5;if(pt===Sl.FLAT){let Yt=vs(lt)?ke.decodeNullableLongStream(L,w,tt,Vt,lt):ke.decodeLongStream(L,w,tt,Vt);return new Zh(_.name,Yt,lt)}if(pt===Sl.SEQUENCE){let Yt=ke.decodeSequenceLongStream(L,w,tt);return new ph(_.name,Yt[0],Yt[1],tt.numRleValues)}{let Yt=ke.decodeConstLongStream(L,w,tt,Vt);return new Fh(_.name,Yt,lt)}})(h,V,M,C,N);case 7:return(function(L,w,_,lt){let P=ga.decode(L,w),tt=vs(lt)?(function(pt,Vt,Yt,wt){let Qt=Vt.get(),Ht=Qt+wt*Float32Array.BYTES_PER_ELEMENT,ae=new Uint8Array(pt.subarray(Qt,Ht)).buffer,Kt=new Float32Array(ae);Vt.set(Ht);let qt=Yt.size(),Lt=new Float32Array(qt),Ze=0;for(let pe=0;pe<qt;pe++)Lt[pe]=Yt.get(pe)?Kt[Ze++]:0;return Lt})(L,w,lt,P.numValues):(function(pt,Vt,Yt){let wt=Vt.get(),Qt=wt+Yt*Float32Array.BYTES_PER_ELEMENT,Ht=new Uint8Array(pt.subarray(wt,Qt)).buffer,ae=new Float32Array(Ht);return Vt.set(Qt),ae})(L,w,P.numValues);return new Mg(_.name,tt,lt)})(h,V,M,C);case 8:return(function(L,w,_,lt){let P=ga.decode(L,w),tt=vs(lt)?(function(pt,Vt,Yt,wt){let Qt=Vt.get(),Ht=Qt+wt*Float64Array.BYTES_PER_ELEMENT,ae=new Uint8Array(pt.subarray(Qt,Ht)).buffer,Kt=new Float64Array(ae);Vt.set(Ht);let qt=Yt.size(),Lt=new Float64Array(qt),Ze=0;for(let pe=0;pe<qt;pe++)Lt[pe]=Yt.get(pe)?Kt[Ze++]:0;return Lt})(L,w,lt,P.numValues):(function(pt,Vt,Yt){let wt=Vt.get(),Qt=wt+Yt*Float64Array.BYTES_PER_ELEMENT,Ht=new Uint8Array(pt.subarray(wt,Qt)).buffer,ae=new Float64Array(Ht);return Vt.set(Qt),ae})(L,w,P.numValues);return new Sm(_.name,tt,lt)})(h,V,M,C);default:throw new Error(`The specified data type for the field is currently not supported: ${N}`)}})(n,l,t,d,i.scalarType,i):n!=1?null:ws.decodeSharedDictionary(l,t,i,d,r)}function vs(l){return l instanceof od}class sb{static decodeColumnType(t){switch(t){case 0:case 1:case 2:case 3:{let i={};i.nullable=!!(1&t),i.columnScope=0;let n={};return n.physicalType=t>1?6:4,n.type="physicalType",i.scalarType=n,i.type="scalarType",i}case 4:{let i={nullable:!1,columnScope:0},n={type:"physicalType",physicalType:0};return i.type="complexType",i.complexType=n,i}case 30:{let i={nullable:!1,columnScope:0},n={type:"physicalType",physicalType:1};return i.type="complexType",i.complexType=n,i}default:return this.mapScalarType(t)}}static columnTypeHasName(t){return t>=10}static columnTypeHasChildren(t){return t===30}static hasStreamCount(t){if(t.name==="id")return!1;if(t.type==="scalarType"){let i=t.scalarType;if(i.type==="physicalType")switch(i.physicalType){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:default:return!1;case 9:return!0}else if(i.type==="logicalType")return!1}else if(t.type==="complexType"){let i=t.complexType;if(i.type==="physicalType")switch(i.physicalType){case 0:case 1:return!0;default:return!1}}return console.warn("Unexpected column type in hasStreamCount",t),!1}static mapScalarType(t){let i=null;switch(t){case 10:case 11:i=0;break;case 12:case 13:i=1;break;case 14:case 15:i=2;break;case 16:case 17:i=3;break;case 18:case 19:i=4;break;case 20:case 21:i=5;break;case 22:case 23:i=6;break;case 24:case 25:i=7;break;case 26:case 27:i=8;break;case 28:case 29:i=9;break;default:return null}let n={};n.nullable=!!(1&t),n.columnScope=0;let d={type:"physicalType"};return d.physicalType=i,n.type="scalarType",n.scalarType=d,n}}let Xg=new TextDecoder;function Uh(l,t){let i=Ul(l,t,1)[0];if(i===0)return"";let n=t.get(),d=l.subarray(n,n+i);return t.add(i),Xg.decode(d)}function Mh(l,t){let i=Ul(l,t,1)[0]>>>0,n=!!(4&i),d=!!(2&i),r=Ul(l,t,1)[0]>>>0,b={};if(1&i&&(b.nullable=!0),d){let h={};if(n?(h.type="logicalType",h.logicalType=r):(h.type="physicalType",h.physicalType=r),8&i){let V=Ul(l,t,1)[0]>>>0;h.children=new Array(V);for(let R=0;R<V;R++)h.children[R]=Mh(l,t)}b.type="complexField",b.complexField=h}else{let h={};n?(h.type="logicalType",h.logicalType=r):(h.type="physicalType",h.physicalType=r),b.type="scalarField",b.scalarField=h}return b}function Jg(l,t){let i=Ul(l,t,1)[0]>>>0,n=sb.decodeColumnType(i);if(!n)throw new Error(`Unsupported column type code: ${i}`);if(sb.columnTypeHasName(i)?n.name=Uh(l,t):i>=0&&i<=3?n.name="id":i===4&&(n.name="geometry"),sb.columnTypeHasChildren(i)){let d=Ul(l,t,1)[0]>>>0,r=n.complexType;r.children=new Array(d);for(let b=0;b<d;b++)r.children[b]=Mh(l,t)}return n}function yg(l,t){let i={featureTables:[]},n={};n.name=Uh(l,t);let d=Ul(l,t,1)[0]>>>0,r=Ul(l,t,1)[0]>>>0;n.columns=new Array(r);for(let b=0;b<r;b++)n.columns[b]=Jg(l,t);return i.featureTables.push(n),[i,d]}function Bg(l,t,i,n,d,r,b=!1){let h=t.scalarType.physicalType,V=ke.getVectorType(d,r,l,i);if(h===4)switch(V){case Sl.FLAT:{let R=ke.decodeIntStream(l,i,d,!1);return new Bm(n,R,r)}case Sl.SEQUENCE:{let R=ke.decodeSequenceIntStream(l,i,d);return new Cm(n,R[0],R[1],d.numRleValues)}case Sl.CONST:{let R=ke.decodeConstIntStream(l,i,d,!1);return new km(n,R,r)}}else switch(V){case Sl.FLAT:{if(b){let N=ke.decodeLongFloat64Stream(l,i,d,!1);return new Sm(n,N,r)}let R=ke.decodeLongStream(l,i,d,!1);return new Zh(n,R,r)}case Sl.SEQUENCE:{let R=ke.decodeSequenceLongStream(l,i,d);return new ph(n,R[0],R[1],d.numRleValues)}case Sl.CONST:{let R=ke.decodeConstLongStream(l,i,d,!1);return new Fh(n,R,r)}}throw new Error("Vector type not supported for id column.")}class Sg{constructor(t,i){var n;switch(this._featureData=t,this.properties=this._featureData.properties||{},(n=this._featureData.geometry)===null||n===void 0?void 0:n.type){case Cl.POINT:case Cl.MULTIPOINT:this.type=1;break;case Cl.LINESTRING:case Cl.MULTILINESTRING:this.type=2;break;case Cl.POLYGON:case Cl.MULTIPOLYGON:this.type=3;break;default:this.type=0}this.extent=i,this.id=Number(this._featureData.id)}projectPoint(t,i,n,d){return[360*(t.x+i)/d-180,360/Math.PI*Math.atan(Math.exp((1-2*(t.y+n)/d)*Math.PI))-90]}projectLine(t,i,n,d){return t.map((r=>this.projectPoint(r,i,n,d)))}toGeoJSON(t,i,n){let d=this.extent*Math.pow(2,n),r=this.extent*t,b=this.extent*i,h=this.loadGeometry(),V;switch(this.type){case 1:{let N=[];for(let J of h)N.push(J[0]);let M=this.projectLine(N,r,b,d);V=N.length===1?{type:"Point",coordinates:M[0]}:{type:"MultiPoint",coordinates:M};break}case 2:{let N=h.map((M=>this.projectLine(M,r,b,d)));V=N.length===1?{type:"LineString",coordinates:N[0]}:{type:"MultiLineString",coordinates:N};break}case 3:{let N=xa(h),M=[];for(let J of N)M.push(J.map((S=>this.projectLine(S,r,b,d))));V=M.length===1?{type:"Polygon",coordinates:M[0]}:{type:"MultiPolygon",coordinates:M};break}default:throw new Error(`unknown feature type: ${this.type}`)}let R={type:"Feature",geometry:V,properties:this.properties};return this.id!=null&&(R.id=this.id),R}loadGeometry(){let t=[];for(let i of this._featureData.geometry.coordinates){let n=[];for(let d of i)n.push(new st(d.x,d.y));t.push(n)}return t}bbox(){return[0,0,0,0]}}class Cg{constructor(t){this.features=[],this.featureTable=t,this.name=t.name,this.extent=t.extent,this.version=2,this.features=t.getFeatures(),this.length=this.features.length}feature(t){return new Sg(this.features[t],this.extent)}}class Yh{constructor(t){this.layers={};let i=(function(n,d,r=!0){let b=new ug(0),h=[];for(;b.get()<n.length;){let V=Ul(n,b,1)[0]>>>0,R=b.get()+V;if(R>n.length)throw new Error(`Block overruns tile: ${R} > ${n.length}`);if(Ul(n,b,1)[0]>>>0!=1){b.set(R);continue}let N=yg(n,b),M=N[1],J=N[0].featureTables[0],S=null,C=null,L=[],w=0;for(let lt of J.columns){let P=lt.name;if(P==="id"){let tt=null;if(lt.nullable){let Vt=ga.decode(n,b),Yt=b.get(),wt=As(n,Vt.numValues,b);b.set(Yt+Vt.byteLength),tt=new od(wt,Vt.numValues)}let pt=ga.decode(n,b);w=pt.getDecompressedCount(),S=Bg(n,lt,b,P,pt,tt??w,r)}else if(P==="geometry"){let tt=Ul(n,b,1)[0];if(w===0){let pt=b.get();w=ga.decode(n,b).getDecompressedCount(),b.set(pt)}C=Ig(n,tt,b,w,d)}else{let tt=sb.hasStreamCount(lt)?Ul(n,b,1)[0]:1;if(tt===0&&lt.type==="scalarType")continue;let pt=Tg(n,b,lt,tt,w,void 0);pt&&(Array.isArray(pt)?L.push(...pt):L.push(pt))}}let _=new gg(J.name,C,S,L,M);h.push(_),b.set(R)}return h})(new Uint8Array(t));this.layers=i.reduce(((n,d)=>Object.assign(Object.assign({},n),{[d.name]:new Cg(d)})),{})}}class uo{constructor(){this.minX=1/0,this.maxX=-1/0,this.minY=1/0,this.maxY=-1/0}extend(t){return this.minX=Math.min(this.minX,t.x),this.minY=Math.min(this.minY,t.y),this.maxX=Math.max(this.maxX,t.x),this.maxY=Math.max(this.maxY,t.y),this}expandBy(t){return this.minX-=t,this.minY-=t,this.maxX+=t,this.maxY+=t,(this.minX>this.maxX||this.minY>this.maxY)&&(this.minX=1/0,this.maxX=-1/0,this.minY=1/0,this.maxY=-1/0),this}shrinkBy(t){return this.expandBy(-t)}map(t){let i=new uo;return i.extend(t(new st(this.minX,this.minY))),i.extend(t(new st(this.maxX,this.minY))),i.extend(t(new st(this.minX,this.maxY))),i.extend(t(new st(this.maxX,this.maxY))),i}static fromPoints(t){let i=new uo;for(let n of t)i.extend(n);return i}contains(t){return t.x>=this.minX&&t.x<=this.maxX&&t.y>=this.minY&&t.y<=this.maxY}empty(){return this.minX>this.maxX}width(){return this.maxX-this.minX}height(){return this.maxY-this.minY}covers(t){return!this.empty()&&!t.empty()&&t.minX>=this.minX&&t.maxX<=this.maxX&&t.minY>=this.minY&&t.maxY<=this.maxY}intersects(t){return!this.empty()&&!t.empty()&&t.minX<=this.maxX&&t.maxX>=this.minX&&t.minY<=this.maxY&&t.maxY>=this.minY}}let Hm="_geojsonTileLayer";class xh{constructor(t,i){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new eo(Le,16,0),this.grid3D=new eo(Le,16,0),this.featureIndexArray=new $,this.promoteId=i}insert(t,i,n,d,r,b){let h=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(n,d,r);let V=b?this.grid3D:this.grid;for(let R=0;R<i.length;R++){let N=i[R],M=[1/0,1/0,-1/0,-1/0];for(let J=0;J<N.length;J++){let S=N[J];M[0]=Math.min(M[0],S.x),M[1]=Math.min(M[1],S.y),M[2]=Math.max(M[2],S.x),M[3]=Math.max(M[3],S.y)}M[0]<Le&&M[1]<Le&&M[2]>=0&&M[3]>=0&&V.insert(h,M[0],M[1],M[2],M[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=this.encoding!=="mlt"?new NW(new Nm(this.rawTileData)).layers:new Yh(this.rawTileData).layers,this.sourceLayerCoder=new dh(this.vtLayers?Object.keys(this.vtLayers).sort():[Hm])),this.vtLayers}query(t,i,n,d){this.loadVTLayers();let r=t.params,b=Le/t.tileSize/t.scale,h=Oc(r.filter,r.globalState),V=t.queryGeometry,R=t.queryPadding*b,N=uo.fromPoints(V),M=this.grid.query(N.minX-R,N.minY-R,N.maxX+R,N.maxY+R),J=uo.fromPoints(t.cameraQueryGeometry).expandBy(R),S=this.grid3D.query(J.minX,J.minY,J.maxX,J.maxY,((w,_,lt,P)=>(function(tt,pt,Vt,Yt,wt){for(let Ht of tt)if(pt<=Ht.x&&Vt<=Ht.y&&Yt>=Ht.x&&wt>=Ht.y)return!0;let Qt=[new st(pt,Vt),new st(pt,wt),new st(Yt,wt),new st(Yt,Vt)];if(tt.length>2){for(let Ht of Qt)if(hr(tt,Ht))return!0}for(let Ht=0;Ht<tt.length-1;Ht++)if(Dp(tt[Ht],tt[Ht+1],Qt))return!0;return!1})(t.cameraQueryGeometry,w-R,_-R,lt+R,P+R)));for(let w of S)M.push(w);M.sort(kg);let C={},L;for(let w=0;w<M.length;w++){let _=M[w];if(_===L)continue;L=_;let lt=this.featureIndexArray.get(_),P=null;this.loadMatchingFeature(C,lt.bucketIndex,lt.sourceLayerIndex,lt.featureIndex,h,r.layers,r.availableImages,i,n,d,((tt,pt,Vt)=>(P||(P=Td(tt)),pt.queryIntersectsFeature({queryGeometry:V,feature:tt,featureState:Vt,geometry:P,zoom:this.z,transform:t.transform,pixelsToTileUnits:b,pixelPosMatrix:t.pixelPosMatrix,unwrappedTileID:this.tileID.toUnwrapped(),getElevation:t.getElevation}))))}return C}loadMatchingFeature(t,i,n,d,r,b,h,V,R,N,M){let J=this.bucketLayerIDs[i];if(b&&!J.some((w=>b.has(w))))return;let S=this.sourceLayerCoder.decode(n),C=this.vtLayers[S].feature(d);if(r.needGeometry){let w=dd(C,!0);if(!r.filter(new Vi(this.tileID.overscaledZ),w,this.tileID.canonical))return}else if(!r.filter(new Vi(this.tileID.overscaledZ),C))return;let L=this.getId(C,S);for(let w=0;w<J.length;w++){let _=J[w];if(b&&!b.has(_))continue;let lt=V[_];if(!lt)continue;let P={};L&&N&&(P=N.getState(lt.sourceLayer||Hm,L));let tt=ki({},R[_]);tt.paint=Th(tt.paint,lt.paint,C,P,h),tt.layout=Th(tt.layout,lt.layout,C,P,h);let pt=!M||M(C,lt,P);if(!pt)continue;let Vt=new ch(C,this.z,this.x,this.y,L);Vt.layer=tt;let Yt=t[_];Yt===void 0&&(Yt=t[_]=[]),Yt.push({featureIndex:d,feature:Vt,intersectionZ:pt})}}lookupSymbolFeatures(t,i,n,d,r,b,h,V){let R={};this.loadVTLayers();let N=Oc(r.filterSpec,r.globalState);for(let M of t)this.loadMatchingFeature(R,n,d,M,N,b,h,V,i);return R}hasLayer(t){for(let i of this.bucketLayerIDs)for(let n of i)if(t===n)return!0;return!1}getId(t,i){var n;let d=t.id;return this.promoteId&&(d=t.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[i]],typeof d=="boolean"&&(d=Number(d)),d===void 0&&(!((n=t.properties)===null||n===void 0)&&n.cluster)&&this.promoteId&&(d=Number(t.properties.cluster_id))),d}}function Th(l,t,i,n,d){return Fl(l,((r,b)=>{let h=t instanceof vd?t.get(b):null;return h&&h.evaluate?h.evaluate(i,n,d):h}))}function kg(l,t){return t-l}function Xh(l,t,i,n,d){let r=[];for(let b=0;b<l.length;b++){let h=l[b],V;for(let R=0;R<h.length-1;R++){let N=h[R],M=h[R+1];N.x<t&&M.x<t||(N.x<t?N=new st(t,N.y+(t-N.x)/(M.x-N.x)*(M.y-N.y))._round():M.x<t&&(M=new st(t,N.y+(t-N.x)/(M.x-N.x)*(M.y-N.y))._round()),N.y<i&&M.y<i||(N.y<i?N=new st(N.x+(i-N.y)/(M.y-N.y)*(M.x-N.x),i)._round():M.y<i&&(M=new st(N.x+(i-N.y)/(M.y-N.y)*(M.x-N.x),i)._round()),N.x>=n&&M.x>=n||(N.x>=n?N=new st(n,N.y+(n-N.x)/(M.x-N.x)*(M.y-N.y))._round():M.x>=n&&(M=new st(n,N.y+(n-N.x)/(M.x-N.x)*(M.y-N.y))._round()),N.y>=d&&M.y>=d||(N.y>=d?N=new st(N.x+(d-N.y)/(M.y-N.y)*(M.x-N.x),d)._round():M.y>=d&&(M=new st(N.x+(d-N.y)/(M.y-N.y)*(M.x-N.x),d)._round()),V&&N.equals(V[V.length-1])||(V=[N],r.push(V)),V.push(M)))))}}return r}function Jh(l,t,i,n,d){switch(t){case 1:return(function(r,b,h,V){let R=[];for(let N of r)for(let M of N){let J=V===0?M.x:M.y;J>=b&&J<=h&&R.push([M])}return R})(l,i,n,d);case 2:return yh(l,i,n,d,!1);case 3:return yh(l,i,n,d,!0)}return[]}function Qg(l,t,i,n,d){let r=n===0?Lg:Eg,b=[],h=[];for(let N=0;N<l.length-1;N++){let M=l[N],J=l[N+1],S=n===0?M.x:M.y,C=n===0?J.x:J.y,L=!1;S<t?C>t&&b.push(r(M,J,t)):S>i?C<i&&b.push(r(M,J,i)):b.push(M),C<t&&S>=t&&(b.push(r(M,J,t)),L=!0),C>i&&S<=i&&(b.push(r(M,J,i)),L=!0),!d&&L&&(h.push(b),b=[])}let V=l.length-1,R=n===0?l[V].x:l[V].y;return R>=t&&R<=i&&b.push(l[V]),d&&b.length>0&&!b[0].equals(b[b.length-1])&&b.push(new st(b[0].x,b[0].y)),b.length>0&&h.push(b),h}function yh(l,t,i,n,d){let r=[];for(let b of l){let h=Qg(b,t,i,n,d);h.length>0&&r.push(...h)}return r}function Lg(l,t,i){return new st(i,l.y+(i-l.x)/(t.x-l.x)*(t.y-l.y))}function Eg(l,t,i){return new st(l.x+(i-l.y)/(t.y-l.y)*(t.x-l.x),i)}ne("FeatureIndex",xh,{omit:["rawTileData","sourceLayerCoder"]});class Yc extends st{constructor(t,i,n,d){super(t,i),this.angle=n,d!==void 0&&(this.segment=d)}clone(){return new Yc(this.x,this.y,this.angle,this.segment)}}function Bh(l,t,i,n,d){if(t.segment===void 0||i===0)return!0;let r=t,b=t.segment+1,h=0;for(;h>-i/2;){if(b--,b<0)return!1;h-=l[b].dist(r),r=l[b]}h+=l[b].dist(l[b+1]),b++;let V=[],R=0;for(;h<i/2;){let N=l[b],M=l[b+1];if(!M)return!1;let J=l[b-1].angleTo(N)-N.angleTo(M);for(J=Math.abs((J+3*Math.PI)%(2*Math.PI)-Math.PI),V.push({distance:h,angleDelta:J}),R+=J;h-V[0].distance>n;)R-=V.shift().angleDelta;if(R>d)return!1;b++,h+=N.dist(M)}return!0}function Sh(l){let t=0;for(let i=0;i<l.length-1;i++)t+=l[i].dist(l[i+1]);return t}function Ch(l,t,i){return l?.6*t*i:0}function kh(l,t){return Math.max(l?l.right-l.left:0,t?t.right-t.left:0)}function zg(l,t,i,n,d,r){let b=Ch(i,d,r),h=kh(i,n)*r,V=0,R=Sh(l)/2;for(let N=0;N<l.length-1;N++){let M=l[N],J=l[N+1],S=M.dist(J);if(V+S>R){let C=(R-V)/S,L=Gt.number(M.x,J.x,C),w=Gt.number(M.y,J.y,C),_=new Yc(L,w,J.angleTo(M),N);return _._round(),!b||Bh(l,_,h,b,t)?_:void 0}V+=S}}function jg(l,t,i,n,d,r,b,h,V){let R=Ch(n,r,b),N=kh(n,d),M=N*b,J=l[0].x===0||l[0].x===V||l[0].y===0||l[0].y===V;return t-M<t/4&&(t=M+t/4),Qh(l,J?t/2*h%t:(N/2+2*r)*b*h%t,t,R,i,M,J,!1,V)}function Qh(l,t,i,n,d,r,b,h,V){let R=r/2,N=Sh(l),M=0,J=t-i,S=[];for(let C=0;C<l.length-1;C++){let L=l[C],w=l[C+1],_=L.dist(w),lt=w.angleTo(L);for(;J+i<M+_;){J+=i;let P=(J-M)/_,tt=Gt.number(L.x,w.x,P),pt=Gt.number(L.y,w.y,P);if(tt>=0&&tt<V&&pt>=0&&pt<V&&J-R>=0&&J+R<=N){let Vt=new Yc(tt,pt,lt,C);Vt._round(),n&&!Bh(l,Vt,r,n,d)||S.push(Vt)}}M+=_}return h||S.length||b||(S=Qh(l,M/2,i,n,d,r,b,!0,V)),S}function Lh(l,t,i,n){let d=[],r=l.image,b=r.pixelRatio,h=r.paddedRect.w-2,V=r.paddedRect.h-2,R={x1:l.left,y1:l.top,x2:l.right,y2:l.bottom},N=r.stretchX||[[0,h]],M=r.stretchY||[[0,V]],J=(Lt,Ze)=>Lt+Ze[1]-Ze[0],S=N.reduce(J,0),C=M.reduce(J,0),L=h-S,w=V-C,_=0,lt=S,P=0,tt=C,pt=0,Vt=L,Yt=0,wt=w;if(r.content&&n){let Lt=r.content,Ze=Lt[2]-Lt[0],pe=Lt[3]-Lt[1];(r.textFitWidth||r.textFitHeight)&&(R=wW(l)),_=bb(N,0,Lt[0]),P=bb(M,0,Lt[1]),lt=bb(N,Lt[0],Lt[2]),tt=bb(M,Lt[1],Lt[3]),pt=Lt[0]-_,Yt=Lt[1]-P,Vt=Ze-lt,wt=pe-tt}let Qt=R.x1,Ht=R.y1,ae=R.x2-Qt,Kt=R.y2-Ht,qt=(Lt,Ze,pe,Fe)=>{let re=mb(Lt.stretch-_,lt,ae,Qt),He=Wb(Lt.fixed-pt,Vt,Lt.stretch,S),Si=mb(Ze.stretch-P,tt,Kt,Ht),gl=Wb(Ze.fixed-Yt,wt,Ze.stretch,C),na=mb(pe.stretch-_,lt,ae,Qt),Jn=Wb(pe.fixed-pt,Vt,pe.stretch,S),ya=mb(Fe.stretch-P,tt,Kt,Ht),Dl=Wb(Fe.fixed-Yt,wt,Fe.stretch,C),da=new st(re,Si),nl=new st(na,Si),fl=new st(na,ya),ua=new st(re,ya),Ra=new st(He/b,gl/b),ja=new st(Jn/b,Dl/b),ca=t*Math.PI/180;if(ca){let kl=Math.sin(ca),Ai=Math.cos(ca),ul=[Ai,-kl,kl,Ai];da._matMult(ul),nl._matMult(ul),ua._matMult(ul),fl._matMult(ul)}let Aa=Lt.stretch+Lt.fixed,yn=Ze.stretch+Ze.fixed;return{tl:da,tr:nl,bl:ua,br:fl,tex:{x:r.paddedRect.x+1+Aa,y:r.paddedRect.y+1+yn,w:pe.stretch+pe.fixed-Aa,h:Fe.stretch+Fe.fixed-yn},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Ra,pixelOffsetBR:ja,minFontScaleX:Vt/b/ae,minFontScaleY:wt/b/Kt,isSDF:i}};if(n&&(r.stretchX||r.stretchY)){let Lt=Eh(N,L,S),Ze=Eh(M,w,C);for(let pe=0;pe<Lt.length-1;pe++){let Fe=Lt[pe],re=Lt[pe+1];for(let He=0;He<Ze.length-1;He++)d.push(qt(Fe,Ze[He],re,Ze[He+1]))}}else d.push(qt({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:h+1},{fixed:0,stretch:V+1}));return d}function bb(l,t,i){let n=0;for(let d of l)n+=Math.max(t,Math.min(i,d[1]))-Math.max(t,Math.min(i,d[0]));return n}function Eh(l,t,i){let n=[{fixed:-1,stretch:0}];for(let[d,r]of l){let b=n[n.length-1];n.push({fixed:d-b.stretch,stretch:b.stretch}),n.push({fixed:d-b.stretch,stretch:b.stretch+(r-d)})}return n.push({fixed:t+1,stretch:i}),n}function mb(l,t,i,n){return l/t*i+n}function Wb(l,t,i,n){return l-t*i/n}ne("Anchor",Yc);class hb{constructor(t,i,n,d,r,b,h,V,R,N){var M;if(this.boxStartIndex=t.length,R){let J=b.top,S=b.bottom,C=b.collisionPadding;C&&(J-=C[1],S+=C[3]);let L=S-J;L>0&&(L=Math.max(10,L),this.circleDiameter=L)}else{let J=!((M=b.image)===null||M===void 0)&&M.content&&(b.image.textFitWidth||b.image.textFitHeight)?wW(b):{x1:b.left,y1:b.top,x2:b.right,y2:b.bottom};J.y1=J.y1*h-V[0],J.y2=J.y2*h+V[2],J.x1=J.x1*h-V[3],J.x2=J.x2*h+V[1];let S=b.collisionPadding;if(S&&(J.x1-=S[0]*h,J.y1-=S[1]*h,J.x2+=S[2]*h,J.y2+=S[3]*h),N){let C=new st(J.x1,J.y1),L=new st(J.x2,J.y1),w=new st(J.x1,J.y2),_=new st(J.x2,J.y2),lt=N*Math.PI/180;C._rotate(lt),L._rotate(lt),w._rotate(lt),_._rotate(lt),J.x1=Math.min(C.x,L.x,w.x,_.x),J.x2=Math.max(C.x,L.x,w.x,_.x),J.y1=Math.min(C.y,L.y,w.y,_.y),J.y2=Math.max(C.y,L.y,w.y,_.y)}t.emplaceBack(i.x,i.y,J.x1,J.y1,J.x2,J.y2,n,d,r)}this.boxEndIndex=t.length}}class Ag{constructor(t=[],i=(n,d)=>n<d?-1:n>d?1:0){if(this.data=t,this.length=this.data.length,this.compare=i,this.length>0)for(let n=(this.length>>1)-1;n>=0;n--)this._down(n)}push(t){this.data.push(t),this._up(this.length++)}pop(){if(this.length===0)return;let t=this.data[0],i=this.data.pop();return--this.length>0&&(this.data[0]=i,this._down(0)),t}peek(){return this.data[0]}_up(t){let{data:i,compare:n}=this,d=i[t];for(;t>0;){let r=t-1>>1,b=i[r];if(n(d,b)>=0)break;i[t]=b,t=r}i[t]=d}_down(t){let{data:i,compare:n}=this,d=this.length>>1,r=i[t];for(;t<d;){let b=1+(t<<1),h=b+1;if(h<this.length&&n(i[h],i[b])<0&&(b=h),n(i[b],r)>=0)break;i[t]=i[b],t=b}i[t]=r}}function wg(l,t=1,i=!1){let n=uo.fromPoints(l[0]),d=Math.min(n.width(),n.height()),r=d/2,b=new Ag([],vg),{minX:h,minY:V,maxX:R,maxY:N}=n;if(d===0)return new st(h,V);for(let S=h;S<R;S+=d)for(let C=V;C<N;C+=d)b.push(new Tr(S+r,C+r,r,l));let M=(function(S){let C=0,L=0,w=0,_=S[0];for(let lt=0,P=_.length,tt=P-1;lt<P;tt=lt++){let pt=_[lt],Vt=_[tt],Yt=pt.x*Vt.y-Vt.x*pt.y;L+=(pt.x+Vt.x)*Yt,w+=(pt.y+Vt.y)*Yt,C+=3*Yt}return new Tr(L/C,w/C,0,S)})(l),J=b.length;for(;b.length;){let S=b.pop();(S.d>M.d||!M.d)&&(M=S,i&&console.log("found best %d after %d probes",Math.round(1e4*S.d)/1e4,J)),S.max-M.d<=t||(r=S.h/2,b.push(new Tr(S.p.x-r,S.p.y-r,r,l)),b.push(new Tr(S.p.x+r,S.p.y-r,r,l)),b.push(new Tr(S.p.x-r,S.p.y+r,r,l)),b.push(new Tr(S.p.x+r,S.p.y+r,r,l)),J+=4)}return i&&(console.log(`num probes: ${J}`),console.log(`best distance: ${M.d}`)),M.p}function vg(l,t){return t.max-l.max}function Tr(l,t,i,n){this.p=new st(l,t),this.h=i,this.d=(function(d,r){let b=!1,h=1/0;for(let V=0;V<r.length;V++){let R=r[V];for(let N=0,M=R.length,J=M-1;N<M;J=N++){let S=R[N],C=R[J];S.y>d.y!=C.y>d.y&&d.x<(C.x-S.x)*(d.y-S.y)/(C.y-S.y)+S.x&&(b=!b),h=Math.min(h,tW(d,S,C))}}return(b?1:-1)*Math.sqrt(h)})(this.p,n),this.max=this.d+this.h*Math.SQRT2}var aa;I.aO=void 0,(aa=I.aO||(I.aO={}))[aa.center=1]="center",aa[aa.left=2]="left",aa[aa.right=3]="right",aa[aa.top=4]="top",aa[aa.bottom=5]="bottom",aa[aa["top-left"]=6]="top-left",aa[aa["top-right"]=7]="top-right",aa[aa["bottom-left"]=8]="bottom-left",aa[aa["bottom-right"]=9]="bottom-right";let Dm=Number.POSITIVE_INFINITY;function zh(l,t){return t[1]!==Dm?(function(i,n,d){let r=0,b=0;switch(n=Math.abs(n),d=Math.abs(d),i){case"top-right":case"top-left":case"top":b=d-7;break;case"bottom-right":case"bottom-left":case"bottom":b=7-d}switch(i){case"top-right":case"bottom-right":case"right":r=-n;break;case"top-left":case"bottom-left":case"left":r=n}return[r,b]})(l,t[0],t[1]):(function(i,n){let d=0,r=0;n<0&&(n=0);let b=n/Math.SQRT2;switch(i){case"top-right":case"top-left":r=b-7;break;case"bottom-right":case"bottom-left":r=7-b;break;case"bottom":r=7-n;break;case"top":r=n-7}switch(i){case"top-right":case"bottom-right":d=-b;break;case"top-left":case"bottom-left":d=b;break;case"left":d=n;break;case"right":d=-n}return[d,r]})(l,t[0])}function jh(l,t,i){var n;let d=l.layout,r=(n=d.get("text-variable-anchor-offset"))===null||n===void 0?void 0:n.evaluate(t,{},i);if(r){let h=r.values,V=[];for(let R=0;R<h.length;R+=2){let N=V[R]=h[R],M=h[R+1].map((J=>J*Bl));N.startsWith("top")?M[1]-=7:N.startsWith("bottom")&&(M[1]+=7),V[R+1]=M}return new wl(V)}let b=d.get("text-variable-anchor");if(b){let h;h=l._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[d.get("text-radial-offset").evaluate(t,{},i)*Bl,Dm]:d.get("text-offset").evaluate(t,{},i).map((R=>R*Bl));let V=[];for(let R of b)V.push(R,zh(R,h));return new wl(V)}return null}function fm(l){switch(l){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Hg(l,t,i,n,d,r,b,h,V,R,N,M){let J=r.textMaxSize.evaluate(t,{});J===void 0&&(J=b);let S=l.layers[0].layout,C=S.get("icon-offset").evaluate(t,{},N),L=wh(i.horizontal),w=b/24,_=l.tilePixelRatio*w,lt=l.tilePixelRatio*J/24,P=l.tilePixelRatio*h,tt=l.tilePixelRatio*S.get("symbol-spacing"),pt=S.get("text-padding")*l.tilePixelRatio,Vt=(function(pe,Fe,re,He=1){let Si=pe.get("icon-padding").evaluate(Fe,{},re),gl=Si&&Si.values;return[gl[0]*He,gl[1]*He,gl[2]*He,gl[3]*He]})(S,t,N,l.tilePixelRatio),Yt=S.get("text-max-angle")/180*Math.PI,wt=S.get("text-rotation-alignment")!=="viewport"&&S.get("symbol-placement")!=="point",Qt=S.get("icon-rotation-alignment")==="map"&&S.get("symbol-placement")!=="point",Ht=S.get("symbol-placement"),ae=tt/2,Kt=S.get("icon-text-fit"),qt;n&&Kt!=="none"&&(l.allowVerticalPlacement&&i.vertical&&(qt=vW(n,i.vertical,Kt,S.get("icon-text-fit-padding"),C,w)),L&&(n=vW(n,L,Kt,S.get("icon-text-fit-padding"),C,w)));let Lt=N?M.line.getGranularityForZoomLevel(N.z):1,Ze=(pe,Fe)=>{Fe.x<0||Fe.x>=Le||Fe.y<0||Fe.y>=Le||(function(re,He,Si,gl,na,Jn,ya,Dl,da,nl,fl,ua,Ra,ja,ca,Aa,yn,kl,Ai,ul,Ki,Ql,$d,rd,fs){let xc=re.addToLineVertexArray(He,Si),Ro,Xr,Jr,yr,fh=0,Oh=0,_h=0,Ph=0,e1=-1,i1=-1,tc={},Kh=ld("");if(re.allowVerticalPlacement&&gl.vertical){let Fa=Dl.layout.get("text-rotate").evaluate(Ki,{},rd)+90;Jr=new hb(da,He,nl,fl,ua,gl.vertical,Ra,ja,ca,Fa),ya&&(yr=new hb(da,He,nl,fl,ua,ya,yn,kl,ca,Fa))}if(na){let Fa=Dl.layout.get("icon-rotate").evaluate(Ki,{}),Vn=Dl.layout.get("icon-text-fit")!=="none",Fo=Lh(na,Fa,$d,Vn),bd=ya?Lh(ya,Fa,$d,Vn):void 0;Xr=new hb(da,He,nl,fl,ua,na,yn,kl,!1,Fa),fh=4*Fo.length;let Go=re.iconSizeData,Xd=null;Go.kind==="source"?(Xd=[Kd*Dl.layout.get("icon-size").evaluate(Ki,{})],Xd[0]>Ic&&ci(`${re.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):Go.kind==="composite"&&(Xd=[Kd*Ql.compositeIconSizes[0].evaluate(Ki,{},rd),Kd*Ql.compositeIconSizes[1].evaluate(Ki,{},rd)],(Xd[0]>Ic||Xd[1]>Ic)&&ci(`${re.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),re.addSymbols(re.icon,Fo,Xd,ul,Ai,Ki,I.ay.none,He,xc.lineStartIndex,xc.lineLength,-1,rd),e1=re.icon.placedSymbolArray.length-1,bd&&(Oh=4*bd.length,re.addSymbols(re.icon,bd,Xd,ul,Ai,Ki,I.ay.vertical,He,xc.lineStartIndex,xc.lineLength,-1,rd),i1=re.icon.placedSymbolArray.length-1)}let qh=Object.keys(gl.horizontal);for(let Fa of qh){let Vn=gl.horizontal[Fa];if(!Ro){Kh=ld(Vn.text);let bd=Dl.layout.get("text-rotate").evaluate(Ki,{},rd);Ro=new hb(da,He,nl,fl,ua,Vn,Ra,ja,ca,bd)}let Fo=Vn.positionedLines.length===1;if(_h+=Ah(re,He,Vn,Jn,Dl,ca,Ki,Aa,xc,gl.vertical?I.ay.horizontal:I.ay.horizontalOnly,Fo?qh:[Fa],tc,e1,Ql,rd),Fo)break}gl.vertical&&(Ph+=Ah(re,He,gl.vertical,Jn,Dl,ca,Ki,Aa,xc,I.ay.vertical,["vertical"],tc,i1,Ql,rd));let Og=Ro?Ro.boxStartIndex:re.collisionBoxArray.length,_g=Ro?Ro.boxEndIndex:re.collisionBoxArray.length,Pg=Jr?Jr.boxStartIndex:re.collisionBoxArray.length,Kg=Jr?Jr.boxEndIndex:re.collisionBoxArray.length,qg=Xr?Xr.boxStartIndex:re.collisionBoxArray.length,$g=Xr?Xr.boxEndIndex:re.collisionBoxArray.length,tu=yr?yr.boxStartIndex:re.collisionBoxArray.length,eu=yr?yr.boxEndIndex:re.collisionBoxArray.length,sd=-1,pb=(Fa,Vn)=>Fa&&Fa.circleDiameter?Math.max(Fa.circleDiameter,Vn):Vn;sd=pb(Ro,sd),sd=pb(Jr,sd),sd=pb(Xr,sd),sd=pb(yr,sd);let $h=sd>-1?1:0;$h&&(sd*=fs/Bl),re.glyphOffsetArray.length>=Gr.MAX_GLYPHS&&ci("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Ki.sortKey!==void 0&&re.addToSortKeyRanges(re.symbolInstances.length,Ki.sortKey);let iu=jh(Dl,Ki,rd),[lu,au]=(function(Fa,Vn){let Fo=Fa.length,bd=Vn?.values;if(bd?.length>0)for(let Go=0;Go<bd.length;Go+=2){let Xd=bd[Go+1];Fa.emplaceBack(I.aO[bd[Go]],Xd[0],Xd[1])}return[Fo,Fa.length]})(re.textAnchorOffsets,iu);re.symbolInstances.emplaceBack(He.x,He.y,tc.right>=0?tc.right:-1,tc.center>=0?tc.center:-1,tc.left>=0?tc.left:-1,tc.vertical||-1,e1,i1,Kh,Og,_g,Pg,Kg,qg,$g,tu,eu,nl,_h,Ph,fh,Oh,$h,0,Ra,sd,lu,au)})(l,Fe,pe,i,n,d,qt,l.layers[0],l.collisionBoxArray,t.index,t.sourceLayerIndex,l.index,_,[pt,pt,pt,pt],wt,V,P,Vt,Qt,C,t,r,R,N,b)};if(Ht==="line")for(let pe of Xh(t.geometry,0,0,Le,Le)){let Fe=Zo(pe,Lt),re=jg(Fe,tt,Yt,i.vertical||L,n,24,lt,l.overscaling,Le);for(let He of re)L&&Dg(l,L.text,ae,He)||Ze(Fe,He)}else if(Ht==="line-center"){for(let pe of t.geometry)if(pe.length>1){let Fe=Zo(pe,Lt),re=zg(Fe,Yt,i.vertical||L,n,24,lt);re&&Ze(Fe,re)}}else if(t.type==="Polygon")for(let pe of xa(t.geometry,0)){let Fe=wg(pe,16);Ze(Zo(pe[0],Lt,!0),new Yc(Fe.x,Fe.y,0))}else if(t.type==="LineString")for(let pe of t.geometry){let Fe=Zo(pe,Lt);Ze(Fe,new Yc(Fe[0].x,Fe[0].y,0))}else if(t.type==="Point")for(let pe of t.geometry)for(let Fe of pe)Ze([Fe],new Yc(Fe.x,Fe.y,0))}function Ah(l,t,i,n,d,r,b,h,V,R,N,M,J,S,C){let L=(function(lt,P,tt,pt,Vt,Yt,wt,Qt){let Ht=pt.layout.get("text-rotate").evaluate(Yt,{})*Math.PI/180,ae=[];for(let Kt of P.positionedLines)for(let qt of Kt.positionedGlyphs){if(!qt.rect)continue;let Lt=qt.rect||{},Ze=4,pe=!0,Fe=1,re=0,He=(Vt||Qt)&&qt.vertical,Si=qt.metrics.advance*qt.scale/2;if(Qt&&P.verticalizable&&(re=Kt.lineOffset/2-(qt.imageName?-(Bl-qt.metrics.width*qt.scale)/2:(qt.scale-1)*Bl)),qt.imageName){let kl=wt[qt.imageName];pe=kl.sdf,Fe=kl.pixelRatio,Ze=1/Fe}let gl=Vt?[qt.x+Si,qt.y]:[0,0],na=Vt?[0,0]:[qt.x+Si+tt[0],qt.y+tt[1]-re],Jn=[0,0];He&&(Jn=na,na=[0,0]);let ya=qt.metrics.isDoubleResolution?2:1,Dl=(qt.metrics.left-Ze)*qt.scale-Si+na[0],da=(-qt.metrics.top-Ze)*qt.scale+na[1],nl=Dl+Lt.w/ya*qt.scale/Fe,fl=da+Lt.h/ya*qt.scale/Fe,ua=new st(Dl,da),Ra=new st(nl,da),ja=new st(Dl,fl),ca=new st(nl,fl);if(He){let kl=new st(-Si,Si- -17),Ai=-Math.PI/2,ul=12-Si,Ki=new st(22-ul,-(qt.imageName?ul:0)),Ql=new st(...Jn);ua._rotateAround(Ai,kl)._add(Ki)._add(Ql),Ra._rotateAround(Ai,kl)._add(Ki)._add(Ql),ja._rotateAround(Ai,kl)._add(Ki)._add(Ql),ca._rotateAround(Ai,kl)._add(Ki)._add(Ql)}if(Ht){let kl=Math.sin(Ht),Ai=Math.cos(Ht),ul=[Ai,-kl,kl,Ai];ua._matMult(ul),Ra._matMult(ul),ja._matMult(ul),ca._matMult(ul)}let Aa=new st(0,0),yn=new st(0,0);ae.push({tl:ua,tr:Ra,bl:ja,br:ca,tex:Lt,writingMode:P.writingMode,glyphOffset:gl,sectionIndex:qt.sectionIndex,isSDF:pe,pixelOffsetTL:Aa,pixelOffsetBR:yn,minFontScaleX:0,minFontScaleY:0})}return ae})(0,i,h,d,r,b,n,l.allowVerticalPlacement),w=l.textSizeData,_=null;w.kind==="source"?(_=[Kd*d.layout.get("text-size").evaluate(b,{})],_[0]>Ic&&ci(`${l.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):w.kind==="composite"&&(_=[Kd*S.compositeTextSizes[0].evaluate(b,{},C),Kd*S.compositeTextSizes[1].evaluate(b,{},C)],(_[0]>Ic||_[1]>Ic)&&ci(`${l.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),l.addSymbols(l.text,L,_,h,r,b,R,t,V.lineStartIndex,V.lineLength,J,C);for(let lt of N)M[lt]=l.text.placedSymbolArray.length-1;return 4*L.length}function wh(l){for(let t in l)return l[t];return null}function Dg(l,t,i,n){let d=l.compareText;if(t in d){let r=d[t];for(let b=r.length-1;b>=0;b--)if(n.dist(r[b])<i)return!0}else d[t]=[];return d[t].push(n),!1}let vh=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Om{static from(t){if(!(t instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");let[i,n]=new Uint8Array(t,0,2);if(i!==219)throw new Error("Data does not appear to be in a KDBush format.");let d=n>>4;if(d!==1)throw new Error(`Got v${d} data when expected v1.`);let r=vh[15&n];if(!r)throw new Error("Unrecognized array type.");let[b]=new Uint16Array(t,2,1),[h]=new Uint32Array(t,4,1);return new Om(h,b,r,t)}constructor(t,i=64,n=Float64Array,d){if(isNaN(t)||t<0)throw new Error(`Unpexpected numItems value: ${t}.`);this.numItems=+t,this.nodeSize=Math.min(Math.max(+i,2),65535),this.ArrayType=n,this.IndexArrayType=t<65536?Uint16Array:Uint32Array;let r=vh.indexOf(this.ArrayType),b=2*t*this.ArrayType.BYTES_PER_ELEMENT,h=t*this.IndexArrayType.BYTES_PER_ELEMENT,V=(8-h%8)%8;if(r<0)throw new Error(`Unexpected typed array class: ${n}.`);d&&d instanceof ArrayBuffer?(this.data=d,this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+h+V,2*t),this._pos=2*t,this._finished=!0):(this.data=new ArrayBuffer(8+b+h+V),this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+h+V,2*t),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+r]),new Uint16Array(this.data,2,1)[0]=i,new Uint32Array(this.data,4,1)[0]=t)}add(t,i){let n=this._pos>>1;return this.ids[n]=n,this.coords[this._pos++]=t,this.coords[this._pos++]=i,n}finish(){let t=this._pos>>1;if(t!==this.numItems)throw new Error(`Added ${t} items when expected ${this.numItems}.`);return _m(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(t,i,n,d){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");let{ids:r,coords:b,nodeSize:h}=this,V=[0,r.length-1,0],R=[];for(;V.length;){let N=V.pop()||0,M=V.pop()||0,J=V.pop()||0;if(M-J<=h){for(let w=J;w<=M;w++){let _=b[2*w],lt=b[2*w+1];_>=t&&_<=n&&lt>=i&&lt<=d&&R.push(r[w])}continue}let S=J+M>>1,C=b[2*S],L=b[2*S+1];C>=t&&C<=n&&L>=i&&L<=d&&R.push(r[S]),(N===0?t<=C:i<=L)&&(V.push(J),V.push(S-1),V.push(1-N)),(N===0?n>=C:d>=L)&&(V.push(S+1),V.push(M),V.push(1-N))}return R}within(t,i,n){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");let{ids:d,coords:r,nodeSize:b}=this,h=[0,d.length-1,0],V=[],R=n*n;for(;h.length;){let N=h.pop()||0,M=h.pop()||0,J=h.pop()||0;if(M-J<=b){for(let w=J;w<=M;w++)Dh(r[2*w],r[2*w+1],t,i)<=R&&V.push(d[w]);continue}let S=J+M>>1,C=r[2*S],L=r[2*S+1];Dh(C,L,t,i)<=R&&V.push(d[S]),(N===0?t-n<=C:i-n<=L)&&(h.push(J),h.push(S-1),h.push(1-N)),(N===0?t+n>=C:i+n>=L)&&(h.push(S+1),h.push(M),h.push(1-N))}return V}}function _m(l,t,i,n,d,r){if(d-n<=i)return;let b=n+d>>1;Hh(l,t,b,n,d,r),_m(l,t,i,n,b-1,1-r),_m(l,t,i,b+1,d,1-r)}function Hh(l,t,i,n,d,r){for(;d>n;){if(d-n>600){let R=d-n+1,N=i-n+1,M=Math.log(R),J=.5*Math.exp(2*M/3),S=.5*Math.sqrt(M*J*(R-J)/R)*(N-R/2<0?-1:1);Hh(l,t,i,Math.max(n,Math.floor(i-N*J/R+S)),Math.min(d,Math.floor(i+(R-N)*J/R+S)),r)}let b=t[2*i+r],h=n,V=d;for(Hs(l,t,n,i),t[2*d+r]>b&&Hs(l,t,n,d);h<V;){for(Hs(l,t,h,V),h++,V--;t[2*h+r]<b;)h++;for(;t[2*V+r]>b;)V--}t[2*n+r]===b?Hs(l,t,n,V):(V++,Hs(l,t,V,d)),V<=i&&(n=V+1),i<=V&&(d=V-1)}}function Hs(l,t,i,n){Pm(l,i,n),Pm(t,2*i,2*n),Pm(t,2*i+1,2*n+1)}function Pm(l,t,i){let n=l[t];l[t]=l[i],l[i]=n}function Dh(l,t,i,n){let d=l-i,r=t-n;return d*d+r*r}var Km;I.cG=void 0,(Km=I.cG||(I.cG={})).create="create",Km.load="load",Km.fullLoad="fullLoad";let Zb=null,Ds=[],qm=1e3/60,$m="loadTime",t1="fullLoadTime",fg={mark(l){performance.mark(l)},frame(l){let t=l;Zb!=null&&Ds.push(t-Zb),Zb=t},clearMetrics(){Zb=null,Ds=[],performance.clearMeasures($m),performance.clearMeasures(t1);for(let l in I.cG)performance.clearMarks(I.cG[l])},getPerformanceMetrics(){performance.measure($m,I.cG.create,I.cG.load),performance.measure(t1,I.cG.create,I.cG.fullLoad);let l=performance.getEntriesByName($m)[0].duration,t=performance.getEntriesByName(t1)[0].duration,i=Ds.length,n=1/(Ds.reduce(((r,b)=>r+b),0)/i/1e3),d=Ds.filter((r=>r>qm)).reduce(((r,b)=>r+(b-qm)/qm),0);return{loadTime:l,fullLoadTime:t,fps:n,percentDroppedFrames:d/(i+d)*100,totalFrames:i}}};I.$=Ie,I.A=Ue,I.B=dr,I.C=wd,I.D=me,I.E=Nt,I.F=function([l,t,i]){return t+=90,t*=Math.PI/180,i*=Math.PI/180,{x:l*Math.cos(t)*Math.sin(i),y:l*Math.sin(t)*Math.sin(i),z:l*Math.cos(i)}},I.G=Gt,I.H=Vi,I.I=Im,I.J=$b,I.K=function(l){if(si==null){let t=l.navigator?l.navigator.userAgent:null;si=!!l.safari||!(!t||!(/\b(iPad|iPhone|iPod)\b/.test(t)||t.match("Safari")&&!t.match("Chrome")))}return si},I.L=class{constructor(l,t){this.target=l,this.mapId=t,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new Zg((()=>this.process())),this.subscription=Qi(this.target,"message",(i=>this.receive(i)),!1),this.globalScope=Na(self)?l:window}registerMessageHandler(l,t){this.messageHandlers[l]=t}unregisterMessageHandler(l){delete this.messageHandlers[l]}sendAsync(l,t){return new Promise(((i,n)=>{let d=Math.round(1e18*Math.random()).toString(36).substring(0,10),r=t?Qi(t.signal,"abort",(()=>{r?.unsubscribe(),delete this.resolveRejects[d];let V={id:d,type:"<cancel>",origin:location.origin,targetMapId:l.targetMapId,sourceMapId:this.mapId};this.target.postMessage(V)}),pg):null;this.resolveRejects[d]={resolve:V=>{r?.unsubscribe(),i(V)},reject:V=>{r?.unsubscribe(),n(V)}};let b=[],h=Object.assign(Object.assign({},l),{id:d,sourceMapId:this.mapId,origin:location.origin,data:io(l.data,b)});this.target.postMessage(h,{transfer:b})}))}receive(l){let t=l.data,i=t.id;if(!(t.origin!=="file://"&&location.origin!=="file://"&&t.origin!=="resource://android"&&location.origin!=="resource://android"&&t.origin!==location.origin||t.targetMapId&&this.mapId!==t.targetMapId)){if(t.type==="<cancel>"){delete this.tasks[i];let n=this.abortControllers[i];return delete this.abortControllers[i],void(n&&n.abort())}if(Na(self)||t.mustQueue)return this.tasks[i]=t,this.taskQueue.push(i),void this.invoker.trigger();this.processTask(i,t)}}process(){if(this.taskQueue.length===0)return;let l=this.taskQueue.shift(),t=this.tasks[l];delete this.tasks[l],this.taskQueue.length>0&&this.invoker.trigger(),t&&this.processTask(l,t)}processTask(l,t){return o(this,void 0,void 0,(function*(){if(t.type==="<response>"){let d=this.resolveRejects[l];return delete this.resolveRejects[l],d?void(t.error?d.reject(ed(t.error)):d.resolve(ed(t.data))):void 0}if(!this.messageHandlers[t.type])return void this.completeTask(l,new Error(`Could not find a registered handler for ${t.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));let i=ed(t.data),n=new AbortController;this.abortControllers[l]=n;try{let d=yield this.messageHandlers[t.type](t.sourceMapId,i,n);this.completeTask(l,null,d)}catch(d){this.completeTask(l,d)}}))}completeTask(l,t,i){let n=[];delete this.abortControllers[l];let d={id:l,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:t?io(t):null,data:io(i,n)};this.target.postMessage(d,{transfer:n})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},I.M=Fn,I.N=function(){var l=new Ue(16);return Ue!=Float32Array&&(l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[11]=0,l[12]=0,l[13]=0,l[14]=0),l[0]=1,l[5]=1,l[10]=1,l[15]=1,l},I.O=function(l,t,i){var n,d,r,b,h,V,R,N,M,J,S,C,L=i[0],w=i[1],_=i[2];return t===l?(l[12]=t[0]*L+t[4]*w+t[8]*_+t[12],l[13]=t[1]*L+t[5]*w+t[9]*_+t[13],l[14]=t[2]*L+t[6]*w+t[10]*_+t[14],l[15]=t[3]*L+t[7]*w+t[11]*_+t[15]):(d=t[1],r=t[2],b=t[3],h=t[4],V=t[5],R=t[6],N=t[7],M=t[8],J=t[9],S=t[10],C=t[11],l[0]=n=t[0],l[1]=d,l[2]=r,l[3]=b,l[4]=h,l[5]=V,l[6]=R,l[7]=N,l[8]=M,l[9]=J,l[10]=S,l[11]=C,l[12]=n*L+h*w+M*_+t[12],l[13]=d*L+V*w+J*_+t[13],l[14]=r*L+R*w+S*_+t[14],l[15]=b*L+N*w+C*_+t[15]),l},I.P=st,I.Q=function(l,t,i){var n=i[0],d=i[1],r=i[2];return l[0]=t[0]*n,l[1]=t[1]*n,l[2]=t[2]*n,l[3]=t[3]*n,l[4]=t[4]*d,l[5]=t[5]*d,l[6]=t[6]*d,l[7]=t[7]*d,l[8]=t[8]*r,l[9]=t[9]*r,l[10]=t[10]*r,l[11]=t[11]*r,l[12]=t[12],l[13]=t[13],l[14]=t[14],l[15]=t[15],l},I.R=za,I.S=function(l,t,i){var n=t[0],d=t[1],r=t[2],b=t[3],h=t[4],V=t[5],R=t[6],N=t[7],M=t[8],J=t[9],S=t[10],C=t[11],L=t[12],w=t[13],_=t[14],lt=t[15],P=i[0],tt=i[1],pt=i[2],Vt=i[3];return l[0]=P*n+tt*h+pt*M+Vt*L,l[1]=P*d+tt*V+pt*J+Vt*w,l[2]=P*r+tt*R+pt*S+Vt*_,l[3]=P*b+tt*N+pt*C+Vt*lt,l[4]=(P=i[4])*n+(tt=i[5])*h+(pt=i[6])*M+(Vt=i[7])*L,l[5]=P*d+tt*V+pt*J+Vt*w,l[6]=P*r+tt*R+pt*S+Vt*_,l[7]=P*b+tt*N+pt*C+Vt*lt,l[8]=(P=i[8])*n+(tt=i[9])*h+(pt=i[10])*M+(Vt=i[11])*L,l[9]=P*d+tt*V+pt*J+Vt*w,l[10]=P*r+tt*R+pt*S+Vt*_,l[11]=P*b+tt*N+pt*C+Vt*lt,l[12]=(P=i[12])*n+(tt=i[13])*h+(pt=i[14])*M+(Vt=i[15])*L,l[13]=P*d+tt*V+pt*J+Vt*w,l[14]=P*r+tt*R+pt*S+Vt*_,l[15]=P*b+tt*N+pt*C+Vt*lt,l},I.T=hm,I.U=function(l,t){let i={};for(let n=0;n<t.length;n++){let d=t[n];d in l&&(i[d]=l[d])}return i},I.V=Uc,I.W=qi,I.X=$W,I.Y=qW,I.Z=gt,I._=o,I.a=Ca,I.a$=ii,I.a0=Rn,I.a1=Zn,I.a2=eh,I.a3=eb,I.a4=Le,I.a5=function(l,t,i){if(!l)return t||{};if(!t)return l||{};let n=nh(l),d=nh(t);(function(b,h){h.removeAll&&(b.add.clear(),b.update.clear(),b.remove.clear(),h.remove.clear());for(let V of h.remove)b.add.delete(V),b.update.delete(V);for(let[V,R]of h.update){let N=b.update.get(V);N&&(h.update.set(V,Vg(N,R)),b.update.delete(V))}})(n,d);let r={};if((n.removeAll||d.removeAll)&&(r.removeAll=!0),r.remove=new Set([...n.remove,...d.remove]),r.add=new Map([...n.add,...d.add]),r.update=new Map([...n.update,...d.update]),r.remove.size&&r.add.size)for(let b of r.add.keys())r.remove.delete(b);return(function(b){let h={};return b.removeAll&&(h.removeAll=b.removeAll),b.remove&&(h.remove=Array.from(b.remove)),b.add&&(h.add=Array.from(b.add.values())),b.update&&(h.update=Array.from(b.update.values())),h})(r)},I.a6=function(l,t){if(l==null)return!0;if(l.type==="Feature")return Ls(l,t)!=null;if(l.type==="FeatureCollection"){let i=new Set;for(let n of l.features){let d=Ls(n,t);if(d==null||i.has(d))return!1;i.add(d)}return!0}return!1},I.a7=function(l,t){let i=new Map;if(l!=null)if(l.type==="Feature")i.set(Ls(l,t),l);else for(let n of l.features)i.set(Ls(n,t),n);return i},I.a8=function(l,t,i){var n,d;if(t.removeAll)l.clear();else if(t.remove)for(let r of t.remove)l.delete(r);if(t.add)for(let r of t.add){let b=Ls(r,i);b!=null&&l.set(b,r)}if(t.update)for(let r of t.update){let b=l.get(r.id);if(!b)continue;let h=!!r.newGeometry,V=r.removeAllProperties||((n=r.removeProperties)===null||n===void 0?void 0:n.length)>0||((d=r.addOrUpdateProperties)===null||d===void 0?void 0:d.length)>0;if((h||V)&&(b=Object.assign({},b),l.set(r.id,b),h&&(b.geometry=r.newGeometry),V)){if(b.properties=r.removeAllProperties?{}:Object.assign({},b.properties||{}),r.removeProperties)for(let R of r.removeProperties)delete b.properties[R];if(r.addOrUpdateProperties)for(let{key:R,value:N}of r.addOrUpdateProperties)b.properties[R]=N}}},I.a9=Hm,I.aA=function(l,t){var i=t[0],n=t[1],d=t[2],r=t[3],b=t[4],h=t[5],V=t[6],R=t[7],N=t[8],M=t[9],J=t[10],S=t[11],C=t[12],L=t[13],w=t[14],_=t[15],lt=i*h-n*b,P=i*V-d*b,tt=i*R-r*b,pt=n*V-d*h,Vt=n*R-r*h,Yt=d*R-r*V,wt=N*L-M*C,Qt=N*w-J*C,Ht=N*_-S*C,ae=M*w-J*L,Kt=M*_-S*L,qt=J*_-S*w,Lt=lt*qt-P*Kt+tt*ae+pt*Ht-Vt*Qt+Yt*wt;return Lt?(l[0]=(h*qt-V*Kt+R*ae)*(Lt=1/Lt),l[1]=(d*Kt-n*qt-r*ae)*Lt,l[2]=(L*Yt-w*Vt+_*pt)*Lt,l[3]=(J*Vt-M*Yt-S*pt)*Lt,l[4]=(V*Ht-b*qt-R*Qt)*Lt,l[5]=(i*qt-d*Ht+r*Qt)*Lt,l[6]=(w*tt-C*Yt-_*P)*Lt,l[7]=(N*Yt-J*tt+S*P)*Lt,l[8]=(b*Kt-h*Ht+R*wt)*Lt,l[9]=(n*Ht-i*Kt-r*wt)*Lt,l[10]=(C*Vt-L*tt+_*lt)*Lt,l[11]=(M*tt-N*Vt-S*lt)*Lt,l[12]=(h*Qt-b*ae-V*wt)*Lt,l[13]=(i*ae-n*Qt+d*wt)*Lt,l[14]=(L*P-C*pt-w*lt)*Lt,l[15]=(N*pt-M*P+J*lt)*Lt,l):null},I.aB=cl,I.aC=function(l){var t=l[0],i=l[1];return Math.sqrt(t*t+i*i)},I.aD=function(l){return l[0]=0,l[1]=0,l},I.aE=function(l,t,i){return l[0]=t[0]*i,l[1]=t[1]*i,l},I.aF=Ym,I.aG=Qe,I.aH=function(l,t,i,n){let d=t.y-l.y,r=t.x-l.x,b=n.y-i.y,h=n.x-i.x,V=b*r-h*d;if(V===0)return null;let R=(h*(l.y-i.y)-b*(l.x-i.x))/V;return new st(l.x+R*r,l.y+R*d)},I.aI=Xh,I.aJ=q1,I.aK=function(l){let t=1/0,i=1/0,n=-1/0,d=-1/0;for(let r of l)t=Math.min(t,r.x),i=Math.min(i,r.y),n=Math.max(n,r.x),d=Math.max(d,r.y);return[t,i,n,d]},I.aL=Bl,I.aM=Yl,I.aN=function(l,t,i,n,d=!1){if(!i[0]&&!i[1])return[0,0];let r=d?n==="map"?-l.bearingInRadians:0:n==="viewport"?l.bearingInRadians:0;if(r){let b=Math.sin(r),h=Math.cos(r);i=[i[0]*h-i[1]*b,i[0]*b+i[1]*h]}return[d?i[0]:Yl(t,i[0],l.zoom),d?i[1]:Yl(t,i[1],l.zoom)]},I.aP=Mm,I.aQ=fm,I.aR=Um,I.aS=Om,I.aT=ll,I.aU=P0,I.aV=et,I.aW=Je,I.aX=Pt,I.aY=vi,I.aZ=ih,I.a_=Me,I.aa=Qs,I.ab=uo,I.ac=25,I.ad=ym,I.ae=l=>{let t=window.document.createElement("video");return t.muted=!0,new Promise((i=>{t.onloadstart=()=>{i(t)};for(let n of l){let d=window.document.createElement("source");z(n)||(t.crossOrigin="Anonymous"),d.src=n,t.appendChild(d)}}))},I.af=ft,I.ag=function(){return Sa++},I.ah=Z,I.ai=Gr,I.aj=Oc,I.ak=dd,I.al=ch,I.am=function(l){let t={};if(l.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,((i,n,d,r)=>{let b=d||r;return t[n]=!b||b.toLowerCase(),""})),t["max-age"]){let i=parseInt(t["max-age"],10);isNaN(i)?delete t["max-age"]:t["max-age"]=i}return t},I.an=Ci,I.ao=85.051129,I.ap=ql,I.aq=function(l){return Math.pow(2,l)},I.ar=li,I.as=th,I.at=function(l){return Math.log(l)/Math.LN2},I.au=function(l){var t=l[0],i=l[1];return t*t+i*i},I.av=class{constructor(l,t){this.max=l,this.onRemove=t,this.reset()}reset(){for(let l in this.data)for(let t of this.data[l])t.timeout&&clearTimeout(t.timeout),this.onRemove(t.value);return this.data={},this.order=[],this}add(l,t,i){let n=l.wrapped().key;this.data[n]===void 0&&(this.data[n]=[]);let d={value:t,timeout:void 0};if(i!==void 0&&(d.timeout=setTimeout((()=>{this.remove(l,d)}),i)),this.data[n].push(d),this.order.push(n),this.order.length>this.max){let r=this._getAndRemoveByKey(this.order[0]);r&&this.onRemove(r)}return this}has(l){return l.wrapped().key in this.data}getAndRemove(l){return this.has(l)?this._getAndRemoveByKey(l.wrapped().key):null}_getAndRemoveByKey(l){let t=this.data[l].shift();return t.timeout&&clearTimeout(t.timeout),this.data[l].length===0&&delete this.data[l],this.order.splice(this.order.indexOf(l),1),t.value}getByKey(l){let t=this.data[l];return t?t[0].value:null}get(l){return this.has(l)?this.data[l.wrapped().key][0].value:null}remove(l,t){if(!this.has(l))return this;let i=l.wrapped().key,n=t===void 0?0:this.data[i].indexOf(t),d=this.data[i][n];return this.data[i].splice(n,1),d.timeout&&clearTimeout(d.timeout),this.data[i].length===0&&delete this.data[i],this.onRemove(d.value),this.order.splice(this.order.indexOf(i),1),this}setMaxSize(l){for(this.max=l;this.order.length>this.max;){let t=this._getAndRemoveByKey(this.order[0]);t&&this.onRemove(t)}return this}filter(l){let t=[];for(let i in this.data)for(let n of this.data[i])l(n.value)||t.push(n);for(let i of t)this.remove(i.value.tileID,i)}},I.aw=function(l){if(!l.length)return new Set;let t=Math.max(...l.map((V=>V.canonical.z))),i=1/0,n=-1/0,d=1/0,r=-1/0,b=[];for(let V of l){let{x:R,y:N,z:M}=V.canonical,J=Math.pow(2,t-M),S=R*J,C=N*J;b.push({id:V,x:S,y:C}),S<i&&(i=S),S>n&&(n=S),C<d&&(d=C),C>r&&(r=C)}let h=new Set;for(let V of b)V.x!==i&&V.x!==n&&V.y!==d&&V.y!==r||h.add(V.id);return h},I.ax=function(l,t){let i=0,n=0;if(l.kind==="constant")n=l.layoutSize;else if(l.kind!=="source"){let{interpolationType:d,minZoom:r,maxZoom:b}=l,h=d?Ci(bt.interpolationFactor(d,t,r,b),0,1):0;l.kind==="camera"?n=Gt.number(l.minSize,l.maxSize,h):i=h}return{uSizeT:i,uSize:n}},I.az=function(l,{uSize:t,uSizeT:i},{lowerSize:n,upperSize:d}){return l.kind==="source"?n/Kd:l.kind==="composite"?Gt.number(n/Kd,d/Kd,i):t},I.b=Tl,I.b$=class extends ln{constructor(l,t){super(l,t),this.current=Od}set(l){if(l[12]!==this.current[12]||l[0]!==this.current[0])return this.current=l,void this.gl.uniformMatrix4fv(this.location,!1,l);for(let t=1;t<16;t++)if(l[t]!==this.current[t]){this.current=l,this.gl.uniformMatrix4fv(this.location,!1,l);break}}},I.b0=function(l){var t=new Ue(3);return t[0]=l[0],t[1]=l[1],t[2]=l[2],t},I.b1=function(l,t,i){return l[0]=t[0]-i[0],l[1]=t[1]-i[1],l[2]=t[2]-i[2],l},I.b2=function(l,t){var i=t[0],n=t[1],d=t[2],r=i*i+n*n+d*d;return r>0&&(r=1/Math.sqrt(r)),l[0]=t[0]*r,l[1]=t[1]*r,l[2]=t[2]*r,l},I.b3=ui,I.b4=function(l,t){return l[0]*t[0]+l[1]*t[1]+l[2]*t[2]},I.b5=function(l,t,i){return l[0]=t[0]*i[0],l[1]=t[1]*i[1],l[2]=t[2]*i[2],l[3]=t[3]*i[3],l},I.b6=je,I.b7=function(l,t,i){let n=t[0]*i[0]+t[1]*i[1]+t[2]*i[2];return n===0?null:(-(l[0]*i[0]+l[1]*i[1]+l[2]*i[2])-i[3])/n},I.b8=xi,I.b9=function(l,t,i){return l[0]=t[0]*i,l[1]=t[1]*i,l[2]=t[2]*i,l[3]=t[3]*i,l},I.bA=sa,I.bB=function(l,t,i){var n=i[0],d=i[1],r=i[2],b=i[3],h=t[0],V=t[1],R=t[2],N=d*R-r*V,M=r*h-n*R,J=n*V-d*h;return l[0]=h+b*(N+=N)+d*(J+=J)-r*(M+=M),l[1]=V+b*M+r*N-n*J,l[2]=R+b*J+n*M-d*N,l},I.bC=function(l,t,i){let n=(d=[l[0],l[1],l[2],t[0],t[1],t[2],i[0],i[1],i[2]])[0]*((N=d[8])*(b=d[4])-(h=d[5])*(R=d[7]))+d[1]*(-N*(r=d[3])+h*(V=d[6]))+d[2]*(R*r-b*V);var d,r,b,h,V,R,N;if(n===0)return null;let M=ui([],[t[0],t[1],t[2]],[i[0],i[1],i[2]]),J=ui([],[i[0],i[1],i[2]],[l[0],l[1],l[2]]),S=ui([],[l[0],l[1],l[2]],[t[0],t[1],t[2]]),C=Me([],M,-l[3]);return ii(C,C,Me([],J,-t[3])),ii(C,C,Me([],S,-i[3])),Me(C,C,1/n),C},I.bD=Jm,I.bE=function(){return new Float64Array(4)},I.bF=function(l,t,i,n){var d=[],r=[];return d[0]=t[0]-i[0],d[1]=t[1]-i[1],d[2]=t[2]-i[2],r[0]=d[0]*Math.cos(n)-d[1]*Math.sin(n),r[1]=d[0]*Math.sin(n)+d[1]*Math.cos(n),r[2]=d[2],l[0]=r[0]+i[0],l[1]=r[1]+i[1],l[2]=r[2]+i[2],l},I.bG=function(l,t,i,n){var d=[],r=[];return d[0]=t[0]-i[0],d[1]=t[1]-i[1],d[2]=t[2]-i[2],r[0]=d[0],r[1]=d[1]*Math.cos(n)-d[2]*Math.sin(n),r[2]=d[1]*Math.sin(n)+d[2]*Math.cos(n),l[0]=r[0]+i[0],l[1]=r[1]+i[1],l[2]=r[2]+i[2],l},I.bH=function(l,t,i,n){var d=[],r=[];return d[0]=t[0]-i[0],d[1]=t[1]-i[1],d[2]=t[2]-i[2],r[0]=d[2]*Math.sin(n)+d[0]*Math.cos(n),r[1]=d[1],r[2]=d[2]*Math.cos(n)-d[0]*Math.sin(n),l[0]=r[0]+i[0],l[1]=r[1]+i[1],l[2]=r[2]+i[2],l},I.bI=function(l,t,i){var n=Math.sin(i),d=Math.cos(i),r=t[0],b=t[1],h=t[2],V=t[3],R=t[8],N=t[9],M=t[10],J=t[11];return t!==l&&(l[4]=t[4],l[5]=t[5],l[6]=t[6],l[7]=t[7],l[12]=t[12],l[13]=t[13],l[14]=t[14],l[15]=t[15]),l[0]=r*d-R*n,l[1]=b*d-N*n,l[2]=h*d-M*n,l[3]=V*d-J*n,l[8]=r*n+R*d,l[9]=b*n+N*d,l[10]=h*n+M*d,l[11]=V*n+J*d,l},I.bJ=function(l,t){let i=ol(l,360),n=ol(t,360),d=n-i,r=n>i?d-360:d+360;return Math.abs(d)<Math.abs(r)?d:r},I.bK=function(l){return l[0]=0,l[1]=0,l[2]=0,l},I.bL=function(l,t,i,n){let d=Math.sqrt(l*l+t*t),r=Math.sqrt(i*i+n*n);l/=d,t/=d,i/=r,n/=r;let b=Math.acos(l*i+t*n);return-t*i+l*n>0?b:-b},I.bM=function(l,t){let i=ol(l,2*Math.PI),n=ol(t,2*Math.PI);return Math.min(Math.abs(i-n),Math.abs(i-n+2*Math.PI),Math.abs(i-n-2*Math.PI))},I.bN=function(){let l={},t=K.$version;for(let i in K.$root){let n=K.$root[i];if(n.required){let d=null;d=i==="version"?t:n.type==="array"?[]:{},d!=null&&(l[i]=d)}}return l},I.bO=Di,I.bP=bs,I.bQ=function l(t,i){if(Array.isArray(t)){if(!Array.isArray(i)||t.length!==i.length)return!1;for(let n=0;n<t.length;n++)if(!l(t[n],i[n]))return!1;return!0}if(typeof t=="object"&&t!==null&&i!==null){if(typeof i!="object"||Object.keys(t).length!==Object.keys(i).length)return!1;for(let n in t)if(!l(t[n],i[n]))return!1;return!0}return t===i},I.bR=function(l){l=l.slice();let t=Object.create(null);for(let i=0;i<l.length;i++)t[l[i].id]=l[i];for(let i=0;i<l.length;i++)"ref"in l[i]&&(l[i]=Tt(l[i],t[l[i].ref]));return l},I.bS=function(l,t){if(l.type==="custom")return new hg(l,t);switch(l.type){case"background":return new Wg(l,t);case"circle":return new qp(l,t);case"color-relief":return new aV(l,t);case"fill":return new uV(l,t);case"fill-extrusion":return new XV(l,t);case"heatmap":return new tV(l,t);case"hillshade":return new iV(l,t);case"line":return new QV(l,t);case"raster":return new am(l,t);case"symbol":return new tb(l,t)}},I.bT=l=>l.type==="raster",I.bU=Pl,I.bV=function(l,t){if(!l)return[{command:"setStyle",args:[t]}];let i=[];try{if(!Bt(l.version,t.version))return[{command:"setStyle",args:[t]}];Bt(l.center,t.center)||i.push({command:"setCenter",args:[t.center]}),Bt(l.state,t.state)||i.push({command:"setGlobalState",args:[t.state]}),Bt(l.centerAltitude,t.centerAltitude)||i.push({command:"setCenterAltitude",args:[t.centerAltitude]}),Bt(l.zoom,t.zoom)||i.push({command:"setZoom",args:[t.zoom]}),Bt(l.bearing,t.bearing)||i.push({command:"setBearing",args:[t.bearing]}),Bt(l.pitch,t.pitch)||i.push({command:"setPitch",args:[t.pitch]}),Bt(l.roll,t.roll)||i.push({command:"setRoll",args:[t.roll]}),Bt(l.sprite,t.sprite)||i.push({command:"setSprite",args:[t.sprite]}),Bt(l.glyphs,t.glyphs)||i.push({command:"setGlyphs",args:[t.glyphs]}),Bt(l.transition,t.transition)||i.push({command:"setTransition",args:[t.transition]}),Bt(l.light,t.light)||i.push({command:"setLight",args:[t.light]}),Bt(l.terrain,t.terrain)||i.push({command:"setTerrain",args:[t.terrain]}),Bt(l.sky,t.sky)||i.push({command:"setSky",args:[t.sky]}),Bt(l.projection,t.projection)||i.push({command:"setProjection",args:[t.projection]});let n={},d=[];(function(b,h,V,R){let N;for(N in h=h||{},b=b||{})Object.prototype.hasOwnProperty.call(b,N)&&(Object.prototype.hasOwnProperty.call(h,N)||he(N,V,R));for(N in h)Object.prototype.hasOwnProperty.call(h,N)&&(Object.prototype.hasOwnProperty.call(b,N)?Bt(b[N],h[N])||(b[N].type==="geojson"&&h[N].type==="geojson"&&Ti(b,h,N)?Jt(V,{command:"setGeoJSONSourceData",args:[N,h[N].data]}):Be(N,h,V,R)):le(N,h,V))})(l.sources,t.sources,d,n);let r=[];l.layers&&l.layers.forEach((b=>{"source"in b&&n[b.source]?i.push({command:"removeLayer",args:[b.id]}):r.push(b)})),i=i.concat(d),(function(b,h,V){h=h||[];let R=(b=b||[]).map(Oe),N=h.map(Oe),M=b.reduce(ai,{}),J=h.reduce(ai,{}),S=R.slice(),C=Object.create(null),L,w,_,lt,P;for(let tt=0,pt=0;tt<R.length;tt++)L=R[tt],Object.prototype.hasOwnProperty.call(J,L)?pt++:(Jt(V,{command:"removeLayer",args:[L]}),S.splice(S.indexOf(L,pt),1));for(let tt=0,pt=0;tt<N.length;tt++)L=N[N.length-1-tt],S[S.length-1-tt]!==L&&(Object.prototype.hasOwnProperty.call(M,L)?(Jt(V,{command:"removeLayer",args:[L]}),S.splice(S.lastIndexOf(L,S.length-pt),1)):pt++,lt=S[S.length-tt],Jt(V,{command:"addLayer",args:[J[L],lt]}),S.splice(S.length-tt,0,L),C[L]=!0);for(let tt=0;tt<N.length;tt++)if(L=N[tt],w=M[L],_=J[L],!C[L]&&!Bt(w,_))if(Bt(w.source,_.source)&&Bt(w["source-layer"],_["source-layer"])&&Bt(w.type,_.type)){for(P in Ae(w.layout,_.layout,V,L,null,"setLayoutProperty"),Ae(w.paint,_.paint,V,L,null,"setPaintProperty"),Bt(w.filter,_.filter)||Jt(V,{command:"setFilter",args:[L,_.filter]}),Bt(w.minzoom,_.minzoom)&&Bt(w.maxzoom,_.maxzoom)||Jt(V,{command:"setLayerZoomRange",args:[L,_.minzoom,_.maxzoom]}),w)Object.prototype.hasOwnProperty.call(w,P)&&P!=="layout"&&P!=="paint"&&P!=="filter"&&P!=="metadata"&&P!=="minzoom"&&P!=="maxzoom"&&(P.indexOf("paint.")===0?Ae(w[P],_[P],V,L,P.slice(6),"setPaintProperty"):Bt(w[P],_[P])||Jt(V,{command:"setLayerProperty",args:[L,P,_[P]]}));for(P in _)Object.prototype.hasOwnProperty.call(_,P)&&!Object.prototype.hasOwnProperty.call(w,P)&&P!=="layout"&&P!=="paint"&&P!=="filter"&&P!=="metadata"&&P!=="minzoom"&&P!=="maxzoom"&&(P.indexOf("paint.")===0?Ae(w[P],_[P],V,L,P.slice(6),"setPaintProperty"):Bt(w[P],_[P])||Jt(V,{command:"setLayerProperty",args:[L,P,_[P]]}))}else Jt(V,{command:"removeLayer",args:[L]}),lt=S[S.lastIndexOf(L)+1],Jt(V,{command:"addLayer",args:[_,lt]})})(r,t.layers,i)}catch(n){console.warn("Unable to compute style diff:",n),i=[{command:"setStyle",args:[t]}]}return i},I.bW=function(l){let t=[],i=l.id;return i===void 0&&t.push({message:`layers.${i}: missing required property "id"`}),l.render===void 0&&t.push({message:`layers.${i}: missing required method "render"`}),l.renderingMode&&l.renderingMode!=="2d"&&l.renderingMode!=="3d"&&t.push({message:`layers.${i}: property "renderingMode" must be either "2d" or "3d"`}),t},I.bX=Fl,I.bY=$i,I.bZ=class extends ln{constructor(l,t){super(l,t),this.current=0}set(l){this.current!==l&&(this.current=l,this.gl.uniform1i(this.location,l))}},I.b_=nd,I.ba=function(l,t){return l[0]*t[0]+l[1]*t[1]+l[2]*t[2]+l[3]},I.bb=ah,I.bc=Nr,I.bd=function(l,t,i,n,d){var r=1/Math.tan(t/2);if(l[0]=r/i,l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[5]=r,l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[11]=-1,l[12]=0,l[13]=0,l[15]=0,d!=null&&d!==1/0){var b=1/(n-d);l[10]=(d+n)*b,l[14]=2*d*n*b}else l[10]=-1,l[14]=-2*n;return l},I.be=function(l){var t=new Ue(16);return t[0]=l[0],t[1]=l[1],t[2]=l[2],t[3]=l[3],t[4]=l[4],t[5]=l[5],t[6]=l[6],t[7]=l[7],t[8]=l[8],t[9]=l[9],t[10]=l[10],t[11]=l[11],t[12]=l[12],t[13]=l[13],t[14]=l[14],t[15]=l[15],t},I.bf=function(l,t,i){var n=Math.sin(i),d=Math.cos(i),r=t[0],b=t[1],h=t[2],V=t[3],R=t[4],N=t[5],M=t[6],J=t[7];return t!==l&&(l[8]=t[8],l[9]=t[9],l[10]=t[10],l[11]=t[11],l[12]=t[12],l[13]=t[13],l[14]=t[14],l[15]=t[15]),l[0]=r*d+R*n,l[1]=b*d+N*n,l[2]=h*d+M*n,l[3]=V*d+J*n,l[4]=R*d-r*n,l[5]=N*d-b*n,l[6]=M*d-h*n,l[7]=J*d-V*n,l},I.bg=function(l,t,i){var n=Math.sin(i),d=Math.cos(i),r=t[4],b=t[5],h=t[6],V=t[7],R=t[8],N=t[9],M=t[10],J=t[11];return t!==l&&(l[0]=t[0],l[1]=t[1],l[2]=t[2],l[3]=t[3],l[12]=t[12],l[13]=t[13],l[14]=t[14],l[15]=t[15]),l[4]=r*d+R*n,l[5]=b*d+N*n,l[6]=h*d+M*n,l[7]=V*d+J*n,l[8]=R*d-r*n,l[9]=N*d-b*n,l[10]=M*d-h*n,l[11]=J*d-V*n,l},I.bh=function(){let l=new Float32Array(16);return li(l),l},I.bi=function(){let l=new Float64Array(16);return li(l),l},I.bj=function(){return new Float64Array(16)},I.bk=function(l,t,i){let n=new Float64Array(4);return sa(n,l,t-90,i),n},I.bl=function(l,t,i,n){var d,r,b,h,V,R=t[0],N=t[1],M=t[2],J=t[3],S=i[0],C=i[1],L=i[2],w=i[3];return(r=R*S+N*C+M*L+J*w)<0&&(r=-r,S=-S,C=-C,L=-L,w=-w),1-r>te?(d=Math.acos(r),b=Math.sin(d),h=Math.sin((1-n)*d)/b,V=Math.sin(n*d)/b):(h=1-n,V=n),l[0]=h*R+V*S,l[1]=h*N+V*C,l[2]=h*M+V*L,l[3]=h*J+V*w,l},I.bm=function(l){let t=new Float64Array(9);var i,n,d,r,b,h,V,R,N,M,J,S,C,L,w,_,lt,P;M=(d=(n=l)[0])*(V=d+d),J=(r=n[1])*V,C=(b=n[2])*V,L=b*(R=r+r),_=(h=n[3])*V,lt=h*R,P=h*(N=b+b),(i=t)[0]=1-(S=r*R)-(w=b*N),i[3]=J-P,i[6]=C+lt,i[1]=J+P,i[4]=1-M-w,i[7]=L-_,i[2]=C-lt,i[5]=L+_,i[8]=1-M-S;let tt=vi(-Math.asin(Ci(t[2],-1,1))),pt,Vt;return Math.hypot(t[5],t[8])<.001?(pt=0,Vt=-vi(Math.atan2(t[3],t[4]))):(pt=vi(t[5]===0&&t[8]===0?0:Math.atan2(t[5],t[8])),Vt=vi(t[1]===0&&t[0]===0?0:Math.atan2(t[1],t[0]))),{roll:pt,pitch:tt+90,bearing:Vt}},I.bn=function(l,t){return l.roll==t.roll&&l.pitch==t.pitch&&l.bearing==t.bearing},I.bo=Ee,I.bp=ad,I.bq=gr,I.br=ys,I.bs=Vr,I.bt=ba,I.bu=dn,I.bv=Jl,I.bw=function(l,t,i,n,d){return ba(n,d,Ci((l-t)/(i-t),0,1))},I.bx=ol,I.by=function(){return new Float64Array(3)},I.bz=function(l,t,i,n){return l[0]=t[0]+i[0]*n,l[1]=t[1]+i[1]*n,l[2]=t[2]+i[2]*n,l},I.c=cn,I.c$=class{constructor(l){this._marks={start:[l.url,"start"].join("#"),end:[l.url,"end"].join("#"),measure:l.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let l=performance.getEntriesByName(this._marks.measure);return l.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),l=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),l}},I.c0=Ea,I.c1=class extends ln{constructor(l,t){super(l,t),this.current=[0,0,0]}set(l){l[0]===this.current[0]&&l[1]===this.current[1]&&l[2]===this.current[2]||(this.current=l,this.gl.uniform3f(this.location,l[0],l[1],l[2]))}},I.c2=class extends ln{constructor(l,t){super(l,t),this.current=[0,0]}set(l){l[0]===this.current[0]&&l[1]===this.current[1]||(this.current=l,this.gl.uniform2f(this.location,l[0],l[1]))}},I.c3=di,I.c4=function(l,t){var i=Math.sin(t),n=Math.cos(t);return l[0]=n,l[1]=i,l[2]=0,l[3]=-i,l[4]=n,l[5]=0,l[6]=0,l[7]=0,l[8]=1,l},I.c5=function(l,t,i){var n=t[0],d=t[1],r=t[2];return l[0]=n*i[0]+d*i[3]+r*i[6],l[1]=n*i[1]+d*i[4]+r*i[7],l[2]=n*i[2]+d*i[5]+r*i[8],l},I.c6=function(l,t,i,n,d,r,b){var h=1/(t-i),V=1/(n-d),R=1/(r-b);return l[0]=-2*h,l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[5]=-2*V,l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[10]=2*R,l[11]=0,l[12]=(t+i)*h,l[13]=(d+n)*V,l[14]=(b+r)*R,l[15]=1,l},I.c7=class extends ln{constructor(l,t){super(l,t),this.current=new Array}set(l){if(l!=this.current){this.current=l;let t=new Float32Array(4*l.length);for(let i=0;i<l.length;i++)t[4*i]=l[i].r,t[4*i+1]=l[i].g,t[4*i+2]=l[i].b,t[4*i+3]=l[i].a;this.gl.uniform4fv(this.location,t)}}},I.c8=class extends ln{constructor(l,t){super(l,t),this.current=new Array}set(l){if(l!=this.current){this.current=l;let t=new Float32Array(l);this.gl.uniform1fv(this.location,t)}}},I.c9=class extends rr{},I.cA=function(l){return We[l]||Hi[l]},I.cB=function(l,t,i){var n=t[0],d=t[1];return l[0]=i[0]*n+i[4]*d+i[12],l[1]=i[1]*n+i[5]*d+i[13],l},I.cC=function(l,t){let{x:i,y:n}=Qs.fromLngLat(t);return!(l<0||l>25||n<0||n>=1||i<0||i>=1)},I.cD=function(l,t){return l[0]=t[0],l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[5]=t[1],l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[10]=t[2],l[11]=0,l[12]=0,l[13]=0,l[14]=0,l[15]=1,l},I.cE=class extends bo{},I.cF=fg,I.cH=function(l){return l.message===Da},I.cI=zl,I.cJ=function(l,t){Ca.REGISTERED_PROTOCOLS[l]=t},I.cK=function(l){delete Ca.REGISTERED_PROTOCOLS[l]},I.cL=function(l,t){let i={};for(let d=0;d<l.length;d++){let r=t&&t[l[d].id]||F0(l[d]);t&&(t[l[d].id]=r);let b=i[r];b||(b=i[r]=[]),b.push(l[d])}let n=[];for(let d in i)n.push(i[d]);return n},I.cM=ne,I.cN=dh,I.cO=xh,I.cP=jW,I.cQ=function(l){l.bucket.createArrays(),l.bucket.tilePixelRatio=Le/(512*l.bucket.overscaling),l.bucket.compareText={},l.bucket.iconsNeedLinear=!1;let t=l.bucket.layers[0],i=t.layout,n=t._unevaluatedLayout._values,d={layoutIconSize:n["icon-size"].possiblyEvaluate(new Vi(l.bucket.zoom+1),l.canonical),layoutTextSize:n["text-size"].possiblyEvaluate(new Vi(l.bucket.zoom+1),l.canonical),textMaxSize:n["text-size"].possiblyEvaluate(new Vi(18))};if(l.bucket.textSizeData.kind==="composite"){let{minZoom:R,maxZoom:N}=l.bucket.textSizeData;d.compositeTextSizes=[n["text-size"].possiblyEvaluate(new Vi(R),l.canonical),n["text-size"].possiblyEvaluate(new Vi(N),l.canonical)]}if(l.bucket.iconSizeData.kind==="composite"){let{minZoom:R,maxZoom:N}=l.bucket.iconSizeData;d.compositeIconSizes=[n["icon-size"].possiblyEvaluate(new Vi(R),l.canonical),n["icon-size"].possiblyEvaluate(new Vi(N),l.canonical)]}let r=i.get("text-line-height")*Bl,b=i.get("text-rotation-alignment")!=="viewport"&&i.get("symbol-placement")!=="point",h=i.get("text-keep-upright"),V=i.get("text-size");for(let R of l.bucket.features){let N=i.get("text-font").evaluate(R,{},l.canonical).join(","),M=V.evaluate(R,{},l.canonical),J=d.layoutTextSize.evaluate(R,{},l.canonical),S=d.layoutIconSize.evaluate(R,{},l.canonical),C={horizontal:{},vertical:void 0},L=R.text,w,_=[0,0];if(L){let tt=L.toString(),pt=i.get("text-letter-spacing").evaluate(R,{},l.canonical)*Bl,Vt=cr(tt)?pt:0,Yt=i.get("text-anchor").evaluate(R,{},l.canonical),wt=jh(t,R,l.canonical);if(!wt){let Kt=i.get("text-radial-offset").evaluate(R,{},l.canonical);_=Kt?zh(Yt,[Kt*Bl,Dm]):i.get("text-offset").evaluate(R,{},l.canonical).map((qt=>qt*Bl))}let Qt=b?"center":i.get("text-justify").evaluate(R,{},l.canonical),Ht=i.get("symbol-placement")==="point"?i.get("text-max-width").evaluate(R,{},l.canonical)*Bl:1/0,ae=()=>{l.bucket.allowVerticalPlacement&&lo(tt)&&(C.vertical=q0(L,l.glyphMap,l.glyphPositions,l.imagePositions,N,Ht,r,Yt,"left",Vt,_,I.ay.vertical,!0,J,M))};if(!b&&wt){let Kt=new Set;if(Qt==="auto")for(let Lt=0;Lt<wt.values.length;Lt+=2)Kt.add(fm(wt.values[Lt]));else Kt.add(Qt);let qt=!1;for(let Lt of Kt)if(!C.horizontal[Lt])if(qt)C.horizontal[Lt]=C.horizontal[0];else{let Ze=q0(L,l.glyphMap,l.glyphPositions,l.imagePositions,N,Ht,r,"center",Lt,Vt,_,I.ay.horizontal,!1,J,M);Ze&&(C.horizontal[Lt]=Ze,qt=Ze.positionedLines.length===1)}ae()}else{Qt==="auto"&&(Qt=fm(Yt));let Kt=q0(L,l.glyphMap,l.glyphPositions,l.imagePositions,N,Ht,r,Yt,Qt,Vt,_,I.ay.horizontal,!1,J,M);Kt&&(C.horizontal[Qt]=Kt),ae(),lo(tt)&&b&&h&&(C.vertical=q0(L,l.glyphMap,l.glyphPositions,l.imagePositions,N,Ht,r,Yt,Qt,Vt,_,I.ay.vertical,!1,J,M))}}let lt=!1;if(R.icon&&R.icon.name){let tt=l.imageMap[R.icon.name];tt&&(w=rg(l.imagePositions[R.icon.name],i.get("icon-offset").evaluate(R,{},l.canonical),i.get("icon-anchor").evaluate(R,{},l.canonical)),lt=!!tt.sdf,l.bucket.sdfIcons===void 0?l.bucket.sdfIcons=lt:l.bucket.sdfIcons!==lt&&ci("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(tt.pixelRatio!==l.bucket.pixelRatio||i.get("icon-rotate").constantOr(1)!==0)&&(l.bucket.iconsNeedLinear=!0))}let P=wh(C.horizontal)||C.vertical;l.bucket.iconsInText=!!P&&P.iconsInText,(P||w)&&Hg(l.bucket,R,C,w,l.imageMap,d,J,S,_,lt,l.canonical,l.subdivisionGranularity)}l.showCollisionBoxes&&l.bucket.generateCollisionDebugBuffers()},I.cR=gm,I.cS=Rm,I.cT=Fm,I.cU=GW,I.cV=Nm,I.cW=ur,I.cX=function(l,t,i,n,d,r){let b=Jh(l,t,i,d,0);return b=Jh(b,t,n,r,1),b},I.cY=class{constructor(l){this.maxEntries=l,this.map=new Map}get(l){let t=this.map.get(l);return t!==void 0&&(this.map.delete(l),this.map.set(l,t)),t}set(l,t){if(this.map.has(l))this.map.delete(l);else if(this.map.size>=this.maxEntries){let i=this.map.keys().next().value;this.map.delete(i)}this.map.set(l,t)}clear(){this.map.clear()}},I.cZ=NW,I.c_=Yh,I.ca=jV,I.cb=class extends sr{},I.cc=Wm,I.cd=function(l){return l<=1?1:Math.pow(2,Math.ceil(Math.log(l)/Math.LN2))},I.ce=oW,I.cf=function(l,t,i){var n=t[0],d=t[1],r=t[2],b=i[3]*n+i[7]*d+i[11]*r+i[15];return l[0]=(i[0]*n+i[4]*d+i[8]*r+i[12])/(b=b||1),l[1]=(i[1]*n+i[5]*d+i[9]*r+i[13])/b,l[2]=(i[2]*n+i[6]*d+i[10]*r+i[14])/b,l},I.cg=class extends us{},I.ch=class extends c{},I.ci=function(l,t){return l[0]===t[0]&&l[1]===t[1]&&l[2]===t[2]&&l[3]===t[3]&&l[4]===t[4]&&l[5]===t[5]&&l[6]===t[6]&&l[7]===t[7]&&l[8]===t[8]&&l[9]===t[9]&&l[10]===t[10]&&l[11]===t[11]&&l[12]===t[12]&&l[13]===t[13]&&l[14]===t[14]&&l[15]===t[15]},I.cj=function(l,t){var i=l[0],n=l[1],d=l[2],r=l[3],b=l[4],h=l[5],V=l[6],R=l[7],N=l[8],M=l[9],J=l[10],S=l[11],C=l[12],L=l[13],w=l[14],_=l[15],lt=t[0],P=t[1],tt=t[2],pt=t[3],Vt=t[4],Yt=t[5],wt=t[6],Qt=t[7],Ht=t[8],ae=t[9],Kt=t[10],qt=t[11],Lt=t[12],Ze=t[13],pe=t[14],Fe=t[15];return Math.abs(i-lt)<=te*Math.max(1,Math.abs(i),Math.abs(lt))&&Math.abs(n-P)<=te*Math.max(1,Math.abs(n),Math.abs(P))&&Math.abs(d-tt)<=te*Math.max(1,Math.abs(d),Math.abs(tt))&&Math.abs(r-pt)<=te*Math.max(1,Math.abs(r),Math.abs(pt))&&Math.abs(b-Vt)<=te*Math.max(1,Math.abs(b),Math.abs(Vt))&&Math.abs(h-Yt)<=te*Math.max(1,Math.abs(h),Math.abs(Yt))&&Math.abs(V-wt)<=te*Math.max(1,Math.abs(V),Math.abs(wt))&&Math.abs(R-Qt)<=te*Math.max(1,Math.abs(R),Math.abs(Qt))&&Math.abs(N-Ht)<=te*Math.max(1,Math.abs(N),Math.abs(Ht))&&Math.abs(M-ae)<=te*Math.max(1,Math.abs(M),Math.abs(ae))&&Math.abs(J-Kt)<=te*Math.max(1,Math.abs(J),Math.abs(Kt))&&Math.abs(S-qt)<=te*Math.max(1,Math.abs(S),Math.abs(qt))&&Math.abs(C-Lt)<=te*Math.max(1,Math.abs(C),Math.abs(Lt))&&Math.abs(L-Ze)<=te*Math.max(1,Math.abs(L),Math.abs(Ze))&&Math.abs(w-pe)<=te*Math.max(1,Math.abs(w),Math.abs(pe))&&Math.abs(_-Fe)<=te*Math.max(1,Math.abs(_),Math.abs(Fe))},I.ck=function(l,t){return l[0]=t[0],l[1]=t[1],l[2]=t[2],l[3]=t[3],l[4]=t[4],l[5]=t[5],l[6]=t[6],l[7]=t[7],l[8]=t[8],l[9]=t[9],l[10]=t[10],l[11]=t[11],l[12]=t[12],l[13]=t[13],l[14]=t[14],l[15]=t[15],l},I.cl=l=>l.type==="symbol",I.cm=l=>l.type==="circle",I.cn=l=>l.type==="heatmap",I.co=l=>l.type==="line",I.cp=l=>l.type==="fill",I.cq=l=>l.type==="fill-extrusion",I.cr=l=>l.type==="hillshade",I.cs=l=>l.type==="color-relief",I.ct=l=>l.type==="background",I.cu=l=>l.type==="custom",I.cv=xl,I.cw=function(l,t,i){let n=Ri(t.x-i.x,t.y-i.y),d=Ri(l.x-i.x,l.y-i.y);var r,b;return vi(Math.atan2(n[0]*d[1]-n[1]*d[0],(r=n)[0]*(b=d)[0]+r[1]*b[1]))},I.cx=_l,I.cy=function(l,t){return Hi[t]&&(l instanceof MouseEvent||l instanceof WheelEvent)},I.cz=function(l,t){return We[t]&&"touches"in l},I.d=z,I.d0=function(l,t,i,n,d){return o(this,void 0,void 0,(function*(){if(Ie())try{return yield Rn(l,t,i,n,d)}catch{}return(function(r,b,h,V,R){let N=r.width,M=r.height;Ha&&hl||(Ha=new OffscreenCanvas(N,M),hl=Ha.getContext("2d",{willReadFrequently:!0})),Ha.width=N,Ha.height=M,hl.drawImage(r,0,0,N,M);let J=hl.getImageData(b,h,V,R);return hl.clearRect(0,0,N,M),J.data})(l,t,i,n,d)}))},I.d1=bW,I.d2=Ct,I.d3=Ko,I.d4=Id,I.e=ki,I.f=l=>o(void 0,void 0,void 0,(function*(){if(l.byteLength===0)return createImageBitmap(new ImageData(1,1));let t=new Blob([new Uint8Array(l)],{type:"image/png"});try{return createImageBitmap(t)}catch(i){throw new Error(`Could not load image because of ${i.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}})),I.g=En,I.h=l=>new Promise(((t,i)=>{let n=new Image;n.onload=()=>{t(n),URL.revokeObjectURL(n.src),n.onload=null,window.requestAnimationFrame((()=>{n.src=wi}))},n.onerror=()=>i(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));let d=new Blob([new Uint8Array(l)],{type:"image/png"});n.src=l.byteLength?URL.createObjectURL(d):wi})),I.i=Na,I.j=(l,t)=>ht(ki(l,{type:"json"}),t),I.k=rt,I.l=dt,I.m=ht,I.n=(l,t)=>ht(ki(l,{type:"arrayBuffer"}),t),I.o=function(l){return new Nm(l).readFields(eg,[])},I.p=zW,I.q=function(l){return/[\u02EA\u02EB\u1100-\u11FF\u2E80-\u2FDF\u3000-\u30FF\u3105-\u312F\u3131-\u318E\u31A0-\u4DBF\u4E00-\uA48C\uA490-\uA4C6\uA960-\uA97C\uAC00-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFE10-\uFE1F\uFE30-\uFE4F\uFF00-\uFFEF]|\uD81B[\uDFE0-\uDFFF]|[\uD81C-\uD822\uD840-\uD868\uD86A-\uD86D\uD86F-\uD872\uD874-\uD879\uD880-\uD883\uD885-\uD88C][\uDC00-\uDFFF]|\uD823[\uDC00-\uDCD5\uDCFF-\uDD1E\uDD80-\uDDF2]|\uD82B[\uDFF0-\uDFFF]|\uD82C[\uDC00-\uDEFB]|\uD83C[\uDE00-\uDEFF]|\uD869[\uDC00-\uDEDF\uDF00-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEAD\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0\uDFF0-\uDFFF]|\uD87B[\uDC00-\uDE5D]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A\uDF50-\uDFFF]|\uD88D[\uDC00-\uDC79]/gim.test(String.fromCodePoint(l))},I.r=Ys,I.s=Qi,I.t=ia,I.u=K,I.v=$c,I.w=ci,I.x=k0,I.y=qb,I.z=ao})),Y("worker",["./shared"],(function(I){"use strict";class o{constructor(z,v){this.keyCache={},z&&this.replace(z,v)}replace(z,v){this._layerConfigs={},this._layers={},this.update(z,[],v)}update(z,v,O){for(let rt of z){this._layerConfigs[rt.id]=rt;let Nt=this._layers[rt.id]=I.bS(rt,O);Nt._featureFilter=I.aj(Nt.filter,O),this.keyCache[rt.id]&&delete this.keyCache[rt.id]}for(let rt of v)delete this.keyCache[rt],delete this._layerConfigs[rt],delete this._layers[rt];this.familiesBySource={};let dt=I.cL(Object.values(this._layerConfigs),this.keyCache);for(let rt of dt){let Nt=rt.map((le=>this._layers[le.id])),K=Nt[0];if(K.visibility==="none")continue;let ut=K.source||"",Tt=this.familiesBySource[ut];Tt||(Tt=this.familiesBySource[ut]={});let Bt=K.sourceLayer||I.a9,Jt=Tt[Bt];Jt||(Jt=Tt[Bt]=[]),Jt.push(Nt)}}}class st{constructor(z){let v={},O=[];for(let K in z){let ut=z[K],Tt=v[K]={};for(let Bt in ut){let Jt=ut[+Bt];if(!Jt||Jt.bitmap.width===0||Jt.bitmap.height===0)continue;let le={x:0,y:0,w:Jt.bitmap.width+2,h:Jt.bitmap.height+2};O.push(le),Tt[Bt]={rect:le,metrics:Jt.metrics}}}let{w:dt,h:rt}=I.p(O),Nt=new I.r({width:dt||1,height:rt||1});for(let K in z){let ut=z[K];for(let Tt in ut){let Bt=ut[+Tt];if(!Bt||Bt.bitmap.width===0||Bt.bitmap.height===0)continue;let Jt=v[K][Tt].rect;I.r.copy(Bt.bitmap,Nt,{x:0,y:0},{x:Jt.x+1,y:Jt.y+1},Bt.bitmap)}}this.image=Nt,this.positions=v}}I.cM("GlyphAtlas",st);class Ct{constructor(z){this.tileID=new I.a1(z.tileID.overscaledZ,z.tileID.wrap,z.tileID.canonical.z,z.tileID.canonical.x,z.tileID.canonical.y),this.uid=z.uid,this.zoom=z.zoom,this.pixelRatio=z.pixelRatio,this.tileSize=z.tileSize,this.source=z.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=z.showCollisionBoxes,this.collectResourceTiming=!!z.collectResourceTiming,this.returnDependencies=!!z.returnDependencies,this.promoteId=z.promoteId,this.inFlightDependencies=[]}parse(z,v,O,dt,rt){return I._(this,void 0,void 0,(function*(){this.status="parsing",this.data=z,this.collisionBoxArray=new I.ah;let Nt=new I.cN(Object.keys(z.layers).sort()),K=new I.cO(this.tileID,this.promoteId);K.bucketLayerIDs=[];let ut={},Tt={featureIndex:K,iconDependencies:{},patternDependencies:{},glyphDependencies:{},dashDependencies:{},availableImages:O,subdivisionGranularity:rt},Bt=v.familiesBySource[this.source];for(let be in Bt){let ue=z.layers[be];if(!ue)continue;ue.version===1&&I.w(`Vector tile source "${this.source}" layer "${be}" does not use vector tile spec v2 and therefore may have some rendering errors.`);let jl=Nt.encode(be),zn=[];for(let Ji=0;Ji<ue.length;Ji++){let Ne=ue.feature(Ji),ka=K.getId(Ne,be);zn.push({feature:Ne,id:ka,index:Ji,sourceLayerIndex:jl})}for(let Ji of Bt[be]){let Ne=Ji[0];Ne.source!==this.source&&I.w(`layer.source = ${Ne.source} does not equal this.source = ${this.source}`),Ne.isHidden(this.zoom,!0)||(vt(Ji,this.zoom,O),(ut[Ne.id]=Ne.createBucket({index:K.bucketLayerIDs.length,layers:Ji,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:jl,sourceID:this.source})).populate(zn,Tt,this.tileID.canonical),K.bucketLayerIDs.push(Ji.map((ka=>ka.id))))}}let Jt=I.bX(Tt.glyphDependencies,(be=>Object.keys(be).map(Number)));this.inFlightDependencies.forEach((be=>be?.abort())),this.inFlightDependencies=[];let le=Promise.resolve({});if(Object.keys(Jt).length){let be=new AbortController;this.inFlightDependencies.push(be),le=dt.sendAsync({type:"GG",data:{stacks:Jt,source:this.source,tileID:this.tileID,type:"glyphs"}},be)}let he=Object.keys(Tt.iconDependencies),Be=Promise.resolve({});if(he.length){let be=new AbortController;this.inFlightDependencies.push(be),Be=dt.sendAsync({type:"GI",data:{icons:he,source:this.source,tileID:this.tileID,type:"icons"}},be)}let Ti=Object.keys(Tt.patternDependencies),Ae=Promise.resolve({});if(Ti.length){let be=new AbortController;this.inFlightDependencies.push(be),Ae=dt.sendAsync({type:"GI",data:{icons:Ti,source:this.source,tileID:this.tileID,type:"patterns"}},be)}let Oe=Tt.dashDependencies,ai=Promise.resolve({});if(Object.keys(Oe).length){let be=new AbortController;this.inFlightDependencies.push(be),ai=dt.sendAsync({type:"GDA",data:{dashes:Oe}},be)}let[ft,oi,hi,tl]=yield Promise.all([le,Be,Ae,ai]),Zi=new st(ft),Ot=new I.cP(oi,hi);for(let be in ut){let ue=ut[be];ue instanceof I.ai?(vt(ue.layers,this.zoom,O),I.cQ({bucket:ue,glyphMap:ft,glyphPositions:Zi.positions,imageMap:oi,imagePositions:Ot.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical,subdivisionGranularity:Tt.subdivisionGranularity})):ue.hasDependencies&&(ue instanceof I.cR||ue instanceof I.cS||ue instanceof I.cT)&&(vt(ue.layers,this.zoom,O),ue.addFeatures(Tt,this.tileID.canonical,Ot.patternPositions,tl))}return this.status="done",{buckets:Object.values(ut).filter((be=>!be.isEmpty())),featureIndex:K,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Zi.image,imageAtlas:Ot,dashPositions:tl,glyphMap:this.returnDependencies?ft:null,iconMap:this.returnDependencies?oi:null,glyphPositions:this.returnDependencies?Zi.positions:null}}))}}function vt(ht,z,v){let O=new I.H(z);for(let dt of ht)dt.recalculate(O,v)}class de extends I.cW{constructor(z,v){super(new I.cV,0,v,[],[]),this.feature=z,this.type=z.type,this.properties=z.tags?z.tags:{},"id"in z&&(typeof z.id=="string"?this.id=parseInt(z.id,10):typeof z.id!="number"||isNaN(z.id)||(this.id=z.id))}loadGeometry(){let z=[],v=this.feature.type===1?[this.feature.geometry]:this.feature.geometry;for(let O of v){let dt=[];for(let rt of O)dt.push(new I.P(rt[0],rt[1]));z.push(dt)}return z}}class ee extends I.cU{constructor(z,v){super(new I.cV),this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.version=v?v.version:1,this.extent=v?v.extent:4096,this.length=z.length,this.features=z}feature(z){return new de(this.features[z],this.extent)}}function ge(ht,z){z.writeVarintField(15,ht.version||1),z.writeStringField(1,ht.name||""),z.writeVarintField(5,ht.extent||4096);let v={keys:[],values:[],keycache:{},valuecache:{}};for(let rt=0;rt<ht.length;rt++)v.feature=ht.feature(rt),z.writeMessage(2,ye,v);let O=v.keys;for(let rt of O)z.writeStringField(3,rt);let dt=v.values;for(let rt of dt)z.writeMessage(4,Ue,rt)}function ye(ht,z){if(!ht.feature)return;let v=ht.feature;v.id!==void 0&&z.writeVarintField(1,v.id),z.writeMessage(2,jt,ht),z.writeVarintField(3,v.type),z.writeMessage(4,te,v)}function jt(ht,z){for(let v in ht.feature?.properties){let O=ht.feature.properties[v],dt=ht.keycache[v];if(O===null)continue;dt===void 0&&(ht.keys.push(v),dt=ht.keys.length-1,ht.keycache[v]=dt),z.writeVarint(dt),typeof O!="string"&&typeof O!="boolean"&&typeof O!="number"&&(O=JSON.stringify(O));let rt=typeof O+":"+O,Nt=ht.valuecache[rt];Nt===void 0&&(ht.values.push(O),Nt=ht.values.length-1,ht.valuecache[rt]=Nt),z.writeVarint(Nt)}}function gt(ht,z){return(z<<3)+(7&ht)}function Ie(ht){return ht<<1^ht>>31}function te(ht,z){let v=ht.loadGeometry(),O=ht.type,dt=0,rt=0;for(let Nt of v){let K=1;O===1&&(K=Nt.length),z.writeVarint(gt(1,K));let ut=O===3?Nt.length-1:Nt.length;for(let Tt=0;Tt<ut;Tt++){Tt===1&&O!==1&&z.writeVarint(gt(2,ut-1));let Bt=Nt[Tt].x-dt,Jt=Nt[Tt].y-rt;z.writeVarint(Ie(Bt)),z.writeVarint(Ie(Jt)),dt+=Bt,rt+=Jt}ht.type===3&&z.writeVarint(gt(7,1))}}function Ue(ht,z){let v=typeof ht;v==="string"?z.writeStringField(1,ht):v==="boolean"?z.writeBooleanField(7,ht):v==="number"&&(ht%1!=0?z.writeDoubleField(3,ht):ht<0?z.writeSVarintField(6,ht):z.writeVarintField(5,ht))}class di extends I.cW{constructor(z,v,O,dt,rt){super(new I.cV,0,rt,[],[]),this.type=z,this.properties=O||{},this.extent=rt,this.pointsArray=v,this.id=dt}loadGeometry(){return this.pointsArray.map((z=>z.map((v=>new I.P(v.x,v.y)))))}}class li extends I.cU{constructor(z,v,O){super(new I.cV),this.version=2,this._myFeatures=z,this.name=v,this.length=z.length,this.extent=O}feature(z){return this._myFeatures[z]}}class ze{constructor(){this.layers={}}addLayer(z){this.layers[z.name]=z}}function je(ht){let z=(function(v){let O=new I.cV;return(function(dt,rt){for(let Nt in dt.layers)rt.writeMessage(3,ge,dt.layers[Nt])})(v,O),O.finish()})(ht);return z.byteOffset===0&&z.byteLength===z.buffer.byteLength||(z=new Uint8Array(z)),{vectorTile:ht,rawData:z.buffer}}function B(ht,z,v){let{extent:O}=ht,dt=Math.pow(2,v.z-z.z),rt=(v.x-z.x*dt)*O,Nt=(v.y-z.y*dt)*O,K=[];for(let ut=0;ut<ht.length;ut++){let Tt=ht.feature(ut),Bt=Tt.loadGeometry();for(let le of Bt)for(let he of le)he.x=he.x*dt-rt,he.y=he.y*dt-Nt;let Jt=128;Bt=I.cX(Bt,Tt.type,-Jt,-Jt,O+Jt,O+Jt),Bt.length!==0&&K.push(new di(Tt.type,Bt,Tt.properties,Tt.id,O))}return new li(K,ht.name,O)}class ii{constructor(z,v,O){this.actor=z,this.layerIndex=v,this.availableImages=O,this.fetching={},this.loading={},this.loaded={},this.overzoomedTileResultCache=new I.cY(1e3)}loadVectorTile(z,v){return I._(this,void 0,void 0,(function*(){let O=yield I.n(z.request,v);try{return{vectorTile:z.encoding!=="mlt"?new I.cZ(new I.cV(O.data)):new I.c_(O.data),rawData:O.data,cacheControl:O.cacheControl,expires:O.expires}}catch(dt){let rt=new Uint8Array(O.data),Nt=`Unable to parse the tile at ${z.request.url}, `;throw Nt+=rt[0]===31&&rt[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${dt.message}`,new Error(Nt)}}))}loadTile(z){return I._(this,void 0,void 0,(function*(){let{uid:v,overzoomParameters:O}=z;O&&(z.request=O.overzoomRequest);let dt=!!(z&&z.request&&z.request.collectResourceTiming)&&new I.c$(z.request),rt=new Ct(z);this.loading[v]=rt;let Nt=new AbortController;rt.abort=Nt;try{let K=yield this.loadVectorTile(z,Nt);if(delete this.loading[v],!K)return null;if(O){let le=this._getOverzoomTile(z,K.vectorTile);K.rawData=le.rawData,K.vectorTile=le.vectorTile}let ut=K.rawData,Tt={};K.expires&&(Tt.expires=K.expires),K.cacheControl&&(Tt.cacheControl=K.cacheControl);let Bt={};if(dt){let le=dt.finish();le&&(Bt.resourceTiming=JSON.parse(JSON.stringify(le)))}rt.vectorTile=K.vectorTile;let Jt=rt.parse(K.vectorTile,this.layerIndex,this.availableImages,this.actor,z.subdivisionGranularity);this.loaded[v]=rt,this.fetching[v]={rawTileData:ut,cacheControl:Tt,resourceTiming:Bt};try{let le=yield Jt;return I.e({rawTileData:ut.slice(0),encoding:z.encoding},le,Tt,Bt)}finally{delete this.fetching[v]}}catch(K){throw delete this.loading[v],rt.status="done",this.loaded[v]=rt,K}}))}_getOverzoomTile(z,v){let{tileID:O,source:dt,overzoomParameters:rt}=z,{maxZoomTileID:Nt}=rt,K=`${Nt.key}_${O.key}`,ut=this.overzoomedTileResultCache.get(K);if(ut)return ut;let Tt=new ze,Bt=this.layerIndex.familiesBySource[dt];for(let le in Bt){let he=v.layers[le];if(!he)continue;let Be=B(he,Nt,O.canonical);Be.length>0&&Tt.addLayer(Be)}let Jt=je(Tt);return this.overzoomedTileResultCache.set(K,Jt),Jt}reloadTile(z){return I._(this,void 0,void 0,(function*(){let v=z.uid;if(!this.loaded||!this.loaded[v])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");let O=this.loaded[v];if(O.showCollisionBoxes=z.showCollisionBoxes,O.status==="parsing"){let dt=yield O.parse(O.vectorTile,this.layerIndex,this.availableImages,this.actor,z.subdivisionGranularity),rt;if(this.fetching[v]){let{rawTileData:Nt,cacheControl:K,resourceTiming:ut}=this.fetching[v];delete this.fetching[v],rt=I.e({rawTileData:Nt.slice(0),encoding:z.encoding},dt,K,ut)}else rt=dt;return rt}if(O.status==="done"&&O.vectorTile)return O.parse(O.vectorTile,this.layerIndex,this.availableImages,this.actor,z.subdivisionGranularity)}))}abortTile(z){return I._(this,void 0,void 0,(function*(){let v=this.loading,O=z.uid;v&&v[O]&&v[O].abort&&(v[O].abort.abort(),delete v[O])}))}removeTile(z){return I._(this,void 0,void 0,(function*(){this.loaded&&this.loaded[z.uid]&&delete this.loaded[z.uid]}))}}class Me{constructor(){this.loaded={}}loadTile(z){return I._(this,void 0,void 0,(function*(){let{uid:v,encoding:O,rawImageData:dt,redFactor:rt,greenFactor:Nt,blueFactor:K,baseShift:ut}=z,Tt=dt.width+2,Bt=dt.height+2,Jt=I.b(dt)?new I.R({width:Tt,height:Bt},yield I.d0(dt,-1,-1,Tt,Bt)):dt,le=new I.d1(v,Jt,O,rt,Nt,K,ut);return this.loaded=this.loaded||{},this.loaded[v]=le,le}))}removeTile(z){let v=this.loaded,O=z.uid;v&&v[O]&&delete v[O]}}var ui,ri,xi=(function(){if(ri)return ui;function ht(v,O){if(v.length!==0){z(v[0],O);for(var dt=1;dt<v.length;dt++)z(v[dt],!O)}}function z(v,O){for(var dt=0,rt=0,Nt=0,K=v.length,ut=K-1;Nt<K;ut=Nt++){var Tt=(v[Nt][0]-v[ut][0])*(v[ut][1]+v[Nt][1]),Bt=dt+Tt;rt+=Math.abs(dt)>=Math.abs(Tt)?dt-Bt+Tt:Tt-Bt+dt,dt=Bt}dt+rt>=0!=!!O&&v.reverse()}return ri=1,ui=function v(O,dt){var rt,Nt=O&&O.type;if(Nt==="FeatureCollection")for(rt=0;rt<O.features.length;rt++)v(O.features[rt],dt);else if(Nt==="GeometryCollection")for(rt=0;rt<O.geometries.length;rt++)v(O.geometries[rt],dt);else if(Nt==="Feature")v(O.geometry,dt);else if(Nt==="Polygon")ht(O.coordinates,dt);else if(Nt==="MultiPolygon")for(rt=0;rt<O.coordinates.length;rt++)ht(O.coordinates[rt],dt);return O}})(),Qe=I.d2(xi);let Ui={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:ht=>ht},sa=Math.fround||(cl=new Float32Array(1),ht=>(cl[0]=+ht,cl[0]));var cl;class Ri{constructor(z){this.options=Object.assign(Object.create(Ui),z),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(z){let{log:v,minZoom:O,maxZoom:dt}=this.options;v&&console.time("total time");let rt=`prepare ${z.length} points`;v&&console.time(rt),this.points=z;let Nt=[];for(let ut=0;ut<z.length;ut++){let Tt=z[ut];if(!Tt.geometry)continue;let[Bt,Jt]=Tt.geometry.coordinates,le=sa(ol(Bt)),he=sa(ba(Jt));Nt.push(le,he,1/0,ut,-1,1),this.options.reduce&&Nt.push(0)}let K=this.trees[dt+1]=this._createTree(Nt);v&&console.timeEnd(rt);for(let ut=dt;ut>=O;ut--){let Tt=+Date.now();K=this.trees[ut]=this._createTree(this._cluster(K,ut)),v&&console.log("z%d: %d clusters in %dms",ut,K.numItems,+Date.now()-Tt)}return v&&console.timeEnd("total time"),this}getClusters(z,v){let O=((z[0]+180)%360+360)%360-180,dt=Math.max(-90,Math.min(90,z[1])),rt=z[2]===180?180:((z[2]+180)%360+360)%360-180,Nt=Math.max(-90,Math.min(90,z[3]));if(z[2]-z[0]>=360)O=-180,rt=180;else if(O>rt){let Jt=this.getClusters([O,dt,180,Nt],v),le=this.getClusters([-180,dt,rt,Nt],v);return Jt.concat(le)}let K=this.trees[this._limitZoom(v)],ut=K.range(ol(O),ba(Nt),ol(rt),ba(dt)),Tt=K.data,Bt=[];for(let Jt of ut){let le=this.stride*Jt;Bt.push(Tt[le+5]>1?Le(Tt,le,this.clusterProps):this.points[Tt[le+3]])}return Bt}getChildren(z){let v=this._getOriginId(z),O=this._getOriginZoom(z),dt="No cluster with the specified id.",rt=this.trees[O];if(!rt)throw new Error(dt);let Nt=rt.data;if(v*this.stride>=Nt.length)throw new Error(dt);let K=this.options.radius/(this.options.extent*Math.pow(2,O-1)),ut=rt.within(Nt[v*this.stride],Nt[v*this.stride+1],K),Tt=[];for(let Bt of ut){let Jt=Bt*this.stride;Nt[Jt+4]===z&&Tt.push(Nt[Jt+5]>1?Le(Nt,Jt,this.clusterProps):this.points[Nt[Jt+3]])}if(Tt.length===0)throw new Error(dt);return Tt}getLeaves(z,v,O){let dt=[];return this._appendLeaves(dt,z,v=v||10,O=O||0,0),dt}getTile(z,v,O){let dt=this.trees[this._limitZoom(z)],rt=Math.pow(2,z),{extent:Nt,radius:K}=this.options,ut=K/Nt,Tt=(O-ut)/rt,Bt=(O+1+ut)/rt,Jt={features:[]};return this._addTileFeatures(dt.range((v-ut)/rt,Tt,(v+1+ut)/rt,Bt),dt.data,v,O,rt,Jt),v===0&&this._addTileFeatures(dt.range(1-ut/rt,Tt,1,Bt),dt.data,rt,O,rt,Jt),v===rt-1&&this._addTileFeatures(dt.range(0,Tt,ut/rt,Bt),dt.data,-1,O,rt,Jt),Jt.features.length?Jt:null}getClusterExpansionZoom(z){let v=this._getOriginZoom(z)-1;for(;v<=this.options.maxZoom;){let O=this.getChildren(z);if(v++,O.length!==1)break;z=O[0].properties.cluster_id}return v}_appendLeaves(z,v,O,dt,rt){let Nt=this.getChildren(v);for(let K of Nt){let ut=K.properties;if(ut&&ut.cluster?rt+ut.point_count<=dt?rt+=ut.point_count:rt=this._appendLeaves(z,ut.cluster_id,O,dt,rt):rt<dt?rt++:z.push(K),z.length===O)break}return rt}_createTree(z){let v=new I.aS(z.length/this.stride|0,this.options.nodeSize,Float32Array);for(let O=0;O<z.length;O+=this.stride)v.add(z[O],z[O+1]);return v.finish(),v.data=z,v}_addTileFeatures(z,v,O,dt,rt,Nt){for(let K of z){let ut=K*this.stride,Tt=v[ut+5]>1,Bt,Jt,le;if(Tt)Bt=Yl(v,ut,this.clusterProps),Jt=v[ut],le=v[ut+1];else{let Ti=this.points[v[ut+3]];Bt=Ti.properties;let[Ae,Oe]=Ti.geometry.coordinates;Jt=ol(Ae),le=ba(Oe)}let he={type:1,geometry:[[Math.round(this.options.extent*(Jt*rt-O)),Math.round(this.options.extent*(le*rt-dt))]],tags:Bt},Be;Be=Tt||this.options.generateId?v[ut+3]:this.points[v[ut+3]].id,Be!==void 0&&(he.id=Be),Nt.features.push(he)}}_limitZoom(z){return Math.max(this.options.minZoom,Math.min(Math.floor(+z),this.options.maxZoom+1))}_cluster(z,v){let{radius:O,extent:dt,reduce:rt,minPoints:Nt}=this.options,K=O/(dt*Math.pow(2,v)),ut=z.data,Tt=[],Bt=this.stride;for(let Jt=0;Jt<ut.length;Jt+=Bt){if(ut[Jt+2]<=v)continue;ut[Jt+2]=v;let le=ut[Jt],he=ut[Jt+1],Be=z.within(ut[Jt],ut[Jt+1],K),Ti=ut[Jt+5],Ae=Ti;for(let Oe of Be){let ai=Oe*Bt;ut[ai+2]>v&&(Ae+=ut[ai+5])}if(Ae>Ti&&Ae>=Nt){let Oe,ai=le*Ti,ft=he*Ti,oi=-1,hi=(Jt/Bt<<5)+(v+1)+this.points.length;for(let tl of Be){let Zi=tl*Bt;if(ut[Zi+2]<=v)continue;ut[Zi+2]=v;let Ot=ut[Zi+5];ai+=ut[Zi]*Ot,ft+=ut[Zi+1]*Ot,ut[Zi+4]=hi,rt&&(Oe||(Oe=this._map(ut,Jt,!0),oi=this.clusterProps.length,this.clusterProps.push(Oe)),rt(Oe,this._map(ut,Zi)))}ut[Jt+4]=hi,Tt.push(ai/Ae,ft/Ae,1/0,hi,-1,Ae),rt&&Tt.push(oi)}else{for(let Oe=0;Oe<Bt;Oe++)Tt.push(ut[Jt+Oe]);if(Ae>1)for(let Oe of Be){let ai=Oe*Bt;if(!(ut[ai+2]<=v)){ut[ai+2]=v;for(let ft=0;ft<Bt;ft++)Tt.push(ut[ai+ft])}}}}return Tt}_getOriginId(z){return z-this.points.length>>5}_getOriginZoom(z){return(z-this.points.length)%32}_map(z,v,O){if(z[v+5]>1){let Nt=this.clusterProps[z[v+6]];return O?Object.assign({},Nt):Nt}let dt=this.points[z[v+3]].properties,rt=this.options.map(dt);return O&&rt===dt?Object.assign({},rt):rt}}function Le(ht,z,v){return{type:"Feature",id:ht[z+3],properties:Yl(ht,z,v),geometry:{type:"Point",coordinates:[(O=ht[z],360*(O-.5)),dn(ht[z+1])]}};var O}function Yl(ht,z,v){let O=ht[z+5],dt=O>=1e4?`${Math.round(O/1e3)}k`:O>=1e3?Math.round(O/100)/10+"k":O,rt=ht[z+6],Nt=rt===-1?{}:Object.assign({},v[rt]);return Object.assign(Nt,{cluster:!0,cluster_id:ht[z+3],point_count:O,point_count_abbreviated:dt})}function ol(ht){return ht/360+.5}function ba(ht){let z=Math.sin(ht*Math.PI/180),v=.5-.25*Math.log((1+z)/(1-z))/Math.PI;return v<0?0:v>1?1:v}function dn(ht){let z=(180-360*ht)*Math.PI/180;return 360*Math.atan(Math.exp(z))/Math.PI-90}function xl(ht,z,v,O){let dt=O,rt=z+(v-z>>1),Nt,K=v-z,ut=ht[z],Tt=ht[z+1],Bt=ht[v],Jt=ht[v+1];for(let le=z+3;le<v;le+=3){let he=_l(ht[le],ht[le+1],ut,Tt,Bt,Jt);if(he>dt)Nt=le,dt=he;else if(he===dt){let Be=Math.abs(le-rt);Be<K&&(Nt=le,K=Be)}}dt>O&&(Nt-z>3&&xl(ht,z,Nt,O),ht[Nt+2]=dt,v-Nt>3&&xl(ht,Nt,v,O))}function _l(ht,z,v,O,dt,rt){let Nt=dt-v,K=rt-O;if(Nt!==0||K!==0){let ut=((ht-v)*Nt+(z-O)*K)/(Nt*Nt+K*K);ut>1?(v=dt,O=rt):ut>0&&(v+=Nt*ut,O+=K*ut)}return Nt=ht-v,K=z-O,Nt*Nt+K*K}function Ci(ht,z,v,O){let dt={id:ht??null,type:z,geometry:v,tags:O,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(z==="Point"||z==="MultiPoint"||z==="LineString")qi(dt,v);else if(z==="Polygon")qi(dt,v[0]);else if(z==="MultiLineString")for(let rt of v)qi(dt,rt);else if(z==="MultiPolygon")for(let rt of v)qi(dt,rt[0]);return dt}function qi(ht,z){for(let v=0;v<z.length;v+=3)ht.minX=Math.min(ht.minX,z[v]),ht.minY=Math.min(ht.minY,z[v+1]),ht.maxX=Math.max(ht.maxX,z[v]),ht.maxY=Math.max(ht.maxY,z[v+1])}function ki(ht,z,v,O){if(!z.geometry)return;let dt=z.geometry.coordinates;if(dt&&dt.length===0)return;let rt=z.geometry.type,Nt=Math.pow(v.tolerance/((1<<v.maxZoom)*v.extent),2),K=[],ut=z.id;if(v.promoteId?ut=z.properties[v.promoteId]:v.generateId&&(ut=O||0),rt==="Point")Sa(dt,K);else if(rt==="MultiPoint")for(let Tt of dt)Sa(Tt,K);else if(rt==="LineString")Fl(dt,K,Nt,!1);else if(rt==="MultiLineString"){if(v.lineMetrics){for(let Tt of dt)K=[],Fl(Tt,K,Nt,!1),ht.push(Ci(ut,"LineString",K,z.properties));return}$i(dt,K,Nt,!1)}else if(rt==="Polygon")$i(dt,K,Nt,!0);else{if(rt!=="MultiPolygon"){if(rt==="GeometryCollection"){for(let Tt of z.geometry.geometries)ki(ht,{id:ut,geometry:Tt,properties:z.properties},v,O);return}throw new Error("Input data is not a valid GeoJSON object.")}for(let Tt of dt){let Bt=[];$i(Tt,Bt,Nt,!0),K.push(Bt)}}ht.push(Ci(ut,rt,K,z.properties))}function Sa(ht,z){z.push(Pl(ht[0]),Kl(ht[1]),0)}function Fl(ht,z,v,O){let dt,rt,Nt=0;for(let ut=0;ut<ht.length;ut++){let Tt=Pl(ht[ut][0]),Bt=Kl(ht[ut][1]);z.push(Tt,Bt,0),ut>0&&(Nt+=O?(dt*Bt-Tt*rt)/2:Math.sqrt(Math.pow(Tt-dt,2)+Math.pow(Bt-rt,2))),dt=Tt,rt=Bt}let K=z.length-3;z[2]=1,xl(z,0,K,v),z[K+2]=1,z.size=Math.abs(Nt),z.start=0,z.end=z.size}function $i(ht,z,v,O){for(let dt=0;dt<ht.length;dt++){let rt=[];Fl(ht[dt],rt,v,O),z.push(rt)}}function Pl(ht){return ht/360+.5}function Kl(ht){let z=Math.sin(ht*Math.PI/180),v=.5-.25*Math.log((1+z)/(1-z))/Math.PI;return v<0?0:v>1?1:v}function ci(ht,z,v,O,dt,rt,Nt,K){if(O/=z,rt>=(v/=z)&&Nt<O)return ht;if(Nt<v||rt>=O)return null;let ut=[];for(let Tt of ht){let Bt=Tt.geometry,Jt=Tt.type,le=dt===0?Tt.minX:Tt.minY,he=dt===0?Tt.maxX:Tt.maxY;if(le>=v&&he<O){ut.push(Tt);continue}if(he<v||le>=O)continue;let Be=[];if(Jt==="Point"||Jt==="MultiPoint")El(Bt,Be,v,O,dt);else if(Jt==="LineString")Na(Bt,Be,v,O,dt,!1,K.lineMetrics);else if(Jt==="MultiLineString")Tl(Bt,Be,v,O,dt,!1);else if(Jt==="Polygon")Tl(Bt,Be,v,O,dt,!0);else if(Jt==="MultiPolygon")for(let Ti of Bt){let Ae=[];Tl(Ti,Ae,v,O,dt,!0),Ae.length&&Be.push(Ae)}if(Be.length){if(K.lineMetrics&&Jt==="LineString"){for(let Ti of Be)ut.push(Ci(Tt.id,Jt,Ti,Tt.tags));continue}Jt!=="LineString"&&Jt!=="MultiLineString"||(Be.length===1?(Jt="LineString",Be=Be[0]):Jt="MultiLineString"),Jt!=="Point"&&Jt!=="MultiPoint"||(Jt=Be.length===3?"Point":"MultiPoint"),ut.push(Ci(Tt.id,Jt,Be,Tt.tags))}}return ut.length?ut:null}function El(ht,z,v,O,dt){for(let rt=0;rt<ht.length;rt+=3){let Nt=ht[rt+dt];Nt>=v&&Nt<=O&&wi(z,ht[rt],ht[rt+1],ht[rt+2])}}function Na(ht,z,v,O,dt,rt,Nt){let K=si(ht),ut=dt===0?Rn:Ha,Tt,Bt,Jt=ht.start;for(let Ae=0;Ae<ht.length-3;Ae+=3){let Oe=ht[Ae],ai=ht[Ae+1],ft=ht[Ae+2],oi=ht[Ae+3],hi=ht[Ae+4],tl=dt===0?Oe:ai,Zi=dt===0?oi:hi,Ot=!1;Nt&&(Tt=Math.sqrt(Math.pow(Oe-oi,2)+Math.pow(ai-hi,2))),tl<v?Zi>v&&(Bt=ut(K,Oe,ai,oi,hi,v),Nt&&(K.start=Jt+Tt*Bt)):tl>O?Zi<O&&(Bt=ut(K,Oe,ai,oi,hi,O),Nt&&(K.start=Jt+Tt*Bt)):wi(K,Oe,ai,ft),Zi<v&&tl>=v&&(Bt=ut(K,Oe,ai,oi,hi,v),Ot=!0),Zi>O&&tl<=O&&(Bt=ut(K,Oe,ai,oi,hi,O),Ot=!0),!rt&&Ot&&(Nt&&(K.end=Jt+Tt*Bt),z.push(K),K=si(ht)),Nt&&(Jt+=Tt)}let le=ht.length-3,he=ht[le],Be=ht[le+1],Ti=dt===0?he:Be;Ti>=v&&Ti<=O&&wi(K,he,Be,ht[le+2]),le=K.length-3,rt&&le>=3&&(K[le]!==K[0]||K[le+1]!==K[1])&&wi(K,K[0],K[1],K[2]),K.length&&z.push(K)}function si(ht){let z=[];return z.size=ht.size,z.start=ht.start,z.end=ht.end,z}function Tl(ht,z,v,O,dt,rt){for(let Nt of ht)Na(Nt,z,v,O,dt,rt,!1)}function wi(ht,z,v,O){ht.push(z,v,O)}function Rn(ht,z,v,O,dt,rt){let Nt=(rt-z)/(O-z);return wi(ht,rt,v+(dt-v)*Nt,1),Nt}function Ha(ht,z,v,O,dt,rt){let Nt=(rt-v)/(dt-v);return wi(ht,z+(O-z)*Nt,rt,1),Nt}function hl(ht,z){let v=[];for(let O=0;O<ht.length;O++){let dt=ht[O],rt=dt.type,Nt;if(rt==="Point"||rt==="MultiPoint"||rt==="LineString")Nt=Qi(dt.geometry,z);else if(rt==="MultiLineString"||rt==="Polygon"){Nt=[];for(let K of dt.geometry)Nt.push(Qi(K,z))}else if(rt==="MultiPolygon"){Nt=[];for(let K of dt.geometry){let ut=[];for(let Tt of K)ut.push(Qi(Tt,z));Nt.push(ut)}}v.push(Ci(dt.id,rt,Nt,dt.tags))}return v}function Qi(ht,z){let v=[];v.size=ht.size,ht.start!==void 0&&(v.start=ht.start,v.end=ht.end);for(let O=0;O<ht.length;O+=3)v.push(ht[O]+z,ht[O+1],ht[O+2]);return v}function ql(ht,z){if(ht.transformed)return ht;let v=1<<ht.z,O=ht.x,dt=ht.y;for(let rt of ht.features){let Nt=rt.geometry,K=rt.type;if(rt.geometry=[],K===1)for(let ut=0;ut<Nt.length;ut+=2)rt.geometry.push(vi(Nt[ut],Nt[ut+1],z,v,O,dt));else for(let ut=0;ut<Nt.length;ut++){let Tt=[];for(let Bt=0;Bt<Nt[ut].length;Bt+=2)Tt.push(vi(Nt[ut][Bt],Nt[ut][Bt+1],z,v,O,dt));rt.geometry.push(Tt)}}return ht.transformed=!0,ht}function vi(ht,z,v,O,dt,rt){return[Math.round(v*(ht*O-dt)),Math.round(v*(z*O-rt))]}function We(ht,z,v,O,dt){let rt=z===dt.maxZoom?0:dt.tolerance/((1<<z)*dt.extent),Nt={features:[],numPoints:0,numSimplified:0,numFeatures:ht.length,source:null,x:v,y:O,z,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(let K of ht)Hi(Nt,K,rt,dt);return Nt}function Hi(ht,z,v,O){let dt=z.geometry,rt=z.type,Nt=[];if(ht.minX=Math.min(ht.minX,z.minX),ht.minY=Math.min(ht.minY,z.minY),ht.maxX=Math.max(ht.maxX,z.maxX),ht.maxY=Math.max(ht.maxY,z.maxY),rt==="Point"||rt==="MultiPoint")for(let K=0;K<dt.length;K+=3)Nt.push(dt[K],dt[K+1]),ht.numPoints++,ht.numSimplified++;else if(rt==="LineString")Da(Nt,dt,ht,v,!1,!1);else if(rt==="MultiLineString"||rt==="Polygon")for(let K=0;K<dt.length;K++)Da(Nt,dt[K],ht,v,rt==="Polygon",K===0);else if(rt==="MultiPolygon")for(let K=0;K<dt.length;K++){let ut=dt[K];for(let Tt=0;Tt<ut.length;Tt++)Da(Nt,ut[Tt],ht,v,!0,Tt===0)}if(Nt.length){let K=z.tags||null;if(rt==="LineString"&&O.lineMetrics){K={};for(let Tt in z.tags)K[Tt]=z.tags[Tt];K.mapbox_clip_start=dt.start/dt.size,K.mapbox_clip_end=dt.end/dt.size}let ut={geometry:Nt,type:rt==="Polygon"||rt==="MultiPolygon"?3:rt==="LineString"||rt==="MultiLineString"?2:1,tags:K};z.id!==null&&(ut.id=z.id),ht.features.push(ut)}}function Da(ht,z,v,O,dt,rt){let Nt=O*O;if(O>0&&z.size<(dt?Nt:O))return void(v.numPoints+=z.length/3);let K=[];for(let ut=0;ut<z.length;ut+=3)(O===0||z[ut+2]>Nt)&&(v.numSimplified++,K.push(z[ut],z[ut+1])),v.numPoints++;dt&&(function(ut,Tt){let Bt=0;for(let Jt=0,le=ut.length,he=le-2;Jt<le;he=Jt,Jt+=2)Bt+=(ut[Jt]-ut[he])*(ut[Jt+1]+ut[he+1]);if(Bt>0===Tt)for(let Jt=0,le=ut.length;Jt<le/2;Jt+=2){let he=ut[Jt],Be=ut[Jt+1];ut[Jt]=ut[le-2-Jt],ut[Jt+1]=ut[le-1-Jt],ut[le-2-Jt]=he,ut[le-1-Jt]=Be}})(K,rt),ht.push(K)}let cn={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class Ca{constructor(z,v){let O=(v=this.options=(function(rt,Nt){for(let K in Nt)rt[K]=Nt[K];return rt})(Object.create(cn),v)).debug;if(O&&console.time("preprocess data"),v.maxZoom<0||v.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(v.promoteId&&v.generateId)throw new Error("promoteId and generateId cannot be used together.");let dt=(function(rt,Nt){let K=[];if(rt.type==="FeatureCollection")for(let ut=0;ut<rt.features.length;ut++)ki(K,rt.features[ut],Nt,ut);else ki(K,rt.type==="Feature"?rt:{geometry:rt},Nt);return K})(z,v);this.tiles={},this.tileCoords=[],O&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",v.indexMaxZoom,v.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),dt=(function(rt,Nt){let K=Nt.buffer/Nt.extent,ut=rt,Tt=ci(rt,1,-1-K,K,0,-1,2,Nt),Bt=ci(rt,1,1-K,2+K,0,-1,2,Nt);return(Tt||Bt)&&(ut=ci(rt,1,-K,1+K,0,-1,2,Nt)||[],Tt&&(ut=hl(Tt,1).concat(ut)),Bt&&(ut=ut.concat(hl(Bt,-1)))),ut})(dt,v),dt.length&&this.splitTile(dt,0,0,0),O&&(dt.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(z,v,O,dt,rt,Nt,K){let ut=[z,v,O,dt],Tt=this.options,Bt=Tt.debug;for(;ut.length;){dt=ut.pop(),O=ut.pop(),v=ut.pop(),z=ut.pop();let Jt=1<<v,le=En(v,O,dt),he=this.tiles[le];if(!he&&(Bt>1&&console.time("creation"),he=this.tiles[le]=We(z,v,O,dt,Tt),this.tileCoords.push({z:v,x:O,y:dt}),Bt)){Bt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",v,O,dt,he.numFeatures,he.numPoints,he.numSimplified),console.timeEnd("creation"));let Ot=`z${v}`;this.stats[Ot]=(this.stats[Ot]||0)+1,this.total++}if(he.source=z,rt==null){if(v===Tt.indexMaxZoom||he.numPoints<=Tt.indexMaxPoints)continue}else{if(v===Tt.maxZoom||v===rt)continue;if(rt!=null){let Ot=rt-v;if(O!==Nt>>Ot||dt!==K>>Ot)continue}}if(he.source=null,z.length===0)continue;Bt>1&&console.time("clipping");let Be=.5*Tt.buffer/Tt.extent,Ti=.5-Be,Ae=.5+Be,Oe=1+Be,ai=null,ft=null,oi=null,hi=null,tl=ci(z,Jt,O-Be,O+Ae,0,he.minX,he.maxX,Tt),Zi=ci(z,Jt,O+Ti,O+Oe,0,he.minX,he.maxX,Tt);z=null,tl&&(ai=ci(tl,Jt,dt-Be,dt+Ae,1,he.minY,he.maxY,Tt),ft=ci(tl,Jt,dt+Ti,dt+Oe,1,he.minY,he.maxY,Tt),tl=null),Zi&&(oi=ci(Zi,Jt,dt-Be,dt+Ae,1,he.minY,he.maxY,Tt),hi=ci(Zi,Jt,dt+Ti,dt+Oe,1,he.minY,he.maxY,Tt),Zi=null),Bt>1&&console.timeEnd("clipping"),ut.push(ai||[],v+1,2*O,2*dt),ut.push(ft||[],v+1,2*O,2*dt+1),ut.push(oi||[],v+1,2*O+1,2*dt),ut.push(hi||[],v+1,2*O+1,2*dt+1)}}getTile(z,v,O){z=+z,v=+v,O=+O;let dt=this.options,{extent:rt,debug:Nt}=dt;if(z<0||z>24)return null;let K=1<<z,ut=En(z,v=v+K&K-1,O);if(this.tiles[ut])return ql(this.tiles[ut],rt);Nt>1&&console.log("drilling down to z%d-%d-%d",z,v,O);let Tt,Bt=z,Jt=v,le=O;for(;!Tt&&Bt>0;)Bt--,Jt>>=1,le>>=1,Tt=this.tiles[En(Bt,Jt,le)];return Tt&&Tt.source?(Nt>1&&(console.log("found parent tile z%d-%d-%d",Bt,Jt,le),console.time("drilling down")),this.splitTile(Tt.source,Bt,Jt,le,z,v,O),Nt>1&&console.timeEnd("drilling down"),this.tiles[ut]?ql(this.tiles[ut],rt):null):null}}function En(ht,z,v){return 32*((1<<ht)*v+z)+ht}class Fn extends ii{constructor(z,v,O,dt=zl){super(z,v,O),this._dataUpdateable=new Map,this._createGeoJSONIndex=dt}loadVectorTile(z,v){return I._(this,void 0,void 0,(function*(){let O=z.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");let dt=this._geoJSONIndex.getTile(O.z,O.x,O.y);return dt?je(new ee(dt.features,{version:2,extent:I.a4})):null}))}loadData(z){return I._(this,void 0,void 0,(function*(){var v;(v=this._pendingRequest)===null||v===void 0||v.abort();let O=this._startPerformance(z);this._pendingRequest=new AbortController;try{(!this._pendingData||z.request||z.data||z.dataDiff)&&(this._pendingData=this.loadAndProcessGeoJSON(z,this._pendingRequest));let dt=yield this._pendingData;this._geoJSONIndex=this._createGeoJSONIndex(dt,z),this.loaded={};let rt=z.dataDiff&&I.a6(dt)?{applyDiff:!0}:{data:dt};return this._finishPerformance(O,z,rt),rt}catch(dt){if(delete this._pendingRequest,I.cH(dt))return{abandoned:!0};throw dt}}))}_startPerformance(z){var v;if(!((v=z?.request)===null||v===void 0)&&v.collectResourceTiming)return new I.c$(z.request)}_finishPerformance(z,v,O){if(!z)return;let dt=z.finish();dt&&(O.resourceTiming={},O.resourceTiming[v.source]=JSON.parse(JSON.stringify(dt)))}getData(){return I._(this,void 0,void 0,(function*(){return this._pendingData}))}reloadTile(z){let v=this.loaded;return v&&v[z.uid]?super.reloadTile(z):this.loadTile(z)}loadAndProcessGeoJSON(z,v){return I._(this,void 0,void 0,(function*(){let O;if(z.request?O=yield this.loadGeoJSONFromUrl(z.request,z.promoteId,v):z.data?O=this._loadGeoJSONFromObject(z.data,z.promoteId):z.dataDiff&&(O=this._loadGeoJSONFromDiff(z.dataDiff,z.promoteId,z.source)),delete this._pendingRequest,typeof O!="object")throw new Error(`Input data given to '${z.source}' is not a valid GeoJSON object.`);return Qe(O,!0),z.filter&&(O=this._filterGeoJSON(O,z.filter)),O}))}loadGeoJSONFromUrl(z,v,O){return I._(this,void 0,void 0,(function*(){let dt=yield I.j(z,O);return this._dataUpdateable=I.a6(dt.data,v)?I.a7(dt.data,v):void 0,dt.data}))}_loadGeoJSONFromObject(z,v){return this._dataUpdateable=I.a6(z,v)?I.a7(z,v):void 0,z}_loadGeoJSONFromDiff(z,v,O){if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${O}`);I.a8(this._dataUpdateable,z,v);let dt=Array.from(this._dataUpdateable.values());return this._toFeatureCollection(dt)}_filterGeoJSON(z,v){let O=I.d3(v,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(O.result==="error")throw new Error(O.value.map((rt=>`${rt.key}: ${rt.message}`)).join(", "));let dt=z.features.filter((rt=>O.value.evaluate({zoom:0},rt)));return this._toFeatureCollection(dt)}_toFeatureCollection(z){return{type:"FeatureCollection",features:z}}removeSource(z){return I._(this,void 0,void 0,(function*(){this._pendingRequest&&this._pendingRequest.abort()}))}getClusterExpansionZoom(z){return this._geoJSONIndex.getClusterExpansionZoom(z.clusterId)}getClusterChildren(z){return this._geoJSONIndex.getChildren(z.clusterId)}getClusterLeaves(z){return this._geoJSONIndex.getLeaves(z.clusterId,z.limit,z.offset)}}function zl(ht,z){return z.cluster?new Ri((function({superclusterOptions:v,clusterProperties:O}){if(!O||!v)return v;let dt={},rt={},Nt={accumulated:null,zoom:0},K={properties:null},ut=Object.keys(O);for(let Tt of ut){let[Bt,Jt]=O[Tt],le=I.d3(Jt),he=I.d3(typeof Bt=="string"?[Bt,["accumulated"],["get",Tt]]:Bt);dt[Tt]=le.value,rt[Tt]=he.value}return v.map=Tt=>{K.properties=Tt;let Bt={};for(let Jt of ut)Bt[Jt]=dt[Jt].evaluate(Nt,K);return Bt},v.reduce=(Tt,Bt)=>{K.properties=Bt;for(let Jt of ut)Nt.accumulated=Tt[Jt],Tt[Jt]=rt[Jt].evaluate(Nt,K)},v})(z)).load(ht.features):(function(v,O){return new Ca(v,O)})(ht,z.geojsonVtOptions)}class Di{constructor(z){this.self=z,this.actor=new I.L(z),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.globalStates=new Map,this.self.registerWorkerSource=(v,O)=>{if(this.externalWorkerSourceTypes[v])throw new Error(`Worker source with name "${v}" already registered.`);this.externalWorkerSourceTypes[v]=O},this.self.addProtocol=I.cJ,this.self.removeProtocol=I.cK,this.self.registerRTLTextPlugin=v=>{I.d4.setMethods(v)},this.actor.registerMessageHandler("LDT",((v,O)=>this._getDEMWorkerSource(v,O.source).loadTile(O))),this.actor.registerMessageHandler("RDT",((v,O)=>I._(this,void 0,void 0,(function*(){this._getDEMWorkerSource(v,O.source).removeTile(O)})))),this.actor.registerMessageHandler("GCEZ",((v,O)=>I._(this,void 0,void 0,(function*(){return this._getWorkerSource(v,O.type,O.source).getClusterExpansionZoom(O)})))),this.actor.registerMessageHandler("GCC",((v,O)=>I._(this,void 0,void 0,(function*(){return this._getWorkerSource(v,O.type,O.source).getClusterChildren(O)})))),this.actor.registerMessageHandler("GCL",((v,O)=>I._(this,void 0,void 0,(function*(){return this._getWorkerSource(v,O.type,O.source).getClusterLeaves(O)})))),this.actor.registerMessageHandler("LD",((v,O)=>this._getWorkerSource(v,O.type,O.source).loadData(O))),this.actor.registerMessageHandler("GD",((v,O)=>this._getWorkerSource(v,O.type,O.source).getData())),this.actor.registerMessageHandler("LT",((v,O)=>this._getWorkerSource(v,O.type,O.source).loadTile(O))),this.actor.registerMessageHandler("RT",((v,O)=>this._getWorkerSource(v,O.type,O.source).reloadTile(O))),this.actor.registerMessageHandler("AT",((v,O)=>this._getWorkerSource(v,O.type,O.source).abortTile(O))),this.actor.registerMessageHandler("RMT",((v,O)=>this._getWorkerSource(v,O.type,O.source).removeTile(O))),this.actor.registerMessageHandler("RS",((v,O)=>I._(this,void 0,void 0,(function*(){if(!this.workerSources[v]||!this.workerSources[v][O.type]||!this.workerSources[v][O.type][O.source])return;let dt=this.workerSources[v][O.type][O.source];delete this.workerSources[v][O.type][O.source],dt.removeSource!==void 0&&dt.removeSource(O)})))),this.actor.registerMessageHandler("RM",(v=>I._(this,void 0,void 0,(function*(){delete this.layerIndexes[v],delete this.availableImages[v],delete this.workerSources[v],delete this.demWorkerSources[v],this.globalStates.delete(v)})))),this.actor.registerMessageHandler("SR",((v,O)=>I._(this,void 0,void 0,(function*(){this.referrer=O})))),this.actor.registerMessageHandler("SRPS",((v,O)=>this._syncRTLPluginState(v,O))),this.actor.registerMessageHandler("IS",((v,O)=>I._(this,void 0,void 0,(function*(){this.self.importScripts(O)})))),this.actor.registerMessageHandler("SI",((v,O)=>this._setImages(v,O))),this.actor.registerMessageHandler("UL",((v,O)=>I._(this,void 0,void 0,(function*(){this._getLayerIndex(v).update(O.layers,O.removedIds,this._getGlobalState(v))})))),this.actor.registerMessageHandler("UGS",((v,O)=>I._(this,void 0,void 0,(function*(){let dt=this._getGlobalState(v);for(let rt in O)dt[rt]=O[rt]})))),this.actor.registerMessageHandler("SL",((v,O)=>I._(this,void 0,void 0,(function*(){this._getLayerIndex(v).replace(O,this._getGlobalState(v))}))))}_getGlobalState(z){let v=this.globalStates.get(z);return v||(v={},this.globalStates.set(z,v)),v}_setImages(z,v){return I._(this,void 0,void 0,(function*(){this.availableImages[z]=v;for(let O in this.workerSources[z]){let dt=this.workerSources[z][O];for(let rt in dt)dt[rt].availableImages=v}}))}_syncRTLPluginState(z,v){return I._(this,void 0,void 0,(function*(){return yield I.d4.syncState(v,this.self.importScripts)}))}_getAvailableImages(z){let v=this.availableImages[z];return v||(v=[]),v}_getLayerIndex(z){let v=this.layerIndexes[z];return v||(v=this.layerIndexes[z]=new o),v}_getWorkerSource(z,v,O){if(this.workerSources[z]||(this.workerSources[z]={}),this.workerSources[z][v]||(this.workerSources[z][v]={}),!this.workerSources[z][v][O]){let dt={sendAsync:(rt,Nt)=>(rt.targetMapId=z,this.actor.sendAsync(rt,Nt))};switch(v){case"vector":this.workerSources[z][v][O]=new ii(dt,this._getLayerIndex(z),this._getAvailableImages(z));break;case"geojson":this.workerSources[z][v][O]=new Fn(dt,this._getLayerIndex(z),this._getAvailableImages(z));break;default:this.workerSources[z][v][O]=new this.externalWorkerSourceTypes[v](dt,this._getLayerIndex(z),this._getAvailableImages(z))}}return this.workerSources[z][v][O]}_getDEMWorkerSource(z,v){return this.demWorkerSources[z]||(this.demWorkerSources[z]={}),this.demWorkerSources[z][v]||(this.demWorkerSources[z][v]=new Me),this.demWorkerSources[z][v]}}return I.i(self)&&(self.worker=new Di(self)),Di})),Y("index",["exports","./shared"],(function(I,o){"use strict";var st="5.13.0";function Ct(){var m=new o.A(4);return o.A!=Float32Array&&(m[1]=0,m[2]=0),m[0]=1,m[3]=1,m}let vt,de,ee,ge={frame(m,e,a){let c=requestAnimationFrame((W=>{s(),e(W)})),{unsubscribe:s}=o.s(m.signal,"abort",(()=>{s(),cancelAnimationFrame(c),a(o.c())}),!1)},frameAsync(m){return new Promise(((e,a)=>{this.frame(m,e,a)}))},getImageData(m,e=0){return this.getImageCanvasContext(m).getImageData(-e,-e,m.width+2*e,m.height+2*e)},getImageCanvasContext(m){let e=window.document.createElement("canvas"),a=e.getContext("2d",{willReadFrequently:!0});if(!a)throw new Error("failed to create canvas 2d context");return e.width=m.width,e.height=m.height,a.drawImage(m,0,0,m.width,m.height),a},resolveURL:m=>(vt||(vt=document.createElement("a")),vt.href=m,vt.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return ee!==void 0?ee:!!matchMedia&&(de==null&&(de=matchMedia("(prefers-reduced-motion: reduce)")),de.matches)},set prefersReducedMotion(m){ee=m}},ye=new class{constructor(){this._realTime=typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),this._frozenAt=null}getCurrentTime(){return this._frozenAt!==null?this._frozenAt:this._realTime()}setNow(m){this._frozenAt=m}restoreNow(){this._frozenAt=null}isFrozen(){return this._frozenAt!==null}};function jt(){return ye.getCurrentTime()}class gt{static testProp(e){if(!gt.docStyle)return e[0];for(let a=0;a<e.length;a++)if(e[a]in gt.docStyle)return e[a];return e[0]}static create(e,a,c){let s=window.document.createElement(e);return a!==void 0&&(s.className=a),c&&c.appendChild(s),s}static createNS(e,a){return window.document.createElementNS(e,a)}static disableDrag(){gt.docStyle&&gt.selectProp&&(gt.userSelect=gt.docStyle[gt.selectProp],gt.docStyle[gt.selectProp]="none")}static enableDrag(){gt.docStyle&&gt.selectProp&&(gt.docStyle[gt.selectProp]=gt.userSelect)}static setTransform(e,a){e.style[gt.transformProp]=a}static addEventListener(e,a,c,s={}){e.addEventListener(a,c,"passive"in s?s:s.capture)}static removeEventListener(e,a,c,s={}){e.removeEventListener(a,c,"passive"in s?s:s.capture)}static suppressClickInternal(e){e.preventDefault(),e.stopPropagation(),window.removeEventListener("click",gt.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",gt.suppressClickInternal,!0),window.setTimeout((()=>{window.removeEventListener("click",gt.suppressClickInternal,!0)}),0)}static getScale(e){let a=e.getBoundingClientRect();return{x:a.width/e.offsetWidth||1,y:a.height/e.offsetHeight||1,boundingClientRect:a}}static getPoint(e,a,c){let s=a.boundingClientRect;return new o.P((c.clientX-s.left)/a.x-e.clientLeft,(c.clientY-s.top)/a.y-e.clientTop)}static mousePos(e,a){let c=gt.getScale(e);return gt.getPoint(e,c,a)}static touchPos(e,a){let c=[],s=gt.getScale(e);for(let W=0;W<a.length;W++)c.push(gt.getPoint(e,s,a[W]));return c}static mouseButton(e){return e.button}static remove(e){e.parentNode&&e.parentNode.removeChild(e)}static sanitize(e){let a=new DOMParser().parseFromString(e,"text/html").body||document.createElement("body"),c=a.querySelectorAll("script");for(let s of c)s.remove();return gt.clean(a),a.innerHTML}static isPossiblyDangerous(e,a){let c=a.replace(/\s+/g,"").toLowerCase();return!(!["src","href","xlink:href"].includes(e)||!c.includes("javascript:")&&!c.includes("data:"))||!!e.startsWith("on")||void 0}static clean(e){let a=e.children;for(let c of a)gt.removeAttributes(c),gt.clean(c)}static removeAttributes(e){for(let{name:a,value:c}of e.attributes)gt.isPossiblyDangerous(a,c)&&e.removeAttribute(a)}}gt.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,gt.selectProp=gt.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),gt.transformProp=gt.testProp(["transform","WebkitTransform"]);let Ie={supported:!1,testSupport:function(m){!di&&Ue&&(li?ze(m):te=m)}},te,Ue,di=!1,li=!1;function ze(m){let e=m.createTexture();m.bindTexture(m.TEXTURE_2D,e);try{if(m.texImage2D(m.TEXTURE_2D,0,m.RGBA,m.RGBA,m.UNSIGNED_BYTE,Ue),m.isContextLost())return;Ie.supported=!0}catch{}m.deleteTexture(e),di=!0}var je;typeof document<"u"&&(Ue=document.createElement("img"),Ue.onload=()=>{te&&ze(te),te=null,li=!0},Ue.onerror=()=>{di=!0,te=null},Ue.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),(function(m){let e,a,c,s;m.resetRequestQueue=()=>{e=[],a=0,c=0,s={}},m.addThrottleControl=G=>{let U=c++;return s[U]=G,U},m.removeThrottleControl=G=>{delete s[G],Z()},m.getImage=(G,U,X=!0)=>new Promise(((Q,k)=>{Ie.supported&&(G.headers||(G.headers={}),G.headers.accept="image/webp,*/*"),o.e(G,{type:"image"}),e.push({abortController:U,requestParameters:G,supportImageRefresh:X,state:"queued",onError:j=>{k(j)},onSuccess:j=>{Q(j)}}),Z()}));let W=G=>o._(this,void 0,void 0,(function*(){G.state="running";let{requestParameters:U,supportImageRefresh:X,onError:Q,onSuccess:k,abortController:j}=G,H=X===!1&&!o.i(self)&&!o.g(U.url)&&(!U.headers||Object.keys(U.headers).reduce(((et,nt)=>et&&nt==="accept"),!0));a++;let q=H?u(U,j):o.m(U,j);try{let et=yield q;delete G.abortController,G.state="completed",et.data instanceof HTMLImageElement||o.b(et.data)?k(et):et.data&&k({data:yield($=et.data,typeof createImageBitmap=="function"?o.f($):o.h($)),cacheControl:et.cacheControl,expires:et.expires})}catch(et){delete G.abortController,Q(et)}finally{a--,Z()}var $})),Z=()=>{let G=(()=>{for(let U of Object.keys(s))if(s[U]())return!0;return!1})()?o.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:o.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let U=a;U<G&&e.length>0;U++){let X=e.shift();X.abortController.signal.aborted?U--:W(X)}},u=(G,U)=>new Promise(((X,Q)=>{let k=new Image,j=G.url,H=G.credentials;H&&H==="include"?k.crossOrigin="use-credentials":(H&&H==="same-origin"||!o.d(j))&&(k.crossOrigin="anonymous"),U.signal.addEventListener("abort",(()=>{k.src="",Q(o.c())})),k.fetchPriority="high",k.onload=()=>{k.onerror=k.onload=null,X({data:k})},k.onerror=()=>{k.onerror=k.onload=null,U.signal.aborted||Q(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},k.src=j}))})(je||(je={})),je.resetRequestQueue();class B{constructor(e){this._transformRequestFn=e??null}transformRequest(e,a){return this._transformRequestFn&&this._transformRequestFn(e,a)||{url:e}}setTransformRequest(e){this._transformRequestFn=e}}function ii(m){let e=[];if(typeof m=="string")e.push({id:"default",url:m});else if(m&&m.length>0){let a=[];for(let{id:c,url:s}of m){let W=`${c}${s}`;a.indexOf(W)===-1&&(a.push(W),e.push({id:c,url:s}))}}return e}function Me(m,e,a){try{let c=new URL(m);return c.pathname+=`${e}${a}`,c.toString()}catch{throw new Error(`Invalid sprite URL "${m}", must be absolute. Modify style specification directly or use TransformStyleFunction to correct the issue dynamically`)}}function ui(m){let{userImage:e}=m;return!!(e&&e.render&&e.render())&&(m.data.replace(new Uint8Array(e.data.buffer)),!0)}class ri extends o.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new o.R({width:1,height:1}),this.dirty=!0}destroy(){this.atlasTexture&&(this.atlasTexture.destroy(),this.atlasTexture=null);for(let e of Object.keys(this.images))this.removeImage(e);this.patterns={},this.atlasImage=new o.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(e){if(this.loaded!==e&&(this.loaded=e,e)){for(let{ids:a,promiseResolve:c}of this.requestors)c(this._getImagesForIds(a));this.requestors=[]}}getImage(e){let a=this.images[e];if(a&&!a.data&&a.spriteData){let c=a.spriteData;a.data=new o.R({width:c.width,height:c.height},c.context.getImageData(c.x,c.y,c.width,c.height).data),a.spriteData=null}return a}addImage(e,a){if(this.images[e])throw new Error(`Image id ${e} already exist, use updateImage instead`);this._validate(e,a)&&(this.images[e]=a)}_validate(e,a){let c=!0,s=a.data||a.spriteData;return this._validateStretch(a.stretchX,s&&s.width)||(this.fire(new o.k(new Error(`Image "${e}" has invalid "stretchX" value`))),c=!1),this._validateStretch(a.stretchY,s&&s.height)||(this.fire(new o.k(new Error(`Image "${e}" has invalid "stretchY" value`))),c=!1),this._validateContent(a.content,a)||(this.fire(new o.k(new Error(`Image "${e}" has invalid "content" value`))),c=!1),c}_validateStretch(e,a){if(!e)return!0;let c=0;for(let s of e){if(s[0]<c||s[1]<s[0]||a<s[1])return!1;c=s[1]}return!0}_validateContent(e,a){if(!e)return!0;if(e.length!==4)return!1;let c=a.spriteData,s=c&&c.width||a.data.width,W=c&&c.height||a.data.height;return!(e[0]<0||s<e[0]||e[1]<0||W<e[1]||e[2]<0||s<e[2]||e[3]<0||W<e[3]||e[2]<e[0]||e[3]<e[1])}updateImage(e,a,c=!0){let s=this.getImage(e);if(c&&(s.data.width!==a.data.width||s.data.height!==a.data.height))throw new Error(`size mismatch between old image (${s.data.width}x${s.data.height}) and new image (${a.data.width}x${a.data.height}).`);a.version=s.version+1,this.images[e]=a,this.updatedImages[e]=!0}removeImage(e){let a=this.images[e];delete this.images[e],delete this.patterns[e],a.userImage&&a.userImage.onRemove&&a.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(e){return new Promise(((a,c)=>{let s=!0;if(!this.isLoaded())for(let W of e)this.images[W]||(s=!1);this.isLoaded()||s?a(this._getImagesForIds(e)):this.requestors.push({ids:e,promiseResolve:a})}))}_getImagesForIds(e){let a={};for(let c of e){let s=this.getImage(c);s||(this.fire(new o.l("styleimagemissing",{id:c})),s=this.getImage(c)),s?a[c]={data:s.data.clone(),pixelRatio:s.pixelRatio,sdf:s.sdf,version:s.version,stretchX:s.stretchX,stretchY:s.stretchY,content:s.content,textFitWidth:s.textFitWidth,textFitHeight:s.textFitHeight,hasRenderCallback:!!(s.userImage&&s.userImage.render)}:o.w(`Image "${c}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return a}getPixelSize(){let{width:e,height:a}=this.atlasImage;return{width:e,height:a}}getPattern(e){let a=this.patterns[e],c=this.getImage(e);if(!c)return null;if(a&&a.position.version===c.version)return a.position;if(a)a.position.version=c.version;else{let s={w:c.data.width+2,h:c.data.height+2,x:0,y:0},W=new o.I(s,c);this.patterns[e]={bin:s,position:W}}return this._updatePatternAtlas(),this.patterns[e].position}bind(e){let a=e.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new o.T(e,this.atlasImage,a.RGBA),this.atlasTexture.bind(a.LINEAR,a.CLAMP_TO_EDGE)}_updatePatternAtlas(){let e=[];for(let W in this.patterns)e.push(this.patterns[W].bin);let{w:a,h:c}=o.p(e),s=this.atlasImage;s.resize({width:a||1,height:c||1});for(let W in this.patterns){let{bin:Z}=this.patterns[W],u=Z.x+1,G=Z.y+1,U=this.getImage(W).data,X=U.width,Q=U.height;o.R.copy(U,s,{x:0,y:0},{x:u,y:G},{width:X,height:Q}),o.R.copy(U,s,{x:0,y:Q-1},{x:u,y:G-1},{width:X,height:1}),o.R.copy(U,s,{x:0,y:0},{x:u,y:G+Q},{width:X,height:1}),o.R.copy(U,s,{x:X-1,y:0},{x:u-1,y:G},{width:1,height:Q}),o.R.copy(U,s,{x:0,y:0},{x:u+X,y:G},{width:1,height:Q})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(e){for(let a of e){if(this.callbackDispatchedThisFrame[a])continue;this.callbackDispatchedThisFrame[a]=!0;let c=this.getImage(a);c||o.w(`Image with ID: "${a}" was not found`),ui(c)&&this.updateImage(a,c)}}cloneImages(){let e={};for(let a in this.images){let c=this.images[a];e[a]=Object.assign(Object.assign({},c),{data:c.data?c.data.clone():null})}return e}}let xi=1e20;function Qe(m,e,a,c,s,W,Z,u,G){for(let U=e;U<e+c;U++)Ui(m,a*W+U,W,s,Z,u,G);for(let U=a;U<a+s;U++)Ui(m,U*W+e,1,c,Z,u,G)}function Ui(m,e,a,c,s,W,Z){W[0]=0,Z[0]=-xi,Z[1]=xi,s[0]=m[e];for(let u=1,G=0,U=0;u<c;u++){s[u]=m[e+u*a];let X=u*u;do{let Q=W[G];U=(s[u]-s[Q]+X-Q*Q)/(u-Q)/2}while(U<=Z[G]&&--G>-1);G++,W[G]=u,Z[G]=U,Z[G+1]=xi}for(let u=0,G=0;u<c;u++){for(;Z[G+1]<u;)G++;let U=W[G],X=u-U;m[e+u*a]=s[U]+X*X}}let sa=o.v.layout_symbol["text-font"].default.join(",");class cl{constructor(e,a,c){this.requestManager=e,this.localIdeographFontFamily=a,this.entries={},this.lang=c}setURL(e){this.url=e}getGlyphs(e){return o._(this,void 0,void 0,(function*(){let a=[];for(let W in e)for(let Z of e[W])a.push(this._getAndCacheGlyphsPromise(W,Z));let c=yield Promise.all(a),s={};for(let{stack:W,id:Z,glyph:u}of c)s[W]||(s[W]={}),s[W][Z]=u&&{id:u.id,bitmap:u.bitmap.clone(),metrics:u.metrics};return s}))}_getAndCacheGlyphsPromise(e,a){return o._(this,void 0,void 0,(function*(){let c=this.entries[e];c||(c=this.entries[e]={glyphs:{},requests:{},ranges:{}});let s=c.glyphs[a];return s!==void 0?{stack:e,id:a,glyph:s}:!this.url||this._charUsesLocalIdeographFontFamily(a)?(s=c.glyphs[a]=this._drawGlyph(c,e,a),{stack:e,id:a,glyph:s}):yield this._downloadAndCacheRangePromise(e,a)}))}_downloadAndCacheRangePromise(e,a){return o._(this,void 0,void 0,(function*(){let c=this.entries[e],s=Math.floor(a/256);if(c.ranges[s])return{stack:e,id:a,glyph:null};if(!c.requests[s]){let W=cl.loadGlyphRange(e,s,this.url,this.requestManager);c.requests[s]=W}try{let W=yield c.requests[s];for(let Z in W)c.glyphs[+Z]=W[+Z];return c.ranges[s]=!0,{stack:e,id:a,glyph:W[a]||null}}catch(W){let Z=c.glyphs[a]=this._drawGlyph(c,e,a);return this._warnOnMissingGlyphRange(Z,s,a,W),{stack:e,id:a,glyph:Z}}}))}_warnOnMissingGlyphRange(e,a,c,s){let W=256*a,Z=W+255,u=c.toString(16).padStart(4,"0").toUpperCase();o.w(`Unable to load glyph range ${a}, ${W}-${Z}. Rendering codepoint U+${u} locally instead. ${s}`)}_charUsesLocalIdeographFontFamily(e){return!!this.localIdeographFontFamily&&o.q(e)}_drawGlyph(e,a,c){let s=a===sa&&this.localIdeographFontFamily!==""&&this._charUsesLocalIdeographFontFamily(c),W=s?"ideographTinySDF":"tinySDF";e[W]||(e[W]=this._createTinySDF(s?this.localIdeographFontFamily:a));let Z=e[W].draw(String.fromCodePoint(c));return{id:c,bitmap:new o.r({width:Z.width||60,height:Z.height||60},Z.data),metrics:{width:Z.glyphWidth/2||24,height:Z.glyphHeight/2||24,left:Z.glyphLeft/2+.5||0,top:Z.glyphTop/2-27.5||-8,advance:Z.glyphAdvance/2||24,isDoubleResolution:!0}}}_createTinySDF(e){let a=e?e.split(","):[];a.push("sans-serif");let c=a.map((s=>/[-\w]+/.test(s)?s:`'${CSS.escape(s)}'`)).join(",");return new cl.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:c,fontWeight:this._fontWeight(a[0]),fontStyle:this._fontStyle(a[0]),lang:this.lang})}_fontStyle(e){return/italic/i.test(e)?"italic":/oblique/i.test(e)?"oblique":"normal"}_fontWeight(e){let a={thin:100,hairline:100,"extra light":200,"ultra light":200,light:300,normal:400,regular:400,medium:500,semibold:600,demibold:600,bold:700,"extra bold":800,"ultra bold":800,black:900,heavy:900,"extra black":950,"ultra black":950},c;for(let[s,W]of Object.entries(a))new RegExp(`\\b${s}\\b`,"i").test(e)&&(c=`${W}`);return c}destroy(){for(let e in this.entries){let a=this.entries[e];a.tinySDF&&(a.tinySDF=null),a.ideographTinySDF&&(a.ideographTinySDF=null),a.glyphs={},a.requests={},a.ranges={}}this.entries={}}}cl.loadGlyphRange=function(m,e,a,c){return o._(this,void 0,void 0,(function*(){let s=256*e,W=s+255,Z=c.transformRequest(a.replace("{fontstack}",m).replace("{range}",`${s}-${W}`),"Glyphs"),u=yield o.n(Z,new AbortController);if(!u||!u.data)throw new Error(`Could not load glyph range. range: ${e}, ${s}-${W}`);let G={};for(let U of o.o(u.data))G[U.id]=U;return G}))},cl.TinySDF=class{constructor({fontSize:m=24,buffer:e=3,radius:a=8,cutoff:c=.25,fontFamily:s="sans-serif",fontWeight:W="normal",fontStyle:Z="normal",lang:u=null}={}){this.buffer=e,this.cutoff=c,this.radius=a,this.lang=u;let G=this.size=m+4*e,U=this._createCanvas(G),X=this.ctx=U.getContext("2d",{willReadFrequently:!0});X.font=`${Z} ${W} ${m}px ${s}`,X.textBaseline="alphabetic",X.textAlign="left",X.fillStyle="black",this.gridOuter=new Float64Array(G*G),this.gridInner=new Float64Array(G*G),this.f=new Float64Array(G),this.z=new Float64Array(G+1),this.v=new Uint16Array(G)}_createCanvas(m){let e=document.createElement("canvas");return e.width=e.height=m,e}draw(m){let{width:e,actualBoundingBoxAscent:a,actualBoundingBoxDescent:c,actualBoundingBoxLeft:s,actualBoundingBoxRight:W}=this.ctx.measureText(m),Z=Math.ceil(a),u=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(W-s))),G=Math.min(this.size-this.buffer,Z+Math.ceil(c)),U=u+2*this.buffer,X=G+2*this.buffer,Q=Math.max(U*X,0),k=new Uint8ClampedArray(Q),j={data:k,width:U,height:X,glyphWidth:u,glyphHeight:G,glyphTop:Z,glyphLeft:0,glyphAdvance:e};if(u===0||G===0)return j;let{ctx:H,buffer:q,gridInner:$,gridOuter:et}=this;this.lang&&(H.lang=this.lang),H.clearRect(q,q,u,G),H.fillText(m,q,q+Z);let nt=H.getImageData(q,q,u,G);et.fill(xi,0,Q),$.fill(0,0,Q);for(let mt=0;mt<G;mt++)for(let at=0;at<u;at++){let Wt=nt.data[4*(mt*u+at)+3]/255;if(Wt===0)continue;let Zt=(mt+q)*U+at+q;if(Wt===1)et[Zt]=0,$[Zt]=xi;else{let ot=.5-Wt;et[Zt]=ot>0?ot*ot:0,$[Zt]=ot<0?ot*ot:0}}Qe(et,0,0,U,X,U,this.f,this.v,this.z),Qe($,q,q,u,G,U,this.f,this.v,this.z);for(let mt=0;mt<Q;mt++){let at=Math.sqrt(et[mt])-Math.sqrt($[mt]);k[mt]=Math.round(255-255*(at/this.radius+this.cutoff))}return j}};class Ri{constructor(){this.specification=o.u.light.position}possiblyEvaluate(e,a){return o.F(e.expression.evaluate(a))}interpolate(e,a,c){return{x:o.G.number(e.x,a.x,c),y:o.G.number(e.y,a.y,c),z:o.G.number(e.z,a.z,c)}}}let Le;class Yl extends o.E{constructor(e){super(),Le=Le||new o.t({anchor:new o.D(o.u.light.anchor),position:new Ri,color:new o.D(o.u.light.color),intensity:new o.D(o.u.light.intensity)}),this._transitionable=new o.x(Le,void 0),this.setLight(e),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(e,a={}){if(!this._validate(o.y,e,a))for(let c in e){let s=e[c];c.endsWith(o.z)?this._transitionable.setTransition(c.slice(0,-o.z.length),s):this._transitionable.setValue(c,s)}}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,a,c){return(!c||c.validate!==!1)&&o.B(this,e.call(o.C,{value:a,style:{glyphs:!0,sprite:!0},styleSpec:o.u}))}}let ol=new o.t({"sky-color":new o.D(o.u.sky["sky-color"]),"horizon-color":new o.D(o.u.sky["horizon-color"]),"fog-color":new o.D(o.u.sky["fog-color"]),"fog-ground-blend":new o.D(o.u.sky["fog-ground-blend"]),"horizon-fog-blend":new o.D(o.u.sky["horizon-fog-blend"]),"sky-horizon-blend":new o.D(o.u.sky["sky-horizon-blend"]),"atmosphere-blend":new o.D(o.u.sky["atmosphere-blend"])});class ba extends o.E{constructor(e){super(),this._transitionable=new o.x(ol,void 0),this.setSky(e),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new o.H(0))}setSky(e,a={}){if(!this._validate(o.J,e,a)){e||(e={"sky-color":"transparent","horizon-color":"transparent","fog-color":"transparent","fog-ground-blend":1,"atmosphere-blend":0});for(let c in e){let s=e[c];c.endsWith(o.z)?this._transitionable.setTransition(c.slice(0,-o.z.length),s):this._transitionable.setValue(c,s)}}}getSky(){return this._transitionable.serialize()}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,a,c={}){return c?.validate!==!1&&o.B(this,e.call(o.C,o.e({value:a,style:{glyphs:!0,sprite:!0},styleSpec:o.u})))}calculateFogBlendOpacity(e){return e<60?0:e<70?(e-60)/10:1}}class dn{constructor(e,a){this.width=e,this.height=a,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(e,a){let c=e.join(",")+String(a);return this.dashEntry[c]||(this.dashEntry[c]=this.addDash(e,a)),this.dashEntry[c]}getDashRanges(e,a,c){let s=[],W=e.length%2==1?-e[e.length-1]*c:0,Z=e[0]*c,u=!0;s.push({left:W,right:Z,isDash:u,zeroLength:e[0]===0});let G=e[0];for(let U=1;U<e.length;U++){u=!u;let X=e[U];W=G*c,G+=X,Z=G*c,s.push({left:W,right:Z,isDash:u,zeroLength:X===0})}return s}addRoundDash(e,a,c){let s=a/2;for(let W=-c;W<=c;W++){let Z=this.width*(this.nextRow+c+W),u=0,G=e[u];for(let U=0;U<this.width;U++){U/G.right>1&&(G=e[++u]);let X=Math.abs(U-G.left),Q=Math.abs(U-G.right),k=Math.min(X,Q),j,H=W/c*(s+1);if(G.isDash){let q=s-Math.abs(H);j=Math.sqrt(k*k+q*q)}else j=s-Math.sqrt(k*k+H*H);this.data[Z+U]=Math.max(0,Math.min(255,j+128))}}}addRegularDash(e){for(let u=e.length-1;u>=0;--u){let G=e[u],U=e[u+1];G.zeroLength?e.splice(u,1):U&&U.isDash===G.isDash&&(U.left=G.left,e.splice(u,1))}let a=e[0],c=e[e.length-1];a.isDash===c.isDash&&(a.left=c.left-this.width,c.right=a.right+this.width);let s=this.width*this.nextRow,W=0,Z=e[W];for(let u=0;u<this.width;u++){u/Z.right>1&&(Z=e[++W]);let G=Math.abs(u-Z.left),U=Math.abs(u-Z.right),X=Math.min(G,U);this.data[s+u]=Math.max(0,Math.min(255,(Z.isDash?X:-X)+128))}}addDash(e,a){let c=a?7:0,s=2*c+1;if(this.nextRow+s>this.height)return o.w("LineAtlas out of space"),null;let W=0;for(let u=0;u<e.length;u++)W+=e[u];if(W!==0){let u=this.width/W,G=this.getDashRanges(e,this.width,u);a?this.addRoundDash(G,u,c):this.addRegularDash(G)}let Z={y:this.nextRow+c,height:2*c,width:W};return this.nextRow+=s,this.dirty=!0,Z}bind(e){let a=e.gl;this.texture?(a.bindTexture(a.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,a.texSubImage2D(a.TEXTURE_2D,0,0,0,this.width,this.height,a.ALPHA,a.UNSIGNED_BYTE,this.data))):(this.texture=a.createTexture(),a.bindTexture(a.TEXTURE_2D,this.texture),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.REPEAT),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.REPEAT),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.LINEAR),a.texImage2D(a.TEXTURE_2D,0,a.ALPHA,this.width,this.height,0,a.ALPHA,a.UNSIGNED_BYTE,this.data))}}let xl="maplibre_preloaded_worker_pool";class _l{constructor(){this.active={}}acquire(e){if(!this.workers)for(this.workers=[];this.workers.length<_l.workerCount;)this.workers.push(new Worker(o.a.WORKER_URL));return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.numActive()===0&&(this.workers.forEach((a=>{a.terminate()})),this.workers=null)}isPreloaded(){return!!this.active[xl]}numActive(){return Object.keys(this.active).length}}let Ci=Math.floor(ge.hardwareConcurrency/2),qi,ki;function Sa(){return qi||(qi=new _l),qi}_l.workerCount=o.K(globalThis)?Math.max(Math.min(Ci,3),1):1;class Fl{constructor(e,a){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=a;let c=this.workerPool.acquire(a);for(let s=0;s<c.length;s++){let W=new o.L(c[s],a);W.name=`Worker ${s}`,this.actors.push(W)}if(!this.actors.length)throw new Error("No actors found")}broadcast(e,a){let c=[];for(let s of this.actors)c.push(s.sendAsync({type:e,data:a}));return Promise.all(c)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(e=!0){this.actors.forEach((a=>{a.remove()})),this.actors=[],e&&this.workerPool.release(this.id)}registerMessageHandler(e,a){for(let c of this.actors)c.registerMessageHandler(e,a)}unregisterMessageHandler(e){for(let a of this.actors)a.unregisterMessageHandler(e)}}function $i(){return ki||(ki=new Fl(Sa(),o.M),ki.registerMessageHandler("GR",((m,e,a)=>o.m(e,a)))),ki}function Pl(m,e){let a=o.N();return o.O(a,a,[1,1,0]),o.Q(a,a,[.5*m.width,.5*m.height,1]),m.calculatePosMatrix?o.S(a,a,m.calculatePosMatrix(e.toUnwrapped())):a}function Kl(m,e,a,c,s,W,Z){var u;let G=(function(k,j,H){if(k)for(let q of k){let $=j[q];if($&&$.source===H&&$.type==="fill-extrusion")return!0}else for(let q in j){let $=j[q];if($.source===H&&$.type==="fill-extrusion")return!0}return!1})((u=s?.layers)!==null&&u!==void 0?u:null,e,m.id),U=W.maxPitchScaleFactor(),X=m.tilesIn(c,U,G);X.sort(ci);let Q=[];for(let k of X)Q.push({wrappedTileID:k.tileID.wrapped().key,queryResults:k.tile.queryRenderedFeatures(e,a,m.getState(),k.queryGeometry,k.cameraQueryGeometry,k.scale,s,W,U,Pl(W,k.tileID),Z?(j,H)=>Z(k.tileID,j,H):void 0)});return(function(k,j){for(let H in k)for(let q of k[H])El(q,j);return k})((function(k){let j={},H={};for(let q of k){let $=q.queryResults,et=q.wrappedTileID,nt=H[et]=H[et]||{};for(let mt in $){let at=$[mt],Wt=nt[mt]=nt[mt]||{},Zt=j[mt]=j[mt]||[];for(let ot of at)Wt[ot.featureIndex]||(Wt[ot.featureIndex]=!0,Zt.push(ot))}}return j})(Q),m)}function ci(m,e){let a=m.tileID,c=e.tileID;return a.overscaledZ-c.overscaledZ||a.canonical.y-c.canonical.y||a.wrap-c.wrap||a.canonical.x-c.canonical.x}function El(m,e){let a=m.feature,c=e.getFeatureState(a.layer["source-layer"],a.id);a.source=a.layer.source,a.layer["source-layer"]&&(a.sourceLayer=a.layer["source-layer"]),a.state=c}function Na(m,e,a){return o._(this,void 0,void 0,(function*(){let c=m;if(m.url?c=(yield o.j(e.transformRequest(m.url,"Source"),a)).data:yield ge.frameAsync(a),!c)return null;let s=o.U(o.e(c,m),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in c&&c.vector_layers&&(s.vectorLayerIds=c.vector_layers.map((W=>W.id))),s}))}class si{constructor(e,a){e&&(a?this.setSouthWest(e).setNorthEast(a):Array.isArray(e)&&(e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1])))}setNorthEast(e){return this._ne=e instanceof o.V?new o.V(e.lng,e.lat):o.V.convert(e),this}setSouthWest(e){return this._sw=e instanceof o.V?new o.V(e.lng,e.lat):o.V.convert(e),this}extend(e){let a=this._sw,c=this._ne,s,W;if(e instanceof o.V)s=e,W=e;else{if(!(e instanceof si))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(si.convert(e)):this.extend(o.V.convert(e)):e&&("lng"in e||"lon"in e)&&"lat"in e?this.extend(o.V.convert(e)):this;if(s=e._sw,W=e._ne,!s||!W)return this}return a||c?(a.lng=Math.min(s.lng,a.lng),a.lat=Math.min(s.lat,a.lat),c.lng=Math.max(W.lng,c.lng),c.lat=Math.max(W.lat,c.lat)):(this._sw=new o.V(s.lng,s.lat),this._ne=new o.V(W.lng,W.lat)),this}getCenter(){return new o.V((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new o.V(this.getWest(),this.getNorth())}getSouthEast(){return new o.V(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){let{lng:a,lat:c}=o.V.convert(e),s=this._sw.lng<=a&&a<=this._ne.lng;return this._sw.lng>this._ne.lng&&(s=this._sw.lng>=a&&a>=this._ne.lng),this._sw.lat<=c&&c<=this._ne.lat&&s}intersects(e){if((e=si.convert(e)).getNorth()<this.getSouth()||e.getSouth()>this.getNorth())return!1;let a=o.W(this.getWest(),-180,180),c=o.W(this.getEast(),-180,180),s=o.W(e.getWest(),-180,180),W=o.W(e.getEast(),-180,180),Z=a>c,u=s>W;return!(!Z||!u)||(Z?W>=a||s<=c:u?c>=s||a<=W:!(s>c||W<a))}static convert(e){return e instanceof si?e:e&&new si(e)}static fromLngLat(e,a=0){let c=360*a/40075017,s=c/Math.cos(Math.PI/180*e.lat);return new si(new o.V(e.lng-s,e.lat-c),new o.V(e.lng+s,e.lat+c))}adjustAntiMeridian(){let e=new o.V(this._sw.lng,this._sw.lat),a=new o.V(this._ne.lng,this._ne.lat);return new si(e,e.lng>a.lng?new o.V(a.lng+360,a.lat):a)}}class Tl{constructor(e,a,c){this.bounds=si.convert(this.validateBounds(e)),this.minzoom=a||0,this.maxzoom=c||24}validateBounds(e){return Array.isArray(e)&&e.length===4?[Math.max(-180,e[0]),Math.max(-90,e[1]),Math.min(180,e[2]),Math.min(90,e[3])]:[-180,-90,180,90]}contains(e){let a=Math.pow(2,e.z),c=Math.floor(o.Y(this.bounds.getWest())*a),s=Math.floor(o.X(this.bounds.getNorth())*a),W=Math.ceil(o.Y(this.bounds.getEast())*a),Z=Math.ceil(o.X(this.bounds.getSouth())*a);return e.x>=c&&e.x<W&&e.y>=s&&e.y<Z}}class wi extends o.E{constructor(e,a,c,s){if(super(),this.id=e,this.dispatcher=c,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,o.e(this,o.U(a,["url","scheme","tileSize","promoteId","encoding"])),this._options=o.e({type:"vector"},a),this._collectResourceTiming=a.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(s)}load(){return o._(this,void 0,void 0,(function*(){this._loaded=!1,this.fire(new o.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{let e=yield Na(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.tileManagers[this.id].clearTiles(),e&&(o.e(this,e),e.bounds&&(this.tileBounds=new Tl(e.bounds,this.minzoom,this.maxzoom)),this.fire(new o.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.l("data",{dataType:"source",sourceDataType:"content"})))}catch(e){this._tileJSONRequest=null,this._loaded=!0,this.fire(new o.k(e))}}))}loaded(){return this._loaded}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}onAdd(e){this.map=e,this.load()}setSourceProperty(e){this._tileJSONRequest&&this._tileJSONRequest.abort(),e(),this.load()}setTiles(e){return this.setSourceProperty((()=>{this._options.tiles=e})),this}setUrl(e){return this.setSourceProperty((()=>{this.url=e,this._options.url=e})),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return o.e({},this._options)}loadTile(e){return o._(this,void 0,void 0,(function*(){let a=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),c={request:this.map._requestManager.transformRequest(a,"Tile"),uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,tileSize:this.tileSize*e.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity,encoding:this.encoding,overzoomParameters:this._getOverzoomParameters(e)};c.request.collectResourceTiming=this._collectResourceTiming;let s="RT";if(e.actor&&e.state!=="expired"){if(e.state==="loading")return new Promise(((W,Z)=>{e.reloadPromise={resolve:W,reject:Z}}))}else e.actor=this.dispatcher.getActor(),s="LT";e.abortController=new AbortController;try{let W=yield e.actor.sendAsync({type:s,data:c},e.abortController);if(delete e.abortController,e.aborted)return;this._afterTileLoadWorkerResponse(e,W)}catch(W){if(delete e.abortController,e.aborted)return;if(W&&W.status!==404)throw W;this._afterTileLoadWorkerResponse(e,null)}}))}_getOverzoomParameters(e){if(e.tileID.canonical.z<=this.maxzoom||this.map._zoomLevelsToOverscale===void 0)return;let a=e.tileID.scaledTo(this.maxzoom).canonical,c=a.url(this.tiles,this.map.getPixelRatio(),this.scheme);return{maxZoomTileID:a,overzoomRequest:this.map._requestManager.transformRequest(c,"Tile")}}_afterTileLoadWorkerResponse(e,a){if(a&&a.resourceTiming&&(e.resourceTiming=a.resourceTiming),a&&this.map._refreshExpiredTiles&&e.setExpiryData(a),e.loadVectorData(a,this.map.painter),e.reloadPromise){let c=e.reloadPromise;e.reloadPromise=null,this.loadTile(e).then(c.resolve).catch(c.reject)}}abortTile(e){return o._(this,void 0,void 0,(function*(){e.abortController&&(e.abortController.abort(),delete e.abortController),e.actor&&(yield e.actor.sendAsync({type:"AT",data:{uid:e.uid,type:this.type,source:this.id}}))}))}unloadTile(e){return o._(this,void 0,void 0,(function*(){e.unloadVectorData(),e.actor&&(yield e.actor.sendAsync({type:"RMT",data:{uid:e.uid,type:this.type,source:this.id}}))}))}hasTransition(){return!1}}class Rn extends o.E{constructor(e,a,c,s){super(),this.id=e,this.dispatcher=c,this.setEventedParent(s),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=o.e({type:"raster"},a),o.e(this,o.U(a,["url","scheme","tileSize"]))}load(){return o._(this,arguments,void 0,(function*(e=!1){this._loaded=!1,this.fire(new o.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{let a=yield Na(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,a&&(o.e(this,a),a.bounds&&(this.tileBounds=new Tl(a.bounds,this.minzoom,this.maxzoom)),this.fire(new o.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.l("data",{dataType:"source",sourceDataType:"content",sourceDataChanged:e})))}catch(a){this._tileJSONRequest=null,this._loaded=!0,this.fire(new o.k(a))}}))}loaded(){return this._loaded}onAdd(e){this.map=e,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(e){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),e(),this.load(!0)}setTiles(e){return this.setSourceProperty((()=>{this._options.tiles=e})),this}setUrl(e){return this.setSourceProperty((()=>{this.url=e,this._options.url=e})),this}serialize(){return o.e({},this._options)}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}loadTile(e){return o._(this,void 0,void 0,(function*(){let a=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);e.abortController=new AbortController;try{let c=yield je.getImage(this.map._requestManager.transformRequest(a,"Tile"),e.abortController,this.map._refreshExpiredTiles);if(delete e.abortController,e.aborted)return void(e.state="unloaded");if(c&&c.data){this.map._refreshExpiredTiles&&(c.cacheControl||c.expires)&&e.setExpiryData({cacheControl:c.cacheControl,expires:c.expires});let s=this.map.painter.context,W=s.gl,Z=c.data;e.texture=this.map.painter.getTileTexture(Z.width),e.texture?e.texture.update(Z,{useMipmap:!0}):(e.texture=new o.T(s,Z,W.RGBA,{useMipmap:!0}),e.texture.bind(W.LINEAR,W.CLAMP_TO_EDGE,W.LINEAR_MIPMAP_NEAREST)),e.state="loaded"}}catch(c){if(delete e.abortController,e.aborted)e.state="unloaded";else if(c)throw e.state="errored",c}}))}abortTile(e){return o._(this,void 0,void 0,(function*(){e.abortController&&(e.abortController.abort(),delete e.abortController)}))}unloadTile(e){return o._(this,void 0,void 0,(function*(){e.texture&&this.map.painter.saveTileTexture(e.texture)}))}hasTransition(){return!1}}class Ha extends Rn{constructor(e,a,c,s){super(e,a,c,s),this.type="raster-dem",this.maxzoom=22,this._options=o.e({type:"raster-dem"},a),this.encoding=a.encoding||"mapbox",this.redFactor=a.redFactor,this.greenFactor=a.greenFactor,this.blueFactor=a.blueFactor,this.baseShift=a.baseShift}loadTile(e){return o._(this,void 0,void 0,(function*(){let a=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),c=this.map._requestManager.transformRequest(a,"Tile");e.neighboringTiles=this._getNeighboringTiles(e.tileID),e.abortController=new AbortController;try{let s=yield je.getImage(c,e.abortController,this.map._refreshExpiredTiles);if(delete e.abortController,e.aborted)return void(e.state="unloaded");if(s&&s.data){let W=s.data;this.map._refreshExpiredTiles&&(s.cacheControl||s.expires)&&e.setExpiryData({cacheControl:s.cacheControl,expires:s.expires});let Z=o.b(W)&&o.Z()?W:yield this.readImageNow(W),u={type:this.type,uid:e.uid,source:this.id,rawImageData:Z,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!e.actor||e.state==="expired"){e.actor=this.dispatcher.getActor();let G=yield e.actor.sendAsync({type:"LDT",data:u});e.dem=G,e.needsHillshadePrepare=!0,e.needsTerrainPrepare=!0,e.state="loaded"}}}catch(s){if(delete e.abortController,e.aborted)e.state="unloaded";else if(s)throw e.state="errored",s}}))}readImageNow(e){return o._(this,void 0,void 0,(function*(){if(typeof VideoFrame<"u"&&o.$()){let a=e.width+2,c=e.height+2;try{return new o.R({width:a,height:c},yield o.a0(e,-1,-1,a,c))}catch{}}return ge.getImageData(e,1)}))}_getNeighboringTiles(e){let a=e.canonical,c=Math.pow(2,a.z),s=(a.x-1+c)%c,W=a.x===0?e.wrap-1:e.wrap,Z=(a.x+1+c)%c,u=a.x+1===c?e.wrap+1:e.wrap,G={};return G[new o.a1(e.overscaledZ,W,a.z,s,a.y).key]={backfilled:!1},G[new o.a1(e.overscaledZ,u,a.z,Z,a.y).key]={backfilled:!1},a.y>0&&(G[new o.a1(e.overscaledZ,W,a.z,s,a.y-1).key]={backfilled:!1},G[new o.a1(e.overscaledZ,e.wrap,a.z,a.x,a.y-1).key]={backfilled:!1},G[new o.a1(e.overscaledZ,u,a.z,Z,a.y-1).key]={backfilled:!1}),a.y+1<c&&(G[new o.a1(e.overscaledZ,W,a.z,s,a.y+1).key]={backfilled:!1},G[new o.a1(e.overscaledZ,e.wrap,a.z,a.x,a.y+1).key]={backfilled:!1},G[new o.a1(e.overscaledZ,u,a.z,Z,a.y+1).key]={backfilled:!1}),G}unloadTile(e){return o._(this,void 0,void 0,(function*(){e.demTexture&&this.map.painter.saveTileTexture(e.demTexture),e.fbo&&(e.fbo.destroy(),delete e.fbo),e.dem&&delete e.dem,delete e.neighboringTiles,e.state="unloaded",e.actor&&(yield e.actor.sendAsync({type:"RDT",data:{type:this.type,uid:e.uid,source:this.id}}))}))}}function hl(m){return m.type==="GeometryCollection"?m.geometries.map((e=>e.coordinates)).flat(1/0):m.coordinates.flat(1/0)}function Qi(m){let e=new si,a;switch(m.type){case"FeatureCollection":a=m.features.map((c=>hl(c.geometry))).flat(1/0);break;case"Feature":a=hl(m.geometry);break;default:a=hl(m)}if(a.length==0)return e;for(let c=0;c<a.length-1;c+=2)e.extend([a[c],a[c+1]]);return e}class ql extends o.E{constructor(e,a,c,s){super(),this.id=e,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._isUpdatingWorker=!1,this._pendingWorkerUpdate={data:a.data},this.actor=c.getActor(),this.setEventedParent(s),this._data=typeof a.data=="string"?{url:a.data}:{geojson:a.data},this._options=o.e({},a),this._collectResourceTiming=a.collectResourceTiming,a.maxzoom!==void 0&&(this.maxzoom=a.maxzoom),a.type&&(this.type=a.type),a.attribution&&(this.attribution=a.attribution),this.promoteId=a.promoteId,a.clusterMaxZoom!==void 0&&this.maxzoom<=a.clusterMaxZoom&&o.w(`The maxzoom value "${this.maxzoom}" is expected to be greater than the clusterMaxZoom value "${a.clusterMaxZoom}".`),this.workerOptions=o.e({source:this.id,cluster:a.cluster||!1,geojsonVtOptions:{buffer:this._pixelsToTileUnits(a.buffer!==void 0?a.buffer:128),tolerance:this._pixelsToTileUnits(a.tolerance!==void 0?a.tolerance:.375),extent:o.a4,maxZoom:this.maxzoom,lineMetrics:a.lineMetrics||!1,generateId:a.generateId||!1},superclusterOptions:{maxZoom:this._getClusterMaxZoom(a.clusterMaxZoom),minPoints:Math.max(2,a.clusterMinPoints||2),extent:o.a4,radius:this._pixelsToTileUnits(a.clusterRadius||50),log:!1,generateId:a.generateId||!1},clusterProperties:a.clusterProperties,filter:a.filter},a.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}_hasPendingWorkerUpdate(){return this._pendingWorkerUpdate.data!==void 0||this._pendingWorkerUpdate.diff!==void 0||this._pendingWorkerUpdate.optionsChanged}_pixelsToTileUnits(e){return e*(o.a4/this.tileSize)}_getClusterMaxZoom(e){let a=e?Math.round(e):this.maxzoom-1;return Number.isInteger(e)||e===void 0||o.w(`Integer expected for option 'clusterMaxZoom': provided value "${e}" rounded to "${a}"`),a}load(){return o._(this,void 0,void 0,(function*(){yield this._updateWorkerData()}))}onAdd(e){this.map=e,this.load()}setData(e,a){this._data=typeof e=="string"?{url:e}:{geojson:e},this._pendingWorkerUpdate={data:e};let c=this._updateWorkerData();return a?c:this}updateData(e,a){this._pendingWorkerUpdate.diff=o.a5(this._pendingWorkerUpdate.diff,e);let c=this._updateWorkerData();return a?c:this}getData(){return o._(this,void 0,void 0,(function*(){let e=o.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:e})}))}getBounds(){return o._(this,void 0,void 0,(function*(){return Qi(yield this.getData())}))}setClusterOptions(e){return this.workerOptions.cluster=e.cluster,e.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=this._pixelsToTileUnits(e.clusterRadius)),e.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=this._getClusterMaxZoom(e.clusterMaxZoom)),this._pendingWorkerUpdate.optionsChanged=!0,this._updateWorkerData(),this}getClusterExpansionZoom(e){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:e,source:this.id}})}getClusterChildren(e){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:e,source:this.id}})}getClusterLeaves(e,a,c){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:e,limit:a,offset:c}})}_updateWorkerData(){return o._(this,void 0,void 0,(function*(){if(this._isUpdatingWorker)return;if(!this._hasPendingWorkerUpdate())return void o.w(`No pending worker updates for GeoJSONSource ${this.id}.`);let{data:e,diff:a}=this._pendingWorkerUpdate,c=o.e({type:this.type},this.workerOptions);e?(typeof e=="string"?(c.request=this.map._requestManager.transformRequest(ge.resolveURL(e),"Source"),c.request.collectResourceTiming=this._collectResourceTiming):c.data=e,this._pendingWorkerUpdate.data=void 0):a&&(c.dataDiff=a,this._pendingWorkerUpdate.diff=void 0),this._pendingWorkerUpdate.optionsChanged=void 0,this._isUpdatingWorker=!0,this.fire(new o.l("dataloading",{dataType:"source"}));try{let s=yield this.actor.sendAsync({type:"LD",data:c});if(this._isUpdatingWorker=!1,this._removed||s.abandoned)return void this.fire(new o.l("dataabort",{dataType:"source"}));s.applyDiff?this._applyDiff(a):this._data={geojson:s.data};let W=null;s.resourceTiming&&s.resourceTiming[this.id]&&(W=s.resourceTiming[this.id].slice(0));let Z={dataType:"source"};this._collectResourceTiming&&W&&W.length>0&&o.e(Z,{resourceTiming:W}),this.fire(new o.l("data",Object.assign(Object.assign({},Z),{sourceDataType:"metadata"}))),this.fire(new o.l("data",Object.assign(Object.assign({},Z),{sourceDataType:"content",shouldReloadTileOptions:this._getShouldReloadTileOptions(a)})))}catch(s){if(this._isUpdatingWorker=!1,this._removed)return void this.fire(new o.l("dataabort",{dataType:"source"}));this.fire(new o.k(s))}finally{this._hasPendingWorkerUpdate()&&this._updateWorkerData()}}))}_applyDiff(e){let a=typeof this.promoteId=="string"?this.promoteId:void 0;this._data.url||this._data.updateable||!o.a6(this._data.geojson,a)||(this._data={updateable:o.a7(this._data.geojson,a)}),e&&this._data.updateable?o.a8(this._data.updateable,e,a):o.w("Cannot apply GeoJSONSource#updateData due to internal error")}_getShouldReloadTileOptions(e){if(this._options.cluster||!e||e.removeAll)return;let{add:a=[],update:c=[],remove:s=[]}=e||{},W=new Set([...c.map((Z=>Z.id)),...s]);for(let Z of W.values())if(typeof Z!="number"&&this.promoteId==null)return void o.w(`GeoJSONSource "${this.id}": updateData is slower when using string GeoJSON feature IDs (e.g. "${Z}"). Consider using promoteId or numeric IDs for better performance.`);return{nextBounds:[...c.map((Z=>Z.newGeometry)),...a.map((Z=>Z.geometry))].filter(Boolean).map((Z=>Qi(Z))),prevIds:W}}shouldReloadTile(e,{nextBounds:a,prevIds:c}){if(!e.latestFeatureIndex)return e.state!=="unloaded";let s=e.latestFeatureIndex.loadVTLayers();for(let G=0;G<e.latestFeatureIndex.featureIndexArray.length;G++){let U=e.latestFeatureIndex.featureIndexArray.get(G),X=s[o.a9].feature(U.featureIndex),Q=e.latestFeatureIndex.getId(X,o.a9);if(c.has(Q))return!0}let{buffer:W,extent:Z}=this.workerOptions.geojsonVtOptions,u=(function({x:G,y:U,z:X},Q=0){let k=o.a2((G-Q)/Math.pow(2,X)),j=o.a3((U+1+Q)/Math.pow(2,X)),H=o.a2((G+1+Q)/Math.pow(2,X)),q=o.a3((U-Q)/Math.pow(2,X));return new si([k,j],[H,q])})(e.tileID.canonical,W/Z);for(let G of a)if(u.intersects(G))return!0;return!1}loaded(){return!this._isUpdatingWorker&&!this._hasPendingWorkerUpdate()}loadTile(e){return o._(this,void 0,void 0,(function*(){let a=e.actor?"RT":"LT";e.actor=this.actor;let c={type:this.type,uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity};e.abortController=new AbortController;let s=yield this.actor.sendAsync({type:a,data:c},e.abortController);delete e.abortController,e.unloadVectorData(),e.aborted||e.loadVectorData(s,this.map.painter,a==="RT")}))}abortTile(e){return o._(this,void 0,void 0,(function*(){e.abortController&&(e.abortController.abort(),delete e.abortController),e.aborted=!0}))}unloadTile(e){return o._(this,void 0,void 0,(function*(){e.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:e.uid,type:this.type,source:this.id}})}))}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return o.e({},this._options,{type:this.type,data:this._data.updateable?{type:"FeatureCollection",features:Array.from(this._data.updateable.values())}:this._data.url||this._data.geojson})}hasTransition(){return!1}}class vi extends o.E{constructor(e,a,c,s){super(),this.flippedWindingOrder=!1,this.id=e,this.dispatcher=c,this.coordinates=a.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(s),this.options=a}load(e){return o._(this,void 0,void 0,(function*(){this._loaded=!1,this.fire(new o.l("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{let a=yield je.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,a&&a.data&&(this.image=a.data,e&&(this.coordinates=e),this._finishLoading())}catch(a){this._request=null,this._loaded=!0,this.fire(new o.k(a))}}))}loaded(){return this._loaded}updateImage(e){return e.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=e.url,this.load(e.coordinates).finally((()=>{this.texture=null})),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new o.l("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(e){this.coordinates=e;let a=e.map(o.aa.fromLngLat);var c;return this.tileID=(function(s){let W=o.ab.fromPoints(s),Z=W.width(),u=W.height(),G=Math.max(Z,u),U=Math.max(0,Math.floor(-Math.log(G)/Math.LN2)),X=Math.pow(2,U);return new o.ad(U,Math.floor((W.minX+W.maxX)/2*X),Math.floor((W.minY+W.maxY)/2*X))})(a),this.terrainTileRanges=this._getOverlappingTileRanges(a),this.minzoom=this.maxzoom=this.tileID.z,this.tileCoords=a.map((s=>this.tileID.getTilePoint(s)._round())),this.flippedWindingOrder=((c=this.tileCoords)[1].x-c[0].x)*(c[2].y-c[0].y)-(c[1].y-c[0].y)*(c[2].x-c[0].x)<0,this.fire(new o.l("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;let e=this.map.painter.context,a=e.gl;this.texture||(this.texture=new o.T(e,this.image,a.RGBA),this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE));let c=!1;for(let s in this.tiles){let W=this.tiles[s];W.state!=="loaded"&&(W.state="loaded",W.texture=this.texture,c=!0)}c&&this.fire(new o.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(e){return o._(this,void 0,void 0,(function*(){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={}):e.state="errored"}))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}_getOverlappingTileRanges(e){let{minX:a,minY:c,maxX:s,maxY:W}=o.ab.fromPoints(e),Z={};for(let u=0;u<=o.ac;u++){let G=Math.pow(2,u),U=Math.floor(a*G),X=Math.floor(c*G),Q=Math.floor(s*G),k=Math.floor(W*G);Z[u]={minTileX:U,minTileY:X,maxTileX:Q,maxTileY:k}}return Z}}class We extends vi{constructor(e,a,c,s){super(e,a,c,s),this.roundZoom=!0,this.type="video",this.options=a}load(){return o._(this,void 0,void 0,(function*(){this._loaded=!1;let e=this.options;this.urls=[];for(let a of e.urls)this.urls.push(this.map._requestManager.transformRequest(a,"Source").url);try{let a=yield o.ae(this.urls);if(this._loaded=!0,!a)return;this.video=a,this.video.loop=!0,this.video.addEventListener("playing",(()=>{this.map.triggerRepaint()})),this.map&&this.video.play(),this._finishLoading()}catch(a){this.fire(new o.k(a))}}))}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(e){if(this.video){let a=this.video.seekable;e<a.start(0)||e>a.end(0)?this.fire(new o.k(new o.af(`sources.${this.id}`,null,`Playback for this video can be set only between the ${a.start(0)} and ${a.end(0)}-second mark.`))):this.video.currentTime=e}}getVideo(){return this.video}onAdd(e){this.map||(this.map=e,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;let e=this.map.painter.context,a=e.gl;this.texture?this.video.paused||(this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE),a.texSubImage2D(a.TEXTURE_2D,0,0,0,a.RGBA,a.UNSIGNED_BYTE,this.video)):(this.texture=new o.T(e,this.video,a.RGBA),this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE));let c=!1;for(let s in this.tiles){let W=this.tiles[s];W.state!=="loaded"&&(W.state="loaded",W.texture=this.texture,c=!0)}c&&this.fire(new o.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class Hi extends vi{constructor(e,a,c,s){super(e,a,c,s),a.coordinates?Array.isArray(a.coordinates)&&a.coordinates.length===4&&!a.coordinates.some((W=>!Array.isArray(W)||W.length!==2||W.some((Z=>typeof Z!="number"))))||this.fire(new o.k(new o.af(`sources.${e}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new o.k(new o.af(`sources.${e}`,null,'missing required property "coordinates"'))),a.animate&&typeof a.animate!="boolean"&&this.fire(new o.k(new o.af(`sources.${e}`,null,'optional "animate" property must be a boolean value'))),a.canvas?typeof a.canvas=="string"||a.canvas instanceof HTMLCanvasElement||this.fire(new o.k(new o.af(`sources.${e}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new o.k(new o.af(`sources.${e}`,null,'missing required property "canvas"'))),this.options=a,this.animate=a.animate===void 0||a.animate}load(){return o._(this,void 0,void 0,(function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new o.k(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}))}getCanvas(){return this.canvas}onAdd(e){this.map=e,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let e=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,e=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,e=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;let a=this.map.painter.context,c=a.gl;this.texture?(e||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new o.T(a,this.canvas,c.RGBA,{premultiply:!0});let s=!1;for(let W in this.tiles){let Z=this.tiles[W];Z.state!=="loaded"&&(Z.state="loaded",Z.texture=this.texture,s=!0)}s&&this.fire(new o.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",animate:this.animate,canvas:this.options.canvas,coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(let e of[this.canvas.width,this.canvas.height])if(isNaN(e)||e<=0)return!0;return!1}}let Da={},cn=m=>{switch(m){case"geojson":return ql;case"image":return vi;case"raster":return Rn;case"raster-dem":return Ha;case"vector":return wi;case"video":return We;case"canvas":return Hi}return Da[m]},Ca="RTLPluginLoaded";class En extends o.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=$i()}_syncState(e){return this.status=e,this.dispatcher.broadcast("SRPS",{pluginStatus:e,pluginURL:this.url}).catch((a=>{throw this.status="error",a}))}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(e){return o._(this,arguments,void 0,(function*(a,c=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=ge.resolveURL(a),!this.url)throw new Error(`requested url ${a} is invalid`);if(this.status==="unavailable"){if(!c)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()}))}_requestImport(){return o._(this,void 0,void 0,(function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new o.l(Ca))}))}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let Fn=null;function zl(){return Fn||(Fn=new En),Fn}var Di,ht;(function(m){m[m.Base=0]="Base",m[m.Parent=1]="Parent"})(Di||(Di={})),(function(m){m[m.Departing=0]="Departing",m[m.Incoming=1]="Incoming"})(ht||(ht={}));class z{constructor(e,a){this.timeAdded=0,this.fadeEndTime=0,this.fadeOpacity=1,this.tileID=e,this.uid=o.ag(),this.uses=0,this.tileSize=a,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}isRenderable(e){return this.hasData()&&(!this.fadeEndTime||this.fadeOpacity>0)&&(e||!this.holdingForSymbolFade())}setCrossFadeLogic({fadingRole:e,fadingDirection:a,fadingParentID:c,fadeEndTime:s}){this.resetFadeLogic(),this.fadingRole=e,this.fadingDirection=a,this.fadingParentID=c,this.fadeEndTime=s}setSelfFadeLogic(e){this.resetFadeLogic(),this.selfFading=!0,this.fadeEndTime=e}resetFadeLogic(){this.fadingRole=null,this.fadingDirection=null,this.fadingParentID=null,this.selfFading=!1,this.timeAdded=jt(),this.fadeEndTime=0,this.fadeOpacity=1}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(e){this.demTexture&&e.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(e,a,c){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData,this.latestFeatureIndex.encoding=e.encoding):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData,this.latestFeatureIndex.encoding=this.latestEncoding)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=(function(s,W){let Z={};if(!W)return Z;for(let u of s){let G=u.layerIds.map((U=>W.getLayer(U))).filter(Boolean);if(G.length!==0){u.layers=G,u.stateDependentLayerIds&&(u.stateDependentLayers=u.stateDependentLayerIds.map((U=>G.filter((X=>X.id===U))[0])));for(let U of G)Z[U.id]=u}}return Z})(e.buckets,a?.style),this.hasSymbolBuckets=!1;for(let s in this.buckets){let W=this.buckets[s];if(W instanceof o.ai){if(this.hasSymbolBuckets=!0,!c)break;W.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(let s in this.buckets){let W=this.buckets[s];if(W instanceof o.ai&&W.hasRTLText){this.hasRTLText=!0,zl().lazyLoad();break}}this.queryPadding=0;for(let s in this.buckets){let W=this.buckets[s];this.queryPadding=Math.max(this.queryPadding,a.style.getLayer(s).queryRadius(W))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage),this.dashPositions=e.dashPositions}else this.collisionBoxArray=new o.ah}unloadVectorData(){for(let e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.dashPositions&&(this.dashPositions=null),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(e){return this.buckets[e.id]}upload(e){for(let c in this.buckets){let s=this.buckets[c];s.uploadPending()&&s.upload(e)}let a=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new o.T(e,this.imageAtlas.image,a.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new o.T(e,this.glyphAtlasImage,a.ALPHA),this.glyphAtlasImage=null)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,a,c,s,W,Z,u,G,U,X,Q){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:s,cameraQueryGeometry:W,scale:Z,tileSize:this.tileSize,pixelPosMatrix:X,transform:G,params:u,queryPadding:this.queryPadding*U,getElevation:Q},e,a,c):{}}querySourceFeatures(e,a){let c=this.latestFeatureIndex;if(!c||!c.rawTileData)return;let s=c.loadVTLayers(),W=a&&a.sourceLayer?a.sourceLayer:"",Z=s[o.a9]||s[W];if(!Z)return;let u=o.aj(a?.filter,a?.globalState),{z:G,x:U,y:X}=this.tileID.canonical,Q={z:G,x:U,y:X};for(let k=0;k<Z.length;k++){let j=Z.feature(k);if(u.needGeometry){let $=o.ak(j,!0);if(!u.filter(new o.H(this.tileID.overscaledZ),$,this.tileID.canonical))continue}else if(!u.filter(new o.H(this.tileID.overscaledZ),j))continue;let H=c.getId(j,W),q=new o.al(j,G,U,X,H);q.tile=Q,e.push(q)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){let a=this.expirationTime;if(e.cacheControl){let c=o.am(e.cacheControl);c["max-age"]&&(this.expirationTime=Date.now()+1e3*c["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){let c=Date.now(),s=!1;if(this.expirationTime>c)s=!1;else if(a)if(this.expirationTime<a)s=!0;else{let W=this.expirationTime-a;W?this.expirationTime=c+Math.max(W,3e4):s=!0}else s=!0;s?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(e,a){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(e).length===0)return;let c=this.latestFeatureIndex.loadVTLayers();for(let s in this.buckets){if(!a.style.hasLayer(s))continue;let W=this.buckets[s],Z=W.layers[0].sourceLayer||o.a9,u=c[Z],G=e[Z];if(!u||!G||Object.keys(G).length===0)continue;W.update(G,u,this.imageAtlas&&this.imageAtlas.patternPositions||{},this.dashPositions||{});let U=a&&a.style&&a.style.getLayer(s);U&&(this.queryPadding=Math.max(this.queryPadding,U.queryRadius(W)))}}holdingForSymbolFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<jt()}clearSymbolFadeHold(){this.symbolFadeHoldUntil=void 0}setSymbolHoldDuration(e){this.symbolFadeHoldUntil=jt()+e}setDependencies(e,a){let c={};for(let s of a)c[s]=!0;this.dependencies[e]=c}hasDependency(e,a){for(let c of e){let s=this.dependencies[c];if(s){for(let W of a)if(s[W])return!0}}return!1}}class v{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,a,c){let s=String(a);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][s]=this.stateChanges[e][s]||{},o.e(this.stateChanges[e][s],c),this.deletedStates[e]===null){this.deletedStates[e]={};for(let W in this.state[e])W!==s&&(this.deletedStates[e][W]=null)}else if(this.deletedStates[e]&&this.deletedStates[e][s]===null){this.deletedStates[e][s]={};for(let W in this.state[e][s])c[W]||(this.deletedStates[e][s][W]=null)}else for(let W in c)this.deletedStates[e]&&this.deletedStates[e][s]&&this.deletedStates[e][s][W]===null&&delete this.deletedStates[e][s][W]}removeFeatureState(e,a,c){if(this.deletedStates[e]===null)return;let s=String(a);if(this.deletedStates[e]=this.deletedStates[e]||{},c&&a!==void 0)this.deletedStates[e][s]!==null&&(this.deletedStates[e][s]=this.deletedStates[e][s]||{},this.deletedStates[e][s][c]=null);else if(a!==void 0)if(this.stateChanges[e]&&this.stateChanges[e][s])for(c in this.deletedStates[e][s]={},this.stateChanges[e][s])this.deletedStates[e][s][c]=null;else this.deletedStates[e][s]=null;else this.deletedStates[e]=null}getState(e,a){let c=String(a),s=o.e({},(this.state[e]||{})[c],(this.stateChanges[e]||{})[c]);if(this.deletedStates[e]===null)return{};if(this.deletedStates[e]){let W=this.deletedStates[e][a];if(W===null)return{};for(let Z in W)delete s[Z]}return s}initializeTileState(e,a){e.setFeatureState(this.state,a)}coalesceChanges(e,a){let c={};for(let s in this.stateChanges){this.state[s]=this.state[s]||{};let W={};for(let Z in this.stateChanges[s])this.state[s][Z]||(this.state[s][Z]={}),o.e(this.state[s][Z],this.stateChanges[s][Z]),W[Z]=this.state[s][Z];c[s]=W}for(let s in this.deletedStates){this.state[s]=this.state[s]||{};let W={};if(this.deletedStates[s]===null)for(let Z in this.state[s])W[Z]={},this.state[s][Z]={};else for(let Z in this.deletedStates[s]){if(this.deletedStates[s][Z]===null)this.state[s][Z]={};else for(let u of Object.keys(this.deletedStates[s][Z]))delete this.state[s][Z][u];W[Z]=this.state[s][Z]}c[s]=c[s]||{},o.e(c[s],W)}if(this.stateChanges={},this.deletedStates={},Object.keys(c).length!==0)for(let s in e)e[s].setFeatureState(c,a)}}let O=89.25;function dt(m,e){let a=o.an(e.lat,-o.ao,o.ao);return new o.P(o.Y(e.lng)*m,o.X(a)*m)}function rt(m,e){return new o.aa(e.x/m,e.y/m).toLngLat()}function Nt(m){return m.cameraToCenterDistance*Math.min(.85*Math.tan(o.ap(90-m.pitch)),Math.tan(o.ap(O-m.pitch)))}function K(m,e){let a=m.canonical,c=e/o.aq(a.z),s=a.x+Math.pow(2,a.z)*m.wrap,W=o.ar(new Float64Array(16));return o.O(W,W,[s*c,a.y*c,0]),o.Q(W,W,[c/o.a4,c/o.a4,1]),W}function ut(m,e,a,c,s){let W=o.aa.fromLngLat(m,e),Z=s*o.as(1,m.lat),u=Z*Math.cos(o.ap(a)),G=Math.sqrt(Z*Z-u*u),U=G*Math.sin(o.ap(-c)),X=G*Math.cos(o.ap(-c));return new o.aa(W.x+U,W.y+X,W.z+u)}function Tt(m,e,a){let c=e.intersectsFrustum(m);if(!a||c===0)return c;let s=e.intersectsPlane(a);return s===0?0:c===2&&s===2?2:1}function Bt(m,e,a){let c=0,s=(a-e)/10;for(let W=0;W<10;W++)c+=s*Math.pow(Math.cos(e+(W+.5)/10*(a-e)),m);return c}function Jt(m,e){return function(a,c,s,W,Z){let u=2*((m-1)/o.at(Math.cos(o.ap(O-Z))/Math.cos(o.ap(O)))-1),G=Math.acos(s/W),U=2*Bt(u-1,0,o.ap(Z/2)),X=Math.min(o.ap(O),G+o.ap(Z/2)),Q=Bt(u-1,Math.min(X,G-o.ap(Z/2)),X),k=Math.atan(c/s),j=Math.hypot(c,s),H=a;return H+=o.at(W/j/Math.max(.5,Math.cos(o.ap(Z/2)))),H+=u*o.at(Math.cos(k))/2,H-=o.at(Math.max(1,Q/U/e))/2,H}}let le=Jt(9.314,3);function he(m,e){let a=(e.roundZoom?Math.round:Math.floor)(m.zoom+o.at(m.tileSize/e.tileSize));return Math.max(0,a)}function Be(m,e){let a=m.getCameraFrustum(),c=m.getClippingPlane(),s=m.screenPointToMercatorCoordinate(m.getCameraPoint()),W=o.aa.fromLngLat(m.center,m.elevation);s.z=W.z+Math.cos(m.pitchInRadians)*m.cameraToCenterDistance/m.worldSize;let Z=m.getCoveringTilesDetailsProvider(),u=Z.allowVariableZoom(m,e),G=he(m,e),U=e.minzoom||0,X=e.maxzoom!==void 0?e.maxzoom:m.maxZoom,Q=Math.min(Math.max(0,G),X),k=Math.pow(2,Q),j=[k*s.x,k*s.y,0],H=[k*W.x,k*W.y,0],q=Math.hypot(W.x-s.x,W.y-s.y),$=Math.abs(W.z-s.z),et=Math.hypot(q,$),nt=Wt=>({zoom:0,x:0,y:0,wrap:Wt,fullyVisible:!1}),mt=[],at=[];if(m.renderWorldCopies&&Z.allowWorldCopies())for(let Wt=1;Wt<=3;Wt++)mt.push(nt(-Wt)),mt.push(nt(Wt));for(mt.push(nt(0));mt.length>0;){let Wt=mt.pop(),Zt=Wt.x,ot=Wt.y,Ft=Wt.fullyVisible,Xt={x:Zt,y:ot,z:Wt.zoom},It=Z.getTileBoundingVolume(Xt,Wt.wrap,m.elevation,e);if(!Ft){let Pt=Tt(a,It,c);if(Pt===0)continue;Ft=Pt===2}let Ut=Z.distanceToTile2d(s.x,s.y,Xt,It),xt=G;u&&(xt=(e.calculateTileZoom||le)(m.zoom+o.at(m.tileSize/e.tileSize),Ut,$,et,m.fov)),xt=(e.roundZoom?Math.round:Math.floor)(xt),xt=Math.max(0,xt);let $t=Math.min(xt,X);if(Wt.wrap=Z.getWrap(W,Xt,Wt.wrap),Wt.zoom>=$t){if(Wt.zoom<U)continue;let Pt=Q-Wt.zoom,At=j[0]-.5-(Zt<<Pt),se=j[1]-.5-(ot<<Pt),Ce=e.reparseOverscaled?Math.max(Wt.zoom,xt):Wt.zoom;at.push({tileID:new o.a1(Wt.zoom===X?Ce:Wt.zoom,Wt.wrap,Wt.zoom,Zt,ot),distanceSq:o.au([H[0]-.5-Zt,H[1]-.5-ot]),tileDistanceToCamera:Math.sqrt(At*At+se*se)})}else for(let Pt=0;Pt<4;Pt++)mt.push({zoom:Wt.zoom+1,x:(Zt<<1)+Pt%2,y:(ot<<1)+(Pt>>1),wrap:Wt.wrap,fullyVisible:Ft})}return at.sort(((Wt,Zt)=>Wt.distanceSq-Zt.distanceSq)).map((Wt=>Wt.tileID))}let Ti=o.ab.fromPoints([new o.P(0,0),new o.P(o.a4,o.a4)]);class Ae extends o.E{constructor(e,a,c){super(),this.id=e,this.dispatcher=c,this.on("data",(s=>this._dataHandler(s))),this.on("dataloading",(()=>{this._sourceErrored=!1})),this.on("error",(()=>{this._sourceErrored=this._source.loaded()})),this._source=((s,W,Z,u)=>{let G=new(cn(W.type))(s,W,Z,u);if(G.id!==s)throw new Error(`Expected Source id to be ${s} instead of ${G.id}`);return G})(e,a,c,this),this._tiles={},this._cache=new o.av(0,(s=>this._unloadTile(s))),this._timers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._rasterFadeDuration=0,this._maxFadingAncestorLevels=5,this._state=new v,this._didEmitContent=!1,this._updated=!1}onAdd(e){this.map=e,this._maxTileCacheSize=e?e._maxTileCacheSize:null,this._maxTileCacheZoomLevels=e?e._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(e)}onRemove(e){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(e)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(let e in this._tiles){let a=this._tiles[e];if(a.state!=="loaded"&&a.state!=="errored")return!1}return!0}getSource(){return this._source}getState(){return this._state}pause(){this._paused=!0}resume(){if(!this._paused)return;let e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(e,a,c){return o._(this,void 0,void 0,(function*(){try{yield this._source.loadTile(e),this._tileLoaded(e,a,c)}catch(s){e.state="errored",s.status!==404?this._source.fire(new o.k(s,{tile:e})):this.update(this.transform,this.terrain)}}))}_unloadTile(e){this._source.unloadTile&&this._source.unloadTile(e)}_abortTile(e){this._source.abortTile&&this._source.abortTile(e),this._source.fire(new o.l("dataabort",{tile:e,coord:e.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(let a in this._tiles){let c=this._tiles[a];c.upload(e),c.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map((e=>e.tileID)).sort(Oe).map((e=>e.key))}getRenderableIds(e){let a=[];for(let c in this._tiles)this._isIdRenderable(c,e)&&a.push(this._tiles[c]);return e?a.sort(((c,s)=>{let W=c.tileID,Z=s.tileID,u=new o.P(W.canonical.x,W.canonical.y)._rotate(-this.transform.bearingInRadians),G=new o.P(Z.canonical.x,Z.canonical.y)._rotate(-this.transform.bearingInRadians);return W.overscaledZ-Z.overscaledZ||G.y-u.y||G.x-u.x})).map((c=>c.tileID.key)):a.map((c=>c.tileID)).sort(Oe).map((c=>c.key))}hasRenderableParent(e){let a=e.overscaledZ-1;if(a>=this._source.minzoom){let c=this.getLoadedTile(e.scaledTo(a));if(c)return this._isIdRenderable(c.tileID.key)}return!1}_isIdRenderable(e,a=!1){var c;return(c=this._tiles[e])===null||c===void 0?void 0:c.isRenderable(a)}reload(e,a=void 0){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(let c in this._tiles)a&&this._source.shouldReloadTile&&!this._source.shouldReloadTile(this._tiles[c],a)||(e?this._reloadTile(c,"expired"):this._tiles[c].state!=="errored"&&this._reloadTile(c,"reloading"))}}_reloadTile(e,a){return o._(this,void 0,void 0,(function*(){let c=this._tiles[e];c&&(c.state!=="loading"&&(c.state=a),yield this._loadTile(c,e,a))}))}_tileLoaded(e,a,c){e.timeAdded=jt(),e.selfFading&&(e.fadeEndTime=e.timeAdded+this._rasterFadeDuration),c==="expired"&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(a,e),this.getSource().type==="raster-dem"&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),e.aborted||this._source.fire(new o.l("data",{dataType:"source",tile:e,coord:e.tileID}))}_backfillDEM(e){let a=this.getRenderableIds();for(let s=0;s<a.length;s++){let W=a[s];if(e.neighboringTiles&&e.neighboringTiles[W]){let Z=this.getTileByID(W);c(e,Z),c(Z,e)}}function c(s,W){s.needsHillshadePrepare=!0,s.needsTerrainPrepare=!0;let Z=W.tileID.canonical.x-s.tileID.canonical.x,u=W.tileID.canonical.y-s.tileID.canonical.y,G=Math.pow(2,s.tileID.canonical.z),U=W.tileID.key;Z===0&&u===0||Math.abs(u)>1||(Math.abs(Z)>1&&(Math.abs(Z+G)===1?Z+=G:Math.abs(Z-G)===1&&(Z-=G)),W.dem&&s.dem&&(s.dem.backfillBorder(W.dem,Z,u),s.neighboringTiles&&s.neighboringTiles[U]&&(s.neighboringTiles[U].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,a){let c=this._getLoadedDescendents(a),s=new Set;for(let W of a){let Z=c[W.key];if(!Z?.length){s.add(W);continue}let u=W.overscaledZ+Ae.maxOverzooming,G=Z.filter((Q=>Q.tileID.overscaledZ<=u));if(!G.length){s.add(W);continue}let U=Math.min(...G.map((Q=>Q.tileID.overscaledZ))),X=G.filter((Q=>Q.tileID.overscaledZ===U)).map((Q=>Q.tileID));for(let Q of X)e[Q.key]=Q;this._areDescendentsComplete(X,U,W.overscaledZ)||s.add(W)}return s}_getLoadedDescendents(e){var a;let c={};for(let s in this._tiles){let W=this._tiles[s];if(W.hasData())for(let Z of e)W.tileID.isChildOf(Z)&&(c[a=Z.key]||(c[a]=[])).push(W)}return c}_areDescendentsComplete(e,a,c){return e.length===1&&e[0].isOverscaled()?e[0].overscaledZ===a:Math.pow(4,a-c)===e.length}getLoadedTile(e){let a=this._tiles[e.key];return a?.hasData()?a:null}updateCacheSize(e){let a=Math.ceil(e.width/this._source.tileSize)+1,c=Math.ceil(e.height/this._source.tileSize)+1,s=Math.floor(a*c*(this._maxTileCacheZoomLevels===null?o.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),W=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,s):s;this._cache.setMaxSize(W)}handleWrapJump(e){let a=Math.round((e-(this._prevLng===void 0?e:this._prevLng))/360);if(this._prevLng=e,a){let c={};for(let s in this._tiles){let W=this._tiles[s];W.tileID=W.tileID.unwrapTo(W.tileID.wrap+a),c[W.tileID.key]=W}this._tiles=c,this._resetTileReloadTimers()}}update(e,a){if(!this._sourceLoaded||this._paused)return;let c;this.transform=e,this.terrain=a,this.updateCacheSize(e),this.handleWrapJump(this.transform.center.lng),this.used||this.usedForTerrain?this._source.tileID?c=e.getVisibleUnwrappedCoordinates(this._source.tileID).map((G=>new o.a1(G.canonical.z,G.wrap,G.canonical.z,G.canonical.x,G.canonical.y))):(c=Be(e,{tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.type==="vector"&&this.map._zoomLevelsToOverscale!==void 0?e.maxZoom-this.map._zoomLevelsToOverscale:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:a,calculateTileZoom:this._source.calculateTileZoom}),this._source.hasTile&&(c=c.filter((G=>this._source.hasTile(G))))):c=[],this.usedForTerrain&&(c=this._addTerrainIdealTiles(c));let s=c.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,s&&this.fire(new o.l("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));let W=he(e,this._source),Z=this._updateRetainedTiles(c,W),u=ai(this._source.type);u&&this._rasterFadeDuration>0&&!a&&this._updateFadingTiles(c,Z),u?this._cleanUpRasterTiles(Z):this._cleanUpVectorTiles(Z)}_cleanUpRasterTiles(e){for(let a in this._tiles)e[a]||this._removeTile(a)}_cleanUpVectorTiles(e){for(let a in this._tiles){let c=this._tiles[a];e[a]?c.clearSymbolFadeHold():c.hasSymbolBuckets?c.holdingForSymbolFade()?c.symbolFadeFinished()&&this._removeTile(a):c.setSymbolHoldDuration(this.map._fadeDuration):this._removeTile(a)}}_addTerrainIdealTiles(e){let a=[];for(let c of e)if(c.canonical.z>this._source.minzoom){let s=c.scaledTo(c.canonical.z-1);a.push(s);let W=c.scaledTo(Math.max(this._source.minzoom,Math.min(c.canonical.z,5)));a.push(W)}return e.concat(a)}releaseSymbolFadeTiles(){for(let e in this._tiles)this._tiles[e].holdingForSymbolFade()&&this._removeTile(e)}_updateRetainedTiles(e,a){var c;let s=new Set;for(let U of e)this._addTile(U).hasData()||s.add(U);let W=e.reduce(((U,X)=>(U[X.key]=X,U)),{}),Z=this._retainLoadedChildren(W,s),u={},G=Math.max(a-Ae.maxUnderzooming,this._source.minzoom);for(let U of Z){let X=this._tiles[U.key],Q=X?.wasRequested();for(let k=U.overscaledZ-1;k>=G;--k){let j=U.scaledTo(k);if(u[j.key])break;if(u[j.key]=!0,X=this.getTile(j),!X&&Q&&(X=this._addTile(j)),X){let H=X.hasData();if((H||!(!((c=this.map)===null||c===void 0)&&c.cancelPendingTileRequestsWhileZooming)||Q)&&(W[j.key]=j),Q=X.wasRequested(),H)break}}}return W}_updateFadingTiles(e,a){let c=jt(),s=o.aw(e);for(let W of e){let Z=this._tiles[W.key];Z.fadingDirection!==ht.Departing&&Z.fadeOpacity!==0||Z.resetFadeLogic(),this._updateFadingAncestor(Z,a,c)||this._updateFadingDescendents(Z,a,c)||this._updateFadingEdge(Z,s,c)||Z.resetFadeLogic()}}_updateFadingAncestor(e,a,c){if(!e.hasData())return!1;let{tileID:s,fadingRole:W,fadingDirection:Z,fadingParentID:u}=e;if(W===Di.Base&&Z===ht.Incoming&&u)return a[u.key]=u,!0;let G=Math.max(s.overscaledZ-this._maxFadingAncestorLevels,this._source.minzoom);for(let U=s.overscaledZ-1;U>=G;U--){let X=s.scaledTo(U),Q=this.getLoadedTile(X);if(Q)return e.setCrossFadeLogic({fadingRole:Di.Base,fadingDirection:ht.Incoming,fadingParentID:Q.tileID,fadeEndTime:c+this._rasterFadeDuration}),Q.setCrossFadeLogic({fadingRole:Di.Parent,fadingDirection:ht.Departing,fadeEndTime:c+this._rasterFadeDuration}),a[X.key]=X,!0}return!1}_updateFadingDescendents(e,a,c){if(!e.hasData())return!1;let s=e.tileID.children(this._source.maxzoom),W=this._updateFadingChildren(e,s,a,c);if(W)return!0;for(let Z of s){let u=Z.children(this._source.maxzoom);this._updateFadingChildren(e,u,a,c)&&(W=!0)}return W}_updateFadingChildren(e,a,c,s){if(a[0].overscaledZ>=this._source.maxzoom)return!1;let W=!1;for(let Z of a){let u=this.getLoadedTile(Z);if(!u)continue;let{fadingRole:G,fadingDirection:U,fadingParentID:X}=u;G===Di.Base&&U===ht.Departing&&X||(u.setCrossFadeLogic({fadingRole:Di.Base,fadingDirection:ht.Departing,fadingParentID:e.tileID,fadeEndTime:s+this._rasterFadeDuration}),e.setCrossFadeLogic({fadingRole:Di.Parent,fadingDirection:ht.Incoming,fadeEndTime:s+this._rasterFadeDuration})),c[Z.key]=Z,W=!0}return W}_updateFadingEdge(e,a,c){let s=e.tileID;return!!e.selfFading||!e.hasData()&&!!a.has(s)&&(e.setSelfFadeLogic(c+this._rasterFadeDuration),!0)}_addTile(e){let a=this._tiles[e.key];if(a)return a;a=this._cache.getAndRemove(e),a&&(a.resetFadeLogic(),this._setTileReloadTimer(e.key,a),a.tileID=e,this._state.initializeTileState(a,this.map?this.map.painter:null));let c=a;return a||(a=new z(e,this._source.tileSize*e.overscaleFactor()),this._loadTile(a,e.key,a.state)),a.uses++,this._tiles[e.key]=a,c||this._source.fire(new o.l("dataloading",{tile:a,coord:a.tileID,dataType:"source"})),a}_setTileReloadTimer(e,a){this._clearTileReloadTimer(e);let c=a.getExpiryTimeout();c&&(this._timers[e]=setTimeout((()=>{this._reloadTile(e,"expired"),delete this._timers[e]}),c))}_clearTileReloadTimer(e){let a=this._timers[e];a&&(clearTimeout(a),delete this._timers[e])}_resetTileReloadTimers(){for(let e in this._timers)clearTimeout(this._timers[e]),delete this._timers[e];for(let e in this._tiles)this._setTileReloadTimer(e,this._tiles[e])}refreshTiles(e){for(let a in this._tiles)(this._isIdRenderable(a)||this._tiles[a].state=="errored")&&e.some((c=>c.equals(this._tiles[a].tileID.canonical)))&&this._reloadTile(a,"expired")}_removeTile(e){let a=this._tiles[e];a&&(a.uses--,delete this._tiles[e],this._clearTileReloadTimer(e),a.uses>0||(a.hasData()&&a.state!=="reloading"?this._cache.add(a.tileID,a,a.getExpiryTimeout()):(a.aborted=!0,this._abortTile(a),this._unloadTile(a))))}_dataHandler(e){e.dataType==="source"&&(e.sourceDataType!=="metadata"?e.sourceDataType==="content"&&this._sourceLoaded&&!this._paused&&(this.reload(e.sourceDataChanged,e.shouldReloadTileOptions),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0):this._sourceLoaded=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(let e in this._tiles)this._removeTile(e);this._cache.reset()}tilesIn(e,a,c){let s=[],W=this.transform;if(!W)return s;let Z=W.getCoveringTilesDetailsProvider().allowWorldCopies(),u=c?W.getCameraQueryGeometry(e):e,G=j=>W.screenPointToMercatorCoordinate(j,this.terrain),U=this.transformBbox(e,G,!Z),X=this.transformBbox(u,G,!Z),Q=this.getIds(),k=o.ab.fromPoints(X);for(let j=0;j<Q.length;j++){let H=this._tiles[Q[j]];if(H.holdingForSymbolFade())continue;let q=Z?[H.tileID]:[H.tileID.unwrapTo(-1),H.tileID.unwrapTo(0)],$=Math.pow(2,W.zoom-H.tileID.overscaledZ),et=a*H.queryPadding*o.a4/H.tileSize/$;for(let nt of q){let mt=k.map((at=>nt.getTilePoint(new o.aa(at.x,at.y))));if(mt.expandBy(et),mt.intersects(Ti)){let at=U.map((Zt=>nt.getTilePoint(Zt))),Wt=X.map((Zt=>nt.getTilePoint(Zt)));s.push({tile:H,tileID:Z?nt:nt.unwrapTo(0),queryGeometry:at,cameraQueryGeometry:Wt,scale:$})}}}return s}transformBbox(e,a,c){let s=e.map(a);if(c){let W=o.ab.fromPoints(e);W.shrinkBy(.001*Math.min(W.width(),W.height()));let Z=W.map(a);o.ab.fromPoints(s).covers(Z)||(s=s.map((u=>u.x>.5?new o.aa(u.x-1,u.y,u.z):u)))}return s}getVisibleCoordinates(e){let a=this.getRenderableIds(e).map((c=>this._tiles[c].tileID));return this.transform&&this.transform.populateCache(a),a}hasTransition(){if(this._source.hasTransition())return!0;if(ai(this._source.type)&&this._rasterFadeDuration>0){let e=jt();for(let a in this._tiles)if(this._tiles[a].fadeEndTime>=e)return!0}return!1}setRasterFadeDuration(e){this._rasterFadeDuration=e}setFeatureState(e,a,c){this._state.updateState(e=e||o.a9,a,c)}removeFeatureState(e,a,c){this._state.removeFeatureState(e=e||o.a9,a,c)}getFeatureState(e,a){return this._state.getState(e=e||o.a9,a)}setDependencies(e,a,c){let s=this._tiles[e];s&&s.setDependencies(a,c)}reloadTilesForDependencies(e,a){for(let c in this._tiles)this._tiles[c].hasDependency(e,a)&&this._reloadTile(c,"reloading");this._cache.filter((c=>!c.hasDependency(e,a)))}}function Oe(m,e){let a=Math.abs(2*m.wrap)-+(m.wrap<0),c=Math.abs(2*e.wrap)-+(e.wrap<0);return m.overscaledZ-e.overscaledZ||c-a||e.canonical.y-m.canonical.y||e.canonical.x-m.canonical.x}function ai(m){return m==="raster"||m==="image"||m==="video"}Ae.maxUnderzooming=10,Ae.maxOverzooming=3;class ft{constructor(e,a){this.reset(e,a)}reset(e,a){this.points=e||[],this._distances=[0];for(let c=1;c<this.points.length;c++)this._distances[c]=this._distances[c-1]+this.points[c].dist(this.points[c-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(a||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(e){if(this.points.length===1)return this.points[0];e=o.an(e,0,1);let a=1,c=this._distances[a],s=e*this.paddedLength+this.padding;for(;c<s&&a<this._distances.length;)c=this._distances[++a];let W=a-1,Z=this._distances[W],u=c-Z,G=u>0?(s-Z)/u:0;return this.points[W].mult(1-G).add(this.points[a].mult(G))}}function oi(m,e){let a=!0;return m==="always"||m!=="never"&&e!=="never"||(a=!1),a}class hi{constructor(e,a,c){let s=this.boxCells=[],W=this.circleCells=[];this.xCellCount=Math.ceil(e/c),this.yCellCount=Math.ceil(a/c);for(let Z=0;Z<this.xCellCount*this.yCellCount;Z++)s.push([]),W.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=e,this.height=a,this.xScale=this.xCellCount/e,this.yScale=this.yCellCount/a,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(e,a,c,s,W){this._forEachCell(a,c,s,W,this._insertBoxCell,this.boxUid++),this.boxKeys.push(e),this.bboxes.push(a),this.bboxes.push(c),this.bboxes.push(s),this.bboxes.push(W)}insertCircle(e,a,c,s){this._forEachCell(a-s,c-s,a+s,c+s,this._insertCircleCell,this.circleUid++),this.circleKeys.push(e),this.circles.push(a),this.circles.push(c),this.circles.push(s)}_insertBoxCell(e,a,c,s,W,Z){this.boxCells[W].push(Z)}_insertCircleCell(e,a,c,s,W,Z){this.circleCells[W].push(Z)}_query(e,a,c,s,W,Z,u){if(c<0||e>this.width||s<0||a>this.height)return[];let G=[];if(e<=0&&a<=0&&this.width<=c&&this.height<=s){if(W)return[{key:null,x1:e,y1:a,x2:c,y2:s}];for(let U=0;U<this.boxKeys.length;U++)G.push({key:this.boxKeys[U],x1:this.bboxes[4*U],y1:this.bboxes[4*U+1],x2:this.bboxes[4*U+2],y2:this.bboxes[4*U+3]});for(let U=0;U<this.circleKeys.length;U++){let X=this.circles[3*U],Q=this.circles[3*U+1],k=this.circles[3*U+2];G.push({key:this.circleKeys[U],x1:X-k,y1:Q-k,x2:X+k,y2:Q+k})}}else this._forEachCell(e,a,c,s,this._queryCell,G,{hitTest:W,overlapMode:Z,seenUids:{box:{},circle:{}}},u);return G}query(e,a,c,s){return this._query(e,a,c,s,!1,null)}hitTest(e,a,c,s,W,Z){return this._query(e,a,c,s,!0,W,Z).length>0}hitTestCircle(e,a,c,s,W){let Z=e-c,u=e+c,G=a-c,U=a+c;if(u<0||Z>this.width||U<0||G>this.height)return!1;let X=[];return this._forEachCell(Z,G,u,U,this._queryCellCircle,X,{hitTest:!0,overlapMode:s,circle:{x:e,y:a,radius:c},seenUids:{box:{},circle:{}}},W),X.length>0}_queryCell(e,a,c,s,W,Z,u,G){let{seenUids:U,hitTest:X,overlapMode:Q}=u,k=this.boxCells[W];if(k!==null){let H=this.bboxes;for(let q of k)if(!U.box[q]){U.box[q]=!0;let $=4*q,et=this.boxKeys[q];if(e<=H[$+2]&&a<=H[$+3]&&c>=H[$+0]&&s>=H[$+1]&&(!G||G(et))&&(!X||!oi(Q,et.overlapMode))&&(Z.push({key:et,x1:H[$],y1:H[$+1],x2:H[$+2],y2:H[$+3]}),X))return!0}}let j=this.circleCells[W];if(j!==null){let H=this.circles;for(let q of j)if(!U.circle[q]){U.circle[q]=!0;let $=3*q,et=this.circleKeys[q];if(this._circleAndRectCollide(H[$],H[$+1],H[$+2],e,a,c,s)&&(!G||G(et))&&(!X||!oi(Q,et.overlapMode))){let nt=H[$],mt=H[$+1],at=H[$+2];if(Z.push({key:et,x1:nt-at,y1:mt-at,x2:nt+at,y2:mt+at}),X)return!0}}}return!1}_queryCellCircle(e,a,c,s,W,Z,u,G){let{circle:U,seenUids:X,overlapMode:Q}=u,k=this.boxCells[W];if(k!==null){let H=this.bboxes;for(let q of k)if(!X.box[q]){X.box[q]=!0;let $=4*q,et=this.boxKeys[q];if(this._circleAndRectCollide(U.x,U.y,U.radius,H[$+0],H[$+1],H[$+2],H[$+3])&&(!G||G(et))&&!oi(Q,et.overlapMode))return Z.push(!0),!0}}let j=this.circleCells[W];if(j!==null){let H=this.circles;for(let q of j)if(!X.circle[q]){X.circle[q]=!0;let $=3*q,et=this.circleKeys[q];if(this._circlesCollide(H[$],H[$+1],H[$+2],U.x,U.y,U.radius)&&(!G||G(et))&&!oi(Q,et.overlapMode))return Z.push(!0),!0}}}_forEachCell(e,a,c,s,W,Z,u,G){let U=this._convertToXCellCoord(e),X=this._convertToYCellCoord(a),Q=this._convertToXCellCoord(c),k=this._convertToYCellCoord(s);for(let j=U;j<=Q;j++)for(let H=X;H<=k;H++)if(W.call(this,e,a,c,s,this.xCellCount*H+j,Z,u,G))return}_convertToXCellCoord(e){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(e*this.xScale)))}_convertToYCellCoord(e){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(e*this.yScale)))}_circlesCollide(e,a,c,s,W,Z){let u=s-e,G=W-a,U=c+Z;return U*U>u*u+G*G}_circleAndRectCollide(e,a,c,s,W,Z,u){let G=(Z-s)/2,U=Math.abs(e-(s+G));if(U>G+c)return!1;let X=(u-W)/2,Q=Math.abs(a-(W+X));if(Q>X+c)return!1;if(U<=G||Q<=X)return!0;let k=U-G,j=Q-X;return k*k+j*j<=c*c}}function tl(m,e,a){let c=o.N();if(!m){let{vecSouth:Q,vecEast:k}=Ot(e),j=Ct();j[0]=k[0],j[1]=k[1],j[2]=Q[0],j[3]=Q[1],s=j,(X=(Z=(W=j)[0])*(U=W[3])-(G=W[2])*(u=W[1]))&&(s[0]=U*(X=1/X),s[1]=-u*X,s[2]=-G*X,s[3]=Z*X),c[0]=j[0],c[1]=j[1],c[4]=j[2],c[5]=j[3]}var s,W,Z,u,G,U,X;return o.Q(c,c,[1/a,1/a,1]),c}function Zi(m,e,a,c){if(m){let s=o.N();if(!e){let{vecSouth:W,vecEast:Z}=Ot(a);s[0]=Z[0],s[1]=Z[1],s[4]=W[0],s[5]=W[1]}return o.Q(s,s,[c,c,1]),s}return a.pixelsToClipSpaceMatrix}function Ot(m){let e=Math.cos(m.rollInRadians),a=Math.sin(m.rollInRadians),c=Math.cos(m.pitchInRadians),s=Math.cos(m.bearingInRadians),W=Math.sin(m.bearingInRadians),Z=o.aB();Z[0]=-s*c*a-W*e,Z[1]=-W*c*a+s*e;let u=o.aC(Z);u<1e-9?o.aD(Z):o.aE(Z,Z,1/u);let G=o.aB();G[0]=s*c*e-W*a,G[1]=W*c*e+s*a;let U=o.aC(G);return U<1e-9?o.aD(G):o.aE(G,G,1/U),{vecEast:G,vecSouth:Z}}function be(m,e,a,c){let s;c?(s=[m,e,c(m,e),1],o.aG(s,s,a)):(s=[m,e,0,1],wn(s,s,a));let W=s[3];return{point:new o.P(s[0]/W,s[1]/W),signedDistanceFromCamera:W,isOccluded:!1}}function ue(m,e){return .5+m/e*.5}function jl(m,e){return m.x>=-e[0]&&m.x<=e[0]&&m.y>=-e[1]&&m.y<=e[1]}function zn(m,e,a,c,s,W,Z,u,G,U,X,Q,k){let j=a?m.textSizeData:m.iconSizeData,H=o.ax(j,e.transform.zoom),q=[256/e.width*2+1,256/e.height*2+1],$=a?m.text.dynamicLayoutVertexArray:m.icon.dynamicLayoutVertexArray;$.clear();let et=m.lineVertexArray,nt=a?m.text.placedSymbolArray:m.icon.placedSymbolArray,mt=e.transform.width/e.transform.height,at=!1;for(let Wt=0;Wt<nt.length;Wt++){let Zt=nt.get(Wt);if(Zt.hidden||Zt.writingMode===o.ay.vertical&&!at){Oa(Zt.numGlyphs,$);continue}at=!1;let ot=new o.P(Zt.anchorX,Zt.anchorY),Ft={getElevation:k,pitchedLabelPlaneMatrix:c,lineVertexArray:et,pitchWithMap:W,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:e.transform,tileAnchorPoint:ot,unwrappedTileID:G,width:U,height:X,translation:Q},Xt=fa(Zt.anchorX,Zt.anchorY,Ft);if(!jl(Xt.point,q)){Oa(Zt.numGlyphs,$);continue}let It=ue(e.transform.cameraToCenterDistance,Xt.signedDistanceFromCamera),Ut=o.az(j,H,Zt),xt=W?Ut*e.transform.getPitchedTextCorrection(Zt.anchorX,Zt.anchorY,G)/It:Ut*It,$t=ka({projectionContext:Ft,pitchedLabelPlaneMatrixInverse:s,symbol:Zt,fontSize:xt,flip:!1,keepUpright:Z,glyphOffsetArray:m.glyphOffsetArray,dynamicLayoutVertexArray:$,aspectRatio:mt,rotateToLine:u});at=$t.useVertical,($t.notEnoughRoom||at||$t.needsFlipping&&ka({projectionContext:Ft,pitchedLabelPlaneMatrixInverse:s,symbol:Zt,fontSize:xt,flip:!0,keepUpright:Z,glyphOffsetArray:m.glyphOffsetArray,dynamicLayoutVertexArray:$,aspectRatio:mt,rotateToLine:u}).notEnoughRoom)&&Oa(Zt.numGlyphs,$)}a?m.text.dynamicLayoutVertexBuffer.updateData($):m.icon.dynamicLayoutVertexBuffer.updateData($)}function Ji(m,e,a,c,s,W,Z,u){let G=W.glyphStartIndex+W.numGlyphs,U=W.lineStartIndex,X=W.lineStartIndex+W.lineLength,Q=e.getoffsetX(W.glyphStartIndex),k=e.getoffsetX(G-1),j=bi(m*Q,a,c,s,W.segment,U,X,u,Z);if(!j)return null;let H=bi(m*k,a,c,s,W.segment,U,X,u,Z);return H?u.projectionCache.anyProjectionOccluded?null:{first:j,last:H}:null}function Ne(m,e,a,c){return m===o.ay.horizontal&&Math.abs(a.y-e.y)>Math.abs(a.x-e.x)*c?{useVertical:!0}:(m===o.ay.vertical?e.y<a.y:e.x>a.x)?{needsFlipping:!0}:null}function ka(m){let{projectionContext:e,pitchedLabelPlaneMatrixInverse:a,symbol:c,fontSize:s,flip:W,keepUpright:Z,glyphOffsetArray:u,dynamicLayoutVertexArray:G,aspectRatio:U,rotateToLine:X}=m,Q=s/24,k=c.lineOffsetX*Q,j=c.lineOffsetY*Q,H;if(c.numGlyphs>1){let q=c.glyphStartIndex+c.numGlyphs,$=c.lineStartIndex,et=c.lineStartIndex+c.lineLength,nt=Ji(Q,u,k,j,W,c,X,e);if(!nt)return{notEnoughRoom:!0};let mt=jn(nt.first.point.x,nt.first.point.y,e,a),at=jn(nt.last.point.x,nt.last.point.y,e,a);if(Z&&!W){let Wt=Ne(c.writingMode,mt,at,U);if(Wt)return Wt}H=[nt.first];for(let Wt=c.glyphStartIndex+1;Wt<q-1;Wt++){let Zt=bi(Q*u.getoffsetX(Wt),k,j,W,c.segment,$,et,e,X);if(!Zt)return{notEnoughRoom:!0};H.push(Zt)}H.push(nt.last)}else{if(Z&&!W){let $=Ia(e.tileAnchorPoint.x,e.tileAnchorPoint.y,e).point,et=c.lineStartIndex+c.segment+1,nt=new o.P(e.lineVertexArray.getx(et),e.lineVertexArray.gety(et)),mt=Ia(nt.x,nt.y,e),at=mt.signedDistanceFromCamera>0?mt.point:Gn(e.tileAnchorPoint,nt,$,1,e),Wt=jn($.x,$.y,e,a),Zt=jn(at.x,at.y,e,a),ot=Ne(c.writingMode,Wt,Zt,U);if(ot)return ot}let q=bi(Q*u.getoffsetX(c.glyphStartIndex),k,j,W,c.segment,c.lineStartIndex,c.lineStartIndex+c.lineLength,e,X);if(!q||e.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};H=[q]}for(let q of H)o.aF(G,q.point,q.angle);return{}}function Gn(m,e,a,c,s){let W=m.add(m.sub(e)._unit()),Z=Ia(W.x,W.y,s).point,u=a.sub(Z);return a.add(u._mult(c/u.mag()))}function on(m,e,a){let c=e.projectionCache;if(c.projections[m])return c.projections[m];let s=new o.P(e.lineVertexArray.getx(m),e.lineVertexArray.gety(m)),W=Ia(s.x,s.y,e);if(W.signedDistanceFromCamera>0)return c.projections[m]=W.point,c.anyProjectionOccluded=c.anyProjectionOccluded||W.isOccluded,W.point;let Z=m-a.direction;return Gn(a.distanceFromAnchor===0?e.tileAnchorPoint:new o.P(e.lineVertexArray.getx(Z),e.lineVertexArray.gety(Z)),s,a.previousVertex,a.absOffsetX-a.distanceFromAnchor+1,e)}function Ia(m,e,a){let c=m+a.translation[0],s=e+a.translation[1],W;return a.pitchWithMap?(W=be(c,s,a.pitchedLabelPlaneMatrix,a.getElevation),W.isOccluded=!1):(W=a.transform.projectTileCoordinates(c,s,a.unwrappedTileID,a.getElevation),W.point.x=(.5*W.point.x+.5)*a.width,W.point.y=(.5*-W.point.y+.5)*a.height),W}function jn(m,e,a,c){if(a.pitchWithMap){let s=[m,e,0,1];return o.aG(s,s,c),a.transform.projectTileCoordinates(s[0]/s[3],s[1]/s[3],a.unwrappedTileID,a.getElevation).point}return{x:m/a.width*2-1,y:1-e/a.height*2}}function fa(m,e,a){return a.transform.projectTileCoordinates(m,e,a.unwrappedTileID,a.getElevation)}function An(m,e,a){return m._unit()._perp()._mult(e*a)}function $l(m,e,a,c,s,W,Z,u,G){if(u.projectionCache.offsets[m])return u.projectionCache.offsets[m];let U=a.add(e);if(m+G.direction<c||m+G.direction>=s)return u.projectionCache.offsets[m]=U,U;let X=on(m+G.direction,u,G),Q=An(X.sub(a),Z,G.direction),k=a.add(Q),j=X.add(Q);return u.projectionCache.offsets[m]=o.aH(W,U,k,j)||U,u.projectionCache.offsets[m]}function bi(m,e,a,c,s,W,Z,u,G){let U=c?m-e:m+e,X=U>0?1:-1,Q=0;c&&(X*=-1,Q=Math.PI),X<0&&(Q+=Math.PI);let k,j=X>0?W+s:W+s+1;u.projectionCache.cachedAnchorPoint?k=u.projectionCache.cachedAnchorPoint:(k=Ia(u.tileAnchorPoint.x,u.tileAnchorPoint.y,u).point,u.projectionCache.cachedAnchorPoint=k);let H,q,$=k,et=k,nt=0,mt=0,at=Math.abs(U),Wt=[],Zt;for(;nt+mt<=at;){if(j+=X,j<W||j>=Z)return null;nt+=mt,et=$,q=H;let Xt={absOffsetX:at,direction:X,distanceFromAnchor:nt,previousVertex:et};if($=on(j,u,Xt),a===0)Wt.push(et),Zt=$.sub(et);else{let It,Ut=$.sub(et);It=Ut.mag()===0?An(on(j+X,u,Xt).sub($),a,X):An(Ut,a,X),q||(q=et.add(It)),H=$l(j,It,$,W,Z,q,a,u,Xt),Wt.push(q),Zt=H.sub(q)}mt=Zt.mag()}let ot=Zt._mult((at-nt)/mt)._add(q||et),Ft=Q+Math.atan2($.y-et.y,$.x-et.x);return Wt.push(ot),{point:ot,angle:G?Ft:0,path:Wt}}let Qo=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Oa(m,e){for(let a=0;a<m;a++){let c=e.length;e.resize(c+4),e.float32.set(Qo,3*c)}}function wn(m,e,a){let c=e[0],s=e[1];return m[0]=a[0]*c+a[4]*s+a[12],m[1]=a[1]*c+a[5]*s+a[13],m[3]=a[3]*c+a[7]*s+a[15],m}let Xi=100;class Nn{constructor(e,a=new hi(e.width+200,e.height+200,25),c=new hi(e.width+200,e.height+200,25)){this.transform=e,this.grid=a,this.ignoredGrid=c,this.pitchFactor=Math.cos(e.pitch*Math.PI/180)*e.cameraToCenterDistance,this.screenRightBoundary=e.width+Xi,this.screenBottomBoundary=e.height+Xi,this.gridRightBoundary=e.width+200,this.gridBottomBoundary=e.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(e,a,c,s,W,Z,u,G,U,X,Q,k){let j=this.projectAndGetPerspectiveRatio(e.anchorPointX+G[0],e.anchorPointY+G[1],W,X,k),H=c*j.perspectiveRatio,q;if(Z||u)q=this._projectCollisionBox(e,H,s,W,Z,u,G,j,X,Q,k);else{let Zt=j.x+(Q?Q.x*H:0),ot=j.y+(Q?Q.y*H:0);q={allPointsOccluded:!1,box:[Zt+e.x1*H,ot+e.y1*H,Zt+e.x2*H,ot+e.y2*H]}}let[$,et,nt,mt]=q.box,at=Z?q.allPointsOccluded:j.isOccluded,Wt=at;return Wt||(Wt=j.perspectiveRatio<this.perspectiveRatioCutoff),Wt||(Wt=!this.isInsideGrid($,et,nt,mt)),Wt||a!=="always"&&this.grid.hitTest($,et,nt,mt,a,U)?{box:[$,et,nt,mt],placeable:!1,offscreen:!1,occluded:at}:{box:[$,et,nt,mt],placeable:!0,offscreen:this.isOffscreen($,et,nt,mt),occluded:at}}placeCollisionCircles(e,a,c,s,W,Z,u,G,U,X,Q,k,j,H){let q=[],$=new o.P(a.anchorX,a.anchorY),et=this.getPerspectiveRatio($.x,$.y,Z,H),nt=(U?W*this.transform.getPitchedTextCorrection(a.anchorX,a.anchorY,Z)/et:W*et)/o.aL,mt={getElevation:H,pitchedLabelPlaneMatrix:u,lineVertexArray:c,pitchWithMap:U,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:this.transform,tileAnchorPoint:$,unwrappedTileID:Z,width:this.transform.width,height:this.transform.height,translation:j},at=Ji(nt,s,a.lineOffsetX*nt,a.lineOffsetY*nt,!1,a,!1,mt),Wt=!1,Zt=!1,ot=!0;if(at){let Ft=.5*Q*et+k,Xt=new o.P(-100,-100),It=new o.P(this.screenRightBoundary,this.screenBottomBoundary),Ut=new ft,xt=at.first,$t=at.last,Pt=[];for(let Ce=xt.path.length-1;Ce>=1;Ce--)Pt.push(xt.path[Ce]);for(let Ce=1;Ce<$t.path.length;Ce++)Pt.push($t.path[Ce]);let At=2.5*Ft;if(U){let Ce=this.projectPathToScreenSpace(Pt,mt);Pt=Ce.some((Je=>Je.signedDistanceFromCamera<=0))?[]:Ce.map((Je=>Je.point))}let se=[];if(Pt.length>0){let Ce=Pt[0].clone(),Je=Pt[0].clone();for(let Mi=1;Mi<Pt.length;Mi++)Ce.x=Math.min(Ce.x,Pt[Mi].x),Ce.y=Math.min(Ce.y,Pt[Mi].y),Je.x=Math.max(Je.x,Pt[Mi].x),Je.y=Math.max(Je.y,Pt[Mi].y);se=Ce.x>=Xt.x&&Je.x<=It.x&&Ce.y>=Xt.y&&Je.y<=It.y?[Pt]:Je.x<Xt.x||Ce.x>It.x||Je.y<Xt.y||Ce.y>It.y?[]:o.aI([Pt],Xt.x,Xt.y,It.x,It.y)}for(let Ce of se){Ut.reset(Ce,.25*Ft);let Je=0;Je=Ut.length<=.5*Ft?1:Math.ceil(Ut.paddedLength/At)+1;for(let Mi=0;Mi<Je;Mi++){let Yi=Mi/Math.max(Je-1,1),zi=Ut.lerp(Yi),Ni=zi.x+Xi,pl=zi.y+Xi;q.push(Ni,pl,Ft,0);let Bi=Ni-Ft,sl=pl-Ft,al=Ni+Ft,bl=pl+Ft;if(ot=ot&&this.isOffscreen(Bi,sl,al,bl),Zt=Zt||this.isInsideGrid(Bi,sl,al,bl),e!=="always"&&this.grid.hitTestCircle(Ni,pl,Ft,e,X)&&(Wt=!0,!G))return{circles:[],offscreen:!1,collisionDetected:Wt}}}}return{circles:!G&&Wt||!Zt||et<this.perspectiveRatioCutoff?[]:q,offscreen:ot,collisionDetected:Wt}}projectPathToScreenSpace(e,a){let c=(function(s,W){let Z=o.N();return o.aA(Z,W.pitchedLabelPlaneMatrix),s.map((u=>{let G=be(u.x,u.y,Z,W.getElevation),U=W.transform.projectTileCoordinates(G.point.x,G.point.y,W.unwrappedTileID,W.getElevation);return U.point.x=(.5*U.point.x+.5)*W.width,U.point.y=(.5*-U.point.y+.5)*W.height,U}))})(e,a);return(function(s){let W=0,Z=0,u=0,G=0;for(let U=0;U<s.length;U++)s[U].isOccluded?(u=U+1,G=0):(G++,G>Z&&(Z=G,W=u));return s.slice(W,W+Z)})(c)}queryRenderedSymbols(e){if(e.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};let a=[],c=new o.ab;for(let Q of e){let k=new o.P(Q.x+Xi,Q.y+Xi);c.extend(k),a.push(k)}let{minX:s,minY:W,maxX:Z,maxY:u}=c,G=this.grid.query(s,W,Z,u).concat(this.ignoredGrid.query(s,W,Z,u)),U={},X={};for(let Q of G){let k=Q.key;if(U[k.bucketInstanceId]===void 0&&(U[k.bucketInstanceId]={}),U[k.bucketInstanceId][k.featureIndex])continue;let j=[new o.P(Q.x1,Q.y1),new o.P(Q.x2,Q.y1),new o.P(Q.x2,Q.y2),new o.P(Q.x1,Q.y2)];o.aJ(a,j)&&(U[k.bucketInstanceId][k.featureIndex]=!0,X[k.bucketInstanceId]===void 0&&(X[k.bucketInstanceId]=[]),X[k.bucketInstanceId].push(k.featureIndex))}return X}insertCollisionBox(e,a,c,s,W,Z){(c?this.ignoredGrid:this.grid).insert({bucketInstanceId:s,featureIndex:W,collisionGroupID:Z,overlapMode:a},e[0],e[1],e[2],e[3])}insertCollisionCircles(e,a,c,s,W,Z){let u=c?this.ignoredGrid:this.grid,G={bucketInstanceId:s,featureIndex:W,collisionGroupID:Z,overlapMode:a};for(let U=0;U<e.length;U+=4)u.insertCircle(G,e[U],e[U+1],e[U+2])}projectAndGetPerspectiveRatio(e,a,c,s,W){if(W){let Z;s?(Z=[e,a,s(e,a),1],o.aG(Z,Z,W)):(Z=[e,a,0,1],wn(Z,Z,W));let u=Z[3];return{x:(Z[0]/u+1)/2*this.transform.width+Xi,y:(-Z[1]/u+1)/2*this.transform.height+Xi,perspectiveRatio:.5+this.transform.cameraToCenterDistance/u*.5,isOccluded:!1,signedDistanceFromCamera:u}}{let Z=this.transform.projectTileCoordinates(e,a,c,s);return{x:(Z.point.x+1)/2*this.transform.width+Xi,y:(1-Z.point.y)/2*this.transform.height+Xi,perspectiveRatio:.5+this.transform.cameraToCenterDistance/Z.signedDistanceFromCamera*.5,isOccluded:Z.isOccluded,signedDistanceFromCamera:Z.signedDistanceFromCamera}}}getPerspectiveRatio(e,a,c,s){let W=this.transform.projectTileCoordinates(e,a,c,s);return .5+this.transform.cameraToCenterDistance/W.signedDistanceFromCamera*.5}isOffscreen(e,a,c,s){return c<Xi||e>=this.screenRightBoundary||s<Xi||a>this.screenBottomBoundary}isInsideGrid(e,a,c,s){return c>=0&&e<this.gridRightBoundary&&s>=0&&a<this.gridBottomBoundary}getViewportMatrix(){let e=o.ar([]);return o.O(e,e,[-100,-100,0]),e}_projectCollisionBox(e,a,c,s,W,Z,u,G,U,X,Q){let k=1,j=0,H=0,q=1,$=e.anchorPointX+u[0],et=e.anchorPointY+u[1];if(Z&&!W){let Pt=this.projectAndGetPerspectiveRatio($+1,et,s,U,Q),At=Pt.x-G.x,se=Math.atan((Pt.y-G.y)/At)+(At<0?Math.PI:0),Ce=Math.sin(se),Je=Math.cos(se);k=Je,j=Ce,H=-Ce,q=Je}else if(!Z&&W){let Pt=Ot(this.transform);k=Pt.vecEast[0],j=Pt.vecEast[1],H=Pt.vecSouth[0],q=Pt.vecSouth[1]}let nt=G.x,mt=G.y,at=a;W&&(nt=$,mt=et,at=Math.pow(2,-(this.transform.zoom-c.overscaledZ)),at*=this.transform.getPitchedTextCorrection($,et,s),X||(at*=o.an(.5+G.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))),X&&(nt+=k*X.x*at+H*X.y*at,mt+=j*X.x*at+q*X.y*at);let Wt=e.x1*at,Zt=e.x2*at,ot=(Wt+Zt)/2,Ft=e.y1*at,Xt=e.y2*at,It=(Ft+Xt)/2,Ut=[{offsetX:Wt,offsetY:Ft},{offsetX:ot,offsetY:Ft},{offsetX:Zt,offsetY:Ft},{offsetX:Zt,offsetY:It},{offsetX:Zt,offsetY:Xt},{offsetX:ot,offsetY:Xt},{offsetX:Wt,offsetY:Xt},{offsetX:Wt,offsetY:It}],xt=[];for(let{offsetX:Pt,offsetY:At}of Ut)xt.push(new o.P(nt+k*Pt+H*At,mt+j*Pt+q*At));let $t=!1;if(W){let Pt=xt.map((At=>this.projectAndGetPerspectiveRatio(At.x,At.y,s,U,Q)));$t=Pt.some((At=>!At.isOccluded)),xt=Pt.map((At=>new o.P(At.x,At.y)))}else $t=!0;return{box:o.aK(xt),allPointsOccluded:!$t}}}class cc{constructor(e,a,c,s){this.opacity=e?Math.max(0,Math.min(1,e.opacity+(e.placed?a:-a))):s&&c?1:0,this.placed=c}isHidden(){return this.opacity===0&&!this.placed}}class vn{constructor(e,a,c,s,W){this.text=new cc(e?e.text:null,a,c,W),this.icon=new cc(e?e.icon:null,a,s,W)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class yd{constructor(e,a,c){this.text=e,this.icon=a,this.skipFade=c}}class Hn{constructor(e,a,c,s,W){this.bucketInstanceId=e,this.featureIndex=a,this.sourceLayerIndex=c,this.bucketIndex=s,this.tileID=W}}class Al{constructor(e){this.crossSourceCollisions=e,this.maxGroupID=0,this.collisionGroups={}}get(e){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[e]){let a=++this.maxGroupID;this.collisionGroups[e]={ID:a,predicate:c=>c.collisionGroupID===a}}return this.collisionGroups[e]}}function Dn(m,e,a,c,s){let{horizontalAlign:W,verticalAlign:Z}=o.aR(m);return new o.P(-(W-.5)*e+c[0]*s,-(Z-.5)*a+c[1]*s)}class oc{constructor(e,a,c,s,W){this.transform=e.clone(),this.terrain=a,this.collisionIndex=new Nn(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=c,this.retainedQueryData={},this.collisionGroups=new Al(s),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=W,W&&(W.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(e){let a=this.terrain;return a?(c,s)=>a.getElevation(e,c,s):null}getBucketParts(e,a,c,s){let W=c.getBucket(a),Z=c.latestFeatureIndex;if(!W||!Z||a.id!==W.layerIds[0])return;let u=c.collisionBoxArray,G=W.layers[0].layout,U=W.layers[0].paint,X=Math.pow(2,this.transform.zoom-c.tileID.overscaledZ),Q=c.tileSize/o.a4,k=c.tileID.toUnwrapped(),j=G.get("text-rotation-alignment")==="map",H=o.aM(c,1,this.transform.zoom),q=o.aN(this.collisionIndex.transform,c,U.get("text-translate"),U.get("text-translate-anchor")),$=o.aN(this.collisionIndex.transform,c,U.get("icon-translate"),U.get("icon-translate-anchor")),et=tl(j,this.transform,H);this.retainedQueryData[W.bucketInstanceId]=new Hn(W.bucketInstanceId,Z,W.sourceLayerIndex,W.index,c.tileID);let nt={bucket:W,layout:G,translationText:q,translationIcon:$,unwrappedTileID:k,pitchedLabelPlaneMatrix:et,scale:X,textPixelRatio:Q,holdingForFade:c.holdingForSymbolFade(),collisionBoxArray:u,partiallyEvaluatedTextSize:o.ax(W.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(W.sourceID)};if(s)for(let mt of W.sortKeyRanges){let{sortKey:at,symbolInstanceStart:Wt,symbolInstanceEnd:Zt}=mt;e.push({sortKey:at,symbolInstanceStart:Wt,symbolInstanceEnd:Zt,parameters:nt})}else e.push({symbolInstanceStart:0,symbolInstanceEnd:W.symbolInstances.length,parameters:nt})}attemptAnchorPlacement(e,a,c,s,W,Z,u,G,U,X,Q,k,j,H,q,$,et,nt,mt,at){let Wt=o.aO[e.textAnchor],Zt=[e.textOffset0,e.textOffset1],ot=Dn(Wt,c,s,Zt,W),Ft=this.collisionIndex.placeCollisionBox(a,k,G,U,X,u,Z,$,Q.predicate,mt,ot,at);if((!nt||this.collisionIndex.placeCollisionBox(nt,k,G,U,X,u,Z,et,Q.predicate,mt,ot,at).placeable)&&Ft.placeable){let Xt;if(this.prevPlacement&&this.prevPlacement.variableOffsets[j.crossTileID]&&this.prevPlacement.placements[j.crossTileID]&&this.prevPlacement.placements[j.crossTileID].text&&(Xt=this.prevPlacement.variableOffsets[j.crossTileID].anchor),j.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[j.crossTileID]={textOffset:Zt,width:c,height:s,anchor:Wt,textBoxScale:W,prevAnchor:Xt},this.markUsedJustification(H,Wt,j,q),H.allowVerticalPlacement&&(this.markUsedOrientation(H,q,j),this.placedOrientations[j.crossTileID]=q),{shift:ot,placedGlyphBoxes:Ft}}}placeLayerBucketPart(e,a,c){let{bucket:s,layout:W,translationText:Z,translationIcon:u,unwrappedTileID:G,pitchedLabelPlaneMatrix:U,textPixelRatio:X,holdingForFade:Q,collisionBoxArray:k,partiallyEvaluatedTextSize:j,collisionGroup:H}=e.parameters,q=W.get("text-optional"),$=W.get("icon-optional"),et=o.aP(W,"text-overlap","text-allow-overlap"),nt=et==="always",mt=o.aP(W,"icon-overlap","icon-allow-overlap"),at=mt==="always",Wt=W.get("text-rotation-alignment")==="map",Zt=W.get("text-pitch-alignment")==="map",ot=W.get("icon-text-fit")!=="none",Ft=W.get("symbol-z-order")==="viewport-y",Xt=nt&&(at||!s.hasIconData()||$),It=at&&(nt||!s.hasTextData()||q);!s.collisionArrays&&k&&s.deserializeCollisionBoxes(k);let Ut=this.retainedQueryData[s.bucketInstanceId].tileID,xt=this._getTerrainElevationFunc(Ut),$t=this.transform.getFastPathSimpleProjectionMatrix(Ut),Pt=(At,se,Ce)=>{var Je,Mi;if(a[At.crossTileID])return;if(Q)return void(this.placements[At.crossTileID]=new yd(!1,!1,!1));let Yi=!1,zi=!1,Ni=!0,pl=null,Bi={box:null,placeable:!1,offscreen:null,occluded:!1},sl={placeable:!1},al=null,bl=null,Ja=null,ld=0,Xn=0,Ud=0;se.textFeatureIndex?ld=se.textFeatureIndex:At.useRuntimeCollisionCircles&&(ld=At.featureIndex),se.verticalTextFeatureIndex&&(Xn=se.verticalTextFeatureIndex);let Md=se.textBox;if(Md){let Ea=Pi=>{let ji=o.ay.horizontal;if(s.allowVerticalPlacement&&!Pi&&this.prevPlacement){let Vl=this.prevPlacement.placedOrientations[At.crossTileID];Vl&&(this.placedOrientations[At.crossTileID]=Vl,ji=Vl,this.markUsedOrientation(s,ji,At))}return ji},nd=(Pi,ji)=>{if(s.allowVerticalPlacement&&At.numVerticalGlyphVertices>0&&se.verticalTextBox){for(let Vl of s.writingModes)if(Vl===o.ay.vertical?(Bi=ji(),sl=Bi):Bi=Pi(),Bi&&Bi.placeable)break}else Bi=Pi()},Od=At.textAnchorOffsetStartIndex,_d=At.textAnchorOffsetEndIndex;if(_d===Od){let Pi=(ji,Vl)=>{let Ii=this.collisionIndex.placeCollisionBox(ji,et,X,Ut,G,Zt,Wt,Z,H.predicate,xt,void 0,$t);return Ii&&Ii.placeable&&(this.markUsedOrientation(s,Vl,At),this.placedOrientations[At.crossTileID]=Vl),Ii};nd((()=>Pi(Md,o.ay.horizontal)),(()=>{let ji=se.verticalTextBox;return s.allowVerticalPlacement&&At.numVerticalGlyphVertices>0&&ji?Pi(ji,o.ay.vertical):{box:null,offscreen:null}})),Ea(Bi&&Bi.placeable)}else{let Pi=o.aO[(Mi=(Je=this.prevPlacement)===null||Je===void 0?void 0:Je.variableOffsets[At.crossTileID])===null||Mi===void 0?void 0:Mi.anchor],ji=(Ii,Yd,j0)=>{let A0=Ii.x2-Ii.x1,w0=Ii.y2-Ii.y1,Pd=At.textBoxScale,dm=ot&&mt==="never"?Yd:null,xd=null,Wr=et==="never"?1:2,Is="never";Pi&&Wr++;for(let Td=0;Td<Wr;Td++){for(let dd=Od;dd<_d;dd++){let Us=s.textAnchorOffsets.get(dd);if(Pi&&Us.textAnchor!==Pi)continue;let Ms=this.attemptAnchorPlacement(Us,Ii,A0,w0,Pd,Wt,Zt,X,Ut,G,H,Is,At,s,j0,Z,u,dm,xt);if(Ms&&(xd=Ms.placedGlyphBoxes,xd&&xd.placeable))return Yi=!0,pl=Ms.shift,xd}Pi?Pi=null:Is=et}return c&&!xd&&(xd={box:this.collisionIndex.placeCollisionBox(Md,"always",X,Ut,G,Zt,Wt,Z,H.predicate,xt,void 0,$t).box,offscreen:!1,placeable:!1,occluded:!1}),xd};nd((()=>ji(Md,se.iconBox,o.ay.horizontal)),(()=>{let Ii=se.verticalTextBox;return s.allowVerticalPlacement&&(!Bi||!Bi.placeable)&&At.numVerticalGlyphVertices>0&&Ii?ji(Ii,se.verticalIconBox,o.ay.vertical):{box:null,occluded:!0,offscreen:null}})),Bi&&(Yi=Bi.placeable,Ni=Bi.offscreen);let Vl=Ea(Bi&&Bi.placeable);if(!Yi&&this.prevPlacement){let Ii=this.prevPlacement.variableOffsets[At.crossTileID];Ii&&(this.variableOffsets[At.crossTileID]=Ii,this.markUsedJustification(s,Ii.anchor,At,Vl))}}}if(al=Bi,Yi=al&&al.placeable,Ni=al&&al.offscreen,At.useRuntimeCollisionCircles&&At.centerJustifiedTextSymbolIndex>=0){let Ea=s.text.placedSymbolArray.get(At.centerJustifiedTextSymbolIndex),nd=o.az(s.textSizeData,j,Ea),Od=W.get("text-padding");bl=this.collisionIndex.placeCollisionCircles(et,Ea,s.lineVertexArray,s.glyphOffsetArray,nd,G,U,c,Zt,H.predicate,At.collisionCircleDiameter,Od,Z,xt),bl.circles.length&&bl.collisionDetected&&!c&&o.w("Collisions detected, but collision boxes are not shown"),Yi=nt||bl.circles.length>0&&!bl.collisionDetected,Ni=Ni&&bl.offscreen}if(se.iconFeatureIndex&&(Ud=se.iconFeatureIndex),se.iconBox){let Ea=nd=>this.collisionIndex.placeCollisionBox(nd,mt,X,Ut,G,Zt,Wt,u,H.predicate,xt,ot&&pl?pl:void 0,$t);sl&&sl.placeable&&se.verticalIconBox?(Ja=Ea(se.verticalIconBox),zi=Ja.placeable):(Ja=Ea(se.iconBox),zi=Ja.placeable),Ni=Ni&&Ja.offscreen}let fd=q||At.numHorizontalGlyphVertices===0&&At.numVerticalGlyphVertices===0,ln=$||At.numIconVertices===0;fd||ln?ln?fd||(zi=zi&&Yi):Yi=zi&&Yi:zi=Yi=zi&&Yi;let ad=zi&&Ja.placeable;if(Yi&&al.placeable&&this.collisionIndex.insertCollisionBox(al.box,et,W.get("text-ignore-placement"),s.bucketInstanceId,sl&&sl.placeable&&Xn?Xn:ld,H.ID),ad&&this.collisionIndex.insertCollisionBox(Ja.box,mt,W.get("icon-ignore-placement"),s.bucketInstanceId,Ud,H.ID),bl&&Yi&&this.collisionIndex.insertCollisionCircles(bl.circles,et,W.get("text-ignore-placement"),s.bucketInstanceId,ld,H.ID),c&&this.storeCollisionData(s.bucketInstanceId,Ce,se,al,Ja,bl),At.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(s.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[At.crossTileID]=new yd((Yi||Xt)&&!al?.occluded,(zi||It)&&!Ja?.occluded,Ni||s.justReloaded),a[At.crossTileID]=!0};if(Ft){if(e.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");let At=s.getSortedSymbolIndexes(-this.transform.bearingInRadians);for(let se=At.length-1;se>=0;--se){let Ce=At[se];Pt(s.symbolInstances.get(Ce),s.collisionArrays[Ce],Ce)}}else for(let At=e.symbolInstanceStart;At<e.symbolInstanceEnd;At++)Pt(s.symbolInstances.get(At),s.collisionArrays[At],At);s.justReloaded=!1}storeCollisionData(e,a,c,s,W,Z){if(c.textBox||c.iconBox){let u,G;this.collisionBoxArrays.has(e)?u=this.collisionBoxArrays.get(e):(u=new Map,this.collisionBoxArrays.set(e,u)),u.has(a)?G=u.get(a):(G={text:null,icon:null},u.set(a,G)),c.textBox&&(G.text=s.box),c.iconBox&&(G.icon=W.box)}if(Z){let u=this.collisionCircleArrays[e];u===void 0&&(u=this.collisionCircleArrays[e]=[]);for(let G=0;G<Z.circles.length;G+=4)u.push(Z.circles[G+0]-Xi),u.push(Z.circles[G+1]-Xi),u.push(Z.circles[G+2]),u.push(Z.collisionDetected?1:0)}}markUsedJustification(e,a,c,s){let W;W=s===o.ay.vertical?c.verticalPlacedTextSymbolIndex:{left:c.leftJustifiedTextSymbolIndex,center:c.centerJustifiedTextSymbolIndex,right:c.rightJustifiedTextSymbolIndex}[o.aQ(a)];let Z=[c.leftJustifiedTextSymbolIndex,c.centerJustifiedTextSymbolIndex,c.rightJustifiedTextSymbolIndex,c.verticalPlacedTextSymbolIndex];for(let u of Z)u>=0&&(e.text.placedSymbolArray.get(u).crossTileID=W>=0&&u!==W?0:c.crossTileID)}markUsedOrientation(e,a,c){let s=a===o.ay.horizontal||a===o.ay.horizontalOnly?a:0,W=a===o.ay.vertical?a:0,Z=[c.leftJustifiedTextSymbolIndex,c.centerJustifiedTextSymbolIndex,c.rightJustifiedTextSymbolIndex];for(let u of Z)e.text.placedSymbolArray.get(u).placedOrientation=s;c.verticalPlacedTextSymbolIndex&&(e.text.placedSymbolArray.get(c.verticalPlacedTextSymbolIndex).placedOrientation=W)}commit(e){this.commitTime=e,this.zoomAtLastRecencyCheck=this.transform.zoom;let a=this.prevPlacement,c=!1;this.prevZoomAdjustment=a?a.zoomAdjustment(this.transform.zoom):0;let s=a?a.symbolFadeChange(e):1,W=a?a.opacities:{},Z=a?a.variableOffsets:{},u=a?a.placedOrientations:{};for(let G in this.placements){let U=this.placements[G],X=W[G];X?(this.opacities[G]=new vn(X,s,U.text,U.icon),c=c||U.text!==X.text.placed||U.icon!==X.icon.placed):(this.opacities[G]=new vn(null,s,U.text,U.icon,U.skipFade),c=c||U.text||U.icon)}for(let G in W){let U=W[G];if(!this.opacities[G]){let X=new vn(U,s,!1,!1);X.isHidden()||(this.opacities[G]=X,c=c||U.text.placed||U.icon.placed)}}for(let G in Z)this.variableOffsets[G]||!this.opacities[G]||this.opacities[G].isHidden()||(this.variableOffsets[G]=Z[G]);for(let G in u)this.placedOrientations[G]||!this.opacities[G]||this.opacities[G].isHidden()||(this.placedOrientations[G]=u[G]);if(a&&a.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");c?this.lastPlacementChangeTime=e:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=a?a.lastPlacementChangeTime:e)}updateLayerOpacities(e,a){let c={};for(let s of a){let W=s.getBucket(e);W&&s.latestFeatureIndex&&e.id===W.layerIds[0]&&this.updateBucketOpacities(W,s.tileID,c,s.collisionBoxArray)}}updateBucketOpacities(e,a,c,s){e.hasTextData()&&(e.text.opacityVertexArray.clear(),e.text.hasVisibleVertices=!1),e.hasIconData()&&(e.icon.opacityVertexArray.clear(),e.icon.hasVisibleVertices=!1),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexArray.clear(),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexArray.clear();let W=e.layers[0],Z=W.layout,u=new vn(null,0,!1,!1,!0),G=Z.get("text-allow-overlap"),U=Z.get("icon-allow-overlap"),X=W._unevaluatedLayout.hasValue("text-variable-anchor")||W._unevaluatedLayout.hasValue("text-variable-anchor-offset"),Q=Z.get("text-rotation-alignment")==="map",k=Z.get("text-pitch-alignment")==="map",j=Z.get("icon-text-fit")!=="none",H=new vn(null,0,G&&(U||!e.hasIconData()||Z.get("icon-optional")),U&&(G||!e.hasTextData()||Z.get("text-optional")),!0);!e.collisionArrays&&s&&(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData())&&e.deserializeCollisionBoxes(s);let q=(et,nt,mt)=>{for(let at=0;at<nt/4;at++)et.opacityVertexArray.emplaceBack(mt);et.hasVisibleVertices=et.hasVisibleVertices||mt!==_a},$=this.collisionBoxArrays.get(e.bucketInstanceId);for(let et=0;et<e.symbolInstances.length;et++){let nt=e.symbolInstances.get(et),{numHorizontalGlyphVertices:mt,numVerticalGlyphVertices:at,crossTileID:Wt}=nt,Zt=this.opacities[Wt];c[Wt]?Zt=u:Zt||(Zt=H,this.opacities[Wt]=Zt),c[Wt]=!0;let ot=nt.numIconVertices>0,Ft=this.placedOrientations[nt.crossTileID],Xt=Ft===o.ay.vertical,It=Ft===o.ay.horizontal||Ft===o.ay.horizontalOnly;if(mt>0||at>0){let xt=Ua(Zt.text);q(e.text,mt,Xt?_a:xt),q(e.text,at,It?_a:xt);let $t=Zt.text.isHidden();[nt.rightJustifiedTextSymbolIndex,nt.centerJustifiedTextSymbolIndex,nt.leftJustifiedTextSymbolIndex].forEach((se=>{se>=0&&(e.text.placedSymbolArray.get(se).hidden=$t||Xt?1:0)})),nt.verticalPlacedTextSymbolIndex>=0&&(e.text.placedSymbolArray.get(nt.verticalPlacedTextSymbolIndex).hidden=$t||It?1:0);let Pt=this.variableOffsets[nt.crossTileID];Pt&&this.markUsedJustification(e,Pt.anchor,nt,Ft);let At=this.placedOrientations[nt.crossTileID];At&&(this.markUsedJustification(e,"left",nt,At),this.markUsedOrientation(e,At,nt))}if(ot){let xt=Ua(Zt.icon),$t=!(j&&nt.verticalPlacedIconSymbolIndex&&Xt);nt.placedIconSymbolIndex>=0&&(q(e.icon,nt.numIconVertices,$t?xt:_a),e.icon.placedSymbolArray.get(nt.placedIconSymbolIndex).hidden=Zt.icon.isHidden()),nt.verticalPlacedIconSymbolIndex>=0&&(q(e.icon,nt.numVerticalIconVertices,$t?_a:xt),e.icon.placedSymbolArray.get(nt.verticalPlacedIconSymbolIndex).hidden=Zt.icon.isHidden())}let Ut=$&&$.has(et)?$.get(et):{text:null,icon:null};if(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData()){let xt=e.collisionArrays[et];if(xt){let $t=new o.P(0,0);if(xt.textBox||xt.verticalTextBox){let Pt=!0;if(X){let At=this.variableOffsets[Wt];At?($t=Dn(At.anchor,At.width,At.height,At.textOffset,At.textBoxScale),Q&&$t._rotate(k?-this.transform.bearingInRadians:this.transform.bearingInRadians)):Pt=!1}if(xt.textBox||xt.verticalTextBox){let At;xt.textBox&&(At=Xt),xt.verticalTextBox&&(At=It),Lo(e.textCollisionBox.collisionVertexArray,Zt.text.placed,!Pt||At,Ut.text,$t.x,$t.y)}}if(xt.iconBox||xt.verticalIconBox){let Pt=!!(!It&&xt.verticalIconBox),At;xt.iconBox&&(At=Pt),xt.verticalIconBox&&(At=!Pt),Lo(e.iconCollisionBox.collisionVertexArray,Zt.icon.placed,At,Ut.icon,j?$t.x:0,j?$t.y:0)}}}}if(e.sortFeatures(-this.transform.bearingInRadians),this.retainedQueryData[e.bucketInstanceId]&&(this.retainedQueryData[e.bucketInstanceId].featureSortOrder=e.featureSortOrder),e.hasTextData()&&e.text.opacityVertexBuffer&&e.text.opacityVertexBuffer.updateData(e.text.opacityVertexArray),e.hasIconData()&&e.icon.opacityVertexBuffer&&e.icon.opacityVertexBuffer.updateData(e.icon.opacityVertexArray),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexBuffer&&e.iconCollisionBox.collisionVertexBuffer.updateData(e.iconCollisionBox.collisionVertexArray),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexBuffer&&e.textCollisionBox.collisionVertexBuffer.updateData(e.textCollisionBox.collisionVertexArray),e.text.opacityVertexArray.length!==e.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${e.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${e.text.layoutVertexArray.length}) / 4`);if(e.icon.opacityVertexArray.length!==e.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${e.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${e.icon.layoutVertexArray.length}) / 4`);e.bucketInstanceId in this.collisionCircleArrays&&(e.collisionCircleArray=this.collisionCircleArrays[e.bucketInstanceId],delete this.collisionCircleArrays[e.bucketInstanceId])}symbolFadeChange(e){return this.fadeDuration===0?1:(e-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(e){return Math.max(0,(this.transform.zoom-e)/1.5)}hasTransitions(e){return this.stale||e-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(e,a){let c=this.zoomAtLastRecencyCheck===a?1-this.zoomAdjustment(a):1;return this.zoomAtLastRecencyCheck=a,this.commitTime+this.fadeDuration*c>e}setStale(){this.stale=!0}}function Lo(m,e,a,c,s,W){c&&c.length!==0||(c=[0,0,0,0]);let Z=c[0]-Xi,u=c[1]-Xi,G=c[2]-Xi,U=c[3]-Xi;m.emplaceBack(e?1:0,a?1:0,s||0,W||0,Z,u),m.emplaceBack(e?1:0,a?1:0,s||0,W||0,G,u),m.emplaceBack(e?1:0,a?1:0,s||0,W||0,G,U),m.emplaceBack(e?1:0,a?1:0,s||0,W||0,Z,U)}let Eo=Math.pow(2,25),rc=Math.pow(2,24),sc=Math.pow(2,17),Zd=Math.pow(2,16),Lc=Math.pow(2,9),Ec=Math.pow(2,8),zc=Math.pow(2,1);function Ua(m){if(m.opacity===0&&!m.placed)return 0;if(m.opacity===1&&m.placed)return 4294967295;let e=m.placed?1:0,a=Math.floor(127*m.opacity);return a*Eo+e*rc+a*sc+e*Zd+a*Lc+e*Ec+a*zc+e}let _a=0;class In{constructor(e){this._sortAcrossTiles=e.layout.get("symbol-z-order")!=="viewport-y"&&!e.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(e,a,c,s,W){let Z=this._bucketParts;for(;this._currentTileIndex<e.length;)if(a.getBucketParts(Z,s,e[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,W())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,Z.sort(((u,G)=>u.sortKey-G.sortKey)));this._currentPartIndex<Z.length;)if(a.placeLayerBucketPart(Z[this._currentPartIndex],this._seenCrossTileIDs,c),this._currentPartIndex++,W())return!0;return!1}}class zo{constructor(e,a,c,s,W,Z,u,G){this.placement=new oc(e,a,Z,u,G),this._currentPlacementIndex=c.length-1,this._forceFullPlacement=s,this._showCollisionBoxes=W,this._done=!1}isDone(){return this._done}continuePlacement(e,a,c){let s=jt(),W=()=>!this._forceFullPlacement&&jt()-s>2;for(;this._currentPlacementIndex>=0;){let Z=a[e[this._currentPlacementIndex]],u=this.placement.collisionIndex.transform.zoom;if(Z.type==="symbol"&&(!Z.minzoom||Z.minzoom<=u)&&(!Z.maxzoom||Z.maxzoom>u)){if(this._inProgressLayer||(this._inProgressLayer=new In(Z)),this._inProgressLayer.continuePlacement(c[Z.source],this.placement,this._showCollisionBoxes,Z,W))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(e){return this.placement.commit(e),this.placement}}let Pa=512/o.a4/2;class Un{constructor(e,a,c){this.tileID=e,this.bucketInstanceId=c,this._symbolsByKey={};let s=new Map;for(let W=0;W<a.length;W++){let Z=a.get(W),u=Z.key,G=s.get(u);G?G.push(Z):s.set(u,[Z])}for(let[W,Z]of s){let u={positions:Z.map((G=>({x:Math.floor(G.anchorX*Pa),y:Math.floor(G.anchorY*Pa)}))),crossTileIDs:Z.map((G=>G.crossTileID))};if(u.positions.length>128){let G=new o.aS(u.positions.length,16,Uint16Array);for(let{x:U,y:X}of u.positions)G.add(U,X);G.finish(),delete u.positions,u.index=G}this._symbolsByKey[W]=u}}getScaledCoordinates(e,a){let{x:c,y:s,z:W}=this.tileID.canonical,{x:Z,y:u,z:G}=a.canonical,U=Pa/Math.pow(2,G-W),X=(u*o.a4+e.anchorY)*U,Q=s*o.a4*Pa;return{x:Math.floor((Z*o.a4+e.anchorX)*U-c*o.a4*Pa),y:Math.floor(X-Q)}}findMatches(e,a,c){let s=this.tileID.canonical.z<a.canonical.z?1:Math.pow(2,this.tileID.canonical.z-a.canonical.z);for(let W=0;W<e.length;W++){let Z=e.get(W);if(Z.crossTileID)continue;let u=this._symbolsByKey[Z.key];if(!u)continue;let G=this.getScaledCoordinates(Z,a);if(u.index){let U=u.index.range(G.x-s,G.y-s,G.x+s,G.y+s).sort();for(let X of U){let Q=u.crossTileIDs[X];if(!c[Q]){c[Q]=!0,Z.crossTileID=Q;break}}}else if(u.positions)for(let U=0;U<u.positions.length;U++){let X=u.positions[U],Q=u.crossTileIDs[U];if(Math.abs(X.x-G.x)<=s&&Math.abs(X.y-G.y)<=s&&!c[Q]){c[Q]=!0,Z.crossTileID=Q;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map((({crossTileIDs:e})=>e))}}class fn{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Ka{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(e){let a=Math.round((e-this.lng)/360);if(a!==0)for(let c in this.indexes){let s=this.indexes[c],W={};for(let Z in s){let u=s[Z];u.tileID=u.tileID.unwrapTo(u.tileID.wrap+a),W[u.tileID.key]=u}this.indexes[c]=W}this.lng=e}addBucket(e,a,c){if(this.indexes[e.overscaledZ]&&this.indexes[e.overscaledZ][e.key]){if(this.indexes[e.overscaledZ][e.key].bucketInstanceId===a.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(e.overscaledZ,this.indexes[e.overscaledZ][e.key])}for(let W=0;W<a.symbolInstances.length;W++)a.symbolInstances.get(W).crossTileID=0;this.usedCrossTileIDs[e.overscaledZ]||(this.usedCrossTileIDs[e.overscaledZ]={});let s=this.usedCrossTileIDs[e.overscaledZ];for(let W in this.indexes){let Z=this.indexes[W];if(Number(W)>e.overscaledZ)for(let u in Z){let G=Z[u];G.tileID.isChildOf(e)&&G.findMatches(a.symbolInstances,e,s)}else{let u=Z[e.scaledTo(Number(W)).key];u&&u.findMatches(a.symbolInstances,e,s)}}for(let W=0;W<a.symbolInstances.length;W++){let Z=a.symbolInstances.get(W);Z.crossTileID||(Z.crossTileID=c.generate(),s[Z.crossTileID]=!0)}return this.indexes[e.overscaledZ]===void 0&&(this.indexes[e.overscaledZ]={}),this.indexes[e.overscaledZ][e.key]=new Un(e,a.symbolInstances,a.bucketInstanceId),!0}removeBucketCrossTileIDs(e,a){for(let c of a.getCrossTileIDsLists())for(let s of c)delete this.usedCrossTileIDs[e][s]}removeStaleBuckets(e){let a=!1;for(let c in this.indexes){let s=this.indexes[c];for(let W in s)e[s[W].bucketInstanceId]||(this.removeBucketCrossTileIDs(c,s[W]),delete s[W],a=!0)}return a}}class On{constructor(){this.layerIndexes={},this.crossTileIDs=new fn,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(e,a,c){let s=this.layerIndexes[e.id];s===void 0&&(s=this.layerIndexes[e.id]=new Ka);let W=!1,Z={};s.handleWrapJump(c);for(let u of a){let G=u.getBucket(e);G&&e.id===G.layerIds[0]&&(G.bucketInstanceId||(G.bucketInstanceId=++this.maxBucketInstanceId),s.addBucket(u.tileID,G,this.crossTileIDs)&&(W=!0),Z[G.bucketInstanceId]=!0)}return s.removeStaleBuckets(Z)&&(W=!0),W}pruneUnusedLayers(e){let a={};e.forEach((c=>{a[c]=!0}));for(let c in this.layerIndexes)a[c]||delete this.layerIndexes[c]}}var Ee="void main() {fragColor=vec4(1.0);}";let ma={prelude:De(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
out highp vec4 fragColor;`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}mat3 rotationMatrixFromAxisAngle(vec3 u,float angle) {float c=cos(angle);float s=sin(angle);float c2=1.0-c;return mat3(u.x*u.x*c2+      c,u.x*u.y*c2-u.z*s,u.x*u.z*c2+u.y*s,u.y*u.x*c2+u.z*s,u.y*u.y*c2+    c,u.y*u.z*c2-u.x*s,u.z*u.x*c2-u.y*s,u.z*u.y*c2+u.x*s,u.z*u.z*c2+    c
);}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
#ifdef GLOBE
if ((pos.y <-32767.5) || (pos.y > 32766.5)) {return 0.0;}
#endif
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}const float PI=3.141592653589793;uniform mat4 u_projection_matrix;`),projectionMercator:De("","float projectLineThickness(float tileY) {return 1.0;}float projectCircleRadius(float tileY) {return 1.0;}vec4 projectTile(vec2 p) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);return result;}vec4 projectTile(vec2 p,vec2 rawPos) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);if (rawPos.y <-32767.5 || rawPos.y > 32766.5) {result.z=-10000000.0;}return result;}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_projection_matrix*vec4(posInTile,elevation,1.0);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {return projectTileWithElevation(posInTile,elevation);}"),projectionGlobe:De("",`#define GLOBE_RADIUS 6371008.8
uniform highp vec4 u_projection_tile_mercator_coords;uniform highp vec4 u_projection_clipping_plane;uniform highp float u_projection_transition;uniform mat4 u_projection_fallback_matrix;vec3 globeRotateVector(vec3 vec,vec2 angles) {vec3 axisRight=vec3(vec.z,0.0,-vec.x);vec3 axisUp=cross(axisRight,vec);axisRight=normalize(axisRight);axisUp=normalize(axisUp);vec2 t=tan(angles);return normalize(vec+axisRight*t.x+axisUp*t.y);}mat3 globeGetRotationMatrix(vec3 spherePos) {vec3 axisRight=vec3(spherePos.z,0.0,-spherePos.x);vec3 axisDown=cross(axisRight,spherePos);axisRight=normalize(axisRight);axisDown=normalize(axisDown);return mat3(axisRight,axisDown,spherePos
);}float circumferenceRatioAtTileY(float tileY) {float mercator_pos_y=u_projection_tile_mercator_coords.y+u_projection_tile_mercator_coords.w*tileY;float spherical_y=2.0*atan(exp(PI-(mercator_pos_y*PI*2.0)))-PI*0.5;return cos(spherical_y);}float projectLineThickness(float tileY) {float thickness=1.0/circumferenceRatioAtTileY(tileY); 
if (u_projection_transition < 0.999) {return mix(1.0,thickness,u_projection_transition);} else {return thickness;}}vec3 projectToSphere(vec2 translatedPos,vec2 rawPos) {vec2 mercator_pos=u_projection_tile_mercator_coords.xy+u_projection_tile_mercator_coords.zw*translatedPos;vec2 spherical;spherical.x=mercator_pos.x*PI*2.0+PI;spherical.y=2.0*atan(exp(PI-(mercator_pos.y*PI*2.0)))-PI*0.5;float len=cos(spherical.y);vec3 pos=vec3(sin(spherical.x)*len,sin(spherical.y),cos(spherical.x)*len
);if (rawPos.y <-32767.5) {pos=vec3(0.0,1.0,0.0);}if (rawPos.y > 32766.5) {pos=vec3(0.0,-1.0,0.0);}return pos;}vec3 projectToSphere(vec2 posInTile) {return projectToSphere(posInTile,vec2(0.0,0.0));}float globeComputeClippingZ(vec3 spherePos) {return (1.0-(dot(spherePos,u_projection_clipping_plane.xyz)+u_projection_clipping_plane.w));}vec4 interpolateProjection(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);globePosition.z=globeComputeClippingZ(elevatedPos)*globePosition.w;if (u_projection_transition > 0.999) {return globePosition;}vec4 flatPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);const float z_globeness_threshold=0.2;vec4 result=globePosition;result.z=mix(0.0,globePosition.z,clamp((u_projection_transition-z_globeness_threshold)/(1.0-z_globeness_threshold),0.0,1.0));result.xyw=mix(flatPosition.xyw,globePosition.xyw,u_projection_transition);if ((posInTile.y <-32767.5) || (posInTile.y > 32766.5)) {result=globePosition;const float poles_hidden_anim_percentage=0.02;result.z=mix(globePosition.z,100.0,pow(max((1.0-u_projection_transition)/poles_hidden_anim_percentage,0.0),8.0));}return result;}vec4 interpolateProjectionFor3D(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);if (u_projection_transition > 0.999) {return globePosition;}vec4 fallbackPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);return mix(fallbackPosition,globePosition,u_projection_transition);}vec4 projectTile(vec2 posInTile) {return interpolateProjection(posInTile,projectToSphere(posInTile),0.0);}vec4 projectTile(vec2 posInTile,vec2 rawPos) {return interpolateProjection(posInTile,projectToSphere(posInTile,rawPos),0.0);}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return interpolateProjection(posInTile,projectToSphere(posInTile),elevation);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {vec3 spherePos=projectToSphere(posInTile,posInTile);return interpolateProjectionFor3D(posInTile,spherePos,elevation);}`),background:De(`uniform vec4 u_color;uniform float u_opacity;void main() {fragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),backgroundPattern:De(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;void main() {gl_Position=projectTile(a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:De(`in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);float antialiased_blur=v_data.z;float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));fragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);const float epsilon=0.5/255.0;if (fragColor.r < epsilon && fragColor.g < epsilon && fragColor.b < epsilon && fragColor.a < epsilon) {discard;}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform highp float u_globe_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;uniform vec2 u_translate;in vec2 a_pos;out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 pos_raw=a_pos+32768.0;vec2 extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);vec2 circle_center=floor(pos_raw/8.0)+u_translate;float ele=get_elevation(circle_center);v_visibility=calculate_visibility(projectTileWithElevation(circle_center,ele));if (u_pitch_with_map) {
#ifdef GLOBE
vec3 center_vector=projectToSphere(circle_center);
#endif
float angle_scale=u_globe_extrude_scale;vec2 corner_position=circle_center;if (u_scale_with_map) {angle_scale*=(radius+stroke_width);corner_position+=extrude*u_extrude_scale*(radius+stroke_width);} else {
#ifdef GLOBE
vec4 projected_center=interpolateProjection(circle_center,center_vector,ele);
#else
vec4 projected_center=projectTileWithElevation(circle_center,ele);
#endif
corner_position+=extrude*u_extrude_scale*(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);angle_scale*=(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);}
#ifdef GLOBE
vec2 angles=extrude*angle_scale;vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(corner_position,corner_vector,ele);
#else
gl_Position=projectTileWithElevation(corner_position,ele);
#endif
} else {gl_Position=projectTileWithElevation(circle_center,ele);if (gl_Position.z/gl_Position.w > 1.0) {gl_Position.xy=vec2(10000.0);}if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}float antialiasblur=-max(1.0/u_device_pixel_ratio/(radius+stroke_width),blur);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:De(Ee,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),heatmap:De(`uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);fragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;uniform highp float u_globe_extrude_scale;in vec2 a_pos;out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 pos_raw=a_pos+32768.0;vec2 unscaled_extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 circle_center=floor(pos_raw/8.0);
#ifdef GLOBE
vec2 angles=v_extrude*radius*u_globe_extrude_scale;vec3 center_vector=projectToSphere(circle_center);vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(circle_center+extrude,corner_vector,0.0);
#else
gl_Position=projectTileFor3D(circle_center+extrude,get_elevation(circle_center));
#endif
}`),heatmapTexture:De(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));fragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:De("in float v_placed;in float v_notUsed;void main() {float alpha=0.5;fragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {fragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {fragColor*=.1;}}","in vec2 a_anchor_pos;in vec2 a_placed;in vec2 a_box_real;uniform vec2 u_pixel_extrude_scale;out float v_placed;out float v_notUsed;void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:De("in float v_radius;in vec2 v_extrude;in float v_collision;void main() {float alpha=0.5;float stroke_radius=0.9;float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);fragColor=color*alpha*opacity_t;}","in vec2 a_pos;in float a_radius;in vec2 a_flags;uniform vec2 u_viewport_size;out float v_radius;out vec2 v_extrude;out float v_collision;void main() {float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_collision=collision;gl_Position=vec4((a_pos/u_viewport_size*2.0-1.0)*vec2(1.0,-1.0),0.0,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),colorRelief:De(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;uniform vec4 u_unpack;uniform sampler2D u_elevation_stops;uniform sampler2D u_color_stops;uniform int u_color_ramp_size;uniform float u_opacity;in vec2 v_pos;float getElevation(vec2 coord) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}float getElevationStop(int stop) {float x=(float(stop)+0.5)/float(u_color_ramp_size);vec4 data=texture(u_elevation_stops,vec2(x,0))*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {float el=getElevation(v_pos);int r=(u_color_ramp_size-1);int l=0;float el_l=getElevationStop(l);float el_r=getElevationStop(r);while(r-l > 1){int m=(r+l)/2;float el_m=getElevationStop(m);if(el < el_m){r=m;el_r=el_m;}else
{l=m;el_l=el_m;}}float x=(float(l)+(el-el_l)/(el_r-el_l)+0.5)/float(u_color_ramp_size);fragColor=u_opacity*texture(u_color_stops,vec2(x,0));
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_dimension;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_pos/8192.0)*scale+epsilon;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),debug:De("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);fragColor=mix(u_color,overlay_color,overlay_color.a);}","in vec2 a_pos;out vec2 v_uv;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=projectTileWithElevation(a_pos*u_overlay_scale,get_elevation(a_pos));}"),depth:De(Ee,`in vec2 a_pos;void main() {
#ifdef GLOBE
gl_Position=projectTileFor3D(a_pos,0.0);
#else
gl_Position=u_projection_matrix*vec4(a_pos,0.0,1.0);
#endif
}`),fill:De(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
fragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_fill_translate;in vec2 a_pos;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);}`),fillOutline:De(`in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=outline_color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillOutlinePattern:De(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;in vec2 v_pos_a;in vec2 v_pos_b;in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillPattern:De(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:De(`in vec4 v_color;void main() {fragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
out vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;vec3 normalForLighting=normal/16384.0;float directional=clamp(dot(normalForLighting,u_lightpos),0.0,1.0);
#ifdef GLOBE
mat3 rotMatrix=globeGetRotationMatrix(spherePos);normalForLighting=rotMatrix*normalForLighting;directional=mix(directional,clamp(dot(normalForLighting,u_lightpos_globe),0.0,1.0),u_projection_transition);
#endif
directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:De(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;in vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);fragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
#ifdef GLOBE
out vec3 v_sphere_pos;
#endif
out vec2 v_pos_a;out vec2 v_pos_b;out vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);v_sphere_pos=elevatedPos;gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,elevation*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:De(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {vec2 epsilon=1.0/u_dimension;float tileSize=u_dimension.x-2.0;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))*tileSize/pow(2.0,exaggeration+(28.2562-u_zoom));fragColor=clamp(vec4(deriv.x/8.0+0.5,deriv.y/8.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:De(`uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform float u_exaggeration;uniform vec4 u_accent;uniform int u_method;uniform float u_altitudes[NUM_ILLUMINATION_SOURCES];uniform float u_azimuths[NUM_ILLUMINATION_SOURCES];uniform vec4 u_shadows[NUM_ILLUMINATION_SOURCES];uniform vec4 u_highlights[NUM_ILLUMINATION_SOURCES];
#define PI 3.141592653589793
#define STANDARD 0
#define COMBINED 1
#define IGOR 2
#define MULTIDIRECTIONAL 3
#define BASIC 4
float get_aspect(vec2 deriv){return deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);}void igor_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float aspect=get_aspect(deriv);float azimuth=u_azimuths[0]+PI;float slope_stength=atan(length(deriv))*2.0/PI;float aspect_strength=1.0-abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);float shadow_strength=slope_stength*aspect_strength;float highlight_strength=slope_stength*(1.0-aspect_strength);fragColor=u_shadows[0]*shadow_strength+u_highlights[0]*highlight_strength;}void standard_hillshade(vec2 deriv){float azimuth=u_azimuths[0]+PI;float slope=atan(0.625*length(deriv));float aspect=get_aspect(deriv);float intensity=u_exaggeration;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadows[0],u_highlights[0],shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);fragColor=accent_color*(1.0-shade_color.a)+shade_color;}void basic_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor=u_highlights[0]*(2.0*shade-1.0);}else
{fragColor=u_shadows[0]*(1.0-2.0*shade);}}void multidirectional_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;fragColor=vec4(0,0,0,0);for(int i=0; i < NUM_ILLUMINATION_SOURCES; i++){float cos_alt=cos(u_altitudes[i]);float sin_alt=sin(u_altitudes[i]);float cos_az=-cos(u_azimuths[i]);float sin_az=-sin(u_azimuths[i]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor+=u_highlights[i]*(2.0*shade-1.0)/float(NUM_ILLUMINATION_SOURCES);}else
{fragColor+=u_shadows[i]*(1.0-2.0*shade)/float(NUM_ILLUMINATION_SOURCES);}}}void combined_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=acos((sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv)));cang=clamp(cang,0.0,PI/2.0);float shade=cang*atan(length(deriv))*4.0/PI/PI;float highlight=(PI/2.0-cang)*atan(length(deriv))*4.0/PI/PI;fragColor=u_shadows[0]*shade+u_highlights[0]*highlight;}void main() {vec4 pixel=texture(u_image,v_pos);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));vec2 deriv=((pixel.rg*8.0)-4.0)/scaleFactor;if (u_method==BASIC) {basic_hillshade(deriv);} else if (u_method==COMBINED) {combined_hillshade(deriv);} else if (u_method==IGOR) {igor_hillshade(deriv);} else if (u_method==MULTIDIRECTIONAL) {multidirectional_hillshade(deriv);} else if (u_method==STANDARD) {standard_hillshade(deriv);} else {standard_hillshade(deriv);}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);v_pos=a_pos/8192.0;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),line:De(`uniform lowp float u_device_pixel_ratio;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp float v_linesofar;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:De(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec2 v_uv;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture(u_image,v_uv);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;in float a_uv_x;in float a_split_index;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec2 v_uv;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:De(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture(u_image,pos_a),texture(u_image,pos_b),u_fade);fragColor=color*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:De(`uniform lowp float u_device_pixel_ratio;uniform lowp float u_lineatlas_width;uniform sampler2D u_image;uniform float u_mix;in vec2 v_normal;in vec2 v_width2;in vec2 v_tex_a;in vec2 v_tex_b;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture(u_image,v_tex_a).a;float sdfdist_b=texture(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfgamma=(u_lineatlas_width/256.0/u_device_pixel_ratio)/min(dasharray_from.w,dasharray_to.w);alpha*=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_tileratio;uniform float u_crossfade_from;uniform float u_crossfade_to;uniform float u_lineatlas_height;out vec2 v_normal;out vec2 v_width2;out vec2 v_tex_a;out vec2 v_tex_b;out float v_gamma_scale;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
float u_patternscale_a_x=u_tileratio/dasharray_from.w/u_crossfade_from;float u_patternscale_a_y=-dasharray_from.z/2.0/u_lineatlas_height;float u_patternscale_b_x=u_tileratio/dasharray_to.w/u_crossfade_to;float u_patternscale_b_y=-dasharray_to.z/2.0/u_lineatlas_height;v_tex_a=vec2(a_linesofar*u_patternscale_a_x/floorwidth,normal.y*u_patternscale_a_y+(float(dasharray_from.y)+0.5)/u_lineatlas_height);v_tex_b=vec2(a_linesofar*u_patternscale_b_x/floorwidth,normal.y*u_patternscale_b_y+(float(dasharray_to.y)+0.5)/u_lineatlas_height);v_width2=vec2(outset,inset);}`),lineGradientSDF:De(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform sampler2D u_image_dash;uniform float u_mix;uniform lowp float u_lineatlas_width;in vec2 v_normal;in vec2 v_width2;in vec2 v_tex_a;in vec2 v_tex_b;in float v_gamma_scale;in highp vec2 v_uv;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture(u_image,v_uv);float sdfdist_a=texture(u_image_dash,v_tex_a).a;float sdfdist_b=texture(u_image_dash,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfgamma=(u_lineatlas_width/256.0)/min(dasharray_from.w,dasharray_to.w);float dash_alpha=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);fragColor=color*(alpha*dash_alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;in float a_uv_x;in float a_split_index;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;uniform float u_tileratio;uniform float u_crossfade_from;uniform float u_crossfade_to;uniform float u_lineatlas_height;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec2 v_uv;out vec2 v_tex_a;out vec2 v_tex_b;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;float texel_height=1.0/u_image_height;float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
float u_patternscale_a_x=u_tileratio/dasharray_from.w/u_crossfade_from;float u_patternscale_a_y=-dasharray_from.z/2.0/u_lineatlas_height;float u_patternscale_b_x=u_tileratio/dasharray_to.w/u_crossfade_to;float u_patternscale_b_y=-dasharray_to.z/2.0/u_lineatlas_height;v_tex_a=vec2(a_linesofar*u_patternscale_a_x/floorwidth,normal.y*u_patternscale_a_y+(float(dasharray_from.y)+0.5)/u_lineatlas_height);v_tex_b=vec2(a_linesofar*u_patternscale_b_x/floorwidth,normal.y*u_patternscale_b_y+(float(dasharray_to.y)+0.5)/u_lineatlas_height);v_width2=vec2(outset,inset);}`),raster:De(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;in vec2 v_pos0;in vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture(u_image0,v_pos0);vec4 color1=texture(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);fragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;uniform vec4 u_coords_top;uniform vec4 u_coords_bottom;in vec2 a_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {vec2 fractionalPos=a_pos/8192.0;vec2 position=mix(mix(u_coords_top.xy,u_coords_top.zw,fractionalPos.x),mix(u_coords_bottom.xy,u_coords_bottom.zw,fractionalPos.x),fractionalPos.y);gl_Position=projectTile(position,position);v_pos0=((fractionalPos-0.5)/u_buffer_scale)+0.5;
#ifdef GLOBE
if (a_pos.y <-32767.5) {v_pos0.y=0.0;}if (a_pos.y > 32766.5) {v_pos0.y=1.0;}
#endif
v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),symbolIcon:De(`uniform sampler2D u_texture;in vec2 v_tex;in float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;fragColor=texture(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_tex;out float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:De(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;in vec2 v_data0;in vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_data0;out vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:De(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;in vec4 v_data0;in vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;fragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec4 v_data0;out vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map && !u_is_along_line) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:De("uniform sampler2D u_texture;uniform vec4 u_fog_color;uniform vec4 u_horizon_color;uniform float u_fog_ground_blend;uniform float u_fog_ground_blend_opacity;uniform float u_horizon_fog_blend;uniform bool u_is_globe_mode;in vec2 v_texture_pos;in float v_fog_depth;const float gamma=2.2;vec4 gammaToLinear(vec4 color) {return pow(color,vec4(gamma));}vec4 linearToGamma(vec4 color) {return pow(color,vec4(1.0/gamma));}void main() {vec4 surface_color=texture(u_texture,vec2(v_texture_pos.x,1.0-v_texture_pos.y));if (!u_is_globe_mode && v_fog_depth > u_fog_ground_blend) {vec4 surface_color_linear=gammaToLinear(surface_color);float blend_color=smoothstep(0.0,1.0,max((v_fog_depth-u_horizon_fog_blend)/(1.0-u_horizon_fog_blend),0.0));vec4 fog_horizon_color_linear=mix(gammaToLinear(u_fog_color),gammaToLinear(u_horizon_color),blend_color);float factor_fog=max(v_fog_depth-u_fog_ground_blend,0.0)/(1.0-u_fog_ground_blend);fragColor=linearToGamma(mix(surface_color_linear,fog_horizon_color_linear,pow(factor_fog,2.0)*u_fog_ground_blend_opacity));} else {fragColor=surface_color;}}","in vec3 a_pos3d;uniform mat4 u_fog_matrix;uniform float u_ele_delta;out vec2 v_texture_pos;out float v_fog_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta);vec4 pos=u_fog_matrix*vec4(a_pos3d.xy,ele,1.0);v_fog_depth=pos.z/pos.w*0.5+0.5;}"),terrainDepth:De("in float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {fragColor=pack(v_depth);}","in vec3 a_pos3d;uniform float u_ele_delta;out float v_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);v_depth=gl_Position.z/gl_Position.w;}"),terrainCoords:De("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;in vec2 v_texture_pos;void main() {vec4 rgba=texture(u_texture,v_texture_pos);fragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}","in vec3 a_pos3d;uniform float u_ele_delta;out vec2 v_texture_pos;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);}"),projectionErrorMeasurement:De("in vec4 v_output_error_encoded;void main() {fragColor=v_output_error_encoded;}","in vec2 a_pos;uniform highp float u_input;uniform highp float u_output_expected;out vec4 v_output_error_encoded;void main() {float real_output=2.0*atan(exp(PI-(u_input*PI*2.0)))-PI*0.5;float error=real_output-u_output_expected;float abs_error=abs(error)*128.0;v_output_error_encoded.x=min(floor(abs_error*256.0),255.0)/255.0;abs_error-=v_output_error_encoded.x;v_output_error_encoded.y=min(floor(abs_error*65536.0),255.0)/255.0;abs_error-=v_output_error_encoded.x/255.0;v_output_error_encoded.z=min(floor(abs_error*16777216.0),255.0)/255.0;v_output_error_encoded.w=error >=0.0 ? 1.0 : 0.0;gl_Position=vec4(a_pos,0.0,1.0);}"),atmosphere:De(`in vec3 view_direction;uniform vec3 u_sun_pos;uniform vec3 u_globe_position;uniform float u_globe_radius;uniform float u_atmosphere_blend;/**Shader use from https:*Made some change to adapt to MapLibre Globe geometry*/const float PI=3.141592653589793;const int iSteps=5;const int jSteps=3;/*radius of the planet*/const float EARTH_RADIUS=6371e3;/*radius of the atmosphere*/const float ATMOS_RADIUS=6471e3;vec2 rsi(vec3 r0,vec3 rd,float sr) {float a=dot(rd,rd);float b=2.0*dot(rd,r0);float c=dot(r0,r0)-(sr*sr);float d=(b*b)-4.0*a*c;if (d < 0.0) return vec2(1e5,-1e5);return vec2((-b-sqrt(d))/(2.0*a),(-b+sqrt(d))/(2.0*a));}vec4 atmosphere(vec3 r,vec3 r0,vec3 pSun,float iSun,float rPlanet,float rAtmos,vec3 kRlh,float kMie,float shRlh,float shMie,float g) {pSun=normalize(pSun);r=normalize(r);vec2 p=rsi(r0,r,rAtmos);if (p.x > p.y) {return vec4(0.0,0.0,0.0,1.0);}if (p.x < 0.0) {p.x=0.0;}vec3 pos=r0+r*p.x;vec2 p2=rsi(r0,r,rPlanet);if (p2.x <=p2.y && p2.x > 0.0) {p.y=min(p.y,p2.x);}float iStepSize=(p.y-p.x)/float(iSteps);float iTime=p.x+iStepSize*0.5;vec3 totalRlh=vec3(0,0,0);vec3 totalMie=vec3(0,0,0);float iOdRlh=0.0;float iOdMie=0.0;float mu=dot(r,pSun);float mumu=mu*mu;float gg=g*g;float pRlh=3.0/(16.0*PI)*(1.0+mumu);float pMie=3.0/(8.0*PI)*((1.0-gg)*(mumu+1.0))/(pow(1.0+gg-2.0*mu*g,1.5)*(2.0+gg));for (int i=0; i < iSteps; i++) {vec3 iPos=r0+r*iTime;float iHeight=length(iPos)-rPlanet;float odStepRlh=exp(-iHeight/shRlh)*iStepSize;float odStepMie=exp(-iHeight/shMie)*iStepSize;iOdRlh+=odStepRlh;iOdMie+=odStepMie;float jStepSize=rsi(iPos,pSun,rAtmos).y/float(jSteps);float jTime=jStepSize*0.5;float jOdRlh=0.0;float jOdMie=0.0;for (int j=0; j < jSteps; j++) {vec3 jPos=iPos+pSun*jTime;float jHeight=length(jPos)-rPlanet;jOdRlh+=exp(-jHeight/shRlh)*jStepSize;jOdMie+=exp(-jHeight/shMie)*jStepSize;jTime+=jStepSize;}vec3 attn=exp(-(kMie*(iOdMie+jOdMie)+kRlh*(iOdRlh+jOdRlh)));totalRlh+=odStepRlh*attn;totalMie+=odStepMie*attn;iTime+=iStepSize;}float opacity=exp(-(length(kRlh)*length(totalRlh)+kMie*length(totalMie)));vec3 color=iSun*(pRlh*kRlh*totalRlh+pMie*kMie*totalMie);return vec4(color,opacity);}void main() {vec3 scale_camera_pos=-u_globe_position*EARTH_RADIUS/u_globe_radius;vec4 color=atmosphere(normalize(view_direction),scale_camera_pos,u_sun_pos,22.0,EARTH_RADIUS,ATMOS_RADIUS,vec3(5.5e-6,13.0e-6,22.4e-6),21e-6,8e3,1.2e3,0.758
);color.rgb=1.0-exp(-1.0*color.rgb);color=pow(color,vec4(1.0/2.2));fragColor=vec4(color.rgb,1.0-color.a)*u_atmosphere_blend;}`,"in vec2 a_pos;uniform mat4 u_inv_proj_matrix;out vec3 view_direction;void main() {view_direction=(u_inv_proj_matrix*vec4(a_pos,0.0,1.0)).xyz;gl_Position=vec4(a_pos,0.0,1.0);}"),sky:De("uniform vec4 u_sky_color;uniform vec4 u_horizon_color;uniform vec2 u_horizon;uniform vec2 u_horizon_normal;uniform float u_sky_horizon_blend;uniform float u_sky_blend;void main() {float x=gl_FragCoord.x;float y=gl_FragCoord.y;float blend=(y-u_horizon.y)*u_horizon_normal.y+(x-u_horizon.x)*u_horizon_normal.x;if (blend > 0.0) {if (blend < u_sky_horizon_blend) {fragColor=mix(u_sky_color,u_horizon_color,pow(1.0-blend/u_sky_horizon_blend,2.0));} else {fragColor=u_sky_color;}}fragColor=mix(fragColor,vec4(vec3(0.0),0.0),u_sky_blend);}","in vec2 a_pos;void main() {gl_Position=vec4(a_pos,1.0,1.0);}")};function De(m,e){let a=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,c=e.match(/in ([\w]+) ([\w]+)/g),s=m.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),W=e.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),Z=W?W.concat(s):s,u={};return{fragmentSource:m=m.replace(a,((G,U,X,Q,k)=>(u[k]=!0,U==="define"?`
#ifndef HAS_UNIFORM_u_${k}
in ${X} ${Q} ${k};
#else
uniform ${X} ${Q} u_${k};
#endif
`:`
#ifdef HAS_UNIFORM_u_${k}
    ${X} ${Q} ${k} = u_${k};
#endif
`))),vertexSource:e=e.replace(a,((G,U,X,Q,k)=>{let j=Q==="float"?"vec2":"vec4",H=k.match(/color/)?"color":j;return u[k]?U==="define"?`
#ifndef HAS_UNIFORM_u_${k}
uniform lowp float u_${k}_t;
in ${X} ${j} a_${k};
out ${X} ${Q} ${k};
#else
uniform ${X} ${Q} u_${k};
#endif
`:H==="vec4"?`
#ifndef HAS_UNIFORM_u_${k}
    ${k} = a_${k};
#else
    ${X} ${Q} ${k} = u_${k};
#endif
`:`
#ifndef HAS_UNIFORM_u_${k}
    ${k} = unpack_mix_${H}(a_${k}, u_${k}_t);
#else
    ${X} ${Q} ${k} = u_${k};
#endif
`:U==="define"?`
#ifndef HAS_UNIFORM_u_${k}
uniform lowp float u_${k}_t;
in ${X} ${j} a_${k};
#else
uniform ${X} ${Q} u_${k};
#endif
`:H==="vec4"?`
#ifndef HAS_UNIFORM_u_${k}
    ${X} ${Q} ${k} = a_${k};
#else
    ${X} ${Q} ${k} = u_${k};
#endif
`:`
#ifndef HAS_UNIFORM_u_${k}
    ${X} ${Q} ${k} = unpack_mix_${H}(a_${k}, u_${k}_t);
#else
    ${X} ${Q} ${k} = u_${k};
#endif
`})),staticAttributes:c,staticUniforms:Z}}class rn{constructor(e,a,c){this.vertexBuffer=e,this.indexBuffer=a,this.segments=c}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.vertexBuffer=null,this.indexBuffer=null,this.segments=null}}var fi=o.aT([{name:"a_pos",type:"Int16",components:2}]);let Xl="#define PROJECTION_MERCATOR",Gl="mercator";class rl{constructor(){this._cachedMesh=null}get name(){return"mercator"}get useSubdivision(){return!1}get shaderVariantName(){return Gl}get shaderDefine(){return Xl}get shaderPreludeCode(){return ma.projectionMercator}get vertexShaderPreludeCode(){return ma.projectionMercator.vertexSource}get subdivisionGranularity(){return o.aU.noSubdivision}get useGlobeControls(){return!1}get transitionState(){return 0}get latitudeErrorCorrectionRadians(){return 0}destroy(){}updateGPUdependent(e){}getMeshFromTileID(e,a,c,s,W){if(this._cachedMesh)return this._cachedMesh;let Z=new o.aV;Z.emplaceBack(0,0),Z.emplaceBack(o.a4,0),Z.emplaceBack(0,o.a4),Z.emplaceBack(o.a4,o.a4);let u=e.createVertexBuffer(Z,fi.members),G=o.aW.simpleSegment(0,0,4,2),U=new o.aX;U.emplaceBack(1,0,2),U.emplaceBack(1,2,3);let X=e.createIndexBuffer(U);return this._cachedMesh=new rn(u,X,G),this._cachedMesh}recalculate(){}hasTransition(){return!1}setErrorQueryLatitudeDegrees(e){}}class pi{constructor(e=0,a=0,c=0,s=0){if(isNaN(e)||e<0||isNaN(a)||a<0||isNaN(c)||c<0||isNaN(s)||s<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=e,this.bottom=a,this.left=c,this.right=s}interpolate(e,a,c){return a.top!=null&&e.top!=null&&(this.top=o.G.number(e.top,a.top,c)),a.bottom!=null&&e.bottom!=null&&(this.bottom=o.G.number(e.bottom,a.bottom,c)),a.left!=null&&e.left!=null&&(this.left=o.G.number(e.left,a.left,c)),a.right!=null&&e.right!=null&&(this.right=o.G.number(e.right,a.right,c)),this}getCenter(e,a){let c=o.an((this.left+e-this.right)/2,0,e),s=o.an((this.top+a-this.bottom)/2,0,a);return new o.P(c,s)}equals(e){return this.top===e.top&&this.bottom===e.bottom&&this.left===e.left&&this.right===e.right}clone(){return new pi(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function pd(m,e){if(!m.renderWorldCopies||m.lngRange)return;let a=e.lng-m.center.lng;e.lng+=a>180?-360:a<-180?360:0}function wl(m){return Math.max(0,Math.floor(m))}class ta{constructor(e,a){var c;this.applyConstrain=(s,W)=>this._constrainOverride!==null?this._constrainOverride(s,W):this._callbacks.defaultConstrain(s,W),this._callbacks=e,this._tileSize=512,this._renderWorldCopies=a?.renderWorldCopies===void 0||!!a?.renderWorldCopies,this._minZoom=a?.minZoom||0,this._maxZoom=a?.maxZoom||22,this._minPitch=a?.minPitch==null?0:a?.minPitch,this._maxPitch=a?.maxPitch==null?60:a?.maxPitch,this._constrainOverride=(c=a?.constrainOverride)!==null&&c!==void 0?c:null,this.setMaxBounds(),this._width=0,this._height=0,this._center=new o.V(0,0),this._elevation=0,this._zoom=0,this._tileZoom=wl(this._zoom),this._scale=o.aq(this._zoom),this._bearingInRadians=0,this._fovInRadians=.6435011087932844,this._pitchInRadians=0,this._rollInRadians=0,this._unmodified=!0,this._edgeInsets=new pi,this._minElevationForCurrentTile=0,this._autoCalculateNearFarZ=!0}apply(e,a,c){this._constrainOverride=e.constrainOverride,this._latRange=e.latRange,this._lngRange=e.lngRange,this._width=e.width,this._height=e.height,this._center=e.center,this._elevation=e.elevation,this._minElevationForCurrentTile=e.minElevationForCurrentTile,this._zoom=e.zoom,this._tileZoom=wl(this._zoom),this._scale=o.aq(this._zoom),this._bearingInRadians=e.bearingInRadians,this._fovInRadians=e.fovInRadians,this._pitchInRadians=e.pitchInRadians,this._rollInRadians=e.rollInRadians,this._unmodified=e.unmodified,this._edgeInsets=new pi(e.padding.top,e.padding.bottom,e.padding.left,e.padding.right),this._minZoom=e.minZoom,this._maxZoom=e.maxZoom,this._minPitch=e.minPitch,this._maxPitch=e.maxPitch,this._renderWorldCopies=e.renderWorldCopies,this._cameraToCenterDistance=e.cameraToCenterDistance,this._nearZ=e.nearZ,this._farZ=e.farZ,this._autoCalculateNearFarZ=!c&&e.autoCalculateNearFarZ,a&&this.constrainInternal(),this._calcMatrices()}get pixelsToClipSpaceMatrix(){return this._pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._clipSpaceToPixelsMatrix}get minElevationForCurrentTile(){return this._minElevationForCurrentTile}setMinElevationForCurrentTile(e){this._minElevationForCurrentTile=e}get tileSize(){return this._tileSize}get tileZoom(){return this._tileZoom}get scale(){return this._scale}get width(){return this._width}get height(){return this._height}get bearingInRadians(){return this._bearingInRadians}get lngRange(){return this._lngRange}get latRange(){return this._latRange}get pixelsToGLUnits(){return this._pixelsToGLUnits}get minZoom(){return this._minZoom}setMinZoom(e){this._minZoom!==e&&(this._minZoom=e,this.setZoom(this.applyConstrain(this._center,this.zoom).zoom))}get maxZoom(){return this._maxZoom}setMaxZoom(e){this._maxZoom!==e&&(this._maxZoom=e,this.setZoom(this.applyConstrain(this._center,this.zoom).zoom))}get minPitch(){return this._minPitch}setMinPitch(e){this._minPitch!==e&&(this._minPitch=e,this.setPitch(Math.max(this.pitch,e)))}get maxPitch(){return this._maxPitch}setMaxPitch(e){this._maxPitch!==e&&(this._maxPitch=e,this.setPitch(Math.min(this.pitch,e)))}get renderWorldCopies(){return this._renderWorldCopies}setRenderWorldCopies(e){e===void 0?e=!0:e===null&&(e=!1),this._renderWorldCopies=e}get constrainOverride(){return this._constrainOverride}setConstrainOverride(e){e===void 0&&(e=null),this._constrainOverride!==e&&(this._constrainOverride=e,this.constrainInternal(),this._calcMatrices())}get worldSize(){return this._tileSize*this._scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new o.P(this._width,this._height)}get bearing(){return this._bearingInRadians/Math.PI*180}setBearing(e){let a=o.W(e,-180,180)*Math.PI/180;var c,s,W,Z,u,G,U,X,Q;this._bearingInRadians!==a&&(this._unmodified=!1,this._bearingInRadians=a,this._calcMatrices(),this._rotationMatrix=Ct(),c=this._rotationMatrix,W=-this._bearingInRadians,Z=(s=this._rotationMatrix)[0],u=s[1],G=s[2],U=s[3],X=Math.sin(W),Q=Math.cos(W),c[0]=Z*Q+G*X,c[1]=u*Q+U*X,c[2]=Z*-X+G*Q,c[3]=u*-X+U*Q)}get rotationMatrix(){return this._rotationMatrix}get pitchInRadians(){return this._pitchInRadians}get pitch(){return this._pitchInRadians/Math.PI*180}setPitch(e){let a=o.an(e,this.minPitch,this.maxPitch)/180*Math.PI;this._pitchInRadians!==a&&(this._unmodified=!1,this._pitchInRadians=a,this._calcMatrices())}get rollInRadians(){return this._rollInRadians}get roll(){return this._rollInRadians/Math.PI*180}setRoll(e){let a=e/180*Math.PI;this._rollInRadians!==a&&(this._unmodified=!1,this._rollInRadians=a,this._calcMatrices())}get fovInRadians(){return this._fovInRadians}get fov(){return o.aY(this._fovInRadians)}setFov(e){e=o.an(e,.1,150),this.fov!==e&&(this._unmodified=!1,this._fovInRadians=o.ap(e),this._calcMatrices())}get zoom(){return this._zoom}setZoom(e){let a=this.applyConstrain(this._center,e).zoom;this._zoom!==a&&(this._unmodified=!1,this._zoom=a,this._tileZoom=Math.max(0,Math.floor(a)),this._scale=o.aq(a),this.constrainInternal(),this._calcMatrices())}get center(){return this._center}setCenter(e){e.lat===this._center.lat&&e.lng===this._center.lng||(this._unmodified=!1,this._center=e,this.constrainInternal(),this._calcMatrices())}get elevation(){return this._elevation}setElevation(e){e!==this._elevation&&(this._elevation=e,this.constrainInternal(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}setPadding(e){this._edgeInsets.equals(e)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,e,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this._width,this._height)}get pixelsPerMeter(){return this._pixelPerMeter}get unmodified(){return this._unmodified}get cameraToCenterDistance(){return this._cameraToCenterDistance}get nearZ(){return this._nearZ}get farZ(){return this._farZ}get autoCalculateNearFarZ(){return this._autoCalculateNearFarZ}overrideNearFarZ(e,a){this._autoCalculateNearFarZ=!1,this._nearZ=e,this._farZ=a,this._calcMatrices()}clearNearFarZOverride(){this._autoCalculateNearFarZ=!0,this._calcMatrices()}isPaddingEqual(e){return this._edgeInsets.equals(e)}interpolatePadding(e,a,c){this._unmodified=!1,this._edgeInsets.interpolate(e,a,c),this.constrainInternal(),this._calcMatrices()}resize(e,a,c=!0){this._width=e,this._height=a,c&&this.constrainInternal(),this._calcMatrices()}getMaxBounds(){return this._latRange&&this._latRange.length===2&&this._lngRange&&this._lngRange.length===2?new si([this._lngRange[0],this._latRange[0]],[this._lngRange[1],this._latRange[1]]):null}setMaxBounds(e){e?(this._lngRange=[e.getWest(),e.getEast()],this._latRange=[e.getSouth(),e.getNorth()],this.constrainInternal()):(this._lngRange=null,this._latRange=[-o.ao,o.ao])}getCameraQueryGeometry(e,a){if(a.length===1)return[a[0],e];{let{minX:c,minY:s,maxX:W,maxY:Z}=o.ab.fromPoints(a).extend(e);return[new o.P(c,s),new o.P(W,s),new o.P(W,Z),new o.P(c,Z),new o.P(c,s)]}}constrainInternal(){if(!this.center||!this._width||!this._height||this._constraining)return;this._constraining=!0;let e=this._unmodified,{center:a,zoom:c}=this.applyConstrain(this.center,this.zoom);this.setCenter(a),this.setZoom(c),this._unmodified=e,this._constraining=!1}_calcMatrices(){if(this._width&&this._height){this._pixelsToGLUnits=[2/this._width,-2/this._height];let e=o.ar(new Float64Array(16));o.Q(e,e,[this._width/2,-this._height/2,1]),o.O(e,e,[1,-1,0]),this._clipSpaceToPixelsMatrix=e,e=o.ar(new Float64Array(16)),o.Q(e,e,[1,-1,1]),o.O(e,e,[-1,-1,0]),o.Q(e,e,[2/this._width,2/this._height,1]),this._pixelsToClipSpaceMatrix=e,this._cameraToCenterDistance=.5/Math.tan(this.fovInRadians/2)*this._height}this._callbacks.calcMatrices()}calculateCenterFromCameraLngLatAlt(e,a,c,s){let W=c!==void 0?c:this.bearing,Z=s=s!==void 0?s:this.pitch,u=o.aa.fromLngLat(e,a),G=-Math.cos(o.ap(Z)),U=Math.sin(o.ap(Z)),X=U*Math.sin(o.ap(W)),Q=-U*Math.cos(o.ap(W)),k=this.elevation,j=a-k,H;G*j>=0||Math.abs(G)<.1?(H=1e4,k=a+H*G):H=-j/G;let q,$,et=o.aZ(1,u.y),nt=0;do{if(nt+=1,nt>10)break;$=H/et,q=new o.aa(u.x+X*$,u.y+Q*$),et=1/q.meterInMercatorCoordinateUnits()}while(Math.abs(H-$*et)>1e-12);return{center:q.toLngLat(),elevation:k,zoom:o.at(this.height/2/Math.tan(this.fovInRadians/2)/$/this.tileSize)}}recalculateZoomAndCenter(e){if(this.elevation-e==0)return;let a=o.as(1,this.center.lat)*this.worldSize,c=this.cameraToCenterDistance/a,s=o.aa.fromLngLat(this.center,this.elevation),W=ut(this.center,this.elevation,this.pitch,this.bearing,c);this._elevation=e;let Z=this.calculateCenterFromCameraLngLatAlt(W.toLngLat(),o.aZ(W.z,s.y),this.bearing,this.pitch);this._elevation=Z.elevation,this._center=Z.center,this.setZoom(Z.zoom)}getCameraPoint(){let e=Math.tan(this.pitchInRadians)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new o.P(e*Math.sin(this.rollInRadians),e*Math.cos(this.rollInRadians)))}getCameraAltitude(){return Math.cos(this.pitchInRadians)*this._cameraToCenterDistance/this._pixelPerMeter+this.elevation}getCameraLngLat(){let e=o.as(1,this.center.lat)*this.worldSize;return ut(this.center,this.elevation,this.pitch,this.bearing,this.cameraToCenterDistance/e).toLngLat()}getMercatorTileCoordinates(e){if(!e)return[0,0,1,1];let a=e.canonical.z>=0?1<<e.canonical.z:Math.pow(2,e.canonical.z);return[e.canonical.x/a,e.canonical.y/a,1/a/o.a4,1/a/o.a4]}}class Jl{constructor(e,a){this.min=e,this.max=a,this.center=o.a_([],o.a$([],this.min,this.max),.5)}quadrant(e){let a=[e%2==0,e<2],c=o.b0(this.min),s=o.b0(this.max);for(let W=0;W<a.length;W++)c[W]=a[W]?this.min[W]:this.center[W],s[W]=a[W]?this.center[W]:this.max[W];return s[2]=this.max[2],new Jl(c,s)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}intersectsFrustum(e){let a=!0;for(let c=0;c<e.planes.length;c++){let s=this.intersectsPlane(e.planes[c]);if(s===0)return 0;s===1&&(a=!1)}return a?2:e.aabb.min[0]>this.max[0]||e.aabb.min[1]>this.max[1]||e.aabb.min[2]>this.max[2]||e.aabb.max[0]<this.min[0]||e.aabb.max[1]<this.min[1]||e.aabb.max[2]<this.min[2]?0:1}intersectsPlane(e){let a=e[3],c=e[3];for(let s=0;s<3;s++)e[s]>0?(a+=e[s]*this.min[s],c+=e[s]*this.max[s]):(c+=e[s]*this.min[s],a+=e[s]*this.max[s]);return a>=0?2:c<0?0:1}}class jo{distanceToTile2d(e,a,c,s){let W=s.distanceX([e,a]),Z=s.distanceY([e,a]);return Math.hypot(W,Z)}getWrap(e,a,c){return c}getTileBoundingVolume(e,a,c,s){var W,Z;let u=0,G=0;if(s?.terrain){let X=new o.a1(e.z,a,e.z,e.x,e.y),Q=s.terrain.getMinMaxElevation(X);u=(W=Q.minElevation)!==null&&W!==void 0?W:Math.min(0,c),G=(Z=Q.maxElevation)!==null&&Z!==void 0?Z:Math.max(0,c)}let U=1<<e.z;return new Jl([a+e.x/U,e.y/U,u],[a+(e.x+1)/U,(e.y+1)/U,G])}allowVariableZoom(e,a){let c=e.fov*(Math.abs(Math.cos(e.rollInRadians))*e.height+Math.abs(Math.sin(e.rollInRadians))*e.width)/e.height,s=o.an(78.5-c/2,0,60);return!!a.terrain||e.pitch>s}allowWorldCopies(){return!0}prepareNextFrame(){}}class Mn{constructor(e,a,c){this.points=e,this.planes=a,this.aabb=c}static fromInvProjectionMatrix(e,a=1,c=0,s,W){let Z=W?[[6,5,4],[0,1,2],[0,3,7],[2,1,5],[3,2,6],[0,4,5]]:[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]],u=Math.pow(2,c),G=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map((k=>(function(j,H,q,$){let et=o.aG([],j,H),nt=1/et[3]/q*$;return o.b5(et,et,[nt,nt,1/et[3],nt])})(k,e,a,u)));s&&(function(k,j,H,q){let $=q?4:0,et=q?0:4,nt=0,mt=[],at=[];for(let ot=0;ot<4;ot++){let Ft=o.b1([],k[ot+et],k[ot+$]),Xt=o.b6(Ft);o.a_(Ft,Ft,1/Xt),mt.push(Xt),at.push(Ft)}for(let ot=0;ot<4;ot++){let Ft=o.b7(k[ot+$],at[ot],H);nt=Ft!==null&&Ft>=0?Math.max(nt,Ft):Math.max(nt,mt[ot])}let Wt=(function(ot,Ft){let Xt=o.b1([],ot[Ft[0]],ot[Ft[1]]),It=o.b1([],ot[Ft[2]],ot[Ft[1]]),Ut=[0,0,0,0];return o.b2(Ut,o.b3([],Xt,It)),Ut[3]=-o.b4(Ut,ot[Ft[0]]),Ut})(k,j),Zt=(function(ot,Ft){let Xt=o.b8(ot),It=o.b9([],ot,1/Xt),Ut=o.b1([],Ft,o.a_([],It,o.b4(Ft,It))),xt=o.b8(Ut);if(xt>0){let $t=Math.sqrt(1-It[3]*It[3]),Pt=o.a_([],It,-It[3]),At=o.a$([],Pt,o.a_([],Ut,$t/xt));return o.ba(Ft,At)}return null})(H,Wt);if(Zt!==null){let ot=Zt/o.b4(at[0],Wt);nt=Math.min(nt,ot)}for(let ot=0;ot<4;ot++){let Ft=Math.min(nt,mt[ot]);k[ot+et]=[k[ot+$][0]+at[ot][0]*Ft,k[ot+$][1]+at[ot][1]*Ft,k[ot+$][2]+at[ot][2]*Ft,1]}})(G,Z[0],s,W);let U=Z.map((k=>{let j=o.b1([],G[k[0]],G[k[1]]),H=o.b1([],G[k[2]],G[k[1]]),q=o.b2([],o.b3([],j,H)),$=-o.b4(q,G[k[1]]);return q.concat($)})),X=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY],Q=[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY];for(let k of G)for(let j=0;j<3;j++)X[j]=Math.min(X[j],k[j]),Q[j]=Math.max(Q[j],k[j]);return new Mn(G,U,new Jl(X,Q))}}class Fi{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(e){this._helper.setMinZoom(e)}setMaxZoom(e){this._helper.setMaxZoom(e)}setMinPitch(e){this._helper.setMinPitch(e)}setMaxPitch(e){this._helper.setMaxPitch(e)}setRenderWorldCopies(e){this._helper.setRenderWorldCopies(e)}setBearing(e){this._helper.setBearing(e)}setPitch(e){this._helper.setPitch(e)}setRoll(e){this._helper.setRoll(e)}setFov(e){this._helper.setFov(e)}setZoom(e){this._helper.setZoom(e)}setCenter(e){this._helper.setCenter(e)}setElevation(e){this._helper.setElevation(e)}setMinElevationForCurrentTile(e){this._helper.setMinElevationForCurrentTile(e)}setPadding(e){this._helper.setPadding(e)}interpolatePadding(e,a,c){return this._helper.interpolatePadding(e,a,c)}isPaddingEqual(e){return this._helper.isPaddingEqual(e)}resize(e,a,c=!0){this._helper.resize(e,a,c)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(e){this._helper.setMaxBounds(e)}setConstrainOverride(e){this._helper.setConstrainOverride(e)}overrideNearFarZ(e,a){this._helper.overrideNearFarZ(e,a)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(e){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),e)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get constrainOverride(){return this._helper.constrainOverride}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(e,a){}constructor(e){this._posMatrixCache=new Map,this._alignedPosMatrixCache=new Map,this._fogMatrixCacheF32=new Map,this.defaultConstrain=(a,c)=>{c=o.an(+c,this.minZoom,this.maxZoom);let s={center:new o.V(a.lng,a.lat),zoom:c},W=this._helper._lngRange;if(!this._helper._renderWorldCopies&&W===null){let at=179.9999999999;W=[-at,at]}let Z=this.tileSize*o.aq(s.zoom),u=0,G=Z,U=0,X=Z,Q=0,k=0,{x:j,y:H}=this.size;if(this._helper._latRange){let at=this._helper._latRange;u=o.X(at[1])*Z,G=o.X(at[0])*Z,G-u<H&&(Q=H/(G-u))}W&&(U=o.W(o.Y(W[0])*Z,0,Z),X=o.W(o.Y(W[1])*Z,0,Z),X<U&&(X+=Z),X-U<j&&(k=j/(X-U)));let{x:q,y:$}=dt(Z,a),et,nt,mt=Math.max(k||0,Q||0);if(mt){let at=new o.P(k?(X+U)/2:q,Q?(G+u)/2:$);return s.center=rt(Z,at).wrap(),s.zoom+=o.at(mt),s}if(this._helper._latRange){let at=H/2;$-at<u&&(nt=u+at),$+at>G&&(nt=G-at)}if(W){let at=(U+X)/2,Wt=q;this._helper._renderWorldCopies&&(Wt=o.W(q,at-Z/2,at+Z/2));let Zt=j/2;Wt-Zt<U&&(et=U+Zt),Wt+Zt>X&&(et=X-Zt)}if(et!==void 0||nt!==void 0){let at=new o.P(et??q,nt??$);s.center=rt(Z,at).wrap()}return s},this.applyConstrain=(a,c)=>this._helper.applyConstrain(a,c),this._helper=new ta({calcMatrices:()=>{this._calcMatrices()},defaultConstrain:(a,c)=>this.defaultConstrain(a,c)},e),this._coveringTilesDetailsProvider=new jo}clone(){let e=new Fi;return e.apply(this),e}apply(e,a,c){this._helper.apply(e,a,c)}get cameraPosition(){return this._cameraPosition}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._viewProjMatrix}get inverseProjectionMatrix(){return this._invProjMatrix}get mercatorMatrix(){return this._mercatorMatrix}getVisibleUnwrappedCoordinates(e){let a=[new o.bb(0,e)];if(this._helper._renderWorldCopies){let c=this.screenPointToMercatorCoordinate(new o.P(0,0)),s=this.screenPointToMercatorCoordinate(new o.P(this._helper._width,0)),W=this.screenPointToMercatorCoordinate(new o.P(this._helper._width,this._helper._height)),Z=this.screenPointToMercatorCoordinate(new o.P(0,this._helper._height)),u=Math.floor(Math.min(c.x,s.x,W.x,Z.x)),G=Math.floor(Math.max(c.x,s.x,W.x,Z.x)),U=1;for(let X=u-U;X<=G+U;X++)X!==0&&a.push(new o.bb(X,e))}return a}getCameraFrustum(){return Mn.fromInvProjectionMatrix(this._invViewProjMatrix,this.worldSize)}getClippingPlane(){return null}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(e){let a=this.screenPointToLocation(this.centerPoint,e),c=e?e.getElevationForLngLatZoom(a,this._helper._tileZoom):0;this._helper.recalculateZoomAndCenter(c)}setLocationAtPoint(e,a){let c=o.as(this.elevation,this.center.lat),s=this.screenPointToMercatorCoordinateAtZ(a,c),W=this.screenPointToMercatorCoordinateAtZ(this.centerPoint,c),Z=o.aa.fromLngLat(e),u=new o.aa(Z.x-(s.x-W.x),Z.y-(s.y-W.y));this.setCenter(u?.toLngLat()),this._helper._renderWorldCopies&&this.setCenter(this.center.wrap())}locationToScreenPoint(e,a){return a?this.coordinatePoint(o.aa.fromLngLat(e),a.getElevationForLngLatZoom(e,this._helper._tileZoom),this._pixelMatrix3D):this.coordinatePoint(o.aa.fromLngLat(e))}screenPointToLocation(e,a){var c;return(c=this.screenPointToMercatorCoordinate(e,a))===null||c===void 0?void 0:c.toLngLat()}screenPointToMercatorCoordinate(e,a){if(a){let c=a.pointCoordinate(e);if(c!=null)return c}return this.screenPointToMercatorCoordinateAtZ(e)}screenPointToMercatorCoordinateAtZ(e,a){let c=a||0,s=[e.x,e.y,0,1],W=[e.x,e.y,1,1];o.aG(s,s,this._pixelMatrixInverse),o.aG(W,W,this._pixelMatrixInverse);let Z=s[3],u=W[3],G=s[1]/Z,U=W[1]/u,X=s[2]/Z,Q=W[2]/u,k=X===Q?0:(c-X)/(Q-X);return new o.aa(o.G.number(s[0]/Z,W[0]/u,k)/this.worldSize,o.G.number(G,U,k)/this.worldSize,c)}coordinatePoint(e,a=0,c=this._pixelMatrix){let s=[e.x*this.worldSize,e.y*this.worldSize,a,1];return o.aG(s,s,c),new o.P(s[0]/s[3],s[1]/s[3])}getBounds(){let e=Math.max(0,this._helper._height/2-Nt(this));return new si().extend(this.screenPointToLocation(new o.P(0,e))).extend(this.screenPointToLocation(new o.P(this._helper._width,e))).extend(this.screenPointToLocation(new o.P(this._helper._width,this._helper._height))).extend(this.screenPointToLocation(new o.P(0,this._helper._height)))}isPointOnMapSurface(e,a){return a?a.pointCoordinate(e)!=null:e.y>this.height/2-Nt(this)}calculatePosMatrix(e,a=!1,c){var s;let W=(s=e.key)!==null&&s!==void 0?s:o.bc(e.wrap,e.canonical.z,e.canonical.z,e.canonical.x,e.canonical.y),Z=a?this._alignedPosMatrixCache:this._posMatrixCache;if(Z.has(W)){let U=Z.get(W);return c?U.f32:U.f64}let u=K(e,this.worldSize);o.S(u,a?this._alignedProjMatrix:this._viewProjMatrix,u);let G={f64:u,f32:new Float32Array(u)};return Z.set(W,G),c?G.f32:G.f64}calculateFogMatrix(e){let a=e.key,c=this._fogMatrixCacheF32;if(c.has(a))return c.get(a);let s=K(e,this.worldSize);return o.S(s,this._fogMatrix,s),c.set(a,new Float32Array(s)),c.get(a)}calculateCenterFromCameraLngLatAlt(e,a,c,s){return this._helper.calculateCenterFromCameraLngLatAlt(e,a,c,s)}_calculateNearFarZIfNeeded(e,a,c){if(!this._helper.autoCalculateNearFarZ)return;let s=Math.min(this.elevation,this.minElevationForCurrentTile,this.getCameraAltitude()-100),W=e-s*this._helper._pixelPerMeter/Math.cos(a),Z=s<0?W:e,u=Math.PI/2+this.pitchInRadians,G=o.ap(this.fov)*(Math.abs(Math.cos(o.ap(this.roll)))*this.height+Math.abs(Math.sin(o.ap(this.roll)))*this.width)/this.height*(.5+c.y/this.height),U=Math.sin(G)*Z/Math.sin(o.an(Math.PI-u-G,.01,Math.PI-.01)),X=Nt(this),Q=Math.atan(X/this._helper.cameraToCenterDistance),k=o.ap(.75),j=Q>k?2*Q*(.5+c.y/(2*X)):k,H=Math.sin(j)*Z/Math.sin(o.an(Math.PI-u-j,.01,Math.PI-.01)),q=Math.min(U,H);this._helper._farZ=1.01*(Math.cos(Math.PI/2-a)*q+Z),this._helper._nearZ=this._helper._height/50}_calcMatrices(){if(!this._helper._height)return;let e=this.centerOffset,a=dt(this.worldSize,this.center),c=a.x,s=a.y;this._helper._pixelPerMeter=o.as(1,this.center.lat)*this.worldSize;let W=o.ap(Math.min(this.pitch,O)),Z=Math.max(this._helper.cameraToCenterDistance/2,this._helper.cameraToCenterDistance+this._helper._elevation*this._helper._pixelPerMeter/Math.cos(W)),u;this._calculateNearFarZIfNeeded(Z,W,e),u=new Float64Array(16),o.bd(u,this.fovInRadians,this._helper._width/this._helper._height,this._helper._nearZ,this._helper._farZ),this._invProjMatrix=new Float64Array(16),o.aA(this._invProjMatrix,u),u[8]=2*-e.x/this._helper._width,u[9]=2*e.y/this._helper._height,this._projectionMatrix=o.be(u),o.Q(u,u,[1,-1,1]),o.O(u,u,[0,0,-this._helper.cameraToCenterDistance]),o.bf(u,u,-this.rollInRadians),o.bg(u,u,this.pitchInRadians),o.bf(u,u,-this.bearingInRadians),o.O(u,u,[-c,-s,0]),this._mercatorMatrix=o.Q([],u,[this.worldSize,this.worldSize,this.worldSize]),o.Q(u,u,[1,1,this._helper._pixelPerMeter]),this._pixelMatrix=o.S(new Float64Array(16),this.clipSpaceToPixelsMatrix,u),o.O(u,u,[0,0,-this.elevation]),this._viewProjMatrix=u,this._invViewProjMatrix=o.aA([],u);let G=[0,0,-1,1];o.aG(G,G,this._invViewProjMatrix),this._cameraPosition=[G[0]/G[3],G[1]/G[3],G[2]/G[3]],this._fogMatrix=new Float64Array(16),o.bd(this._fogMatrix,this.fovInRadians,this.width/this.height,Z,this._helper._farZ),this._fogMatrix[8]=2*-e.x/this.width,this._fogMatrix[9]=2*e.y/this.height,o.Q(this._fogMatrix,this._fogMatrix,[1,-1,1]),o.O(this._fogMatrix,this._fogMatrix,[0,0,-this.cameraToCenterDistance]),o.bf(this._fogMatrix,this._fogMatrix,-this.rollInRadians),o.bg(this._fogMatrix,this._fogMatrix,this.pitchInRadians),o.bf(this._fogMatrix,this._fogMatrix,-this.bearingInRadians),o.O(this._fogMatrix,this._fogMatrix,[-c,-s,0]),o.Q(this._fogMatrix,this._fogMatrix,[1,1,this._helper._pixelPerMeter]),o.O(this._fogMatrix,this._fogMatrix,[0,0,-this.elevation]),this._pixelMatrix3D=o.S(new Float64Array(16),this.clipSpaceToPixelsMatrix,u);let U=this._helper._width%2/2,X=this._helper._height%2/2,Q=Math.cos(this.bearingInRadians),k=Math.sin(-this.bearingInRadians),j=c-Math.round(c)+Q*U+k*X,H=s-Math.round(s)+Q*X+k*U,q=new Float64Array(u);if(o.O(q,q,[j>.5?j-1:j,H>.5?H-1:H,0]),this._alignedProjMatrix=q,u=o.aA(new Float64Array(16),this._pixelMatrix),!u)throw new Error("failed to invert matrix");this._pixelMatrixInverse=u,this._clearMatrixCaches()}_clearMatrixCaches(){this._posMatrixCache.clear(),this._alignedPosMatrixCache.clear(),this._fogMatrixCacheF32.clear()}maxPitchScaleFactor(){if(!this._pixelMatrixInverse)return 1;let e=this.screenPointToMercatorCoordinate(new o.P(0,0)),a=[e.x*this.worldSize,e.y*this.worldSize,0,1];return o.aG(a,a,this._pixelMatrix)[3]/this._helper.cameraToCenterDistance}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){let e=o.as(1,this.center.lat)*this.worldSize;return ut(this.center,this.elevation,this.pitch,this.bearing,this._helper.cameraToCenterDistance/e).toLngLat()}lngLatToCameraDepth(e,a){let c=o.aa.fromLngLat(e),s=[c.x*this.worldSize,c.y*this.worldSize,a,1];return o.aG(s,s,this._viewProjMatrix),s[2]/s[3]}getProjectionData(e){let{overscaledTileID:a,aligned:c,applyTerrainMatrix:s}=e,W=this._helper.getMercatorTileCoordinates(a),Z=a?this.calculatePosMatrix(a,c,!0):null,u;return u=a&&a.terrainRttPosMatrix32f&&s?a.terrainRttPosMatrix32f:Z||o.bh(),{mainMatrix:u,tileMercatorCoords:W,clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:u}}isLocationOccluded(e){return!1}getPixelScale(){return 1}getCircleRadiusCorrection(){return 1}getPitchedTextCorrection(e,a,c){return 1}transformLightDirection(e){return o.b0(e)}getRayDirectionFromPixel(e){throw new Error("Not implemented.")}projectTileCoordinates(e,a,c,s){let W=this.calculatePosMatrix(c),Z;s?(Z=[e,a,s(e,a),1],o.aG(Z,Z,W)):(Z=[e,a,0,1],wn(Z,Z,W));let u=Z[3];return{point:new o.P(Z[0]/u,Z[1]/u),signedDistanceFromCamera:u,isOccluded:!1}}populateCache(e){for(let a of e)this.calculatePosMatrix(a)}getMatrixForModel(e,a){let c=o.aa.fromLngLat(e,a),s=c.meterInMercatorCoordinateUnits(),W=o.bi();return o.O(W,W,[c.x,c.y,c.z]),o.bf(W,W,Math.PI),o.bg(W,W,Math.PI/2),o.Q(W,W,[-s,s,s]),W}getProjectionDataForCustomLayer(e=!0){let a=new o.a1(0,0,0,0,0),c=this.getProjectionData({overscaledTileID:a,applyGlobeMatrix:e}),s=K(a,this.worldSize);o.S(s,this._viewProjMatrix,s),c.tileMercatorCoords=[0,0,1,1];let W=[o.a4,o.a4,this.worldSize/this._helper.pixelsPerMeter],Z=o.bj();return o.Q(Z,s,W),c.fallbackMatrix=Z,c.mainMatrix=Z,c}getFastPathSimpleProjectionMatrix(e){return this.calculatePosMatrix(e)}}function Vd(){o.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}function sn(m){if(m.useSlerp)if(m.k<1){let e=o.bk(m.startEulerAngles.roll,m.startEulerAngles.pitch,m.startEulerAngles.bearing),a=o.bk(m.endEulerAngles.roll,m.endEulerAngles.pitch,m.endEulerAngles.bearing),c=new Float64Array(4);o.bl(c,e,a,m.k);let s=o.bm(c);m.tr.setRoll(s.roll),m.tr.setPitch(s.pitch),m.tr.setBearing(s.bearing)}else m.tr.setRoll(m.endEulerAngles.roll),m.tr.setPitch(m.endEulerAngles.pitch),m.tr.setBearing(m.endEulerAngles.bearing);else m.tr.setRoll(o.G.number(m.startEulerAngles.roll,m.endEulerAngles.roll,m.k)),m.tr.setPitch(o.G.number(m.startEulerAngles.pitch,m.endEulerAngles.pitch,m.k)),m.tr.setBearing(o.G.number(m.startEulerAngles.bearing,m.endEulerAngles.bearing,m.k))}function _n(m,e,a,c,s){let W=s.padding,Z=dt(s.worldSize,a.getNorthWest()),u=dt(s.worldSize,a.getNorthEast()),G=dt(s.worldSize,a.getSouthEast()),U=dt(s.worldSize,a.getSouthWest()),X=o.ap(-c),Q=Z.rotate(X),k=u.rotate(X),j=G.rotate(X),H=U.rotate(X),q=new o.P(Math.max(Q.x,k.x,H.x,j.x),Math.max(Q.y,k.y,H.y,j.y)),$=new o.P(Math.min(Q.x,k.x,H.x,j.x),Math.min(Q.y,k.y,H.y,j.y)),et=q.sub($),nt=(s.width-(W.left+W.right+e.left+e.right))/et.x,mt=(s.height-(W.top+W.bottom+e.top+e.bottom))/et.y;if(mt<0||nt<0)return void Vd();let at=Math.min(o.at(s.scale*Math.min(nt,mt)),m.maxZoom),Wt=o.P.convert(m.offset),Zt=new o.P((e.left-e.right)/2,(e.top-e.bottom)/2).rotate(o.ap(c)),ot=Wt.add(Zt).mult(s.scale/o.aq(at));return{center:rt(s.worldSize,Z.add(G).div(2).sub(ot)),zoom:at,bearing:c}}class vl{get useGlobeControls(){return!1}handlePanInertia(e,a){let c=e.mag(),s=Math.abs(Nt(a));return{easingOffset:e.mult(Math.min(.75*s/c,1)),easingCenter:a.center}}handleMapControlsRollPitchBearingZoom(e,a){e.bearingDelta&&a.setBearing(a.bearing+e.bearingDelta),e.pitchDelta&&a.setPitch(a.pitch+e.pitchDelta),e.rollDelta&&a.setRoll(a.roll+e.rollDelta),e.zoomDelta&&a.setZoom(a.zoom+e.zoomDelta)}handleMapControlsPan(e,a,c){e.around.distSqr(a.centerPoint)<.01||a.setLocationAtPoint(c,e.around)}cameraForBoxAndBearing(e,a,c,s,W){return _n(e,a,c,s,W)}handleJumpToCenterZoom(e,a){e.zoom!==(a.zoom!==void 0?+a.zoom:e.zoom)&&e.setZoom(+a.zoom),a.center!==void 0&&e.setCenter(o.V.convert(a.center))}handleEaseTo(e,a){let c=e.zoom,s=e.padding,W={roll:e.roll,pitch:e.pitch,bearing:e.bearing},Z={roll:a.roll===void 0?e.roll:a.roll,pitch:a.pitch===void 0?e.pitch:a.pitch,bearing:a.bearing===void 0?e.bearing:a.bearing},u=a.zoom!==void 0,G=!e.isPaddingEqual(a.padding),U=!1,X=u?+a.zoom:e.zoom,Q=e.centerPoint.add(a.offsetAsPoint),k=e.screenPointToLocation(Q),{center:j,zoom:H}=e.applyConstrain(o.V.convert(a.center||k),X??c);pd(e,j);let q=dt(e.worldSize,k),$=dt(e.worldSize,j).sub(q),et=o.aq(H-c);return U=H!==c,{easeFunc:nt=>{if(U&&e.setZoom(o.G.number(c,H,nt)),o.bn(W,Z)||sn({startEulerAngles:W,endEulerAngles:Z,tr:e,k:nt,useSlerp:W.roll!=Z.roll}),G&&(e.interpolatePadding(s,a.padding,nt),Q=e.centerPoint.add(a.offsetAsPoint)),a.around)e.setLocationAtPoint(a.around,a.aroundPoint);else{let mt=o.aq(e.zoom-c),at=H>c?Math.min(2,et):Math.max(.5,et),Wt=Math.pow(at,1-nt),Zt=rt(e.worldSize,q.add($.mult(nt*Wt)).mult(mt));e.setLocationAtPoint(e.renderWorldCopies?Zt.wrap():Zt,Q)}},isZooming:U,elevationCenter:j}}handleFlyTo(e,a){let c=a.zoom!==void 0,s=e.zoom,W=e.applyConstrain(o.V.convert(a.center||a.locationAtOffset),c?+a.zoom:s),Z=W.center,u=W.zoom;pd(e,Z);let G=dt(e.worldSize,a.locationAtOffset),U=dt(e.worldSize,Z).sub(G),X=U.mag(),Q=o.aq(u-s),k;if(a.minZoom!==void 0){let j=Math.min(+a.minZoom,s,u),H=e.applyConstrain(Z,j).zoom;k=o.aq(H-s)}return{easeFunc:(j,H,q,$)=>{e.setZoom(j===1?u:s+o.at(H));let et=j===1?Z:rt(e.worldSize,G.add(U.mult(q)).mult(H));e.setLocationAtPoint(e.renderWorldCopies?et.wrap():et,$)},scaleOfZoom:Q,targetCenter:Z,scaleOfMinZoom:k,pixelPathLength:X}}}class mi{constructor(e,a,c){this.blendFunction=e,this.blendColor=a,this.mask=c}}mi.Replace=[1,0],mi.disabled=new mi(mi.Replace,o.bo.transparent,[!1,!1,!1,!1]),mi.unblended=new mi(mi.Replace,o.bo.transparent,[!0,!0,!0,!0]),mi.alphaBlended=new mi([1,771],o.bo.transparent,[!0,!0,!0,!0]);let Qa=2305;class $e{constructor(e,a,c){this.enable=e,this.mode=a,this.frontFace=c}}$e.disabled=new $e(!1,1029,Qa),$e.backCCW=new $e(!0,1029,Qa),$e.frontCCW=new $e(!0,1028,Qa);class Se{constructor(e,a,c){this.func=e,this.mask=a,this.range=c}}Se.ReadOnly=!1,Se.ReadWrite=!0,Se.disabled=new Se(519,Se.ReadOnly,[0,1]);let gd=7680;class Ke{constructor(e,a,c,s,W,Z){this.test=e,this.ref=a,this.mask=c,this.fail=s,this.depthFail=W,this.pass=Z}}Ke.disabled=new Ke({func:519,mask:0},0,0,gd,gd,gd);let ud=new WeakMap;function Hl(m){var e;if(ud.has(m))return ud.get(m);{let a=(e=m.getParameter(m.VERSION))===null||e===void 0?void 0:e.startsWith("WebGL 2.0");return ud.set(m,a),a}}class Rd{get awaitingQuery(){return!!this._readbackQueue}constructor(e){this._readbackWaitFrames=4,this._measureWaitFrames=6,this._texWidth=1,this._texHeight=1,this._measuredError=0,this._updateCount=0,this._lastReadbackFrame=-1e3,this._readbackQueue=null,this._cachedRenderContext=e;let a=e.context,c=a.gl;this._texFormat=c.RGBA,this._texType=c.UNSIGNED_BYTE;let s=new o.aV;s.emplaceBack(-1,-1),s.emplaceBack(2,-1),s.emplaceBack(-1,2);let W=new o.aX;W.emplaceBack(0,1,2),this._fullscreenTriangle=new rn(a.createVertexBuffer(s,fi.members),a.createIndexBuffer(W),o.aW.simpleSegment(0,0,s.length,W.length)),this._resultBuffer=new Uint8Array(4),a.activeTexture.set(c.TEXTURE1);let Z=c.createTexture();c.bindTexture(c.TEXTURE_2D,Z),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,c.CLAMP_TO_EDGE),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,c.CLAMP_TO_EDGE),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,c.NEAREST),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,c.NEAREST),c.texImage2D(c.TEXTURE_2D,0,this._texFormat,this._texWidth,this._texHeight,0,this._texFormat,this._texType,null),this._fbo=a.createFramebuffer(this._texWidth,this._texHeight,!1,!1),this._fbo.colorAttachment.set(Z),Hl(c)&&(this._pbo=c.createBuffer(),c.bindBuffer(c.PIXEL_PACK_BUFFER,this._pbo),c.bufferData(c.PIXEL_PACK_BUFFER,4,c.STREAM_READ),c.bindBuffer(c.PIXEL_PACK_BUFFER,null))}destroy(){let e=this._cachedRenderContext.context.gl;this._fullscreenTriangle.destroy(),this._fbo.destroy(),e.deleteBuffer(this._pbo),this._fullscreenTriangle=null,this._fbo=null,this._pbo=null,this._resultBuffer=null}updateErrorLoop(e,a){let c=this._updateCount;return this._readbackQueue?c>=this._readbackQueue.frameNumberIssued+this._readbackWaitFrames&&this._tryReadback():c>=this._lastReadbackFrame+this._measureWaitFrames&&this._renderErrorTexture(e,a),this._updateCount++,this._measuredError}_bindFramebuffer(){let e=this._cachedRenderContext.context,a=e.gl;e.activeTexture.set(a.TEXTURE1),a.bindTexture(a.TEXTURE_2D,this._fbo.colorAttachment.get()),e.bindFramebuffer.set(this._fbo.framebuffer)}_renderErrorTexture(e,a){let c=this._cachedRenderContext.context,s=c.gl;if(this._bindFramebuffer(),c.viewport.set([0,0,this._texWidth,this._texHeight]),c.clear({color:o.bo.transparent}),this._cachedRenderContext.useProgram("projectionErrorMeasurement").draw(c,s.TRIANGLES,Se.disabled,Ke.disabled,mi.unblended,$e.disabled,((W,Z)=>({u_input:W,u_output_expected:Z}))(e,a),null,null,"$clipping",this._fullscreenTriangle.vertexBuffer,this._fullscreenTriangle.indexBuffer,this._fullscreenTriangle.segments),this._pbo&&Hl(s)){s.bindBuffer(s.PIXEL_PACK_BUFFER,this._pbo),s.readBuffer(s.COLOR_ATTACHMENT0),s.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,0),s.bindBuffer(s.PIXEL_PACK_BUFFER,null);let W=s.fenceSync(s.SYNC_GPU_COMMANDS_COMPLETE,0);s.flush(),this._readbackQueue={frameNumberIssued:this._updateCount,sync:W}}else this._readbackQueue={frameNumberIssued:this._updateCount,sync:null}}_tryReadback(){let e=this._cachedRenderContext.context.gl;if(this._pbo&&this._readbackQueue&&Hl(e)){let a=e.clientWaitSync(this._readbackQueue.sync,0,0);if(a===e.WAIT_FAILED)return o.w("WebGL2 clientWaitSync failed."),this._readbackQueue=null,void(this._lastReadbackFrame=this._updateCount);if(a===e.TIMEOUT_EXPIRED)return;e.bindBuffer(e.PIXEL_PACK_BUFFER,this._pbo),e.getBufferSubData(e.PIXEL_PACK_BUFFER,0,this._resultBuffer,0,4),e.bindBuffer(e.PIXEL_PACK_BUFFER,null)}else this._bindFramebuffer(),e.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,this._resultBuffer);this._readbackQueue=null,this._measuredError=Rd._parseRGBA8float(this._resultBuffer),this._lastReadbackFrame=this._updateCount}static _parseRGBA8float(e){let a=0;return a+=e[0]/256,a+=e[1]/65536,a+=e[2]/16777216,e[3]<127&&(a=-a),a/128}}let bn=o.a4/128;function bc(m,e){let a=m.granularity!==void 0?Math.max(m.granularity,1):1,c=a+(m.generateBorders?2:0),s=a+(m.extendToNorthPole||m.generateBorders?1:0)+(m.extendToSouthPole||m.generateBorders?1:0),W=c+1,Z=s+1,u=m.generateBorders?-1:0,G=m.generateBorders||m.extendToNorthPole?-1:0,U=a+(m.generateBorders?1:0),X=a+(m.generateBorders||m.extendToSouthPole?1:0),Q=W*Z,k=c*s*6,j=W*Z>65536;if(j&&e==="16bit")throw new Error("Granularity is too large and meshes would not fit inside 16 bit vertex indices.");let H=j||e==="32bit",q=new Int16Array(2*Q),$=0;for(let mt=G;mt<=X;mt++)for(let at=u;at<=U;at++){let Wt=at/a*o.a4;at===-1&&(Wt=-bn),at===a+1&&(Wt=o.a4+bn);let Zt=mt/a*o.a4;mt===-1&&(Zt=m.extendToNorthPole?o.bq:-bn),mt===a+1&&(Zt=m.extendToSouthPole?o.br:o.a4+bn),q[$++]=Wt,q[$++]=Zt}let et=H?new Uint32Array(k):new Uint16Array(k),nt=0;for(let mt=0;mt<s;mt++)for(let at=0;at<c;at++){let Wt=at+1+mt*W,Zt=at+(mt+1)*W,ot=at+1+(mt+1)*W;et[nt++]=at+mt*W,et[nt++]=Zt,et[nt++]=Wt,et[nt++]=Wt,et[nt++]=Zt,et[nt++]=ot}return{vertices:q.buffer.slice(0),indices:et.buffer.slice(0),uses32bitIndices:H}}let Bd=new o.aU({fill:new o.bs(128,2),line:new o.bs(512,0),tile:new o.bs(128,32),stencil:new o.bs(128,1),circle:3});class Sd{constructor(){this._tileMeshCache={},this._errorCorrectionUsable=0,this._errorMeasurementLastValue=0,this._errorCorrectionPreviousValue=0,this._errorMeasurementLastChangeTime=-1e3}get name(){return"vertical-perspective"}get transitionState(){return 1}get useSubdivision(){return!0}get shaderVariantName(){return"globe"}get shaderDefine(){return"#define GLOBE"}get shaderPreludeCode(){return ma.projectionGlobe}get vertexShaderPreludeCode(){return ma.projectionMercator.vertexSource}get subdivisionGranularity(){return Bd}get useGlobeControls(){return!0}get latitudeErrorCorrectionRadians(){return this._errorCorrectionUsable}destroy(){this._errorMeasurement&&this._errorMeasurement.destroy()}updateGPUdependent(e){this._errorMeasurement||(this._errorMeasurement=new Rd(e));let a=o.X(this._errorQueryLatitudeDegrees),c=2*Math.atan(Math.exp(Math.PI-a*Math.PI*2))-.5*Math.PI,s=this._errorMeasurement.updateErrorLoop(a,c),W=jt();s!==this._errorMeasurementLastValue&&(this._errorCorrectionPreviousValue=this._errorCorrectionUsable,this._errorMeasurementLastValue=s,this._errorMeasurementLastChangeTime=W);let Z=Math.min(Math.max((W-this._errorMeasurementLastChangeTime)/1e3/.5,0),1);this._errorCorrectionUsable=o.bt(this._errorCorrectionPreviousValue,-this._errorMeasurementLastValue,o.bu(Z))}_getMeshKey(e){return`${e.granularity.toString(36)}_${e.generateBorders?"b":""}${e.extendToNorthPole?"n":""}${e.extendToSouthPole?"s":""}`}getMeshFromTileID(e,a,c,s,W){let Z=(W==="stencil"?Bd.stencil:Bd.tile).getGranularityForZoomLevel(a.z);return this._getMesh(e,{granularity:Z,generateBorders:c,extendToNorthPole:a.y===0&&s,extendToSouthPole:a.y===(1<<a.z)-1&&s})}_getMesh(e,a){let c=this._getMeshKey(a);if(c in this._tileMeshCache)return this._tileMeshCache[c];let s=(function(W,Z){let u=bc(Z,"16bit"),G=o.aV.deserialize({arrayBuffer:u.vertices,length:u.vertices.byteLength/2/2}),U=o.aX.deserialize({arrayBuffer:u.indices,length:u.indices.byteLength/2/3});return new rn(W.createVertexBuffer(G,fi.members),W.createIndexBuffer(U),o.aW.simpleSegment(0,0,G.length,U.length))})(e,a);return this._tileMeshCache[c]=s,s}recalculate(e){}hasTransition(){let e=jt(),a=!1;return a=a||(e-this._errorMeasurementLastChangeTime)/1e3<.7,a=a||this._errorMeasurement&&this._errorMeasurement.awaitingQuery,a}setErrorQueryLatitudeDegrees(e){this._errorQueryLatitudeDegrees=e}}let p=new o.t({type:new o.D(o.u.projection.type)});class F extends o.E{constructor(e){super(),this._transitionable=new o.x(p,void 0),this.setProjection(e),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new o.H(0)),this._mercatorProjection=new rl,this._verticalPerspectiveProjection=new Sd}get transitionState(){let e=this.properties.get("type");if(typeof e=="string"&&e==="mercator")return 0;if(typeof e=="string"&&e==="vertical-perspective")return 1;if(e instanceof o.bv){if(e.from==="vertical-perspective"&&e.to==="mercator")return 1-e.transition;if(e.from==="mercator"&&e.to==="vertical-perspective")return e.transition}return 1}get useGlobeRendering(){return this.transitionState>0}get latitudeErrorCorrectionRadians(){return this._verticalPerspectiveProjection.latitudeErrorCorrectionRadians}get currentProjection(){return this.useGlobeRendering?this._verticalPerspectiveProjection:this._mercatorProjection}get name(){return"globe"}get useSubdivision(){return this.currentProjection.useSubdivision}get shaderVariantName(){return this.currentProjection.shaderVariantName}get shaderDefine(){return this.currentProjection.shaderDefine}get shaderPreludeCode(){return this.currentProjection.shaderPreludeCode}get vertexShaderPreludeCode(){return this.currentProjection.vertexShaderPreludeCode}get subdivisionGranularity(){return this.currentProjection.subdivisionGranularity}get useGlobeControls(){return this.transitionState>0}destroy(){this._mercatorProjection.destroy(),this._verticalPerspectiveProjection.destroy()}updateGPUdependent(e){this._mercatorProjection.updateGPUdependent(e),this._verticalPerspectiveProjection.updateGPUdependent(e)}getMeshFromTileID(e,a,c,s,W){return this.currentProjection.getMeshFromTileID(e,a,c,s,W)}setProjection(e){this._transitionable.setValue("type",e?.type||"mercator")}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()||this.currentProjection.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}setErrorQueryLatitudeDegrees(e){this._verticalPerspectiveProjection.setErrorQueryLatitudeDegrees(e),this._mercatorProjection.setErrorQueryLatitudeDegrees(e)}}function T(m){let e=A(m.worldSize,m.center.lat);return 2*Math.PI*e}function y(m,e,a,c,s){let W=1/(1<<s),Z=e/o.a4*W+c*W,u=o.bx((m/o.a4*W+a*W)*Math.PI*2+Math.PI,2*Math.PI),G=2*Math.atan(Math.exp(Math.PI-Z*Math.PI*2))-.5*Math.PI,U=Math.cos(G),X=new Float64Array(3);return X[0]=Math.sin(u)*U,X[1]=Math.sin(G),X[2]=Math.cos(u)*U,X}function E(m){return(function(e,a){let c=Math.cos(a),s=new Float64Array(3);return s[0]=Math.sin(e)*c,s[1]=Math.sin(a),s[2]=Math.cos(e)*c,s})(m.lng*Math.PI/180,m.lat*Math.PI/180)}function A(m,e){return m/(2*Math.PI)/Math.cos(e*Math.PI/180)}function f(m){let e=Math.asin(m[1])/Math.PI*180,a=Math.sqrt(m[0]*m[0]+m[2]*m[2]);if(a>1e-6){let c=m[0]/a,s=Math.acos(m[2]/a),W=(c>0?s:-s)/Math.PI*180;return new o.V(o.W(W,-180,180),e)}return new o.V(0,e)}function bt(m){return Math.cos(m*Math.PI/180)}function ct(m,e){let a=bt(m),c=bt(e);return o.at(c/a)}function Gt(m,e){let a=m.rotate(e.bearingInRadians),c=e.zoom+ct(e.center.lat,0),s=o.bt(1/bt(e.center.lat),1/bt(Math.min(Math.abs(e.center.lat),60)),o.bw(c,7,3,0,1)),W=360/T({worldSize:e.worldSize,center:{lat:e.center.lat}});return new o.V(e.center.lng-a.x*W*s,o.an(e.center.lat+a.y*W,-o.ao,o.ao))}function kt(m){let e=.5*m,a=Math.sin(e),c=Math.cos(e);return Math.log(a+c)-Math.log(c-a)}function Et(m,e,a,c){let s=m.lat+a*c;if(Math.abs(a)>1){let W=(Math.sign(m.lat+a)!==Math.sign(m.lat)?-Math.abs(m.lat):Math.abs(m.lat))*Math.PI/180,Z=Math.abs(m.lat+a)*Math.PI/180,u=kt(W+c*(Z-W)),G=kt(W),U=kt(Z);return new o.V(m.lng+e*((u-G)/(U-G)),s)}return new o.V(m.lng+e*c,s)}class yt{constructor(e){this._cachePrevious=new Map,this._cache=new Map,this._hadAnyChanges=!1,this._boundingVolumeFactory=e}swapBuffers(){if(!this._hadAnyChanges)return;let e=this._cachePrevious;this._cachePrevious=this._cache,this._cache=e,this._cache.clear(),this._hadAnyChanges=!1}getTileBoundingVolume(e,a,c,s){let W=`${e.z}_${e.x}_${e.y}_${s?.terrain?"t":""}`,Z=this._cache.get(W);if(Z)return Z;let u=this._cachePrevious.get(W);if(u)return this._cache.set(W,u),u;let G=this._boundingVolumeFactory(e,a,c,s);return this._cache.set(W,G),this._hadAnyChanges=!0,G}}class _t{constructor(e,a,c,s){this.min=c,this.max=s,this.points=e,this.planes=a}static fromAabb(e,a){let c=[];for(let s=0;s<8;s++)c.push([1&~s?e[0]:a[0],(s>>1&1)==1?a[1]:e[1],(s>>2&1)==1?a[2]:e[2]]);return new _t(c,[[-1,0,0,a[0]],[1,0,0,-e[0]],[0,-1,0,a[1]],[0,1,0,-e[1]],[0,0,-1,a[2]],[0,0,1,-e[2]]],e,a)}static fromCenterSizeAngles(e,a,c){let s=o.bA([],c[0],c[1],c[2]),W=o.bB([],[a[0],0,0],s),Z=o.bB([],[0,a[1],0],s),u=o.bB([],[0,0,a[2]],s),G=[...e],U=[...e];for(let Q=0;Q<8;Q++)for(let k=0;k<3;k++){let j=e[k]+W[k]*(1&~Q?-1:1)+Z[k]*((Q>>1&1)==1?1:-1)+u[k]*((Q>>2&1)==1?1:-1);G[k]=Math.min(G[k],j),U[k]=Math.max(U[k],j)}let X=[];for(let Q=0;Q<8;Q++){let k=[...e];o.a$(k,k,o.a_([],W,1&~Q?-1:1)),o.a$(k,k,o.a_([],Z,(Q>>1&1)==1?1:-1)),o.a$(k,k,o.a_([],u,(Q>>2&1)==1?1:-1)),X.push(k)}return new _t(X,[[...W,-o.b4(W,X[0])],[...Z,-o.b4(Z,X[0])],[...u,-o.b4(u,X[0])],[-W[0],-W[1],-W[2],-o.b4(W,X[7])],[-Z[0],-Z[1],-Z[2],-o.b4(Z,X[7])],[-u[0],-u[1],-u[2],-o.b4(u,X[7])]],G,U)}intersectsFrustum(e){let a=!0,c=this.points.length,s=this.planes.length,W=e.planes.length,Z=e.points.length;for(let u=0;u<W;u++){let G=e.planes[u],U=0;for(let X=0;X<c;X++){let Q=this.points[X];G[0]*Q[0]+G[1]*Q[1]+G[2]*Q[2]+G[3]>=0&&U++}if(U===0)return 0;U<c&&(a=!1)}if(a)return 2;for(let u=0;u<s;u++){let G=this.planes[u],U=0;for(let X=0;X<Z;X++){let Q=e.points[X];G[0]*Q[0]+G[1]*Q[1]+G[2]*Q[2]+G[3]>=0&&U++}if(U===0)return 0}return 1}intersectsPlane(e){let a=this.points.length,c=0;for(let s=0;s<a;s++){let W=this.points[s];e[0]*W[0]+e[1]*W[1]+e[2]*W[2]+e[3]>=0&&c++}return c===a?2:c===0?0:1}}function Ye(m,e,a){let c=m-e;return c<0?-c:Math.max(0,c-a)}function ti(m,e,a,c,s){let W=m-a,Z;return Z=W<0?Math.min(-W,1+W-s):W>1?Math.min(Math.max(W-s,0),1-W):0,Math.max(Z,Ye(e,c,s))}class we{constructor(){this._boundingVolumeCache=new yt(this._computeTileBoundingVolume)}prepareNextFrame(){this._boundingVolumeCache.swapBuffers()}distanceToTile2d(e,a,c,s){let W=1<<c.z,Z=1/W,u=c.x/W,G=c.y/W,U=2;return U=Math.min(U,ti(e,a,u,G,Z)),U=Math.min(U,ti(e,a,u+.5,-G-Z,Z)),U=Math.min(U,ti(e,a,u+.5,2-G-Z,Z)),U}getWrap(e,a,c){let s=1<<a.z,W=1/s,Z=a.x/s,u=Ye(e.x,Z,W),G=Ye(e.x,Z-1,W),U=Ye(e.x,Z+1,W),X=Math.min(u,G,U);return X===U?1:X===G?-1:0}allowVariableZoom(e,a){return he(e,a)>4}allowWorldCopies(){return!1}getTileBoundingVolume(e,a,c,s){return this._boundingVolumeCache.getTileBoundingVolume(e,a,c,s)}_computeTileBoundingVolume(e,a,c,s){var W,Z;let u=0,G=0;if(s?.terrain){let U=new o.a1(e.z,a,e.z,e.x,e.y),X=s.terrain.getMinMaxElevation(U);u=(W=X.minElevation)!==null&&W!==void 0?W:Math.min(0,c),G=(Z=X.maxElevation)!==null&&Z!==void 0?Z:Math.max(0,c)}if(u/=o.bD,G/=o.bD,u+=1,G+=1,e.z<=0)return _t.fromAabb([-G,-G,-G],[G,G,G]);if(e.z===1)return _t.fromAabb([e.x===0?-G:0,e.y===0?0:-G,-G],[e.x===0?0:G,e.y===0?G:0,G]);{let U=[y(0,0,e.x,e.y,e.z),y(o.a4,0,e.x,e.y,e.z),y(o.a4,o.a4,e.x,e.y,e.z),y(0,o.a4,e.x,e.y,e.z)],X=[];for(let Ut of U)X.push(o.a_([],Ut,G));if(G!==u)for(let Ut of U)X.push(o.a_([],Ut,u));e.y===0&&X.push([0,1,0]),e.y===(1<<e.z)-1&&X.push([0,-1,0]);let Q=[1,1,1],k=[-1,-1,-1];for(let Ut of X)for(let xt=0;xt<3;xt++)Q[xt]=Math.min(Q[xt],Ut[xt]),k[xt]=Math.max(k[xt],Ut[xt]);let j=y(o.a4/2,o.a4/2,e.x,e.y,e.z),H=o.b3([],[0,1,0],j);o.b2(H,H);let q=o.b3([],j,H);o.b2(q,q);let $=o.b3([],U[2],U[1]);o.b2($,$);let et=o.b3([],U[0],U[3]);o.b2(et,et),X.push(o.a_([],j,G)),e.y>=(1<<e.z)/2&&X.push(o.a_([],y(o.a4/2,0,e.x,e.y,e.z),G)),e.y<(1<<e.z)/2&&X.push(o.a_([],y(o.a4/2,o.a4,e.x,e.y,e.z),G));let nt=Zl(j,X),mt=Zl(q,X),at=[-j[0],-j[1],-j[2],nt.max],Wt=[j[0],j[1],j[2],-nt.min],Zt=[-q[0],-q[1],-q[2],mt.max],ot=[q[0],q[1],q[2],-mt.min],Ft=[...$,0],Xt=[...et,0],It=[];return e.y===0?It.push(o.bC(Xt,Ft,at),o.bC(Xt,Ft,Wt)):It.push(o.bC(Zt,Ft,at),o.bC(Zt,Ft,Wt),o.bC(Zt,Xt,at),o.bC(Zt,Xt,Wt)),e.y===(1<<e.z)-1?It.push(o.bC(Xt,Ft,at),o.bC(Xt,Ft,Wt)):It.push(o.bC(ot,Ft,at),o.bC(ot,Ft,Wt),o.bC(ot,Xt,at),o.bC(ot,Xt,Wt)),new _t(It,[at,Wt,Zt,ot,Ft,Xt],Q,k)}}}function Zl(m,e){let a=1/0,c=-1/0;for(let s of e){let W=o.b4(m,s);a=Math.min(a,W),c=Math.max(c,W)}return{min:a,max:c}}class Li{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(e){this._helper.setMinZoom(e)}setMaxZoom(e){this._helper.setMaxZoom(e)}setMinPitch(e){this._helper.setMinPitch(e)}setMaxPitch(e){this._helper.setMaxPitch(e)}setRenderWorldCopies(e){this._helper.setRenderWorldCopies(e)}setBearing(e){this._helper.setBearing(e)}setPitch(e){this._helper.setPitch(e)}setRoll(e){this._helper.setRoll(e)}setFov(e){this._helper.setFov(e)}setZoom(e){this._helper.setZoom(e)}setCenter(e){this._helper.setCenter(e)}setElevation(e){this._helper.setElevation(e)}setMinElevationForCurrentTile(e){this._helper.setMinElevationForCurrentTile(e)}setPadding(e){this._helper.setPadding(e)}interpolatePadding(e,a,c){return this._helper.interpolatePadding(e,a,c)}isPaddingEqual(e){return this._helper.isPaddingEqual(e)}resize(e,a){this._helper.resize(e,a)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(e){this._helper.setMaxBounds(e)}setConstrainOverride(e){this._helper.setConstrainOverride(e)}overrideNearFarZ(e,a){this._helper.overrideNearFarZ(e,a)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(e){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),e)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get constrainOverride(){return this._helper.constrainOverride}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(e){}constructor(e){this._cachedClippingPlane=o.bE(),this._projectionMatrix=o.bi(),this._globeViewProjMatrix32f=o.bh(),this._globeViewProjMatrixNoCorrection=o.bi(),this._globeViewProjMatrixNoCorrectionInverted=o.bi(),this._globeProjMatrixInverted=o.bi(),this._cameraPosition=o.by(),this._globeLatitudeErrorCorrectionRadians=0,this.defaultConstrain=(a,c)=>{let s=o.an(a.lat,-o.ao,o.ao),W=o.an(+c,this.minZoom+ct(0,s),this.maxZoom);return{center:new o.V(a.lng,s),zoom:W}},this.applyConstrain=(a,c)=>this._helper.applyConstrain(a,c),this._helper=new ta({calcMatrices:()=>{this._calcMatrices()},defaultConstrain:(a,c)=>this.defaultConstrain(a,c)},e),this._coveringTilesDetailsProvider=new we}clone(){let e=new Li;return e.apply(this),e}apply(e,a){this._globeLatitudeErrorCorrectionRadians=a||0,this._helper.apply(e)}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._globeViewProjMatrixNoCorrection}get inverseProjectionMatrix(){return this._globeProjMatrixInverted}get cameraPosition(){let e=o.by();return e[0]=this._cameraPosition[0],e[1]=this._cameraPosition[1],e[2]=this._cameraPosition[2],e}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}getProjectionData(e){let{overscaledTileID:a,applyGlobeMatrix:c}=e,s=this._helper.getMercatorTileCoordinates(a);return{mainMatrix:this._globeViewProjMatrix32f,tileMercatorCoords:s,clippingPlane:this._cachedClippingPlane,projectionTransition:c?1:0,fallbackMatrix:this._globeViewProjMatrix32f}}_computeClippingPlane(e){let a=this.pitchInRadians,c=this.cameraToCenterDistance/e,s=Math.sin(a)*c,W=Math.cos(a)*c+1,Z=1/Math.sqrt(s*s+W*W)*1,u=-s,G=W,U=Math.sqrt(u*u+G*G);u/=U,G/=U;let X=[0,u,G];o.bF(X,X,[0,0,0],-this.bearingInRadians),o.bG(X,X,[0,0,0],-1*this.center.lat*Math.PI/180),o.bH(X,X,[0,0,0],this.center.lng*Math.PI/180);let Q=1/o.b6(X);return o.a_(X,X,Q),[...X,-Z*Q]}isLocationOccluded(e){return!this.isSurfacePointVisible(E(e))}transformLightDirection(e){let a=this._helper._center.lng*Math.PI/180,c=this._helper._center.lat*Math.PI/180,s=Math.cos(c),W=[Math.sin(a)*s,Math.sin(c),Math.cos(a)*s],Z=[W[2],0,-W[0]],u=[0,0,0];o.b3(u,Z,W),o.b2(Z,Z),o.b2(u,u);let G=[0,0,0];return o.b2(G,[Z[0]*e[0]+u[0]*e[1]+W[0]*e[2],Z[1]*e[0]+u[1]*e[1]+W[1]*e[2],Z[2]*e[0]+u[2]*e[1]+W[2]*e[2]]),G}getPixelScale(){return 1/Math.cos(this._helper._center.lat*Math.PI/180)}getCircleRadiusCorrection(){return Math.cos(this._helper._center.lat*Math.PI/180)}getPitchedTextCorrection(e,a,c){let s=(function(u,G,U){let X=1/(1<<U.z);return new o.aa(u/o.a4*X+U.x*X,G/o.a4*X+U.y*X)})(e,a,c.canonical),W=(Z=s.y,[o.bx(s.x*Math.PI*2+Math.PI,2*Math.PI),2*Math.atan(Math.exp(Math.PI-Z*Math.PI*2))-.5*Math.PI]);var Z;return this.getCircleRadiusCorrection()/Math.cos(W[1])}projectTileCoordinates(e,a,c,s){let W=c.canonical,Z=y(e,a,W.x,W.y,W.z),u=1+(s?s(e,a):0)/o.bD,G=[Z[0]*u,Z[1]*u,Z[2]*u,1];o.aG(G,G,this._globeViewProjMatrixNoCorrection);let U=this._cachedClippingPlane,X=U[0]*Z[0]+U[1]*Z[1]+U[2]*Z[2]+U[3]<0;return{point:new o.P(G[0]/G[3],G[1]/G[3]),signedDistanceFromCamera:G[3],isOccluded:X}}_calcMatrices(){if(!this._helper._width||!this._helper._height)return;let e=A(this.worldSize,this.center.lat),a=o.bj(),c=o.bj();this._helper.autoCalculateNearFarZ&&(this._helper._nearZ=.5,this._helper._farZ=this.cameraToCenterDistance+2*e),o.bd(a,this.fovInRadians,this.width/this.height,this._helper._nearZ,this._helper._farZ);let s=this.centerOffset;a[8]=2*-s.x/this._helper._width,a[9]=2*s.y/this._helper._height,this._projectionMatrix=o.be(a),this._globeProjMatrixInverted=o.bj(),o.aA(this._globeProjMatrixInverted,a),o.O(a,a,[0,0,-this.cameraToCenterDistance]),o.bf(a,a,this.rollInRadians),o.bg(a,a,-this.pitchInRadians),o.bf(a,a,this.bearingInRadians),o.O(a,a,[0,0,-e]);let W=o.by();W[0]=e,W[1]=e,W[2]=e,o.bg(c,a,this.center.lat*Math.PI/180),o.bI(c,c,-this.center.lng*Math.PI/180),o.Q(c,c,W),this._globeViewProjMatrixNoCorrection=c,o.bg(a,a,this.center.lat*Math.PI/180-this._globeLatitudeErrorCorrectionRadians),o.bI(a,a,-this.center.lng*Math.PI/180),o.Q(a,a,W),this._globeViewProjMatrix32f=new Float32Array(a),this._globeViewProjMatrixNoCorrectionInverted=o.bj(),o.aA(this._globeViewProjMatrixNoCorrectionInverted,c);let Z=o.by();this._cameraPosition=o.by(),this._cameraPosition[2]=this.cameraToCenterDistance/e,o.bF(this._cameraPosition,this._cameraPosition,Z,-this.rollInRadians),o.bG(this._cameraPosition,this._cameraPosition,Z,this.pitchInRadians),o.bF(this._cameraPosition,this._cameraPosition,Z,-this.bearingInRadians),o.a$(this._cameraPosition,this._cameraPosition,[0,0,1]),o.bG(this._cameraPosition,this._cameraPosition,Z,-this.center.lat*Math.PI/180),o.bH(this._cameraPosition,this._cameraPosition,Z,this.center.lng*Math.PI/180),this._cachedClippingPlane=this._computeClippingPlane(e);let u=o.be(this._globeViewProjMatrixNoCorrectionInverted);o.Q(u,u,[1,1,-1]),this._cachedFrustum=Mn.fromInvProjectionMatrix(u,1,0,this._cachedClippingPlane,!0)}calculateFogMatrix(e){o.w("calculateFogMatrix is not supported on globe projection.");let a=o.bj();return o.ar(a),a}getVisibleUnwrappedCoordinates(e){return[new o.bb(0,e)]}getCameraFrustum(){return this._cachedFrustum}getClippingPlane(){return this._cachedClippingPlane}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(e){e&&o.w("terrain is not fully supported on vertical perspective projection."),this._helper.recalculateZoomAndCenter(0)}maxPitchScaleFactor(){return 1}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(e,a){if(!this._globeViewProjMatrixNoCorrection)return 1;let c=E(e);o.a_(c,c,1+a/o.bD);let s=o.bE();return o.aG(s,[c[0],c[1],c[2],1],this._globeViewProjMatrixNoCorrection),s[2]/s[3]}populateCache(e){}getBounds(){let e=.5*this.width,a=.5*this.height,c=[new o.P(0,0),new o.P(e,0),new o.P(this.width,0),new o.P(this.width,a),new o.P(this.width,this.height),new o.P(e,this.height),new o.P(0,this.height),new o.P(0,a)],s=[];for(let Q of c)s.push(this.unprojectScreenPoint(Q));let W=0,Z=0,u=0,G=0,U=this.center;for(let Q of s){let k=o.bJ(U.lng,Q.lng),j=o.bJ(U.lat,Q.lat);k<Z&&(Z=k),k>W&&(W=k),j<G&&(G=j),j>u&&(u=j)}let X=[U.lng+Z,U.lat+G,U.lng+W,U.lat+u];return this.isSurfacePointOnScreen([0,1,0])&&(X[3]=90,X[0]=-180,X[2]=180),this.isSurfacePointOnScreen([0,-1,0])&&(X[1]=-90,X[0]=-180,X[2]=180),new si(X)}calculateCenterFromCameraLngLatAlt(e,a,c,s){return this._helper.calculateCenterFromCameraLngLatAlt(e,a,c,s)}setLocationAtPoint(e,a){let c=E(this.unprojectScreenPoint(a)),s=E(e),W=o.by();o.bK(W);let Z=o.by();o.bH(Z,c,W,-this.center.lng*Math.PI/180),o.bG(Z,Z,W,this.center.lat*Math.PI/180);let u=s[0]*s[0]+s[2]*s[2],G=Z[0]*Z[0];if(u<G)return;let U=Math.sqrt(u-G),X=-U,Q=o.bL(s[0],s[2],Z[0],U),k=o.bL(s[0],s[2],Z[0],X),j=o.by();o.bH(j,s,W,-Q);let H=o.bL(j[1],j[2],Z[1],Z[2]),q=o.by();o.bH(q,s,W,-k);let $=o.bL(q[1],q[2],Z[1],Z[2]),et=.5*Math.PI,nt=H>=-et&&H<=et,mt=$>=-et&&$<=et,at,Wt;if(nt&&mt){let Xt=this.center.lng*Math.PI/180,It=this.center.lat*Math.PI/180;o.bM(Q,Xt)+o.bM(H,It)<o.bM(k,Xt)+o.bM($,It)?(at=Q,Wt=H):(at=k,Wt=$)}else if(nt)at=Q,Wt=H;else{if(!mt)return;at=k,Wt=$}let Zt=at/Math.PI*180,ot=Wt/Math.PI*180,Ft=this.center.lat;this.setCenter(new o.V(Zt,o.an(ot,-90,90))),this.setZoom(this.zoom+ct(Ft,this.center.lat))}locationToScreenPoint(e,a){let c=E(e);if(a){let s=a.getElevationForLngLatZoom(e,this._helper._tileZoom);o.a_(c,c,1+s/o.bD)}return this._projectSurfacePointToScreen(c)}_projectSurfacePointToScreen(e){let a=o.bE();return o.aG(a,[...e,1],this._globeViewProjMatrixNoCorrection),a[0]/=a[3],a[1]/=a[3],new o.P((.5*a[0]+.5)*this.width,(.5*-a[1]+.5)*this.height)}screenPointToMercatorCoordinate(e,a){if(a){let c=a.pointCoordinate(e);if(c)return c}return o.aa.fromLngLat(this.unprojectScreenPoint(e))}screenPointToLocation(e,a){var c;return(c=this.screenPointToMercatorCoordinate(e,a))===null||c===void 0?void 0:c.toLngLat()}isPointOnMapSurface(e,a){let c=this._cameraPosition,s=this.getRayDirectionFromPixel(e);return!!this.rayPlanetIntersection(c,s)}getRayDirectionFromPixel(e){let a=o.bE();a[0]=e.x/this.width*2-1,a[1]=-1*(e.y/this.height*2-1),a[2]=1,a[3]=1,o.aG(a,a,this._globeViewProjMatrixNoCorrectionInverted),a[0]/=a[3],a[1]/=a[3],a[2]/=a[3];let c=o.by();c[0]=a[0]-this._cameraPosition[0],c[1]=a[1]-this._cameraPosition[1],c[2]=a[2]-this._cameraPosition[2];let s=o.by();return o.b2(s,c),s}isSurfacePointVisible(e){let a=this._cachedClippingPlane;return a[0]*e[0]+a[1]*e[1]+a[2]*e[2]+a[3]>=0}isSurfacePointOnScreen(e){if(!this.isSurfacePointVisible(e))return!1;let a=o.bE();return o.aG(a,[...e,1],this._globeViewProjMatrixNoCorrection),a[0]/=a[3],a[1]/=a[3],a[2]/=a[3],a[0]>-1&&a[0]<1&&a[1]>-1&&a[1]<1&&a[2]>-1&&a[2]<1}rayPlanetIntersection(e,a){let c=o.b4(e,a),s=o.by(),W=o.by();o.a_(W,a,c),o.b1(s,e,W);let Z=1-o.b4(s,s);if(Z<0)return null;let u=o.b4(e,e)-1,G=-c+(c<0?1:-1)*Math.sqrt(Z),U=u/G,X=G;return{tMin:Math.min(U,X),tMax:Math.max(U,X)}}unprojectScreenPoint(e){let a=this._cameraPosition,c=this.getRayDirectionFromPixel(e),s=this.rayPlanetIntersection(a,c);if(s){let X=o.by();o.a$(X,a,[c[0]*s.tMin,c[1]*s.tMin,c[2]*s.tMin]);let Q=o.by();return o.b2(Q,X),f(Q)}let W=this._cachedClippingPlane,Z=W[0]*c[0]+W[1]*c[1]+W[2]*c[2],u=-o.ba(W,a)/Z,G=o.by();if(u>0)o.a$(G,a,[c[0]*u,c[1]*u,c[2]*u]);else{let X=o.by();o.a$(X,a,[2*c[0],2*c[1],2*c[2]]);let Q=o.ba(this._cachedClippingPlane,X);o.b1(G,X,[this._cachedClippingPlane[0]*Q,this._cachedClippingPlane[1]*Q,this._cachedClippingPlane[2]*Q])}let U=(function(X){let Q=o.by();return Q[0]=X[0]*-X[3],Q[1]=X[1]*-X[3],Q[2]=X[2]*-X[3],{center:Q,radius:Math.sqrt(1-X[3]*X[3])}})(W);return f((function(X,Q,k){let j=o.by();o.b1(j,k,X);let H=o.by();return o.bz(H,X,j,Q/o.b8(j)),H})(U.center,U.radius,G))}getMatrixForModel(e,a){let c=o.V.convert(e),s=1/o.bD,W=o.bi();return o.bI(W,W,c.lng/180*Math.PI),o.bg(W,W,-c.lat/180*Math.PI),o.O(W,W,[0,0,1+a/o.bD]),o.bg(W,W,.5*Math.PI),o.Q(W,W,[s,s,s]),W}getProjectionDataForCustomLayer(e=!0){let a=this.getProjectionData({overscaledTileID:new o.a1(0,0,0,0,0),applyGlobeMatrix:e});return a.tileMercatorCoords=[0,0,1,1],a}getFastPathSimpleProjectionMatrix(e){}}class Wa{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(e){this._helper.setMinZoom(e)}setMaxZoom(e){this._helper.setMaxZoom(e)}setMinPitch(e){this._helper.setMinPitch(e)}setMaxPitch(e){this._helper.setMaxPitch(e)}setRenderWorldCopies(e){this._helper.setRenderWorldCopies(e)}setBearing(e){this._helper.setBearing(e)}setPitch(e){this._helper.setPitch(e)}setRoll(e){this._helper.setRoll(e)}setFov(e){this._helper.setFov(e)}setZoom(e){this._helper.setZoom(e)}setCenter(e){this._helper.setCenter(e)}setElevation(e){this._helper.setElevation(e)}setMinElevationForCurrentTile(e){this._helper.setMinElevationForCurrentTile(e)}setPadding(e){this._helper.setPadding(e)}interpolatePadding(e,a,c){return this._helper.interpolatePadding(e,a,c)}isPaddingEqual(e){return this._helper.isPaddingEqual(e)}resize(e,a,c=!0){this._helper.resize(e,a,c)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(e){this._helper.setMaxBounds(e)}setConstrainOverride(e){this._helper.setConstrainOverride(e)}overrideNearFarZ(e,a){this._helper.overrideNearFarZ(e,a)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(e){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),e)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get constrainOverride(){return this._helper.constrainOverride}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}get isGlobeRendering(){return this._globeness>0}setTransitionState(e,a){this._globeness=e,this._globeLatitudeErrorCorrectionRadians=a,this._calcMatrices(),this._verticalPerspectiveTransform.getCoveringTilesDetailsProvider().prepareNextFrame(),this._mercatorTransform.getCoveringTilesDetailsProvider().prepareNextFrame()}get currentTransform(){return this.isGlobeRendering?this._verticalPerspectiveTransform:this._mercatorTransform}constructor(e){this._globeLatitudeErrorCorrectionRadians=0,this._globeness=1,this.defaultConstrain=(a,c)=>this.currentTransform.defaultConstrain(a,c),this.applyConstrain=(a,c)=>this._helper.applyConstrain(a,c),this._helper=new ta({calcMatrices:()=>{this._calcMatrices()},defaultConstrain:(a,c)=>this.defaultConstrain(a,c)},e),this._globeness=1,this._mercatorTransform=new Fi,this._verticalPerspectiveTransform=new Li}clone(){let e=new Wa;return e._globeness=this._globeness,e._globeLatitudeErrorCorrectionRadians=this._globeLatitudeErrorCorrectionRadians,e.apply(this),e}apply(e){this._helper.apply(e),this._mercatorTransform.apply(this),this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians)}get projectionMatrix(){return this.currentTransform.projectionMatrix}get modelViewProjectionMatrix(){return this.currentTransform.modelViewProjectionMatrix}get inverseProjectionMatrix(){return this.currentTransform.inverseProjectionMatrix}get cameraPosition(){return this.currentTransform.cameraPosition}getProjectionData(e){let a=this._mercatorTransform.getProjectionData(e),c=this._verticalPerspectiveTransform.getProjectionData(e);return{mainMatrix:this.isGlobeRendering?c.mainMatrix:a.mainMatrix,clippingPlane:c.clippingPlane,tileMercatorCoords:c.tileMercatorCoords,projectionTransition:e.applyGlobeMatrix?this._globeness:0,fallbackMatrix:a.fallbackMatrix}}isLocationOccluded(e){return this.currentTransform.isLocationOccluded(e)}transformLightDirection(e){return this.currentTransform.transformLightDirection(e)}getPixelScale(){return o.bt(this._mercatorTransform.getPixelScale(),this._verticalPerspectiveTransform.getPixelScale(),this._globeness)}getCircleRadiusCorrection(){return o.bt(this._mercatorTransform.getCircleRadiusCorrection(),this._verticalPerspectiveTransform.getCircleRadiusCorrection(),this._globeness)}getPitchedTextCorrection(e,a,c){let s=this._mercatorTransform.getPitchedTextCorrection(e,a,c),W=this._verticalPerspectiveTransform.getPitchedTextCorrection(e,a,c);return o.bt(s,W,this._globeness)}projectTileCoordinates(e,a,c,s){return this.currentTransform.projectTileCoordinates(e,a,c,s)}_calcMatrices(){this._helper._width&&this._helper._height&&(this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians),this._helper._nearZ=this._verticalPerspectiveTransform.nearZ,this._helper._farZ=this._verticalPerspectiveTransform.farZ,this._mercatorTransform.apply(this,!0,this.isGlobeRendering),this._helper._nearZ=this._mercatorTransform.nearZ,this._helper._farZ=this._mercatorTransform.farZ)}calculateFogMatrix(e){return this.currentTransform.calculateFogMatrix(e)}getVisibleUnwrappedCoordinates(e){return this.currentTransform.getVisibleUnwrappedCoordinates(e)}getCameraFrustum(){return this.currentTransform.getCameraFrustum()}getClippingPlane(){return this.currentTransform.getClippingPlane()}getCoveringTilesDetailsProvider(){return this.currentTransform.getCoveringTilesDetailsProvider()}recalculateZoomAndCenter(e){this._mercatorTransform.recalculateZoomAndCenter(e),this._verticalPerspectiveTransform.recalculateZoomAndCenter(e)}maxPitchScaleFactor(){return this._mercatorTransform.maxPitchScaleFactor()}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(e,a){return this.currentTransform.lngLatToCameraDepth(e,a)}populateCache(e){this._mercatorTransform.populateCache(e),this._verticalPerspectiveTransform.populateCache(e)}getBounds(){return this.currentTransform.getBounds()}calculateCenterFromCameraLngLatAlt(e,a,c,s){return this._helper.calculateCenterFromCameraLngLatAlt(e,a,c,s)}setLocationAtPoint(e,a){if(!this.isGlobeRendering)return this._mercatorTransform.setLocationAtPoint(e,a),void this.apply(this._mercatorTransform);this._verticalPerspectiveTransform.setLocationAtPoint(e,a),this.apply(this._verticalPerspectiveTransform)}locationToScreenPoint(e,a){return this.currentTransform.locationToScreenPoint(e,a)}screenPointToMercatorCoordinate(e,a){return this.currentTransform.screenPointToMercatorCoordinate(e,a)}screenPointToLocation(e,a){return this.currentTransform.screenPointToLocation(e,a)}isPointOnMapSurface(e,a){return this.currentTransform.isPointOnMapSurface(e,a)}getRayDirectionFromPixel(e){return this._verticalPerspectiveTransform.getRayDirectionFromPixel(e)}getMatrixForModel(e,a){return this.currentTransform.getMatrixForModel(e,a)}getProjectionDataForCustomLayer(e=!0){let a=this._mercatorTransform.getProjectionDataForCustomLayer(e);if(!this.isGlobeRendering)return a;let c=this._verticalPerspectiveTransform.getProjectionDataForCustomLayer(e);return c.fallbackMatrix=a.mainMatrix,c}getFastPathSimpleProjectionMatrix(e){return this.currentTransform.getFastPathSimpleProjectionMatrix(e)}}class yi{get useGlobeControls(){return!0}handlePanInertia(e,a){let c=Gt(e,a);return Math.abs(c.lng-a.center.lng)>180&&(c.lng=a.center.lng+179.5*Math.sign(c.lng-a.center.lng)),{easingCenter:c,easingOffset:new o.P(0,0)}}handleMapControlsRollPitchBearingZoom(e,a){let c=e.around,s=a.screenPointToLocation(c);e.bearingDelta&&a.setBearing(a.bearing+e.bearingDelta),e.pitchDelta&&a.setPitch(a.pitch+e.pitchDelta),e.rollDelta&&a.setRoll(a.roll+e.rollDelta);let W=a.zoom;e.zoomDelta&&a.setZoom(a.zoom+e.zoomDelta);let Z=a.zoom-W;if(Z===0)return;let u=o.bJ(a.center.lng,s.lng),G=u/(Math.abs(u/180)+1),U=o.bJ(a.center.lat,s.lat),X=a.getRayDirectionFromPixel(c),Q=a.cameraPosition,k=-1*o.b4(Q,X),j=o.by();o.a$(j,Q,[X[0]*k,X[1]*k,X[2]*k]);let H=o.b6(j)-1,q=Math.exp(.5*-Math.max(H-.3,0)),$=A(a.worldSize,a.center.lat)/Math.min(a.width,a.height),et=o.bw($,.9,.5,1,.25),nt=(1-o.aq(-Z))*Math.min(q,et),mt=a.center.lat,at=a.zoom,Wt=new o.V(a.center.lng+G*nt,o.an(a.center.lat+U*nt,-o.ao,o.ao));a.setLocationAtPoint(s,c);let Zt=a.center,ot=o.bw(Math.abs(u),45,85,0,1),Ft=o.bw($,.75,.35,0,1),Xt=Math.pow(Math.max(ot,Ft),.25),It=o.bJ(Zt.lng,Wt.lng),Ut=o.bJ(Zt.lat,Wt.lat);a.setCenter(new o.V(Zt.lng+It*Xt,Zt.lat+Ut*Xt).wrap()),a.setZoom(at+ct(mt,a.center.lat))}handleMapControlsPan(e,a,c){if(!e.panDelta)return;let s=a.center.lat,W=a.zoom;a.setCenter(Gt(e.panDelta,a).wrap()),a.setZoom(W+ct(s,a.center.lat))}cameraForBoxAndBearing(e,a,c,s,W){let Z=_n(e,a,c,s,W),u=a.left/W.width*2-1,G=(W.width-a.right)/W.width*2-1,U=a.top/W.height*-2+1,X=(W.height-a.bottom)/W.height*-2+1,Q=o.bJ(c.getWest(),c.getEast())<0,k=Q?c.getEast():c.getWest(),j=Q?c.getWest():c.getEast(),H=Math.max(c.getNorth(),c.getSouth()),q=Math.min(c.getNorth(),c.getSouth()),$=k+.5*o.bJ(k,j),et=H+.5*o.bJ(H,q),nt=W.clone();nt.setCenter(Z.center),nt.setBearing(Z.bearing),nt.setPitch(0),nt.setRoll(0),nt.setZoom(Z.zoom);let mt=nt.modelViewProjectionMatrix,at=[E(c.getNorthWest()),E(c.getNorthEast()),E(c.getSouthWest()),E(c.getSouthEast()),E(new o.V(j,et)),E(new o.V(k,et)),E(new o.V($,H)),E(new o.V($,q))],Wt=E(Z.center),Zt=Number.POSITIVE_INFINITY;for(let ot of at)u<0&&(Zt=yi.getLesserNonNegativeNonNull(Zt,yi.solveVectorScale(ot,Wt,mt,"x",u))),G>0&&(Zt=yi.getLesserNonNegativeNonNull(Zt,yi.solveVectorScale(ot,Wt,mt,"x",G))),U>0&&(Zt=yi.getLesserNonNegativeNonNull(Zt,yi.solveVectorScale(ot,Wt,mt,"y",U))),X<0&&(Zt=yi.getLesserNonNegativeNonNull(Zt,yi.solveVectorScale(ot,Wt,mt,"y",X)));if(Number.isFinite(Zt)&&Zt!==0)return Z.zoom=nt.zoom+o.at(Zt),Z;Vd()}handleJumpToCenterZoom(e,a){let c=e.center.lat,s=e.applyConstrain(a.center?o.V.convert(a.center):e.center,e.zoom).center;e.setCenter(s.wrap());let W=a.zoom!==void 0?+a.zoom:e.zoom+ct(c,s.lat);e.zoom!==W&&e.setZoom(W)}handleEaseTo(e,a){let c=e.zoom,s=e.center,W=e.padding,Z={roll:e.roll,pitch:e.pitch,bearing:e.bearing},u={roll:a.roll===void 0?e.roll:a.roll,pitch:a.pitch===void 0?e.pitch:a.pitch,bearing:a.bearing===void 0?e.bearing:a.bearing},G=a.zoom!==void 0,U=!e.isPaddingEqual(a.padding),X=!1,Q=a.center?o.V.convert(a.center):s,k=e.applyConstrain(Q,c).center;pd(e,k);let j=e.clone();j.setCenter(k),j.setZoom(G?+a.zoom:c+ct(s.lat,Q.lat)),j.setBearing(a.bearing);let H=new o.P(o.an(e.centerPoint.x+a.offsetAsPoint.x,0,e.width),o.an(e.centerPoint.y+a.offsetAsPoint.y,0,e.height));j.setLocationAtPoint(k,H);let q=(a.offset&&a.offsetAsPoint.mag())>0?j.center:k,$=G?+a.zoom:c+ct(s.lat,q.lat),et=c+ct(s.lat,0),nt=$+ct(q.lat,0),mt=o.bJ(s.lng,q.lng),at=o.bJ(s.lat,q.lat),Wt=o.aq(nt-et);return X=$!==c,{easeFunc:Zt=>{if(o.bn(Z,u)||sn({startEulerAngles:Z,endEulerAngles:u,tr:e,k:Zt,useSlerp:Z.roll!=u.roll}),U&&e.interpolatePadding(W,a.padding,Zt),a.around)o.w("Easing around a point is not supported under globe projection."),e.setLocationAtPoint(a.around,a.aroundPoint);else{let ot=nt>et?Math.min(2,Wt):Math.max(.5,Wt),Ft=Math.pow(ot,1-Zt),Xt=Et(s,mt,at,Zt*Ft);e.setCenter(Xt.wrap())}if(X){let ot=o.G.number(et,nt,Zt)+ct(0,e.center.lat);e.setZoom(ot)}},isZooming:X,elevationCenter:q}}handleFlyTo(e,a){let c=a.zoom!==void 0,s=e.center,W=e.zoom,Z=e.padding,u=!e.isPaddingEqual(a.padding),G=e.applyConstrain(o.V.convert(a.center||a.locationAtOffset),W).center,U=c?+a.zoom:e.zoom+ct(e.center.lat,G.lat),X=e.clone();X.setCenter(G),X.setZoom(U),X.setBearing(a.bearing);let Q=new o.P(o.an(e.centerPoint.x+a.offsetAsPoint.x,0,e.width),o.an(e.centerPoint.y+a.offsetAsPoint.y,0,e.height));X.setLocationAtPoint(G,Q);let k=X.center;pd(e,k);let j=(function(at,Wt,Zt){let ot=E(Wt),Ft=E(Zt),Xt=o.b4(ot,Ft),It=Math.acos(Xt),Ut=T(at);return It/(2*Math.PI)*Ut})(e,s,k),H=W+ct(s.lat,0),q=U+ct(k.lat,0),$=o.aq(q-H),et;if(typeof a.minZoom=="number"){let at=+a.minZoom+ct(k.lat,0),Wt=Math.min(at,H,q)+ct(0,k.lat),Zt=e.applyConstrain(k,Wt).zoom+ct(k.lat,0);et=o.aq(Zt-H)}let nt=o.bJ(s.lng,k.lng),mt=o.bJ(s.lat,k.lat);return{easeFunc:(at,Wt,Zt,ot)=>{let Ft=Et(s,nt,mt,Zt);u&&e.interpolatePadding(Z,a.padding,at);let Xt=at===1?k:Ft;e.setCenter(Xt.wrap());let It=H+o.at(Wt);e.setZoom(at===1?U:It+ct(0,Xt.lat))},scaleOfZoom:$,targetCenter:k,scaleOfMinZoom:et,pixelPathLength:j}}static solveVectorScale(e,a,c,s,W){let Z=s==="x"?[c[0],c[4],c[8],c[12]]:[c[1],c[5],c[9],c[13]],u=[c[3],c[7],c[11],c[15]],G=e[0]*Z[0]+e[1]*Z[1]+e[2]*Z[2],U=e[0]*u[0]+e[1]*u[1]+e[2]*u[2],X=a[0]*Z[0]+a[1]*Z[1]+a[2]*Z[2],Q=a[0]*u[0]+a[1]*u[1]+a[2]*u[2];return X+W*U===G+W*Q||u[3]*(G-X)+Z[3]*(Q-U)+G*Q==X*U?null:(X+Z[3]-W*Q-W*u[3])/(X-G-W*Q+W*U)}static getLesserNonNegativeNonNull(e,a){return a!==null&&a>=0&&a<e?a:e}}class fe{constructor(e){this._globe=e,this._mercatorCameraHelper=new vl,this._verticalPerspectiveCameraHelper=new yi}get useGlobeControls(){return this._globe.useGlobeRendering}get currentHelper(){return this.useGlobeControls?this._verticalPerspectiveCameraHelper:this._mercatorCameraHelper}handlePanInertia(e,a){return this.currentHelper.handlePanInertia(e,a)}handleMapControlsRollPitchBearingZoom(e,a){return this.currentHelper.handleMapControlsRollPitchBearingZoom(e,a)}handleMapControlsPan(e,a,c){this.currentHelper.handleMapControlsPan(e,a,c)}cameraForBoxAndBearing(e,a,c,s,W){return this.currentHelper.cameraForBoxAndBearing(e,a,c,s,W)}handleJumpToCenterZoom(e,a){this.currentHelper.handleJumpToCenterZoom(e,a)}handleEaseTo(e,a){return this.currentHelper.handleEaseTo(e,a)}handleFlyTo(e,a){return this.currentHelper.handleFlyTo(e,a)}}let ha=(m,e)=>o.B(m,e&&e.filter((a=>a.identifier!=="source.canvas"))),ei=o.bN();class Gi extends o.E{constructor(e,a={}){var c,s;super(),this._rtlPluginLoaded=()=>{for(let Z in this.tileManagers){let u=this.tileManagers[Z].getSource().type;u!=="vector"&&u!=="geojson"||this.tileManagers[Z].reload()}},this.map=e,this.dispatcher=new Fl(Sa(),e._getMapId()),this.dispatcher.registerMessageHandler("GG",((Z,u)=>this.getGlyphs(Z,u))),this.dispatcher.registerMessageHandler("GI",((Z,u)=>this.getImages(Z,u))),this.dispatcher.registerMessageHandler("GDA",((Z,u)=>this.getDashes(Z,u))),this.imageManager=new ri,this.imageManager.setEventedParent(this);let W=((c=e._container)===null||c===void 0?void 0:c.lang)||typeof document<"u"&&((s=document.documentElement)===null||s===void 0?void 0:s.lang)||void 0;this.glyphManager=new cl(e._requestManager,a.localIdeographFontFamily,W),this.lineAtlas=new dn(256,512),this.crossTileSymbolIndex=new On,this._setInitialValues(),this._resetUpdates(),this.dispatcher.broadcast("SR",o.bO()),zl().on(Ca,this._rtlPluginLoaded),this.on("data",(Z=>{if(Z.dataType!=="source"||Z.sourceDataType!=="metadata")return;let u=this.tileManagers[Z.sourceId];if(!u)return;let G=u.getSource();if(G&&G.vectorLayerIds)for(let U in this._layers){let X=this._layers[U];X.source===G.id&&this._validateLayer(X)}}))}_setInitialValues(){var e;this._spritesImagesIds={},this._layers={},this._order=[],this.tileManagers={},this.zoomHistory=new o.bP,this._availableImages=[],this._globalState={},this._serializedLayers={},this.stylesheet=null,this.light=null,this.sky=null,this.projection&&(this.projection.destroy(),delete this.projection),this._loaded=!1,this._changed=!1,this._updatedLayers={},this._updatedSources={},this._changedImages={},this._glyphsDidChange=!1,this._updatedPaintProps={},this._layerOrderChanged=!1,this.crossTileSymbolIndex=new(((e=this.crossTileSymbolIndex)===null||e===void 0?void 0:e.constructor)||Object),this.pauseablePlacement=void 0,this.placement=void 0,this.z=0}setGlobalStateProperty(e,a){var c,s,W;this._checkLoaded();let Z=a===null?(W=(s=(c=this.stylesheet.state)===null||c===void 0?void 0:c[e])===null||s===void 0?void 0:s.default)!==null&&W!==void 0?W:null:a;if(o.bQ(Z,this._globalState[e]))return this;this._globalState[e]=Z,this._applyGlobalStateChanges([e])}getGlobalState(){return this._globalState}setGlobalState(e){this._checkLoaded();let a=[];for(let c in e)!o.bQ(this._globalState[c],e[c].default)&&(a.push(c),this._globalState[c]=e[c].default);this._applyGlobalStateChanges(a)}_applyGlobalStateChanges(e){if(e.length===0)return;let a=new Set,c={};for(let s of e){c[s]=this._globalState[s];for(let W in this._layers){let Z=this._layers[W],u=Z.getLayoutAffectingGlobalStateRefs(),G=Z.getPaintAffectingGlobalStateRefs();if(u.has(s)&&a.add(Z.source),G.has(s))for(let{name:U,value:X}of G.get(s))this._updatePaintProperty(Z,U,X)}}this.dispatcher.broadcast("UGS",c);for(let s in this.tileManagers)a.has(s)&&(this._reloadSource(s),this._changed=!0)}loadURL(e,a={},c){this.fire(new o.l("dataloading",{dataType:"style"})),a.validate=typeof a.validate!="boolean"||a.validate;let s=this.map._requestManager.transformRequest(e,"Style");this._loadStyleRequest=new AbortController;let W=this._loadStyleRequest;o.j(s,this._loadStyleRequest).then((Z=>{this._loadStyleRequest=null,this._load(Z.data,a,c)})).catch((Z=>{this._loadStyleRequest=null,Z&&!W.signal.aborted&&this.fire(new o.k(Z))}))}loadJSON(e,a={},c){this.fire(new o.l("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,ge.frameAsync(this._frameRequest).then((()=>{this._frameRequest=null,a.validate=a.validate!==!1,this._load(e,a,c)})).catch((()=>{}))}loadEmpty(){this.fire(new o.l("dataloading",{dataType:"style"})),this._load(ei,{validate:!1})}_load(e,a,c){var s,W;let Z=a.transformStyle?a.transformStyle(c,e):e;if(!a.validate||!ha(this,o.C(Z))){Z=Object.assign({},Z),this._loaded=!0,this.stylesheet=Z;for(let u in Z.sources)this.addSource(u,Z.sources[u],{validate:!1});Z.sprite?this._loadSprite(Z.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(Z.glyphs),this._createLayers(),this.light=new Yl(this.stylesheet.light),this._setProjectionInternal(((s=this.stylesheet.projection)===null||s===void 0?void 0:s.type)||"mercator"),this.sky=new ba(this.stylesheet.sky),this.map.setTerrain((W=this.stylesheet.terrain)!==null&&W!==void 0?W:null),this.fire(new o.l("data",{dataType:"style"})),this.fire(new o.l("style.load"))}}_createLayers(){var e,a,c;let s=o.bR(this.stylesheet.layers);this.setGlobalState((e=this.stylesheet.state)!==null&&e!==void 0?e:null),this.dispatcher.broadcast("SL",s),this._order=s.map((W=>W.id)),this._layers={},this._serializedLayers=null;for(let W of s){let Z=o.bS(W,this._globalState);if(Z.setEventedParent(this,{layer:{id:W.id}}),this._layers[W.id]=Z,o.bT(Z)&&this.tileManagers[Z.source]){let u=(c=(a=W.paint)===null||a===void 0?void 0:a["raster-fade-duration"])!==null&&c!==void 0?c:Z.paint.get("raster-fade-duration");this.tileManagers[Z.source].setRasterFadeDuration(u)}}}_loadSprite(e,a=!1,c=void 0){let s;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,(function(W,Z,u,G){return o._(this,void 0,void 0,(function*(){let U=ii(W),X=u>1?"@2x":"",Q={},k={};for(let{id:j,url:H}of U){let q=Z.transformRequest(Me(H,X,".json"),"SpriteJSON");Q[j]=o.j(q,G);let $=Z.transformRequest(Me(H,X,".png"),"SpriteImage");k[j]=je.getImage($,G)}return yield Promise.all([...Object.values(Q),...Object.values(k)]),(function(j,H){return o._(this,void 0,void 0,(function*(){let q={};for(let $ in j){q[$]={};let et=ge.getImageCanvasContext((yield H[$]).data),nt=(yield j[$]).data;for(let mt in nt){let{width:at,height:Wt,x:Zt,y:ot,sdf:Ft,pixelRatio:Xt,stretchX:It,stretchY:Ut,content:xt,textFitWidth:$t,textFitHeight:Pt}=nt[mt];q[$][mt]={data:null,pixelRatio:Xt,sdf:Ft,stretchX:It,stretchY:Ut,content:xt,textFitWidth:$t,textFitHeight:Pt,spriteData:{width:at,height:Wt,x:Zt,y:ot,context:et}}}}return q}))})(Q,k)}))})(e,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then((W=>{if(this._spriteRequest=null,W)for(let Z in W){this._spritesImagesIds[Z]=[];let u=this._spritesImagesIds[Z]?this._spritesImagesIds[Z].filter((G=>!(G in W))):[];for(let G of u)this.imageManager.removeImage(G),this._changedImages[G]=!0;for(let G in W[Z]){let U=Z==="default"?G:`${Z}:${G}`;this._spritesImagesIds[Z].push(U),U in this.imageManager.images?this.imageManager.updateImage(U,W[Z][G],!1):this.imageManager.addImage(U,W[Z][G]),a&&(this._changedImages[U]=!0)}}})).catch((W=>{this._spriteRequest=null,s=W,this.fire(new o.k(s))})).finally((()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),a&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new o.l("data",{dataType:"style"})),c&&c(s)}))}_unloadSprite(){for(let e of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(e),this._changedImages[e]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new o.l("data",{dataType:"style"}))}_validateLayer(e){let a=this.tileManagers[e.source];if(!a)return;let c=e.sourceLayer;if(!c)return;let s=a.getSource();(s.type==="geojson"||s.vectorLayerIds&&s.vectorLayerIds.indexOf(c)===-1)&&this.fire(new o.k(new Error(`Source layer "${c}" does not exist on source "${s.id}" as specified by style layer "${e.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(let e in this.tileManagers)if(!this.tileManagers[e].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(e,a=!1){let c=this._serializedAllLayers();if(!e||e.length===0)return Object.values(a?o.bU(c):c);let s=[];for(let W of e)if(c[W]){let Z=a?o.bU(c[W]):c[W];s.push(Z)}return s}_serializedAllLayers(){let e=this._serializedLayers;if(e)return e;e=this._serializedLayers={};let a=Object.keys(this._layers);for(let c of a){let s=this._layers[c];s.type!=="custom"&&(e[c]=s.serialize())}return e}hasTransitions(){var e,a,c;if(!((e=this.light)===null||e===void 0)&&e.hasTransition()||!((a=this.sky)===null||a===void 0)&&a.hasTransition()||!((c=this.projection)===null||c===void 0)&&c.hasTransition())return!0;for(let s in this.tileManagers)if(this.tileManagers[s].hasTransition())return!0;for(let s in this._layers)if(this._layers[s].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(e){if(!this._loaded)return;let a=this._changed;if(a){let s=Object.keys(this._updatedLayers),W=Object.keys(this._removedLayers);(s.length||W.length)&&this._updateWorkerLayers(s,W);for(let Z in this._updatedSources){let u=this._updatedSources[Z];if(u==="reload")this._reloadSource(Z);else{if(u!=="clear")throw new Error(`Invalid action ${u}`);this._clearSource(Z)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(let Z in this._updatedPaintProps)this._layers[Z].updateTransitions(e);this.light.updateTransitions(e),this.sky.updateTransitions(e),this._resetUpdates()}let c={};for(let s in this.tileManagers){let W=this.tileManagers[s];c[s]=W.used,W.used=!1}for(let s of this._order){let W=this._layers[s];W.recalculate(e,this._availableImages),!W.isHidden(e.zoom)&&W.source&&(this.tileManagers[W.source].used=!0)}for(let s in c){let W=this.tileManagers[s];!!c[s]!=!!W.used&&W.fire(new o.l("data",{sourceDataType:"visibility",dataType:"source",sourceId:s}))}this.light.recalculate(e),this.sky.recalculate(e),this.projection.recalculate(e),this.z=e.zoom,a&&this.fire(new o.l("data",{dataType:"style"}))}_updateTilesForChangedImages(){let e=Object.keys(this._changedImages);if(e.length){for(let a in this.tileManagers)this.tileManagers[a].reloadTilesForDependencies(["icons","patterns"],e);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(let e in this.tileManagers)this.tileManagers[e].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(e,a){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(e,!1),removedIds:a})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(e,a={}){var c;this._checkLoaded();let s=this.serialize();if(e=a.transformStyle?a.transformStyle(s,e):e,((c=a.validate)===null||c===void 0||c)&&ha(this,o.C(e)))return!1;(e=o.bU(e)).layers=o.bR(e.layers);let W=o.bV(s,e),Z=this._getOperationsToPerform(W);if(Z.unimplemented.length>0)throw new Error(`Unimplemented: ${Z.unimplemented.join(", ")}.`);if(Z.operations.length===0)return!1;for(let u of Z.operations)u();return this.stylesheet=e,this._serializedLayers=null,!0}_getOperationsToPerform(e){let a=[],c=[];for(let s of e)switch(s.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":case"setRoll":continue;case"addLayer":a.push((()=>this.addLayer.apply(this,s.args)));break;case"removeLayer":a.push((()=>this.removeLayer.apply(this,s.args)));break;case"setPaintProperty":a.push((()=>this.setPaintProperty.apply(this,s.args)));break;case"setLayoutProperty":a.push((()=>this.setLayoutProperty.apply(this,s.args)));break;case"setFilter":a.push((()=>this.setFilter.apply(this,s.args)));break;case"addSource":a.push((()=>this.addSource.apply(this,s.args)));break;case"removeSource":a.push((()=>this.removeSource.apply(this,s.args)));break;case"setLayerZoomRange":a.push((()=>this.setLayerZoomRange.apply(this,s.args)));break;case"setLight":a.push((()=>this.setLight.apply(this,s.args)));break;case"setGeoJSONSourceData":a.push((()=>this.setGeoJSONSourceData.apply(this,s.args)));break;case"setGlyphs":a.push((()=>this.setGlyphs.apply(this,s.args)));break;case"setSprite":a.push((()=>this.setSprite.apply(this,s.args)));break;case"setTerrain":a.push((()=>this.map.setTerrain.apply(this,s.args)));break;case"setSky":a.push((()=>this.setSky.apply(this,s.args)));break;case"setProjection":this.setProjection.apply(this,s.args);break;case"setGlobalState":a.push((()=>this.setGlobalState.apply(this,s.args)));break;case"setTransition":a.push((()=>{}));break;default:c.push(s.command)}return{operations:a,unimplemented:c}}addImage(e,a){if(this.getImage(e))return this.fire(new o.k(new Error(`An image named "${e}" already exists.`)));this.imageManager.addImage(e,a),this._afterImageUpdated(e)}updateImage(e,a){this.imageManager.updateImage(e,a)}getImage(e){return this.imageManager.getImage(e)}removeImage(e){if(!this.getImage(e))return this.fire(new o.k(new Error(`An image named "${e}" does not exist.`)));this.imageManager.removeImage(e),this._afterImageUpdated(e)}_afterImageUpdated(e){this._availableImages=this.imageManager.listImages(),this._changedImages[e]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new o.l("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(e,a,c={}){if(this._checkLoaded(),this.tileManagers[e]!==void 0)throw new Error(`Source "${e}" already exists.`);if(!a.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(a).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(a.type)>=0&&this._validate(o.C.source,`sources.${e}`,a,null,c))return;this.map&&this.map._collectResourceTiming&&(a.collectResourceTiming=!0);let s=this.tileManagers[e]=new Ae(e,a,this.dispatcher);s.style=this,s.setEventedParent(this,(()=>({isSourceLoaded:s.loaded(),source:s.serialize(),sourceId:e}))),s.onAdd(this.map),this._changed=!0}removeSource(e){if(this._checkLoaded(),this.tileManagers[e]===void 0)throw new Error("There is no source with this ID");for(let c in this._layers)if(this._layers[c].source===e)return this.fire(new o.k(new Error(`Source "${e}" cannot be removed while layer "${c}" is using it.`)));let a=this.tileManagers[e];delete this.tileManagers[e],delete this._updatedSources[e],a.fire(new o.l("data",{sourceDataType:"metadata",dataType:"source",sourceId:e})),a.setEventedParent(null),a.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(e,a){if(this._checkLoaded(),this.tileManagers[e]===void 0)throw new Error(`There is no source with this ID=${e}`);let c=this.tileManagers[e].getSource();if(c.type!=="geojson")throw new Error(`geojsonSource.type is ${c.type}, which is !== 'geojson`);c.setData(a),this._changed=!0}getSource(e){return this.tileManagers[e]&&this.tileManagers[e].getSource()}addLayer(e,a,c={}){this._checkLoaded();let s=e.id;if(this.getLayer(s))return void this.fire(new o.k(new Error(`Layer "${s}" already exists on this map.`)));let W;if(e.type==="custom"){if(ha(this,o.bW(e)))return;W=o.bS(e,this._globalState)}else{if("source"in e&&typeof e.source=="object"&&(this.addSource(s,e.source),e=o.bU(e),e=o.e(e,{source:s})),this._validate(o.C.layer,`layers.${s}`,e,{arrayIndex:-1},c))return;W=o.bS(e,this._globalState),this._validateLayer(W),W.setEventedParent(this,{layer:{id:s}})}let Z=a?this._order.indexOf(a):this._order.length;if(a&&Z===-1)this.fire(new o.k(new Error(`Cannot add layer "${s}" before non-existing layer "${a}".`)));else{if(this._order.splice(Z,0,s),this._layerOrderChanged=!0,this._layers[s]=W,this._removedLayers[s]&&W.source&&W.type!=="custom"){let u=this._removedLayers[s];delete this._removedLayers[s],u.type!==W.type?this._updatedSources[W.source]="clear":(this._updatedSources[W.source]="reload",this.tileManagers[W.source].pause())}this._updateLayer(W),W.onAdd&&W.onAdd(this.map)}}moveLayer(e,a){if(this._checkLoaded(),this._changed=!0,!this._layers[e])return void this.fire(new o.k(new Error(`The layer '${e}' does not exist in the map's style and cannot be moved.`)));if(e===a)return;let c=this._order.indexOf(e);this._order.splice(c,1);let s=a?this._order.indexOf(a):this._order.length;a&&s===-1?this.fire(new o.k(new Error(`Cannot move layer "${e}" before non-existing layer "${a}".`))):(this._order.splice(s,0,e),this._layerOrderChanged=!0)}removeLayer(e){this._checkLoaded();let a=this._layers[e];if(!a)return void this.fire(new o.k(new Error(`Cannot remove non-existing layer "${e}".`)));a.setEventedParent(null);let c=this._order.indexOf(e);this._order.splice(c,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[e]=a,delete this._layers[e],this._serializedLayers&&delete this._serializedLayers[e],delete this._updatedLayers[e],delete this._updatedPaintProps[e],a.onRemove&&a.onRemove(this.map)}getLayer(e){return this._layers[e]}getLayersOrder(){return[...this._order]}hasLayer(e){return e in this._layers}setLayerZoomRange(e,a,c){this._checkLoaded();let s=this.getLayer(e);s?s.minzoom===a&&s.maxzoom===c||(a!=null&&(s.minzoom=a),c!=null&&(s.maxzoom=c),this._updateLayer(s)):this.fire(new o.k(new Error(`Cannot set the zoom range of non-existing layer "${e}".`)))}setFilter(e,a,c={}){this._checkLoaded();let s=this.getLayer(e);if(s){if(!o.bQ(s.filter,a))return a==null?(s.setFilter(void 0),void this._updateLayer(s)):void(this._validate(o.C.filter,`layers.${s.id}.filter`,a,null,c)||(s.setFilter(o.bU(a)),this._updateLayer(s)))}else this.fire(new o.k(new Error(`Cannot filter non-existing layer "${e}".`)))}getFilter(e){return o.bU(this.getLayer(e).filter)}setLayoutProperty(e,a,c,s={}){this._checkLoaded();let W=this.getLayer(e);W?o.bQ(W.getLayoutProperty(a),c)||(W.setLayoutProperty(a,c,s),this._updateLayer(W)):this.fire(new o.k(new Error(`Cannot style non-existing layer "${e}".`)))}getLayoutProperty(e,a){let c=this.getLayer(e);if(c)return c.getLayoutProperty(a);this.fire(new o.k(new Error(`Cannot get style of non-existing layer "${e}".`)))}setPaintProperty(e,a,c,s={}){this._checkLoaded();let W=this.getLayer(e);W?o.bQ(W.getPaintProperty(a),c)||this._updatePaintProperty(W,a,c,s):this.fire(new o.k(new Error(`Cannot style non-existing layer "${e}".`)))}_updatePaintProperty(e,a,c,s={}){e.setPaintProperty(a,c,s)&&this._updateLayer(e),o.bT(e)&&a==="raster-fade-duration"&&this.tileManagers[e.source].setRasterFadeDuration(c),this._changed=!0,this._updatedPaintProps[e.id]=!0,this._serializedLayers=null}getPaintProperty(e,a){return this.getLayer(e).getPaintProperty(a)}setFeatureState(e,a){this._checkLoaded();let c=e.source,s=e.sourceLayer,W=this.tileManagers[c];if(W===void 0)return void this.fire(new o.k(new Error(`The source '${c}' does not exist in the map's style.`)));let Z=W.getSource().type;Z==="geojson"&&s?this.fire(new o.k(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):Z!=="vector"||s?(e.id===void 0&&this.fire(new o.k(new Error("The feature id parameter must be provided."))),W.setFeatureState(s,e.id,a)):this.fire(new o.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(e,a){this._checkLoaded();let c=e.source,s=this.tileManagers[c];if(s===void 0)return void this.fire(new o.k(new Error(`The source '${c}' does not exist in the map's style.`)));let W=s.getSource().type,Z=W==="vector"?e.sourceLayer:void 0;W!=="vector"||Z?a&&typeof e.id!="string"&&typeof e.id!="number"?this.fire(new o.k(new Error("A feature id is required to remove its specific state property."))):s.removeFeatureState(Z,e.id,a):this.fire(new o.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(e){this._checkLoaded();let a=e.source,c=e.sourceLayer,s=this.tileManagers[a];if(s!==void 0)return s.getSource().type!=="vector"||c?(e.id===void 0&&this.fire(new o.k(new Error("The feature id parameter must be provided."))),s.getFeatureState(c,e.id)):void this.fire(new o.k(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new o.k(new Error(`The source '${a}' does not exist in the map's style.`)))}getTransition(){return o.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;let e=o.bX(this.tileManagers,(W=>W.serialize())),a=this._serializeByIds(this._order,!0),c=this.map.getTerrain()||void 0,s=this.stylesheet;return o.bY({version:s.version,name:s.name,metadata:s.metadata,light:s.light,sky:s.sky,center:s.center,zoom:s.zoom,bearing:s.bearing,pitch:s.pitch,sprite:s.sprite,glyphs:s.glyphs,transition:s.transition,projection:s.projection,sources:e,layers:a,terrain:c},(W=>W!==void 0))}_updateLayer(e){this._updatedLayers[e.id]=!0,e.source&&!this._updatedSources[e.source]&&this.tileManagers[e.source].getSource().type!=="raster"&&(this._updatedSources[e.source]="reload",this.tileManagers[e.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(e){let a=Z=>this._layers[Z].type==="fill-extrusion",c={},s=[];for(let Z=this._order.length-1;Z>=0;Z--){let u=this._order[Z];if(a(u)){c[u]=Z;for(let G of e){let U=G[u];if(U)for(let X of U)s.push(X)}}}s.sort(((Z,u)=>u.intersectionZ-Z.intersectionZ));let W=[];for(let Z=this._order.length-1;Z>=0;Z--){let u=this._order[Z];if(a(u))for(let G=s.length-1;G>=0;G--){let U=s[G].feature;if(c[U.layer.id]<Z)break;W.push(U),s.pop()}else for(let G of e){let U=G[u];if(U)for(let X of U)W.push(X.feature)}}return W}queryRenderedFeatures(e,a,c){a&&a.filter&&this._validate(o.C.filter,"queryRenderedFeatures.filter",a.filter,null,a);let s={};if(a&&a.layers){if(!(Array.isArray(a.layers)||a.layers instanceof Set))return this.fire(new o.k(new Error("parameters.layers must be an Array or a Set of strings"))),[];for(let U of a.layers){let X=this._layers[U];if(!X)return this.fire(new o.k(new Error(`The layer '${U}' does not exist in the map's style and cannot be queried for features.`))),[];s[X.source]=!0}}let W=[];a.availableImages=this._availableImages;let Z=this._serializedAllLayers(),u=a.layers instanceof Set?a.layers:Array.isArray(a.layers)?new Set(a.layers):null,G=Object.assign(Object.assign({},a),{layers:u,globalState:this._globalState});for(let U in this.tileManagers)a.layers&&!s[U]||W.push(Kl(this.tileManagers[U],this._layers,Z,e,G,c,this.map.terrain?(X,Q,k)=>this.map.terrain.getElevation(X,Q,k):void 0));return this.placement&&W.push((function(U,X,Q,k,j,H,q){let $={},et=H.queryRenderedSymbols(k),nt=[];for(let mt of Object.keys(et).map(Number))nt.push(q[mt]);nt.sort(ci);for(let mt of nt){let at=mt.featureIndex.lookupSymbolFeatures(et[mt.bucketInstanceId],X,mt.bucketIndex,mt.sourceLayerIndex,{filterSpec:j.filter,globalState:j.globalState},j.layers,j.availableImages,U);for(let Wt in at){let Zt=$[Wt]=$[Wt]||[],ot=at[Wt];ot.sort(((Ft,Xt)=>{let It=mt.featureSortOrder;if(It){let Ut=It.indexOf(Ft.featureIndex);return It.indexOf(Xt.featureIndex)-Ut}return Xt.featureIndex-Ft.featureIndex}));for(let Ft of ot)Zt.push(Ft)}}return(function(mt,at,Wt){for(let Zt in mt)for(let ot of mt[Zt])El(ot,Wt[at[Zt].source]);return mt})($,U,Q)})(this._layers,Z,this.tileManagers,e,G,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(W)}querySourceFeatures(e,a){a?.filter&&this._validate(o.C.filter,"querySourceFeatures.filter",a.filter,null,a);let c=this.tileManagers[e];return c?(function(s,W){let Z=s.getRenderableIds().map((U=>s.getTileByID(U))),u=[],G={};for(let U=0;U<Z.length;U++){let X=Z[U],Q=X.tileID.canonical.key;G[Q]||(G[Q]=!0,X.querySourceFeatures(u,W))}return u})(c,a?Object.assign(Object.assign({},a),{globalState:this._globalState}):{globalState:this._globalState}):[]}getLight(){return this.light.getLight()}setLight(e,a={}){this._checkLoaded();let c=this.light.getLight(),s=!1;for(let Z in e)if(!o.bQ(e[Z],c[Z])){s=!0;break}if(!s)return;let W={now:jt(),transition:o.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(e,a),this.light.updateTransitions(W)}getProjection(){var e;return(e=this.stylesheet)===null||e===void 0?void 0:e.projection}setProjection(e){if(this._checkLoaded(),this.projection){if(this.projection.name===e.type)return;this.projection.destroy(),delete this.projection}this.stylesheet.projection=e,this._setProjectionInternal(e.type)}getSky(){var e;return(e=this.stylesheet)===null||e===void 0?void 0:e.sky}setSky(e,a={}){this._checkLoaded();let c=this.getSky(),s=!1;if(!e&&!c)return;if(e&&!c)s=!0;else if(!e&&c)s=!0;else for(let Z in e)if(!o.bQ(e[Z],c[Z])){s=!0;break}if(!s)return;let W={now:jt(),transition:o.e({duration:300,delay:0},this.stylesheet.transition)};this.stylesheet.sky=e,this.sky.setSky(e,a),this.sky.updateTransitions(W)}_setProjectionInternal(e){let a=(function(c,s){let W={constrainOverride:s};if(Array.isArray(c)){let Z=new F({type:c});return{projection:Z,transform:new Wa(W),cameraHelper:new fe(Z)}}switch(c){case"mercator":return{projection:new rl,transform:new Fi(W),cameraHelper:new vl};case"globe":{let Z=new F({type:["interpolate",["linear"],["zoom"],11,"vertical-perspective",12,"mercator"]});return{projection:Z,transform:new Wa(W),cameraHelper:new fe(Z)}}case"vertical-perspective":return{projection:new Sd,transform:new Li(W),cameraHelper:new yi};default:return o.w(`Unknown projection name: ${c}. Falling back to mercator projection.`),{projection:new rl,transform:new Fi(W),cameraHelper:new vl}}})(e,this.map.transformConstrain);this.projection=a.projection,this.map.migrateProjection(a.transform,a.cameraHelper);for(let c in this.tileManagers)this.tileManagers[c].reload()}_validate(e,a,c,s,W={}){return(!W||W.validate!==!1)&&ha(this,e.call(o.C,o.e({key:a,style:this.serialize(),value:c,styleSpec:o.u},s)))}_remove(e=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),zl().off(Ca,this._rtlPluginLoaded);for(let a in this._layers)this._layers[a].setEventedParent(null);for(let a in this.tileManagers){let c=this.tileManagers[a];c.setEventedParent(null),c.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),e&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(e)}_clearSource(e){this.tileManagers[e].clearTiles()}_reloadSource(e){this.tileManagers[e].resume(),this.tileManagers[e].reload()}_updateSources(e){for(let a in this.tileManagers)this.tileManagers[a].update(e,this.map.terrain)}_generateCollisionBoxes(){for(let e in this.tileManagers)this._reloadSource(e)}_updatePlacement(e,a,c,s,W=!1){let Z=!1,u=!1,G={};for(let U of this._order){let X=this._layers[U];if(X.type!=="symbol")continue;if(!G[X.source]){let k=this.tileManagers[X.source];G[X.source]=k.getRenderableIds(!0).map((j=>k.getTileByID(j))).sort(((j,H)=>H.tileID.overscaledZ-j.tileID.overscaledZ||(j.tileID.isLessThan(H.tileID)?-1:1)))}let Q=this.crossTileSymbolIndex.addLayer(X,G[X.source],e.center.lng);Z=Z||Q}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((W=W||this._layerOrderChanged||c===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(jt(),e.zoom))&&(this.pauseablePlacement=new zo(e,this.map.terrain,this._order,W,a,c,s,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,G),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(jt()),u=!0),Z&&this.pauseablePlacement.placement.setStale()),u||Z)for(let U of this._order){let X=this._layers[U];X.type==="symbol"&&this.placement.updateLayerOpacities(X,G[X.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(jt())}_releaseSymbolFadeTiles(){for(let e in this.tileManagers)this.tileManagers[e].releaseSymbolFadeTiles()}getImages(e,a){return o._(this,void 0,void 0,(function*(){let c=yield this.imageManager.getImages(a.icons);this._updateTilesForChangedImages();let s=this.tileManagers[a.source];return s&&s.setDependencies(a.tileID.key,a.type,a.icons),c}))}getGlyphs(e,a){return o._(this,void 0,void 0,(function*(){let c=yield this.glyphManager.getGlyphs(a.stacks),s=this.tileManagers[a.source];return s&&s.setDependencies(a.tileID.key,a.type,[""]),c}))}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(e,a={}){this._checkLoaded(),e&&this._validate(o.C.glyphs,"glyphs",e,null,a)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=e,this.glyphManager.entries={},this.glyphManager.setURL(e))}getDashes(e,a){return o._(this,void 0,void 0,(function*(){let c={};for(let[s,W]of Object.entries(a.dashes))c[s]=this.lineAtlas.getDash(W.dasharray,W.round);return c}))}addSprite(e,a,c={},s){this._checkLoaded();let W=[{id:e,url:a}],Z=[...ii(this.stylesheet.sprite),...W];this._validate(o.C.sprite,"sprite",Z,null,c)||(this.stylesheet.sprite=Z,this._loadSprite(W,!0,s))}removeSprite(e){this._checkLoaded();let a=ii(this.stylesheet.sprite);if(a.find((c=>c.id===e))){if(this._spritesImagesIds[e])for(let c of this._spritesImagesIds[e])this.imageManager.removeImage(c),this._changedImages[c]=!0;a.splice(a.findIndex((c=>c.id===e)),1),this.stylesheet.sprite=a.length>0?a:void 0,delete this._spritesImagesIds[e],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new o.l("data",{dataType:"style"}))}else this.fire(new o.k(new Error(`Sprite "${e}" doesn't exists on this map.`)))}getSprite(){return ii(this.stylesheet.sprite)}setSprite(e,a={},c){this._checkLoaded(),e&&this._validate(o.C.sprite,"sprite",e,null,a)||(this.stylesheet.sprite=e,e?this._loadSprite(e,!0,c):(this._unloadSprite(),c&&c(null)))}destroy(){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null);for(let e in this.tileManagers){let a=this.tileManagers[e];if(a.setEventedParent(null),a._tiles){for(let c in a._tiles)a._tiles[c].unloadVectorData();a._tiles={}}a._cache.reset(),a.onRemove(this.map)}this.tileManagers={},this.imageManager&&(this.imageManager.setEventedParent(null),this.imageManager.destroy(),this._availableImages=[],this._spritesImagesIds={}),this.glyphManager&&this.glyphManager.destroy();for(let e in this._layers){let a=this._layers[e];a.setEventedParent(null),a.onRemove&&a.onRemove(this.map)}this._setInitialValues(),this.setEventedParent(null),this.dispatcher.unregisterMessageHandler("GG"),this.dispatcher.unregisterMessageHandler("GI"),this.dispatcher.unregisterMessageHandler("GDA"),this.dispatcher.remove(!0),this._listeners={},this._oneTimeListeners={}}}var ea=o.aT([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class jc{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(e,a,c,s,W,Z,u,G,U){this.context=e;let X=this.boundPaintVertexBuffers.length!==s.length;for(let Q=0;!X&&Q<s.length;Q++)this.boundPaintVertexBuffers[Q]!==s[Q]&&(X=!0);!this.vao||this.boundProgram!==a||this.boundLayoutVertexBuffer!==c||X||this.boundIndexBuffer!==W||this.boundVertexOffset!==Z||this.boundDynamicVertexBuffer!==u||this.boundDynamicVertexBuffer2!==G||this.boundDynamicVertexBuffer3!==U?this.freshBind(a,c,s,W,Z,u,G,U):(e.bindVertexArray.set(this.vao),u&&u.bind(),W&&W.dynamicDraw&&W.bind(),G&&G.bind(),U&&U.bind())}freshBind(e,a,c,s,W,Z,u,G){let U=e.numAttributes,X=this.context,Q=X.gl;this.vao&&this.destroy(),this.vao=X.createVertexArray(),X.bindVertexArray.set(this.vao),this.boundProgram=e,this.boundLayoutVertexBuffer=a,this.boundPaintVertexBuffers=c,this.boundIndexBuffer=s,this.boundVertexOffset=W,this.boundDynamicVertexBuffer=Z,this.boundDynamicVertexBuffer2=u,this.boundDynamicVertexBuffer3=G,a.enableAttributes(Q,e);for(let k of c)k.enableAttributes(Q,e);Z&&Z.enableAttributes(Q,e),u&&u.enableAttributes(Q,e),G&&G.enableAttributes(Q,e),a.bind(),a.setVertexAttribPointers(Q,e,W);for(let k of c)k.bind(),k.setVertexAttribPointers(Q,e,W);Z&&(Z.bind(),Z.setVertexAttribPointers(Q,e,W)),s&&s.bind(),u&&(u.bind(),u.setVertexAttribPointers(Q,e,W)),G&&(G.bind(),G.setVertexAttribPointers(Q,e,W)),X.currentNumAttributes=U}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}let Ma=(m,e,a,c,s)=>({u_texture:0,u_ele_delta:m,u_fog_matrix:e,u_fog_color:a?a.properties.get("fog-color"):o.bo.white,u_fog_ground_blend:a?a.properties.get("fog-ground-blend"):1,u_fog_ground_blend_opacity:s?0:a?a.calculateFogBlendOpacity(c):0,u_horizon_color:a?a.properties.get("horizon-color"):o.bo.white,u_horizon_fog_blend:a?a.properties.get("horizon-fog-blend"):1,u_is_globe_mode:s?1:0}),mn={mainMatrix:"u_projection_matrix",tileMercatorCoords:"u_projection_tile_mercator_coords",clippingPlane:"u_projection_clipping_plane",projectionTransition:"u_projection_transition",fallbackMatrix:"u_projection_fallback_matrix"};function Nl(m){let e=[];for(let a=0;a<m.length;a++){if(m[a]===null)continue;let c=m[a].split(" ");e.push(c.pop())}return e}class Yn{constructor(e,a,c,s,W,Z,u,G,U=[]){let X=e.gl;this.program=X.createProgram();let Q=Nl(a.staticAttributes),k=c?c.getBinderAttributes():[],j=Q.concat(k),H=ma.prelude.staticUniforms?Nl(ma.prelude.staticUniforms):[],q=u.staticUniforms?Nl(u.staticUniforms):[],$=a.staticUniforms?Nl(a.staticUniforms):[],et=c?c.getBinderUniforms():[],nt=H.concat(q).concat($).concat(et),mt=[];for(let It of nt)mt.indexOf(It)<0&&mt.push(It);let at=c?c.defines():[];Hl(X)&&at.unshift("#version 300 es"),W&&at.push("#define OVERDRAW_INSPECTOR;"),Z&&at.push("#define TERRAIN3D;"),G&&at.push(G),U&&at.push(...U);let Wt=at.concat(ma.prelude.fragmentSource,u.fragmentSource,a.fragmentSource).join(`
`),Zt=at.concat(ma.prelude.vertexSource,u.vertexSource,a.vertexSource).join(`
`);Hl(X)||(Wt=(function(It){return It.replace(/\bin\s/g,"varying ").replace("out highp vec4 fragColor;","").replace(/fragColor/g,"gl_FragColor").replace(/texture\(/g,"texture2D(")})(Wt),Zt=(function(It){return It.replace(/\bin\s/g,"attribute ").replace(/\bout\s/g,"varying ").replace(/texture\(/g,"texture2D(")})(Zt));let ot=X.createShader(X.FRAGMENT_SHADER);if(X.isContextLost())return void(this.failedToCreate=!0);if(X.shaderSource(ot,Wt),X.compileShader(ot),!X.getShaderParameter(ot,X.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${X.getShaderInfoLog(ot)}`);X.attachShader(this.program,ot);let Ft=X.createShader(X.VERTEX_SHADER);if(X.isContextLost())return void(this.failedToCreate=!0);if(X.shaderSource(Ft,Zt),X.compileShader(Ft),!X.getShaderParameter(Ft,X.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${X.getShaderInfoLog(Ft)}`);X.attachShader(this.program,Ft),this.attributes={};let Xt={};this.numAttributes=j.length;for(let It=0;It<this.numAttributes;It++)j[It]&&(X.bindAttribLocation(this.program,It,j[It]),this.attributes[j[It]]=It);if(X.linkProgram(this.program),!X.getProgramParameter(this.program,X.LINK_STATUS))throw new Error(`Program failed to link: ${X.getProgramInfoLog(this.program)}`);X.deleteShader(Ft),X.deleteShader(ot);for(let It=0;It<mt.length;It++){let Ut=mt[It];if(Ut&&!Xt[Ut]){let xt=X.getUniformLocation(this.program,Ut);xt&&(Xt[Ut]=xt)}}this.fixedUniforms=s(e,Xt),this.terrainUniforms=((It,Ut)=>({u_depth:new o.bZ(It,Ut.u_depth),u_terrain:new o.bZ(It,Ut.u_terrain),u_terrain_dim:new o.bp(It,Ut.u_terrain_dim),u_terrain_matrix:new o.b$(It,Ut.u_terrain_matrix),u_terrain_unpack:new o.c0(It,Ut.u_terrain_unpack),u_terrain_exaggeration:new o.bp(It,Ut.u_terrain_exaggeration)}))(e,Xt),this.projectionUniforms=((It,Ut)=>({u_projection_matrix:new o.b$(It,Ut.u_projection_matrix),u_projection_tile_mercator_coords:new o.c0(It,Ut.u_projection_tile_mercator_coords),u_projection_clipping_plane:new o.c0(It,Ut.u_projection_clipping_plane),u_projection_transition:new o.bp(It,Ut.u_projection_transition),u_projection_fallback_matrix:new o.b$(It,Ut.u_projection_fallback_matrix)}))(e,Xt),this.binderUniforms=c?c.getUniforms(e,Xt):[]}draw(e,a,c,s,W,Z,u,G,U,X,Q,k,j,H,q,$,et,nt,mt){let at=e.gl;if(this.failedToCreate)return;if(e.program.set(this.program),e.setDepthMode(c),e.setStencilMode(s),e.setColorMode(W),e.setCullFace(Z),G){e.activeTexture.set(at.TEXTURE2),at.bindTexture(at.TEXTURE_2D,G.depthTexture),e.activeTexture.set(at.TEXTURE3),at.bindTexture(at.TEXTURE_2D,G.texture);for(let Zt in this.terrainUniforms)this.terrainUniforms[Zt].set(G[Zt])}if(U)for(let Zt in U)this.projectionUniforms[mn[Zt]].set(U[Zt]);if(u)for(let Zt in this.fixedUniforms)this.fixedUniforms[Zt].set(u[Zt]);$&&$.setUniforms(e,this.binderUniforms,H,{zoom:q});let Wt=0;switch(a){case at.LINES:Wt=2;break;case at.TRIANGLES:Wt=3;break;case at.LINE_STRIP:Wt=1}for(let Zt of j.get()){let ot=Zt.vaos||(Zt.vaos={});(ot[X]||(ot[X]=new jc)).bind(e,this,Q,$?$.getPaintVertexBuffers():[],k,Zt.vertexOffset,et,nt,mt),at.drawElements(a,Zt.primitiveLength*Wt,at.UNSIGNED_SHORT,Zt.primitiveOffset*Wt*2)}}}function Ya(m,e,a){let c=1/o.aM(a,1,e.transform.tileZoom),s=Math.pow(2,a.tileID.overscaledZ),W=a.tileSize*Math.pow(2,e.transform.tileZoom)/s,Z=W*(a.tileID.canonical.x+a.tileID.wrap*s),u=W*a.tileID.canonical.y;return{u_image:0,u_texsize:a.imageAtlasTexture.size,u_scale:[c,m.fromScale,m.toScale],u_fade:m.t,u_pixel_coord_upper:[Z>>16,u>>16],u_pixel_coord_lower:[65535&Z,65535&u]}}let Za=(m,e,a,c)=>{let s=m.style.light,W=s.properties.get("position"),Z=[W.x,W.y,W.z],u=o.c3();s.properties.get("anchor")==="viewport"&&o.c4(u,m.transform.bearingInRadians),o.c5(Z,Z,u);let G=m.transform.transformLightDirection(Z),U=s.properties.get("color");return{u_lightpos:Z,u_lightpos_globe:G,u_lightintensity:s.properties.get("intensity"),u_lightcolor:[U.r,U.g,U.b],u_vertical_gradient:+e,u_opacity:a,u_fill_translate:c}},xn=(m,e,a,c,s,W,Z)=>o.e(Za(m,e,a,c),Ya(W,m,Z),{u_height_factor:-Math.pow(2,s.overscaledZ)/Z.tileSize/8}),qa=(m,e,a,c)=>o.e(Ya(e,m,a),{u_fill_translate:c}),$a=(m,e)=>({u_world:m,u_fill_translate:e}),Pr=(m,e,a,c,s)=>o.e(qa(m,e,a,s),{u_world:c}),Ao=(m,e,a,c,s)=>{let W=m.transform,Z,u,G=0;if(a.paint.get("circle-pitch-alignment")==="map"){let U=o.aM(e,1,W.zoom);Z=!0,u=[U,U],G=U/(o.a4*Math.pow(2,e.tileID.overscaledZ))*2*Math.PI*s}else Z=!1,u=W.pixelsToGLUnits;return{u_camera_to_center_distance:W.cameraToCenterDistance,u_scale_with_map:+(a.paint.get("circle-pitch-scale")==="map"),u_pitch_with_map:+Z,u_device_pixel_ratio:m.pixelRatio,u_extrude_scale:u,u_globe_extrude_scale:G,u_translate:c}},Ac=m=>({u_pixel_extrude_scale:[1/m.width,1/m.height]}),ni=m=>({u_viewport_size:[m.width,m.height]}),Fd=(m,e=1)=>({u_color:m,u_overlay:0,u_overlay_scale:e}),pa=(m,e,a,c)=>{let s=o.aM(m,1,e)/(o.a4*Math.pow(2,m.tileID.overscaledZ))*2*Math.PI*c;return{u_extrude_scale:o.aM(m,1,e),u_intensity:a,u_globe_extrude_scale:s}},Tn=(m,e,a,c)=>{let s=o.N();o.c6(s,0,m.width,m.height,0,0,1);let W=m.context.gl;return{u_matrix:s,u_world:[W.drawingBufferWidth,W.drawingBufferHeight],u_image:a,u_color_ramp:c,u_opacity:e.paint.get("heatmap-opacity")}},Pn=(m,e,a)=>{let c=a.paint.get("hillshade-accent-color"),s;switch(a.paint.get("hillshade-method")){case"basic":s=4;break;case"combined":s=1;break;case"igor":s=2;break;case"multidirectional":s=3;break;default:s=0}let W=a.getIlluminationProperties();for(let Z=0;Z<W.directionRadians.length;Z++)a.paint.get("hillshade-illumination-anchor")==="viewport"&&(W.directionRadians[Z]+=m.transform.bearingInRadians);return{u_image:0,u_latrange:wc(0,e.tileID),u_exaggeration:a.paint.get("hillshade-exaggeration"),u_altitudes:W.altitudeRadians,u_azimuths:W.directionRadians,u_accent:c,u_method:s,u_highlights:W.highlightColor,u_shadows:W.shadowColor}},wo=(m,e)=>{let a=e.stride,c=o.N();return o.c6(c,0,o.a4,-o.a4,0,0,1),o.O(c,c,[0,-o.a4,0]),{u_matrix:c,u_image:1,u_dimension:[a,a],u_zoom:m.overscaledZ,u_unpack:e.getUnpackVector()}};function wc(m,e){let a=Math.pow(2,e.canonical.z),c=e.canonical.y;return[new o.aa(0,c/a).toLngLat().lat,new o.aa(0,(c+1)/a).toLngLat().lat]}let La=(m,e,a=0)=>({u_image:0,u_unpack:e.getUnpackVector(),u_dimension:[e.stride,e.stride],u_elevation_stops:1,u_color_stops:4,u_color_ramp_size:a,u_opacity:m.paint.get("color-relief-opacity")}),Gd=(m,e,a,c)=>{let s=m.transform;return{u_translation:Qd(m,e,a),u_ratio:c/o.aM(e,1,s.zoom),u_device_pixel_ratio:m.pixelRatio,u_units_to_pixels:[1/s.pixelsToGLUnits[0],1/s.pixelsToGLUnits[1]]}},xa=(m,e,a,c,s)=>o.e(Gd(m,e,a,c),{u_image:0,u_image_height:s}),vo=(m,e,a,c,s)=>{let W=m.transform,Z=Kn(e,W);return{u_translation:Qd(m,e,a),u_texsize:e.imageAtlasTexture.size,u_ratio:c/o.aM(e,1,W.zoom),u_device_pixel_ratio:m.pixelRatio,u_image:0,u_scale:[Z,s.fromScale,s.toScale],u_fade:s.t,u_units_to_pixels:[1/W.pixelsToGLUnits[0],1/W.pixelsToGLUnits[1]]}},Cd=(m,e,a,c,s)=>{let W=Kn(e,m.transform);return o.e(Gd(m,e,a,c),{u_tileratio:W,u_crossfade_from:s.fromScale,u_crossfade_to:s.toScale,u_image:0,u_mix:s.t,u_lineatlas_width:m.lineAtlas.width,u_lineatlas_height:m.lineAtlas.height})},kd=(m,e,a,c,s,W)=>{let Z=Kn(e,m.transform);return o.e(Gd(m,e,a,c),{u_image:0,u_image_height:W,u_tileratio:Z,u_crossfade_from:s.fromScale,u_crossfade_to:s.toScale,u_image_dash:1,u_mix:s.t,u_lineatlas_width:m.lineAtlas.width,u_lineatlas_height:m.lineAtlas.height})};function Kn(m,e){return 1/o.aM(m,1,e.tileZoom)}function Qd(m,e,a){return o.aN(m.transform,e,a.paint.get("line-translate"),a.paint.get("line-translate-anchor"))}let vc=(m,e,a,c,s)=>{return{u_tl_parent:m,u_scale_parent:e,u_buffer_scale:1,u_fade_t:a.mix,u_opacity:a.opacity*c.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:c.paint.get("raster-brightness-min"),u_brightness_high:c.paint.get("raster-brightness-max"),u_saturation_factor:(Z=c.paint.get("raster-saturation"),Z>0?1-1/(1.001-Z):-Z),u_contrast_factor:(W=c.paint.get("raster-contrast"),W>0?1/(1-W):1+W),u_spin_weights:Ld(c.paint.get("raster-hue-rotate")),u_coords_top:[s[0].x,s[0].y,s[1].x,s[1].y],u_coords_bottom:[s[3].x,s[3].y,s[2].x,s[2].y]};var W,Z};function Ld(m){m*=Math.PI/180;let e=Math.sin(m),a=Math.cos(m);return[(2*a+1)/3,(-Math.sqrt(3)*e-a+1)/3,(Math.sqrt(3)*e-a+1)/3]}let qn=(m,e,a,c,s,W,Z,u,G,U,X,Q,k)=>{let j=Z.transform;return{u_is_size_zoom_constant:+(m==="constant"||m==="source"),u_is_size_feature_constant:+(m==="constant"||m==="camera"),u_size_t:e?e.uSizeT:0,u_size:e?e.uSize:0,u_camera_to_center_distance:j.cameraToCenterDistance,u_pitch:j.pitch/360*2*Math.PI,u_rotate_symbol:+a,u_aspect_ratio:j.width/j.height,u_fade_change:Z.options.fadeDuration?Z.symbolFadeChange:1,u_label_plane_matrix:u,u_coord_matrix:G,u_is_text:+X,u_pitch_with_map:+c,u_is_along_line:s,u_is_variable_anchor:W,u_texsize:Q,u_texture:0,u_translation:U,u_pitched_scale:k}},Ta=(m,e,a,c,s,W,Z,u,G,U,X,Q,k,j)=>{let H=Z.transform;return o.e(qn(m,e,a,c,s,W,Z,u,G,U,X,Q,j),{u_gamma_scale:c?Math.cos(H.pitch*Math.PI/180)*H.cameraToCenterDistance:1,u_device_pixel_ratio:Z.pixelRatio,u_is_halo:1})},Hc=(m,e,a,c,s,W,Z,u,G,U,X,Q,k)=>o.e(Ta(m,e,a,c,s,W,Z,u,G,U,!0,X,0,k),{u_texsize_icon:Q,u_texture_icon:1}),Ed=(m,e)=>({u_opacity:m,u_color:e}),mc=(m,e,a,c,s)=>o.e((function(W,Z,u,G){let U=u.imageManager.getPattern(W.from.toString()),X=u.imageManager.getPattern(W.to.toString()),{width:Q,height:k}=u.imageManager.getPixelSize(),j=Math.pow(2,G.tileID.overscaledZ),H=G.tileSize*Math.pow(2,u.transform.tileZoom)/j,q=H*(G.tileID.canonical.x+G.tileID.wrap*j),$=H*G.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:U.tl,u_pattern_br_a:U.br,u_pattern_tl_b:X.tl,u_pattern_br_b:X.br,u_texsize:[Q,k],u_mix:Z.t,u_pattern_size_a:U.displaySize,u_pattern_size_b:X.displaySize,u_scale_a:Z.fromScale,u_scale_b:Z.toScale,u_tile_units_to_pixels:1/o.aM(G,1,u.transform.tileZoom),u_pixel_coord_upper:[q>>16,$>>16],u_pixel_coord_lower:[65535&q,65535&$]}})(a,s,e,c),{u_opacity:m}),it=(m,e)=>{},Rt={fillExtrusion:(m,e)=>({u_lightpos:new o.c1(m,e.u_lightpos),u_lightpos_globe:new o.c1(m,e.u_lightpos_globe),u_lightintensity:new o.bp(m,e.u_lightintensity),u_lightcolor:new o.c1(m,e.u_lightcolor),u_vertical_gradient:new o.bp(m,e.u_vertical_gradient),u_opacity:new o.bp(m,e.u_opacity),u_fill_translate:new o.c2(m,e.u_fill_translate)}),fillExtrusionPattern:(m,e)=>({u_lightpos:new o.c1(m,e.u_lightpos),u_lightpos_globe:new o.c1(m,e.u_lightpos_globe),u_lightintensity:new o.bp(m,e.u_lightintensity),u_lightcolor:new o.c1(m,e.u_lightcolor),u_vertical_gradient:new o.bp(m,e.u_vertical_gradient),u_height_factor:new o.bp(m,e.u_height_factor),u_opacity:new o.bp(m,e.u_opacity),u_fill_translate:new o.c2(m,e.u_fill_translate),u_image:new o.bZ(m,e.u_image),u_texsize:new o.c2(m,e.u_texsize),u_pixel_coord_upper:new o.c2(m,e.u_pixel_coord_upper),u_pixel_coord_lower:new o.c2(m,e.u_pixel_coord_lower),u_scale:new o.c1(m,e.u_scale),u_fade:new o.bp(m,e.u_fade)}),fill:(m,e)=>({u_fill_translate:new o.c2(m,e.u_fill_translate)}),fillPattern:(m,e)=>({u_image:new o.bZ(m,e.u_image),u_texsize:new o.c2(m,e.u_texsize),u_pixel_coord_upper:new o.c2(m,e.u_pixel_coord_upper),u_pixel_coord_lower:new o.c2(m,e.u_pixel_coord_lower),u_scale:new o.c1(m,e.u_scale),u_fade:new o.bp(m,e.u_fade),u_fill_translate:new o.c2(m,e.u_fill_translate)}),fillOutline:(m,e)=>({u_world:new o.c2(m,e.u_world),u_fill_translate:new o.c2(m,e.u_fill_translate)}),fillOutlinePattern:(m,e)=>({u_world:new o.c2(m,e.u_world),u_image:new o.bZ(m,e.u_image),u_texsize:new o.c2(m,e.u_texsize),u_pixel_coord_upper:new o.c2(m,e.u_pixel_coord_upper),u_pixel_coord_lower:new o.c2(m,e.u_pixel_coord_lower),u_scale:new o.c1(m,e.u_scale),u_fade:new o.bp(m,e.u_fade),u_fill_translate:new o.c2(m,e.u_fill_translate)}),circle:(m,e)=>({u_camera_to_center_distance:new o.bp(m,e.u_camera_to_center_distance),u_scale_with_map:new o.bZ(m,e.u_scale_with_map),u_pitch_with_map:new o.bZ(m,e.u_pitch_with_map),u_extrude_scale:new o.c2(m,e.u_extrude_scale),u_device_pixel_ratio:new o.bp(m,e.u_device_pixel_ratio),u_globe_extrude_scale:new o.bp(m,e.u_globe_extrude_scale),u_translate:new o.c2(m,e.u_translate)}),collisionBox:(m,e)=>({u_pixel_extrude_scale:new o.c2(m,e.u_pixel_extrude_scale)}),collisionCircle:(m,e)=>({u_viewport_size:new o.c2(m,e.u_viewport_size)}),debug:(m,e)=>({u_color:new o.b_(m,e.u_color),u_overlay:new o.bZ(m,e.u_overlay),u_overlay_scale:new o.bp(m,e.u_overlay_scale)}),depth:it,clippingMask:it,heatmap:(m,e)=>({u_extrude_scale:new o.bp(m,e.u_extrude_scale),u_intensity:new o.bp(m,e.u_intensity),u_globe_extrude_scale:new o.bp(m,e.u_globe_extrude_scale)}),heatmapTexture:(m,e)=>({u_matrix:new o.b$(m,e.u_matrix),u_world:new o.c2(m,e.u_world),u_image:new o.bZ(m,e.u_image),u_color_ramp:new o.bZ(m,e.u_color_ramp),u_opacity:new o.bp(m,e.u_opacity)}),hillshade:(m,e)=>({u_image:new o.bZ(m,e.u_image),u_latrange:new o.c2(m,e.u_latrange),u_exaggeration:new o.bp(m,e.u_exaggeration),u_altitudes:new o.c8(m,e.u_altitudes),u_azimuths:new o.c8(m,e.u_azimuths),u_accent:new o.b_(m,e.u_accent),u_method:new o.bZ(m,e.u_method),u_shadows:new o.c7(m,e.u_shadows),u_highlights:new o.c7(m,e.u_highlights)}),hillshadePrepare:(m,e)=>({u_matrix:new o.b$(m,e.u_matrix),u_image:new o.bZ(m,e.u_image),u_dimension:new o.c2(m,e.u_dimension),u_zoom:new o.bp(m,e.u_zoom),u_unpack:new o.c0(m,e.u_unpack)}),colorRelief:(m,e)=>({u_image:new o.bZ(m,e.u_image),u_unpack:new o.c0(m,e.u_unpack),u_dimension:new o.c2(m,e.u_dimension),u_elevation_stops:new o.bZ(m,e.u_elevation_stops),u_color_stops:new o.bZ(m,e.u_color_stops),u_color_ramp_size:new o.bZ(m,e.u_color_ramp_size),u_opacity:new o.bp(m,e.u_opacity)}),line:(m,e)=>({u_translation:new o.c2(m,e.u_translation),u_ratio:new o.bp(m,e.u_ratio),u_device_pixel_ratio:new o.bp(m,e.u_device_pixel_ratio),u_units_to_pixels:new o.c2(m,e.u_units_to_pixels)}),lineGradient:(m,e)=>({u_translation:new o.c2(m,e.u_translation),u_ratio:new o.bp(m,e.u_ratio),u_device_pixel_ratio:new o.bp(m,e.u_device_pixel_ratio),u_units_to_pixels:new o.c2(m,e.u_units_to_pixels),u_image:new o.bZ(m,e.u_image),u_image_height:new o.bp(m,e.u_image_height)}),linePattern:(m,e)=>({u_translation:new o.c2(m,e.u_translation),u_texsize:new o.c2(m,e.u_texsize),u_ratio:new o.bp(m,e.u_ratio),u_device_pixel_ratio:new o.bp(m,e.u_device_pixel_ratio),u_image:new o.bZ(m,e.u_image),u_units_to_pixels:new o.c2(m,e.u_units_to_pixels),u_scale:new o.c1(m,e.u_scale),u_fade:new o.bp(m,e.u_fade)}),lineSDF:(m,e)=>({u_translation:new o.c2(m,e.u_translation),u_ratio:new o.bp(m,e.u_ratio),u_device_pixel_ratio:new o.bp(m,e.u_device_pixel_ratio),u_units_to_pixels:new o.c2(m,e.u_units_to_pixels),u_image:new o.bZ(m,e.u_image),u_mix:new o.bp(m,e.u_mix),u_tileratio:new o.bp(m,e.u_tileratio),u_crossfade_from:new o.bp(m,e.u_crossfade_from),u_crossfade_to:new o.bp(m,e.u_crossfade_to),u_lineatlas_width:new o.bp(m,e.u_lineatlas_width),u_lineatlas_height:new o.bp(m,e.u_lineatlas_height)}),lineGradientSDF:(m,e)=>({u_translation:new o.c2(m,e.u_translation),u_ratio:new o.bp(m,e.u_ratio),u_device_pixel_ratio:new o.bp(m,e.u_device_pixel_ratio),u_units_to_pixels:new o.c2(m,e.u_units_to_pixels),u_image:new o.bZ(m,e.u_image),u_image_height:new o.bp(m,e.u_image_height),u_tileratio:new o.bp(m,e.u_tileratio),u_crossfade_from:new o.bp(m,e.u_crossfade_from),u_crossfade_to:new o.bp(m,e.u_crossfade_to),u_image_dash:new o.bZ(m,e.u_image_dash),u_mix:new o.bp(m,e.u_mix),u_lineatlas_width:new o.bp(m,e.u_lineatlas_width),u_lineatlas_height:new o.bp(m,e.u_lineatlas_height)}),raster:(m,e)=>({u_tl_parent:new o.c2(m,e.u_tl_parent),u_scale_parent:new o.bp(m,e.u_scale_parent),u_buffer_scale:new o.bp(m,e.u_buffer_scale),u_fade_t:new o.bp(m,e.u_fade_t),u_opacity:new o.bp(m,e.u_opacity),u_image0:new o.bZ(m,e.u_image0),u_image1:new o.bZ(m,e.u_image1),u_brightness_low:new o.bp(m,e.u_brightness_low),u_brightness_high:new o.bp(m,e.u_brightness_high),u_saturation_factor:new o.bp(m,e.u_saturation_factor),u_contrast_factor:new o.bp(m,e.u_contrast_factor),u_spin_weights:new o.c1(m,e.u_spin_weights),u_coords_top:new o.c0(m,e.u_coords_top),u_coords_bottom:new o.c0(m,e.u_coords_bottom)}),symbolIcon:(m,e)=>({u_is_size_zoom_constant:new o.bZ(m,e.u_is_size_zoom_constant),u_is_size_feature_constant:new o.bZ(m,e.u_is_size_feature_constant),u_size_t:new o.bp(m,e.u_size_t),u_size:new o.bp(m,e.u_size),u_camera_to_center_distance:new o.bp(m,e.u_camera_to_center_distance),u_pitch:new o.bp(m,e.u_pitch),u_rotate_symbol:new o.bZ(m,e.u_rotate_symbol),u_aspect_ratio:new o.bp(m,e.u_aspect_ratio),u_fade_change:new o.bp(m,e.u_fade_change),u_label_plane_matrix:new o.b$(m,e.u_label_plane_matrix),u_coord_matrix:new o.b$(m,e.u_coord_matrix),u_is_text:new o.bZ(m,e.u_is_text),u_pitch_with_map:new o.bZ(m,e.u_pitch_with_map),u_is_along_line:new o.bZ(m,e.u_is_along_line),u_is_variable_anchor:new o.bZ(m,e.u_is_variable_anchor),u_texsize:new o.c2(m,e.u_texsize),u_texture:new o.bZ(m,e.u_texture),u_translation:new o.c2(m,e.u_translation),u_pitched_scale:new o.bp(m,e.u_pitched_scale)}),symbolSDF:(m,e)=>({u_is_size_zoom_constant:new o.bZ(m,e.u_is_size_zoom_constant),u_is_size_feature_constant:new o.bZ(m,e.u_is_size_feature_constant),u_size_t:new o.bp(m,e.u_size_t),u_size:new o.bp(m,e.u_size),u_camera_to_center_distance:new o.bp(m,e.u_camera_to_center_distance),u_pitch:new o.bp(m,e.u_pitch),u_rotate_symbol:new o.bZ(m,e.u_rotate_symbol),u_aspect_ratio:new o.bp(m,e.u_aspect_ratio),u_fade_change:new o.bp(m,e.u_fade_change),u_label_plane_matrix:new o.b$(m,e.u_label_plane_matrix),u_coord_matrix:new o.b$(m,e.u_coord_matrix),u_is_text:new o.bZ(m,e.u_is_text),u_pitch_with_map:new o.bZ(m,e.u_pitch_with_map),u_is_along_line:new o.bZ(m,e.u_is_along_line),u_is_variable_anchor:new o.bZ(m,e.u_is_variable_anchor),u_texsize:new o.c2(m,e.u_texsize),u_texture:new o.bZ(m,e.u_texture),u_gamma_scale:new o.bp(m,e.u_gamma_scale),u_device_pixel_ratio:new o.bp(m,e.u_device_pixel_ratio),u_is_halo:new o.bZ(m,e.u_is_halo),u_translation:new o.c2(m,e.u_translation),u_pitched_scale:new o.bp(m,e.u_pitched_scale)}),symbolTextAndIcon:(m,e)=>({u_is_size_zoom_constant:new o.bZ(m,e.u_is_size_zoom_constant),u_is_size_feature_constant:new o.bZ(m,e.u_is_size_feature_constant),u_size_t:new o.bp(m,e.u_size_t),u_size:new o.bp(m,e.u_size),u_camera_to_center_distance:new o.bp(m,e.u_camera_to_center_distance),u_pitch:new o.bp(m,e.u_pitch),u_rotate_symbol:new o.bZ(m,e.u_rotate_symbol),u_aspect_ratio:new o.bp(m,e.u_aspect_ratio),u_fade_change:new o.bp(m,e.u_fade_change),u_label_plane_matrix:new o.b$(m,e.u_label_plane_matrix),u_coord_matrix:new o.b$(m,e.u_coord_matrix),u_is_text:new o.bZ(m,e.u_is_text),u_pitch_with_map:new o.bZ(m,e.u_pitch_with_map),u_is_along_line:new o.bZ(m,e.u_is_along_line),u_is_variable_anchor:new o.bZ(m,e.u_is_variable_anchor),u_texsize:new o.c2(m,e.u_texsize),u_texsize_icon:new o.c2(m,e.u_texsize_icon),u_texture:new o.bZ(m,e.u_texture),u_texture_icon:new o.bZ(m,e.u_texture_icon),u_gamma_scale:new o.bp(m,e.u_gamma_scale),u_device_pixel_ratio:new o.bp(m,e.u_device_pixel_ratio),u_is_halo:new o.bZ(m,e.u_is_halo),u_translation:new o.c2(m,e.u_translation),u_pitched_scale:new o.bp(m,e.u_pitched_scale)}),background:(m,e)=>({u_opacity:new o.bp(m,e.u_opacity),u_color:new o.b_(m,e.u_color)}),backgroundPattern:(m,e)=>({u_opacity:new o.bp(m,e.u_opacity),u_image:new o.bZ(m,e.u_image),u_pattern_tl_a:new o.c2(m,e.u_pattern_tl_a),u_pattern_br_a:new o.c2(m,e.u_pattern_br_a),u_pattern_tl_b:new o.c2(m,e.u_pattern_tl_b),u_pattern_br_b:new o.c2(m,e.u_pattern_br_b),u_texsize:new o.c2(m,e.u_texsize),u_mix:new o.bp(m,e.u_mix),u_pattern_size_a:new o.c2(m,e.u_pattern_size_a),u_pattern_size_b:new o.c2(m,e.u_pattern_size_b),u_scale_a:new o.bp(m,e.u_scale_a),u_scale_b:new o.bp(m,e.u_scale_b),u_pixel_coord_upper:new o.c2(m,e.u_pixel_coord_upper),u_pixel_coord_lower:new o.c2(m,e.u_pixel_coord_lower),u_tile_units_to_pixels:new o.bp(m,e.u_tile_units_to_pixels)}),terrain:(m,e)=>({u_texture:new o.bZ(m,e.u_texture),u_ele_delta:new o.bp(m,e.u_ele_delta),u_fog_matrix:new o.b$(m,e.u_fog_matrix),u_fog_color:new o.b_(m,e.u_fog_color),u_fog_ground_blend:new o.bp(m,e.u_fog_ground_blend),u_fog_ground_blend_opacity:new o.bp(m,e.u_fog_ground_blend_opacity),u_horizon_color:new o.b_(m,e.u_horizon_color),u_horizon_fog_blend:new o.bp(m,e.u_horizon_fog_blend),u_is_globe_mode:new o.bp(m,e.u_is_globe_mode)}),terrainDepth:(m,e)=>({u_ele_delta:new o.bp(m,e.u_ele_delta)}),terrainCoords:(m,e)=>({u_texture:new o.bZ(m,e.u_texture),u_terrain_coords_id:new o.bp(m,e.u_terrain_coords_id),u_ele_delta:new o.bp(m,e.u_ele_delta)}),projectionErrorMeasurement:(m,e)=>({u_input:new o.bp(m,e.u_input),u_output_expected:new o.bp(m,e.u_output_expected)}),atmosphere:(m,e)=>({u_sun_pos:new o.c1(m,e.u_sun_pos),u_atmosphere_blend:new o.bp(m,e.u_atmosphere_blend),u_globe_position:new o.c1(m,e.u_globe_position),u_globe_radius:new o.bp(m,e.u_globe_radius),u_inv_proj_matrix:new o.b$(m,e.u_inv_proj_matrix)}),sky:(m,e)=>({u_sky_color:new o.b_(m,e.u_sky_color),u_horizon_color:new o.b_(m,e.u_horizon_color),u_horizon:new o.c2(m,e.u_horizon),u_horizon_normal:new o.c2(m,e.u_horizon_normal),u_sky_horizon_blend:new o.bp(m,e.u_sky_horizon_blend),u_sky_blend:new o.bp(m,e.u_sky_blend)})};class Mt{constructor(e,a,c){this.context=e;let s=e.gl;this.buffer=s.createBuffer(),this.dynamicDraw=!!c,this.context.unbindVAO(),e.bindElementBuffer.set(this.buffer),s.bufferData(s.ELEMENT_ARRAY_BUFFER,a.arrayBuffer,this.dynamicDraw?s.DYNAMIC_DRAW:s.STATIC_DRAW),this.dynamicDraw||delete a.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(e){let a=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),a.bufferSubData(a.ELEMENT_ARRAY_BUFFER,0,e.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}let St={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class zt{constructor(e,a,c,s){this.length=a.length,this.attributes=c,this.itemSize=a.bytesPerElement,this.dynamicDraw=s,this.context=e;let W=e.gl;this.buffer=W.createBuffer(),e.bindVertexBuffer.set(this.buffer),W.bufferData(W.ARRAY_BUFFER,a.arrayBuffer,this.dynamicDraw?W.DYNAMIC_DRAW:W.STATIC_DRAW),this.dynamicDraw||delete a.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(e){if(e.length!==this.length)throw new Error(`Length of new data is ${e.length}, which doesn't match current length of ${this.length}`);let a=this.context.gl;this.bind(),a.bufferSubData(a.ARRAY_BUFFER,0,e.arrayBuffer)}enableAttributes(e,a){for(let c=0;c<this.attributes.length;c++){let s=a.attributes[this.attributes[c].name];s!==void 0&&e.enableVertexAttribArray(s)}}setVertexAttribPointers(e,a,c){for(let s=0;s<this.attributes.length;s++){let W=this.attributes[s],Z=a.attributes[W.name];Z!==void 0&&e.vertexAttribPointer(Z,W.components,e[St[W.type]],!1,this.itemSize,W.offset+this.itemSize*(c||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Dt{constructor(e){this.gl=e.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(e){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class oe extends Dt{getDefault(){return o.bo.transparent}set(e){let a=this.current;(e.r!==a.r||e.g!==a.g||e.b!==a.b||e.a!==a.a||this.dirty)&&(this.gl.clearColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class Ve extends Dt{getDefault(){return 1}set(e){(e!==this.current||this.dirty)&&(this.gl.clearDepth(e),this.current=e,this.dirty=!1)}}class ce extends Dt{getDefault(){return 0}set(e){(e!==this.current||this.dirty)&&(this.gl.clearStencil(e),this.current=e,this.dirty=!1)}}class qe extends Dt{getDefault(){return[!0,!0,!0,!0]}set(e){let a=this.current;(e[0]!==a[0]||e[1]!==a[1]||e[2]!==a[2]||e[3]!==a[3]||this.dirty)&&(this.gl.colorMask(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class xe extends Dt{getDefault(){return!0}set(e){(e!==this.current||this.dirty)&&(this.gl.depthMask(e),this.current=e,this.dirty=!1)}}class Xe extends Dt{getDefault(){return 255}set(e){(e!==this.current||this.dirty)&&(this.gl.stencilMask(e),this.current=e,this.dirty=!1)}}class ve extends Dt{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(e){let a=this.current;(e.func!==a.func||e.ref!==a.ref||e.mask!==a.mask||this.dirty)&&(this.gl.stencilFunc(e.func,e.ref,e.mask),this.current=e,this.dirty=!1)}}class Ge extends Dt{getDefault(){let e=this.gl;return[e.KEEP,e.KEEP,e.KEEP]}set(e){let a=this.current;(e[0]!==a[0]||e[1]!==a[1]||e[2]!==a[2]||this.dirty)&&(this.gl.stencilOp(e[0],e[1],e[2]),this.current=e,this.dirty=!1)}}class Wi extends Dt{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;let a=this.gl;e?a.enable(a.STENCIL_TEST):a.disable(a.STENCIL_TEST),this.current=e,this.dirty=!1}}class el extends Dt{getDefault(){return[0,1]}set(e){let a=this.current;(e[0]!==a[0]||e[1]!==a[1]||this.dirty)&&(this.gl.depthRange(e[0],e[1]),this.current=e,this.dirty=!1)}}class il extends Dt{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;let a=this.gl;e?a.enable(a.DEPTH_TEST):a.disable(a.DEPTH_TEST),this.current=e,this.dirty=!1}}class Il extends Dt{getDefault(){return this.gl.LESS}set(e){(e!==this.current||this.dirty)&&(this.gl.depthFunc(e),this.current=e,this.dirty=!1)}}class Oi extends Dt{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;let a=this.gl;e?a.enable(a.BLEND):a.disable(a.BLEND),this.current=e,this.dirty=!1}}class $n extends Dt{getDefault(){let e=this.gl;return[e.ONE,e.ZERO]}set(e){let a=this.current;(e[0]!==a[0]||e[1]!==a[1]||this.dirty)&&(this.gl.blendFunc(e[0],e[1]),this.current=e,this.dirty=!1)}}class yl extends Dt{getDefault(){return o.bo.transparent}set(e){let a=this.current;(e.r!==a.r||e.g!==a.g||e.b!==a.b||e.a!==a.a||this.dirty)&&(this.gl.blendColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class Kr extends Dt{getDefault(){return this.gl.FUNC_ADD}set(e){(e!==this.current||this.dirty)&&(this.gl.blendEquation(e),this.current=e,this.dirty=!1)}}class zd extends Dt{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;let a=this.gl;e?a.enable(a.CULL_FACE):a.disable(a.CULL_FACE),this.current=e,this.dirty=!1}}class Ho extends Dt{getDefault(){return this.gl.BACK}set(e){(e!==this.current||this.dirty)&&(this.gl.cullFace(e),this.current=e,this.dirty=!1)}}class Do extends Dt{getDefault(){return this.gl.CCW}set(e){(e!==this.current||this.dirty)&&(this.gl.frontFace(e),this.current=e,this.dirty=!1)}}class Dc extends Dt{getDefault(){return null}set(e){(e!==this.current||this.dirty)&&(this.gl.useProgram(e),this.current=e,this.dirty=!1)}}class fo extends Dt{getDefault(){return this.gl.TEXTURE0}set(e){(e!==this.current||this.dirty)&&(this.gl.activeTexture(e),this.current=e,this.dirty=!1)}}class W0 extends Dt{getDefault(){let e=this.gl;return[0,0,e.drawingBufferWidth,e.drawingBufferHeight]}set(e){let a=this.current;(e[0]!==a[0]||e[1]!==a[1]||e[2]!==a[2]||e[3]!==a[3]||this.dirty)&&(this.gl.viewport(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class Wc extends Dt{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;let a=this.gl;a.bindFramebuffer(a.FRAMEBUFFER,e),this.current=e,this.dirty=!1}}class hc extends Dt{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;let a=this.gl;a.bindRenderbuffer(a.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class h0 extends Dt{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;let a=this.gl;a.bindTexture(a.TEXTURE_2D,e),this.current=e,this.dirty=!1}}class qr extends Dt{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;let a=this.gl;a.bindBuffer(a.ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class _e extends Dt{getDefault(){return null}set(e){let a=this.gl;a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class Oo extends Dt{getDefault(){return null}set(e){var a;if(e===this.current&&!this.dirty)return;let c=this.gl;Hl(c)?c.bindVertexArray(e):(a=c.getExtension("OES_vertex_array_object"))===null||a===void 0||a.bindVertexArrayOES(e),this.current=e,this.dirty=!1}}class Ob extends Dt{getDefault(){return 4}set(e){if(e===this.current&&!this.dirty)return;let a=this.gl;a.pixelStorei(a.UNPACK_ALIGNMENT,e),this.current=e,this.dirty=!1}}class Z0 extends Dt{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;let a=this.gl;a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e),this.current=e,this.dirty=!1}}class fc extends Dt{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;let a=this.gl;a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,e),this.current=e,this.dirty=!1}}class $r extends Dt{constructor(e,a){super(e),this.context=e,this.parent=a}getDefault(){return null}}class _b extends $r{setDirty(){this.dirty=!0}set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let a=this.gl;a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,e,0),this.current=e,this.dirty=!1}}class p0 extends $r{set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let a=this.gl;a.framebufferRenderbuffer(a.FRAMEBUFFER,a.DEPTH_ATTACHMENT,a.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class Pb extends $r{set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let a=this.gl;a.framebufferRenderbuffer(a.FRAMEBUFFER,a.DEPTH_STENCIL_ATTACHMENT,a.RENDERBUFFER,e),this.current=e,this.dirty=!1}}let _o="Framebuffer is not complete";class Po{constructor(e,a,c,s,W){this.context=e,this.width=a,this.height=c;let Z=e.gl,u=this.framebuffer=Z.createFramebuffer();if(this.colorAttachment=new _b(e,u),s)this.depthAttachment=W?new Pb(e,u):new p0(e,u);else if(W)throw new Error("Stencil cannot be set without depth");if(Z.checkFramebufferStatus(Z.FRAMEBUFFER)!==Z.FRAMEBUFFER_COMPLETE)throw new Error(_o)}destroy(){let e=this.context.gl,a=this.colorAttachment.get();if(a&&e.deleteTexture(a),this.depthAttachment){let c=this.depthAttachment.get();c&&e.deleteRenderbuffer(c)}e.deleteFramebuffer(this.framebuffer)}}class Ko{constructor(e){var a,c;if(this.gl=e,this.clearColor=new oe(this),this.clearDepth=new Ve(this),this.clearStencil=new ce(this),this.colorMask=new qe(this),this.depthMask=new xe(this),this.stencilMask=new Xe(this),this.stencilFunc=new ve(this),this.stencilOp=new Ge(this),this.stencilTest=new Wi(this),this.depthRange=new el(this),this.depthTest=new il(this),this.depthFunc=new Il(this),this.blend=new Oi(this),this.blendFunc=new $n(this),this.blendColor=new yl(this),this.blendEquation=new Kr(this),this.cullFace=new zd(this),this.cullFaceSide=new Ho(this),this.frontFace=new Do(this),this.program=new Dc(this),this.activeTexture=new fo(this),this.viewport=new W0(this),this.bindFramebuffer=new Wc(this),this.bindRenderbuffer=new hc(this),this.bindTexture=new h0(this),this.bindVertexBuffer=new qr(this),this.bindElementBuffer=new _e(this),this.bindVertexArray=new Oo(this),this.pixelStoreUnpack=new Ob(this),this.pixelStoreUnpackPremultiplyAlpha=new Z0(this),this.pixelStoreUnpackFlipY=new fc(this),this.extTextureFilterAnisotropic=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=e.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE),Hl(e)){this.HALF_FLOAT=e.HALF_FLOAT;let s=e.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(a=e.RGBA16F)!==null&&a!==void 0?a:s?.RGBA16F_EXT,this.RGB16F=(c=e.RGB16F)!==null&&c!==void 0?c:s?.RGB16F_EXT,e.getExtension("EXT_color_buffer_float")}else{e.getExtension("EXT_color_buffer_half_float"),e.getExtension("OES_texture_half_float_linear");let s=e.getExtension("OES_texture_half_float");this.HALF_FLOAT=s?.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(e,a){return new Mt(this,e,a)}createVertexBuffer(e,a,c){return new zt(this,e,a,c)}createRenderbuffer(e,a,c){let s=this.gl,W=s.createRenderbuffer();return this.bindRenderbuffer.set(W),s.renderbufferStorage(s.RENDERBUFFER,e,a,c),this.bindRenderbuffer.set(null),W}createFramebuffer(e,a,c,s){return new Po(this,e,a,c,s)}clear({color:e,depth:a,stencil:c}){let s=this.gl,W=0;e&&(W|=s.COLOR_BUFFER_BIT,this.clearColor.set(e),this.colorMask.set([!0,!0,!0,!0])),a!==void 0&&(W|=s.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(a),this.depthMask.set(!0)),c!==void 0&&(W|=s.STENCIL_BUFFER_BIT,this.clearStencil.set(c),this.stencilMask.set(255)),s.clear(W)}setCullFace(e){e.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(e.mode),this.frontFace.set(e.frontFace))}setDepthMode(e){e.func!==this.gl.ALWAYS||e.mask?(this.depthTest.set(!0),this.depthFunc.set(e.func),this.depthMask.set(e.mask),this.depthRange.set(e.range)):this.depthTest.set(!1)}setStencilMode(e){e.test.func!==this.gl.ALWAYS||e.mask?(this.stencilTest.set(!0),this.stencilMask.set(e.mask),this.stencilOp.set([e.fail,e.depthFail,e.pass]),this.stencilFunc.set({func:e.test.func,ref:e.ref,mask:e.test.mask})):this.stencilTest.set(!1)}setColorMode(e){o.bQ(e.blendFunction,mi.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(e.blendFunction),this.blendColor.set(e.blendColor)),this.colorMask.set(e.mask)}createVertexArray(){var e;return Hl(this.gl)?this.gl.createVertexArray():(e=this.gl.getExtension("OES_vertex_array_object"))===null||e===void 0?void 0:e.createVertexArrayOES()}deleteVertexArray(e){var a;return Hl(this.gl)?this.gl.deleteVertexArray(e):(a=this.gl.getExtension("OES_vertex_array_object"))===null||a===void 0?void 0:a.deleteVertexArrayOES(e)}unbindVAO(){this.bindVertexArray.set(null)}}let jd;function qo(m,e,a,c,s){let W=m.context,Z=m.transform,u=W.gl,G=m.useProgram("collisionBox"),U=[],X=0,Q=0;for(let et=0;et<c.length;et++){let nt=c[et],mt=e.getTile(nt).getBucket(a);if(!mt)continue;let at=s?mt.textCollisionBox:mt.iconCollisionBox,Wt=mt.collisionCircleArray;Wt.length>0&&(U.push({circleArray:Wt,circleOffset:Q,coord:nt}),X+=Wt.length/4,Q=X),at&&G.draw(W,u.LINES,Se.disabled,Ke.disabled,m.colorModeForRenderPass(),$e.disabled,Ac(m.transform),m.style.map.terrain&&m.style.map.terrain.getTerrainData(nt),Z.getProjectionData({overscaledTileID:nt,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),a.id,at.layoutVertexBuffer,at.indexBuffer,at.segments,null,m.transform.zoom,null,null,at.collisionVertexBuffer)}if(!s||!U.length)return;let k=m.useProgram("collisionCircle"),j=new o.c9;j.resize(4*X),j._trim();let H=0;for(let et of U)for(let nt=0;nt<et.circleArray.length/4;nt++){let mt=4*nt,at=et.circleArray[mt+0],Wt=et.circleArray[mt+1],Zt=et.circleArray[mt+2],ot=et.circleArray[mt+3];j.emplace(H++,at,Wt,Zt,ot,0),j.emplace(H++,at,Wt,Zt,ot,1),j.emplace(H++,at,Wt,Zt,ot,2),j.emplace(H++,at,Wt,Zt,ot,3)}(!jd||jd.length<2*X)&&(jd=(function(et){let nt=2*et,mt=new o.cb;mt.resize(nt),mt._trim();for(let at=0;at<nt;at++){let Wt=6*at;mt.uint16[Wt+0]=4*at+0,mt.uint16[Wt+1]=4*at+1,mt.uint16[Wt+2]=4*at+2,mt.uint16[Wt+3]=4*at+2,mt.uint16[Wt+4]=4*at+3,mt.uint16[Wt+5]=4*at+0}return mt})(X));let q=W.createIndexBuffer(jd,!0),$=W.createVertexBuffer(j,o.ca.members,!0);for(let et of U){let nt=ni(m.transform);k.draw(W,u.TRIANGLES,Se.disabled,Ke.disabled,m.colorModeForRenderPass(),$e.disabled,nt,m.style.map.terrain&&m.style.map.terrain.getTerrainData(et.coord),null,a.id,$,q,o.aW.simpleSegment(0,2*et.circleOffset,et.circleArray.length,et.circleArray.length/2),null,m.transform.zoom,null,null,null)}$.destroy(),q.destroy()}let V0=o.ar(new Float32Array(16));function $o(m,e,a,c,s,W){let{horizontalAlign:Z,verticalAlign:u}=o.aR(m);return new o.P((-(Z-.5)*e/s+c[0])*W,(-(u-.5)*a/s+c[1])*W)}function tr(m,e,a,c,s,W){let Z=e.tileAnchorPoint.add(new o.P(e.translation[0],e.translation[1]));if(e.pitchWithMap){let u=c.mult(W);a||(u=u.rotate(-s));let G=Z.add(u);return be(G.x,G.y,e.pitchedLabelPlaneMatrix,e.getElevation).point}if(a){let u=Ia(e.tileAnchorPoint.x+1,e.tileAnchorPoint.y,e).point.sub(m),G=Math.atan(u.y/u.x)+(u.x<0?Math.PI:0);return m.add(c.rotate(G))}return m.add(c)}function er(m,e,a,c,s,W,Z,u,G,U,X,Q){let k=m.text.placedSymbolArray,j=m.text.dynamicLayoutVertexArray,H=m.icon.dynamicLayoutVertexArray,q={};j.clear();for(let $=0;$<k.length;$++){let et=k.get($),nt=et.hidden||!et.crossTileID||m.allowVerticalPlacement&&!et.placedOrientation?null:c[et.crossTileID];if(nt){let mt=new o.P(et.anchorX,et.anchorY),at={getElevation:Q,width:s.width,height:s.height,pitchedLabelPlaneMatrix:W,pitchWithMap:a,transform:s,tileAnchorPoint:mt,translation:U,unwrappedTileID:X},Wt=a?fa(mt.x,mt.y,at):Ia(mt.x,mt.y,at),Zt=ue(s.cameraToCenterDistance,Wt.signedDistanceFromCamera),ot=o.az(m.textSizeData,u,et)*Zt/o.aL;a&&(ot*=m.tilePixelRatio/Z);let{width:Ft,height:Xt,anchor:It,textOffset:Ut,textBoxScale:xt}=nt,$t=$o(It,Ft,Xt,Ut,xt,ot),Pt=s.getPitchedTextCorrection(mt.x+U[0],mt.y+U[1],X),At=tr(Wt.point,at,e,$t,-s.bearingInRadians,Pt),se=m.allowVerticalPlacement&&et.placedOrientation===o.ay.vertical?Math.PI/2:0;for(let Ce=0;Ce<et.numGlyphs;Ce++)o.aF(j,At,se);G&&et.associatedIconIndex>=0&&(q[et.associatedIconIndex]={shiftedAnchor:At,angle:se})}else Oa(et.numGlyphs,j)}if(G){H.clear();let $=m.icon.placedSymbolArray;for(let et=0;et<$.length;et++){let nt=$.get(et);if(nt.hidden)Oa(nt.numGlyphs,H);else{let mt=q[et];if(mt)for(let at=0;at<nt.numGlyphs;at++)o.aF(H,mt.shiftedAnchor,mt.angle);else Oa(nt.numGlyphs,H)}}m.icon.dynamicLayoutVertexBuffer.updateData(H)}m.text.dynamicLayoutVertexBuffer.updateData(j)}function Zc(m,e,a){return a.iconsInText&&e?"symbolTextAndIcon":m?"symbolSDF":"symbolIcon"}function ir(m,e,a,c,s,W,Z,u,G,U,X,Q,k){let j=m.context,H=j.gl,q=m.transform,$=u==="map",et=G==="map",nt=u!=="viewport"&&a.layout.get("symbol-placement")!=="point",mt=$&&!et&&!nt,at=!a.layout.get("symbol-sort-key").isConstant(),Wt=!1,Zt=m.getDepthModeForSublayer(0,Se.ReadOnly),ot=a._unevaluatedLayout.hasValue("text-variable-anchor")||a._unevaluatedLayout.hasValue("text-variable-anchor-offset"),Ft=[],Xt=q.getCircleRadiusCorrection();for(let It of c){let Ut=e.getTile(It),xt=Ut.getBucket(a);if(!xt)continue;let $t=s?xt.text:xt.icon;if(!$t||!$t.segments.get().length||!$t.hasVisibleVertices)continue;let Pt=$t.programConfigurations.get(a.id),At=s||xt.sdfIcons,se=s?xt.textSizeData:xt.iconSizeData,Ce=et||q.pitch!==0,Je=m.useProgram(Zc(At,s,xt),Pt),Mi=o.ax(se,q.zoom),Yi=m.style.map.terrain&&m.style.map.terrain.getTerrainData(It),zi,Ni,pl,Bi,sl=[0,0],al=null;if(s)Ni=Ut.glyphAtlasTexture,pl=H.LINEAR,zi=Ut.glyphAtlasTexture.size,xt.iconsInText&&(sl=Ut.imageAtlasTexture.size,al=Ut.imageAtlasTexture,Bi=Ce||m.options.rotating||m.options.zooming||se.kind==="composite"||se.kind==="camera"?H.LINEAR:H.NEAREST);else{let Pi=a.layout.get("icon-size").constantOr(0)!==1||xt.iconsNeedLinear;Ni=Ut.imageAtlasTexture,pl=At||m.options.rotating||m.options.zooming||Pi||Ce?H.LINEAR:H.NEAREST,zi=Ut.imageAtlasTexture.size}let bl=o.aM(Ut,1,m.transform.zoom),Ja=tl($,m.transform,bl),ld=o.N();o.aA(ld,Ja);let Xn=Zi(et,$,m.transform,bl),Ud=o.aN(q,Ut,W,Z),Md=q.getProjectionData({overscaledTileID:It,applyGlobeMatrix:!k,applyTerrainMatrix:!0}),fd=ot&&xt.hasTextData(),ln=a.layout.get("icon-text-fit")!=="none"&&fd&&xt.hasIconData();if(nt){let Pi=m.style.map.terrain?(Vl,Ii)=>m.style.map.terrain.getElevation(It,Vl,Ii):null,ji=a.layout.get("text-rotation-alignment")==="map";zn(xt,m,s,Ja,ld,et,U,ji,It.toUnwrapped(),q.width,q.height,Ud,Pi)}let ad=s&&ot||ln,Ea=nt||ad?V0:et?Ja:m.transform.clipSpaceToPixelsMatrix,nd=At&&a.paint.get(s?"text-halo-width":"icon-halo-width").constantOr(1)!==0,Od;Od=At?xt.iconsInText?Hc(se.kind,Mi,mt,et,nt,ad,m,Ea,Xn,Ud,zi,sl,Xt):Ta(se.kind,Mi,mt,et,nt,ad,m,Ea,Xn,Ud,s,zi,0,Xt):qn(se.kind,Mi,mt,et,nt,ad,m,Ea,Xn,Ud,s,zi,Xt);let _d={program:Je,buffers:$t,uniformValues:Od,projectionData:Md,atlasTexture:Ni,atlasTextureIcon:al,atlasInterpolation:pl,atlasInterpolationIcon:Bi,isSDF:At,hasHalo:nd};if(at&&xt.canOverlap){Wt=!0;let Pi=$t.segments.get();for(let ji of Pi)Ft.push({segments:new o.aW([ji]),sortKey:ji.sortKey,state:_d,terrainData:Yi})}else Ft.push({segments:$t.segments,sortKey:0,state:_d,terrainData:Yi})}Wt&&Ft.sort(((It,Ut)=>It.sortKey-Ut.sortKey));for(let It of Ft){let Ut=It.state;if(j.activeTexture.set(H.TEXTURE0),Ut.atlasTexture.bind(Ut.atlasInterpolation,H.CLAMP_TO_EDGE),Ut.atlasTextureIcon&&(j.activeTexture.set(H.TEXTURE1),Ut.atlasTextureIcon&&Ut.atlasTextureIcon.bind(Ut.atlasInterpolationIcon,H.CLAMP_TO_EDGE)),Ut.isSDF){let xt=Ut.uniformValues;Ut.hasHalo&&(xt.u_is_halo=1,g0(Ut.buffers,It.segments,a,m,Ut.program,Zt,X,Q,xt,Ut.projectionData,It.terrainData)),xt.u_is_halo=0}g0(Ut.buffers,It.segments,a,m,Ut.program,Zt,X,Q,Ut.uniformValues,Ut.projectionData,It.terrainData)}}function g0(m,e,a,c,s,W,Z,u,G,U,X){let Q=c.context;s.draw(Q,Q.gl.TRIANGLES,W,Z,u,$e.backCCW,G,X,U,a.id,m.layoutVertexBuffer,m.indexBuffer,e,a.paint,c.transform.zoom,m.programConfigurations.get(a.id),m.dynamicLayoutVertexBuffer,m.opacityVertexBuffer)}function Oc(m,e,a,c,s){let W=m.context,Z=W.gl,u=Ke.disabled,G=new mi([Z.ONE,Z.ONE],o.bo.transparent,[!0,!0,!0,!0]),U=e.getBucket(a);if(!U)return;let X=c.key,Q=a.heatmapFbos.get(X);Q||(Q=ts(W,e.tileSize,e.tileSize),a.heatmapFbos.set(X,Q)),W.bindFramebuffer.set(Q.framebuffer),W.viewport.set([0,0,e.tileSize,e.tileSize]),W.clear({color:o.bo.transparent});let k=U.programConfigurations.get(a.id),j=m.useProgram("heatmap",k,!s),H=m.transform.getProjectionData({overscaledTileID:e.tileID,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),q=m.style.map.terrain.getTerrainData(c);j.draw(W,Z.TRIANGLES,Se.disabled,u,G,$e.disabled,pa(e,m.transform.zoom,a.paint.get("heatmap-intensity"),1),q,H,a.id,U.layoutVertexBuffer,U.indexBuffer,U.segments,a.paint,m.transform.zoom,k)}function Kb(m,e,a,c,s){let W=m.context,Z=W.gl,u=m.transform;W.setColorMode(m.colorModeForRenderPass());let G=_c(W,e),U=a.key,X=e.heatmapFbos.get(U);if(!X)return;W.activeTexture.set(Z.TEXTURE0),Z.bindTexture(Z.TEXTURE_2D,X.colorAttachment.get()),W.activeTexture.set(Z.TEXTURE1),G.bind(Z.LINEAR,Z.CLAMP_TO_EDGE);let Q=u.getProjectionData({overscaledTileID:a,applyTerrainMatrix:s,applyGlobeMatrix:!c});m.useProgram("heatmapTexture").draw(W,Z.TRIANGLES,Se.disabled,Ke.disabled,m.colorModeForRenderPass(),$e.disabled,Tn(m,e,0,1),null,Q,e.id,m.rasterBoundsBuffer,m.quadTriangleIndexBuffer,m.rasterBoundsSegments,e.paint,u.zoom),X.destroy(),e.heatmapFbos.delete(U)}function ts(m,e,a){var c,s;let W=m.gl,Z=W.createTexture();W.bindTexture(W.TEXTURE_2D,Z),W.texParameteri(W.TEXTURE_2D,W.TEXTURE_WRAP_S,W.CLAMP_TO_EDGE),W.texParameteri(W.TEXTURE_2D,W.TEXTURE_WRAP_T,W.CLAMP_TO_EDGE),W.texParameteri(W.TEXTURE_2D,W.TEXTURE_MIN_FILTER,W.LINEAR),W.texParameteri(W.TEXTURE_2D,W.TEXTURE_MAG_FILTER,W.LINEAR);let u=(c=m.HALF_FLOAT)!==null&&c!==void 0?c:W.UNSIGNED_BYTE,G=(s=m.RGBA16F)!==null&&s!==void 0?s:W.RGBA;W.texImage2D(W.TEXTURE_2D,0,G,e,a,0,W.RGBA,u,null);let U=m.createFramebuffer(e,a,!1,!1);return U.colorAttachment.set(Z),U}function _c(m,e){return e.colorRampTexture||(e.colorRampTexture=new o.T(m,e.colorRamp,m.gl.RGBA)),e.colorRampTexture}function lr(m,e,a,c,s,W,Z,u){let G=256;if(s.stepInterpolant){let U=e.getSource().maxzoom,X=Z.canonical.z===U?Math.ceil(1<<m.transform.maxZoom-Z.canonical.z):1;G=o.an(o.cd(W.maxLineLength/o.a4*1024*X),256,a.maxTextureSize)}return u.gradient=o.ce({expression:s.gradientExpression(),evaluationKey:"lineProgress",resolution:G,image:u.gradient||void 0,clips:W.lineClipsArray}),u.texture?u.texture.update(u.gradient):u.texture=new o.T(a,u.gradient,c.RGBA),u.version=s.gradientVersion,u.texture}function u0(m,e,a,c,s){m.activeTexture.set(e.TEXTURE0),a.imageAtlasTexture.bind(e.LINEAR,e.CLAMP_TO_EDGE),c.updatePaintBuffers(s)}function R0(m,e,a,c,s,W){(s||m.lineAtlas.dirty)&&(e.activeTexture.set(a.TEXTURE0),m.lineAtlas.bind(e)),c.updatePaintBuffers(W)}function ar(m,e,a,c,s,W,Z){let u=W.gradients[s.id],G=u.texture;s.gradientVersion!==u.version&&(G=lr(m,e,a,c,s,W,Z,u)),a.activeTexture.set(c.TEXTURE0),G.bind(s.stepInterpolant?c.NEAREST:c.LINEAR,c.CLAMP_TO_EDGE)}function es(m,e,a,c,s,W,Z,u,G){let U=W.gradients[s.id],X=U.texture;s.gradientVersion!==U.version&&(X=lr(m,e,a,c,s,W,Z,U)),a.activeTexture.set(c.TEXTURE0),X.bind(s.stepInterpolant?c.NEAREST:c.LINEAR,c.CLAMP_TO_EDGE),a.activeTexture.set(c.TEXTURE1),m.lineAtlas.bind(a),u.updatePaintBuffers(G)}function F0(m,e,a,c,s){if(!a||!c||!c.imageAtlas)return;let W=c.imageAtlas.patternPositions,Z=W[a.to.toString()],u=W[a.from.toString()];if(!Z&&u&&(Z=u),!u&&Z&&(u=Z),!Z||!u){let G=s.getPaintProperty(e);Z=W[G],u=W[G]}Z&&u&&m.setConstantPatternPositions(Z,u)}function is(m,e,a,c,s,W,Z,u){let G=m.context.gl,U="fill-pattern",X=a.paint.get(U),Q=X&&X.constantOr(1),k=a.getCrossfadeParameters(),j,H,q,$,et,nt=m.transform,mt=a.paint.get("fill-translate"),at=a.paint.get("fill-translate-anchor");Z?(H=Q&&!a.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",j=G.LINES):(H=Q?"fillPattern":"fill",j=G.TRIANGLES);let Wt=X.constantOr(null);for(let Zt of c){let ot=e.getTile(Zt);if(Q&&!ot.patternsLoaded())continue;let Ft=ot.getBucket(a);if(!Ft)continue;let Xt=Ft.programConfigurations.get(a.id),It=m.useProgram(H,Xt),Ut=m.style.map.terrain&&m.style.map.terrain.getTerrainData(Zt);Q&&(m.context.activeTexture.set(G.TEXTURE0),ot.imageAtlasTexture.bind(G.LINEAR,G.CLAMP_TO_EDGE),Xt.updatePaintBuffers(k)),F0(Xt,U,Wt,ot,a);let xt=nt.getProjectionData({overscaledTileID:Zt,applyGlobeMatrix:!u,applyTerrainMatrix:!0}),$t=o.aN(nt,ot,mt,at);if(Z){$=Ft.indexBuffer2,et=Ft.segments2;let At=[G.drawingBufferWidth,G.drawingBufferHeight];q=H==="fillOutlinePattern"&&Q?Pr(m,k,ot,At,$t):$a(At,$t)}else $=Ft.indexBuffer,et=Ft.segments,q=Q?qa(m,k,ot,$t):{u_fill_translate:$t};let Pt=m.stencilModeForClipping(Zt);It.draw(m.context,j,s,Pt,W,$e.backCCW,q,Ut,xt,a.id,Ft.layoutVertexBuffer,$,et,a.paint,m.transform.zoom,Xt)}}function Ei(m,e,a,c,s,W,Z,u){let G=m.context,U=G.gl,X="fill-extrusion-pattern",Q=a.paint.get(X),k=Q.constantOr(1),j=a.getCrossfadeParameters(),H=a.paint.get("fill-extrusion-opacity"),q=Q.constantOr(null),$=m.transform;for(let et of c){let nt=e.getTile(et),mt=nt.getBucket(a);if(!mt)continue;let at=m.style.map.terrain&&m.style.map.terrain.getTerrainData(et),Wt=mt.programConfigurations.get(a.id),Zt=m.useProgram(k?"fillExtrusionPattern":"fillExtrusion",Wt);k&&(m.context.activeTexture.set(U.TEXTURE0),nt.imageAtlasTexture.bind(U.LINEAR,U.CLAMP_TO_EDGE),Wt.updatePaintBuffers(j));let ot=$.getProjectionData({overscaledTileID:et,applyGlobeMatrix:!u,applyTerrainMatrix:!0});F0(Wt,X,q,nt,a);let Ft=o.aN($,nt,a.paint.get("fill-extrusion-translate"),a.paint.get("fill-extrusion-translate-anchor")),Xt=a.paint.get("fill-extrusion-vertical-gradient"),It=k?xn(m,Xt,H,Ft,et,j,nt):Za(m,Xt,H,Ft);Zt.draw(G,G.gl.TRIANGLES,s,W,Z,$e.backCCW,It,at,ot,a.id,mt.layoutVertexBuffer,mt.indexBuffer,mt.segments,a.paint,m.transform.zoom,Wt,m.style.map.terrain&&mt.centroidVertexBuffer)}}function td(m,e,a,c,s,W,Z,u,G){var U;let X=m.style.projection,Q=m.context,k=m.transform,j=Q.gl,H=[`#define NUM_ILLUMINATION_SOURCES ${a.paint.get("hillshade-highlight-color").values.length}`],q=m.useProgram("hillshade",null,!1,H),$=!m.options.moving;for(let et of c){let nt=e.getTile(et),mt=nt.fbo;if(!mt)continue;let at=X.getMeshFromTileID(Q,et.canonical,u,!0,"raster"),Wt=(U=m.style.map.terrain)===null||U===void 0?void 0:U.getTerrainData(et);Q.activeTexture.set(j.TEXTURE0),j.bindTexture(j.TEXTURE_2D,mt.colorAttachment.get());let Zt=k.getProjectionData({overscaledTileID:et,aligned:$,applyGlobeMatrix:!G,applyTerrainMatrix:!0});q.draw(Q,j.TRIANGLES,W,s[et.overscaledZ],Z,$e.backCCW,Pn(m,nt,a),Wt,Zt,a.id,at.vertexBuffer,at.indexBuffer,at.segments)}}function Xa(m,e,a,c,s,W,Z,u,G){var U;let X=m.style.projection,Q=m.context,k=m.transform,j=Q.gl,H=m.useProgram("colorRelief"),q=!m.options.moving,$=!0,et=0;for(let nt of c){let mt=e.getTile(nt),at=mt.dem;if($){let It=j.getParameter(j.MAX_TEXTURE_SIZE),{elevationTexture:Ut,colorTexture:xt}=a.getColorRampTextures(Q,It,at.getUnpackVector());Q.activeTexture.set(j.TEXTURE1),Ut.bind(j.NEAREST,j.CLAMP_TO_EDGE),Q.activeTexture.set(j.TEXTURE4),xt.bind(j.LINEAR,j.CLAMP_TO_EDGE),$=!1,et=Ut.size[0]}if(!at||!at.data)continue;let Wt=at.stride,Zt=at.getPixels();if(Q.activeTexture.set(j.TEXTURE0),Q.pixelStoreUnpackPremultiplyAlpha.set(!1),mt.demTexture=mt.demTexture||m.getTileTexture(Wt),mt.demTexture){let It=mt.demTexture;It.update(Zt,{premultiply:!1}),It.bind(j.LINEAR,j.CLAMP_TO_EDGE)}else mt.demTexture=new o.T(Q,Zt,j.RGBA,{premultiply:!1}),mt.demTexture.bind(j.LINEAR,j.CLAMP_TO_EDGE);let ot=X.getMeshFromTileID(Q,nt.canonical,u,!0,"raster"),Ft=(U=m.style.map.terrain)===null||U===void 0?void 0:U.getTerrainData(nt),Xt=k.getProjectionData({overscaledTileID:nt,aligned:q,applyGlobeMatrix:!G,applyTerrainMatrix:!0});H.draw(Q,j.TRIANGLES,W,s[nt.overscaledZ],Z,$e.backCCW,La(a,mt.dem,et),Ft,Xt,a.id,ot.vertexBuffer,ot.indexBuffer,ot.segments)}}let Pc=[new o.P(0,0),new o.P(o.a4,0),new o.P(o.a4,o.a4),new o.P(0,o.a4)];function Ad(m,e,a,c,s,W,Z,u,G=!1,U=!1){let X=c[c.length-1].overscaledZ,Q=m.context,k=Q.gl,j=m.useProgram("raster"),H=m.transform,q=m.style.projection,$=m.colorModeForRenderPass(),et=!m.options.moving,nt=a.paint.get("raster-opacity"),mt=a.paint.get("raster-resampling"),at=a.paint.get("raster-fade-duration"),Wt=!!m.style.map.terrain;for(let Zt of c){let ot=m.getDepthModeForSublayer(Zt.overscaledZ-X,nt===1?Se.ReadWrite:Se.ReadOnly,k.LESS),Ft=e.getTile(Zt),Xt=mt==="nearest"?k.NEAREST:k.LINEAR;Q.activeTexture.set(k.TEXTURE0),Ft.texture.bind(Xt,k.CLAMP_TO_EDGE,k.LINEAR_MIPMAP_NEAREST),Q.activeTexture.set(k.TEXTURE1);let{parentTile:It,parentScaleBy:Ut,parentTopLeft:xt,fadeValues:$t}=G0(Ft,e,at,Wt);Ft.fadeOpacity=$t.tileOpacity,It?(It.fadeOpacity=$t.parentTileOpacity,It.texture.bind(Xt,k.CLAMP_TO_EDGE,k.LINEAR_MIPMAP_NEAREST)):Ft.texture.bind(Xt,k.CLAMP_TO_EDGE,k.LINEAR_MIPMAP_NEAREST),Ft.texture.useMipmap&&Q.extTextureFilterAnisotropic&&m.transform.pitch>20&&k.texParameterf(k.TEXTURE_2D,Q.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,Q.extTextureFilterAnisotropicMax);let Pt=m.style.map.terrain&&m.style.map.terrain.getTerrainData(Zt),At=H.getProjectionData({overscaledTileID:Zt,aligned:et,applyGlobeMatrix:!U,applyTerrainMatrix:!0}),se=vc(xt,Ut,$t.fadeMix,a,u),Ce=q.getMeshFromTileID(Q,Zt.canonical,W,Z,"raster");j.draw(Q,k.TRIANGLES,ot,s?s[Zt.overscaledZ]:Ke.disabled,$,G?$e.frontCCW:$e.backCCW,se,Pt,At,a.id,Ce.vertexBuffer,Ce.indexBuffer,Ce.segments)}}function G0(m,e,a,c){let s={parentTile:null,parentScaleBy:1,parentTopLeft:[0,0],fadeValues:{tileOpacity:1,parentTileOpacity:1,fadeMix:{opacity:1,mix:0}}};if(a===0||c)return s;if(m.fadingParentID){let W=e.getLoadedTile(m.fadingParentID);if(!W)return s;let Z=Math.pow(2,W.tileID.overscaledZ-m.tileID.overscaledZ),u=[m.tileID.canonical.x*Z%1,m.tileID.canonical.y*Z%1],G=(function(U,X,Q){let k=jt(),j=(k-X.timeAdded)/Q,H=U.fadingDirection===ht.Incoming,q=o.an((k-U.timeAdded)/Q,0,1),$=o.an(1-j,0,1),et=H?q:$;return{tileOpacity:et,parentTileOpacity:H?$:q,fadeMix:{opacity:1,mix:1-et}}})(m,W,a);return{parentTile:W,parentScaleBy:Z,parentTopLeft:u,fadeValues:G}}if(m.selfFading){let W=(function(Z,u){let G=(jt()-Z.timeAdded)/u,U=o.an(G,0,1);return{tileOpacity:U,fadeMix:{opacity:U,mix:0}}})(m,a);return{parentTile:null,parentScaleBy:1,parentTopLeft:[0,0],fadeValues:W}}return s}let pc=new o.bo(1,0,0,1),ls=new o.bo(0,1,0,1),Kc=new o.bo(0,0,1,1),as=new o.bo(1,0,1,1),N0=new o.bo(0,1,1,1);function ns(m,e,a,c){qc(m,0,e+a/2,m.transform.width,a,c)}function ds(m,e,a,c){qc(m,e-a/2,0,a,m.transform.height,c)}function qc(m,e,a,c,s,W){let Z=m.context,u=Z.gl;u.enable(u.SCISSOR_TEST),u.scissor(e*m.pixelRatio,a*m.pixelRatio,c*m.pixelRatio,s*m.pixelRatio),Z.clear({color:W}),u.disable(u.SCISSOR_TEST)}function I0(m,e,a){let c=m.context,s=c.gl,W=m.useProgram("debug"),Z=Se.disabled,u=Ke.disabled,G=m.colorModeForRenderPass(),U="$debug",X=m.style.map.terrain&&m.style.map.terrain.getTerrainData(a);c.activeTexture.set(s.TEXTURE0);let Q=e.getTileByID(a.key).latestRawTileData,k=Math.floor((Q&&Q.byteLength||0)/1024),j=e.getTile(a).tileSize,H=512/Math.min(j,512)*(a.overscaledZ/m.transform.zoom)*.5,q=a.canonical.toString();a.overscaledZ!==a.canonical.z&&(q+=` => ${a.overscaledZ}`),(function(et,nt){et.initDebugOverlayCanvas();let mt=et.debugOverlayCanvas,at=et.context.gl,Wt=et.debugOverlayCanvas.getContext("2d");Wt.clearRect(0,0,mt.width,mt.height),Wt.shadowColor="white",Wt.shadowBlur=2,Wt.lineWidth=1.5,Wt.strokeStyle="white",Wt.textBaseline="top",Wt.font="bold 36px Open Sans, sans-serif",Wt.fillText(nt,5,5),Wt.strokeText(nt,5,5),et.debugOverlayTexture.update(mt),et.debugOverlayTexture.bind(at.LINEAR,at.CLAMP_TO_EDGE)})(m,`${q} ${k}kB`);let $=m.transform.getProjectionData({overscaledTileID:a,applyGlobeMatrix:!0,applyTerrainMatrix:!0});W.draw(c,s.TRIANGLES,Z,u,mi.alphaBlended,$e.disabled,Fd(o.bo.transparent,H),null,$,U,m.debugBuffer,m.quadTriangleIndexBuffer,m.debugSegments),W.draw(c,s.LINE_STRIP,Z,u,G,$e.disabled,Fd(o.bo.red),X,$,U,m.debugBuffer,m.tileBorderIndexBuffer,m.debugSegments)}function Nd(m,e,a,c){let{isRenderingGlobe:s}=c,W=m.context,Z=W.gl,u=m.transform,G=m.colorModeForRenderPass(),U=m.getDepthModeFor3D(),X=m.useProgram("terrain");W.bindFramebuffer.set(null),W.viewport.set([0,0,m.width,m.height]);for(let Q of a){let k=e.getTerrainMesh(Q.tileID),j=m.renderToTexture.getTexture(Q),H=e.getTerrainData(Q.tileID);W.activeTexture.set(Z.TEXTURE0),Z.bindTexture(Z.TEXTURE_2D,j.texture);let q=e.getMeshFrameDelta(u.zoom),$=u.calculateFogMatrix(Q.tileID.toUnwrapped()),et=Ma(q,$,m.style.sky,u.pitch,s),nt=u.getProjectionData({overscaledTileID:Q.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});X.draw(W,Z.TRIANGLES,U,Ke.disabled,G,$e.backCCW,et,H,nt,"terrain",k.vertexBuffer,k.indexBuffer,k.segments)}}function cs(m,e){if(!e.mesh){let a=new o.aV;a.emplaceBack(-1,-1),a.emplaceBack(1,-1),a.emplaceBack(1,1),a.emplaceBack(-1,1);let c=new o.aX;c.emplaceBack(0,1,2),c.emplaceBack(0,2,3),e.mesh=new rn(m.createVertexBuffer(a,fi.members),m.createIndexBuffer(c),o.aW.simpleSegment(0,0,a.length,c.length))}return e.mesh}class U0{constructor(e,a){this.context=new Ko(e),this.transform=a,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:o.ar(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=Ae.maxOverzooming+Ae.maxUnderzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new On}resize(e,a,c){if(this.width=Math.floor(e*c),this.height=Math.floor(a*c),this.pixelRatio=c,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(let s of this.style._order)this.style._layers[s].resize()}setup(){let e=this.context,a=new o.aV;a.emplaceBack(0,0),a.emplaceBack(o.a4,0),a.emplaceBack(0,o.a4),a.emplaceBack(o.a4,o.a4),this.tileExtentBuffer=e.createVertexBuffer(a,fi.members),this.tileExtentSegments=o.aW.simpleSegment(0,0,4,2);let c=new o.aV;c.emplaceBack(0,0),c.emplaceBack(o.a4,0),c.emplaceBack(0,o.a4),c.emplaceBack(o.a4,o.a4),this.debugBuffer=e.createVertexBuffer(c,fi.members),this.debugSegments=o.aW.simpleSegment(0,0,4,5);let s=new o.cg;s.emplaceBack(0,0,0,0),s.emplaceBack(o.a4,0,o.a4,0),s.emplaceBack(0,o.a4,0,o.a4),s.emplaceBack(o.a4,o.a4,o.a4,o.a4),this.rasterBoundsBuffer=e.createVertexBuffer(s,ea.members),this.rasterBoundsSegments=o.aW.simpleSegment(0,0,4,2);let W=new o.aV;W.emplaceBack(0,0),W.emplaceBack(o.a4,0),W.emplaceBack(0,o.a4),W.emplaceBack(o.a4,o.a4),this.rasterBoundsBufferPosOnly=e.createVertexBuffer(W,fi.members),this.rasterBoundsSegmentsPosOnly=o.aW.simpleSegment(0,0,4,5);let Z=new o.aV;Z.emplaceBack(0,0),Z.emplaceBack(1,0),Z.emplaceBack(0,1),Z.emplaceBack(1,1),this.viewportBuffer=e.createVertexBuffer(Z,fi.members),this.viewportSegments=o.aW.simpleSegment(0,0,4,2);let u=new o.ch;u.emplaceBack(0),u.emplaceBack(1),u.emplaceBack(3),u.emplaceBack(2),u.emplaceBack(0),this.tileBorderIndexBuffer=e.createIndexBuffer(u);let G=new o.aX;G.emplaceBack(1,0,2),G.emplaceBack(1,2,3),this.quadTriangleIndexBuffer=e.createIndexBuffer(G);let U=this.context.gl;this.stencilClearMode=new Ke({func:U.ALWAYS,mask:0},0,255,U.ZERO,U.ZERO,U.ZERO),this.tileExtentMesh=new rn(this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}clearStencil(){let e=this.context,a=e.gl;this.nextStencilID=1,this.currentStencilSource=void 0;let c=o.N();o.c6(c,0,this.width,this.height,0,0,1),o.Q(c,c,[a.drawingBufferWidth,a.drawingBufferHeight,0]);let s={mainMatrix:c,tileMercatorCoords:[0,0,1,1],clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:c};this.useProgram("clippingMask",null,!0).draw(e,a.TRIANGLES,Se.disabled,this.stencilClearMode,mi.disabled,$e.disabled,null,null,s,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(e,a,c){if(this.currentStencilSource===e.source||!e.isTileClipped()||!a||!a.length)return;this.currentStencilSource=e.source,this.nextStencilID+a.length>256&&this.clearStencil();let s=this.context;s.setColorMode(mi.disabled),s.setDepthMode(Se.disabled);let W={};for(let Z of a)W[Z.key]=this.nextStencilID++;this._renderTileMasks(W,a,c,!0),this._renderTileMasks(W,a,c,!1),this._tileClippingMaskIDs=W}_renderTileMasks(e,a,c,s){let W=this.context,Z=W.gl,u=this.style.projection,G=this.transform,U=this.useProgram("clippingMask");for(let X of a){let Q=e[X.key],k=this.style.map.terrain&&this.style.map.terrain.getTerrainData(X),j=u.getMeshFromTileID(this.context,X.canonical,s,!0,"stencil"),H=G.getProjectionData({overscaledTileID:X,applyGlobeMatrix:!c,applyTerrainMatrix:!0});U.draw(W,Z.TRIANGLES,Se.disabled,new Ke({func:Z.ALWAYS,mask:0},Q,255,Z.KEEP,Z.KEEP,Z.REPLACE),mi.disabled,c?$e.disabled:$e.backCCW,null,k,H,"$clipping",j.vertexBuffer,j.indexBuffer,j.segments)}}_renderTilesDepthBuffer(){let e=this.context,a=e.gl,c=this.style.projection,s=this.transform,W=this.useProgram("depth"),Z=this.getDepthModeFor3D(),u=Be(s,{tileSize:s.tileSize});for(let G of u){let U=this.style.map.terrain&&this.style.map.terrain.getTerrainData(G),X=c.getMeshFromTileID(this.context,G.canonical,!0,!0,"raster"),Q=s.getProjectionData({overscaledTileID:G,applyGlobeMatrix:!0,applyTerrainMatrix:!0});W.draw(e,a.TRIANGLES,Z,Ke.disabled,mi.disabled,$e.backCCW,null,U,Q,"$clipping",X.vertexBuffer,X.indexBuffer,X.segments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();let e=this.nextStencilID++,a=this.context.gl;return new Ke({func:a.NOTEQUAL,mask:255},e,255,a.KEEP,a.KEEP,a.REPLACE)}stencilModeForClipping(e){let a=this.context.gl;return new Ke({func:a.EQUAL,mask:255},this._tileClippingMaskIDs[e.key],0,a.KEEP,a.KEEP,a.REPLACE)}getStencilConfigForOverlapAndUpdateStencilID(e){let a=this.context.gl,c=e.sort(((Z,u)=>u.overscaledZ-Z.overscaledZ)),s=c[c.length-1].overscaledZ,W=c[0].overscaledZ-s+1;if(W>1){this.currentStencilSource=void 0,this.nextStencilID+W>256&&this.clearStencil();let Z={};for(let u=0;u<W;u++)Z[u+s]=new Ke({func:a.GEQUAL,mask:255},u+this.nextStencilID,255,a.KEEP,a.KEEP,a.REPLACE);return this.nextStencilID+=W,[Z,c]}return[{[s]:Ke.disabled},c]}stencilConfigForOverlapTwoPass(e){let a=this.context.gl,c=e.sort(((Z,u)=>u.overscaledZ-Z.overscaledZ)),s=c[c.length-1].overscaledZ,W=c[0].overscaledZ-s+1;if(this.clearStencil(),W>1){let Z={},u={};for(let G=0;G<W;G++)Z[G+s]=new Ke({func:a.GREATER,mask:255},W+1+G,255,a.KEEP,a.KEEP,a.REPLACE),u[G+s]=new Ke({func:a.GREATER,mask:255},1+G,255,a.KEEP,a.KEEP,a.REPLACE);return this.nextStencilID=2*W+1,[Z,u,c]}return this.nextStencilID=3,[{[s]:new Ke({func:a.GREATER,mask:255},2,255,a.KEEP,a.KEEP,a.REPLACE)},{[s]:new Ke({func:a.GREATER,mask:255},1,255,a.KEEP,a.KEEP,a.REPLACE)},c]}colorModeForRenderPass(){let e=this.context.gl;return this._showOverdrawInspector?new mi([e.CONSTANT_COLOR,e.ONE],new o.bo(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?mi.unblended:mi.alphaBlended}getDepthModeForSublayer(e,a,c){if(!this.opaquePassEnabledForLayer())return Se.disabled;let s=1-((1+this.currentLayer)*this.numSublayers+e)*this.depthEpsilon;return new Se(c||this.context.gl.LEQUAL,a,[s,s])}getDepthModeFor3D(){return new Se(this.context.gl.LEQUAL,Se.ReadWrite,this.depthRangeFor3D)}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(e,a){var c,s;this.style=e,this.options=a,this.lineAtlas=e.lineAtlas,this.imageManager=e.imageManager,this.glyphManager=e.glyphManager,this.symbolFadeChange=e.placement.symbolFadeChange(jt()),this.imageManager.beginFrame();let W=this.style._order,Z=this.style.tileManagers,u={},G={},U={},X={isRenderingToTexture:!1,isRenderingGlobe:((c=e.projection)===null||c===void 0?void 0:c.transitionState)>0};for(let k in Z){let j=Z[k];j.used&&j.prepare(this.context),u[k]=j.getVisibleCoordinates(!1),G[k]=u[k].slice().reverse(),U[k]=j.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let k=0;k<W.length;k++)if(this.style._layers[W[k]].is3D()){this.opaquePassCutoff=k;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(let k of W){let j=this.style._layers[k];if(!j.hasOffscreenPass()||j.isHidden(this.transform.zoom))continue;let H=G[j.source];(j.type==="custom"||H.length)&&this.renderLayer(this,Z[j.source],j,H,X)}if((s=this.style.projection)===null||s===void 0||s.updateGPUdependent({context:this.context,useProgram:k=>this.useProgram(k)}),this.context.viewport.set([0,0,this.width,this.height]),this.context.bindFramebuffer.set(null),this.context.clear({color:a.showOverdrawInspector?o.bo.black:o.bo.transparent,depth:1}),this.clearStencil(),this.style.sky&&(function(k,j){let H=k.context,q=H.gl,$=((Zt,ot,Ft)=>{let Xt=Math.cos(ot.rollInRadians),It=Math.sin(ot.rollInRadians),Ut=Nt(ot),xt=ot.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}).projectionTransition;return{u_sky_color:Zt.properties.get("sky-color"),u_horizon_color:Zt.properties.get("horizon-color"),u_horizon:[(ot.width/2-Ut*It)*Ft,(ot.height/2+Ut*Xt)*Ft],u_horizon_normal:[-It,Xt],u_sky_horizon_blend:Zt.properties.get("sky-horizon-blend")*ot.height/2*Ft,u_sky_blend:xt}})(j,k.style.map.transform,k.pixelRatio),et=new Se(q.LEQUAL,Se.ReadWrite,[0,1]),nt=Ke.disabled,mt=k.colorModeForRenderPass(),at=k.useProgram("sky"),Wt=cs(H,j);at.draw(H,q.TRIANGLES,et,nt,mt,$e.disabled,$,null,void 0,"sky",Wt.vertexBuffer,Wt.indexBuffer,Wt.segments)})(this,this.style.sky),this._showOverdrawInspector=a.showOverdrawInspector,this.depthRangeFor3D=[0,1-(e._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=W.length-1;this.currentLayer>=0;this.currentLayer--){let k=this.style._layers[W[this.currentLayer]],j=Z[k.source],H=u[k.source];this._renderTileClippingMasks(k,H,!1),this.renderLayer(this,j,k,H,X)}this.renderPass="translucent";let Q=!1;for(this.currentLayer=0;this.currentLayer<W.length;this.currentLayer++){let k=this.style._layers[W[this.currentLayer]],j=Z[k.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(k,X))continue;this.opaquePassEnabledForLayer()||Q||(Q=!0,X.isRenderingGlobe&&!this.style.map.terrain&&this._renderTilesDepthBuffer());let H=(k.type==="symbol"?U:G)[k.source];this._renderTileClippingMasks(k,u[k.source],!!this.renderToTexture),this.renderLayer(this,j,k,H,X)}if(X.isRenderingGlobe&&(function(k,j,H){let q=k.context,$=q.gl,et=k.useProgram("atmosphere"),nt=new Se($.LEQUAL,Se.ReadOnly,[0,1]),mt=k.transform,at=(function(xt,$t){let Pt=xt.properties.get("position"),At=[-Pt.x,-Pt.y,-Pt.z],se=o.ar(new Float64Array(16));return xt.properties.get("anchor")==="map"&&(o.bf(se,se,$t.rollInRadians),o.bg(se,se,-$t.pitchInRadians),o.bf(se,se,$t.bearingInRadians),o.bg(se,se,$t.center.lat*Math.PI/180),o.bI(se,se,-$t.center.lng*Math.PI/180)),o.cf(At,At,se),At})(H,k.transform),Wt=mt.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),Zt=j.properties.get("atmosphere-blend")*Wt.projectionTransition;if(Zt===0)return;let ot=A(mt.worldSize,mt.center.lat),Ft=mt.inverseProjectionMatrix,Xt=new Float64Array(4);Xt[3]=1,o.aG(Xt,Xt,mt.modelViewProjectionMatrix),Xt[0]/=Xt[3],Xt[1]/=Xt[3],Xt[2]/=Xt[3],Xt[3]=1,o.aG(Xt,Xt,Ft),Xt[0]/=Xt[3],Xt[1]/=Xt[3],Xt[2]/=Xt[3],Xt[3]=1;let It=((xt,$t,Pt,At,se)=>({u_sun_pos:xt,u_atmosphere_blend:$t,u_globe_position:Pt,u_globe_radius:At,u_inv_proj_matrix:se}))(at,Zt,[Xt[0],Xt[1],Xt[2]],ot,Ft),Ut=cs(q,j);et.draw(q,$.TRIANGLES,nt,Ke.disabled,mi.alphaBlended,$e.disabled,It,null,null,"atmosphere",Ut.vertexBuffer,Ut.indexBuffer,Ut.segments)})(this,this.style.sky,this.style.light),this.options.showTileBoundaries){let k=(function(j,H){let q=null,$=Object.values(j._layers).flatMap((at=>at.source&&!at.isHidden(H)?[j.tileManagers[at.source]]:[])),et=$.filter((at=>at.getSource().type==="vector")),nt=$.filter((at=>at.getSource().type!=="vector")),mt=at=>{(!q||q.getSource().maxzoom<at.getSource().maxzoom)&&(q=at)};return et.forEach((at=>mt(at))),q||nt.forEach((at=>mt(at))),q})(this.style,this.transform.zoom);k&&(function(j,H,q){for(let $=0;$<q.length;$++)I0(j,H,q[$])})(this,k,k.getVisibleCoordinates())}this.options.showPadding&&(function(k){let j=k.transform.padding;ns(k,k.transform.height-(j.top||0),3,pc),ns(k,j.bottom||0,3,ls),ds(k,j.left||0,3,Kc),ds(k,k.transform.width-(j.right||0),3,as);let H=k.transform.centerPoint;(function(q,$,et,nt){qc(q,$-1,et-10,2,20,nt),qc(q,$-10,et-1,20,2,nt)})(k,H.x,k.transform.height-H.y,N0)})(this),this.context.setDefault()}maybeDrawDepthAndCoords(e){if(!this.style||!this.style.map||!this.style.map.terrain)return;let a=this.terrainFacilitator.matrix,c=this.transform.modelViewProjectionMatrix,s=this.terrainFacilitator.dirty;s||(s=e?!o.ci(a,c):!o.cj(a,c)),s||(s=this.style.map.terrain.tileManager.anyTilesAfterTime(this.terrainFacilitator.renderTime)),s&&(o.ck(a,c),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,(function(W,Z){let u=W.context,G=u.gl,U=W.transform,X=mi.unblended,Q=new Se(G.LEQUAL,Se.ReadWrite,[0,1]),k=Z.tileManager.getRenderableTiles(),j=W.useProgram("terrainDepth");u.bindFramebuffer.set(Z.getFramebuffer("depth").framebuffer),u.viewport.set([0,0,W.width/devicePixelRatio,W.height/devicePixelRatio]),u.clear({color:o.bo.transparent,depth:1});for(let H of k){let q=Z.getTerrainMesh(H.tileID),$=Z.getTerrainData(H.tileID),et=U.getProjectionData({overscaledTileID:H.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0}),nt={u_ele_delta:Z.getMeshFrameDelta(U.zoom)};j.draw(u,G.TRIANGLES,Q,Ke.disabled,X,$e.backCCW,nt,$,et,"terrain",q.vertexBuffer,q.indexBuffer,q.segments)}u.bindFramebuffer.set(null),u.viewport.set([0,0,W.width,W.height])})(this,this.style.map.terrain),(function(W,Z){let u=W.context,G=u.gl,U=W.transform,X=mi.unblended,Q=new Se(G.LEQUAL,Se.ReadWrite,[0,1]),k=Z.getCoordsTexture(),j=Z.tileManager.getRenderableTiles(),H=W.useProgram("terrainCoords");u.bindFramebuffer.set(Z.getFramebuffer("coords").framebuffer),u.viewport.set([0,0,W.width/devicePixelRatio,W.height/devicePixelRatio]),u.clear({color:o.bo.transparent,depth:1}),Z.coordsIndex=[];for(let q of j){let $=Z.getTerrainMesh(q.tileID),et=Z.getTerrainData(q.tileID);u.activeTexture.set(G.TEXTURE0),G.bindTexture(G.TEXTURE_2D,k.texture);let nt={u_terrain_coords_id:(255-Z.coordsIndex.length)/255,u_texture:0,u_ele_delta:Z.getMeshFrameDelta(U.zoom)},mt=U.getProjectionData({overscaledTileID:q.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});H.draw(u,G.TRIANGLES,Q,Ke.disabled,X,$e.backCCW,nt,et,mt,"terrain",$.vertexBuffer,$.indexBuffer,$.segments),Z.coordsIndex.push(q.tileID.key)}u.bindFramebuffer.set(null),u.viewport.set([0,0,W.width,W.height])})(this,this.style.map.terrain))}renderLayer(e,a,c,s,W){c.isHidden(this.transform.zoom)||(c.type==="background"||c.type==="custom"||(s||[]).length)&&(this.id=c.id,o.cl(c)?(function(Z,u,G,U,X,Q){if(Z.renderPass!=="translucent")return;let{isRenderingToTexture:k}=Q,j=Ke.disabled,H=Z.colorModeForRenderPass();(G._unevaluatedLayout.hasValue("text-variable-anchor")||G._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&(function(q,$,et,nt,mt,at,Wt,Zt,ot){let Ft=$.transform,Xt=$.style.map.terrain,It=mt==="map",Ut=at==="map";for(let xt of q){let $t=nt.getTile(xt),Pt=$t.getBucket(et);if(!Pt||!Pt.text||!Pt.text.segments.get().length)continue;let At=o.ax(Pt.textSizeData,Ft.zoom),se=o.aM($t,1,$.transform.zoom),Ce=tl(It,$.transform,se),Je=et.layout.get("icon-text-fit")!=="none"&&Pt.hasIconData();if(At){let Mi=Math.pow(2,Ft.zoom-$t.tileID.overscaledZ),Yi=Xt?(zi,Ni)=>Xt.getElevation(xt,zi,Ni):null;er(Pt,It,Ut,ot,Ft,Ce,Mi,At,Je,o.aN(Ft,$t,Wt,Zt),xt.toUnwrapped(),Yi)}}})(U,Z,G,u,G.layout.get("text-rotation-alignment"),G.layout.get("text-pitch-alignment"),G.paint.get("text-translate"),G.paint.get("text-translate-anchor"),X),G.paint.get("icon-opacity").constantOr(1)!==0&&ir(Z,u,G,U,!1,G.paint.get("icon-translate"),G.paint.get("icon-translate-anchor"),G.layout.get("icon-rotation-alignment"),G.layout.get("icon-pitch-alignment"),G.layout.get("icon-keep-upright"),j,H,k),G.paint.get("text-opacity").constantOr(1)!==0&&ir(Z,u,G,U,!0,G.paint.get("text-translate"),G.paint.get("text-translate-anchor"),G.layout.get("text-rotation-alignment"),G.layout.get("text-pitch-alignment"),G.layout.get("text-keep-upright"),j,H,k),u.map.showCollisionBoxes&&(qo(Z,u,G,U,!0),qo(Z,u,G,U,!1))})(e,a,c,s,this.style.placement.variableOffsets,W):o.cm(c)?(function(Z,u,G,U,X){if(Z.renderPass!=="translucent")return;let{isRenderingToTexture:Q}=X,k=G.paint.get("circle-opacity"),j=G.paint.get("circle-stroke-width"),H=G.paint.get("circle-stroke-opacity"),q=!G.layout.get("circle-sort-key").isConstant();if(k.constantOr(1)===0&&(j.constantOr(1)===0||H.constantOr(1)===0))return;let $=Z.context,et=$.gl,nt=Z.transform,mt=Z.getDepthModeForSublayer(0,Se.ReadOnly),at=Ke.disabled,Wt=Z.colorModeForRenderPass(),Zt=[],ot=nt.getCircleRadiusCorrection();for(let Ft=0;Ft<U.length;Ft++){let Xt=U[Ft],It=u.getTile(Xt),Ut=It.getBucket(G);if(!Ut)continue;let xt=G.paint.get("circle-translate"),$t=G.paint.get("circle-translate-anchor"),Pt=o.aN(nt,It,xt,$t),At=Ut.programConfigurations.get(G.id),se=Z.useProgram("circle",At),Ce=Ut.layoutVertexBuffer,Je=Ut.indexBuffer,Mi=Z.style.map.terrain&&Z.style.map.terrain.getTerrainData(Xt),Yi={programConfiguration:At,program:se,layoutVertexBuffer:Ce,indexBuffer:Je,uniformValues:Ao(Z,It,G,Pt,ot),terrainData:Mi,projectionData:nt.getProjectionData({overscaledTileID:Xt,applyGlobeMatrix:!Q,applyTerrainMatrix:!0})};if(q){let zi=Ut.segments.get();for(let Ni of zi)Zt.push({segments:new o.aW([Ni]),sortKey:Ni.sortKey,state:Yi})}else Zt.push({segments:Ut.segments,sortKey:0,state:Yi})}q&&Zt.sort(((Ft,Xt)=>Ft.sortKey-Xt.sortKey));for(let Ft of Zt){let{programConfiguration:Xt,program:It,layoutVertexBuffer:Ut,indexBuffer:xt,uniformValues:$t,terrainData:Pt,projectionData:At}=Ft.state;It.draw($,et.TRIANGLES,mt,at,Wt,$e.backCCW,$t,Pt,At,G.id,Ut,xt,Ft.segments,G.paint,Z.transform.zoom,Xt)}})(e,a,c,s,W):o.cn(c)?(function(Z,u,G,U,X){if(G.paint.get("heatmap-opacity")===0)return;let Q=Z.context,{isRenderingToTexture:k,isRenderingGlobe:j}=X;if(Z.style.map.terrain){for(let H of U){let q=u.getTile(H);u.hasRenderableParent(H)||(Z.renderPass==="offscreen"?Oc(Z,q,G,H,j):Z.renderPass==="translucent"&&Kb(Z,G,H,k,j))}Q.viewport.set([0,0,Z.width,Z.height])}else Z.renderPass==="offscreen"?(function(H,q,$,et){let nt=H.context,mt=nt.gl,at=H.transform,Wt=Ke.disabled,Zt=new mi([mt.ONE,mt.ONE],o.bo.transparent,[!0,!0,!0,!0]);(function(ot,Ft,Xt){let It=ot.gl;ot.activeTexture.set(It.TEXTURE1),ot.viewport.set([0,0,Ft.width/4,Ft.height/4]);let Ut=Xt.heatmapFbos.get(o.cc);Ut?(It.bindTexture(It.TEXTURE_2D,Ut.colorAttachment.get()),ot.bindFramebuffer.set(Ut.framebuffer)):(Ut=ts(ot,Ft.width/4,Ft.height/4),Xt.heatmapFbos.set(o.cc,Ut))})(nt,H,$),nt.clear({color:o.bo.transparent});for(let ot=0;ot<et.length;ot++){let Ft=et[ot];if(q.hasRenderableParent(Ft))continue;let Xt=q.getTile(Ft),It=Xt.getBucket($);if(!It)continue;let Ut=It.programConfigurations.get($.id),xt=H.useProgram("heatmap",Ut),$t=at.getProjectionData({overscaledTileID:Ft,applyGlobeMatrix:!0,applyTerrainMatrix:!1}),Pt=at.getCircleRadiusCorrection();xt.draw(nt,mt.TRIANGLES,Se.disabled,Wt,Zt,$e.backCCW,pa(Xt,at.zoom,$.paint.get("heatmap-intensity"),Pt),null,$t,$.id,It.layoutVertexBuffer,It.indexBuffer,It.segments,$.paint,at.zoom,Ut)}nt.viewport.set([0,0,H.width,H.height])})(Z,u,G,U):Z.renderPass==="translucent"&&(function(H,q){let $=H.context,et=$.gl;$.setColorMode(H.colorModeForRenderPass());let nt=q.heatmapFbos.get(o.cc);nt&&($.activeTexture.set(et.TEXTURE0),et.bindTexture(et.TEXTURE_2D,nt.colorAttachment.get()),$.activeTexture.set(et.TEXTURE1),_c($,q).bind(et.LINEAR,et.CLAMP_TO_EDGE),H.useProgram("heatmapTexture").draw($,et.TRIANGLES,Se.disabled,Ke.disabled,H.colorModeForRenderPass(),$e.disabled,Tn(H,q,0,1),null,null,q.id,H.viewportBuffer,H.quadTriangleIndexBuffer,H.viewportSegments,q.paint,H.transform.zoom))})(Z,G)})(e,a,c,s,W):o.co(c)?(function(Z,u,G,U,X){if(Z.renderPass!=="translucent")return;let{isRenderingToTexture:Q}=X,k=G.paint.get("line-opacity"),j=G.paint.get("line-width");if(k.constantOr(1)===0||j.constantOr(1)===0)return;let H=Z.getDepthModeForSublayer(0,Se.ReadOnly),q=Z.colorModeForRenderPass(),$=G.paint.get("line-dasharray"),et=$.constantOr(1),nt=G.paint.get("line-pattern"),mt=nt.constantOr(1),at=G.paint.get("line-gradient"),Wt=G.getCrossfadeParameters(),Zt;Zt=mt?"linePattern":et&&at?"lineGradientSDF":et?"lineSDF":at?"lineGradient":"line";let ot=Z.context,Ft=ot.gl,Xt=Z.transform,It=!0;for(let Ut of U){let xt=u.getTile(Ut);if(mt&&!xt.patternsLoaded())continue;let $t=xt.getBucket(G);if(!$t)continue;let Pt=$t.programConfigurations.get(G.id),At=Z.context.program.get(),se=Z.useProgram(Zt,Pt),Ce=It||se.program!==At,Je=Z.style.map.terrain&&Z.style.map.terrain.getTerrainData(Ut),Mi=nt.constantOr(null),Yi=$&&$.constantOr(null);if(Mi&&xt.imageAtlas){let sl=xt.imageAtlas,al=sl.patternPositions[Mi.to.toString()],bl=sl.patternPositions[Mi.from.toString()];al&&bl&&Pt.setConstantPatternPositions(al,bl)}else if(Yi){let sl=G.layout.get("line-cap")==="round",al=Z.lineAtlas.getDash(Yi.to,sl),bl=Z.lineAtlas.getDash(Yi.from,sl);Pt.setConstantDashPositions(al,bl)}let zi=Xt.getProjectionData({overscaledTileID:Ut,applyGlobeMatrix:!Q,applyTerrainMatrix:!0}),Ni=Xt.getPixelScale(),pl;mt?(pl=vo(Z,xt,G,Ni,Wt),u0(ot,Ft,xt,Pt,Wt)):et&&at?(pl=kd(Z,xt,G,Ni,Wt,$t.lineClipsArray.length),es(Z,u,ot,Ft,G,$t,Ut,Pt,Wt)):et?(pl=Cd(Z,xt,G,Ni,Wt),R0(Z,ot,Ft,Pt,Ce,Wt)):at?(pl=xa(Z,xt,G,Ni,$t.lineClipsArray.length),ar(Z,u,ot,Ft,G,$t,Ut)):pl=Gd(Z,xt,G,Ni);let Bi=Z.stencilModeForClipping(Ut);se.draw(ot,Ft.TRIANGLES,H,Bi,q,$e.disabled,pl,Je,zi,G.id,$t.layoutVertexBuffer,$t.indexBuffer,$t.segments,G.paint,Z.transform.zoom,Pt,$t.layoutVertexBuffer2),It=!1}})(e,a,c,s,W):o.cp(c)?(function(Z,u,G,U,X){let Q=G.paint.get("fill-color"),k=G.paint.get("fill-opacity");if(k.constantOr(1)===0)return;let{isRenderingToTexture:j}=X,H=Z.colorModeForRenderPass(),q=G.paint.get("fill-pattern"),$=Z.opaquePassEnabledForLayer()&&!q.constantOr(1)&&Q.constantOr(o.bo.transparent).a===1&&k.constantOr(0)===1?"opaque":"translucent";if(Z.renderPass===$){let et=Z.getDepthModeForSublayer(1,Z.renderPass==="opaque"?Se.ReadWrite:Se.ReadOnly);is(Z,u,G,U,et,H,!1,j)}if(Z.renderPass==="translucent"&&G.paint.get("fill-antialias")){let et=Z.getDepthModeForSublayer(G.getPaintProperty("fill-outline-color")?2:0,Se.ReadOnly);is(Z,u,G,U,et,H,!0,j)}})(e,a,c,s,W):o.cq(c)?(function(Z,u,G,U,X){let Q=G.paint.get("fill-extrusion-opacity");if(Q===0)return;let{isRenderingToTexture:k}=X;if(Z.renderPass==="translucent"){let j=new Se(Z.context.gl.LEQUAL,Se.ReadWrite,Z.depthRangeFor3D);if(Q!==1||G.paint.get("fill-extrusion-pattern").constantOr(1))Ei(Z,u,G,U,j,Ke.disabled,mi.disabled,k),Ei(Z,u,G,U,j,Z.stencilModeFor3D(),Z.colorModeForRenderPass(),k);else{let H=Z.colorModeForRenderPass();Ei(Z,u,G,U,j,Ke.disabled,H,k)}}})(e,a,c,s,W):o.cr(c)?(function(Z,u,G,U,X){if(Z.renderPass!=="offscreen"&&Z.renderPass!=="translucent")return;let{isRenderingToTexture:Q}=X,k=Z.context,j=Z.style.projection.useSubdivision,H=Z.getDepthModeForSublayer(0,Se.ReadOnly),q=Z.colorModeForRenderPass();if(Z.renderPass==="offscreen")(function($,et,nt,mt,at,Wt,Zt){let ot=$.context,Ft=ot.gl;for(let Xt of nt){let It=et.getTile(Xt),Ut=It.dem;if(!Ut||!Ut.data||!It.needsHillshadePrepare)continue;let xt=Ut.dim,$t=Ut.stride,Pt=Ut.getPixels();if(ot.activeTexture.set(Ft.TEXTURE1),ot.pixelStoreUnpackPremultiplyAlpha.set(!1),It.demTexture=It.demTexture||$.getTileTexture($t),It.demTexture){let se=It.demTexture;se.update(Pt,{premultiply:!1}),se.bind(Ft.NEAREST,Ft.CLAMP_TO_EDGE)}else It.demTexture=new o.T(ot,Pt,Ft.RGBA,{premultiply:!1}),It.demTexture.bind(Ft.NEAREST,Ft.CLAMP_TO_EDGE);ot.activeTexture.set(Ft.TEXTURE0);let At=It.fbo;if(!At){let se=new o.T(ot,{width:xt,height:xt,data:null},Ft.RGBA);se.bind(Ft.LINEAR,Ft.CLAMP_TO_EDGE),At=It.fbo=ot.createFramebuffer(xt,xt,!0,!1),At.colorAttachment.set(se.texture)}ot.bindFramebuffer.set(At.framebuffer),ot.viewport.set([0,0,xt,xt]),$.useProgram("hillshadePrepare").draw(ot,Ft.TRIANGLES,at,Wt,Zt,$e.disabled,wo(It.tileID,Ut),null,null,mt.id,$.rasterBoundsBuffer,$.quadTriangleIndexBuffer,$.rasterBoundsSegments),It.needsHillshadePrepare=!1}})(Z,u,U,G,H,Ke.disabled,q),k.viewport.set([0,0,Z.width,Z.height]);else if(Z.renderPass==="translucent")if(j){let[$,et,nt]=Z.stencilConfigForOverlapTwoPass(U);td(Z,u,G,nt,$,H,q,!1,Q),td(Z,u,G,nt,et,H,q,!0,Q)}else{let[$,et]=Z.getStencilConfigForOverlapAndUpdateStencilID(U);td(Z,u,G,et,$,H,q,!1,Q)}})(e,a,c,s,W):o.cs(c)?(function(Z,u,G,U,X){if(Z.renderPass!=="translucent"||!U.length)return;let{isRenderingToTexture:Q}=X,k=Z.style.projection.useSubdivision,j=Z.getDepthModeForSublayer(0,Se.ReadOnly),H=Z.colorModeForRenderPass();if(k){let[q,$,et]=Z.stencilConfigForOverlapTwoPass(U);Xa(Z,u,G,et,q,j,H,!1,Q),Xa(Z,u,G,et,$,j,H,!0,Q)}else{let[q,$]=Z.getStencilConfigForOverlapAndUpdateStencilID(U);Xa(Z,u,G,$,q,j,H,!1,Q)}})(e,a,c,s,W):o.bT(c)?(function(Z,u,G,U,X){if(Z.renderPass!=="translucent"||G.paint.get("raster-opacity")===0||!U.length)return;let{isRenderingToTexture:Q}=X,k=u.getSource(),j=Z.style.projection.useSubdivision;if(k instanceof vi)Ad(Z,u,G,U,null,!1,!1,k.tileCoords,k.flippedWindingOrder,Q);else if(j){let[H,q,$]=Z.stencilConfigForOverlapTwoPass(U);Ad(Z,u,G,$,H,!1,!0,Pc,!1,Q),Ad(Z,u,G,$,q,!0,!0,Pc,!1,Q)}else{let[H,q]=Z.getStencilConfigForOverlapAndUpdateStencilID(U);Ad(Z,u,G,q,H,!1,!0,Pc,!1,Q)}})(e,a,c,s,W):o.ct(c)?(function(Z,u,G,U,X){let Q=G.paint.get("background-color"),k=G.paint.get("background-opacity");if(k===0)return;let{isRenderingToTexture:j}=X,H=Z.context,q=H.gl,$=Z.style.projection,et=Z.transform,nt=et.tileSize,mt=G.paint.get("background-pattern");if(Z.isPatternMissing(mt))return;let at=!mt&&Q.a===1&&k===1&&Z.opaquePassEnabledForLayer()?"opaque":"translucent";if(Z.renderPass!==at)return;let Wt=Ke.disabled,Zt=Z.getDepthModeForSublayer(0,at==="opaque"?Se.ReadWrite:Se.ReadOnly),ot=Z.colorModeForRenderPass(),Ft=Z.useProgram(mt?"backgroundPattern":"background"),Xt=U||Be(et,{tileSize:nt,terrain:Z.style.map.terrain});mt&&(H.activeTexture.set(q.TEXTURE0),Z.imageManager.bind(Z.context));let It=G.getCrossfadeParameters();for(let Ut of Xt){let xt=et.getProjectionData({overscaledTileID:Ut,applyGlobeMatrix:!j,applyTerrainMatrix:!0}),$t=mt?mc(k,Z,mt,{tileID:Ut,tileSize:nt},It):Ed(k,Q),Pt=Z.style.map.terrain&&Z.style.map.terrain.getTerrainData(Ut),At=$.getMeshFromTileID(H,Ut.canonical,!1,!0,"raster");Ft.draw(H,q.TRIANGLES,Zt,Wt,ot,$e.backCCW,$t,Pt,xt,G.id,At.vertexBuffer,At.indexBuffer,At.segments)}})(e,0,c,s,W):o.cu(c)&&(function(Z,u,G,U){let{isRenderingGlobe:X}=U,Q=Z.context,k=G.implementation,j=Z.style.projection,H=Z.transform,q=H.getProjectionDataForCustomLayer(X),$={farZ:H.farZ,nearZ:H.nearZ,fov:H.fov*Math.PI/180,modelViewProjectionMatrix:H.modelViewProjectionMatrix,projectionMatrix:H.projectionMatrix,shaderData:{variantName:j.shaderVariantName,vertexShaderPrelude:`const float PI = 3.141592653589793;
uniform mat4 u_projection_matrix;
${j.shaderPreludeCode.vertexSource}`,define:j.shaderDefine},defaultProjectionData:q},et=k.renderingMode?k.renderingMode:"2d";if(Z.renderPass==="offscreen"){let nt=k.prerender;nt&&(Z.setCustomLayerDefaults(),Q.setColorMode(Z.colorModeForRenderPass()),nt.call(k,Q.gl,$),Q.setDirty(),Z.setBaseState())}else if(Z.renderPass==="translucent"){Z.setCustomLayerDefaults(),Q.setColorMode(Z.colorModeForRenderPass()),Q.setStencilMode(Ke.disabled);let nt=et==="3d"?Z.getDepthModeFor3D():Z.getDepthModeForSublayer(0,Se.ReadOnly);Q.setDepthMode(nt),k.render(Q.gl,$),Q.setDirty(),Z.setBaseState(),Q.bindFramebuffer.set(null)}})(e,0,c,W))}saveTileTexture(e){let a=this._tileTextures[e.size[0]];a?a.push(e):this._tileTextures[e.size[0]]=[e]}getTileTexture(e){let a=this._tileTextures[e];return a&&a.length>0?a.pop():null}isPatternMissing(e){if(!e)return!1;if(!e.from||!e.to)return!0;let a=this.imageManager.getPattern(e.from.toString()),c=this.imageManager.getPattern(e.to.toString());return!a||!c}useProgram(e,a,c=!1,s=[]){this.cache=this.cache||{};let W=!!this.style.map.terrain,Z=this.style.projection,u=c?ma.projectionMercator:Z.shaderPreludeCode,G=c?Xl:Z.shaderDefine,U=e+(a?a.cacheKey:"")+`/${c?Gl:Z.shaderVariantName}`+(this._showOverdrawInspector?"/overdraw":"")+(W?"/terrain":"")+(s?`/${s.join("/")}`:"");return this.cache[U]||(this.cache[U]=new Yn(this.context,ma[e],a,Rt[e],this._showOverdrawInspector,W,u,G,s)),this.cache[U]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){let e=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(e.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new o.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){var e,a;if(this._tileTextures){for(let c in this._tileTextures){let s=this._tileTextures[c];if(s)for(let W of s)W.destroy()}this._tileTextures={}}if(this.tileExtentBuffer&&this.tileExtentBuffer.destroy(),this.debugBuffer&&this.debugBuffer.destroy(),this.rasterBoundsBuffer&&this.rasterBoundsBuffer.destroy(),this.rasterBoundsBufferPosOnly&&this.rasterBoundsBufferPosOnly.destroy(),this.viewportBuffer&&this.viewportBuffer.destroy(),this.tileBorderIndexBuffer&&this.tileBorderIndexBuffer.destroy(),this.quadTriangleIndexBuffer&&this.quadTriangleIndexBuffer.destroy(),this.tileExtentMesh&&((e=this.tileExtentMesh.vertexBuffer)===null||e===void 0||e.destroy()),this.tileExtentMesh&&((a=this.tileExtentMesh.indexBuffer)===null||a===void 0||a.destroy()),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this.cache){for(let c in this.cache){let s=this.cache[c];s&&s.program&&this.context.gl.deleteProgram(s.program)}this.cache={}}this.context&&this.context.setDefault()}overLimit(){let{drawingBufferWidth:e,drawingBufferHeight:a}=this.context.gl;return this.width!==e||this.height!==a}}function os(m,e){let a,c=!1,s=null,W=null,Z=()=>{s=null,c&&(m.apply(W,a),s=setTimeout(Z,e),c=!1)};return(...u)=>(c=!0,W=this,a=u,s||Z(),s)}class rs{constructor(e){this._getCurrentHash=()=>{let a=window.location.hash.replace("#","");if(this._hashName){let c;return a.split("&").map((s=>s.split("="))).forEach((s=>{s[0]===this._hashName&&(c=s)})),(c&&c[1]||"").split("/")}return a.split("/")},this._onHashChange=()=>{let a=this._getCurrentHash();if(!this._isValidHash(a))return!1;let c=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(a[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+a[2],+a[1]],zoom:+a[0],bearing:c,pitch:+(a[4]||0)}),!0},this._updateHashUnthrottled=()=>{let a=window.location.href.replace(/(#.*)?$/,this.getHashString());window.history.replaceState(window.history.state,null,a)},this._removeHash=()=>{let a=this._getCurrentHash();if(a.length===0)return;let c=a.join("/"),s=c;s.split("&").length>0&&(s=s.split("&")[0]),this._hashName&&(s=`${this._hashName}=${c}`);let W=window.location.hash.replace(s,"");W.startsWith("#&")?W=W.slice(0,1)+W.slice(2):W==="#"&&(W="");let Z=window.location.href.replace(/(#.+)?$/,W);Z=Z.replace("&&","&"),window.history.replaceState(window.history.state,null,Z)},this._updateHash=os(this._updateHashUnthrottled,300),this._hashName=e&&encodeURIComponent(e)}addTo(e){return this._map=e,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),this._removeHash(),delete this._map,this}getHashString(e){let a=this._map.getCenter(),c=Math.round(100*this._map.getZoom())/100,s=Math.ceil((c*Math.LN2+Math.log(512/360/.5))/Math.LN10),W=Math.pow(10,s),Z=Math.round(a.lng*W)/W,u=Math.round(a.lat*W)/W,G=this._map.getBearing(),U=this._map.getPitch(),X="";if(X+=e?`/${Z}/${u}/${c}`:`${c}/${u}/${Z}`,(G||U)&&(X+="/"+Math.round(10*G)/10),U&&(X+=`/${Math.round(U)}`),this._hashName){let Q=this._hashName,k=!1,j=window.location.hash.slice(1).split("&").map((H=>{let q=H.split("=")[0];return q===Q?(k=!0,`${q}=${X}`):H})).filter((H=>H));return k||j.push(`${Q}=${X}`),`#${j.join("&")}`}return`#${X}`}_isValidHash(e){if(e.length<3||e.some(isNaN))return!1;try{new o.V(+e[2],+e[1])}catch{return!1}let a=+e[0],c=+(e[3]||0),s=+(e[4]||0);return a>=this._map.getMinZoom()&&a<=this._map.getMaxZoom()&&c>=-180&&c<=180&&s>=this._map.getMinPitch()&&s<=this._map.getMaxPitch()}}let Vc={linearity:.3,easing:o.cv(0,0,.3,1)},M0=o.e({deceleration:2500,maxSpeed:1400},Vc),Y0=o.e({deceleration:20,maxSpeed:1400},Vc),x0=o.e({deceleration:1e3,maxSpeed:360},Vc),nr=o.e({deceleration:1e3,maxSpeed:90},Vc),T0=o.e({deceleration:1e3,maxSpeed:360},Vc);class tn{constructor(e){this._map=e,this.clear()}clear(){this._inertiaBuffer=[]}record(e){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:jt(),settings:e})}_drainInertiaBuffer(){let e=this._inertiaBuffer,a=jt();for(;e.length>0&&a-e[0].time>160;)e.shift()}_onMoveEnd(e){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;let a={zoom:0,bearing:0,pitch:0,roll:0,pan:new o.P(0,0),pinchAround:void 0,around:void 0};for(let{settings:W}of this._inertiaBuffer)a.zoom+=W.zoomDelta||0,a.bearing+=W.bearingDelta||0,a.pitch+=W.pitchDelta||0,a.roll+=W.rollDelta||0,W.panDelta&&a.pan._add(W.panDelta),W.around&&(a.around=W.around),W.pinchAround&&(a.pinchAround=W.pinchAround);let c=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,s={};if(a.pan.mag()){let W=gc(a.pan.mag(),c,o.e({},M0,e||{})),Z=a.pan.mult(W.amount/a.pan.mag()),u=this._map.cameraHelper.handlePanInertia(Z,this._map.transform);s.center=u.easingCenter,s.offset=u.easingOffset,Va(s,W)}if(a.zoom){let W=gc(a.zoom,c,Y0);s.zoom=this._map.transform.zoom+W.amount,Va(s,W)}if(a.bearing){let W=gc(a.bearing,c,x0);s.bearing=this._map.transform.bearing+o.an(W.amount,-179,179),Va(s,W)}if(a.pitch){let W=gc(a.pitch,c,nr);s.pitch=this._map.transform.pitch+W.amount,Va(s,W)}if(a.roll){let W=gc(a.roll,c,T0);s.roll=this._map.transform.roll+o.an(W.amount,-179,179),Va(s,W)}if(s.zoom||s.bearing){let W=a.pinchAround===void 0?a.around:a.pinchAround;s.around=W?this._map.unproject(W):this._map.getCenter()}return this.clear(),o.e(s,{noMoveStart:!0})}}function Va(m,e){(!m.duration||m.duration<e.duration)&&(m.duration=e.duration,m.easing=e.easing)}function gc(m,e,a){let{maxSpeed:c,linearity:s,deceleration:W}=a,Z=o.an(m*s/(e/1e3),-c,c),u=Math.abs(Z)/(W*s);return{easing:a.easing,duration:1e3*u,amount:Z*(u/2)}}class _i extends o.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,a,c,s={}){c=c instanceof MouseEvent?c:new MouseEvent(e,c);let W=gt.mousePos(a.getCanvas(),c),Z=a.unproject(W);super(e,o.e({point:W,lngLat:Z,originalEvent:c},s)),this._defaultPrevented=!1,this.target=a}}class $c extends o.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,a,c){let s=e==="touchend"?c.changedTouches:c.touches,W=gt.touchPos(a.getCanvasContainer(),s),Z=W.map((G=>a.unproject(G))),u=W.reduce(((G,U,X,Q)=>G.add(U.div(Q.length))),new o.P(0,0));super(e,{points:W,point:u,lngLats:Z,lngLat:a.unproject(u),originalEvent:c}),this._defaultPrevented=!1}}class wd extends o.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,a,c){super(e,{originalEvent:c}),this._defaultPrevented=!1}}class qb{constructor(e,a){this._map=e,this._clickTolerance=a.clickTolerance}reset(){delete this._mousedownPos}wheel(e){return this._firePreventable(new wd(e.type,this._map,e))}mousedown(e,a){return this._mousedownPos=a,this._firePreventable(new _i(e.type,this._map,e))}mouseup(e){this._map.fire(new _i(e.type,this._map,e))}click(e,a){this._mousedownPos&&this._mousedownPos.dist(a)>=this._clickTolerance||this._map.fire(new _i(e.type,this._map,e))}dblclick(e){return this._firePreventable(new _i(e.type,this._map,e))}mouseover(e){this._map.fire(new _i(e.type,this._map,e))}mouseout(e){this._map.fire(new _i(e.type,this._map,e))}touchstart(e){return this._firePreventable(new $c(e.type,this._map,e))}touchmove(e){this._map.fire(new $c(e.type,this._map,e))}touchend(e){this._map.fire(new $c(e.type,this._map,e))}touchcancel(e){this._map.fire(new $c(e.type,this._map,e))}_firePreventable(e){if(this._map.fire(e),e.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class $b{constructor(e){this._map=e}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(e){this._map.fire(new _i(e.type,this._map,e))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new _i("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(e){this._delayContextMenu?this._contextMenuEvent=e:this._ignoreContextMenu||this._map.fire(new _i(e.type,this._map,e)),this._map.listens("contextmenu")&&e.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class to{constructor(e){this._map=e}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(e){return this.transform.screenPointToLocation(o.P.convert(e),this._map.terrain)}}class X0{constructor(e,a){this._map=e,this._tr=new to(e),this._el=e.getCanvasContainer(),this._container=e.getContainer(),this._clickTolerance=a.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(e,a){this.isEnabled()&&e.shiftKey&&e.button===0&&(gt.disableDrag(),this._startPos=this._lastPos=a,this._active=!0)}mousemoveWindow(e,a){if(!this._active)return;let c=a;if(this._lastPos.equals(c)||!this._box&&c.dist(this._startPos)<this._clickTolerance)return;let s=this._startPos;this._lastPos=c,this._box||(this._box=gt.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",e));let W=Math.min(s.x,c.x),Z=Math.max(s.x,c.x),u=Math.min(s.y,c.y),G=Math.max(s.y,c.y);gt.setTransform(this._box,`translate(${W}px,${u}px)`),this._box.style.width=Z-W+"px",this._box.style.height=G-u+"px"}mouseupWindow(e,a){if(!this._active||e.button!==0)return;let c=this._startPos,s=a;if(this.reset(),gt.suppressClick(),c.x!==s.x||c.y!==s.y)return this._map.fire(new o.l("boxzoomend",{originalEvent:e})),{cameraAnimation:W=>W.fitScreenCoordinates(c,s,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",e)}keydown(e){this._active&&e.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",e))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(gt.remove(this._box),this._box=null),gt.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(e,a){return this._map.fire(new o.l(e,{originalEvent:a}))}}function dr(m,e){if(m.length!==e.length)throw new Error(`The number of touches and points are not equal - touches ${m.length}, points ${e.length}`);let a={};for(let c=0;c<m.length;c++)a[m[c].identifier]=e[c];return a}class eo{constructor(e){this.reset(),this.numTouches=e.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(e,a,c){(this.centroid||c.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=e.timeStamp),c.length===this.numTouches&&(this.centroid=(function(s){let W=new o.P(0,0);for(let Z of s)W._add(Z);return W.div(s.length)})(a),this.touches=dr(c,a)))}touchmove(e,a,c){if(this.aborted||!this.centroid)return;let s=dr(c,a);for(let W in this.touches){let Z=s[W];(!Z||Z.dist(this.touches[W])>30)&&(this.aborted=!0)}}touchend(e,a,c){if((!this.centroid||e.timeStamp-this.startTime>500)&&(this.aborted=!0),c.length===0){let s=!this.aborted&&this.centroid;if(this.reset(),s)return s}}}class Wn{constructor(e){this.singleTap=new eo(e),this.numTaps=e.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(e,a,c){this.singleTap.touchstart(e,a,c)}touchmove(e,a,c){this.singleTap.touchmove(e,a,c)}touchend(e,a,c){let s=this.singleTap.touchend(e,a,c);if(s){let W=e.timeStamp-this.lastTime<500,Z=!this.lastTap||this.lastTap.dist(s)<30;if(W&&Z||this.reset(),this.count++,this.lastTime=e.timeStamp,this.lastTap=s,this.count===this.numTaps)return this.reset(),s}}}class ne{constructor(e){this._tr=new to(e),this._zoomIn=new Wn({numTouches:1,numTaps:2}),this._zoomOut=new Wn({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(e,a,c){this._zoomIn.touchstart(e,a,c),this._zoomOut.touchstart(e,a,c)}touchmove(e,a,c){this._zoomIn.touchmove(e,a,c),this._zoomOut.touchmove(e,a,c)}touchend(e,a,c){let s=this._zoomIn.touchend(e,a,c),W=this._zoomOut.touchend(e,a,c),Z=this._tr;return s?(this._active=!0,e.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:u=>u.easeTo({duration:300,zoom:Z.zoom+1,around:Z.unproject(s)},{originalEvent:e})}):W?(this._active=!0,e.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:u=>u.easeTo({duration:300,zoom:Z.zoom-1,around:Z.unproject(W)},{originalEvent:e})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class uc{constructor(e){this._enabled=!!e.enable,this._moveStateManager=e.moveStateManager,this._clickTolerance=e.clickTolerance||1,this._moveFunction=e.move,this._activateOnStart=!!e.activateOnStart,e.assignEvents(this),this.reset()}reset(e){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(e)}_move(...e){let a=this._moveFunction(...e);if(a.bearingDelta||a.pitchDelta||a.rollDelta||a.around||a.panDelta)return this._active=!0,a}dragStart(e,a){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(e)&&(this._moveStateManager.startMove(e),this._lastPoint=Array.isArray(a)?a[0]:a,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(e,a){if(!this.isEnabled())return;let c=this._lastPoint;if(!c)return;if(e.preventDefault(),!this._moveStateManager.isValidMoveEvent(e))return void this.reset(e);let s=Array.isArray(a)?a[0]:a;return!this._moved&&s.dist(c)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=s,this._move(c,s))}dragEnd(e){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(e)&&(this._moved&&gt.suppressClick(),this.reset(e))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}let ss=0,J0=2,io={[ss]:1,[J0]:2};class ed{constructor(e){this._correctEvent=e.checkCorrectEvent}startMove(e){let a=gt.mouseButton(e);this._eventButton=a}endMove(e){delete this._eventButton}isValidStartEvent(e){return this._correctEvent(e)}isValidMoveEvent(e){return!(function(a,c){let s=io[c];return a.buttons===void 0||(a.buttons&s)!==s})(e,this._eventButton)}isValidEndEvent(e){return gt.mouseButton(e)===this._eventButton}}class bs{constructor(){this._firstTouch=void 0}_isOneFingerTouch(e){return e.targetTouches.length===1}_isSameTouchEvent(e){return e.targetTouches[0].identifier===this._firstTouch}startMove(e){this._firstTouch=e.targetTouches[0].identifier}endMove(e){delete this._firstTouch}isValidStartEvent(e){return this._isOneFingerTouch(e)}isValidMoveEvent(e){return this._isOneFingerTouch(e)&&this._isSameTouchEvent(e)}isValidEndEvent(e){return this._isOneFingerTouch(e)&&this._isSameTouchEvent(e)}}class tm{constructor(e=new ed({checkCorrectEvent:()=>!0}),a=new bs){this.mouseMoveStateManager=e,this.oneFingerTouchMoveStateManager=a}_executeRelevantHandler(e,a,c){return e instanceof MouseEvent?a(e):typeof TouchEvent<"u"&&e instanceof TouchEvent?c(e):void 0}startMove(e){this._executeRelevantHandler(e,(a=>this.mouseMoveStateManager.startMove(a)),(a=>this.oneFingerTouchMoveStateManager.startMove(a)))}endMove(e){this._executeRelevantHandler(e,(a=>this.mouseMoveStateManager.endMove(a)),(a=>this.oneFingerTouchMoveStateManager.endMove(a)))}isValidStartEvent(e){return this._executeRelevantHandler(e,(a=>this.mouseMoveStateManager.isValidStartEvent(a)),(a=>this.oneFingerTouchMoveStateManager.isValidStartEvent(a)))}isValidMoveEvent(e){return this._executeRelevantHandler(e,(a=>this.mouseMoveStateManager.isValidMoveEvent(a)),(a=>this.oneFingerTouchMoveStateManager.isValidMoveEvent(a)))}isValidEndEvent(e){return this._executeRelevantHandler(e,(a=>this.mouseMoveStateManager.isValidEndEvent(a)),(a=>this.oneFingerTouchMoveStateManager.isValidEndEvent(a)))}}let Rc=m=>{m.mousedown=m.dragStart,m.mousemoveWindow=m.dragMove,m.mouseup=m.dragEnd,m.contextmenu=e=>{e.preventDefault()}};class y0{constructor(e,a){this._clickTolerance=e.clickTolerance||1,this._map=a,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new o.P(0,0)}_shouldBePrevented(e){return e<(this._map.cooperativeGestures.isEnabled()?2:1)}touchstart(e,a,c){return this._calculateTransform(e,a,c)}touchmove(e,a,c){if(this._active){if(!this._shouldBePrevented(c.length))return e.preventDefault(),this._calculateTransform(e,a,c);this._map.cooperativeGestures.notifyGestureBlocked("touch_pan",e)}}touchend(e,a,c){this._calculateTransform(e,a,c),this._active&&this._shouldBePrevented(c.length)&&this.reset()}touchcancel(){this.reset()}_calculateTransform(e,a,c){c.length>0&&(this._active=!0);let s=dr(c,a),W=new o.P(0,0),Z=new o.P(0,0),u=0;for(let U in s){let X=s[U],Q=this._touches[U];Q&&(W._add(X),Z._add(X.sub(Q)),u++,s[U]=X)}if(this._touches=s,this._shouldBePrevented(u)||!Z.mag())return;let G=Z.div(u);return this._sum._add(G),this._sum.mag()<this._clickTolerance?void 0:{around:W.div(u),panDelta:G}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class lo{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(e,a,c){this._firstTwoTouches||c.length<2||(this._firstTwoTouches=[c[0].identifier,c[1].identifier],this._start([a[0],a[1]]))}touchmove(e,a,c){if(!this._firstTwoTouches)return;e.preventDefault();let[s,W]=this._firstTwoTouches,Z=cr(c,a,s),u=cr(c,a,W);if(!Z||!u)return;let G=this._aroundCenter?null:Z.add(u).div(2);return this._move([Z,u],G,e)}touchend(e,a,c){if(!this._firstTwoTouches)return;let[s,W]=this._firstTwoTouches,Z=cr(c,a,s),u=cr(c,a,W);Z&&u||(this._active&&gt.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(e){this._enabled=!0,this._aroundCenter=!!e&&e.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function cr(m,e,a){for(let c=0;c<m.length;c++)if(m[c].identifier===a)return e[c]}function ms(m,e){return Math.log(m/e)/Math.LN2}class B0 extends lo{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(e){this._startDistance=this._distance=e[0].dist(e[1])}_move(e,a){let c=this._distance;if(this._distance=e[0].dist(e[1]),this._active||!(Math.abs(ms(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:ms(this._distance,c),pinchAround:a}}}function S0(m,e){return 180*m.angleWith(e)/Math.PI}class Ws extends lo{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(e){this._startVector=this._vector=e[0].sub(e[1]),this._minDiameter=e[0].dist(e[1])}_move(e,a,c){let s=this._vector;if(this._vector=e[0].sub(e[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:S0(this._vector,s),pinchAround:a}}_isBelowThreshold(e){this._minDiameter=Math.min(this._minDiameter,e.mag());let a=25/(Math.PI*this._minDiameter)*360,c=S0(e,this._startVector);return Math.abs(c)<a}}function hs(m){return Math.abs(m.y)>Math.abs(m.x)}class Zs extends lo{constructor(e){super(),this._currentTouchCount=0,this._map=e}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(e,a,c){super.touchstart(e,a,c),this._currentTouchCount=c.length}_start(e){this._lastPoints=e,hs(e[0].sub(e[1]))&&(this._valid=!1)}_move(e,a,c){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;let s=e[0].sub(this._lastPoints[0]),W=e[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(s,W,c.timeStamp),this._valid?(this._lastPoints=e,this._active=!0,{pitchDelta:(s.y+W.y)/2*-.5}):void 0}gestureBeginsVertically(e,a,c){if(this._valid!==void 0)return this._valid;let s=e.mag()>=2,W=a.mag()>=2;if(!s&&!W)return;if(!s||!W)return this._firstMove===void 0&&(this._firstMove=c),c-this._firstMove<100&&void 0;let Z=e.y>0==a.y>0;return hs(e)&&hs(a)&&Z}}let em={panStep:100,bearingStep:15,pitchStep:10};class C0{constructor(e){this._tr=new to(e);let a=em;this._panStep=a.panStep,this._bearingStep=a.bearingStep,this._pitchStep=a.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(e){if(e.altKey||e.ctrlKey||e.metaKey)return;let a=0,c=0,s=0,W=0,Z=0;switch(e.keyCode){case 61:case 107:case 171:case 187:a=1;break;case 189:case 109:case 173:a=-1;break;case 37:e.shiftKey?c=-1:(e.preventDefault(),W=-1);break;case 39:e.shiftKey?c=1:(e.preventDefault(),W=1);break;case 38:e.shiftKey?s=1:(e.preventDefault(),Z=-1);break;case 40:e.shiftKey?s=-1:(e.preventDefault(),Z=1);break;default:return}return this._rotationDisabled&&(c=0,s=0),{cameraAnimation:u=>{let G=this._tr;u.easeTo({duration:300,easeId:"keyboardHandler",easing:Id,zoom:a?Math.round(G.zoom)+a*(e.shiftKey?2:1):G.zoom,bearing:G.bearing+c*this._bearingStep,pitch:G.pitch+s*this._pitchStep,offset:[-W*this._panStep,-Z*this._panStep],center:G.center},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Id(m){return m*(2-m)}let Vi=4.000244140625,im=1/450;class ao{constructor(e,a){this._onTimeout=c=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(c)},this._map=e,this._tr=new to(e),this._triggerRenderFrame=a,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=im}setZoomRate(e){this._defaultZoomRate=e}setWheelZoomRate(e){this._wheelZoomRate=e}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(e){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!e&&e.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}_shouldBePrevented(e){return!!this._map.cooperativeGestures.isEnabled()&&!(e.ctrlKey||this._map.cooperativeGestures.isBypassed(e))}wheel(e){if(!this.isEnabled())return;if(this._shouldBePrevented(e))return void this._map.cooperativeGestures.notifyGestureBlocked("wheel_zoom",e);let a=e.deltaMode===WheelEvent.DOM_DELTA_LINE?40*e.deltaY:e.deltaY,c=jt(),s=c-(this._lastWheelEventTime||0);this._lastWheelEventTime=c,a!==0&&a%Vi==0?this._type="wheel":a!==0&&Math.abs(a)<4?this._type="trackpad":s>400?(this._type=null,this._lastValue=a,this._timeout=setTimeout(this._onTimeout,40,e)):this._type||(this._type=Math.abs(s*a)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,a+=this._lastValue)),e.shiftKey&&a&&(a/=4),this._type&&(this._lastWheelEvent=e,this._delta-=a,this._active||this._start(e)),e.preventDefault()}_start(e){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);let a=gt.mousePos(this._map.getCanvas(),e),c=this._tr;this._aroundPoint=this._aroundCenter?c.transform.locationToScreenPoint(o.V.convert(c.center)):a,this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;let e=this._tr.transform;if(typeof this._lastExpectedZoom=="number"){let u=e.zoom-this._lastExpectedZoom;typeof this._startZoom=="number"&&(this._startZoom+=u),typeof this._targetZoom=="number"&&(this._targetZoom+=u)}if(this._delta!==0){let u=this._type==="wheel"&&Math.abs(this._delta)>Vi?this._wheelZoomRate:this._defaultZoomRate,G=2/(1+Math.exp(-Math.abs(this._delta*u)));this._delta<0&&G!==0&&(G=1/G);let U=typeof this._targetZoom!="number"?e.scale:o.aq(this._targetZoom);this._targetZoom=e.applyConstrain(e.getCameraLngLat(),o.at(U*G)).zoom,this._type==="wheel"&&(this._startZoom=e.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}let a=typeof this._targetZoom!="number"?e.zoom:this._targetZoom,c=this._startZoom,s=this._easing,W,Z=!1;if(this._type==="wheel"&&c&&s){let u=jt()-this._lastWheelEventTime,G=Math.min((u+5)/200,1),U=s(G);W=o.G.number(c,a,U),G<1?this._frameId||(this._frameId=!0):Z=!0}else W=a,Z=!0;return this._active=!0,Z&&(this._active=!1,this._finishTimeout=setTimeout((()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._lastExpectedZoom,delete this._finishTimeout}),200)),this._lastExpectedZoom=W,{noInertia:!0,needsRenderFrame:!Z,zoomDelta:W-e.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(e){let a=o.cx;if(this._prevEase){let c=this._prevEase,s=(jt()-c.start)/c.duration,W=c.easing(s+.01)-c.easing(s),Z=.27/Math.sqrt(W*W+1e-4)*.01,u=Math.sqrt(.0729-Z*Z);a=o.cv(Z,u,.25,1)}return this._prevEase={start:jt(),duration:e,easing:a},a}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,delete this._lastExpectedZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class no{constructor(e,a){this._clickZoom=e,this._tapZoom=a}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class ps{constructor(e){this._tr=new to(e),this.reset()}reset(){this._active=!1}dblclick(e,a){return e.preventDefault(),{cameraAnimation:c=>{c.easeTo({duration:300,zoom:this._tr.zoom+(e.shiftKey?-1:1),around:this._tr.unproject(a)},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class k0{constructor(){this._tap=new Wn({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(e,a,c){if(!this._swipePoint)if(this._tapTime){let s=a[0],W=e.timeStamp-this._tapTime<500,Z=this._tapPoint.dist(s)<30;W&&Z?c.length>0&&(this._swipePoint=s,this._swipeTouch=c[0].identifier):this.reset()}else this._tap.touchstart(e,a,c)}touchmove(e,a,c){if(this._tapTime){if(this._swipePoint){if(c[0].identifier!==this._swipeTouch)return;let s=a[0],W=s.y-this._swipePoint.y;return this._swipePoint=s,e.preventDefault(),this._active=!0,{zoomDelta:W/128}}}else this._tap.touchmove(e,a,c)}touchend(e,a,c){if(this._tapTime)this._swipePoint&&c.length===0&&this.reset();else{let s=this._tap.touchend(e,a,c);s&&(this._tapTime=e.timeStamp,this._tapPoint=s)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Vs{constructor(e,a,c){this._el=e,this._mousePan=a,this._touchPan=c}enable(e){this._inertiaOptions=e||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class gs{constructor(e,a,c,s){this._pitchWithRotate=e.pitchWithRotate,this._rollEnabled=e.rollEnabled,this._mouseRotate=a,this._mousePitch=c,this._mouseRoll=s}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable(),this._rollEnabled&&this._mouseRoll.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable(),this._mouseRoll.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())&&(!this._rollEnabled||this._mouseRoll.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()||this._mouseRoll.isActive()}}class Q0{constructor(e,a,c,s){this._el=e,this._touchZoom=a,this._touchRotate=c,this._tapDragZoom=s,this._rotationDisabled=!1,this._enabled=!0}enable(e){this._touchZoom.enable(e),this._rotationDisabled||this._touchRotate.enable(e),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class hn{constructor(e,a){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=e,this._options=a,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;let e=this._map.getCanvasContainer();e.classList.add("maplibregl-cooperative-gestures"),this._container=gt.create("div","maplibregl-cooperative-gesture-screen",e);let a=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(a=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));let c=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),s=document.createElement("div");s.className="maplibregl-desktop-message",s.textContent=a,this._container.appendChild(s);let W=document.createElement("div");W.className="maplibregl-mobile-message",W.textContent=c,this._container.appendChild(W),this._container.setAttribute("aria-hidden","true")}_destroyUI(){this._container&&(gt.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destroyUI()}isEnabled(){return this._enabled}isBypassed(e){return e[this._bypassKey]}notifyGestureBlocked(e,a){this._enabled&&(this._map.fire(new o.l("cooperativegestureprevented",{gestureType:e,originalEvent:a})),this._container.classList.add("maplibregl-show"),setTimeout((()=>{this._container.classList.remove("maplibregl-show")}),100))}}let vd=m=>m.zoom||m.drag||m.roll||m.pitch||m.rotate;class me extends o.l{}function Re(m){return m.panDelta&&m.panDelta.mag()||m.zoomDelta||m.bearingDelta||m.pitchDelta||m.rollDelta}class co{constructor(e,a){this.handleWindowEvent=s=>{this.handleEvent(s,`${s.type}Window`)},this.handleEvent=(s,W)=>{if(s.type==="blur")return void this.stop(!0);this._updatingCamera=!0;let Z=s.type==="renderFrame"?void 0:s,u={needsRenderFrame:!1},G={},U={};for(let{handlerName:k,handler:j,allowed:H}of this._handlers){if(!j.isEnabled())continue;let q;if(this._blockedByActive(U,H,k))j.reset();else if(j[W||s.type]){if(o.cy(s,W||s.type)){let $=gt.mousePos(this._map.getCanvas(),s);q=j[W||s.type](s,$)}else if(o.cz(s,W||s.type)){let $=this._getMapTouches(s.touches),et=gt.touchPos(this._map.getCanvas(),$);q=j[W||s.type](s,et,$)}else o.cA(W||s.type)||(q=j[W||s.type](s));this.mergeHandlerResult(u,G,q,k,Z),q&&q.needsRenderFrame&&this._triggerRenderFrame()}(q||j.isActive())&&(U[k]=j)}let X={};for(let k in this._previousActiveHandlers)U[k]||(X[k]=Z);this._previousActiveHandlers=U,(Object.keys(X).length||Re(u))&&(this._changes.push([u,G,X]),this._triggerRenderFrame()),(Object.keys(U).length||Re(u))&&this._map._stop(!0),this._updatingCamera=!1;let{cameraAnimation:Q}=u;Q&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],Q(this._map))},this._map=e,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new tn(e),this._bearingSnap=a.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(a);let c=this._el;this._listeners=[[c,"touchstart",{passive:!0}],[c,"touchmove",{passive:!1}],[c,"touchend",void 0],[c,"touchcancel",void 0],[c,"mousedown",void 0],[c,"mousemove",void 0],[c,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[c,"mouseover",void 0],[c,"mouseout",void 0],[c,"dblclick",void 0],[c,"click",void 0],[c,"keydown",{capture:!1}],[c,"keyup",void 0],[c,"wheel",{passive:!1}],[c,"contextmenu",void 0],[window,"blur",void 0]];for(let[s,W,Z]of this._listeners)gt.addEventListener(s,W,s===document?this.handleWindowEvent:this.handleEvent,Z)}destroy(){for(let[e,a,c]of this._listeners)gt.removeEventListener(e,a,e===document?this.handleWindowEvent:this.handleEvent,c)}_addDefaultHandlers(e){let a=this._map,c=a.getCanvasContainer();this._add("mapEvent",new qb(a,e));let s=a.boxZoom=new X0(a,e);this._add("boxZoom",s),e.interactive&&e.boxZoom&&s.enable();let W=a.cooperativeGestures=new hn(a,e.cooperativeGestures);this._add("cooperativeGestures",W),e.cooperativeGestures&&W.enable();let Z=new ne(a),u=new ps(a);a.doubleClickZoom=new no(u,Z),this._add("tapZoom",Z),this._add("clickZoom",u),e.interactive&&e.doubleClickZoom&&a.doubleClickZoom.enable();let G=new k0;this._add("tapDragZoom",G);let U=a.touchPitch=new Zs(a);this._add("touchPitch",U),e.interactive&&e.touchPitch&&a.touchPitch.enable(e.touchPitch);let X=()=>a.project(a.getCenter()),Q=(function({enable:at,clickTolerance:Wt,aroundCenter:Zt=!0,minPixelCenterThreshold:ot=100,rotateDegreesPerPixelMoved:Ft=.8},Xt){let It=new ed({checkCorrectEvent:Ut=>gt.mouseButton(Ut)===0&&Ut.ctrlKey||gt.mouseButton(Ut)===2&&!Ut.ctrlKey});return new uc({clickTolerance:Wt,move:(Ut,xt)=>{let $t=Xt();if(Zt&&Math.abs($t.y-Ut.y)>ot)return{bearingDelta:o.cw(new o.P(Ut.x,xt.y),xt,$t)};let Pt=(xt.x-Ut.x)*Ft;return Zt&&xt.y<$t.y&&(Pt=-Pt),{bearingDelta:Pt}},moveStateManager:It,enable:at,assignEvents:Rc})})(e,X),k=(function({enable:at,clickTolerance:Wt,pitchDegreesPerPixelMoved:Zt=-.5}){let ot=new ed({checkCorrectEvent:Ft=>gt.mouseButton(Ft)===0&&Ft.ctrlKey||gt.mouseButton(Ft)===2});return new uc({clickTolerance:Wt,move:(Ft,Xt)=>({pitchDelta:(Xt.y-Ft.y)*Zt}),moveStateManager:ot,enable:at,assignEvents:Rc})})(e),j=(function({enable:at,clickTolerance:Wt,rollDegreesPerPixelMoved:Zt=.3},ot){let Ft=new ed({checkCorrectEvent:Xt=>gt.mouseButton(Xt)===2&&Xt.ctrlKey});return new uc({clickTolerance:Wt,move:(Xt,It)=>{let Ut=ot(),xt=(It.x-Xt.x)*Zt;return It.y<Ut.y&&(xt=-xt),{rollDelta:xt}},moveStateManager:Ft,enable:at,assignEvents:Rc})})(e,X);a.dragRotate=new gs(e,Q,k,j),this._add("mouseRotate",Q,["mousePitch"]),this._add("mousePitch",k,["mouseRotate","mouseRoll"]),this._add("mouseRoll",j,["mousePitch"]),e.interactive&&e.dragRotate&&a.dragRotate.enable();let H=(function({enable:at,clickTolerance:Wt}){let Zt=new ed({checkCorrectEvent:ot=>gt.mouseButton(ot)===0&&!ot.ctrlKey});return new uc({clickTolerance:Wt,move:(ot,Ft)=>({around:Ft,panDelta:Ft.sub(ot)}),activateOnStart:!0,moveStateManager:Zt,enable:at,assignEvents:Rc})})(e),q=new y0(e,a);a.dragPan=new Vs(c,H,q),this._add("mousePan",H),this._add("touchPan",q,["touchZoom","touchRotate"]),e.interactive&&e.dragPan&&a.dragPan.enable(e.dragPan);let $=new Ws,et=new B0;a.touchZoomRotate=new Q0(c,et,$,G),this._add("touchRotate",$,["touchPan","touchZoom"]),this._add("touchZoom",et,["touchPan","touchRotate"]),e.interactive&&e.touchZoomRotate&&a.touchZoomRotate.enable(e.touchZoomRotate),this._add("blockableMapEvent",new $b(a));let nt=a.scrollZoom=new ao(a,(()=>this._triggerRenderFrame()));this._add("scrollZoom",nt,["mousePan"]),e.interactive&&e.scrollZoom&&a.scrollZoom.enable(e.scrollZoom);let mt=a.keyboard=new C0(a);this._add("keyboard",mt),e.interactive&&e.keyboard&&a.keyboard.enable()}_add(e,a,c){this._handlers.push({handlerName:e,handler:a,allowed:c}),this._handlersById[e]=a}stop(e){if(!this._updatingCamera){for(let{handler:a}of this._handlers)a.reset();this._inertia.clear(),this._fireEvents({},{},e),this._changes=[]}}isActive(){for(let{handler:e}of this._handlers)if(e.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!vd(this._eventsInProgress)||this.isZooming()}_blockedByActive(e,a,c){for(let s in e)if(s!==c&&(!a||a.indexOf(s)<0))return!0;return!1}_getMapTouches(e){let a=[];for(let c of e)this._el.contains(c.target)&&a.push(c);return a}mergeHandlerResult(e,a,c,s,W){if(!c)return;o.e(e,c);let Z={handlerName:s,originalEvent:c.originalEvent||W};c.zoomDelta!==void 0&&(a.zoom=Z),c.panDelta!==void 0&&(a.drag=Z),c.rollDelta!==void 0&&(a.roll=Z),c.pitchDelta!==void 0&&(a.pitch=Z),c.bearingDelta!==void 0&&(a.rotate=Z)}_applyChanges(){let e={},a={},c={};for(let[s,W,Z]of this._changes)s.panDelta&&(e.panDelta=(e.panDelta||new o.P(0,0))._add(s.panDelta)),s.zoomDelta&&(e.zoomDelta=(e.zoomDelta||0)+s.zoomDelta),s.bearingDelta&&(e.bearingDelta=(e.bearingDelta||0)+s.bearingDelta),s.pitchDelta&&(e.pitchDelta=(e.pitchDelta||0)+s.pitchDelta),s.rollDelta&&(e.rollDelta=(e.rollDelta||0)+s.rollDelta),s.around!==void 0&&(e.around=s.around),s.pinchAround!==void 0&&(e.pinchAround=s.pinchAround),s.noInertia&&(e.noInertia=s.noInertia),o.e(a,W),o.e(c,Z);this._updateMapTransform(e,a,c),this._changes=[]}_updateMapTransform(e,a,c){let s=this._map,W=s._getTransformForUpdate(),Z=s.terrain;if(!(Re(e)||Z&&this._terrainMovement))return this._fireEvents(a,c,!0);s._stop(!0);let{panDelta:u,zoomDelta:G,bearingDelta:U,pitchDelta:X,rollDelta:Q,around:k,pinchAround:j}=e;j!==void 0&&(k=j),k=k||s.transform.centerPoint,Z&&!W.isPointOnMapSurface(k)&&(k=W.centerPoint);let H={panDelta:u,zoomDelta:G,rollDelta:Q,pitchDelta:X,bearingDelta:U,around:k};this._map.cameraHelper.useGlobeControls&&!W.isPointOnMapSurface(k)&&(k=W.centerPoint);let q=k.distSqr(W.centerPoint)<.01?W.center:W.screenPointToLocation(u?k.sub(u):k);this._handleMapControls({terrain:Z,tr:W,deltasForHelper:H,preZoomAroundLoc:q,combinedEventsInProgress:a,panDelta:u}),s._applyUpdatedTransform(W),this._map._update(),e.noInertia||this._inertia.record(e),this._fireEvents(a,c,!0)}_handleMapControls({terrain:e,tr:a,deltasForHelper:c,preZoomAroundLoc:s,combinedEventsInProgress:W,panDelta:Z}){let u=this._map.cameraHelper;if(u.handleMapControlsRollPitchBearingZoom(c,a),e)return u.useGlobeControls?(this._terrainMovement||!W.drag&&!W.zoom||(this._terrainMovement=!0,this._map._elevationFreeze=!0),void u.handleMapControlsPan(c,a,s)):this._terrainMovement||!W.drag&&!W.zoom?void(W.drag&&this._terrainMovement&&Z?a.setCenter(a.screenPointToLocation(a.centerPoint.sub(Z))):u.handleMapControlsPan(c,a,s)):(this._terrainMovement=!0,this._map._elevationFreeze=!0,void u.handleMapControlsPan(c,a,s));u.handleMapControlsPan(c,a,s)}_fireEvents(e,a,c){let s=vd(this._eventsInProgress),W=vd(e),Z={};for(let Q in e){let{originalEvent:k}=e[Q];this._eventsInProgress[Q]||(Z[`${Q}start`]=k),this._eventsInProgress[Q]=e[Q]}!s&&W&&this._fireEvent("movestart",W.originalEvent);for(let Q in Z)this._fireEvent(Q,Z[Q]);W&&this._fireEvent("move",W.originalEvent);for(let Q in e){let{originalEvent:k}=e[Q];this._fireEvent(Q,k)}let u={},G;for(let Q in this._eventsInProgress){let{handlerName:k,originalEvent:j}=this._eventsInProgress[Q];this._handlersById[k].isActive()||(delete this._eventsInProgress[Q],G=a[k]||j,u[`${Q}end`]=G)}for(let Q in u)this._fireEvent(Q,u[Q]);let U=vd(this._eventsInProgress),X=(s||W)&&!U;if(X&&this._terrainMovement){this._map._elevationFreeze=!1,this._terrainMovement=!1;let Q=this._map._getTransformForUpdate();this._map.getCenterClampedToGround()&&Q.recalculateZoomAndCenter(this._map.terrain),this._map._applyUpdatedTransform(Q)}if(c&&X){this._updatingCamera=!0;let Q=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),k=j=>j!==0&&-this._bearingSnap<j&&j<this._bearingSnap;!Q||!Q.essential&&ge.prefersReducedMotion?(this._map.fire(new o.l("moveend",{originalEvent:G})),k(this._map.getBearing())&&this._map.resetNorth()):(k(Q.bearing||this._map.getBearing())&&(Q.bearing=0),Q.freezeElevation=!0,this._map.easeTo(Q,{originalEvent:G})),this._updatingCamera=!1}}_fireEvent(e,a){this._map.fire(new o.l(e,a?{originalEvent:a}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add((e=>{delete this._frameId,this.handleEvent(new me("renderFrame",{timeStamp:e})),this._applyChanges()}))}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class L0 extends o.E{constructor(e,a,c){super(),this._renderFrameCallback=()=>{let s=Math.min((jt()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(s)),s<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=e,this._bearingSnap=c.bearingSnap,this.cameraHelper=a,this.on("moveend",(()=>{delete this._requestedCameraState}))}migrateProjection(e,a){e.apply(this.transform),this.transform=e,this.cameraHelper=a}getCenter(){return new o.V(this.transform.center.lng,this.transform.center.lat)}setCenter(e,a){return this.jumpTo({center:e},a)}getCenterElevation(){return this.transform.elevation}setCenterElevation(e,a){return this.jumpTo({elevation:e},a),this}getCenterClampedToGround(){return this._centerClampedToGround}setCenterClampedToGround(e){this._centerClampedToGround=e}panBy(e,a,c){return e=o.P.convert(e).mult(-1),this.panTo(this.transform.center,o.e({offset:e},a),c)}panTo(e,a,c){return this.easeTo(o.e({center:e},a),c)}getZoom(){return this.transform.zoom}setZoom(e,a){return this.jumpTo({zoom:e},a),this}zoomTo(e,a,c){return this.easeTo(o.e({zoom:e},a),c)}zoomIn(e,a){return this.zoomTo(this.getZoom()+1,e,a),this}zoomOut(e,a){return this.zoomTo(this.getZoom()-1,e,a),this}getVerticalFieldOfView(){return this.transform.fov}setVerticalFieldOfView(e,a){return e!=this.transform.fov&&(this.transform.setFov(e),this.fire(new o.l("movestart",a)).fire(new o.l("move",a)).fire(new o.l("moveend",a))),this}getBearing(){return this.transform.bearing}setBearing(e,a){return this.jumpTo({bearing:e},a),this}getPadding(){return this.transform.padding}setPadding(e,a){return this.jumpTo({padding:e},a),this}rotateTo(e,a,c){return this.easeTo(o.e({bearing:e},a),c)}resetNorth(e,a){return this.rotateTo(0,o.e({duration:1e3},e),a),this}resetNorthPitch(e,a){return this.easeTo(o.e({bearing:0,pitch:0,roll:0,duration:1e3},e),a),this}snapToNorth(e,a){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(e,a):this}getPitch(){return this.transform.pitch}setPitch(e,a){return this.jumpTo({pitch:e},a),this}getRoll(){return this.transform.roll}setRoll(e,a){return this.jumpTo({roll:e},a),this}cameraForBounds(e,a){e=si.convert(e).adjustAntiMeridian();let c=a&&a.bearing||0;return this._cameraForBoxAndBearing(e.getNorthWest(),e.getSouthEast(),c,a)}_cameraForBoxAndBearing(e,a,c,s){let W={top:0,bottom:0,right:0,left:0};if(typeof(s=o.e({padding:W,offset:[0,0],maxZoom:this.transform.maxZoom},s)).padding=="number"){let U=s.padding;s.padding={top:U,bottom:U,right:U,left:U}}let Z=o.e(W,s.padding);s.padding=Z;let u=this.transform,G=new si(e,a);return this.cameraHelper.cameraForBoxAndBearing(s,Z,G,c,u)}fitBounds(e,a,c){return this._fitInternal(this.cameraForBounds(e,a),a,c)}fitScreenCoordinates(e,a,c,s,W){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.screenPointToLocation(o.P.convert(e)),this.transform.screenPointToLocation(o.P.convert(a)),c,s),s,W)}_fitInternal(e,a,c){return e?(delete(a=o.e(e,a)).padding,a.linear?this.easeTo(a,c):this.flyTo(a,c)):this}jumpTo(e,a){this.stop();let c=this._getTransformForUpdate(),s=!1,W=!1,Z=!1,u=c.zoom;this.cameraHelper.handleJumpToCenterZoom(c,e);let G=c.zoom!==u;return"elevation"in e&&c.elevation!==+e.elevation&&c.setElevation(+e.elevation),"bearing"in e&&c.bearing!==+e.bearing&&(s=!0,c.setBearing(+e.bearing)),"pitch"in e&&c.pitch!==+e.pitch&&(W=!0,c.setPitch(+e.pitch)),"roll"in e&&c.roll!==+e.roll&&(Z=!0,c.setRoll(+e.roll)),e.padding==null||c.isPaddingEqual(e.padding)||c.setPadding(e.padding),this._applyUpdatedTransform(c),this.fire(new o.l("movestart",a)).fire(new o.l("move",a)),G&&this.fire(new o.l("zoomstart",a)).fire(new o.l("zoom",a)).fire(new o.l("zoomend",a)),s&&this.fire(new o.l("rotatestart",a)).fire(new o.l("rotate",a)).fire(new o.l("rotateend",a)),W&&this.fire(new o.l("pitchstart",a)).fire(new o.l("pitch",a)).fire(new o.l("pitchend",a)),Z&&this.fire(new o.l("rollstart",a)).fire(new o.l("roll",a)).fire(new o.l("rollend",a)),this.fire(new o.l("moveend",a))}calculateCameraOptionsFromTo(e,a,c,s=0){let W=o.aa.fromLngLat(e,a),Z=o.aa.fromLngLat(c,s),u=Z.x-W.x,G=Z.y-W.y,U=Z.z-W.z,X=Math.hypot(u,G,U);if(X===0)throw new Error("Can't calculate camera options with same From and To");let Q=Math.hypot(u,G),k=o.at(this.transform.cameraToCenterDistance/X/this.transform.tileSize),j=180*Math.atan2(u,-G)/Math.PI,H=180*Math.acos(Q/X)/Math.PI;return H=U<0?90-H:90+H,{center:Z.toLngLat(),elevation:s,zoom:k,pitch:H,bearing:j}}calculateCameraOptionsFromCameraLngLatAltRotation(e,a,c,s,W){let Z=this.transform.calculateCenterFromCameraLngLatAlt(e,a,c,s);return{center:Z.center,elevation:Z.elevation,zoom:Z.zoom,bearing:c,pitch:s,roll:W}}easeTo(e,a){this._stop(!1,e.easeId),((e=o.e({offset:[0,0],duration:500,easing:o.cx},e)).animate===!1||!e.essential&&ge.prefersReducedMotion)&&(e.duration=0);let c=this._getTransformForUpdate(),s=this.getBearing(),W=c.pitch,Z=c.roll,u="bearing"in e?this._normalizeBearing(e.bearing,s):s,G="pitch"in e?+e.pitch:W,U="roll"in e?this._normalizeBearing(e.roll,Z):Z,X="padding"in e?e.padding:c.padding,Q=o.P.convert(e.offset),k,j;e.around&&(k=o.V.convert(e.around),j=c.locationToScreenPoint(k));let H={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching,rolling:this._rolling},q=this.cameraHelper.handleEaseTo(c,{bearing:u,pitch:G,roll:U,padding:X,around:k,aroundPoint:j,offsetAsPoint:Q,offset:e.offset,zoom:e.zoom,center:e.center});return this._rotating=this._rotating||s!==u,this._pitching=this._pitching||G!==W,this._rolling=this._rolling||U!==Z,this._padding=!c.isPaddingEqual(X),this._zooming=this._zooming||q.isZooming,this._easeId=e.easeId,this._prepareEase(a,e.noMoveStart,H),this.terrain&&this._prepareElevation(q.elevationCenter),this._ease(($=>{q.easeFunc($),this.terrain&&!e.freezeElevation&&this._updateElevation($),this._applyUpdatedTransform(c),this._fireMoveEvents(a)}),($=>{this.terrain&&e.freezeElevation&&this._finalizeElevation(),this._afterEase(a,$)}),e),this}_prepareEase(e,a,c={}){this._moving=!0,a||c.moving||this.fire(new o.l("movestart",e)),this._zooming&&!c.zooming&&this.fire(new o.l("zoomstart",e)),this._rotating&&!c.rotating&&this.fire(new o.l("rotatestart",e)),this._pitching&&!c.pitching&&this.fire(new o.l("pitchstart",e)),this._rolling&&!c.rolling&&this.fire(new o.l("rollstart",e))}_prepareElevation(e){this._elevationCenter=e,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(e,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(e){this._elevationStart!==void 0&&this._elevationCenter!==void 0||this._prepareElevation(this.transform.center),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom));let a=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(e<1&&a!==this._elevationTarget){let c=this._elevationTarget-this._elevationStart;this._elevationStart+=e*(c-(a-(c*e+this._elevationStart))/(1-e)),this._elevationTarget=a}this.transform.setElevation(o.G.number(this._elevationStart,this._elevationTarget,e))}_finalizeElevation(){this._elevationFreeze=!1,this.getCenterClampedToGround()&&this.transform.recalculateZoomAndCenter(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate||this.terrain?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_elevateCameraIfInsideTerrain(e){if(!this.terrain&&e.elevation>=0&&e.pitch<=90)return{};let a=e.getCameraLngLat(),c=e.getCameraAltitude(),s=this.terrain?this.terrain.getElevationForLngLatZoom(a,e.zoom):0;if(c<s){let W=this.calculateCameraOptionsFromTo(a,s,e.center,e.elevation);return{pitch:W.pitch,zoom:W.zoom}}return{}}_applyUpdatedTransform(e){let a=[];if(a.push((s=>this._elevateCameraIfInsideTerrain(s))),this.transformCameraUpdate&&a.push((s=>this.transformCameraUpdate(s))),!a.length)return;let c=e.clone();for(let s of a){let W=c.clone(),{center:Z,zoom:u,roll:G,pitch:U,bearing:X,elevation:Q}=s(W);Z&&W.setCenter(Z),Q!==void 0&&W.setElevation(Q),u!==void 0&&W.setZoom(u),G!==void 0&&W.setRoll(G),U!==void 0&&W.setPitch(U),X!==void 0&&W.setBearing(X),c.apply(W)}this.transform.apply(c)}_fireMoveEvents(e){this.fire(new o.l("move",e)),this._zooming&&this.fire(new o.l("zoom",e)),this._rotating&&this.fire(new o.l("rotate",e)),this._pitching&&this.fire(new o.l("pitch",e)),this._rolling&&this.fire(new o.l("roll",e))}_afterEase(e,a){if(this._easeId&&a&&this._easeId===a)return;delete this._easeId;let c=this._zooming,s=this._rotating,W=this._pitching,Z=this._rolling;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._rolling=!1,this._padding=!1,c&&this.fire(new o.l("zoomend",e)),s&&this.fire(new o.l("rotateend",e)),W&&this.fire(new o.l("pitchend",e)),Z&&this.fire(new o.l("rollend",e)),this.fire(new o.l("moveend",e))}flyTo(e,a){if(!e.essential&&ge.prefersReducedMotion){let xt=o.U(e,["center","zoom","bearing","pitch","roll","elevation","padding"]);return this.jumpTo(xt,a)}this.stop(),e=o.e({offset:[0,0],speed:1.2,curve:1.42,easing:o.cx},e);let c=this._getTransformForUpdate(),s=c.bearing,W=c.pitch,Z=c.roll,u=c.padding,G="bearing"in e?this._normalizeBearing(e.bearing,s):s,U="pitch"in e?+e.pitch:W,X="roll"in e?this._normalizeBearing(e.roll,Z):Z,Q="padding"in e?e.padding:c.padding,k=o.P.convert(e.offset),j=c.centerPoint.add(k),H=c.screenPointToLocation(j),q=this.cameraHelper.handleFlyTo(c,{bearing:G,pitch:U,roll:X,padding:Q,locationAtOffset:H,offsetAsPoint:k,center:e.center,minZoom:e.minZoom,zoom:e.zoom}),$=e.curve,et=Math.max(c.width,c.height),nt=et/q.scaleOfZoom,mt=q.pixelPathLength;typeof q.scaleOfMinZoom=="number"&&($=Math.sqrt(et/q.scaleOfMinZoom/mt*2));let at=$*$;function Wt(xt){let $t=(nt*nt-et*et+(xt?-1:1)*at*at*mt*mt)/(2*(xt?nt:et)*at*mt);return Math.log(Math.sqrt($t*$t+1)-$t)}function Zt(xt){return(Math.exp(xt)-Math.exp(-xt))/2}function ot(xt){return(Math.exp(xt)+Math.exp(-xt))/2}let Ft=Wt(!1),Xt=function(xt){return ot(Ft)/ot(Ft+$*xt)},It=function(xt){return et*((ot(Ft)*(Zt($t=Ft+$*xt)/ot($t))-Zt(Ft))/at)/mt;var $t},Ut=(Wt(!0)-Ft)/$;if(Math.abs(mt)<2e-6||!isFinite(Ut)){if(Math.abs(et-nt)<1e-6)return this.easeTo(e,a);let xt=nt<et?-1:1;Ut=Math.abs(Math.log(nt/et))/$,It=()=>0,Xt=$t=>Math.exp(xt*$*$t)}return e.duration="duration"in e?+e.duration:1e3*Ut/("screenSpeed"in e?+e.screenSpeed/$:+e.speed),e.maxDuration&&e.duration>e.maxDuration&&(e.duration=0),this._zooming=!0,this._rotating=s!==G,this._pitching=U!==W,this._rolling=X!==Z,this._padding=!c.isPaddingEqual(Q),this._prepareEase(a,!1),this.terrain&&this._prepareElevation(q.targetCenter),this._ease((xt=>{let $t=xt*Ut,Pt=1/Xt($t),At=It($t);this._rotating&&c.setBearing(o.G.number(s,G,xt)),this._pitching&&c.setPitch(o.G.number(W,U,xt)),this._rolling&&c.setRoll(o.G.number(Z,X,xt)),this._padding&&(c.interpolatePadding(u,Q,xt),j=c.centerPoint.add(k)),q.easeFunc(xt,Pt,At,j),this.terrain&&!e.freezeElevation&&this._updateElevation(xt),this._applyUpdatedTransform(c),this._fireMoveEvents(a)}),(()=>{this.terrain&&e.freezeElevation&&this._finalizeElevation(),this._afterEase(a)}),e),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(e,a){var c;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){let s=this._onEaseEnd;delete this._onEaseEnd,s.call(this,a)}return e||(c=this.handlers)===null||c===void 0||c.stop(!1),this}_ease(e,a,c){c.animate===!1||c.duration===0?(e(1),a()):(this._easeStart=jt(),this._easeOptions=c,this._onEaseFrame=e,this._onEaseEnd=a,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(e,a){e=o.W(e,-180,180);let c=Math.abs(e-a);return Math.abs(e-360-a)<c&&(e-=360),Math.abs(e+360-a)<c&&(e+=360),e}queryTerrainElevation(e){return this.terrain?this.terrain.getElevationForLngLatZoom(o.V.convert(e),this.transform.tileZoom):null}}let oo={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class ia{constructor(e=oo){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=a=>{!a||a.sourceDataType!=="metadata"&&a.sourceDataType!=="visibility"&&a.dataType!=="style"&&a.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=e}getDefaultPosition(){return"bottom-right"}onAdd(e){return this._map=e,this._compact=this.options.compact,this._container=gt.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=gt.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=gt.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){gt.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(e,a){let c=this._map._getUIString(`AttributionControl.${a}`);e.title=c,e.setAttribute("aria-label",c)}_updateAttributions(){if(!this._map.style)return;let e=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?e=e.concat(this.options.customAttribution.map((s=>typeof s!="string"?"":s))):typeof this.options.customAttribution=="string"&&e.push(this.options.customAttribution)),this._map.style.stylesheet){let s=this._map.style.stylesheet;this.styleOwner=s.owner,this.styleId=s.id}let a=this._map.style.tileManagers;for(let s in a){let W=a[s];if(W.used||W.usedForTerrain){let Z=W.getSource();Z.attribution&&e.indexOf(Z.attribution)<0&&e.push(Z.attribution)}}e=e.filter((s=>String(s).trim())),e.sort(((s,W)=>s.length-W.length)),e=e.filter(((s,W)=>{for(let Z=W+1;Z<e.length;Z++)if(e[Z].indexOf(s)>=0)return!1;return!0}));let c=e.join(" | ");c!==this._attribHTML&&(this._attribHTML=c,e.length?(this._innerContainer.innerHTML=gt.sanitize(c),this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class en{constructor(e={}){this._updateCompact=()=>{let a=this._container.children;if(a.length){let c=a[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&c.classList.add("maplibregl-compact"):c.classList.remove("maplibregl-compact")}},this.options=e}getDefaultPosition(){return"bottom-left"}onAdd(e){this._map=e,this._compact=this.options&&this.options.compact,this._container=gt.create("div","maplibregl-ctrl");let a=gt.create("a","maplibregl-ctrl-logo");return a.target="_blank",a.rel="noopener nofollow",a.href="https://maplibre.org/",a.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),a.setAttribute("rel","noopener nofollow"),this._container.appendChild(a),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){gt.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class E0{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(e){let a=++this._id;return this._queue.push({callback:e,id:a,cancelled:!1}),a}remove(e){let a=this._currentlyRunning,c=a?this._queue.concat(a):this._queue;for(let s of c)if(s.id===e)return void(s.cancelled=!0)}run(e=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");let a=this._currentlyRunning=this._queue;this._queue=[];for(let c of a)if(!c.cancelled&&(c.callback(e),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var lm=o.aT([{name:"a_pos3d",type:"Int16",components:3}]);class am extends o.E{constructor(e){super(),this._lastTilesetChange=jt(),this.tileManager=e,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.deltaZoom=1,this.tileSize=e._source.tileSize*2**this.deltaZoom,e.usedForTerrain=!0,e.tileSize=this.tileSize}destruct(){this.tileManager.usedForTerrain=!1,this.tileManager.tileSize=null}getSource(){return this.tileManager._source}update(e,a){this.tileManager.update(e,a),this._renderableTilesKeys=[];let c={};for(let s of Be(e,{tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:a,calculateTileZoom:this.tileManager._source.calculateTileZoom}))c[s.key]=!0,this._renderableTilesKeys.push(s.key),this._tiles[s.key]||(s.terrainRttPosMatrix32f=new Float64Array(16),o.c6(s.terrainRttPosMatrix32f,0,o.a4,o.a4,0,0,1),this._tiles[s.key]=new z(s,this.tileSize),this._lastTilesetChange=jt());for(let s in this._tiles)c[s]||delete this._tiles[s]}freeRtt(e){for(let a in this._tiles){let c=this._tiles[a];(!e||c.tileID.equals(e)||c.tileID.isChildOf(e)||e.isChildOf(c.tileID))&&(c.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map((e=>this.getTileByID(e)))}getTileByID(e){return this._tiles[e]}getTerrainCoords(e,a){return a?this._getTerrainCoordsForTileRanges(e,a):this._getTerrainCoordsForRegularTile(e)}_getTerrainCoordsForRegularTile(e){let a={};for(let c of this._renderableTilesKeys){let s=this._tiles[c].tileID,W=e.clone(),Z=o.bj();if(s.canonical.equals(e.canonical))o.c6(Z,0,o.a4,o.a4,0,0,1);else if(s.canonical.isChildOf(e.canonical)){let u=s.canonical.z-e.canonical.z,G=s.canonical.x-(s.canonical.x>>u<<u),U=s.canonical.y-(s.canonical.y>>u<<u),X=o.a4>>u;o.c6(Z,0,X,X,0,0,1),o.O(Z,Z,[-G*X,-U*X,0])}else{if(!e.canonical.isChildOf(s.canonical))continue;{let u=e.canonical.z-s.canonical.z,G=e.canonical.x-(e.canonical.x>>u<<u),U=e.canonical.y-(e.canonical.y>>u<<u),X=o.a4>>u;o.c6(Z,0,o.a4,o.a4,0,0,1),o.O(Z,Z,[G*X,U*X,0]),o.Q(Z,Z,[1/2**u,1/2**u,0])}}W.terrainRttPosMatrix32f=new Float32Array(Z),a[c]=W}return a}_getTerrainCoordsForTileRanges(e,a){let c={};for(let s of this._renderableTilesKeys){let W=this._tiles[s].tileID;if(!this._isWithinTileRanges(W,a))continue;let Z=e.clone(),u=o.bj();if(W.canonical.z===e.canonical.z){let G=e.canonical.x-W.canonical.x,U=e.canonical.y-W.canonical.y;o.c6(u,0,o.a4,o.a4,0,0,1),o.O(u,u,[G*o.a4,U*o.a4,0])}else if(W.canonical.z>e.canonical.z){let G=W.canonical.z-e.canonical.z,U=W.canonical.x-(W.canonical.x>>G<<G),X=W.canonical.y-(W.canonical.y>>G<<G),Q=e.canonical.x-(W.canonical.x>>G),k=e.canonical.y-(W.canonical.y>>G),j=o.a4>>G;o.c6(u,0,j,j,0,0,1),o.O(u,u,[-U*j+Q*o.a4,-X*j+k*o.a4,0])}else{let G=e.canonical.z-W.canonical.z,U=e.canonical.x-(e.canonical.x>>G<<G),X=e.canonical.y-(e.canonical.y>>G<<G),Q=(e.canonical.x>>G)-W.canonical.x,k=(e.canonical.y>>G)-W.canonical.y,j=o.a4<<G;o.c6(u,0,j,j,0,0,1),o.O(u,u,[U*o.a4+Q*j,X*o.a4+k*j,0])}Z.terrainRttPosMatrix32f=new Float32Array(u),c[s]=Z}return c}getSourceTile(e,a){let c=this.tileManager._source,s=e.overscaledZ-this.deltaZoom;if(s>c.maxzoom&&(s=c.maxzoom),s<c.minzoom)return null;this._sourceTileCache[e.key]||(this._sourceTileCache[e.key]=e.scaledTo(s).key);let W=this.tileManager.getTileByID(this._sourceTileCache[e.key]);if((!W||!W.dem)&&a)for(;s>=c.minzoom&&(!W||!W.dem);)W=this.tileManager.getTileByID(e.scaledTo(s--).key);return W}anyTilesAfterTime(e=Date.now()){return this._lastTilesetChange>=e}_isWithinTileRanges(e,a){return a[e.canonical.z]&&e.canonical.x>=a[e.canonical.z].minTileX&&e.canonical.x<=a[e.canonical.z].maxTileX&&e.canonical.y>=a[e.canonical.z].minTileY&&e.canonical.y<=a[e.canonical.z].maxTileY}}class nm{constructor(e,a,c){this._meshCache={},this.painter=e,this.tileManager=new am(a),this.options=c,this.exaggeration=typeof c.exaggeration=="number"?c.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(e,a,c,s=o.a4){var W;if(!(a>=0&&a<s&&c>=0&&c<s))return 0;let Z=this.getTerrainData(e),u=(W=Z.tile)===null||W===void 0?void 0:W.dem;if(!u)return 0;let G=o.cB([],[a/s*o.a4,c/s*o.a4],Z.u_terrain_matrix),U=[G[0]*u.dim,G[1]*u.dim],X=Math.floor(U[0]),Q=Math.floor(U[1]),k=U[0]-X,j=U[1]-Q;return u.get(X,Q)*(1-k)*(1-j)+u.get(X+1,Q)*k*(1-j)+u.get(X,Q+1)*(1-k)*j+u.get(X+1,Q+1)*k*j}getElevationForLngLatZoom(e,a){if(!o.cC(a,e.wrap()))return 0;let{tileID:c,mercatorX:s,mercatorY:W}=this._getOverscaledTileIDFromLngLatZoom(e,a);return this.getElevation(c,s%o.a4,W%o.a4,o.a4)}getElevation(e,a,c,s=o.a4){return this.getDEMElevation(e,a,c,s)*this.exaggeration}getTerrainData(e){if(!this._emptyDemTexture){let s=this.painter.context,W=new o.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new o.T(s,W,s.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new o.T(s,new o.R({width:1,height:1}),s.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(s.gl.NEAREST,s.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=o.ar([])}let a=this.tileManager.getSourceTile(e,!0);if(a&&a.dem&&(!a.demTexture||a.needsTerrainPrepare)){let s=this.painter.context;a.demTexture=this.painter.getTileTexture(a.dem.stride),a.demTexture?a.demTexture.update(a.dem.getPixels(),{premultiply:!1}):a.demTexture=new o.T(s,a.dem.getPixels(),s.gl.RGBA,{premultiply:!1}),a.demTexture.bind(s.gl.NEAREST,s.gl.CLAMP_TO_EDGE),a.needsTerrainPrepare=!1}let c=a&&a+a.tileID.key+e.key;if(c&&!this._demMatrixCache[c]){let s=this.tileManager.getSource().maxzoom,W=e.canonical.z-a.tileID.canonical.z;e.overscaledZ>e.canonical.z&&(e.canonical.z>=s?W=e.canonical.z-s:o.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));let Z=e.canonical.x-(e.canonical.x>>W<<W),u=e.canonical.y-(e.canonical.y>>W<<W),G=o.cD(new Float64Array(16),[1/(o.a4<<W),1/(o.a4<<W),0]);o.O(G,G,[Z*o.a4,u*o.a4,0]),this._demMatrixCache[e.key]={matrix:G,coord:e}}return{u_depth:2,u_terrain:3,u_terrain_dim:a&&a.dem&&a.dem.dim||1,u_terrain_matrix:c?this._demMatrixCache[e.key].matrix:this._emptyDemMatrix,u_terrain_unpack:a&&a.dem&&a.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(a&&a.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:a}}getFramebuffer(e){let a=this.painter,c=a.width/devicePixelRatio,s=a.height/devicePixelRatio;return!this._fbo||this._fbo.width===c&&this._fbo.height===s||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new o.T(a.context,{width:c,height:s,data:null},a.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(a.context.gl.NEAREST,a.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new o.T(a.context,{width:c,height:s,data:null},a.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(a.context.gl.NEAREST,a.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=a.context.createFramebuffer(c,s,!0,!1),this._fbo.depthAttachment.set(a.context.createRenderbuffer(a.context.gl.DEPTH_COMPONENT16,c,s))),this._fbo.colorAttachment.set(e==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){let e=this.painter.context;if(this._coordsTexture)return this._coordsTexture;let a=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let W=0,Z=0;W<this._coordsTextureSize;W++)for(let u=0;u<this._coordsTextureSize;u++,Z+=4)a[Z+0]=255&u,a[Z+1]=255&W,a[Z+2]=u>>8<<4|W>>8,a[Z+3]=0;let c=new o.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(a.buffer)),s=new o.T(e,c,e.gl.RGBA,{premultiply:!1});return s.bind(e.gl.NEAREST,e.gl.CLAMP_TO_EDGE),this._coordsTexture=s,s}pointCoordinate(e){this.painter.maybeDrawDepthAndCoords(!0);let a=new Uint8Array(4),c=this.painter.context,s=c.gl,W=Math.round(e.x*this.painter.pixelRatio/devicePixelRatio),Z=Math.round(e.y*this.painter.pixelRatio/devicePixelRatio),u=Math.round(this.painter.height/devicePixelRatio);c.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),s.readPixels(W,u-Z-1,1,1,s.RGBA,s.UNSIGNED_BYTE,a),c.bindFramebuffer.set(null);let G=a[0]+(a[2]>>4<<8),U=a[1]+((15&a[2])<<8),X=this.coordsIndex[255-a[3]],Q=X&&this.tileManager.getTileByID(X);if(!Q)return null;let k=this._coordsTextureSize,j=(1<<Q.tileID.canonical.z)*k;return new o.aa((Q.tileID.canonical.x*k+G)/j+Q.tileID.wrap,(Q.tileID.canonical.y*k+U)/j,this.getElevation(Q.tileID,G,U,k))}depthAtPoint(e){let a=new Uint8Array(4),c=this.painter.context,s=c.gl;return c.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),s.readPixels(e.x,this.painter.height/devicePixelRatio-e.y-1,1,1,s.RGBA,s.UNSIGNED_BYTE,a),c.bindFramebuffer.set(null),(a[0]/16777216+a[1]/65536+a[2]/256+a[3])/256}getTerrainMesh(e){var a;let c=((a=this.painter.style.projection)===null||a===void 0?void 0:a.transitionState)>0,s=c&&e.canonical.y===0,W=c&&e.canonical.y===(1<<e.canonical.z)-1,Z=`m_${s?"n":""}_${W?"s":""}`;if(this._meshCache[Z])return this._meshCache[Z];let u=this.painter.context,G=new o.cE,U=new o.aX,X=this.meshSize,Q=o.a4/X,k=X*X;for(let ot=0;ot<=X;ot++)for(let Ft=0;Ft<=X;Ft++)G.emplaceBack(Ft*Q,ot*Q,0);for(let ot=0;ot<k;ot+=X+1)for(let Ft=0;Ft<X;Ft++)U.emplaceBack(Ft+ot,X+Ft+ot+1,X+Ft+ot+2),U.emplaceBack(Ft+ot,X+Ft+ot+2,Ft+ot+1);let j=G.length,H=j+(X+1),q=(X+1)*X,$=s?o.bq:0,et=s?0:1,nt=W?o.br:o.a4,mt=W?0:1;for(let ot=0;ot<=X;ot++)G.emplaceBack(ot*Q,$,et);for(let ot=0;ot<=X;ot++)G.emplaceBack(ot*Q,nt,mt);for(let ot=0;ot<X;ot++)U.emplaceBack(q+ot,H+ot,H+ot+1),U.emplaceBack(q+ot,H+ot+1,q+ot+1),U.emplaceBack(0+ot,j+ot+1,j+ot),U.emplaceBack(0+ot,0+ot+1,j+ot+1);let at=G.length,Wt=at+2*(X+1);for(let ot of[0,1])for(let Ft=0;Ft<=X;Ft++)for(let Xt of[0,1])G.emplaceBack(ot*o.a4,Ft*Q,Xt);for(let ot=0;ot<2*X;ot+=2)U.emplaceBack(at+ot,at+ot+1,at+ot+3),U.emplaceBack(at+ot,at+ot+3,at+ot+2),U.emplaceBack(Wt+ot,Wt+ot+3,Wt+ot+1),U.emplaceBack(Wt+ot,Wt+ot+2,Wt+ot+3);let Zt=new rn(u.createVertexBuffer(G,lm.members),u.createIndexBuffer(U),o.aW.simpleSegment(0,0,G.length,U.length));return this._meshCache[Z]=Zt,Zt}getMeshFrameDelta(e){return 2*Math.PI*o.bD/Math.pow(2,Math.max(e,0))/5}getMinTileElevationForLngLatZoom(e,a){var c;let{tileID:s}=this._getOverscaledTileIDFromLngLatZoom(e,a);return(c=this.getMinMaxElevation(s).minElevation)!==null&&c!==void 0?c:0}getMinMaxElevation(e){let a=this.getTerrainData(e).tile,c={minElevation:null,maxElevation:null};return a&&a.dem&&(c.minElevation=a.dem.min*this.exaggeration,c.maxElevation=a.dem.max*this.exaggeration),c}_getOverscaledTileIDFromLngLatZoom(e,a){let c=o.aa.fromLngLat(e.wrap()),s=(1<<a)*o.a4,W=c.x*s,Z=c.y*s,u=Math.floor(W/o.a4),G=Math.floor(Z/o.a4);return{tileID:new o.a1(a,0,a,u,G),mercatorX:W,mercatorY:Z}}}class ro{constructor(e,a,c){this._context=e,this._size=a,this._tileSize=c,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(let e of this._objects)e.texture.destroy(),e.fbo.destroy()}_createObject(e){let a=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),c=new o.T(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return c.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),this._context.extTextureFilterAnisotropic&&this._context.gl.texParameterf(this._context.gl.TEXTURE_2D,this._context.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,this._context.extTextureFilterAnisotropicMax),a.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),a.colorAttachment.set(c.texture),{id:e,fbo:a,texture:c,stamp:-1,inUse:!1}}getObjectForId(e){return this._objects[e]}useObject(e){e.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter((a=>e.id!==a)),this._recentlyUsed.push(e.id)}stampObject(e){e.stamp=++this._stamp}getOrCreateFreeObject(){for(let a of this._recentlyUsed)if(!this._objects[a].inUse)return this._objects[a];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");let e=this._createObject(this._objects.length);return this._objects.push(e),e}freeObject(e){e.inUse=!1}freeAllObjects(){for(let e of this._objects)this.freeObject(e)}isFull(){return!(this._objects.length<this._size)&&this._objects.some((e=>!e.inUse))===!1}}let gi={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0,"color-relief":!0};class ll{constructor(e,a){this.painter=e,this.terrain=a,this.pool=new ro(e.context,30,a.tileManager.tileSize*a.qualityFactor)}destruct(){this.pool.destruct()}getTexture(e){return this.pool.getObjectForId(e.rtt[this._stacks.length-1].id).texture}prepareForRender(e,a){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.tileManager.getRenderableTiles(),this._renderableLayerIds=e._order.filter((c=>!e._layers[c].isHidden(a))),this._coordsAscending={};for(let c in e.tileManagers){this._coordsAscending[c]={};let s=e.tileManagers[c].getVisibleCoordinates(),W=e.tileManagers[c].getSource(),Z=W instanceof vi?W.terrainTileRanges:null;for(let u of s){let G=this.terrain.tileManager.getTerrainCoords(u,Z);for(let U in G)this._coordsAscending[c][U]||(this._coordsAscending[c][U]=[]),this._coordsAscending[c][U].push(G[U])}}this._coordsAscendingStr={};for(let c of e._order){let s=e._layers[c],W=s.source;if(gi[s.type]&&!this._coordsAscendingStr[W]){this._coordsAscendingStr[W]={};for(let Z in this._coordsAscending[W])this._coordsAscendingStr[W][Z]=this._coordsAscending[W][Z].map((u=>u.key)).sort().join()}}for(let c of this._renderableTiles)for(let s in this._coordsAscendingStr){let W=this._coordsAscendingStr[s][c.tileID.key];W&&W!==c.rttCoords[s]&&(c.rtt=[])}}renderLayer(e,a){if(e.isHidden(this.painter.transform.zoom))return!1;let c=Object.assign(Object.assign({},a),{isRenderingToTexture:!0}),s=e.type,W=this.painter,Z=this._renderableLayerIds[this._renderableLayerIds.length-1]===e.id;if(gi[s]&&(this._prevType&&gi[this._prevType]||this._stacks.push([]),this._prevType=s,this._stacks[this._stacks.length-1].push(e.id),!Z))return!0;if(gi[this._prevType]||gi[s]&&Z){this._prevType=s;let u=this._stacks.length-1,G=this._stacks[u]||[];for(let U of this._renderableTiles){if(this.pool.isFull()&&(Nd(this.painter,this.terrain,this._rttTiles,c),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(U),U.rtt[u]){let Q=this.pool.getObjectForId(U.rtt[u].id);if(Q.stamp===U.rtt[u].stamp){this.pool.useObject(Q);continue}}let X=this.pool.getOrCreateFreeObject();this.pool.useObject(X),this.pool.stampObject(X),U.rtt[u]={id:X.id,stamp:X.stamp},W.context.bindFramebuffer.set(X.fbo.framebuffer),W.context.clear({color:o.bo.transparent,stencil:0}),W.currentStencilSource=void 0;for(let Q=0;Q<G.length;Q++){let k=W.style._layers[G[Q]],j=k.source?this._coordsAscending[k.source][U.tileID.key]:[U.tileID];W.context.viewport.set([0,0,X.fbo.width,X.fbo.height]),W._renderTileClippingMasks(k,j,!0),W.renderLayer(W,W.style.tileManagers[k.source],k,j,c),k.source&&(U.rttCoords[k.source]=this._coordsAscendingStr[k.source][U.tileID.key])}}return Nd(this.painter,this.terrain,this._rttTiles,c),this._rttTiles=[],this.pool.freeAllObjects(),gi[s]}return!1}}let z0={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","Map.Title":"Map","Marker.Title":"Map marker","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","Popup.Close":"Close popup","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","GlobeControl.Enable":"Enable globe","GlobeControl.Disable":"Disable globe","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use \u2318 + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},so=st,bo={hash:!1,interactive:!0,bearingSnap:7,attributionControl:oo,maplibreLogo:!1,refreshExpiredTiles:!0,canvasContextAttributes:{antialias:!1,preserveDrawingBuffer:!1,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,desynchronized:!1,contextType:void 0},scrollZoom:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],elevation:0,zoom:0,bearing:0,pitch:0,roll:0,renderWorldCopies:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:o.a.MAX_TILE_CACHE_ZOOM_LEVELS,transformRequest:null,transformCameraUpdate:null,transformConstrain:null,fadeDuration:300,crossSourceCollisions:!0,clickTolerance:3,localIdeographFontFamily:"sans-serif",pitchWithRotate:!0,rollEnabled:!1,reduceMotion:void 0,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0,centerClampedToGround:!0,experimentalZoomLevelsToOverscale:void 0},us={showCompass:!0,showZoom:!0,visualizePitch:!1,visualizeRoll:!0};class Rs{constructor(e,a,c=!1){this.mousedown=W=>{this.startMove(W,gt.mousePos(this.element,W)),gt.addEventListener(window,"mousemove",this.mousemove),gt.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=W=>{this.move(W,gt.mousePos(this.element,W))},this.mouseup=W=>{this._rotatePitchHandler.dragEnd(W),this.offTemp()},this.touchstart=W=>{W.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=gt.touchPos(this.element,W.targetTouches)[0],this.startMove(W,this._startPos),gt.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),gt.addEventListener(window,"touchend",this.touchend))},this.touchmove=W=>{W.targetTouches.length!==1?this.reset():(this._lastPos=gt.touchPos(this.element,W.targetTouches)[0],this.move(W,this._lastPos))},this.touchend=W=>{W.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this._rotatePitchHandler.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10,this.element=a;let s=new tm;this._rotatePitchHandler=new uc({clickTolerance:3,move:(W,Z)=>{let u=a.getBoundingClientRect(),G=new o.P((u.bottom-u.top)/2,(u.right-u.left)/2);return{bearingDelta:o.cw(new o.P(W.x,Z.y),Z,G),pitchDelta:c?-.5*(Z.y-W.y):void 0}},moveStateManager:s,enable:!0,assignEvents:()=>{}}),this.map=e,gt.addEventListener(a,"mousedown",this.mousedown),gt.addEventListener(a,"touchstart",this.touchstart,{passive:!1}),gt.addEventListener(a,"touchcancel",this.reset)}startMove(e,a){this._rotatePitchHandler.dragStart(e,a),gt.disableDrag()}move(e,a){let c=this.map,{bearingDelta:s,pitchDelta:W}=this._rotatePitchHandler.dragMove(e,a)||{};s&&c.setBearing(c.getBearing()+s),W&&c.setPitch(c.getPitch()+W)}off(){let e=this.element;gt.removeEventListener(e,"mousedown",this.mousedown),gt.removeEventListener(e,"touchstart",this.touchstart,{passive:!1}),gt.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),gt.removeEventListener(window,"touchend",this.touchend),gt.removeEventListener(e,"touchcancel",this.reset),this.offTemp()}offTemp(){gt.enableDrag(),gt.removeEventListener(window,"mousemove",this.mousemove),gt.removeEventListener(window,"mouseup",this.mouseup),gt.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),gt.removeEventListener(window,"touchend",this.touchend)}}let id;function Fc(m,e,a,c=!1){if(c||!a.getCoveringTilesDetailsProvider().allowWorldCopies())return m?.wrap();let s=new o.V(m.lng,m.lat);if(m=new o.V(m.lng,m.lat),e){let W=new o.V(m.lng-360,m.lat),Z=new o.V(m.lng+360,m.lat),u=a.locationToScreenPoint(m).distSqr(e);a.locationToScreenPoint(W).distSqr(e)<u?m=W:a.locationToScreenPoint(Z).distSqr(e)<u&&(m=Z)}for(;Math.abs(m.lng-a.center.lng)>180;){let W=a.locationToScreenPoint(m);if(W.x>=0&&W.y>=0&&W.x<=a.width&&W.y<=a.height)break;m.lng>a.center.lng?m.lng-=360:m.lng+=360}return m.lng!==s.lng&&a.isPointOnMapSurface(a.locationToScreenPoint(m))?m:s}let mo={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function or(m,e,a){let c=m.classList;for(let s in mo)c.remove(`maplibregl-${a}-anchor-${s}`);c.add(`maplibregl-${a}-anchor-${e}`)}class Wo extends o.E{constructor(e){if(super(),this._onKeyPress=a=>{let c=a.code,s=a.charCode||a.keyCode;c!=="Space"&&c!=="Enter"&&s!==32&&s!==13||this.togglePopup()},this._onMapClick=a=>{let c=a.originalEvent.target,s=this._element;this._popup&&(c===s||s.contains(c))&&this.togglePopup()},this._update=a=>{if(!this._map)return;let c=this._map.loaded()&&!this._map.isMoving();(a?.type==="terrain"||a?.type==="render"&&!c)&&this._map.once("render",this._update),this._lngLat=Fc(this._lngLat,this._flatPos,this._map.transform),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationToScreenPoint(this._lngLat)._add(this._offset));let s="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?s=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(s=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let W="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?W="rotateX(0deg)":this._pitchAlignment==="map"&&(W=`rotateX(${this._map.getPitch()}deg)`),this._subpixelPositioning||a&&a.type!=="moveend"||(this._pos=this._pos.round()),gt.setTransform(this._element,`${mo[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${W} ${s}`),ge.frameAsync(new AbortController).then((()=>{this._updateOpacity(a&&a.type==="moveend")})).catch((()=>{}))},this._onMove=a=>{if(!this._isDragging){let c=this._clickTolerance||this._map._clickTolerance;this._isDragging=a.point.dist(this._pointerdownPos)>=c}this._isDragging&&(this._pos=a.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new o.l("dragstart"))),this.fire(new o.l("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new o.l("dragend")),this._state="inactive"},this._addDragHandler=a=>{this._element.contains(a.originalEvent.target)&&(a.preventDefault(),this._positionDelta=a.point.sub(this._pos).add(this._offset),this._pointerdownPos=a.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=e&&e.anchor||"center",this._color=e&&e.color||"#3FB1CE",this._scale=e&&e.scale||1,this._draggable=e&&e.draggable||!1,this._clickTolerance=e&&e.clickTolerance||0,this._subpixelPositioning=e&&e.subpixelPositioning||!1,this._isDragging=!1,this._state="inactive",this._rotation=e&&e.rotation||0,this._rotationAlignment=e&&e.rotationAlignment||"auto",this._pitchAlignment=e&&e.pitchAlignment&&e.pitchAlignment!=="auto"?e.pitchAlignment:this._rotationAlignment,this.setOpacity(e?.opacity,e?.opacityWhenCovered),e&&e.element)this._element=e.element,this._offset=o.P.convert(e&&e.offset||[0,0]);else{this._defaultMarker=!0,this._element=gt.create("div");let a=gt.createNS("http://www.w3.org/2000/svg","svg"),c=41,s=27;a.setAttributeNS(null,"display","block"),a.setAttributeNS(null,"height",`${c}px`),a.setAttributeNS(null,"width",`${s}px`),a.setAttributeNS(null,"viewBox",`0 0 ${s} ${c}`);let W=gt.createNS("http://www.w3.org/2000/svg","g");W.setAttributeNS(null,"stroke","none"),W.setAttributeNS(null,"stroke-width","1"),W.setAttributeNS(null,"fill","none"),W.setAttributeNS(null,"fill-rule","evenodd");let Z=gt.createNS("http://www.w3.org/2000/svg","g");Z.setAttributeNS(null,"fill-rule","nonzero");let u=gt.createNS("http://www.w3.org/2000/svg","g");u.setAttributeNS(null,"transform","translate(3.0, 29.0)"),u.setAttributeNS(null,"fill","#000000");let G=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(let et of G){let nt=gt.createNS("http://www.w3.org/2000/svg","ellipse");nt.setAttributeNS(null,"opacity","0.04"),nt.setAttributeNS(null,"cx","10.5"),nt.setAttributeNS(null,"cy","5.80029008"),nt.setAttributeNS(null,"rx",et.rx),nt.setAttributeNS(null,"ry",et.ry),u.appendChild(nt)}let U=gt.createNS("http://www.w3.org/2000/svg","g");U.setAttributeNS(null,"fill",this._color);let X=gt.createNS("http://www.w3.org/2000/svg","path");X.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),U.appendChild(X);let Q=gt.createNS("http://www.w3.org/2000/svg","g");Q.setAttributeNS(null,"opacity","0.25"),Q.setAttributeNS(null,"fill","#000000");let k=gt.createNS("http://www.w3.org/2000/svg","path");k.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),Q.appendChild(k);let j=gt.createNS("http://www.w3.org/2000/svg","g");j.setAttributeNS(null,"transform","translate(6.0, 7.0)"),j.setAttributeNS(null,"fill","#FFFFFF");let H=gt.createNS("http://www.w3.org/2000/svg","g");H.setAttributeNS(null,"transform","translate(8.0, 8.0)");let q=gt.createNS("http://www.w3.org/2000/svg","circle");q.setAttributeNS(null,"fill","#000000"),q.setAttributeNS(null,"opacity","0.25"),q.setAttributeNS(null,"cx","5.5"),q.setAttributeNS(null,"cy","5.5"),q.setAttributeNS(null,"r","5.4999962");let $=gt.createNS("http://www.w3.org/2000/svg","circle");$.setAttributeNS(null,"fill","#FFFFFF"),$.setAttributeNS(null,"cx","5.5"),$.setAttributeNS(null,"cy","5.5"),$.setAttributeNS(null,"r","5.4999962"),H.appendChild(q),H.appendChild($),Z.appendChild(u),Z.appendChild(U),Z.appendChild(Q),Z.appendChild(j),Z.appendChild(H),a.appendChild(Z),a.setAttributeNS(null,"height",c*this._scale+"px"),a.setAttributeNS(null,"width",s*this._scale+"px"),this._element.appendChild(a),this._offset=o.P.convert(e&&e.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",(a=>{a.preventDefault()})),this._element.addEventListener("mousedown",(a=>{a.preventDefault()})),or(this._element,this._anchor,"marker"),e&&e.className)for(let a of e.className.split(" "))this._element.classList.add(a);this._popup=null}addTo(e){return this.remove(),this._map=e,this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label",e._getUIString("Marker.Title")),this._element.hasAttribute("role")||this._element.setAttribute("role","button"),e.getCanvasContainer().appendChild(this._element),e.on("move",this._update),e.on("moveend",this._update),e.on("terrain",this._update),e.on("projectiontransition",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("terrain",this._update),this._map.off("projectiontransition",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),gt.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(e){return this._lngLat=o.V.convert(e),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(e){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),e){if(!("offset"in e.options)){let s=Math.abs(13.5)/Math.SQRT2;e.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[s,-1*(38.1-13.5+s)],"bottom-right":[-s,-1*(38.1-13.5+s)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=e,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}setSubpixelPositioning(e){return this._subpixelPositioning=e,this}getPopup(){return this._popup}togglePopup(){let e=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:e?(e.isOpen()?e.remove():(e.setLngLat(this._lngLat),e.addTo(this._map)),this):this}_updateOpacity(e=!1){var a,c;let s=(a=this._map)===null||a===void 0?void 0:a.terrain,W=this._map.transform.isLocationOccluded(this._lngLat);if(!s||W){let j=W?this._opacityWhenCovered:this._opacity;return void(this._element.style.opacity!==j&&(this._element.style.opacity=j))}if(e)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout((()=>{this._opacityTimeout=null}),100)}let Z=this._map,u=Z.terrain.depthAtPoint(this._pos),G=Z.terrain.getElevationForLngLatZoom(this._lngLat,Z.transform.tileZoom);if(Z.transform.lngLatToCameraDepth(this._lngLat,G)-u<.006)return void(this._element.style.opacity=this._opacity);let U=-this._offset.y/Z.transform.pixelsPerMeter,X=Math.sin(Z.getPitch()*Math.PI/180)*U,Q=Z.terrain.depthAtPoint(new o.P(this._pos.x,this._pos.y-this._offset.y)),k=Z.transform.lngLatToCameraDepth(this._lngLat,G+X)-Q>.006;!((c=this._popup)===null||c===void 0)&&c.isOpen()&&k&&this._popup.remove(),this._element.style.opacity=k?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(e){return this._offset=o.P.convert(e),this._update(),this}addClassName(e){this._element.classList.add(e)}removeClassName(e){this._element.classList.remove(e)}toggleClassName(e){return this._element.classList.toggle(e)}setDraggable(e){return this._draggable=!!e,this._map&&(e?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(e){return this._rotation=e||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(e){return this._rotationAlignment=e||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(e){return this._pitchAlignment=e&&e!=="auto"?e:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(e,a){return(this._opacity===void 0||e===void 0&&a===void 0)&&(this._opacity="1",this._opacityWhenCovered="0.2"),e!==void 0&&(this._opacity=e),a!==void 0&&(this._opacityWhenCovered=a),this._map&&this._updateOpacity(!0),this}}let Fs={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0},Gc=0,Hd=!1,Gs={maxWidth:100,unit:"metric"};function rr(m,e,a){let c=a&&a.maxWidth||100,s=m._container.clientHeight/2,W=m._container.clientWidth/2,Z=m.unproject([W-c/2,s]),u=m.unproject([W+c/2,s]),G=Math.round(m.project(u).x-m.project(Z).x),U=Math.min(c,G,m._container.clientWidth),X=Z.distanceTo(u);if(a&&a.unit==="imperial"){let Q=3.2808*X;Q>5280?Dd(e,U,Q/5280,m._getUIString("ScaleControl.Miles")):Dd(e,U,Q,m._getUIString("ScaleControl.Feet"))}else a&&a.unit==="nautical"?Dd(e,U,X/1852,m._getUIString("ScaleControl.NauticalMiles")):X>=1e3?Dd(e,U,X/1e3,m._getUIString("ScaleControl.Kilometers")):Dd(e,U,X,m._getUIString("ScaleControl.Meters"))}function Dd(m,e,a,c){let s=(function(W){let Z=Math.pow(10,`${Math.floor(W)}`.length-1),u=W/Z;return u=u>=10?10:u>=5?5:u>=3?3:u>=2?2:u>=1?1:(function(G){let U=Math.pow(10,Math.ceil(-Math.log(G)/Math.LN10));return Math.round(G*U)/U})(u),Z*u})(a);m.style.width=e*(s/a)+"px",m.innerHTML=`${s}&nbsp;${c}`}let sr={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1,locationOccludedOpacity:void 0},Ns=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function br(m){if(m){if(typeof m=="number"){let e=Math.round(Math.abs(m)/Math.SQRT2);return{center:new o.P(0,0),top:new o.P(0,m),"top-left":new o.P(e,e),"top-right":new o.P(-e,e),bottom:new o.P(0,-m),"bottom-left":new o.P(e,-e),"bottom-right":new o.P(-e,-e),left:new o.P(m,0),right:new o.P(-m,0)}}if(m instanceof o.P||Array.isArray(m)){let e=o.P.convert(m);return{center:e,top:e,"top-left":e,"top-right":e,bottom:e,"bottom-left":e,"bottom-right":e,left:e,right:e}}return{center:o.P.convert(m.center||[0,0]),top:o.P.convert(m.top||[0,0]),"top-left":o.P.convert(m["top-left"]||[0,0]),"top-right":o.P.convert(m["top-right"]||[0,0]),bottom:o.P.convert(m.bottom||[0,0]),"bottom-left":o.P.convert(m["bottom-left"]||[0,0]),"bottom-right":o.P.convert(m["bottom-right"]||[0,0]),left:o.P.convert(m.left||[0,0]),right:o.P.convert(m.right||[0,0])}}return br(new o.P(0,0))}let mr=st;I.AJAXError=o.cI,I.Event=o.l,I.Evented=o.E,I.LngLat=o.V,I.MercatorCoordinate=o.aa,I.Point=o.P,I.addProtocol=o.cJ,I.config=o.a,I.removeProtocol=o.cK,I.AttributionControl=ia,I.BoxZoomHandler=X0,I.CanvasSource=Hi,I.CooperativeGesturesHandler=hn,I.DoubleClickZoomHandler=no,I.DragPanHandler=Vs,I.DragRotateHandler=gs,I.EdgeInsets=pi,I.FullscreenControl=class extends o.E{constructor(m={}){super(),this._onFullscreenChange=()=>{var e;let a=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((e=a?.shadowRoot)===null||e===void 0)&&e.fullscreenElement;)a=a.shadowRoot.fullscreenElement;a===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,m&&m.container&&(m.container instanceof HTMLElement?this._container=m.container:o.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(m){return this._map=m,this._container||(this._container=this._map.getContainer()),this._controlContainer=gt.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){gt.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){let m=this._fullscreenButton=gt.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);gt.create("span","maplibregl-ctrl-icon",m).setAttribute("aria-hidden","true"),m.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){let m=this._getTitle();this._fullscreenButton.setAttribute("aria-label",m),this._fullscreenButton.title=m}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new o.l("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new o.l("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},I.GeoJSONSource=ql,I.GeolocateControl=class extends o.E{constructor(m){super(),this._onSuccess=e=>{if(this._map){if(this._isOutOfMapMaxBounds(e))return this._setErrorState(),this.fire(new o.l("outofmaxbounds",e)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=e,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(e),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(e),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new o.l("geolocate",e)),this._finish()}},this._updateCamera=e=>{let a=new o.V(e.coords.longitude,e.coords.latitude),c=e.coords.accuracy,s=this._map.getBearing(),W=o.e({bearing:s},this.options.fitBoundsOptions),Z=si.fromLngLat(a,c);this._map.fitBounds(Z,W,{geolocateSource:!0})},this._updateMarker=e=>{if(e){let a=new o.V(e.coords.longitude,e.coords.latitude);this._accuracyCircleMarker.setLngLat(a).addTo(this._map),this._userLocationDotMarker.setLngLat(a).addTo(this._map),this._accuracy=e.coords.accuracy,this._updateCircleRadiusIfNeeded()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onUpdate=()=>{this._updateCircleRadiusIfNeeded()},this._onError=e=>{if(this._map){if(e.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;let a=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=a,this._geolocateButton.setAttribute("aria-label",a),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(e.code===3&&Hd)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new o.l("error",e)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=()=>{this._map&&(this._container.addEventListener("contextmenu",(e=>e.preventDefault())),this._geolocateButton=gt.create("button","maplibregl-ctrl-geolocate",this._container),gt.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",this._geolocateButton.disabled=!0)},this._finishSetupUI=e=>{if(this._map){if(e===!1){o.w("Geolocation support is not available so the GeolocateControl will be disabled.");let a=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=a,this._geolocateButton.setAttribute("aria-label",a)}else{let a=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=a,this._geolocateButton.setAttribute("aria-label",a)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=gt.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new Wo({element:this._dotElement}),this._circleElement=gt.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Wo({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onUpdate),this._map.on("move",this._onUpdate),this._map.on("rotate",this._onUpdate),this._map.on("pitch",this._onUpdate)),this._geolocateButton.addEventListener("click",(()=>this.trigger())),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",(a=>{let c=a?.[0]instanceof ResizeObserverEntry;a.geolocateSource||this._watchState!=="ACTIVE_LOCK"||c||this._map.isZooming()||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new o.l("trackuserlocationend")),this.fire(new o.l("userlocationlostfocus")))}))}},this.options=o.e({},Fs,m)}onAdd(m){return this._map=m,this._container=gt.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),(function(){return o._(this,arguments,void 0,(function*(e=!1){if(id!==void 0&&!e)return id;if(window.navigator.permissions===void 0)return id=!!window.navigator.geolocation,id;try{id=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{id=!!window.navigator.geolocation}return id}))})().then((e=>this._finishSetupUI(e))),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),gt.remove(this._container),this._map.off("zoom",this._onUpdate),this._map.off("move",this._onUpdate),this._map.off("rotate",this._onUpdate),this._map.off("pitch",this._onUpdate),this._map=void 0,Gc=0,Hd=!1}_isOutOfMapMaxBounds(m){let e=this._map.getMaxBounds(),a=m.coords;return e&&(a.longitude<e.getWest()||a.longitude>e.getEast()||a.latitude<e.getSouth()||a.latitude>e.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":case"BACKGROUND_ERROR":case"OFF":case void 0:break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadiusIfNeeded(){let m=this._userLocationDotMarker.getLngLat();if(!(this.options.showUserLocation&&this.options.showAccuracyCircle&&this._accuracy&&m))return;let e=this._map.project(m),a=this._map.unproject([e.x+100,e.y]),c=m.distanceTo(a)/100,s=2*this._accuracy/c;this._circleElement.style.width=`${s.toFixed(2)}px`,this._circleElement.style.height=`${s.toFixed(2)}px`}trigger(){if(!this._setup)return o.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new o.l("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Gc--,Hd=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new o.l("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new o.l("trackuserlocationstart")),this.fire(new o.l("userlocationfocus"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let m;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),Gc++,Gc>1?(m={maximumAge:6e5,timeout:0},Hd=!0):(m=this.options.positionOptions,Hd=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,m)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},I.GlobeControl=class{constructor(){this._toggleProjection=()=>{var m;let e=(m=this._map.getProjection())===null||m===void 0?void 0:m.type;this._map.setProjection(e!=="mercator"&&e?{type:"mercator"}:{type:"globe"}),this._updateGlobeIcon()},this._updateGlobeIcon=()=>{var m;this._globeButton.classList.remove("maplibregl-ctrl-globe"),this._globeButton.classList.remove("maplibregl-ctrl-globe-enabled"),((m=this._map.getProjection())===null||m===void 0?void 0:m.type)==="globe"?(this._globeButton.classList.add("maplibregl-ctrl-globe-enabled"),this._globeButton.title=this._map._getUIString("GlobeControl.Disable")):(this._globeButton.classList.add("maplibregl-ctrl-globe"),this._globeButton.title=this._map._getUIString("GlobeControl.Enable"))}}onAdd(m){return this._map=m,this._container=gt.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._globeButton=gt.create("button","maplibregl-ctrl-globe",this._container),gt.create("span","maplibregl-ctrl-icon",this._globeButton).setAttribute("aria-hidden","true"),this._globeButton.type="button",this._globeButton.addEventListener("click",this._toggleProjection),this._updateGlobeIcon(),this._map.on("styledata",this._updateGlobeIcon),this._container}onRemove(){gt.remove(this._container),this._map.off("styledata",this._updateGlobeIcon),this._globeButton.removeEventListener("click",this._toggleProjection),this._map=void 0}},I.Hash=rs,I.ImageSource=vi,I.KeyboardHandler=C0,I.LngLatBounds=si,I.LogoControl=en,I.Map=class extends L0{constructor(m){var e,a;o.cF.mark(o.cG.create);let c=Object.assign(Object.assign(Object.assign({},bo),m),{canvasContextAttributes:Object.assign(Object.assign({},bo.canvasContextAttributes),m.canvasContextAttributes)});if(c.minZoom!=null&&c.maxZoom!=null&&c.minZoom>c.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(c.minPitch!=null&&c.maxPitch!=null&&c.minPitch>c.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(c.minPitch!=null&&c.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(c.maxPitch!=null&&c.maxPitch>180)throw new Error("maxPitch must be less than or equal to 180");let s=new Fi,W=new vl;if(c.minZoom!==void 0&&s.setMinZoom(c.minZoom),c.maxZoom!==void 0&&s.setMaxZoom(c.maxZoom),c.minPitch!==void 0&&s.setMinPitch(c.minPitch),c.maxPitch!==void 0&&s.setMaxPitch(c.maxPitch),c.renderWorldCopies!==void 0&&s.setRenderWorldCopies(c.renderWorldCopies),c.transformConstrain!==null&&s.setConstrainOverride(c.transformConstrain),super(s,W,{bearingSnap:c.bearingSnap}),this._idleTriggered=!1,this._crossFadingFactor=1,this._renderTaskQueue=new E0,this._controls=[],this._mapId=o.ag(),this._lostContextStyle={style:null,images:null},this._contextLost=u=>{u.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.painter.destroy();for(let G of Object.values(this.style._layers))if(G.type==="custom"&&console.warn(`Custom layer with id '${G.id}' cannot be restored after WebGL context loss. You will need to re-add it manually after context restoration.`),G._listeners)for(let[U]of Object.entries(G._listeners))console.warn(`Custom layer with id '${G.id}' had event listeners for event '${U}' which cannot be restored after WebGL context loss. You will need to re-add them manually after context restoration.`);this._lostContextStyle=this._getStyleAndImages(),this.style.destroy(),this.style=null,this.fire(new o.l("webglcontextlost",{originalEvent:u}))},this._contextRestored=u=>{this._lostContextStyle.style&&this.setStyle(this._lostContextStyle.style,{diff:!1}),this._lostContextStyle.images&&(this.style.imageManager.images=this._lostContextStyle.images),this._setupPainter(),this.resize(),this._update(),this.fire(new o.l("webglcontextrestored",{originalEvent:u}))},this._onMapScroll=u=>{if(u.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=c.interactive,this._maxTileCacheSize=c.maxTileCacheSize,this._maxTileCacheZoomLevels=c.maxTileCacheZoomLevels,this._canvasContextAttributes=Object.assign({},c.canvasContextAttributes),this._trackResize=c.trackResize===!0,this._bearingSnap=c.bearingSnap,this._centerClampedToGround=c.centerClampedToGround,this._refreshExpiredTiles=c.refreshExpiredTiles===!0,this._fadeDuration=c.fadeDuration,this._crossSourceCollisions=c.crossSourceCollisions===!0,this._collectResourceTiming=c.collectResourceTiming===!0,this._locale=Object.assign(Object.assign({},z0),c.locale),this._clickTolerance=c.clickTolerance,this._overridePixelRatio=c.pixelRatio,this._maxCanvasSize=c.maxCanvasSize,this._zoomLevelsToOverscale=c.experimentalZoomLevelsToOverscale,this.transformCameraUpdate=c.transformCameraUpdate,this.transformConstrain=c.transformConstrain,this.cancelPendingTileRequestsWhileZooming=c.cancelPendingTileRequestsWhileZooming===!0,c.reduceMotion!==void 0&&(ge.prefersReducedMotion=c.reduceMotion),this._imageQueueHandle=je.addThrottleControl((()=>this.isMoving())),this._requestManager=new B(c.transformRequest),typeof c.container=="string"){if(this._container=document.getElementById(c.container),!this._container)throw new Error(`Container '${c.container}' not found.`)}else{if(!(c.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=c.container}if(c.maxBounds&&this.setMaxBounds(c.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",(()=>this._update(!1))),this.on("moveend",(()=>this._update(!1))),this.on("zoom",(()=>this._update(!0))),this.on("terrain",(()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)})),this.once("idle",(()=>{this._idleTriggered=!0})),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let u=!1,G=os((U=>{this._trackResize&&!this._removed&&(this.resize(U),this.redraw())}),50);this._resizeObserver=new ResizeObserver((U=>{u?G(U):u=!0})),this._resizeObserver.observe(this._container)}this.handlers=new co(this,c),this._hash=c.hash&&new rs(typeof c.hash=="string"&&c.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:c.center,elevation:c.elevation,zoom:c.zoom,bearing:c.bearing,pitch:c.pitch,roll:c.roll}),c.bounds&&(this.resize(),this.fitBounds(c.bounds,o.e({},c.fitBoundsOptions,{duration:0}))));let Z=typeof c.style=="string"||((a=(e=c.style)===null||e===void 0?void 0:e.projection)===null||a===void 0?void 0:a.type)!=="globe";this.resize(null,Z),this._localIdeographFontFamily=c.localIdeographFontFamily,this._validateStyle=c.validateStyle,c.style&&this.setStyle(c.style,{localIdeographFontFamily:c.localIdeographFontFamily}),c.attributionControl&&this.addControl(new ia(typeof c.attributionControl=="boolean"?void 0:c.attributionControl)),c.maplibreLogo&&this.addControl(new en,c.logoPosition),this.on("style.load",(()=>{if(Z||this._resizeTransform(),this.transform.unmodified){let u=o.U(this.style.stylesheet,["center","zoom","bearing","pitch","roll"]);this.jumpTo(u)}})),this.on("data",(u=>{this._update(u.dataType==="style"),this.fire(new o.l(`${u.dataType}data`,u))})),this.on("dataloading",(u=>{this.fire(new o.l(`${u.dataType}dataloading`,u))})),this.on("dataabort",(u=>{this.fire(new o.l("sourcedataabort",u))}))}_getMapId(){return this._mapId}setGlobalStateProperty(m,e){return this.style.setGlobalStateProperty(m,e),this._update(!0)}getGlobalState(){return this.style.getGlobalState()}addControl(m,e){if(e===void 0&&(e=m.getDefaultPosition?m.getDefaultPosition():"top-right"),!m||!m.onAdd)return this.fire(new o.k(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));let a=m.onAdd(this);this._controls.push(m);let c=this._controlPositions[e];return e.indexOf("bottom")!==-1?c.insertBefore(a,c.firstChild):c.appendChild(a),this}removeControl(m){if(!m||!m.onRemove)return this.fire(new o.k(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));let e=this._controls.indexOf(m);return e>-1&&this._controls.splice(e,1),m.onRemove(this),this}hasControl(m){return this._controls.indexOf(m)>-1}coveringTiles(m){return Be(this.transform,m)}calculateCameraOptionsFromTo(m,e,a,c){return c==null&&this.terrain&&(c=this.terrain.getElevationForLngLatZoom(a,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(m,e,a,c)}resize(m,e=!0){let[a,c]=this._containerDimensions(),s=this._getClampedPixelRatio(a,c);if(this._resizeCanvas(a,c,s),this.painter.resize(a,c,s),this.painter.overLimit()){let Z=this.painter.context.gl;this._maxCanvasSize=[Z.drawingBufferWidth,Z.drawingBufferHeight];let u=this._getClampedPixelRatio(a,c);this._resizeCanvas(a,c,u),this.painter.resize(a,c,u)}this._resizeTransform(e);let W=!this._moving;return W&&(this.stop(),this.fire(new o.l("movestart",m)).fire(new o.l("move",m))),this.fire(new o.l("resize",m)),W&&this.fire(new o.l("moveend",m)),this}_resizeTransform(m=!0){var e;let[a,c]=this._containerDimensions();this.transform.resize(a,c,m),(e=this._requestedCameraState)===null||e===void 0||e.resize(a,c,m)}_getClampedPixelRatio(m,e){let{0:a,1:c}=this._maxCanvasSize,s=this.getPixelRatio(),W=m*s,Z=e*s;return Math.min(W>a?a/W:1,Z>c?c/Z:1)*s}getPixelRatio(){var m;return(m=this._overridePixelRatio)!==null&&m!==void 0?m:devicePixelRatio}setPixelRatio(m){this._overridePixelRatio=m,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(m){return this.transform.setMaxBounds(si.convert(m)),this._update()}setMinZoom(m){if((m=m??-2)>=-2&&m<=this.transform.maxZoom)return this.transform.setMinZoom(m),this._update(),this.getZoom()<m&&this.setZoom(m),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(m){if((m=m??22)>=this.transform.minZoom)return this.transform.setMaxZoom(m),this._update(),this.getZoom()>m&&this.setZoom(m),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(m){if((m=m??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(m>=0&&m<=this.transform.maxPitch)return this.transform.setMinPitch(m),this._update(),this.getPitch()<m&&this.setPitch(m),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(m){if((m=m??60)>180)throw new Error("maxPitch must be less than or equal to 180");if(m>=this.transform.minPitch)return this.transform.setMaxPitch(m),this._update(),this.getPitch()>m&&this.setPitch(m),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(m){return this.transform.setRenderWorldCopies(m),this._update()}setTransformConstrain(m){return this.transform.setConstrainOverride(m),this._update()}project(m){return this.transform.locationToScreenPoint(o.V.convert(m),this.style&&this.terrain)}unproject(m){return this.transform.screenPointToLocation(o.P.convert(m),this.terrain)}isMoving(){var m;return this._moving||((m=this.handlers)===null||m===void 0?void 0:m.isMoving())}isZooming(){var m;return this._zooming||((m=this.handlers)===null||m===void 0?void 0:m.isZooming())}isRotating(){var m;return this._rotating||((m=this.handlers)===null||m===void 0?void 0:m.isRotating())}_createDelegatedListener(m,e,a){if(m==="mouseenter"||m==="mouseover"){let c=!1;return{layers:e,listener:a,delegates:{mousemove:W=>{let Z=e.filter((G=>this.getLayer(G))),u=Z.length!==0?this.queryRenderedFeatures(W.point,{layers:Z}):[];u.length?c||(c=!0,a.call(this,new _i(m,this,W.originalEvent,{features:u}))):c=!1},mouseout:()=>{c=!1}}}}if(m==="mouseleave"||m==="mouseout"){let c=!1;return{layers:e,listener:a,delegates:{mousemove:Z=>{let u=e.filter((G=>this.getLayer(G)));(u.length!==0?this.queryRenderedFeatures(Z.point,{layers:u}):[]).length?c=!0:c&&(c=!1,a.call(this,new _i(m,this,Z.originalEvent)))},mouseout:Z=>{c&&(c=!1,a.call(this,new _i(m,this,Z.originalEvent)))}}}}{let c=s=>{let W=e.filter((u=>this.getLayer(u))),Z=W.length!==0?this.queryRenderedFeatures(s.point,{layers:W}):[];Z.length&&(s.features=Z,a.call(this,s),delete s.features)};return{layers:e,listener:a,delegates:{[m]:c}}}}_saveDelegatedListener(m,e){this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[m]=this._delegatedListeners[m]||[],this._delegatedListeners[m].push(e)}_removeDelegatedListener(m,e,a){if(!this._delegatedListeners||!this._delegatedListeners[m])return;let c=this._delegatedListeners[m];for(let s=0;s<c.length;s++){let W=c[s];if(W.listener===a&&W.layers.length===e.length&&W.layers.every((Z=>e.includes(Z)))){for(let Z in W.delegates)this.off(Z,W.delegates[Z]);return void c.splice(s,1)}}}on(m,e,a){if(a===void 0)return super.on(m,e);let c=typeof e=="string"?[e]:e,s=this._createDelegatedListener(m,c,a);this._saveDelegatedListener(m,s);for(let W in s.delegates)this.on(W,s.delegates[W]);return{unsubscribe:()=>{this._removeDelegatedListener(m,c,a)}}}once(m,e,a){if(a===void 0)return super.once(m,e);let c=typeof e=="string"?[e]:e,s=this._createDelegatedListener(m,c,a);for(let W in s.delegates){let Z=s.delegates[W];s.delegates[W]=(...u)=>{this._removeDelegatedListener(m,c,a),Z(...u)}}this._saveDelegatedListener(m,s);for(let W in s.delegates)this.once(W,s.delegates[W]);return this}off(m,e,a){return a===void 0?super.off(m,e):(this._removeDelegatedListener(m,typeof e=="string"?[e]:e,a),this)}queryRenderedFeatures(m,e){if(!this.style)return[];let a,c=m instanceof o.P||Array.isArray(m),s=c?m:[[0,0],[this.transform.width,this.transform.height]];if(e=e||(c?{}:m)||{},s instanceof o.P||typeof s[0]=="number")a=[o.P.convert(s)];else{let W=o.P.convert(s[0]),Z=o.P.convert(s[1]);a=[W,new o.P(Z.x,W.y),Z,new o.P(W.x,Z.y),W]}return this.style.queryRenderedFeatures(a,e,this.transform)}querySourceFeatures(m,e){return this.style.querySourceFeatures(m,e)}setStyle(m,e){return(e=o.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},e)).diff!==!1&&e.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&m?(this._diffStyle(m,e),this):(this._localIdeographFontFamily=e.localIdeographFontFamily,this._updateStyle(m,e))}setTransformRequest(m){return this._requestManager.setTransformRequest(m),this}_getUIString(m){let e=this._locale[m];if(e==null)throw new Error(`Missing UI string '${m}'`);return e}_updateStyle(m,e){var a,c;if(e.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",(()=>this._updateStyle(m,e)));let s=this.style&&e.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!m)),m?(this.style=new Gi(this,e||{}),this.style.setEventedParent(this,{style:this.style}),typeof m=="string"?this.style.loadURL(m,e,s):this.style.loadJSON(m,e,s),this):((c=(a=this.style)===null||a===void 0?void 0:a.projection)===null||c===void 0||c.destroy(),delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new Gi(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(m,e){if(typeof m=="string"){let a=this._requestManager.transformRequest(m,"Style");o.j(a,new AbortController).then((c=>{this._updateDiff(c.data,e)})).catch((c=>{c&&this.fire(new o.k(c))}))}else typeof m=="object"&&this._updateDiff(m,e)}_updateDiff(m,e){try{this.style.setState(m,e)&&this._update(!0)}catch(a){o.w(`Unable to perform style diff: ${a.message||a.error||a}.  Rebuilding the style from scratch.`),this._updateStyle(m,e)}}getStyle(){if(this.style)return this.style.serialize()}_getStyleAndImages(){return this.style?{style:this.style.serialize(),images:this.style.imageManager.cloneImages()}:{style:null,images:{}}}isStyleLoaded(){return this.style?this.style.loaded():o.w("There is no style added to the map.")}addSource(m,e){return this._lazyInitEmptyStyle(),this.style.addSource(m,e),this._update(!0)}isSourceLoaded(m){let e=this.style&&this.style.tileManagers[m];if(e!==void 0)return e.loaded();this.fire(new o.k(new Error(`There is no tile manager with ID '${m}'`)))}setTerrain(m){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),m){let e=this.style.tileManagers[m.source];if(!e)throw new Error(`cannot load terrain, because there exists no source with ID: ${m.source}`);this.terrain===null&&e.reload();for(let a in this.style._layers){let c=this.style._layers[a];c.type==="hillshade"&&c.source===m.source&&o.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality."),c.type==="color-relief"&&c.source===m.source&&o.w("You are using the same source for a color-relief layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new nm(this.painter,e,m),this.painter.renderToTexture=new ll(this.painter,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._terrainDataCallback=a=>{var c;a.dataType==="style"?this.terrain.tileManager.freeRtt():a.dataType==="source"&&a.tile&&(a.sourceId!==m.source||this._elevationFreeze||(this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))),((c=a.source)===null||c===void 0?void 0:c.type)==="image"?this.terrain.tileManager.freeRtt():this.terrain.tileManager.freeRtt(a.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.tileManager.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0);return this.fire(new o.l("terrain",{terrain:m})),this}getTerrain(){var m,e;return(e=(m=this.terrain)===null||m===void 0?void 0:m.options)!==null&&e!==void 0?e:null}areTilesLoaded(){let m=this.style&&this.style.tileManagers;for(let e in m){let a=m[e]._tiles;for(let c in a){let s=a[c];if(s.state!=="loaded"&&s.state!=="errored")return!1}}return!0}removeSource(m){return this.style.removeSource(m),this._update(!0)}getSource(m){return this.style.getSource(m)}setSourceTileLodParams(m,e,a){if(a){let c=this.getSource(a);if(!c)throw new Error(`There is no source with ID "${a}", cannot set LOD parameters`);c.calculateTileZoom=Jt(Math.max(1,m),Math.max(1,e))}else for(let c in this.style.tileManagers)this.style.tileManagers[c].getSource().calculateTileZoom=Jt(Math.max(1,m),Math.max(1,e));return this._update(!0),this}refreshTiles(m,e){let a=this.style.tileManagers[m];if(!a)throw new Error(`There is no tile manager with ID "${m}", cannot refresh tile`);e===void 0?a.reload(!0):a.refreshTiles(e.map((c=>new o.ad(c.z,c.x,c.y))))}addImage(m,e,a={}){let{pixelRatio:c=1,sdf:s=!1,stretchX:W,stretchY:Z,content:u,textFitWidth:G,textFitHeight:U}=a;if(this._lazyInitEmptyStyle(),!(e instanceof HTMLImageElement||o.b(e))){if(e.width===void 0||e.height===void 0)return this.fire(new o.k(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{let{width:X,height:Q,data:k}=e,j=e;return this.style.addImage(m,{data:new o.R({width:X,height:Q},new Uint8Array(k)),pixelRatio:c,stretchX:W,stretchY:Z,content:u,textFitWidth:G,textFitHeight:U,sdf:s,version:0,userImage:j}),j.onAdd&&j.onAdd(this,m),this}}{let{width:X,height:Q,data:k}=ge.getImageData(e);this.style.addImage(m,{data:new o.R({width:X,height:Q},k),pixelRatio:c,stretchX:W,stretchY:Z,content:u,textFitWidth:G,textFitHeight:U,sdf:s,version:0})}}updateImage(m,e){let a=this.style.getImage(m);if(!a)return this.fire(new o.k(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));let c=e instanceof HTMLImageElement||o.b(e)?ge.getImageData(e):e,{width:s,height:W,data:Z}=c;if(s===void 0||W===void 0)return this.fire(new o.k(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(s!==a.data.width||W!==a.data.height)return this.fire(new o.k(new Error("The width and height of the updated image must be that same as the previous version of the image")));let u=!(e instanceof HTMLImageElement||o.b(e));return a.data.replace(Z,u),this.style.updateImage(m,a),this}getImage(m){return this.style.getImage(m)}hasImage(m){return m?!!this.style.getImage(m):(this.fire(new o.k(new Error("Missing required image id"))),!1)}removeImage(m){this.style.removeImage(m)}loadImage(m){return je.getImage(this._requestManager.transformRequest(m,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(m,e){return this._lazyInitEmptyStyle(),this.style.addLayer(m,e),this._update(!0)}moveLayer(m,e){return this.style.moveLayer(m,e),this._update(!0)}removeLayer(m){return this.style.removeLayer(m),this._update(!0)}getLayer(m){return this.style.getLayer(m)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(m,e,a){return this.style.setLayerZoomRange(m,e,a),this._update(!0)}setFilter(m,e,a={}){return this.style.setFilter(m,e,a),this._update(!0)}getFilter(m){return this.style.getFilter(m)}setPaintProperty(m,e,a,c={}){return this.style.setPaintProperty(m,e,a,c),this._update(!0)}getPaintProperty(m,e){return this.style.getPaintProperty(m,e)}setLayoutProperty(m,e,a,c={}){return this.style.setLayoutProperty(m,e,a,c),this._update(!0)}getLayoutProperty(m,e){return this.style.getLayoutProperty(m,e)}setGlyphs(m,e={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(m,e),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(m,e,a={}){return this._lazyInitEmptyStyle(),this.style.addSprite(m,e,a,(c=>{c||this._update(!0)})),this}removeSprite(m){return this._lazyInitEmptyStyle(),this.style.removeSprite(m),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(m,e={}){return this._lazyInitEmptyStyle(),this.style.setSprite(m,e,(a=>{a||this._update(!0)})),this}setLight(m,e={}){return this._lazyInitEmptyStyle(),this.style.setLight(m,e),this._update(!0)}getLight(){return this.style.getLight()}setSky(m,e={}){return this._lazyInitEmptyStyle(),this.style.setSky(m,e),this._update(!0)}getSky(){return this.style.getSky()}setFeatureState(m,e){return this.style.setFeatureState(m,e),this._update()}removeFeatureState(m,e){return this.style.removeFeatureState(m,e),this._update()}getFeatureState(m){return this.style.getFeatureState(m)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let m=0,e=0;return this._container&&(m=this._container.clientWidth||400,e=this._container.clientHeight||300),[m,e]}_setupContainer(){let m=this._container;m.classList.add("maplibregl-map");let e=this._canvasContainer=gt.create("div","maplibregl-canvas-container",m);this._interactive&&e.classList.add("maplibregl-interactive"),this._canvas=gt.create("canvas","maplibregl-canvas",e),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",this._interactive?"0":"-1"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region");let a=this._containerDimensions(),c=this._getClampedPixelRatio(a[0],a[1]);this._resizeCanvas(a[0],a[1],c);let s=this._controlContainer=gt.create("div","maplibregl-control-container",m),W=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach((Z=>{W[Z]=gt.create("div",`maplibregl-ctrl-${Z} `,s)})),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(m,e,a){this._canvas.width=Math.floor(a*m),this._canvas.height=Math.floor(a*e),this._canvas.style.width=`${m}px`,this._canvas.style.height=`${e}px`}_setupPainter(){let m=Object.assign(Object.assign({},this._canvasContextAttributes),{alpha:!0,depth:!0,stencil:!0,premultipliedAlpha:!0}),e=null;this._canvas.addEventListener("webglcontextcreationerror",(c=>{e={requestedAttributes:m},c&&(e.statusMessage=c.statusMessage,e.type=c.type)}),{once:!0});let a=null;if(a=this._canvasContextAttributes.contextType?this._canvas.getContext(this._canvasContextAttributes.contextType,m):this._canvas.getContext("webgl2",m)||this._canvas.getContext("webgl",m),!a){let c="Failed to initialize WebGL";throw e?(e.message=c,new Error(JSON.stringify(e))):new Error(c)}this.painter=new U0(a,this.transform),Ie.testSupport(a)}migrateProjection(m,e){super.migrateProjection(m,e),this.painter.transform=m,this.fire(new o.l("projectiontransition",{newProjection:this.style.projection.name}))}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(m){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||m,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(m){return this._update(),this._renderTaskQueue.add(m)}_cancelRenderFrame(m){this._renderTaskQueue.remove(m)}_render(m){var e,a,c,s,W;let Z=this._idleTriggered?this._fadeDuration:0,u=((e=this.style.projection)===null||e===void 0?void 0:e.transitionState)>0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(m),this._removed)return;let G=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;let Q=this.transform.zoom,k=jt();this.style.zoomHistory.update(Q,k);let j=new o.H(Q,{now:k,fadeDuration:Z,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),H=j.crossFadingFactor();H===1&&H===this._crossFadingFactor||(G=!0,this._crossFadingFactor=H),this.style.update(j)}let U=((a=this.style.projection)===null||a===void 0?void 0:a.transitionState)>0!==u;(c=this.style.projection)===null||c===void 0||c.setErrorQueryLatitudeDegrees(this.transform.center.lat),this.transform.setTransitionState((s=this.style.projection)===null||s===void 0?void 0:s.transitionState,(W=this.style.projection)===null||W===void 0?void 0:W.latitudeErrorCorrectionRadians),this.style&&(this._sourcesDirty||U)&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.tileManager.update(this.transform,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),!this._elevationFreeze&&this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0)),this._placementDirty=this.style&&this.style._updatePlacement(this.transform,this.showCollisionBoxes,Z,this._crossSourceCollisions,U),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:Z,showPadding:this.showPadding}),this.fire(new o.l("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,o.cF.mark(o.cG.load),this.fire(new o.l("load"))),this.style&&(this.style.hasTransitions()||G)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();let X=this._sourcesDirty||this._styleDirty||this._placementDirty;return X||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new o.l("idle")),!this._loaded||this._fullyLoaded||X||(this._fullyLoaded=!0,o.cF.mark(o.cG.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var m;this._hash&&this._hash.remove();for(let a of this._controls)a.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),je.removeThrottleControl(this._imageQueueHandle),(m=this._resizeObserver)===null||m===void 0||m.disconnect();let e=this.painter.context.gl.getExtension("WEBGL_lose_context");e?.loseContext&&e.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),gt.remove(this._canvasContainer),gt.remove(this._controlContainer),this._container.removeEventListener("scroll",this._onMapScroll,!1),this._container.classList.remove("maplibregl-map"),o.cF.clearMetrics(),this._removed=!0,this.fire(new o.l("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,ge.frame(this._frameRequest,(m=>{o.cF.frame(m),this._frameRequest=null;try{this._render(m)}catch(e){if(!o.cH(e)&&!(function(a){return a.message===_o})(e))throw e}}),(()=>{})))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(m){this._showTileBoundaries!==m&&(this._showTileBoundaries=m,this._update())}get showPadding(){return!!this._showPadding}set showPadding(m){this._showPadding!==m&&(this._showPadding=m,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(m){this._showCollisionBoxes!==m&&(this._showCollisionBoxes=m,m?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(m){this._showOverdrawInspector!==m&&(this._showOverdrawInspector=m,this._update())}get repaint(){return!!this._repaint}set repaint(m){this._repaint!==m&&(this._repaint=m,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(m){this._vertices=m,this._update()}get version(){return so}getCameraTargetElevation(){return this.transform.elevation}getProjection(){return this.style.getProjection()}setProjection(m){return this._lazyInitEmptyStyle(),this.style.setProjection(m),this._update(!0)}},I.MapMouseEvent=_i,I.MapTouchEvent=$c,I.MapWheelEvent=wd,I.Marker=Wo,I.NavigationControl=class{constructor(m){this._updateZoomButtons=()=>{let e=this._map.getZoom(),a=e===this._map.getMaxZoom(),c=e===this._map.getMinZoom();this._zoomInButton.disabled=a,this._zoomOutButton.disabled=c,this._zoomInButton.setAttribute("aria-disabled",a.toString()),this._zoomOutButton.setAttribute("aria-disabled",c.toString())},this._rotateCompassArrow=()=>{this._compassIcon.style.transform=this.options.visualizePitch&&this.options.visualizeRoll?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateZ(${-this._map.transform.roll}deg) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizeRoll?`rotate(${-this._map.transform.bearing-this._map.transform.roll}deg)`:`rotate(${-this._map.transform.bearing}deg)`},this._setButtonTitle=(e,a)=>{let c=this._map._getUIString(`NavigationControl.${a}`);e.title=c,e.setAttribute("aria-label",c)},this.options=o.e({},us,m),this._container=gt.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",(e=>e.preventDefault())),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",(e=>this._map.zoomIn({},{originalEvent:e}))),gt.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",(e=>this._map.zoomOut({},{originalEvent:e}))),gt.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",(e=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:e}):this._map.resetNorth({},{originalEvent:e})})),this._compassIcon=gt.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(m){return this._map=m,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.on("roll",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Rs(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){gt.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.off("roll",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(m,e){let a=gt.create("button",m,this._container);return a.type="button",a.addEventListener("click",e),a}},I.Popup=class extends o.E{constructor(m){super(),this._updateOpacity=()=>{this.options.locationOccludedOpacity!==void 0&&(this._container.style.opacity=this._map.transform.isLocationOccluded(this.getLngLat())?`${this.options.locationOccludedOpacity}`:"")},this.remove=()=>(this._content&&gt.remove(this._content),this._container&&(gt.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new o.l("close"))),this),this._onMouseUp=e=>{this._update(e.point)},this._onMouseMove=e=>{this._update(e.point)},this._onDrag=e=>{this._update(e.point)},this._update=e=>{if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=gt.create("div","maplibregl-popup",this._map.getContainer()),this._tip=gt.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(let Z of this.options.className.split(" "))this._container.classList.add(Z);this._closeButton&&this._closeButton.setAttribute("aria-label",this._map._getUIString("Popup.Close")),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=Fc(this._lngLat,this._flatPos,this._map.transform,this._trackPointer),this._trackPointer&&!e)return;let a=this._flatPos=this._pos=this._trackPointer&&e?e:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&e?e:this._map.transform.locationToScreenPoint(this._lngLat));let c=this.options.anchor,s=br(this.options.offset);if(!c){let Z=this._container.offsetWidth,u=this._container.offsetHeight,G;G=a.y+s.bottom.y<u?["top"]:a.y>this._map.transform.height-u?["bottom"]:[],a.x<Z/2?G.push("left"):a.x>this._map.transform.width-Z/2&&G.push("right"),c=G.length===0?"bottom":G.join("-")}let W=a.add(s[c]);this.options.subpixelPositioning||(W=W.round()),gt.setTransform(this._container,`${mo[c]} translate(${W.x}px,${W.y}px)`),or(this._container,c,"popup"),this._updateOpacity()},this._onClose=()=>{this.remove()},this.options=o.e(Object.create(sr),m)}addTo(m){return this._map&&this.remove(),this._map=m,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new o.l("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(m){return this._lngLat=o.V.convert(m),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(m){return this.setDOMContent(document.createTextNode(m))}setHTML(m){let e=document.createDocumentFragment(),a=document.createElement("body"),c;for(a.innerHTML=m;c=a.firstChild,c;)e.appendChild(c);return this.setDOMContent(e)}getMaxWidth(){var m;return(m=this._container)===null||m===void 0?void 0:m.style.maxWidth}setMaxWidth(m){return this.options.maxWidth=m,this._update(),this}setDOMContent(m){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=gt.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(m),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(m){return this._container&&this._container.classList.add(m),this}removeClassName(m){return this._container&&this._container.classList.remove(m),this}setOffset(m){return this.options.offset=m,this._update(),this}toggleClassName(m){if(this._container)return this._container.classList.toggle(m)}setSubpixelPositioning(m){this.options.subpixelPositioning=m}_createCloseButton(){this.options.closeButton&&(this._closeButton=gt.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;let m=this._container.querySelector(Ns);m&&m.focus()}},I.RasterDEMTileSource=Ha,I.RasterTileSource=Rn,I.ScaleControl=class{constructor(m){this._onMove=()=>{rr(this._map,this._container,this.options)},this.setUnit=e=>{this.options.unit=e,rr(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},Gs),m)}getDefaultPosition(){return"bottom-left"}onAdd(m){return this._map=m,this._container=gt.create("div","maplibregl-ctrl maplibregl-ctrl-scale",m.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){gt.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},I.ScrollZoomHandler=ao,I.Style=Gi,I.TerrainControl=class{constructor(m){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=m}onAdd(m){return this._map=m,this._container=gt.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=gt.create("button","maplibregl-ctrl-terrain",this._container),gt.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){gt.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},I.TwoFingersTouchPitchHandler=Zs,I.TwoFingersTouchRotateHandler=Ws,I.TwoFingersTouchZoomHandler=B0,I.TwoFingersTouchZoomRotateHandler=Q0,I.VectorTileSource=wi,I.VideoSource=We,I.addSourceType=(m,e)=>o._(void 0,void 0,void 0,(function*(){if(cn(m))throw new Error(`A source type called "${m}" already exists.`);((a,c)=>{Da[a]=c})(m,e)})),I.clearPrewarmedResources=function(){let m=qi;m&&(m.isPreloaded()&&m.numActive()===1?(m.release(xl),qi=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},I.createTileMesh=bc,I.getMaxParallelImageRequests=function(){return o.a.MAX_PARALLEL_IMAGE_REQUESTS},I.getRTLTextPluginStatus=function(){return zl().getRTLTextPluginStatus()},I.getVersion=function(){return mr},I.getWorkerCount=function(){return _l.workerCount},I.getWorkerUrl=function(){return o.a.WORKER_URL},I.importScriptInWorkers=function(m){return $i().broadcast("IS",m)},I.isTimeFrozen=function(){return ye.isFrozen()},I.now=jt,I.prewarm=function(){Sa().acquire(xl)},I.restoreNow=function(){ye.restoreNow()},I.setMaxParallelImageRequests=function(m){o.a.MAX_PARALLEL_IMAGE_REQUESTS=m},I.setNow=function(m){ye.setNow(m)},I.setRTLTextPlugin=function(m,e){return zl().setRTLTextPlugin(m,e)},I.setWorkerCount=function(m){_l.workerCount=m},I.setWorkerUrl=function(m){o.a.WORKER_URL=m}}));var D=x;return D}))});var Ap=tZ((jp,Db)=>{(function(x,g){"use strict";typeof Db=="object"&&typeof Db.exports=="object"?Db.exports=x.document?g(x,!0):function(Y){if(!Y.document)throw new Error("jQuery requires a window with a document");return g(Y)}:g(x)})(typeof window<"u"?window:jp,function(x,g){"use strict";var Y=[],D=Object.getPrototypeOf,I=Y.slice,o=Y.flat?function(p){return Y.flat.call(p)}:function(p){return Y.concat.apply([],p)},st=Y.push,Ct=Y.indexOf,vt={},de=vt.toString,ee=vt.hasOwnProperty,ge=ee.toString,ye=ge.call(Object),jt={},gt=function(F){return typeof F=="function"&&typeof F.nodeType!="number"&&typeof F.item!="function"},Ie=function(F){return F!=null&&F===F.window},te=x.document,Ue={type:!0,src:!0,nonce:!0,noModule:!0};function di(p,F,T){T=T||te;var y,E,A=T.createElement("script");if(A.text=p,F)for(y in Ue)E=F[y]||F.getAttribute&&F.getAttribute(y),E&&A.setAttribute(y,E);T.head.appendChild(A).parentNode.removeChild(A)}function li(p){return p==null?p+"":typeof p=="object"||typeof p=="function"?vt[de.call(p)]||"object":typeof p}var ze="3.7.1",je=/HTML$/i,B=function(p,F){return new B.fn.init(p,F)};B.fn=B.prototype={jquery:ze,constructor:B,length:0,toArray:function(){return I.call(this)},get:function(p){return p==null?I.call(this):p<0?this[p+this.length]:this[p]},pushStack:function(p){var F=B.merge(this.constructor(),p);return F.prevObject=this,F},each:function(p){return B.each(this,p)},map:function(p){return this.pushStack(B.map(this,function(F,T){return p.call(F,T,F)}))},slice:function(){return this.pushStack(I.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},even:function(){return this.pushStack(B.grep(this,function(p,F){return(F+1)%2}))},odd:function(){return this.pushStack(B.grep(this,function(p,F){return F%2}))},eq:function(p){var F=this.length,T=+p+(p<0?F:0);return this.pushStack(T>=0&&T<F?[this[T]]:[])},end:function(){return this.prevObject||this.constructor()},push:st,sort:Y.sort,splice:Y.splice},B.extend=B.fn.extend=function(){var p,F,T,y,E,A,f=arguments[0]||{},bt=1,ct=arguments.length,Gt=!1;for(typeof f=="boolean"&&(Gt=f,f=arguments[bt]||{},bt++),typeof f!="object"&&!gt(f)&&(f={}),bt===ct&&(f=this,bt--);bt<ct;bt++)if((p=arguments[bt])!=null)for(F in p)y=p[F],!(F==="__proto__"||f===y)&&(Gt&&y&&(B.isPlainObject(y)||(E=Array.isArray(y)))?(T=f[F],E&&!Array.isArray(T)?A=[]:!E&&!B.isPlainObject(T)?A={}:A=T,E=!1,f[F]=B.extend(Gt,A,y)):y!==void 0&&(f[F]=y));return f},B.extend({expando:"jQuery"+(ze+Math.random()).replace(/\D/g,""),isReady:!0,error:function(p){throw new Error(p)},noop:function(){},isPlainObject:function(p){var F,T;return!p||de.call(p)!=="[object Object]"?!1:(F=D(p),F?(T=ee.call(F,"constructor")&&F.constructor,typeof T=="function"&&ge.call(T)===ye):!0)},isEmptyObject:function(p){var F;for(F in p)return!1;return!0},globalEval:function(p,F,T){di(p,{nonce:F&&F.nonce},T)},each:function(p,F){var T,y=0;if(ii(p))for(T=p.length;y<T&&F.call(p[y],y,p[y])!==!1;y++);else for(y in p)if(F.call(p[y],y,p[y])===!1)break;return p},text:function(p){var F,T="",y=0,E=p.nodeType;if(!E)for(;F=p[y++];)T+=B.text(F);return E===1||E===11?p.textContent:E===9?p.documentElement.textContent:E===3||E===4?p.nodeValue:T},makeArray:function(p,F){var T=F||[];return p!=null&&(ii(Object(p))?B.merge(T,typeof p=="string"?[p]:p):st.call(T,p)),T},inArray:function(p,F,T){return F==null?-1:Ct.call(F,p,T)},isXMLDoc:function(p){var F=p&&p.namespaceURI,T=p&&(p.ownerDocument||p).documentElement;return!je.test(F||T&&T.nodeName||"HTML")},merge:function(p,F){for(var T=+F.length,y=0,E=p.length;y<T;y++)p[E++]=F[y];return p.length=E,p},grep:function(p,F,T){for(var y,E=[],A=0,f=p.length,bt=!T;A<f;A++)y=!F(p[A],A),y!==bt&&E.push(p[A]);return E},map:function(p,F,T){var y,E,A=0,f=[];if(ii(p))for(y=p.length;A<y;A++)E=F(p[A],A,T),E!=null&&f.push(E);else for(A in p)E=F(p[A],A,T),E!=null&&f.push(E);return o(f)},guid:1,support:jt}),typeof Symbol=="function"&&(B.fn[Symbol.iterator]=Y[Symbol.iterator]),B.each("Boolean Number String Function Array Date RegExp Object Error Symbol".split(" "),function(p,F){vt["[object "+F+"]"]=F.toLowerCase()});function ii(p){var F=!!p&&"length"in p&&p.length,T=li(p);return gt(p)||Ie(p)?!1:T==="array"||F===0||typeof F=="number"&&F>0&&F-1 in p}function Me(p,F){return p.nodeName&&p.nodeName.toLowerCase()===F.toLowerCase()}var ui=Y.pop,ri=Y.sort,xi=Y.splice,Qe="[\\x20\\t\\r\\n\\f]",Ui=new RegExp("^"+Qe+"+|((?:^|[^\\\\])(?:\\\\.)*)"+Qe+"+$","g");B.contains=function(p,F){var T=F&&F.parentNode;return p===T||!!(T&&T.nodeType===1&&(p.contains?p.contains(T):p.compareDocumentPosition&&p.compareDocumentPosition(T)&16))};var sa=/([\0-\x1f\x7f]|^-?\d)|^-$|[^\x80-\uFFFF\w-]/g;function cl(p,F){return F?p==="\0"?"\uFFFD":p.slice(0,-1)+"\\"+p.charCodeAt(p.length-1).toString(16)+" ":"\\"+p}B.escapeSelector=function(p){return(p+"").replace(sa,cl)};var Ri=te,Le=st;(function(){var p,F,T,y,E,A=Le,f,bt,ct,Gt,kt,Et=B.expando,yt=0,_t=0,Ye=Fd(),ti=Fd(),we=Fd(),Zl=Fd(),Li=function(it,Rt){return it===Rt&&(E=!0),0},Wa="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",yi="(?:\\\\[\\da-fA-F]{1,6}"+Qe+"?|\\\\[^\\r\\n\\f]|[\\w-]|[^\0-\\x7f])+",fe="\\["+Qe+"*("+yi+")(?:"+Qe+"*([*^$|!~]?=)"+Qe+`*(?:'((?:\\\\.|[^\\\\'])*)'|"((?:\\\\.|[^\\\\"])*)"|(`+yi+"))|)"+Qe+"*\\]",ha=":("+yi+`)(?:\\((('((?:\\\\.|[^\\\\'])*)'|"((?:\\\\.|[^\\\\"])*)")|((?:\\\\.|[^\\\\()[\\]]|`+fe+")*)|.*)\\)|)",ei=new RegExp(Qe+"+","g"),Gi=new RegExp("^"+Qe+"*,"+Qe+"*"),ea=new RegExp("^"+Qe+"*([>+~]|"+Qe+")"+Qe+"*"),jc=new RegExp(Qe+"|>"),Ma=new RegExp(ha),mn=new RegExp("^"+yi+"$"),Nl={ID:new RegExp("^#("+yi+")"),CLASS:new RegExp("^\\.("+yi+")"),TAG:new RegExp("^("+yi+"|[*])"),ATTR:new RegExp("^"+fe),PSEUDO:new RegExp("^"+ha),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+Qe+"*(even|odd|(([+-]|)(\\d*)n|)"+Qe+"*(?:([+-]|)"+Qe+"*(\\d+)|))"+Qe+"*\\)|)","i"),bool:new RegExp("^(?:"+Wa+")$","i"),needsContext:new RegExp("^"+Qe+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+Qe+"*((?:-\\d)?\\d*)"+Qe+"*\\)|)(?=[^-]|$)","i")},Yn=/^(?:input|select|textarea|button)$/i,Ya=/^h\d$/i,Za=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,xn=/[+~]/,qa=new RegExp("\\\\[\\da-fA-F]{1,6}"+Qe+"?|\\\\([^\\r\\n\\f])","g"),$a=function(it,Rt){var Mt="0x"+it.slice(1)-65536;return Rt||(Mt<0?String.fromCharCode(Mt+65536):String.fromCharCode(Mt>>10|55296,Mt&1023|56320))},Pr=function(){xa()},Ao=Kn(function(it){return it.disabled===!0&&Me(it,"fieldset")},{dir:"parentNode",next:"legend"});function Ac(){try{return f.activeElement}catch{}}try{A.apply(Y=I.call(Ri.childNodes),Ri.childNodes),Y[Ri.childNodes.length].nodeType}catch{A={apply:function(Rt,Mt){Le.apply(Rt,I.call(Mt))},call:function(Rt){Le.apply(Rt,I.call(arguments,1))}}}function ni(it,Rt,Mt,St){var zt,Dt,oe,Ve,ce,qe,xe,Xe=Rt&&Rt.ownerDocument,ve=Rt?Rt.nodeType:9;if(Mt=Mt||[],typeof it!="string"||!it||ve!==1&&ve!==9&&ve!==11)return Mt;if(!St&&(xa(Rt),Rt=Rt||f,ct)){if(ve!==11&&(ce=Za.exec(it)))if(zt=ce[1]){if(ve===9)if(oe=Rt.getElementById(zt)){if(oe.id===zt)return A.call(Mt,oe),Mt}else return Mt;else if(Xe&&(oe=Xe.getElementById(zt))&&ni.contains(Rt,oe)&&oe.id===zt)return A.call(Mt,oe),Mt}else{if(ce[2])return A.apply(Mt,Rt.getElementsByTagName(it)),Mt;if((zt=ce[3])&&Rt.getElementsByClassName)return A.apply(Mt,Rt.getElementsByClassName(zt)),Mt}if(!Zl[it+" "]&&(!Gt||!Gt.test(it))){if(xe=it,Xe=Rt,ve===1&&(jc.test(it)||ea.test(it))){for(Xe=xn.test(it)&&Gd(Rt.parentNode)||Rt,(Xe!=Rt||!jt.scope)&&((Ve=Rt.getAttribute("id"))?Ve=B.escapeSelector(Ve):Rt.setAttribute("id",Ve=Et)),qe=Cd(it),Dt=qe.length;Dt--;)qe[Dt]=(Ve?"#"+Ve:":scope")+" "+kd(qe[Dt]);xe=qe.join(",")}try{return A.apply(Mt,Xe.querySelectorAll(xe)),Mt}catch{Zl(it,!0)}finally{Ve===Et&&Rt.removeAttribute("id")}}}return mc(it.replace(Ui,"$1"),Rt,Mt,St)}function Fd(){var it=[];function Rt(Mt,St){return it.push(Mt+" ")>F.cacheLength&&delete Rt[it.shift()],Rt[Mt+" "]=St}return Rt}function pa(it){return it[Et]=!0,it}function Tn(it){var Rt=f.createElement("fieldset");try{return!!it(Rt)}catch{return!1}finally{Rt.parentNode&&Rt.parentNode.removeChild(Rt),Rt=null}}function Pn(it){return function(Rt){return Me(Rt,"input")&&Rt.type===it}}function wo(it){return function(Rt){return(Me(Rt,"input")||Me(Rt,"button"))&&Rt.type===it}}function wc(it){return function(Rt){return"form"in Rt?Rt.parentNode&&Rt.disabled===!1?"label"in Rt?"label"in Rt.parentNode?Rt.parentNode.disabled===it:Rt.disabled===it:Rt.isDisabled===it||Rt.isDisabled!==!it&&Ao(Rt)===it:Rt.disabled===it:"label"in Rt?Rt.disabled===it:!1}}function La(it){return pa(function(Rt){return Rt=+Rt,pa(function(Mt,St){for(var zt,Dt=it([],Mt.length,Rt),oe=Dt.length;oe--;)Mt[zt=Dt[oe]]&&(Mt[zt]=!(St[zt]=Mt[zt]))})})}function Gd(it){return it&&typeof it.getElementsByTagName<"u"&&it}function xa(it){var Rt,Mt=it?it.ownerDocument||it:Ri;return Mt==f||Mt.nodeType!==9||!Mt.documentElement||(f=Mt,bt=f.documentElement,ct=!B.isXMLDoc(f),kt=bt.matches||bt.webkitMatchesSelector||bt.msMatchesSelector,bt.msMatchesSelector&&Ri!=f&&(Rt=f.defaultView)&&Rt.top!==Rt&&Rt.addEventListener("unload",Pr),jt.getById=Tn(function(St){return bt.appendChild(St).id=B.expando,!f.getElementsByName||!f.getElementsByName(B.expando).length}),jt.disconnectedMatch=Tn(function(St){return kt.call(St,"*")}),jt.scope=Tn(function(){return f.querySelectorAll(":scope")}),jt.cssHas=Tn(function(){try{return f.querySelector(":has(*,:jqfake)"),!1}catch{return!0}}),jt.getById?(F.filter.ID=function(St){var zt=St.replace(qa,$a);return function(Dt){return Dt.getAttribute("id")===zt}},F.find.ID=function(St,zt){if(typeof zt.getElementById<"u"&&ct){var Dt=zt.getElementById(St);return Dt?[Dt]:[]}}):(F.filter.ID=function(St){var zt=St.replace(qa,$a);return function(Dt){var oe=typeof Dt.getAttributeNode<"u"&&Dt.getAttributeNode("id");return oe&&oe.value===zt}},F.find.ID=function(St,zt){if(typeof zt.getElementById<"u"&&ct){var Dt,oe,Ve,ce=zt.getElementById(St);if(ce){if(Dt=ce.getAttributeNode("id"),Dt&&Dt.value===St)return[ce];for(Ve=zt.getElementsByName(St),oe=0;ce=Ve[oe++];)if(Dt=ce.getAttributeNode("id"),Dt&&Dt.value===St)return[ce]}return[]}}),F.find.TAG=function(St,zt){return typeof zt.getElementsByTagName<"u"?zt.getElementsByTagName(St):zt.querySelectorAll(St)},F.find.CLASS=function(St,zt){if(typeof zt.getElementsByClassName<"u"&&ct)return zt.getElementsByClassName(St)},Gt=[],Tn(function(St){var zt;bt.appendChild(St).innerHTML="<a id='"+Et+"' href='' disabled='disabled'></a><select id='"+Et+"-\r\\' disabled='disabled'><option selected=''></option></select>",St.querySelectorAll("[selected]").length||Gt.push("\\["+Qe+"*(?:value|"+Wa+")"),St.querySelectorAll("[id~="+Et+"-]").length||Gt.push("~="),St.querySelectorAll("a#"+Et+"+*").length||Gt.push(".#.+[+~]"),St.querySelectorAll(":checked").length||Gt.push(":checked"),zt=f.createElement("input"),zt.setAttribute("type","hidden"),St.appendChild(zt).setAttribute("name","D"),bt.appendChild(St).disabled=!0,St.querySelectorAll(":disabled").length!==2&&Gt.push(":enabled",":disabled"),zt=f.createElement("input"),zt.setAttribute("name",""),St.appendChild(zt),St.querySelectorAll("[name='']").length||Gt.push("\\["+Qe+"*name"+Qe+"*="+Qe+`*(?:''|"")`)}),jt.cssHas||Gt.push(":has"),Gt=Gt.length&&new RegExp(Gt.join("|")),Li=function(St,zt){if(St===zt)return E=!0,0;var Dt=!St.compareDocumentPosition-!zt.compareDocumentPosition;return Dt||(Dt=(St.ownerDocument||St)==(zt.ownerDocument||zt)?St.compareDocumentPosition(zt):1,Dt&1||!jt.sortDetached&&zt.compareDocumentPosition(St)===Dt?St===f||St.ownerDocument==Ri&&ni.contains(Ri,St)?-1:zt===f||zt.ownerDocument==Ri&&ni.contains(Ri,zt)?1:y?Ct.call(y,St)-Ct.call(y,zt):0:Dt&4?-1:1)}),f}ni.matches=function(it,Rt){return ni(it,null,null,Rt)},ni.matchesSelector=function(it,Rt){if(xa(it),ct&&!Zl[Rt+" "]&&(!Gt||!Gt.test(Rt)))try{var Mt=kt.call(it,Rt);if(Mt||jt.disconnectedMatch||it.document&&it.document.nodeType!==11)return Mt}catch{Zl(Rt,!0)}return ni(Rt,f,null,[it]).length>0},ni.contains=function(it,Rt){return(it.ownerDocument||it)!=f&&xa(it),B.contains(it,Rt)},ni.attr=function(it,Rt){(it.ownerDocument||it)!=f&&xa(it);var Mt=F.attrHandle[Rt.toLowerCase()],St=Mt&&ee.call(F.attrHandle,Rt.toLowerCase())?Mt(it,Rt,!ct):void 0;return St!==void 0?St:it.getAttribute(Rt)},ni.error=function(it){throw new Error("Syntax error, unrecognized expression: "+it)},B.uniqueSort=function(it){var Rt,Mt=[],St=0,zt=0;if(E=!jt.sortStable,y=!jt.sortStable&&I.call(it,0),ri.call(it,Li),E){for(;Rt=it[zt++];)Rt===it[zt]&&(St=Mt.push(zt));for(;St--;)xi.call(it,Mt[St],1)}return y=null,it},B.fn.uniqueSort=function(){return this.pushStack(B.uniqueSort(I.apply(this)))},F=B.expr={cacheLength:50,createPseudo:pa,match:Nl,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(it){return it[1]=it[1].replace(qa,$a),it[3]=(it[3]||it[4]||it[5]||"").replace(qa,$a),it[2]==="~="&&(it[3]=" "+it[3]+" "),it.slice(0,4)},CHILD:function(it){return it[1]=it[1].toLowerCase(),it[1].slice(0,3)==="nth"?(it[3]||ni.error(it[0]),it[4]=+(it[4]?it[5]+(it[6]||1):2*(it[3]==="even"||it[3]==="odd")),it[5]=+(it[7]+it[8]||it[3]==="odd")):it[3]&&ni.error(it[0]),it},PSEUDO:function(it){var Rt,Mt=!it[6]&&it[2];return Nl.CHILD.test(it[0])?null:(it[3]?it[2]=it[4]||it[5]||"":Mt&&Ma.test(Mt)&&(Rt=Cd(Mt,!0))&&(Rt=Mt.indexOf(")",Mt.length-Rt)-Mt.length)&&(it[0]=it[0].slice(0,Rt),it[2]=Mt.slice(0,Rt)),it.slice(0,3))}},filter:{TAG:function(it){var Rt=it.replace(qa,$a).toLowerCase();return it==="*"?function(){return!0}:function(Mt){return Me(Mt,Rt)}},CLASS:function(it){var Rt=Ye[it+" "];return Rt||(Rt=new RegExp("(^|"+Qe+")"+it+"("+Qe+"|$)"))&&Ye(it,function(Mt){return Rt.test(typeof Mt.className=="string"&&Mt.className||typeof Mt.getAttribute<"u"&&Mt.getAttribute("class")||"")})},ATTR:function(it,Rt,Mt){return function(St){var zt=ni.attr(St,it);return zt==null?Rt==="!=":Rt?(zt+="",Rt==="="?zt===Mt:Rt==="!="?zt!==Mt:Rt==="^="?Mt&&zt.indexOf(Mt)===0:Rt==="*="?Mt&&zt.indexOf(Mt)>-1:Rt==="$="?Mt&&zt.slice(-Mt.length)===Mt:Rt==="~="?(" "+zt.replace(ei," ")+" ").indexOf(Mt)>-1:Rt==="|="?zt===Mt||zt.slice(0,Mt.length+1)===Mt+"-":!1):!0}},CHILD:function(it,Rt,Mt,St,zt){var Dt=it.slice(0,3)!=="nth",oe=it.slice(-4)!=="last",Ve=Rt==="of-type";return St===1&&zt===0?function(ce){return!!ce.parentNode}:function(ce,qe,xe){var Xe,ve,Ge,Wi,el,il=Dt!==oe?"nextSibling":"previousSibling",Il=ce.parentNode,Oi=Ve&&ce.nodeName.toLowerCase(),$n=!xe&&!Ve,yl=!1;if(Il){if(Dt){for(;il;){for(Ge=ce;Ge=Ge[il];)if(Ve?Me(Ge,Oi):Ge.nodeType===1)return!1;el=il=it==="only"&&!el&&"nextSibling"}return!0}if(el=[oe?Il.firstChild:Il.lastChild],oe&&$n){for(ve=Il[Et]||(Il[Et]={}),Xe=ve[it]||[],Wi=Xe[0]===yt&&Xe[1],yl=Wi&&Xe[2],Ge=Wi&&Il.childNodes[Wi];Ge=++Wi&&Ge&&Ge[il]||(yl=Wi=0)||el.pop();)if(Ge.nodeType===1&&++yl&&Ge===ce){ve[it]=[yt,Wi,yl];break}}else if($n&&(ve=ce[Et]||(ce[Et]={}),Xe=ve[it]||[],Wi=Xe[0]===yt&&Xe[1],yl=Wi),yl===!1)for(;(Ge=++Wi&&Ge&&Ge[il]||(yl=Wi=0)||el.pop())&&!((Ve?Me(Ge,Oi):Ge.nodeType===1)&&++yl&&($n&&(ve=Ge[Et]||(Ge[Et]={}),ve[it]=[yt,yl]),Ge===ce)););return yl-=zt,yl===St||yl%St===0&&yl/St>=0}}},PSEUDO:function(it,Rt){var Mt,St=F.pseudos[it]||F.setFilters[it.toLowerCase()]||ni.error("unsupported pseudo: "+it);return St[Et]?St(Rt):St.length>1?(Mt=[it,it,"",Rt],F.setFilters.hasOwnProperty(it.toLowerCase())?pa(function(zt,Dt){for(var oe,Ve=St(zt,Rt),ce=Ve.length;ce--;)oe=Ct.call(zt,Ve[ce]),zt[oe]=!(Dt[oe]=Ve[ce])}):function(zt){return St(zt,0,Mt)}):St}},pseudos:{not:pa(function(it){var Rt=[],Mt=[],St=Ed(it.replace(Ui,"$1"));return St[Et]?pa(function(zt,Dt,oe,Ve){for(var ce,qe=St(zt,null,Ve,[]),xe=zt.length;xe--;)(ce=qe[xe])&&(zt[xe]=!(Dt[xe]=ce))}):function(zt,Dt,oe){return Rt[0]=zt,St(Rt,null,oe,Mt),Rt[0]=null,!Mt.pop()}}),has:pa(function(it){return function(Rt){return ni(it,Rt).length>0}}),contains:pa(function(it){return it=it.replace(qa,$a),function(Rt){return(Rt.textContent||B.text(Rt)).indexOf(it)>-1}}),lang:pa(function(it){return mn.test(it||"")||ni.error("unsupported lang: "+it),it=it.replace(qa,$a).toLowerCase(),function(Rt){var Mt;do if(Mt=ct?Rt.lang:Rt.getAttribute("xml:lang")||Rt.getAttribute("lang"))return Mt=Mt.toLowerCase(),Mt===it||Mt.indexOf(it+"-")===0;while((Rt=Rt.parentNode)&&Rt.nodeType===1);return!1}}),target:function(it){var Rt=x.location&&x.location.hash;return Rt&&Rt.slice(1)===it.id},root:function(it){return it===bt},focus:function(it){return it===Ac()&&f.hasFocus()&&!!(it.type||it.href||~it.tabIndex)},enabled:wc(!1),disabled:wc(!0),checked:function(it){return Me(it,"input")&&!!it.checked||Me(it,"option")&&!!it.selected},selected:function(it){return it.parentNode&&it.parentNode.selectedIndex,it.selected===!0},empty:function(it){for(it=it.firstChild;it;it=it.nextSibling)if(it.nodeType<6)return!1;return!0},parent:function(it){return!F.pseudos.empty(it)},header:function(it){return Ya.test(it.nodeName)},input:function(it){return Yn.test(it.nodeName)},button:function(it){return Me(it,"input")&&it.type==="button"||Me(it,"button")},text:function(it){var Rt;return Me(it,"input")&&it.type==="text"&&((Rt=it.getAttribute("type"))==null||Rt.toLowerCase()==="text")},first:La(function(){return[0]}),last:La(function(it,Rt){return[Rt-1]}),eq:La(function(it,Rt,Mt){return[Mt<0?Mt+Rt:Mt]}),even:La(function(it,Rt){for(var Mt=0;Mt<Rt;Mt+=2)it.push(Mt);return it}),odd:La(function(it,Rt){for(var Mt=1;Mt<Rt;Mt+=2)it.push(Mt);return it}),lt:La(function(it,Rt,Mt){var St;for(Mt<0?St=Mt+Rt:Mt>Rt?St=Rt:St=Mt;--St>=0;)it.push(St);return it}),gt:La(function(it,Rt,Mt){for(var St=Mt<0?Mt+Rt:Mt;++St<Rt;)it.push(St);return it})}},F.pseudos.nth=F.pseudos.eq;for(p in{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})F.pseudos[p]=Pn(p);for(p in{submit:!0,reset:!0})F.pseudos[p]=wo(p);function vo(){}vo.prototype=F.filters=F.pseudos,F.setFilters=new vo;function Cd(it,Rt){var Mt,St,zt,Dt,oe,Ve,ce,qe=ti[it+" "];if(qe)return Rt?0:qe.slice(0);for(oe=it,Ve=[],ce=F.preFilter;oe;){(!Mt||(St=Gi.exec(oe)))&&(St&&(oe=oe.slice(St[0].length)||oe),Ve.push(zt=[])),Mt=!1,(St=ea.exec(oe))&&(Mt=St.shift(),zt.push({value:Mt,type:St[0].replace(Ui," ")}),oe=oe.slice(Mt.length));for(Dt in F.filter)(St=Nl[Dt].exec(oe))&&(!ce[Dt]||(St=ce[Dt](St)))&&(Mt=St.shift(),zt.push({value:Mt,type:Dt,matches:St}),oe=oe.slice(Mt.length));if(!Mt)break}return Rt?oe.length:oe?ni.error(it):ti(it,Ve).slice(0)}function kd(it){for(var Rt=0,Mt=it.length,St="";Rt<Mt;Rt++)St+=it[Rt].value;return St}function Kn(it,Rt,Mt){var St=Rt.dir,zt=Rt.next,Dt=zt||St,oe=Mt&&Dt==="parentNode",Ve=_t++;return Rt.first?function(ce,qe,xe){for(;ce=ce[St];)if(ce.nodeType===1||oe)return it(ce,qe,xe);return!1}:function(ce,qe,xe){var Xe,ve,Ge=[yt,Ve];if(xe){for(;ce=ce[St];)if((ce.nodeType===1||oe)&&it(ce,qe,xe))return!0}else for(;ce=ce[St];)if(ce.nodeType===1||oe)if(ve=ce[Et]||(ce[Et]={}),zt&&Me(ce,zt))ce=ce[St]||ce;else{if((Xe=ve[Dt])&&Xe[0]===yt&&Xe[1]===Ve)return Ge[2]=Xe[2];if(ve[Dt]=Ge,Ge[2]=it(ce,qe,xe))return!0}return!1}}function Qd(it){return it.length>1?function(Rt,Mt,St){for(var zt=it.length;zt--;)if(!it[zt](Rt,Mt,St))return!1;return!0}:it[0]}function vc(it,Rt,Mt){for(var St=0,zt=Rt.length;St<zt;St++)ni(it,Rt[St],Mt);return Mt}function Ld(it,Rt,Mt,St,zt){for(var Dt,oe=[],Ve=0,ce=it.length,qe=Rt!=null;Ve<ce;Ve++)(Dt=it[Ve])&&(!Mt||Mt(Dt,St,zt))&&(oe.push(Dt),qe&&Rt.push(Ve));return oe}function qn(it,Rt,Mt,St,zt,Dt){return St&&!St[Et]&&(St=qn(St)),zt&&!zt[Et]&&(zt=qn(zt,Dt)),pa(function(oe,Ve,ce,qe){var xe,Xe,ve,Ge,Wi=[],el=[],il=Ve.length,Il=oe||vc(Rt||"*",ce.nodeType?[ce]:ce,[]),Oi=it&&(oe||!Rt)?Ld(Il,Wi,it,ce,qe):Il;if(Mt?(Ge=zt||(oe?it:il||St)?[]:Ve,Mt(Oi,Ge,ce,qe)):Ge=Oi,St)for(xe=Ld(Ge,el),St(xe,[],ce,qe),Xe=xe.length;Xe--;)(ve=xe[Xe])&&(Ge[el[Xe]]=!(Oi[el[Xe]]=ve));if(oe){if(zt||it){if(zt){for(xe=[],Xe=Ge.length;Xe--;)(ve=Ge[Xe])&&xe.push(Oi[Xe]=ve);zt(null,Ge=[],xe,qe)}for(Xe=Ge.length;Xe--;)(ve=Ge[Xe])&&(xe=zt?Ct.call(oe,ve):Wi[Xe])>-1&&(oe[xe]=!(Ve[xe]=ve))}}else Ge=Ld(Ge===Ve?Ge.splice(il,Ge.length):Ge),zt?zt(null,Ve,Ge,qe):A.apply(Ve,Ge)})}function Ta(it){for(var Rt,Mt,St,zt=it.length,Dt=F.relative[it[0].type],oe=Dt||F.relative[" "],Ve=Dt?1:0,ce=Kn(function(Xe){return Xe===Rt},oe,!0),qe=Kn(function(Xe){return Ct.call(Rt,Xe)>-1},oe,!0),xe=[function(Xe,ve,Ge){var Wi=!Dt&&(Ge||ve!=T)||((Rt=ve).nodeType?ce(Xe,ve,Ge):qe(Xe,ve,Ge));return Rt=null,Wi}];Ve<zt;Ve++)if(Mt=F.relative[it[Ve].type])xe=[Kn(Qd(xe),Mt)];else{if(Mt=F.filter[it[Ve].type].apply(null,it[Ve].matches),Mt[Et]){for(St=++Ve;St<zt&&!F.relative[it[St].type];St++);return qn(Ve>1&&Qd(xe),Ve>1&&kd(it.slice(0,Ve-1).concat({value:it[Ve-2].type===" "?"*":""})).replace(Ui,"$1"),Mt,Ve<St&&Ta(it.slice(Ve,St)),St<zt&&Ta(it=it.slice(St)),St<zt&&kd(it))}xe.push(Mt)}return Qd(xe)}function Hc(it,Rt){var Mt=Rt.length>0,St=it.length>0,zt=function(Dt,oe,Ve,ce,qe){var xe,Xe,ve,Ge=0,Wi="0",el=Dt&&[],il=[],Il=T,Oi=Dt||St&&F.find.TAG("*",qe),$n=yt+=Il==null?1:Math.random()||.1,yl=Oi.length;for(qe&&(T=oe==f||oe||qe);Wi!==yl&&(xe=Oi[Wi])!=null;Wi++){if(St&&xe){for(Xe=0,!oe&&xe.ownerDocument!=f&&(xa(xe),Ve=!ct);ve=it[Xe++];)if(ve(xe,oe||f,Ve)){A.call(ce,xe);break}qe&&(yt=$n)}Mt&&((xe=!ve&&xe)&&Ge--,Dt&&el.push(xe))}if(Ge+=Wi,Mt&&Wi!==Ge){for(Xe=0;ve=Rt[Xe++];)ve(el,il,oe,Ve);if(Dt){if(Ge>0)for(;Wi--;)el[Wi]||il[Wi]||(il[Wi]=ui.call(ce));il=Ld(il)}A.apply(ce,il),qe&&!Dt&&il.length>0&&Ge+Rt.length>1&&B.uniqueSort(ce)}return qe&&(yt=$n,T=Il),el};return Mt?pa(zt):zt}function Ed(it,Rt){var Mt,St=[],zt=[],Dt=we[it+" "];if(!Dt){for(Rt||(Rt=Cd(it)),Mt=Rt.length;Mt--;)Dt=Ta(Rt[Mt]),Dt[Et]?St.push(Dt):zt.push(Dt);Dt=we(it,Hc(zt,St)),Dt.selector=it}return Dt}function mc(it,Rt,Mt,St){var zt,Dt,oe,Ve,ce,qe=typeof it=="function"&&it,xe=!St&&Cd(it=qe.selector||it);if(Mt=Mt||[],xe.length===1){if(Dt=xe[0]=xe[0].slice(0),Dt.length>2&&(oe=Dt[0]).type==="ID"&&Rt.nodeType===9&&ct&&F.relative[Dt[1].type]){if(Rt=(F.find.ID(oe.matches[0].replace(qa,$a),Rt)||[])[0],Rt)qe&&(Rt=Rt.parentNode);else return Mt;it=it.slice(Dt.shift().value.length)}for(zt=Nl.needsContext.test(it)?0:Dt.length;zt--&&(oe=Dt[zt],!F.relative[Ve=oe.type]);)if((ce=F.find[Ve])&&(St=ce(oe.matches[0].replace(qa,$a),xn.test(Dt[0].type)&&Gd(Rt.parentNode)||Rt))){if(Dt.splice(zt,1),it=St.length&&kd(Dt),!it)return A.apply(Mt,St),Mt;break}}return(qe||Ed(it,xe))(St,Rt,!ct,Mt,!Rt||xn.test(it)&&Gd(Rt.parentNode)||Rt),Mt}jt.sortStable=Et.split("").sort(Li).join("")===Et,xa(),jt.sortDetached=Tn(function(it){return it.compareDocumentPosition(f.createElement("fieldset"))&1}),B.find=ni,B.expr[":"]=B.expr.pseudos,B.unique=B.uniqueSort,ni.compile=Ed,ni.select=mc,ni.setDocument=xa,ni.tokenize=Cd,ni.escape=B.escapeSelector,ni.getText=B.text,ni.isXML=B.isXMLDoc,ni.selectors=B.expr,ni.support=B.support,ni.uniqueSort=B.uniqueSort})();var Yl=function(p,F,T){for(var y=[],E=T!==void 0;(p=p[F])&&p.nodeType!==9;)if(p.nodeType===1){if(E&&B(p).is(T))break;y.push(p)}return y},ol=function(p,F){for(var T=[];p;p=p.nextSibling)p.nodeType===1&&p!==F&&T.push(p);return T},ba=B.expr.match.needsContext,dn=/^<([a-z][^\/\0>:\x20\t\r\n\f]*)[\x20\t\r\n\f]*\/?>(?:<\/\1>|)$/i;function xl(p,F,T){return gt(F)?B.grep(p,function(y,E){return!!F.call(y,E,y)!==T}):F.nodeType?B.grep(p,function(y){return y===F!==T}):typeof F!="string"?B.grep(p,function(y){return Ct.call(F,y)>-1!==T}):B.filter(F,p,T)}B.filter=function(p,F,T){var y=F[0];return T&&(p=":not("+p+")"),F.length===1&&y.nodeType===1?B.find.matchesSelector(y,p)?[y]:[]:B.find.matches(p,B.grep(F,function(E){return E.nodeType===1}))},B.fn.extend({find:function(p){var F,T,y=this.length,E=this;if(typeof p!="string")return this.pushStack(B(p).filter(function(){for(F=0;F<y;F++)if(B.contains(E[F],this))return!0}));for(T=this.pushStack([]),F=0;F<y;F++)B.find(p,E[F],T);return y>1?B.uniqueSort(T):T},filter:function(p){return this.pushStack(xl(this,p||[],!1))},not:function(p){return this.pushStack(xl(this,p||[],!0))},is:function(p){return!!xl(this,typeof p=="string"&&ba.test(p)?B(p):p||[],!1).length}});var _l,Ci=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]+))$/,qi=B.fn.init=function(p,F,T){var y,E;if(!p)return this;if(T=T||_l,typeof p=="string")if(p[0]==="<"&&p[p.length-1]===">"&&p.length>=3?y=[null,p,null]:y=Ci.exec(p),y&&(y[1]||!F))if(y[1]){if(F=F instanceof B?F[0]:F,B.merge(this,B.parseHTML(y[1],F&&F.nodeType?F.ownerDocument||F:te,!0)),dn.test(y[1])&&B.isPlainObject(F))for(y in F)gt(this[y])?this[y](F[y]):this.attr(y,F[y]);return this}else return E=te.getElementById(y[2]),E&&(this[0]=E,this.length=1),this;else return!F||F.jquery?(F||T).find(p):this.constructor(F).find(p);else{if(p.nodeType)return this[0]=p,this.length=1,this;if(gt(p))return T.ready!==void 0?T.ready(p):p(B)}return B.makeArray(p,this)};qi.prototype=B.fn,_l=B(te);var ki=/^(?:parents|prev(?:Until|All))/,Sa={children:!0,contents:!0,next:!0,prev:!0};B.fn.extend({has:function(p){var F=B(p,this),T=F.length;return this.filter(function(){for(var y=0;y<T;y++)if(B.contains(this,F[y]))return!0})},closest:function(p,F){var T,y=0,E=this.length,A=[],f=typeof p!="string"&&B(p);if(!ba.test(p)){for(;y<E;y++)for(T=this[y];T&&T!==F;T=T.parentNode)if(T.nodeType<11&&(f?f.index(T)>-1:T.nodeType===1&&B.find.matchesSelector(T,p))){A.push(T);break}}return this.pushStack(A.length>1?B.uniqueSort(A):A)},index:function(p){return p?typeof p=="string"?Ct.call(B(p),this[0]):Ct.call(this,p.jquery?p[0]:p):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(p,F){return this.pushStack(B.uniqueSort(B.merge(this.get(),B(p,F))))},addBack:function(p){return this.add(p==null?this.prevObject:this.prevObject.filter(p))}});function Fl(p,F){for(;(p=p[F])&&p.nodeType!==1;);return p}B.each({parent:function(p){var F=p.parentNode;return F&&F.nodeType!==11?F:null},parents:function(p){return Yl(p,"parentNode")},parentsUntil:function(p,F,T){return Yl(p,"parentNode",T)},next:function(p){return Fl(p,"nextSibling")},prev:function(p){return Fl(p,"previousSibling")},nextAll:function(p){return Yl(p,"nextSibling")},prevAll:function(p){return Yl(p,"previousSibling")},nextUntil:function(p,F,T){return Yl(p,"nextSibling",T)},prevUntil:function(p,F,T){return Yl(p,"previousSibling",T)},siblings:function(p){return ol((p.parentNode||{}).firstChild,p)},children:function(p){return ol(p.firstChild)},contents:function(p){return p.contentDocument!=null&&D(p.contentDocument)?p.contentDocument:(Me(p,"template")&&(p=p.content||p),B.merge([],p.childNodes))}},function(p,F){B.fn[p]=function(T,y){var E=B.map(this,F,T);return p.slice(-5)!=="Until"&&(y=T),y&&typeof y=="string"&&(E=B.filter(y,E)),this.length>1&&(Sa[p]||B.uniqueSort(E),ki.test(p)&&E.reverse()),this.pushStack(E)}});var $i=/[^\x20\t\r\n\f]+/g;function Pl(p){var F={};return B.each(p.match($i)||[],function(T,y){F[y]=!0}),F}B.Callbacks=function(p){p=typeof p=="string"?Pl(p):B.extend({},p);var F,T,y,E,A=[],f=[],bt=-1,ct=function(){for(E=E||p.once,y=F=!0;f.length;bt=-1)for(T=f.shift();++bt<A.length;)A[bt].apply(T[0],T[1])===!1&&p.stopOnFalse&&(bt=A.length,T=!1);p.memory||(T=!1),F=!1,E&&(T?A=[]:A="")},Gt={add:function(){return A&&(T&&!F&&(bt=A.length-1,f.push(T)),(function kt(Et){B.each(Et,function(yt,_t){gt(_t)?(!p.unique||!Gt.has(_t))&&A.push(_t):_t&&_t.length&&li(_t)!=="string"&&kt(_t)})})(arguments),T&&!F&&ct()),this},remove:function(){return B.each(arguments,function(kt,Et){for(var yt;(yt=B.inArray(Et,A,yt))>-1;)A.splice(yt,1),yt<=bt&&bt--}),this},has:function(kt){return kt?B.inArray(kt,A)>-1:A.length>0},empty:function(){return A&&(A=[]),this},disable:function(){return E=f=[],A=T="",this},disabled:function(){return!A},lock:function(){return E=f=[],!T&&!F&&(A=T=""),this},locked:function(){return!!E},fireWith:function(kt,Et){return E||(Et=Et||[],Et=[kt,Et.slice?Et.slice():Et],f.push(Et),F||ct()),this},fire:function(){return Gt.fireWith(this,arguments),this},fired:function(){return!!y}};return Gt};function Kl(p){return p}function ci(p){throw p}function El(p,F,T,y){var E;try{p&&gt(E=p.promise)?E.call(p).done(F).fail(T):p&&gt(E=p.then)?E.call(p,F,T):F.apply(void 0,[p].slice(y))}catch(A){T.apply(void 0,[A])}}B.extend({Deferred:function(p){var F=[["notify","progress",B.Callbacks("memory"),B.Callbacks("memory"),2],["resolve","done",B.Callbacks("once memory"),B.Callbacks("once memory"),0,"resolved"],["reject","fail",B.Callbacks("once memory"),B.Callbacks("once memory"),1,"rejected"]],T="pending",y={state:function(){return T},always:function(){return E.done(arguments).fail(arguments),this},catch:function(A){return y.then(null,A)},pipe:function(){var A=arguments;return B.Deferred(function(f){B.each(F,function(bt,ct){var Gt=gt(A[ct[4]])&&A[ct[4]];E[ct[1]](function(){var kt=Gt&&Gt.apply(this,arguments);kt&&gt(kt.promise)?kt.promise().progress(f.notify).done(f.resolve).fail(f.reject):f[ct[0]+"With"](this,Gt?[kt]:arguments)})}),A=null}).promise()},then:function(A,f,bt){var ct=0;function Gt(kt,Et,yt,_t){return function(){var Ye=this,ti=arguments,we=function(){var Li,Wa;if(!(kt<ct)){if(Li=yt.apply(Ye,ti),Li===Et.promise())throw new TypeError("Thenable self-resolution");Wa=Li&&(typeof Li=="object"||typeof Li=="function")&&Li.then,gt(Wa)?_t?Wa.call(Li,Gt(ct,Et,Kl,_t),Gt(ct,Et,ci,_t)):(ct++,Wa.call(Li,Gt(ct,Et,Kl,_t),Gt(ct,Et,ci,_t),Gt(ct,Et,Kl,Et.notifyWith))):(yt!==Kl&&(Ye=void 0,ti=[Li]),(_t||Et.resolveWith)(Ye,ti))}},Zl=_t?we:function(){try{we()}catch(Li){B.Deferred.exceptionHook&&B.Deferred.exceptionHook(Li,Zl.error),kt+1>=ct&&(yt!==ci&&(Ye=void 0,ti=[Li]),Et.rejectWith(Ye,ti))}};kt?Zl():(B.Deferred.getErrorHook?Zl.error=B.Deferred.getErrorHook():B.Deferred.getStackHook&&(Zl.error=B.Deferred.getStackHook()),x.setTimeout(Zl))}}return B.Deferred(function(kt){F[0][3].add(Gt(0,kt,gt(bt)?bt:Kl,kt.notifyWith)),F[1][3].add(Gt(0,kt,gt(A)?A:Kl)),F[2][3].add(Gt(0,kt,gt(f)?f:ci))}).promise()},promise:function(A){return A!=null?B.extend(A,y):y}},E={};return B.each(F,function(A,f){var bt=f[2],ct=f[5];y[f[1]]=bt.add,ct&&bt.add(function(){T=ct},F[3-A][2].disable,F[3-A][3].disable,F[0][2].lock,F[0][3].lock),bt.add(f[3].fire),E[f[0]]=function(){return E[f[0]+"With"](this===E?void 0:this,arguments),this},E[f[0]+"With"]=bt.fireWith}),y.promise(E),p&&p.call(E,E),E},when:function(p){var F=arguments.length,T=F,y=Array(T),E=I.call(arguments),A=B.Deferred(),f=function(bt){return function(ct){y[bt]=this,E[bt]=arguments.length>1?I.call(arguments):ct,--F||A.resolveWith(y,E)}};if(F<=1&&(El(p,A.done(f(T)).resolve,A.reject,!F),A.state()==="pending"||gt(E[T]&&E[T].then)))return A.then();for(;T--;)El(E[T],f(T),A.reject);return A.promise()}});var Na=/^(Eval|Internal|Range|Reference|Syntax|Type|URI)Error$/;B.Deferred.exceptionHook=function(p,F){x.console&&x.console.warn&&p&&Na.test(p.name)&&x.console.warn("jQuery.Deferred exception: "+p.message,p.stack,F)},B.readyException=function(p){x.setTimeout(function(){throw p})};var si=B.Deferred();B.fn.ready=function(p){return si.then(p).catch(function(F){B.readyException(F)}),this},B.extend({isReady:!1,readyWait:1,ready:function(p){(p===!0?--B.readyWait:B.isReady)||(B.isReady=!0,!(p!==!0&&--B.readyWait>0)&&si.resolveWith(te,[B]))}}),B.ready.then=si.then;function Tl(){te.removeEventListener("DOMContentLoaded",Tl),x.removeEventListener("load",Tl),B.ready()}te.readyState==="complete"||te.readyState!=="loading"&&!te.documentElement.doScroll?x.setTimeout(B.ready):(te.addEventListener("DOMContentLoaded",Tl),x.addEventListener("load",Tl));var wi=function(p,F,T,y,E,A,f){var bt=0,ct=p.length,Gt=T==null;if(li(T)==="object"){E=!0;for(bt in T)wi(p,F,bt,T[bt],!0,A,f)}else if(y!==void 0&&(E=!0,gt(y)||(f=!0),Gt&&(f?(F.call(p,y),F=null):(Gt=F,F=function(kt,Et,yt){return Gt.call(B(kt),yt)})),F))for(;bt<ct;bt++)F(p[bt],T,f?y:y.call(p[bt],bt,F(p[bt],T)));return E?p:Gt?F.call(p):ct?F(p[0],T):A},Rn=/^-ms-/,Ha=/-([a-z])/g;function hl(p,F){return F.toUpperCase()}function Qi(p){return p.replace(Rn,"ms-").replace(Ha,hl)}var ql=function(p){return p.nodeType===1||p.nodeType===9||!+p.nodeType};function vi(){this.expando=B.expando+vi.uid++}vi.uid=1,vi.prototype={cache:function(p){var F=p[this.expando];return F||(F={},ql(p)&&(p.nodeType?p[this.expando]=F:Object.defineProperty(p,this.expando,{value:F,configurable:!0}))),F},set:function(p,F,T){var y,E=this.cache(p);if(typeof F=="string")E[Qi(F)]=T;else for(y in F)E[Qi(y)]=F[y];return E},get:function(p,F){return F===void 0?this.cache(p):p[this.expando]&&p[this.expando][Qi(F)]},access:function(p,F,T){return F===void 0||F&&typeof F=="string"&&T===void 0?this.get(p,F):(this.set(p,F,T),T!==void 0?T:F)},remove:function(p,F){var T,y=p[this.expando];if(y!==void 0){if(F!==void 0)for(Array.isArray(F)?F=F.map(Qi):(F=Qi(F),F=F in y?[F]:F.match($i)||[]),T=F.length;T--;)delete y[F[T]];(F===void 0||B.isEmptyObject(y))&&(p.nodeType?p[this.expando]=void 0:delete p[this.expando])}},hasData:function(p){var F=p[this.expando];return F!==void 0&&!B.isEmptyObject(F)}};var We=new vi,Hi=new vi,Da=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,cn=/[A-Z]/g;function Ca(p){return p==="true"?!0:p==="false"?!1:p==="null"?null:p===+p+""?+p:Da.test(p)?JSON.parse(p):p}function En(p,F,T){var y;if(T===void 0&&p.nodeType===1)if(y="data-"+F.replace(cn,"-$&").toLowerCase(),T=p.getAttribute(y),typeof T=="string"){try{T=Ca(T)}catch{}Hi.set(p,F,T)}else T=void 0;return T}B.extend({hasData:function(p){return Hi.hasData(p)||We.hasData(p)},data:function(p,F,T){return Hi.access(p,F,T)},removeData:function(p,F){Hi.remove(p,F)},_data:function(p,F,T){return We.access(p,F,T)},_removeData:function(p,F){We.remove(p,F)}}),B.fn.extend({data:function(p,F){var T,y,E,A=this[0],f=A&&A.attributes;if(p===void 0){if(this.length&&(E=Hi.get(A),A.nodeType===1&&!We.get(A,"hasDataAttrs"))){for(T=f.length;T--;)f[T]&&(y=f[T].name,y.indexOf("data-")===0&&(y=Qi(y.slice(5)),En(A,y,E[y])));We.set(A,"hasDataAttrs",!0)}return E}return typeof p=="object"?this.each(function(){Hi.set(this,p)}):wi(this,function(bt){var ct;if(A&&bt===void 0)return ct=Hi.get(A,p),ct!==void 0||(ct=En(A,p),ct!==void 0)?ct:void 0;this.each(function(){Hi.set(this,p,bt)})},null,F,arguments.length>1,null,!0)},removeData:function(p){return this.each(function(){Hi.remove(this,p)})}}),B.extend({queue:function(p,F,T){var y;if(p)return F=(F||"fx")+"queue",y=We.get(p,F),T&&(!y||Array.isArray(T)?y=We.access(p,F,B.makeArray(T)):y.push(T)),y||[]},dequeue:function(p,F){F=F||"fx";var T=B.queue(p,F),y=T.length,E=T.shift(),A=B._queueHooks(p,F),f=function(){B.dequeue(p,F)};E==="inprogress"&&(E=T.shift(),y--),E&&(F==="fx"&&T.unshift("inprogress"),delete A.stop,E.call(p,f,A)),!y&&A&&A.empty.fire()},_queueHooks:function(p,F){var T=F+"queueHooks";return We.get(p,T)||We.access(p,T,{empty:B.Callbacks("once memory").add(function(){We.remove(p,[F+"queue",T])})})}}),B.fn.extend({queue:function(p,F){var T=2;return typeof p!="string"&&(F=p,p="fx",T--),arguments.length<T?B.queue(this[0],p):F===void 0?this:this.each(function(){var y=B.queue(this,p,F);B._queueHooks(this,p),p==="fx"&&y[0]!=="inprogress"&&B.dequeue(this,p)})},dequeue:function(p){return this.each(function(){B.dequeue(this,p)})},clearQueue:function(p){return this.queue(p||"fx",[])},promise:function(p,F){var T,y=1,E=B.Deferred(),A=this,f=this.length,bt=function(){--y||E.resolveWith(A,[A])};for(typeof p!="string"&&(F=p,p=void 0),p=p||"fx";f--;)T=We.get(A[f],p+"queueHooks"),T&&T.empty&&(y++,T.empty.add(bt));return bt(),E.promise(F)}});var Fn=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,zl=new RegExp("^(?:([+-])=|)("+Fn+")([a-z%]*)$","i"),Di=["Top","Right","Bottom","Left"],ht=te.documentElement,z=function(p){return B.contains(p.ownerDocument,p)},v={composed:!0};ht.getRootNode&&(z=function(p){return B.contains(p.ownerDocument,p)||p.getRootNode(v)===p.ownerDocument});var O=function(p,F){return p=F||p,p.style.display==="none"||p.style.display===""&&z(p)&&B.css(p,"display")==="none"};function dt(p,F,T,y){var E,A,f=20,bt=y?function(){return y.cur()}:function(){return B.css(p,F,"")},ct=bt(),Gt=T&&T[3]||(B.cssNumber[F]?"":"px"),kt=p.nodeType&&(B.cssNumber[F]||Gt!=="px"&&+ct)&&zl.exec(B.css(p,F));if(kt&&kt[3]!==Gt){for(ct=ct/2,Gt=Gt||kt[3],kt=+ct||1;f--;)B.style(p,F,kt+Gt),(1-A)*(1-(A=bt()/ct||.5))<=0&&(f=0),kt=kt/A;kt=kt*2,B.style(p,F,kt+Gt),T=T||[]}return T&&(kt=+kt||+ct||0,E=T[1]?kt+(T[1]+1)*T[2]:+T[2],y&&(y.unit=Gt,y.start=kt,y.end=E)),E}var rt={};function Nt(p){var F,T=p.ownerDocument,y=p.nodeName,E=rt[y];return E||(F=T.body.appendChild(T.createElement(y)),E=B.css(F,"display"),F.parentNode.removeChild(F),E==="none"&&(E="block"),rt[y]=E,E)}function K(p,F){for(var T,y,E=[],A=0,f=p.length;A<f;A++)y=p[A],y.style&&(T=y.style.display,F?(T==="none"&&(E[A]=We.get(y,"display")||null,E[A]||(y.style.display="")),y.style.display===""&&O(y)&&(E[A]=Nt(y))):T!=="none"&&(E[A]="none",We.set(y,"display",T)));for(A=0;A<f;A++)E[A]!=null&&(p[A].style.display=E[A]);return p}B.fn.extend({show:function(){return K(this,!0)},hide:function(){return K(this)},toggle:function(p){return typeof p=="boolean"?p?this.show():this.hide():this.each(function(){O(this)?B(this).show():B(this).hide()})}});var ut=/^(?:checkbox|radio)$/i,Tt=/<([a-z][^\/\0>\x20\t\r\n\f]*)/i,Bt=/^$|^module$|\/(?:java|ecma)script/i;(function(){var p=te.createDocumentFragment(),F=p.appendChild(te.createElement("div")),T=te.createElement("input");T.setAttribute("type","radio"),T.setAttribute("checked","checked"),T.setAttribute("name","t"),F.appendChild(T),jt.checkClone=F.cloneNode(!0).cloneNode(!0).lastChild.checked,F.innerHTML="<textarea>x</textarea>",jt.noCloneChecked=!!F.cloneNode(!0).lastChild.defaultValue,F.innerHTML="<option></option>",jt.option=!!F.lastChild})();var Jt={thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};Jt.tbody=Jt.tfoot=Jt.colgroup=Jt.caption=Jt.thead,Jt.th=Jt.td,jt.option||(Jt.optgroup=Jt.option=[1,"<select multiple='multiple'>","</select>"]);function le(p,F){var T;return typeof p.getElementsByTagName<"u"?T=p.getElementsByTagName(F||"*"):typeof p.querySelectorAll<"u"?T=p.querySelectorAll(F||"*"):T=[],F===void 0||F&&Me(p,F)?B.merge([p],T):T}function he(p,F){for(var T=0,y=p.length;T<y;T++)We.set(p[T],"globalEval",!F||We.get(F[T],"globalEval"))}var Be=/<|&#?\w+;/;function Ti(p,F,T,y,E){for(var A,f,bt,ct,Gt,kt,Et=F.createDocumentFragment(),yt=[],_t=0,Ye=p.length;_t<Ye;_t++)if(A=p[_t],A||A===0)if(li(A)==="object")B.merge(yt,A.nodeType?[A]:A);else if(!Be.test(A))yt.push(F.createTextNode(A));else{for(f=f||Et.appendChild(F.createElement("div")),bt=(Tt.exec(A)||["",""])[1].toLowerCase(),ct=Jt[bt]||Jt._default,f.innerHTML=ct[1]+B.htmlPrefilter(A)+ct[2],kt=ct[0];kt--;)f=f.lastChild;B.merge(yt,f.childNodes),f=Et.firstChild,f.textContent=""}for(Et.textContent="",_t=0;A=yt[_t++];){if(y&&B.inArray(A,y)>-1){E&&E.push(A);continue}if(Gt=z(A),f=le(Et.appendChild(A),"script"),Gt&&he(f),T)for(kt=0;A=f[kt++];)Bt.test(A.type||"")&&T.push(A)}return Et}var Ae=/^([^.]*)(?:\.(.+)|)/;function Oe(){return!0}function ai(){return!1}function ft(p,F,T,y,E,A){var f,bt;if(typeof F=="object"){typeof T!="string"&&(y=y||T,T=void 0);for(bt in F)ft(p,bt,T,y,F[bt],A);return p}if(y==null&&E==null?(E=T,y=T=void 0):E==null&&(typeof T=="string"?(E=y,y=void 0):(E=y,y=T,T=void 0)),E===!1)E=ai;else if(!E)return p;return A===1&&(f=E,E=function(ct){return B().off(ct),f.apply(this,arguments)},E.guid=f.guid||(f.guid=B.guid++)),p.each(function(){B.event.add(this,F,E,y,T)})}B.event={global:{},add:function(p,F,T,y,E){var A,f,bt,ct,Gt,kt,Et,yt,_t,Ye,ti,we=We.get(p);if(ql(p))for(T.handler&&(A=T,T=A.handler,E=A.selector),E&&B.find.matchesSelector(ht,E),T.guid||(T.guid=B.guid++),(ct=we.events)||(ct=we.events=Object.create(null)),(f=we.handle)||(f=we.handle=function(Zl){return typeof B<"u"&&B.event.triggered!==Zl.type?B.event.dispatch.apply(p,arguments):void 0}),F=(F||"").match($i)||[""],Gt=F.length;Gt--;)bt=Ae.exec(F[Gt])||[],_t=ti=bt[1],Ye=(bt[2]||"").split(".").sort(),_t&&(Et=B.event.special[_t]||{},_t=(E?Et.delegateType:Et.bindType)||_t,Et=B.event.special[_t]||{},kt=B.extend({type:_t,origType:ti,data:y,handler:T,guid:T.guid,selector:E,needsContext:E&&B.expr.match.needsContext.test(E),namespace:Ye.join(".")},A),(yt=ct[_t])||(yt=ct[_t]=[],yt.delegateCount=0,(!Et.setup||Et.setup.call(p,y,Ye,f)===!1)&&p.addEventListener&&p.addEventListener(_t,f)),Et.add&&(Et.add.call(p,kt),kt.handler.guid||(kt.handler.guid=T.guid)),E?yt.splice(yt.delegateCount++,0,kt):yt.push(kt),B.event.global[_t]=!0)},remove:function(p,F,T,y,E){var A,f,bt,ct,Gt,kt,Et,yt,_t,Ye,ti,we=We.hasData(p)&&We.get(p);if(!(!we||!(ct=we.events))){for(F=(F||"").match($i)||[""],Gt=F.length;Gt--;){if(bt=Ae.exec(F[Gt])||[],_t=ti=bt[1],Ye=(bt[2]||"").split(".").sort(),!_t){for(_t in ct)B.event.remove(p,_t+F[Gt],T,y,!0);continue}for(Et=B.event.special[_t]||{},_t=(y?Et.delegateType:Et.bindType)||_t,yt=ct[_t]||[],bt=bt[2]&&new RegExp("(^|\\.)"+Ye.join("\\.(?:.*\\.|)")+"(\\.|$)"),f=A=yt.length;A--;)kt=yt[A],(E||ti===kt.origType)&&(!T||T.guid===kt.guid)&&(!bt||bt.test(kt.namespace))&&(!y||y===kt.selector||y==="**"&&kt.selector)&&(yt.splice(A,1),kt.selector&&yt.delegateCount--,Et.remove&&Et.remove.call(p,kt));f&&!yt.length&&((!Et.teardown||Et.teardown.call(p,Ye,we.handle)===!1)&&B.removeEvent(p,_t,we.handle),delete ct[_t])}B.isEmptyObject(ct)&&We.remove(p,"handle events")}},dispatch:function(p){var F,T,y,E,A,f,bt=new Array(arguments.length),ct=B.event.fix(p),Gt=(We.get(this,"events")||Object.create(null))[ct.type]||[],kt=B.event.special[ct.type]||{};for(bt[0]=ct,F=1;F<arguments.length;F++)bt[F]=arguments[F];if(ct.delegateTarget=this,!(kt.preDispatch&&kt.preDispatch.call(this,ct)===!1)){for(f=B.event.handlers.call(this,ct,Gt),F=0;(E=f[F++])&&!ct.isPropagationStopped();)for(ct.currentTarget=E.elem,T=0;(A=E.handlers[T++])&&!ct.isImmediatePropagationStopped();)(!ct.rnamespace||A.namespace===!1||ct.rnamespace.test(A.namespace))&&(ct.handleObj=A,ct.data=A.data,y=((B.event.special[A.origType]||{}).handle||A.handler).apply(E.elem,bt),y!==void 0&&(ct.result=y)===!1&&(ct.preventDefault(),ct.stopPropagation()));return kt.postDispatch&&kt.postDispatch.call(this,ct),ct.result}},handlers:function(p,F){var T,y,E,A,f,bt=[],ct=F.delegateCount,Gt=p.target;if(ct&&Gt.nodeType&&!(p.type==="click"&&p.button>=1)){for(;Gt!==this;Gt=Gt.parentNode||this)if(Gt.nodeType===1&&!(p.type==="click"&&Gt.disabled===!0)){for(A=[],f={},T=0;T<ct;T++)y=F[T],E=y.selector+" ",f[E]===void 0&&(f[E]=y.needsContext?B(E,this).index(Gt)>-1:B.find(E,this,null,[Gt]).length),f[E]&&A.push(y);A.length&&bt.push({elem:Gt,handlers:A})}}return Gt=this,ct<F.length&&bt.push({elem:Gt,handlers:F.slice(ct)}),bt},addProp:function(p,F){Object.defineProperty(B.Event.prototype,p,{enumerable:!0,configurable:!0,get:gt(F)?function(){if(this.originalEvent)return F(this.originalEvent)}:function(){if(this.originalEvent)return this.originalEvent[p]},set:function(T){Object.defineProperty(this,p,{enumerable:!0,configurable:!0,writable:!0,value:T})}})},fix:function(p){return p[B.expando]?p:new B.Event(p)},special:{load:{noBubble:!0},click:{setup:function(p){var F=this||p;return ut.test(F.type)&&F.click&&Me(F,"input")&&oi(F,"click",!0),!1},trigger:function(p){var F=this||p;return ut.test(F.type)&&F.click&&Me(F,"input")&&oi(F,"click"),!0},_default:function(p){var F=p.target;return ut.test(F.type)&&F.click&&Me(F,"input")&&We.get(F,"click")||Me(F,"a")}},beforeunload:{postDispatch:function(p){p.result!==void 0&&p.originalEvent&&(p.originalEvent.returnValue=p.result)}}}};function oi(p,F,T){if(!T){We.get(p,F)===void 0&&B.event.add(p,F,Oe);return}We.set(p,F,!1),B.event.add(p,F,{namespace:!1,handler:function(y){var E,A=We.get(this,F);if(y.isTrigger&1&&this[F]){if(A)(B.event.special[F]||{}).delegateType&&y.stopPropagation();else if(A=I.call(arguments),We.set(this,F,A),this[F](),E=We.get(this,F),We.set(this,F,!1),A!==E)return y.stopImmediatePropagation(),y.preventDefault(),E}else A&&(We.set(this,F,B.event.trigger(A[0],A.slice(1),this)),y.stopPropagation(),y.isImmediatePropagationStopped=Oe)}})}B.removeEvent=function(p,F,T){p.removeEventListener&&p.removeEventListener(F,T)},B.Event=function(p,F){if(!(this instanceof B.Event))return new B.Event(p,F);p&&p.type?(this.originalEvent=p,this.type=p.type,this.isDefaultPrevented=p.defaultPrevented||p.defaultPrevented===void 0&&p.returnValue===!1?Oe:ai,this.target=p.target&&p.target.nodeType===3?p.target.parentNode:p.target,this.currentTarget=p.currentTarget,this.relatedTarget=p.relatedTarget):this.type=p,F&&B.extend(this,F),this.timeStamp=p&&p.timeStamp||Date.now(),this[B.expando]=!0},B.Event.prototype={constructor:B.Event,isDefaultPrevented:ai,isPropagationStopped:ai,isImmediatePropagationStopped:ai,isSimulated:!1,preventDefault:function(){var p=this.originalEvent;this.isDefaultPrevented=Oe,p&&!this.isSimulated&&p.preventDefault()},stopPropagation:function(){var p=this.originalEvent;this.isPropagationStopped=Oe,p&&!this.isSimulated&&p.stopPropagation()},stopImmediatePropagation:function(){var p=this.originalEvent;this.isImmediatePropagationStopped=Oe,p&&!this.isSimulated&&p.stopImmediatePropagation(),this.stopPropagation()}},B.each({altKey:!0,bubbles:!0,cancelable:!0,changedTouches:!0,ctrlKey:!0,detail:!0,eventPhase:!0,metaKey:!0,pageX:!0,pageY:!0,shiftKey:!0,view:!0,char:!0,code:!0,charCode:!0,key:!0,keyCode:!0,button:!0,buttons:!0,clientX:!0,clientY:!0,offsetX:!0,offsetY:!0,pointerId:!0,pointerType:!0,screenX:!0,screenY:!0,targetTouches:!0,toElement:!0,touches:!0,which:!0},B.event.addProp),B.each({focus:"focusin",blur:"focusout"},function(p,F){function T(y){if(te.documentMode){var E=We.get(this,"handle"),A=B.event.fix(y);A.type=y.type==="focusin"?"focus":"blur",A.isSimulated=!0,E(y),A.target===A.currentTarget&&E(A)}else B.event.simulate(F,y.target,B.event.fix(y))}B.event.special[p]={setup:function(){var y;if(oi(this,p,!0),te.documentMode)y=We.get(this,F),y||this.addEventListener(F,T),We.set(this,F,(y||0)+1);else return!1},trigger:function(){return oi(this,p),!0},teardown:function(){var y;if(te.documentMode)y=We.get(this,F)-1,y?We.set(this,F,y):(this.removeEventListener(F,T),We.remove(this,F));else return!1},_default:function(y){return We.get(y.target,p)},delegateType:F},B.event.special[F]={setup:function(){var y=this.ownerDocument||this.document||this,E=te.documentMode?this:y,A=We.get(E,F);A||(te.documentMode?this.addEventListener(F,T):y.addEventListener(p,T,!0)),We.set(E,F,(A||0)+1)},teardown:function(){var y=this.ownerDocument||this.document||this,E=te.documentMode?this:y,A=We.get(E,F)-1;A?We.set(E,F,A):(te.documentMode?this.removeEventListener(F,T):y.removeEventListener(p,T,!0),We.remove(E,F))}}}),B.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},function(p,F){B.event.special[p]={delegateType:F,bindType:F,handle:function(T){var y,E=this,A=T.relatedTarget,f=T.handleObj;return(!A||A!==E&&!B.contains(E,A))&&(T.type=f.origType,y=f.handler.apply(this,arguments),T.type=F),y}}}),B.fn.extend({on:function(p,F,T,y){return ft(this,p,F,T,y)},one:function(p,F,T,y){return ft(this,p,F,T,y,1)},off:function(p,F,T){var y,E;if(p&&p.preventDefault&&p.handleObj)return y=p.handleObj,B(p.delegateTarget).off(y.namespace?y.origType+"."+y.namespace:y.origType,y.selector,y.handler),this;if(typeof p=="object"){for(E in p)this.off(E,F,p[E]);return this}return(F===!1||typeof F=="function")&&(T=F,F=void 0),T===!1&&(T=ai),this.each(function(){B.event.remove(this,p,T,F)})}});var hi=/<script|<style|<link/i,tl=/checked\s*(?:[^=]|=\s*.checked.)/i,Zi=/^\s*<!\[CDATA\[|\]\]>\s*$/g;function Ot(p,F){return Me(p,"table")&&Me(F.nodeType!==11?F:F.firstChild,"tr")&&B(p).children("tbody")[0]||p}function be(p){return p.type=(p.getAttribute("type")!==null)+"/"+p.type,p}function ue(p){return(p.type||"").slice(0,5)==="true/"?p.type=p.type.slice(5):p.removeAttribute("type"),p}function jl(p,F){var T,y,E,A,f,bt,ct;if(F.nodeType===1){if(We.hasData(p)&&(A=We.get(p),ct=A.events,ct)){We.remove(F,"handle events");for(E in ct)for(T=0,y=ct[E].length;T<y;T++)B.event.add(F,E,ct[E][T])}Hi.hasData(p)&&(f=Hi.access(p),bt=B.extend({},f),Hi.set(F,bt))}}function zn(p,F){var T=F.nodeName.toLowerCase();T==="input"&&ut.test(p.type)?F.checked=p.checked:(T==="input"||T==="textarea")&&(F.defaultValue=p.defaultValue)}function Ji(p,F,T,y){F=o(F);var E,A,f,bt,ct,Gt,kt=0,Et=p.length,yt=Et-1,_t=F[0],Ye=gt(_t);if(Ye||Et>1&&typeof _t=="string"&&!jt.checkClone&&tl.test(_t))return p.each(function(ti){var we=p.eq(ti);Ye&&(F[0]=_t.call(this,ti,we.html())),Ji(we,F,T,y)});if(Et&&(E=Ti(F,p[0].ownerDocument,!1,p,y),A=E.firstChild,E.childNodes.length===1&&(E=A),A||y)){for(f=B.map(le(E,"script"),be),bt=f.length;kt<Et;kt++)ct=E,kt!==yt&&(ct=B.clone(ct,!0,!0),bt&&B.merge(f,le(ct,"script"))),T.call(p[kt],ct,kt);if(bt)for(Gt=f[f.length-1].ownerDocument,B.map(f,ue),kt=0;kt<bt;kt++)ct=f[kt],Bt.test(ct.type||"")&&!We.access(ct,"globalEval")&&B.contains(Gt,ct)&&(ct.src&&(ct.type||"").toLowerCase()!=="module"?B._evalUrl&&!ct.noModule&&B._evalUrl(ct.src,{nonce:ct.nonce||ct.getAttribute("nonce")},Gt):di(ct.textContent.replace(Zi,""),ct,Gt))}return p}function Ne(p,F,T){for(var y,E=F?B.filter(F,p):p,A=0;(y=E[A])!=null;A++)!T&&y.nodeType===1&&B.cleanData(le(y)),y.parentNode&&(T&&z(y)&&he(le(y,"script")),y.parentNode.removeChild(y));return p}B.extend({htmlPrefilter:function(p){return p},clone:function(p,F,T){var y,E,A,f,bt=p.cloneNode(!0),ct=z(p);if(!jt.noCloneChecked&&(p.nodeType===1||p.nodeType===11)&&!B.isXMLDoc(p))for(f=le(bt),A=le(p),y=0,E=A.length;y<E;y++)zn(A[y],f[y]);if(F)if(T)for(A=A||le(p),f=f||le(bt),y=0,E=A.length;y<E;y++)jl(A[y],f[y]);else jl(p,bt);return f=le(bt,"script"),f.length>0&&he(f,!ct&&le(p,"script")),bt},cleanData:function(p){for(var F,T,y,E=B.event.special,A=0;(T=p[A])!==void 0;A++)if(ql(T)){if(F=T[We.expando]){if(F.events)for(y in F.events)E[y]?B.event.remove(T,y):B.removeEvent(T,y,F.handle);T[We.expando]=void 0}T[Hi.expando]&&(T[Hi.expando]=void 0)}}}),B.fn.extend({detach:function(p){return Ne(this,p,!0)},remove:function(p){return Ne(this,p)},text:function(p){return wi(this,function(F){return F===void 0?B.text(this):this.empty().each(function(){(this.nodeType===1||this.nodeType===11||this.nodeType===9)&&(this.textContent=F)})},null,p,arguments.length)},append:function(){return Ji(this,arguments,function(p){if(this.nodeType===1||this.nodeType===11||this.nodeType===9){var F=Ot(this,p);F.appendChild(p)}})},prepend:function(){return Ji(this,arguments,function(p){if(this.nodeType===1||this.nodeType===11||this.nodeType===9){var F=Ot(this,p);F.insertBefore(p,F.firstChild)}})},before:function(){return Ji(this,arguments,function(p){this.parentNode&&this.parentNode.insertBefore(p,this)})},after:function(){return Ji(this,arguments,function(p){this.parentNode&&this.parentNode.insertBefore(p,this.nextSibling)})},empty:function(){for(var p,F=0;(p=this[F])!=null;F++)p.nodeType===1&&(B.cleanData(le(p,!1)),p.textContent="");return this},clone:function(p,F){return p=p??!1,F=F??p,this.map(function(){return B.clone(this,p,F)})},html:function(p){return wi(this,function(F){var T=this[0]||{},y=0,E=this.length;if(F===void 0&&T.nodeType===1)return T.innerHTML;if(typeof F=="string"&&!hi.test(F)&&!Jt[(Tt.exec(F)||["",""])[1].toLowerCase()]){F=B.htmlPrefilter(F);try{for(;y<E;y++)T=this[y]||{},T.nodeType===1&&(B.cleanData(le(T,!1)),T.innerHTML=F);T=0}catch{}}T&&this.empty().append(F)},null,p,arguments.length)},replaceWith:function(){var p=[];return Ji(this,arguments,function(F){var T=this.parentNode;B.inArray(this,p)<0&&(B.cleanData(le(this)),T&&T.replaceChild(F,this))},p)}}),B.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(p,F){B.fn[p]=function(T){for(var y,E=[],A=B(T),f=A.length-1,bt=0;bt<=f;bt++)y=bt===f?this:this.clone(!0),B(A[bt])[F](y),st.apply(E,y.get());return this.pushStack(E)}});var ka=new RegExp("^("+Fn+")(?!px)[a-z%]+$","i"),Gn=/^--/,on=function(p){var F=p.ownerDocument.defaultView;return(!F||!F.opener)&&(F=x),F.getComputedStyle(p)},Ia=function(p,F,T){var y,E,A={};for(E in F)A[E]=p.style[E],p.style[E]=F[E];y=T.call(p);for(E in F)p.style[E]=A[E];return y},jn=new RegExp(Di.join("|"),"i");(function(){function p(){if(Gt){ct.style.cssText="position:absolute;left:-11111px;width:60px;margin-top:1px;padding:0;border:0",Gt.style.cssText="position:relative;display:block;box-sizing:border-box;overflow:scroll;margin:auto;border:1px;padding:1px;width:60%;top:1%",ht.appendChild(ct).appendChild(Gt);var kt=x.getComputedStyle(Gt);T=kt.top!=="1%",bt=F(kt.marginLeft)===12,Gt.style.right="60%",A=F(kt.right)===36,y=F(kt.width)===36,Gt.style.position="absolute",E=F(Gt.offsetWidth/3)===12,ht.removeChild(ct),Gt=null}}function F(kt){return Math.round(parseFloat(kt))}var T,y,E,A,f,bt,ct=te.createElement("div"),Gt=te.createElement("div");Gt.style&&(Gt.style.backgroundClip="content-box",Gt.cloneNode(!0).style.backgroundClip="",jt.clearCloneStyle=Gt.style.backgroundClip==="content-box",B.extend(jt,{boxSizingReliable:function(){return p(),y},pixelBoxStyles:function(){return p(),A},pixelPosition:function(){return p(),T},reliableMarginLeft:function(){return p(),bt},scrollboxSize:function(){return p(),E},reliableTrDimensions:function(){var kt,Et,yt,_t;return f==null&&(kt=te.createElement("table"),Et=te.createElement("tr"),yt=te.createElement("div"),kt.style.cssText="position:absolute;left:-11111px;border-collapse:separate",Et.style.cssText="box-sizing:content-box;border:1px solid",Et.style.height="1px",yt.style.height="9px",yt.style.display="block",ht.appendChild(kt).appendChild(Et).appendChild(yt),_t=x.getComputedStyle(Et),f=parseInt(_t.height,10)+parseInt(_t.borderTopWidth,10)+parseInt(_t.borderBottomWidth,10)===Et.offsetHeight,ht.removeChild(kt)),f}}))})();function fa(p,F,T){var y,E,A,f,bt=Gn.test(F),ct=p.style;return T=T||on(p),T&&(f=T.getPropertyValue(F)||T[F],bt&&f&&(f=f.replace(Ui,"$1")||void 0),f===""&&!z(p)&&(f=B.style(p,F)),!jt.pixelBoxStyles()&&ka.test(f)&&jn.test(F)&&(y=ct.width,E=ct.minWidth,A=ct.maxWidth,ct.minWidth=ct.maxWidth=ct.width=f,f=T.width,ct.width=y,ct.minWidth=E,ct.maxWidth=A)),f!==void 0?f+"":f}function An(p,F){return{get:function(){if(p()){delete this.get;return}return(this.get=F).apply(this,arguments)}}}var $l=["Webkit","Moz","ms"],bi=te.createElement("div").style,Qo={};function Oa(p){for(var F=p[0].toUpperCase()+p.slice(1),T=$l.length;T--;)if(p=$l[T]+F,p in bi)return p}function wn(p){var F=B.cssProps[p]||Qo[p];return F||(p in bi?p:Qo[p]=Oa(p)||p)}var Xi=/^(none|table(?!-c[ea]).+)/,Nn={position:"absolute",visibility:"hidden",display:"block"},cc={letterSpacing:"0",fontWeight:"400"};function vn(p,F,T){var y=zl.exec(F);return y?Math.max(0,y[2]-(T||0))+(y[3]||"px"):F}function yd(p,F,T,y,E,A){var f=F==="width"?1:0,bt=0,ct=0,Gt=0;if(T===(y?"border":"content"))return 0;for(;f<4;f+=2)T==="margin"&&(Gt+=B.css(p,T+Di[f],!0,E)),y?(T==="content"&&(ct-=B.css(p,"padding"+Di[f],!0,E)),T!=="margin"&&(ct-=B.css(p,"border"+Di[f]+"Width",!0,E))):(ct+=B.css(p,"padding"+Di[f],!0,E),T!=="padding"?ct+=B.css(p,"border"+Di[f]+"Width",!0,E):bt+=B.css(p,"border"+Di[f]+"Width",!0,E));return!y&&A>=0&&(ct+=Math.max(0,Math.ceil(p["offset"+F[0].toUpperCase()+F.slice(1)]-A-ct-bt-.5))||0),ct+Gt}function Hn(p,F,T){var y=on(p),E=!jt.boxSizingReliable()||T,A=E&&B.css(p,"boxSizing",!1,y)==="border-box",f=A,bt=fa(p,F,y),ct="offset"+F[0].toUpperCase()+F.slice(1);if(ka.test(bt)){if(!T)return bt;bt="auto"}return(!jt.boxSizingReliable()&&A||!jt.reliableTrDimensions()&&Me(p,"tr")||bt==="auto"||!parseFloat(bt)&&B.css(p,"display",!1,y)==="inline")&&p.getClientRects().length&&(A=B.css(p,"boxSizing",!1,y)==="border-box",f=ct in p,f&&(bt=p[ct])),bt=parseFloat(bt)||0,bt+yd(p,F,T||(A?"border":"content"),f,y,bt)+"px"}B.extend({cssHooks:{opacity:{get:function(p,F){if(F){var T=fa(p,"opacity");return T===""?"1":T}}}},cssNumber:{animationIterationCount:!0,aspectRatio:!0,borderImageSlice:!0,columnCount:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,gridArea:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnStart:!0,gridRow:!0,gridRowEnd:!0,gridRowStart:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,scale:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeMiterlimit:!0,strokeOpacity:!0},cssProps:{},style:function(p,F,T,y){if(!(!p||p.nodeType===3||p.nodeType===8||!p.style)){var E,A,f,bt=Qi(F),ct=Gn.test(F),Gt=p.style;if(ct||(F=wn(bt)),f=B.cssHooks[F]||B.cssHooks[bt],T!==void 0){if(A=typeof T,A==="string"&&(E=zl.exec(T))&&E[1]&&(T=dt(p,F,E),A="number"),T==null||T!==T)return;A==="number"&&!ct&&(T+=E&&E[3]||(B.cssNumber[bt]?"":"px")),!jt.clearCloneStyle&&T===""&&F.indexOf("background")===0&&(Gt[F]="inherit"),(!f||!("set"in f)||(T=f.set(p,T,y))!==void 0)&&(ct?Gt.setProperty(F,T):Gt[F]=T)}else return f&&"get"in f&&(E=f.get(p,!1,y))!==void 0?E:Gt[F]}},css:function(p,F,T,y){var E,A,f,bt=Qi(F),ct=Gn.test(F);return ct||(F=wn(bt)),f=B.cssHooks[F]||B.cssHooks[bt],f&&"get"in f&&(E=f.get(p,!0,T)),E===void 0&&(E=fa(p,F,y)),E==="normal"&&F in cc&&(E=cc[F]),T===""||T?(A=parseFloat(E),T===!0||isFinite(A)?A||0:E):E}}),B.each(["height","width"],function(p,F){B.cssHooks[F]={get:function(T,y,E){if(y)return Xi.test(B.css(T,"display"))&&(!T.getClientRects().length||!T.getBoundingClientRect().width)?Ia(T,Nn,function(){return Hn(T,F,E)}):Hn(T,F,E)},set:function(T,y,E){var A,f=on(T),bt=!jt.scrollboxSize()&&f.position==="absolute",ct=bt||E,Gt=ct&&B.css(T,"boxSizing",!1,f)==="border-box",kt=E?yd(T,F,E,Gt,f):0;return Gt&&bt&&(kt-=Math.ceil(T["offset"+F[0].toUpperCase()+F.slice(1)]-parseFloat(f[F])-yd(T,F,"border",!1,f)-.5)),kt&&(A=zl.exec(y))&&(A[3]||"px")!=="px"&&(T.style[F]=y,y=B.css(T,F)),vn(T,y,kt)}}}),B.cssHooks.marginLeft=An(jt.reliableMarginLeft,function(p,F){if(F)return(parseFloat(fa(p,"marginLeft"))||p.getBoundingClientRect().left-Ia(p,{marginLeft:0},function(){return p.getBoundingClientRect().left}))+"px"}),B.each({margin:"",padding:"",border:"Width"},function(p,F){B.cssHooks[p+F]={expand:function(T){for(var y=0,E={},A=typeof T=="string"?T.split(" "):[T];y<4;y++)E[p+Di[y]+F]=A[y]||A[y-2]||A[0];return E}},p!=="margin"&&(B.cssHooks[p+F].set=vn)}),B.fn.extend({css:function(p,F){return wi(this,function(T,y,E){var A,f,bt={},ct=0;if(Array.isArray(y)){for(A=on(T),f=y.length;ct<f;ct++)bt[y[ct]]=B.css(T,y[ct],!1,A);return bt}return E!==void 0?B.style(T,y,E):B.css(T,y)},p,F,arguments.length>1)}});function Al(p,F,T,y,E){return new Al.prototype.init(p,F,T,y,E)}B.Tween=Al,Al.prototype={constructor:Al,init:function(p,F,T,y,E,A){this.elem=p,this.prop=T,this.easing=E||B.easing._default,this.options=F,this.start=this.now=this.cur(),this.end=y,this.unit=A||(B.cssNumber[T]?"":"px")},cur:function(){var p=Al.propHooks[this.prop];return p&&p.get?p.get(this):Al.propHooks._default.get(this)},run:function(p){var F,T=Al.propHooks[this.prop];return this.options.duration?this.pos=F=B.easing[this.easing](p,this.options.duration*p,0,1,this.options.duration):this.pos=F=p,this.now=(this.end-this.start)*F+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),T&&T.set?T.set(this):Al.propHooks._default.set(this),this}},Al.prototype.init.prototype=Al.prototype,Al.propHooks={_default:{get:function(p){var F;return p.elem.nodeType!==1||p.elem[p.prop]!=null&&p.elem.style[p.prop]==null?p.elem[p.prop]:(F=B.css(p.elem,p.prop,""),!F||F==="auto"?0:F)},set:function(p){B.fx.step[p.prop]?B.fx.step[p.prop](p):p.elem.nodeType===1&&(B.cssHooks[p.prop]||p.elem.style[wn(p.prop)]!=null)?B.style(p.elem,p.prop,p.now+p.unit):p.elem[p.prop]=p.now}}},Al.propHooks.scrollTop=Al.propHooks.scrollLeft={set:function(p){p.elem.nodeType&&p.elem.parentNode&&(p.elem[p.prop]=p.now)}},B.easing={linear:function(p){return p},swing:function(p){return .5-Math.cos(p*Math.PI)/2},_default:"swing"},B.fx=Al.prototype.init,B.fx.step={};var Dn,oc,Lo=/^(?:toggle|show|hide)$/,Eo=/queueHooks$/;function rc(){oc&&(te.hidden===!1&&x.requestAnimationFrame?x.requestAnimationFrame(rc):x.setTimeout(rc,B.fx.interval),B.fx.tick())}function sc(){return x.setTimeout(function(){Dn=void 0}),Dn=Date.now()}function Zd(p,F){var T,y=0,E={height:p};for(F=F?1:0;y<4;y+=2-F)T=Di[y],E["margin"+T]=E["padding"+T]=p;return F&&(E.opacity=E.width=p),E}function Lc(p,F,T){for(var y,E=(Ua.tweeners[F]||[]).concat(Ua.tweeners["*"]),A=0,f=E.length;A<f;A++)if(y=E[A].call(T,F,p))return y}function Ec(p,F,T){var y,E,A,f,bt,ct,Gt,kt,Et="width"in F||"height"in F,yt=this,_t={},Ye=p.style,ti=p.nodeType&&O(p),we=We.get(p,"fxshow");T.queue||(f=B._queueHooks(p,"fx"),f.unqueued==null&&(f.unqueued=0,bt=f.empty.fire,f.empty.fire=function(){f.unqueued||bt()}),f.unqueued++,yt.always(function(){yt.always(function(){f.unqueued--,B.queue(p,"fx").length||f.empty.fire()})}));for(y in F)if(E=F[y],Lo.test(E)){if(delete F[y],A=A||E==="toggle",E===(ti?"hide":"show"))if(E==="show"&&we&&we[y]!==void 0)ti=!0;else continue;_t[y]=we&&we[y]||B.style(p,y)}if(ct=!B.isEmptyObject(F),!(!ct&&B.isEmptyObject(_t))){Et&&p.nodeType===1&&(T.overflow=[Ye.overflow,Ye.overflowX,Ye.overflowY],Gt=we&&we.display,Gt==null&&(Gt=We.get(p,"display")),kt=B.css(p,"display"),kt==="none"&&(Gt?kt=Gt:(K([p],!0),Gt=p.style.display||Gt,kt=B.css(p,"display"),K([p]))),(kt==="inline"||kt==="inline-block"&&Gt!=null)&&B.css(p,"float")==="none"&&(ct||(yt.done(function(){Ye.display=Gt}),Gt==null&&(kt=Ye.display,Gt=kt==="none"?"":kt)),Ye.display="inline-block")),T.overflow&&(Ye.overflow="hidden",yt.always(function(){Ye.overflow=T.overflow[0],Ye.overflowX=T.overflow[1],Ye.overflowY=T.overflow[2]})),ct=!1;for(y in _t)ct||(we?"hidden"in we&&(ti=we.hidden):we=We.access(p,"fxshow",{display:Gt}),A&&(we.hidden=!ti),ti&&K([p],!0),yt.done(function(){ti||K([p]),We.remove(p,"fxshow");for(y in _t)B.style(p,y,_t[y])})),ct=Lc(ti?we[y]:0,y,yt),y in we||(we[y]=ct.start,ti&&(ct.end=ct.start,ct.start=0))}}function zc(p,F){var T,y,E,A,f;for(T in p)if(y=Qi(T),E=F[y],A=p[T],Array.isArray(A)&&(E=A[1],A=p[T]=A[0]),T!==y&&(p[y]=A,delete p[T]),f=B.cssHooks[y],f&&"expand"in f){A=f.expand(A),delete p[y];for(T in A)T in p||(p[T]=A[T],F[T]=E)}else F[y]=E}function Ua(p,F,T){var y,E,A=0,f=Ua.prefilters.length,bt=B.Deferred().always(function(){delete ct.elem}),ct=function(){if(E)return!1;for(var Et=Dn||sc(),yt=Math.max(0,Gt.startTime+Gt.duration-Et),_t=yt/Gt.duration||0,Ye=1-_t,ti=0,we=Gt.tweens.length;ti<we;ti++)Gt.tweens[ti].run(Ye);return bt.notifyWith(p,[Gt,Ye,yt]),Ye<1&&we?yt:(we||bt.notifyWith(p,[Gt,1,0]),bt.resolveWith(p,[Gt]),!1)},Gt=bt.promise({elem:p,props:B.extend({},F),opts:B.extend(!0,{specialEasing:{},easing:B.easing._default},T),originalProperties:F,originalOptions:T,startTime:Dn||sc(),duration:T.duration,tweens:[],createTween:function(Et,yt){var _t=B.Tween(p,Gt.opts,Et,yt,Gt.opts.specialEasing[Et]||Gt.opts.easing);return Gt.tweens.push(_t),_t},stop:function(Et){var yt=0,_t=Et?Gt.tweens.length:0;if(E)return this;for(E=!0;yt<_t;yt++)Gt.tweens[yt].run(1);return Et?(bt.notifyWith(p,[Gt,1,0]),bt.resolveWith(p,[Gt,Et])):bt.rejectWith(p,[Gt,Et]),this}}),kt=Gt.props;for(zc(kt,Gt.opts.specialEasing);A<f;A++)if(y=Ua.prefilters[A].call(Gt,p,kt,Gt.opts),y)return gt(y.stop)&&(B._queueHooks(Gt.elem,Gt.opts.queue).stop=y.stop.bind(y)),y;return B.map(kt,Lc,Gt),gt(Gt.opts.start)&&Gt.opts.start.call(p,Gt),Gt.progress(Gt.opts.progress).done(Gt.opts.done,Gt.opts.complete).fail(Gt.opts.fail).always(Gt.opts.always),B.fx.timer(B.extend(ct,{elem:p,anim:Gt,queue:Gt.opts.queue})),Gt}B.Animation=B.extend(Ua,{tweeners:{"*":[function(p,F){var T=this.createTween(p,F);return dt(T.elem,p,zl.exec(F),T),T}]},tweener:function(p,F){gt(p)?(F=p,p=["*"]):p=p.match($i);for(var T,y=0,E=p.length;y<E;y++)T=p[y],Ua.tweeners[T]=Ua.tweeners[T]||[],Ua.tweeners[T].unshift(F)},prefilters:[Ec],prefilter:function(p,F){F?Ua.prefilters.unshift(p):Ua.prefilters.push(p)}}),B.speed=function(p,F,T){var y=p&&typeof p=="object"?B.extend({},p):{complete:T||!T&&F||gt(p)&&p,duration:p,easing:T&&F||F&&!gt(F)&&F};return B.fx.off?y.duration=0:typeof y.duration!="number"&&(y.duration in B.fx.speeds?y.duration=B.fx.speeds[y.duration]:y.duration=B.fx.speeds._default),(y.queue==null||y.queue===!0)&&(y.queue="fx"),y.old=y.complete,y.complete=function(){gt(y.old)&&y.old.call(this),y.queue&&B.dequeue(this,y.queue)},y},B.fn.extend({fadeTo:function(p,F,T,y){return this.filter(O).css("opacity",0).show().end().animate({opacity:F},p,T,y)},animate:function(p,F,T,y){var E=B.isEmptyObject(p),A=B.speed(F,T,y),f=function(){var bt=Ua(this,B.extend({},p),A);(E||We.get(this,"finish"))&&bt.stop(!0)};return f.finish=f,E||A.queue===!1?this.each(f):this.queue(A.queue,f)},stop:function(p,F,T){var y=function(E){var A=E.stop;delete E.stop,A(T)};return typeof p!="string"&&(T=F,F=p,p=void 0),F&&this.queue(p||"fx",[]),this.each(function(){var E=!0,A=p!=null&&p+"queueHooks",f=B.timers,bt=We.get(this);if(A)bt[A]&&bt[A].stop&&y(bt[A]);else for(A in bt)bt[A]&&bt[A].stop&&Eo.test(A)&&y(bt[A]);for(A=f.length;A--;)f[A].elem===this&&(p==null||f[A].queue===p)&&(f[A].anim.stop(T),E=!1,f.splice(A,1));(E||!T)&&B.dequeue(this,p)})},finish:function(p){return p!==!1&&(p=p||"fx"),this.each(function(){var F,T=We.get(this),y=T[p+"queue"],E=T[p+"queueHooks"],A=B.timers,f=y?y.length:0;for(T.finish=!0,B.queue(this,p,[]),E&&E.stop&&E.stop.call(this,!0),F=A.length;F--;)A[F].elem===this&&A[F].queue===p&&(A[F].anim.stop(!0),A.splice(F,1));for(F=0;F<f;F++)y[F]&&y[F].finish&&y[F].finish.call(this);delete T.finish})}}),B.each(["toggle","show","hide"],function(p,F){var T=B.fn[F];B.fn[F]=function(y,E,A){return y==null||typeof y=="boolean"?T.apply(this,arguments):this.animate(Zd(F,!0),y,E,A)}}),B.each({slideDown:Zd("show"),slideUp:Zd("hide"),slideToggle:Zd("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(p,F){B.fn[p]=function(T,y,E){return this.animate(F,T,y,E)}}),B.timers=[],B.fx.tick=function(){var p,F=0,T=B.timers;for(Dn=Date.now();F<T.length;F++)p=T[F],!p()&&T[F]===p&&T.splice(F--,1);T.length||B.fx.stop(),Dn=void 0},B.fx.timer=function(p){B.timers.push(p),B.fx.start()},B.fx.interval=13,B.fx.start=function(){oc||(oc=!0,rc())},B.fx.stop=function(){oc=null},B.fx.speeds={slow:600,fast:200,_default:400},B.fn.delay=function(p,F){return p=B.fx&&B.fx.speeds[p]||p,F=F||"fx",this.queue(F,function(T,y){var E=x.setTimeout(T,p);y.stop=function(){x.clearTimeout(E)}})},(function(){var p=te.createElement("input"),F=te.createElement("select"),T=F.appendChild(te.createElement("option"));p.type="checkbox",jt.checkOn=p.value!=="",jt.optSelected=T.selected,p=te.createElement("input"),p.value="t",p.type="radio",jt.radioValue=p.value==="t"})();var _a,In=B.expr.attrHandle;B.fn.extend({attr:function(p,F){return wi(this,B.attr,p,F,arguments.length>1)},removeAttr:function(p){return this.each(function(){B.removeAttr(this,p)})}}),B.extend({attr:function(p,F,T){var y,E,A=p.nodeType;if(!(A===3||A===8||A===2)){if(typeof p.getAttribute>"u")return B.prop(p,F,T);if((A!==1||!B.isXMLDoc(p))&&(E=B.attrHooks[F.toLowerCase()]||(B.expr.match.bool.test(F)?_a:void 0)),T!==void 0){if(T===null){B.removeAttr(p,F);return}return E&&"set"in E&&(y=E.set(p,T,F))!==void 0?y:(p.setAttribute(F,T+""),T)}return E&&"get"in E&&(y=E.get(p,F))!==null?y:(y=B.find.attr(p,F),y??void 0)}},attrHooks:{type:{set:function(p,F){if(!jt.radioValue&&F==="radio"&&Me(p,"input")){var T=p.value;return p.setAttribute("type",F),T&&(p.value=T),F}}}},removeAttr:function(p,F){var T,y=0,E=F&&F.match($i);if(E&&p.nodeType===1)for(;T=E[y++];)p.removeAttribute(T)}}),_a={set:function(p,F,T){return F===!1?B.removeAttr(p,T):p.setAttribute(T,T),T}},B.each(B.expr.match.bool.source.match(/\w+/g),function(p,F){var T=In[F]||B.find.attr;In[F]=function(y,E,A){var f,bt,ct=E.toLowerCase();return A||(bt=In[ct],In[ct]=f,f=T(y,E,A)!=null?ct:null,In[ct]=bt),f}});var zo=/^(?:input|select|textarea|button)$/i,Pa=/^(?:a|area)$/i;B.fn.extend({prop:function(p,F){return wi(this,B.prop,p,F,arguments.length>1)},removeProp:function(p){return this.each(function(){delete this[B.propFix[p]||p]})}}),B.extend({prop:function(p,F,T){var y,E,A=p.nodeType;if(!(A===3||A===8||A===2))return(A!==1||!B.isXMLDoc(p))&&(F=B.propFix[F]||F,E=B.propHooks[F]),T!==void 0?E&&"set"in E&&(y=E.set(p,T,F))!==void 0?y:p[F]=T:E&&"get"in E&&(y=E.get(p,F))!==null?y:p[F]},propHooks:{tabIndex:{get:function(p){var F=B.find.attr(p,"tabindex");return F?parseInt(F,10):zo.test(p.nodeName)||Pa.test(p.nodeName)&&p.href?0:-1}}},propFix:{for:"htmlFor",class:"className"}}),jt.optSelected||(B.propHooks.selected={get:function(p){var F=p.parentNode;return F&&F.parentNode&&F.parentNode.selectedIndex,null},set:function(p){var F=p.parentNode;F&&(F.selectedIndex,F.parentNode&&F.parentNode.selectedIndex)}}),B.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){B.propFix[this.toLowerCase()]=this});function Un(p){var F=p.match($i)||[];return F.join(" ")}function fn(p){return p.getAttribute&&p.getAttribute("class")||""}function Ka(p){return Array.isArray(p)?p:typeof p=="string"?p.match($i)||[]:[]}B.fn.extend({addClass:function(p){var F,T,y,E,A,f;return gt(p)?this.each(function(bt){B(this).addClass(p.call(this,bt,fn(this)))}):(F=Ka(p),F.length?this.each(function(){if(y=fn(this),T=this.nodeType===1&&" "+Un(y)+" ",T){for(A=0;A<F.length;A++)E=F[A],T.indexOf(" "+E+" ")<0&&(T+=E+" ");f=Un(T),y!==f&&this.setAttribute("class",f)}}):this)},removeClass:function(p){var F,T,y,E,A,f;return gt(p)?this.each(function(bt){B(this).removeClass(p.call(this,bt,fn(this)))}):arguments.length?(F=Ka(p),F.length?this.each(function(){if(y=fn(this),T=this.nodeType===1&&" "+Un(y)+" ",T){for(A=0;A<F.length;A++)for(E=F[A];T.indexOf(" "+E+" ")>-1;)T=T.replace(" "+E+" "," ");f=Un(T),y!==f&&this.setAttribute("class",f)}}):this):this.attr("class","")},toggleClass:function(p,F){var T,y,E,A,f=typeof p,bt=f==="string"||Array.isArray(p);return gt(p)?this.each(function(ct){B(this).toggleClass(p.call(this,ct,fn(this),F),F)}):typeof F=="boolean"&&bt?F?this.addClass(p):this.removeClass(p):(T=Ka(p),this.each(function(){if(bt)for(A=B(this),E=0;E<T.length;E++)y=T[E],A.hasClass(y)?A.removeClass(y):A.addClass(y);else(p===void 0||f==="boolean")&&(y=fn(this),y&&We.set(this,"__className__",y),this.setAttribute&&this.setAttribute("class",y||p===!1?"":We.get(this,"__className__")||""))}))},hasClass:function(p){var F,T,y=0;for(F=" "+p+" ";T=this[y++];)if(T.nodeType===1&&(" "+Un(fn(T))+" ").indexOf(F)>-1)return!0;return!1}});var On=/\r/g;B.fn.extend({val:function(p){var F,T,y,E=this[0];return arguments.length?(y=gt(p),this.each(function(A){var f;this.nodeType===1&&(y?f=p.call(this,A,B(this).val()):f=p,f==null?f="":typeof f=="number"?f+="":Array.isArray(f)&&(f=B.map(f,function(bt){return bt==null?"":bt+""})),F=B.valHooks[this.type]||B.valHooks[this.nodeName.toLowerCase()],(!F||!("set"in F)||F.set(this,f,"value")===void 0)&&(this.value=f))})):E?(F=B.valHooks[E.type]||B.valHooks[E.nodeName.toLowerCase()],F&&"get"in F&&(T=F.get(E,"value"))!==void 0?T:(T=E.value,typeof T=="string"?T.replace(On,""):T??"")):void 0}}),B.extend({valHooks:{option:{get:function(p){var F=B.find.attr(p,"value");return F??Un(B.text(p))}},select:{get:function(p){var F,T,y,E=p.options,A=p.selectedIndex,f=p.type==="select-one",bt=f?null:[],ct=f?A+1:E.length;for(A<0?y=ct:y=f?A:0;y<ct;y++)if(T=E[y],(T.selected||y===A)&&!T.disabled&&(!T.parentNode.disabled||!Me(T.parentNode,"optgroup"))){if(F=B(T).val(),f)return F;bt.push(F)}return bt},set:function(p,F){for(var T,y,E=p.options,A=B.makeArray(F),f=E.length;f--;)y=E[f],(y.selected=B.inArray(B.valHooks.option.get(y),A)>-1)&&(T=!0);return T||(p.selectedIndex=-1),A}}}}),B.each(["radio","checkbox"],function(){B.valHooks[this]={set:function(p,F){if(Array.isArray(F))return p.checked=B.inArray(B(p).val(),F)>-1}},jt.checkOn||(B.valHooks[this].get=function(p){return p.getAttribute("value")===null?"on":p.value})});var Ee=x.location,ma={guid:Date.now()},De=/\?/;B.parseXML=function(p){var F,T;if(!p||typeof p!="string")return null;try{F=new x.DOMParser().parseFromString(p,"text/xml")}catch{}return T=F&&F.getElementsByTagName("parsererror")[0],(!F||T)&&B.error("Invalid XML: "+(T?B.map(T.childNodes,function(y){return y.textContent}).join(`
`):p)),F};var rn=/^(?:focusinfocus|focusoutblur)$/,fi=function(p){p.stopPropagation()};B.extend(B.event,{trigger:function(p,F,T,y){var E,A,f,bt,ct,Gt,kt,Et,yt=[T||te],_t=ee.call(p,"type")?p.type:p,Ye=ee.call(p,"namespace")?p.namespace.split("."):[];if(A=Et=f=T=T||te,!(T.nodeType===3||T.nodeType===8)&&!rn.test(_t+B.event.triggered)&&(_t.indexOf(".")>-1&&(Ye=_t.split("."),_t=Ye.shift(),Ye.sort()),ct=_t.indexOf(":")<0&&"on"+_t,p=p[B.expando]?p:new B.Event(_t,typeof p=="object"&&p),p.isTrigger=y?2:3,p.namespace=Ye.join("."),p.rnamespace=p.namespace?new RegExp("(^|\\.)"+Ye.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,p.result=void 0,p.target||(p.target=T),F=F==null?[p]:B.makeArray(F,[p]),kt=B.event.special[_t]||{},!(!y&&kt.trigger&&kt.trigger.apply(T,F)===!1))){if(!y&&!kt.noBubble&&!Ie(T)){for(bt=kt.delegateType||_t,rn.test(bt+_t)||(A=A.parentNode);A;A=A.parentNode)yt.push(A),f=A;f===(T.ownerDocument||te)&&yt.push(f.defaultView||f.parentWindow||x)}for(E=0;(A=yt[E++])&&!p.isPropagationStopped();)Et=A,p.type=E>1?bt:kt.bindType||_t,Gt=(We.get(A,"events")||Object.create(null))[p.type]&&We.get(A,"handle"),Gt&&Gt.apply(A,F),Gt=ct&&A[ct],Gt&&Gt.apply&&ql(A)&&(p.result=Gt.apply(A,F),p.result===!1&&p.preventDefault());return p.type=_t,!y&&!p.isDefaultPrevented()&&(!kt._default||kt._default.apply(yt.pop(),F)===!1)&&ql(T)&&ct&&gt(T[_t])&&!Ie(T)&&(f=T[ct],f&&(T[ct]=null),B.event.triggered=_t,p.isPropagationStopped()&&Et.addEventListener(_t,fi),T[_t](),p.isPropagationStopped()&&Et.removeEventListener(_t,fi),B.event.triggered=void 0,f&&(T[ct]=f)),p.result}},simulate:function(p,F,T){var y=B.extend(new B.Event,T,{type:p,isSimulated:!0});B.event.trigger(y,null,F)}}),B.fn.extend({trigger:function(p,F){return this.each(function(){B.event.trigger(p,F,this)})},triggerHandler:function(p,F){var T=this[0];if(T)return B.event.trigger(p,F,T,!0)}});var Xl=/\[\]$/,Gl=/\r?\n/g,rl=/^(?:submit|button|image|reset|file)$/i,pi=/^(?:input|select|textarea|keygen)/i;function pd(p,F,T,y){var E;if(Array.isArray(F))B.each(F,function(A,f){T||Xl.test(p)?y(p,f):pd(p+"["+(typeof f=="object"&&f!=null?A:"")+"]",f,T,y)});else if(!T&&li(F)==="object")for(E in F)pd(p+"["+E+"]",F[E],T,y);else y(p,F)}B.param=function(p,F){var T,y=[],E=function(A,f){var bt=gt(f)?f():f;y[y.length]=encodeURIComponent(A)+"="+encodeURIComponent(bt??"")};if(p==null)return"";if(Array.isArray(p)||p.jquery&&!B.isPlainObject(p))B.each(p,function(){E(this.name,this.value)});else for(T in p)pd(T,p[T],F,E);return y.join("&")},B.fn.extend({serialize:function(){return B.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var p=B.prop(this,"elements");return p?B.makeArray(p):this}).filter(function(){var p=this.type;return this.name&&!B(this).is(":disabled")&&pi.test(this.nodeName)&&!rl.test(p)&&(this.checked||!ut.test(p))}).map(function(p,F){var T=B(this).val();return T==null?null:Array.isArray(T)?B.map(T,function(y){return{name:F.name,value:y.replace(Gl,`\r
`)}}):{name:F.name,value:T.replace(Gl,`\r
`)}}).get()}});var wl=/%20/g,ta=/#.*$/,Jl=/([?&])_=[^&]*/,jo=/^(.*?):[ \t]*([^\r\n]*)$/mg,Mn=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,Fi=/^(?:GET|HEAD)$/,Vd=/^\/\//,sn={},_n={},vl="*/".concat("*"),mi=te.createElement("a");mi.href=Ee.href;function Qa(p){return function(F,T){typeof F!="string"&&(T=F,F="*");var y,E=0,A=F.toLowerCase().match($i)||[];if(gt(T))for(;y=A[E++];)y[0]==="+"?(y=y.slice(1)||"*",(p[y]=p[y]||[]).unshift(T)):(p[y]=p[y]||[]).push(T)}}function $e(p,F,T,y){var E={},A=p===_n;function f(bt){var ct;return E[bt]=!0,B.each(p[bt]||[],function(Gt,kt){var Et=kt(F,T,y);if(typeof Et=="string"&&!A&&!E[Et])return F.dataTypes.unshift(Et),f(Et),!1;if(A)return!(ct=Et)}),ct}return f(F.dataTypes[0])||!E["*"]&&f("*")}function Se(p,F){var T,y,E=B.ajaxSettings.flatOptions||{};for(T in F)F[T]!==void 0&&((E[T]?p:y||(y={}))[T]=F[T]);return y&&B.extend(!0,p,y),p}function gd(p,F,T){for(var y,E,A,f,bt=p.contents,ct=p.dataTypes;ct[0]==="*";)ct.shift(),y===void 0&&(y=p.mimeType||F.getResponseHeader("Content-Type"));if(y){for(E in bt)if(bt[E]&&bt[E].test(y)){ct.unshift(E);break}}if(ct[0]in T)A=ct[0];else{for(E in T){if(!ct[0]||p.converters[E+" "+ct[0]]){A=E;break}f||(f=E)}A=A||f}if(A)return A!==ct[0]&&ct.unshift(A),T[A]}function Ke(p,F,T,y){var E,A,f,bt,ct,Gt={},kt=p.dataTypes.slice();if(kt[1])for(f in p.converters)Gt[f.toLowerCase()]=p.converters[f];for(A=kt.shift();A;)if(p.responseFields[A]&&(T[p.responseFields[A]]=F),!ct&&y&&p.dataFilter&&(F=p.dataFilter(F,p.dataType)),ct=A,A=kt.shift(),A){if(A==="*")A=ct;else if(ct!=="*"&&ct!==A){if(f=Gt[ct+" "+A]||Gt["* "+A],!f){for(E in Gt)if(bt=E.split(" "),bt[1]===A&&(f=Gt[ct+" "+bt[0]]||Gt["* "+bt[0]],f)){f===!0?f=Gt[E]:Gt[E]!==!0&&(A=bt[0],kt.unshift(bt[1]));break}}if(f!==!0)if(f&&p.throws)F=f(F);else try{F=f(F)}catch(Et){return{state:"parsererror",error:f?Et:"No conversion from "+ct+" to "+A}}}}return{state:"success",data:F}}B.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:Ee.href,type:"GET",isLocal:Mn.test(Ee.protocol),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":vl,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/\bxml\b/,html:/\bhtml/,json:/\bjson\b/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":JSON.parse,"text xml":B.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(p,F){return F?Se(Se(p,B.ajaxSettings),F):Se(B.ajaxSettings,p)},ajaxPrefilter:Qa(sn),ajaxTransport:Qa(_n),ajax:function(p,F){typeof p=="object"&&(F=p,p=void 0),F=F||{};var T,y,E,A,f,bt,ct,Gt,kt,Et,yt=B.ajaxSetup({},F),_t=yt.context||yt,Ye=yt.context&&(_t.nodeType||_t.jquery)?B(_t):B.event,ti=B.Deferred(),we=B.Callbacks("once memory"),Zl=yt.statusCode||{},Li={},Wa={},yi="canceled",fe={readyState:0,getResponseHeader:function(ei){var Gi;if(ct){if(!A)for(A={};Gi=jo.exec(E);)A[Gi[1].toLowerCase()+" "]=(A[Gi[1].toLowerCase()+" "]||[]).concat(Gi[2]);Gi=A[ei.toLowerCase()+" "]}return Gi==null?null:Gi.join(", ")},getAllResponseHeaders:function(){return ct?E:null},setRequestHeader:function(ei,Gi){return ct==null&&(ei=Wa[ei.toLowerCase()]=Wa[ei.toLowerCase()]||ei,Li[ei]=Gi),this},overrideMimeType:function(ei){return ct==null&&(yt.mimeType=ei),this},statusCode:function(ei){var Gi;if(ei)if(ct)fe.always(ei[fe.status]);else for(Gi in ei)Zl[Gi]=[Zl[Gi],ei[Gi]];return this},abort:function(ei){var Gi=ei||yi;return T&&T.abort(Gi),ha(0,Gi),this}};if(ti.promise(fe),yt.url=((p||yt.url||Ee.href)+"").replace(Vd,Ee.protocol+"//"),yt.type=F.method||F.type||yt.method||yt.type,yt.dataTypes=(yt.dataType||"*").toLowerCase().match($i)||[""],yt.crossDomain==null){bt=te.createElement("a");try{bt.href=yt.url,bt.href=bt.href,yt.crossDomain=mi.protocol+"//"+mi.host!=bt.protocol+"//"+bt.host}catch{yt.crossDomain=!0}}if(yt.data&&yt.processData&&typeof yt.data!="string"&&(yt.data=B.param(yt.data,yt.traditional)),$e(sn,yt,F,fe),ct)return fe;Gt=B.event&&yt.global,Gt&&B.active++===0&&B.event.trigger("ajaxStart"),yt.type=yt.type.toUpperCase(),yt.hasContent=!Fi.test(yt.type),y=yt.url.replace(ta,""),yt.hasContent?yt.data&&yt.processData&&(yt.contentType||"").indexOf("application/x-www-form-urlencoded")===0&&(yt.data=yt.data.replace(wl,"+")):(Et=yt.url.slice(y.length),yt.data&&(yt.processData||typeof yt.data=="string")&&(y+=(De.test(y)?"&":"?")+yt.data,delete yt.data),yt.cache===!1&&(y=y.replace(Jl,"$1"),Et=(De.test(y)?"&":"?")+"_="+ma.guid+++Et),yt.url=y+Et),yt.ifModified&&(B.lastModified[y]&&fe.setRequestHeader("If-Modified-Since",B.lastModified[y]),B.etag[y]&&fe.setRequestHeader("If-None-Match",B.etag[y])),(yt.data&&yt.hasContent&&yt.contentType!==!1||F.contentType)&&fe.setRequestHeader("Content-Type",yt.contentType),fe.setRequestHeader("Accept",yt.dataTypes[0]&&yt.accepts[yt.dataTypes[0]]?yt.accepts[yt.dataTypes[0]]+(yt.dataTypes[0]!=="*"?", "+vl+"; q=0.01":""):yt.accepts["*"]);for(kt in yt.headers)fe.setRequestHeader(kt,yt.headers[kt]);if(yt.beforeSend&&(yt.beforeSend.call(_t,fe,yt)===!1||ct))return fe.abort();if(yi="abort",we.add(yt.complete),fe.done(yt.success),fe.fail(yt.error),T=$e(_n,yt,F,fe),!T)ha(-1,"No Transport");else{if(fe.readyState=1,Gt&&Ye.trigger("ajaxSend",[fe,yt]),ct)return fe;yt.async&&yt.timeout>0&&(f=x.setTimeout(function(){fe.abort("timeout")},yt.timeout));try{ct=!1,T.send(Li,ha)}catch(ei){if(ct)throw ei;ha(-1,ei)}}function ha(ei,Gi,ea,jc){var Ma,mn,Nl,Yn,Ya,Za=Gi;ct||(ct=!0,f&&x.clearTimeout(f),T=void 0,E=jc||"",fe.readyState=ei>0?4:0,Ma=ei>=200&&ei<300||ei===304,ea&&(Yn=gd(yt,fe,ea)),!Ma&&B.inArray("script",yt.dataTypes)>-1&&B.inArray("json",yt.dataTypes)<0&&(yt.converters["text script"]=function(){}),Yn=Ke(yt,Yn,fe,Ma),Ma?(yt.ifModified&&(Ya=fe.getResponseHeader("Last-Modified"),Ya&&(B.lastModified[y]=Ya),Ya=fe.getResponseHeader("etag"),Ya&&(B.etag[y]=Ya)),ei===204||yt.type==="HEAD"?Za="nocontent":ei===304?Za="notmodified":(Za=Yn.state,mn=Yn.data,Nl=Yn.error,Ma=!Nl)):(Nl=Za,(ei||!Za)&&(Za="error",ei<0&&(ei=0))),fe.status=ei,fe.statusText=(Gi||Za)+"",Ma?ti.resolveWith(_t,[mn,Za,fe]):ti.rejectWith(_t,[fe,Za,Nl]),fe.statusCode(Zl),Zl=void 0,Gt&&Ye.trigger(Ma?"ajaxSuccess":"ajaxError",[fe,yt,Ma?mn:Nl]),we.fireWith(_t,[fe,Za]),Gt&&(Ye.trigger("ajaxComplete",[fe,yt]),--B.active||B.event.trigger("ajaxStop")))}return fe},getJSON:function(p,F,T){return B.get(p,F,T,"json")},getScript:function(p,F){return B.get(p,void 0,F,"script")}}),B.each(["get","post"],function(p,F){B[F]=function(T,y,E,A){return gt(y)&&(A=A||E,E=y,y=void 0),B.ajax(B.extend({url:T,type:F,dataType:A,data:y,success:E},B.isPlainObject(T)&&T))}}),B.ajaxPrefilter(function(p){var F;for(F in p.headers)F.toLowerCase()==="content-type"&&(p.contentType=p.headers[F]||"")}),B._evalUrl=function(p,F,T){return B.ajax({url:p,type:"GET",dataType:"script",cache:!0,async:!1,global:!1,converters:{"text script":function(){}},dataFilter:function(y){B.globalEval(y,F,T)}})},B.fn.extend({wrapAll:function(p){var F;return this[0]&&(gt(p)&&(p=p.call(this[0])),F=B(p,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&F.insertBefore(this[0]),F.map(function(){for(var T=this;T.firstElementChild;)T=T.firstElementChild;return T}).append(this)),this},wrapInner:function(p){return gt(p)?this.each(function(F){B(this).wrapInner(p.call(this,F))}):this.each(function(){var F=B(this),T=F.contents();T.length?T.wrapAll(p):F.append(p)})},wrap:function(p){var F=gt(p);return this.each(function(T){B(this).wrapAll(F?p.call(this,T):p)})},unwrap:function(p){return this.parent(p).not("body").each(function(){B(this).replaceWith(this.childNodes)}),this}}),B.expr.pseudos.hidden=function(p){return!B.expr.pseudos.visible(p)},B.expr.pseudos.visible=function(p){return!!(p.offsetWidth||p.offsetHeight||p.getClientRects().length)},B.ajaxSettings.xhr=function(){try{return new x.XMLHttpRequest}catch{}};var ud={0:200,1223:204},Hl=B.ajaxSettings.xhr();jt.cors=!!Hl&&"withCredentials"in Hl,jt.ajax=Hl=!!Hl,B.ajaxTransport(function(p){var F,T;if(jt.cors||Hl&&!p.crossDomain)return{send:function(y,E){var A,f=p.xhr();if(f.open(p.type,p.url,p.async,p.username,p.password),p.xhrFields)for(A in p.xhrFields)f[A]=p.xhrFields[A];p.mimeType&&f.overrideMimeType&&f.overrideMimeType(p.mimeType),!p.crossDomain&&!y["X-Requested-With"]&&(y["X-Requested-With"]="XMLHttpRequest");for(A in y)f.setRequestHeader(A,y[A]);F=function(bt){return function(){F&&(F=T=f.onload=f.onerror=f.onabort=f.ontimeout=f.onreadystatechange=null,bt==="abort"?f.abort():bt==="error"?typeof f.status!="number"?E(0,"error"):E(f.status,f.statusText):E(ud[f.status]||f.status,f.statusText,(f.responseType||"text")!=="text"||typeof f.responseText!="string"?{binary:f.response}:{text:f.responseText},f.getAllResponseHeaders()))}},f.onload=F(),T=f.onerror=f.ontimeout=F("error"),f.onabort!==void 0?f.onabort=T:f.onreadystatechange=function(){f.readyState===4&&x.setTimeout(function(){F&&T()})},F=F("abort");try{f.send(p.hasContent&&p.data||null)}catch(bt){if(F)throw bt}},abort:function(){F&&F()}}}),B.ajaxPrefilter(function(p){p.crossDomain&&(p.contents.script=!1)}),B.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/\b(?:java|ecma)script\b/},converters:{"text script":function(p){return B.globalEval(p),p}}}),B.ajaxPrefilter("script",function(p){p.cache===void 0&&(p.cache=!1),p.crossDomain&&(p.type="GET")}),B.ajaxTransport("script",function(p){if(p.crossDomain||p.scriptAttrs){var F,T;return{send:function(y,E){F=B("<script>").attr(p.scriptAttrs||{}).prop({charset:p.scriptCharset,src:p.url}).on("load error",T=function(A){F.remove(),T=null,A&&E(A.type==="error"?404:200,A.type)}),te.head.appendChild(F[0])},abort:function(){T&&T()}}}});var Rd=[],bn=/(=)\?(?=&|$)|\?\?/;B.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var p=Rd.pop()||B.expando+"_"+ma.guid++;return this[p]=!0,p}}),B.ajaxPrefilter("json jsonp",function(p,F,T){var y,E,A,f=p.jsonp!==!1&&(bn.test(p.url)?"url":typeof p.data=="string"&&(p.contentType||"").indexOf("application/x-www-form-urlencoded")===0&&bn.test(p.data)&&"data");if(f||p.dataTypes[0]==="jsonp")return y=p.jsonpCallback=gt(p.jsonpCallback)?p.jsonpCallback():p.jsonpCallback,f?p[f]=p[f].replace(bn,"$1"+y):p.jsonp!==!1&&(p.url+=(De.test(p.url)?"&":"?")+p.jsonp+"="+y),p.converters["script json"]=function(){return A||B.error(y+" was not called"),A[0]},p.dataTypes[0]="json",E=x[y],x[y]=function(){A=arguments},T.always(function(){E===void 0?B(x).removeProp(y):x[y]=E,p[y]&&(p.jsonpCallback=F.jsonpCallback,Rd.push(y)),A&&gt(E)&&E(A[0]),A=E=void 0}),"script"}),jt.createHTMLDocument=(function(){var p=te.implementation.createHTMLDocument("").body;return p.innerHTML="<form></form><form></form>",p.childNodes.length===2})(),B.parseHTML=function(p,F,T){if(typeof p!="string")return[];typeof F=="boolean"&&(T=F,F=!1);var y,E,A;return F||(jt.createHTMLDocument?(F=te.implementation.createHTMLDocument(""),y=F.createElement("base"),y.href=te.location.href,F.head.appendChild(y)):F=te),E=dn.exec(p),A=!T&&[],E?[F.createElement(E[1])]:(E=Ti([p],F,A),A&&A.length&&B(A).remove(),B.merge([],E.childNodes))},B.fn.load=function(p,F,T){var y,E,A,f=this,bt=p.indexOf(" ");return bt>-1&&(y=Un(p.slice(bt)),p=p.slice(0,bt)),gt(F)?(T=F,F=void 0):F&&typeof F=="object"&&(E="POST"),f.length>0&&B.ajax({url:p,type:E||"GET",dataType:"html",data:F}).done(function(ct){A=arguments,f.html(y?B("<div>").append(B.parseHTML(ct)).find(y):ct)}).always(T&&function(ct,Gt){f.each(function(){T.apply(this,A||[ct.responseText,Gt,ct])})}),this},B.expr.pseudos.animated=function(p){return B.grep(B.timers,function(F){return p===F.elem}).length},B.offset={setOffset:function(p,F,T){var y,E,A,f,bt,ct,Gt,kt=B.css(p,"position"),Et=B(p),yt={};kt==="static"&&(p.style.position="relative"),bt=Et.offset(),A=B.css(p,"top"),ct=B.css(p,"left"),Gt=(kt==="absolute"||kt==="fixed")&&(A+ct).indexOf("auto")>-1,Gt?(y=Et.position(),f=y.top,E=y.left):(f=parseFloat(A)||0,E=parseFloat(ct)||0),gt(F)&&(F=F.call(p,T,B.extend({},bt))),F.top!=null&&(yt.top=F.top-bt.top+f),F.left!=null&&(yt.left=F.left-bt.left+E),"using"in F?F.using.call(p,yt):Et.css(yt)}},B.fn.extend({offset:function(p){if(arguments.length)return p===void 0?this:this.each(function(E){B.offset.setOffset(this,p,E)});var F,T,y=this[0];if(y)return y.getClientRects().length?(F=y.getBoundingClientRect(),T=y.ownerDocument.defaultView,{top:F.top+T.pageYOffset,left:F.left+T.pageXOffset}):{top:0,left:0}},position:function(){if(this[0]){var p,F,T,y=this[0],E={top:0,left:0};if(B.css(y,"position")==="fixed")F=y.getBoundingClientRect();else{for(F=this.offset(),T=y.ownerDocument,p=y.offsetParent||T.documentElement;p&&(p===T.body||p===T.documentElement)&&B.css(p,"position")==="static";)p=p.parentNode;p&&p!==y&&p.nodeType===1&&(E=B(p).offset(),E.top+=B.css(p,"borderTopWidth",!0),E.left+=B.css(p,"borderLeftWidth",!0))}return{top:F.top-E.top-B.css(y,"marginTop",!0),left:F.left-E.left-B.css(y,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){for(var p=this.offsetParent;p&&B.css(p,"position")==="static";)p=p.offsetParent;return p||ht})}}),B.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(p,F){var T=F==="pageYOffset";B.fn[p]=function(y){return wi(this,function(E,A,f){var bt;if(Ie(E)?bt=E:E.nodeType===9&&(bt=E.defaultView),f===void 0)return bt?bt[F]:E[A];bt?bt.scrollTo(T?bt.pageXOffset:f,T?f:bt.pageYOffset):E[A]=f},p,y,arguments.length)}}),B.each(["top","left"],function(p,F){B.cssHooks[F]=An(jt.pixelPosition,function(T,y){if(y)return y=fa(T,F),ka.test(y)?B(T).position()[F]+"px":y})}),B.each({Height:"height",Width:"width"},function(p,F){B.each({padding:"inner"+p,content:F,"":"outer"+p},function(T,y){B.fn[y]=function(E,A){var f=arguments.length&&(T||typeof E!="boolean"),bt=T||(E===!0||A===!0?"margin":"border");return wi(this,function(ct,Gt,kt){var Et;return Ie(ct)?y.indexOf("outer")===0?ct["inner"+p]:ct.document.documentElement["client"+p]:ct.nodeType===9?(Et=ct.documentElement,Math.max(ct.body["scroll"+p],Et["scroll"+p],ct.body["offset"+p],Et["offset"+p],Et["client"+p])):kt===void 0?B.css(ct,Gt,bt):B.style(ct,Gt,kt,bt)},F,f?E:void 0,f)}})}),B.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(p,F){B.fn[F]=function(T){return this.on(F,T)}}),B.fn.extend({bind:function(p,F,T){return this.on(p,null,F,T)},unbind:function(p,F){return this.off(p,null,F)},delegate:function(p,F,T,y){return this.on(F,p,T,y)},undelegate:function(p,F,T){return arguments.length===1?this.off(p,"**"):this.off(F,p||"**",T)},hover:function(p,F){return this.on("mouseenter",p).on("mouseleave",F||p)}}),B.each("blur focus focusin focusout resize scroll click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup contextmenu".split(" "),function(p,F){B.fn[F]=function(T,y){return arguments.length>0?this.on(F,null,T,y):this.trigger(F)}});var bc=/^[\s\uFEFF\xA0]+|([^\s\uFEFF\xA0])[\s\uFEFF\xA0]+$/g;B.proxy=function(p,F){var T,y,E;if(typeof F=="string"&&(T=p[F],F=p,p=T),!!gt(p))return y=I.call(arguments,2),E=function(){return p.apply(F||this,y.concat(I.call(arguments)))},E.guid=p.guid=p.guid||B.guid++,E},B.holdReady=function(p){p?B.readyWait++:B.ready(!0)},B.isArray=Array.isArray,B.parseJSON=JSON.parse,B.nodeName=Me,B.isFunction=gt,B.isWindow=Ie,B.camelCase=Qi,B.type=li,B.now=Date.now,B.isNumeric=function(p){var F=B.type(p);return(F==="number"||F==="string")&&!isNaN(p-parseFloat(p))},B.trim=function(p){return p==null?"":(p+"").replace(bc,"$1")},typeof define=="function"&&define.amd&&define("jquery",[],function(){return B});var Bd=x.jQuery,Sd=x.$;return B.noConflict=function(p){return x.$===B&&(x.$=Sd),p&&x.jQuery===B&&(x.jQuery=Bd),B},typeof g>"u"&&(x.jQuery=x.$=B),B})});var P1=eZ(lZ());function aZ(x){if(!x)throw new Error("geojson is required");switch(x.type){case"Feature":return nZ(x);case"FeatureCollection":return mu(x);case"Point":case"LineString":case"Polygon":case"MultiPoint":case"MultiLineString":case"MultiPolygon":case"GeometryCollection":return d1(x);default:throw new Error("unknown GeoJSON type")}}function nZ(x){let g={type:"Feature"};return Object.keys(x).forEach(Y=>{switch(Y){case"type":case"properties":case"geometry":return;default:g[Y]=x[Y]}}),g.properties=dZ(x.properties),x.geometry==null?g.geometry=null:g.geometry=d1(x.geometry),g}function dZ(x){let g={};return x&&Object.keys(x).forEach(Y=>{let D=x[Y];typeof D=="object"?D===null?g[Y]=null:Array.isArray(D)?g[Y]=D.map(I=>I):g[Y]=dZ(D):g[Y]=D}),g}function mu(x){let g={type:"FeatureCollection"};return Object.keys(x).forEach(Y=>{switch(Y){case"type":case"features":return;default:g[Y]=x[Y]}}),g.features=x.features.map(Y=>nZ(Y)),g}function d1(x){let g={type:x.type};return x.bbox&&(g.bbox=x.bbox),x.type==="GeometryCollection"?(g.geometries=x.geometries.map(Y=>d1(Y)),g):(g.coordinates=cZ(x.coordinates),g)}function cZ(x){let g=x;return typeof g[0]!="object"?g.slice():g.map(Y=>cZ(Y))}var gn=63710088e-1,Wu={centimeters:gn*100,centimetres:gn*100,degrees:360/(2*Math.PI),feet:gn*3.28084,inches:gn*39.37,kilometers:gn/1e3,kilometres:gn/1e3,meters:gn,metres:gn,miles:gn/1609.344,millimeters:gn*1e3,millimetres:gn*1e3,nauticalmiles:gn/1852,radians:1,yards:gn*1.0936};function hu(x,g,Y={}){let D={type:"Feature"};return(Y.id===0||Y.id)&&(D.id=Y.id),Y.bbox&&(D.bbox=Y.bbox),D.properties=g||{},D.geometry=x,D}function c1(x,g,Y={}){if(!x)throw new Error("coordinates is required");if(!Array.isArray(x))throw new Error("coordinates must be an Array");if(x.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!oZ(x[0])||!oZ(x[1]))throw new Error("coordinates must contain numbers");return hu({type:"Point",coordinates:x},g,Y)}function rZ(x,g={}){let Y={type:"FeatureCollection"};return g.id&&(Y.id=g.id),g.bbox&&(Y.bbox=g.bbox),Y.features=x,Y}function sZ(x,g="kilometers"){let Y=Wu[g];if(!Y)throw new Error(g+" units is invalid");return x*Y}function Os(x){return x%360*Math.PI/180}function oZ(x){return!isNaN(x)&&x!==null&&!Array.isArray(x)}function o1(x){if(!x)throw new Error("coord is required");if(!Array.isArray(x)){if(x.type==="Feature"&&x.geometry!==null&&x.geometry.type==="Point")return[...x.geometry.coordinates];if(x.type==="Point")return[...x.coordinates]}if(Array.isArray(x)&&x.length>=2&&!Array.isArray(x[0])&&!Array.isArray(x[1]))return[...x];throw new Error("coord must be GeoJSON Point or an Array of numbers")}function bZ(x,g,Y={}){var D=o1(x),I=o1(g),o=Os(I[1]-D[1]),st=Os(I[0]-D[0]),Ct=Os(D[1]),vt=Os(I[1]),de=Math.pow(Math.sin(o/2),2)+Math.pow(Math.sin(st/2),2)*Math.cos(Ct)*Math.cos(vt);return sZ(2*Math.atan2(Math.sqrt(de),Math.sqrt(1-de)),Y.units)}function mZ(x,g){if(x.type==="Feature")g(x,0);else if(x.type==="FeatureCollection")for(var Y=0;Y<x.features.length&&g(x.features[Y],Y)!==!1;Y++);}var Zu=Object.defineProperty,pu=Object.defineProperties,Vu=Object.getOwnPropertyDescriptors,WZ=Object.getOwnPropertySymbols,gu=Object.prototype.hasOwnProperty,uu=Object.prototype.propertyIsEnumerable,hZ=(x,g,Y)=>g in x?Zu(x,g,{enumerable:!0,configurable:!0,writable:!0,value:Y}):x[g]=Y,ZZ=(x,g)=>{for(var Y in g||(g={}))gu.call(g,Y)&&hZ(x,Y,g[Y]);if(WZ)for(var Y of WZ(g))uu.call(g,Y)&&hZ(x,Y,g[Y]);return x},pZ=(x,g)=>pu(x,Vu(g));function Ru(x,g,Y={}){if(!x)throw new Error("targetPoint is required");if(!g)throw new Error("points is required");let D=1/0,I=0;mZ(g,(st,Ct)=>{let vt=bZ(x,st,Y);vt<D&&(I=Ct,D=vt)});let o=aZ(g.features[I]);return pZ(ZZ({},o),{properties:pZ(ZZ({},o.properties),{featureIndex:I,distanceToPoint:D})})}var r1=Ru;var Mb={};su(Mb,{afterMain:()=>GZ,afterRead:()=>uZ,afterWrite:()=>UZ,applyStyles:()=>Sr,arrow:()=>gb,auto:()=>_s,basePlacements:()=>ec,beforeMain:()=>RZ,beforeRead:()=>VZ,beforeWrite:()=>NZ,bottom:()=>Ll,clippingParents:()=>s1,computeStyles:()=>kr,createPopper:()=>a0,createPopperBase:()=>SZ,createPopperLite:()=>CZ,detectOverflow:()=>va,end:()=>Tc,eventListeners:()=>Qr,flip:()=>Gb,hide:()=>Nb,left:()=>Rl,main:()=>FZ,modifierPhases:()=>m1,offset:()=>Ib,placements:()=>Ks,popper:()=>No,popperGenerator:()=>Jo,popperOffsets:()=>zr,preventOverflow:()=>Ub,read:()=>gZ,reference:()=>b1,right:()=>Ml,start:()=>Jd,top:()=>Wl,variationPlacements:()=>Vb,viewport:()=>Ps,write:()=>IZ});var Wl="top",Ll="bottom",Ml="right",Rl="left",_s="auto",ec=[Wl,Ll,Ml,Rl],Jd="start",Tc="end",s1="clippingParents",Ps="viewport",No="popper",b1="reference",Vb=ec.reduce(function(x,g){return x.concat([g+"-"+Jd,g+"-"+Tc])},[]),Ks=[].concat(ec,[_s]).reduce(function(x,g){return x.concat([g,g+"-"+Jd,g+"-"+Tc])},[]),VZ="beforeRead",gZ="read",uZ="afterRead",RZ="beforeMain",FZ="main",GZ="afterMain",NZ="beforeWrite",IZ="write",UZ="afterWrite",m1=[VZ,gZ,uZ,RZ,FZ,GZ,NZ,IZ,UZ];function oa(x){return x?(x.nodeName||"").toLowerCase():null}function dl(x){if(x==null)return window;if(x.toString()!=="[object Window]"){var g=x.ownerDocument;return g&&g.defaultView||window}return x}function Bn(x){var g=dl(x).Element;return x instanceof g||x instanceof Element}function Ol(x){var g=dl(x).HTMLElement;return x instanceof g||x instanceof HTMLElement}function Br(x){if(typeof ShadowRoot>"u")return!1;var g=dl(x).ShadowRoot;return x instanceof g||x instanceof ShadowRoot}function Fu(x){var g=x.state;Object.keys(g.elements).forEach(function(Y){var D=g.styles[Y]||{},I=g.attributes[Y]||{},o=g.elements[Y];!Ol(o)||!oa(o)||(Object.assign(o.style,D),Object.keys(I).forEach(function(st){var Ct=I[st];Ct===!1?o.removeAttribute(st):o.setAttribute(st,Ct===!0?"":Ct)}))})}function Gu(x){var g=x.state,Y={popper:{position:g.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(g.elements.popper.style,Y.popper),g.styles=Y,g.elements.arrow&&Object.assign(g.elements.arrow.style,Y.arrow),function(){Object.keys(g.elements).forEach(function(D){var I=g.elements[D],o=g.attributes[D]||{},st=Object.keys(g.styles.hasOwnProperty(D)?g.styles[D]:Y[D]),Ct=st.reduce(function(vt,de){return vt[de]="",vt},{});!Ol(I)||!oa(I)||(Object.assign(I.style,Ct),Object.keys(o).forEach(function(vt){I.removeAttribute(vt)}))})}}var Sr={name:"applyStyles",enabled:!0,phase:"write",fn:Fu,effect:Gu,requires:["computeStyles"]};function ra(x){return x.split("-")[0]}var md=Math.max,Io=Math.min,ic=Math.round;function Cr(){var x=navigator.userAgentData;return x!=null&&x.brands&&Array.isArray(x.brands)?x.brands.map(function(g){return g.brand+"/"+g.version}).join(" "):navigator.userAgent}function qs(){return!/^((?!chrome|android).)*safari/i.test(Cr())}function Sn(x,g,Y){g===void 0&&(g=!1),Y===void 0&&(Y=!1);var D=x.getBoundingClientRect(),I=1,o=1;g&&Ol(x)&&(I=x.offsetWidth>0&&ic(D.width)/x.offsetWidth||1,o=x.offsetHeight>0&&ic(D.height)/x.offsetHeight||1);var st=Bn(x)?dl(x):window,Ct=st.visualViewport,vt=!qs()&&Y,de=(D.left+(vt&&Ct?Ct.offsetLeft:0))/I,ee=(D.top+(vt&&Ct?Ct.offsetTop:0))/o,ge=D.width/I,ye=D.height/o;return{width:ge,height:ye,top:ee,right:de+ge,bottom:ee+ye,left:de,x:de,y:ee}}function Uo(x){var g=Sn(x),Y=x.offsetWidth,D=x.offsetHeight;return Math.abs(g.width-Y)<=1&&(Y=g.width),Math.abs(g.height-D)<=1&&(D=g.height),{x:x.offsetLeft,y:x.offsetTop,width:Y,height:D}}function $s(x,g){var Y=g.getRootNode&&g.getRootNode();if(x.contains(g))return!0;if(Y&&Br(Y)){var D=g;do{if(D&&x.isSameNode(D))return!0;D=D.parentNode||D.host}while(D)}return!1}function wa(x){return dl(x).getComputedStyle(x)}function W1(x){return["table","td","th"].indexOf(oa(x))>=0}function Ga(x){return((Bn(x)?x.ownerDocument:x.document)||window.document).documentElement}function lc(x){return oa(x)==="html"?x:x.assignedSlot||x.parentNode||(Br(x)?x.host:null)||Ga(x)}function MZ(x){return!Ol(x)||wa(x).position==="fixed"?null:x.offsetParent}function Nu(x){var g=/firefox/i.test(Cr()),Y=/Trident/i.test(Cr());if(Y&&Ol(x)){var D=wa(x);if(D.position==="fixed")return null}var I=lc(x);for(Br(I)&&(I=I.host);Ol(I)&&["html","body"].indexOf(oa(I))<0;){var o=wa(I);if(o.transform!=="none"||o.perspective!=="none"||o.contain==="paint"||["transform","perspective"].indexOf(o.willChange)!==-1||g&&o.willChange==="filter"||g&&o.filter&&o.filter!=="none")return I;I=I.parentNode}return null}function Wd(x){for(var g=dl(x),Y=MZ(x);Y&&W1(Y)&&wa(Y).position==="static";)Y=MZ(Y);return Y&&(oa(Y)==="html"||oa(Y)==="body"&&wa(Y).position==="static")?g:Y||Nu(x)||g}function Mo(x){return["top","bottom"].indexOf(x)>=0?"x":"y"}function Yo(x,g,Y){return md(x,Io(g,Y))}function YZ(x,g,Y){var D=Yo(x,g,Y);return D>Y?Y:D}function t0(){return{top:0,right:0,bottom:0,left:0}}function e0(x){return Object.assign({},t0(),x)}function i0(x,g){return g.reduce(function(Y,D){return Y[D]=x,Y},{})}var Iu=function(g,Y){return g=typeof g=="function"?g(Object.assign({},Y.rects,{placement:Y.placement})):g,e0(typeof g!="number"?g:i0(g,ec))};function Uu(x){var g,Y=x.state,D=x.name,I=x.options,o=Y.elements.arrow,st=Y.modifiersData.popperOffsets,Ct=ra(Y.placement),vt=Mo(Ct),de=[Rl,Ml].indexOf(Ct)>=0,ee=de?"height":"width";if(!(!o||!st)){var ge=Iu(I.padding,Y),ye=Uo(o),jt=vt==="y"?Wl:Rl,gt=vt==="y"?Ll:Ml,Ie=Y.rects.reference[ee]+Y.rects.reference[vt]-st[vt]-Y.rects.popper[ee],te=st[vt]-Y.rects.reference[vt],Ue=Wd(o),di=Ue?vt==="y"?Ue.clientHeight||0:Ue.clientWidth||0:0,li=Ie/2-te/2,ze=ge[jt],je=di-ye[ee]-ge[gt],B=di/2-ye[ee]/2+li,ii=Yo(ze,B,je),Me=vt;Y.modifiersData[D]=(g={},g[Me]=ii,g.centerOffset=ii-B,g)}}function Mu(x){var g=x.state,Y=x.options,D=Y.element,I=D===void 0?"[data-popper-arrow]":D;I!=null&&(typeof I=="string"&&(I=g.elements.popper.querySelector(I),!I)||$s(g.elements.popper,I)&&(g.elements.arrow=I))}var gb={name:"arrow",enabled:!0,phase:"main",fn:Uu,effect:Mu,requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function Cn(x){return x.split("-")[1]}var Yu={top:"auto",right:"auto",bottom:"auto",left:"auto"};function xu(x,g){var Y=x.x,D=x.y,I=g.devicePixelRatio||1;return{x:ic(Y*I)/I||0,y:ic(D*I)/I||0}}function xZ(x){var g,Y=x.popper,D=x.popperRect,I=x.placement,o=x.variation,st=x.offsets,Ct=x.position,vt=x.gpuAcceleration,de=x.adaptive,ee=x.roundOffsets,ge=x.isFixed,ye=st.x,jt=ye===void 0?0:ye,gt=st.y,Ie=gt===void 0?0:gt,te=typeof ee=="function"?ee({x:jt,y:Ie}):{x:jt,y:Ie};jt=te.x,Ie=te.y;var Ue=st.hasOwnProperty("x"),di=st.hasOwnProperty("y"),li=Rl,ze=Wl,je=window;if(de){var B=Wd(Y),ii="clientHeight",Me="clientWidth";if(B===dl(Y)&&(B=Ga(Y),wa(B).position!=="static"&&Ct==="absolute"&&(ii="scrollHeight",Me="scrollWidth")),B=B,I===Wl||(I===Rl||I===Ml)&&o===Tc){ze=Ll;var ui=ge&&B===je&&je.visualViewport?je.visualViewport.height:B[ii];Ie-=ui-D.height,Ie*=vt?1:-1}if(I===Rl||(I===Wl||I===Ll)&&o===Tc){li=Ml;var ri=ge&&B===je&&je.visualViewport?je.visualViewport.width:B[Me];jt-=ri-D.width,jt*=vt?1:-1}}var xi=Object.assign({position:Ct},de&&Yu),Qe=ee===!0?xu({x:jt,y:Ie},dl(Y)):{x:jt,y:Ie};if(jt=Qe.x,Ie=Qe.y,vt){var Ui;return Object.assign({},xi,(Ui={},Ui[ze]=di?"0":"",Ui[li]=Ue?"0":"",Ui.transform=(je.devicePixelRatio||1)<=1?"translate("+jt+"px, "+Ie+"px)":"translate3d("+jt+"px, "+Ie+"px, 0)",Ui))}return Object.assign({},xi,(g={},g[ze]=di?Ie+"px":"",g[li]=Ue?jt+"px":"",g.transform="",g))}function Tu(x){var g=x.state,Y=x.options,D=Y.gpuAcceleration,I=D===void 0?!0:D,o=Y.adaptive,st=o===void 0?!0:o,Ct=Y.roundOffsets,vt=Ct===void 0?!0:Ct,de={placement:ra(g.placement),variation:Cn(g.placement),popper:g.elements.popper,popperRect:g.rects.popper,gpuAcceleration:I,isFixed:g.options.strategy==="fixed"};g.modifiersData.popperOffsets!=null&&(g.styles.popper=Object.assign({},g.styles.popper,xZ(Object.assign({},de,{offsets:g.modifiersData.popperOffsets,position:g.options.strategy,adaptive:st,roundOffsets:vt})))),g.modifiersData.arrow!=null&&(g.styles.arrow=Object.assign({},g.styles.arrow,xZ(Object.assign({},de,{offsets:g.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:vt})))),g.attributes.popper=Object.assign({},g.attributes.popper,{"data-popper-placement":g.placement})}var kr={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:Tu,data:{}};var ub={passive:!0};function Xu(x){var g=x.state,Y=x.instance,D=x.options,I=D.scroll,o=I===void 0?!0:I,st=D.resize,Ct=st===void 0?!0:st,vt=dl(g.elements.popper),de=[].concat(g.scrollParents.reference,g.scrollParents.popper);return o&&de.forEach(function(ee){ee.addEventListener("scroll",Y.update,ub)}),Ct&&vt.addEventListener("resize",Y.update,ub),function(){o&&de.forEach(function(ee){ee.removeEventListener("scroll",Y.update,ub)}),Ct&&vt.removeEventListener("resize",Y.update,ub)}}var Qr={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:Xu,data:{}};var Ju={left:"right",right:"left",bottom:"top",top:"bottom"};function Lr(x){return x.replace(/left|right|bottom|top/g,function(g){return Ju[g]})}var yu={start:"end",end:"start"};function Rb(x){return x.replace(/start|end/g,function(g){return yu[g]})}function xo(x){var g=dl(x),Y=g.pageXOffset,D=g.pageYOffset;return{scrollLeft:Y,scrollTop:D}}function To(x){return Sn(Ga(x)).left+xo(x).scrollLeft}function h1(x,g){var Y=dl(x),D=Ga(x),I=Y.visualViewport,o=D.clientWidth,st=D.clientHeight,Ct=0,vt=0;if(I){o=I.width,st=I.height;var de=qs();(de||!de&&g==="fixed")&&(Ct=I.offsetLeft,vt=I.offsetTop)}return{width:o,height:st,x:Ct+To(x),y:vt}}function Z1(x){var g,Y=Ga(x),D=xo(x),I=(g=x.ownerDocument)==null?void 0:g.body,o=md(Y.scrollWidth,Y.clientWidth,I?I.scrollWidth:0,I?I.clientWidth:0),st=md(Y.scrollHeight,Y.clientHeight,I?I.scrollHeight:0,I?I.clientHeight:0),Ct=-D.scrollLeft+To(x),vt=-D.scrollTop;return wa(I||Y).direction==="rtl"&&(Ct+=md(Y.clientWidth,I?I.clientWidth:0)-o),{width:o,height:st,x:Ct,y:vt}}function Xo(x){var g=wa(x),Y=g.overflow,D=g.overflowX,I=g.overflowY;return/auto|scroll|overlay|hidden/.test(Y+I+D)}function Fb(x){return["html","body","#document"].indexOf(oa(x))>=0?x.ownerDocument.body:Ol(x)&&Xo(x)?x:Fb(lc(x))}function Xc(x,g){var Y;g===void 0&&(g=[]);var D=Fb(x),I=D===((Y=x.ownerDocument)==null?void 0:Y.body),o=dl(D),st=I?[o].concat(o.visualViewport||[],Xo(D)?D:[]):D,Ct=g.concat(st);return I?Ct:Ct.concat(Xc(lc(st)))}function Er(x){return Object.assign({},x,{left:x.x,top:x.y,right:x.x+x.width,bottom:x.y+x.height})}function Bu(x,g){var Y=Sn(x,!1,g==="fixed");return Y.top=Y.top+x.clientTop,Y.left=Y.left+x.clientLeft,Y.bottom=Y.top+x.clientHeight,Y.right=Y.left+x.clientWidth,Y.width=x.clientWidth,Y.height=x.clientHeight,Y.x=Y.left,Y.y=Y.top,Y}function TZ(x,g,Y){return g===Ps?Er(h1(x,Y)):Bn(g)?Bu(g,Y):Er(Z1(Ga(x)))}function Su(x){var g=Xc(lc(x)),Y=["absolute","fixed"].indexOf(wa(x).position)>=0,D=Y&&Ol(x)?Wd(x):x;return Bn(D)?g.filter(function(I){return Bn(I)&&$s(I,D)&&oa(I)!=="body"}):[]}function p1(x,g,Y,D){var I=g==="clippingParents"?Su(x):[].concat(g),o=[].concat(I,[Y]),st=o[0],Ct=o.reduce(function(vt,de){var ee=TZ(x,de,D);return vt.top=md(ee.top,vt.top),vt.right=Io(ee.right,vt.right),vt.bottom=Io(ee.bottom,vt.bottom),vt.left=md(ee.left,vt.left),vt},TZ(x,st,D));return Ct.width=Ct.right-Ct.left,Ct.height=Ct.bottom-Ct.top,Ct.x=Ct.left,Ct.y=Ct.top,Ct}function l0(x){var g=x.reference,Y=x.element,D=x.placement,I=D?ra(D):null,o=D?Cn(D):null,st=g.x+g.width/2-Y.width/2,Ct=g.y+g.height/2-Y.height/2,vt;switch(I){case Wl:vt={x:st,y:g.y-Y.height};break;case Ll:vt={x:st,y:g.y+g.height};break;case Ml:vt={x:g.x+g.width,y:Ct};break;case Rl:vt={x:g.x-Y.width,y:Ct};break;default:vt={x:g.x,y:g.y}}var de=I?Mo(I):null;if(de!=null){var ee=de==="y"?"height":"width";switch(o){case Jd:vt[de]=vt[de]-(g[ee]/2-Y[ee]/2);break;case Tc:vt[de]=vt[de]+(g[ee]/2-Y[ee]/2);break;default:}}return vt}function va(x,g){g===void 0&&(g={});var Y=g,D=Y.placement,I=D===void 0?x.placement:D,o=Y.strategy,st=o===void 0?x.strategy:o,Ct=Y.boundary,vt=Ct===void 0?s1:Ct,de=Y.rootBoundary,ee=de===void 0?Ps:de,ge=Y.elementContext,ye=ge===void 0?No:ge,jt=Y.altBoundary,gt=jt===void 0?!1:jt,Ie=Y.padding,te=Ie===void 0?0:Ie,Ue=e0(typeof te!="number"?te:i0(te,ec)),di=ye===No?b1:No,li=x.rects.popper,ze=x.elements[gt?di:ye],je=p1(Bn(ze)?ze:ze.contextElement||Ga(x.elements.popper),vt,ee,st),B=Sn(x.elements.reference),ii=l0({reference:B,element:li,strategy:"absolute",placement:I}),Me=Er(Object.assign({},li,ii)),ui=ye===No?Me:B,ri={top:je.top-ui.top+Ue.top,bottom:ui.bottom-je.bottom+Ue.bottom,left:je.left-ui.left+Ue.left,right:ui.right-je.right+Ue.right},xi=x.modifiersData.offset;if(ye===No&&xi){var Qe=xi[I];Object.keys(ri).forEach(function(Ui){var sa=[Ml,Ll].indexOf(Ui)>=0?1:-1,cl=[Wl,Ll].indexOf(Ui)>=0?"y":"x";ri[Ui]+=Qe[cl]*sa})}return ri}function V1(x,g){g===void 0&&(g={});var Y=g,D=Y.placement,I=Y.boundary,o=Y.rootBoundary,st=Y.padding,Ct=Y.flipVariations,vt=Y.allowedAutoPlacements,de=vt===void 0?Ks:vt,ee=Cn(D),ge=ee?Ct?Vb:Vb.filter(function(gt){return Cn(gt)===ee}):ec,ye=ge.filter(function(gt){return de.indexOf(gt)>=0});ye.length===0&&(ye=ge);var jt=ye.reduce(function(gt,Ie){return gt[Ie]=va(x,{placement:Ie,boundary:I,rootBoundary:o,padding:st})[ra(Ie)],gt},{});return Object.keys(jt).sort(function(gt,Ie){return jt[gt]-jt[Ie]})}function Cu(x){if(ra(x)===_s)return[];var g=Lr(x);return[Rb(x),g,Rb(g)]}function ku(x){var g=x.state,Y=x.options,D=x.name;if(!g.modifiersData[D]._skip){for(var I=Y.mainAxis,o=I===void 0?!0:I,st=Y.altAxis,Ct=st===void 0?!0:st,vt=Y.fallbackPlacements,de=Y.padding,ee=Y.boundary,ge=Y.rootBoundary,ye=Y.altBoundary,jt=Y.flipVariations,gt=jt===void 0?!0:jt,Ie=Y.allowedAutoPlacements,te=g.options.placement,Ue=ra(te),di=Ue===te,li=vt||(di||!gt?[Lr(te)]:Cu(te)),ze=[te].concat(li).reduce(function(Ci,qi){return Ci.concat(ra(qi)===_s?V1(g,{placement:qi,boundary:ee,rootBoundary:ge,padding:de,flipVariations:gt,allowedAutoPlacements:Ie}):qi)},[]),je=g.rects.reference,B=g.rects.popper,ii=new Map,Me=!0,ui=ze[0],ri=0;ri<ze.length;ri++){var xi=ze[ri],Qe=ra(xi),Ui=Cn(xi)===Jd,sa=[Wl,Ll].indexOf(Qe)>=0,cl=sa?"width":"height",Ri=va(g,{placement:xi,boundary:ee,rootBoundary:ge,altBoundary:ye,padding:de}),Le=sa?Ui?Ml:Rl:Ui?Ll:Wl;je[cl]>B[cl]&&(Le=Lr(Le));var Yl=Lr(Le),ol=[];if(o&&ol.push(Ri[Qe]<=0),Ct&&ol.push(Ri[Le]<=0,Ri[Yl]<=0),ol.every(function(Ci){return Ci})){ui=xi,Me=!1;break}ii.set(xi,ol)}if(Me)for(var ba=gt?3:1,dn=function(qi){var ki=ze.find(function(Sa){var Fl=ii.get(Sa);if(Fl)return Fl.slice(0,qi).every(function($i){return $i})});if(ki)return ui=ki,"break"},xl=ba;xl>0;xl--){var _l=dn(xl);if(_l==="break")break}g.placement!==ui&&(g.modifiersData[D]._skip=!0,g.placement=ui,g.reset=!0)}}var Gb={name:"flip",enabled:!0,phase:"main",fn:ku,requiresIfExists:["offset"],data:{_skip:!1}};function XZ(x,g,Y){return Y===void 0&&(Y={x:0,y:0}),{top:x.top-g.height-Y.y,right:x.right-g.width+Y.x,bottom:x.bottom-g.height+Y.y,left:x.left-g.width-Y.x}}function JZ(x){return[Wl,Ml,Ll,Rl].some(function(g){return x[g]>=0})}function Qu(x){var g=x.state,Y=x.name,D=g.rects.reference,I=g.rects.popper,o=g.modifiersData.preventOverflow,st=va(g,{elementContext:"reference"}),Ct=va(g,{altBoundary:!0}),vt=XZ(st,D),de=XZ(Ct,I,o),ee=JZ(vt),ge=JZ(de);g.modifiersData[Y]={referenceClippingOffsets:vt,popperEscapeOffsets:de,isReferenceHidden:ee,hasPopperEscaped:ge},g.attributes.popper=Object.assign({},g.attributes.popper,{"data-popper-reference-hidden":ee,"data-popper-escaped":ge})}var Nb={name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:Qu};function Lu(x,g,Y){var D=ra(x),I=[Rl,Wl].indexOf(D)>=0?-1:1,o=typeof Y=="function"?Y(Object.assign({},g,{placement:x})):Y,st=o[0],Ct=o[1];return st=st||0,Ct=(Ct||0)*I,[Rl,Ml].indexOf(D)>=0?{x:Ct,y:st}:{x:st,y:Ct}}function Eu(x){var g=x.state,Y=x.options,D=x.name,I=Y.offset,o=I===void 0?[0,0]:I,st=Ks.reduce(function(ee,ge){return ee[ge]=Lu(ge,g.rects,o),ee},{}),Ct=st[g.placement],vt=Ct.x,de=Ct.y;g.modifiersData.popperOffsets!=null&&(g.modifiersData.popperOffsets.x+=vt,g.modifiersData.popperOffsets.y+=de),g.modifiersData[D]=st}var Ib={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:Eu};function zu(x){var g=x.state,Y=x.name;g.modifiersData[Y]=l0({reference:g.rects.reference,element:g.rects.popper,strategy:"absolute",placement:g.placement})}var zr={name:"popperOffsets",enabled:!0,phase:"read",fn:zu,data:{}};function g1(x){return x==="x"?"y":"x"}function ju(x){var g=x.state,Y=x.options,D=x.name,I=Y.mainAxis,o=I===void 0?!0:I,st=Y.altAxis,Ct=st===void 0?!1:st,vt=Y.boundary,de=Y.rootBoundary,ee=Y.altBoundary,ge=Y.padding,ye=Y.tether,jt=ye===void 0?!0:ye,gt=Y.tetherOffset,Ie=gt===void 0?0:gt,te=va(g,{boundary:vt,rootBoundary:de,padding:ge,altBoundary:ee}),Ue=ra(g.placement),di=Cn(g.placement),li=!di,ze=Mo(Ue),je=g1(ze),B=g.modifiersData.popperOffsets,ii=g.rects.reference,Me=g.rects.popper,ui=typeof Ie=="function"?Ie(Object.assign({},g.rects,{placement:g.placement})):Ie,ri=typeof ui=="number"?{mainAxis:ui,altAxis:ui}:Object.assign({mainAxis:0,altAxis:0},ui),xi=g.modifiersData.offset?g.modifiersData.offset[g.placement]:null,Qe={x:0,y:0};if(B){if(o){var Ui,sa=ze==="y"?Wl:Rl,cl=ze==="y"?Ll:Ml,Ri=ze==="y"?"height":"width",Le=B[ze],Yl=Le+te[sa],ol=Le-te[cl],ba=jt?-Me[Ri]/2:0,dn=di===Jd?ii[Ri]:Me[Ri],xl=di===Jd?-Me[Ri]:-ii[Ri],_l=g.elements.arrow,Ci=jt&&_l?Uo(_l):{width:0,height:0},qi=g.modifiersData["arrow#persistent"]?g.modifiersData["arrow#persistent"].padding:t0(),ki=qi[sa],Sa=qi[cl],Fl=Yo(0,ii[Ri],Ci[Ri]),$i=li?ii[Ri]/2-ba-Fl-ki-ri.mainAxis:dn-Fl-ki-ri.mainAxis,Pl=li?-ii[Ri]/2+ba+Fl+Sa+ri.mainAxis:xl+Fl+Sa+ri.mainAxis,Kl=g.elements.arrow&&Wd(g.elements.arrow),ci=Kl?ze==="y"?Kl.clientTop||0:Kl.clientLeft||0:0,El=(Ui=xi?.[ze])!=null?Ui:0,Na=Le+$i-El-ci,si=Le+Pl-El,Tl=Yo(jt?Io(Yl,Na):Yl,Le,jt?md(ol,si):ol);B[ze]=Tl,Qe[ze]=Tl-Le}if(Ct){var wi,Rn=ze==="x"?Wl:Rl,Ha=ze==="x"?Ll:Ml,hl=B[je],Qi=je==="y"?"height":"width",ql=hl+te[Rn],vi=hl-te[Ha],We=[Wl,Rl].indexOf(Ue)!==-1,Hi=(wi=xi?.[je])!=null?wi:0,Da=We?ql:hl-ii[Qi]-Me[Qi]-Hi+ri.altAxis,cn=We?hl+ii[Qi]+Me[Qi]-Hi-ri.altAxis:vi,Ca=jt&&We?YZ(Da,hl,cn):Yo(jt?Da:ql,hl,jt?cn:vi);B[je]=Ca,Qe[je]=Ca-hl}g.modifiersData[D]=Qe}}var Ub={name:"preventOverflow",enabled:!0,phase:"main",fn:ju,requiresIfExists:["offset"]};function u1(x){return{scrollLeft:x.scrollLeft,scrollTop:x.scrollTop}}function R1(x){return x===dl(x)||!Ol(x)?xo(x):u1(x)}function Au(x){var g=x.getBoundingClientRect(),Y=ic(g.width)/x.offsetWidth||1,D=ic(g.height)/x.offsetHeight||1;return Y!==1||D!==1}function F1(x,g,Y){Y===void 0&&(Y=!1);var D=Ol(g),I=Ol(g)&&Au(g),o=Ga(g),st=Sn(x,I,Y),Ct={scrollLeft:0,scrollTop:0},vt={x:0,y:0};return(D||!D&&!Y)&&((oa(g)!=="body"||Xo(o))&&(Ct=R1(g)),Ol(g)?(vt=Sn(g,!0),vt.x+=g.clientLeft,vt.y+=g.clientTop):o&&(vt.x=To(o))),{x:st.left+Ct.scrollLeft-vt.x,y:st.top+Ct.scrollTop-vt.y,width:st.width,height:st.height}}function wu(x){var g=new Map,Y=new Set,D=[];x.forEach(function(o){g.set(o.name,o)});function I(o){Y.add(o.name);var st=[].concat(o.requires||[],o.requiresIfExists||[]);st.forEach(function(Ct){if(!Y.has(Ct)){var vt=g.get(Ct);vt&&I(vt)}}),D.push(o)}return x.forEach(function(o){Y.has(o.name)||I(o)}),D}function G1(x){var g=wu(x);return m1.reduce(function(Y,D){return Y.concat(g.filter(function(I){return I.phase===D}))},[])}function N1(x){var g;return function(){return g||(g=new Promise(function(Y){Promise.resolve().then(function(){g=void 0,Y(x())})})),g}}function I1(x){var g=x.reduce(function(Y,D){var I=Y[D.name];return Y[D.name]=I?Object.assign({},I,D,{options:Object.assign({},I.options,D.options),data:Object.assign({},I.data,D.data)}):D,Y},{});return Object.keys(g).map(function(Y){return g[Y]})}var yZ={placement:"bottom",modifiers:[],strategy:"absolute"};function BZ(){for(var x=arguments.length,g=new Array(x),Y=0;Y<x;Y++)g[Y]=arguments[Y];return!g.some(function(D){return!(D&&typeof D.getBoundingClientRect=="function")})}function Jo(x){x===void 0&&(x={});var g=x,Y=g.defaultModifiers,D=Y===void 0?[]:Y,I=g.defaultOptions,o=I===void 0?yZ:I;return function(Ct,vt,de){de===void 0&&(de=o);var ee={placement:"bottom",orderedModifiers:[],options:Object.assign({},yZ,o),modifiersData:{},elements:{reference:Ct,popper:vt},attributes:{},styles:{}},ge=[],ye=!1,jt={state:ee,setOptions:function(Ue){var di=typeof Ue=="function"?Ue(ee.options):Ue;Ie(),ee.options=Object.assign({},o,ee.options,di),ee.scrollParents={reference:Bn(Ct)?Xc(Ct):Ct.contextElement?Xc(Ct.contextElement):[],popper:Xc(vt)};var li=G1(I1([].concat(D,ee.options.modifiers)));return ee.orderedModifiers=li.filter(function(ze){return ze.enabled}),gt(),jt.update()},forceUpdate:function(){if(!ye){var Ue=ee.elements,di=Ue.reference,li=Ue.popper;if(BZ(di,li)){ee.rects={reference:F1(di,Wd(li),ee.options.strategy==="fixed"),popper:Uo(li)},ee.reset=!1,ee.placement=ee.options.placement,ee.orderedModifiers.forEach(function(ri){return ee.modifiersData[ri.name]=Object.assign({},ri.data)});for(var ze=0;ze<ee.orderedModifiers.length;ze++){if(ee.reset===!0){ee.reset=!1,ze=-1;continue}var je=ee.orderedModifiers[ze],B=je.fn,ii=je.options,Me=ii===void 0?{}:ii,ui=je.name;typeof B=="function"&&(ee=B({state:ee,options:Me,name:ui,instance:jt})||ee)}}}},update:N1(function(){return new Promise(function(te){jt.forceUpdate(),te(ee)})}),destroy:function(){Ie(),ye=!0}};if(!BZ(Ct,vt))return jt;jt.setOptions(de).then(function(te){!ye&&de.onFirstUpdate&&de.onFirstUpdate(te)});function gt(){ee.orderedModifiers.forEach(function(te){var Ue=te.name,di=te.options,li=di===void 0?{}:di,ze=te.effect;if(typeof ze=="function"){var je=ze({state:ee,name:Ue,instance:jt,options:li}),B=function(){};ge.push(je||B)}})}function Ie(){ge.forEach(function(te){return te()}),ge=[]}return jt}}var SZ=Jo();var vu=[Qr,zr,kr,Sr],CZ=Jo({defaultModifiers:vu});var Hu=[Qr,zr,kr,Sr,Ib,Gb,Ub,gb,Nb],a0=Jo({defaultModifiers:Hu});var Jc=new Map,U1={set(x,g,Y){Jc.has(x)||Jc.set(x,new Map);let D=Jc.get(x);if(!D.has(g)&&D.size!==0){console.error(`Bootstrap doesn't allow more than one instance per element. Bound instance: ${Array.from(D.keys())[0]}.`);return}D.set(g,Y)},get(x,g){return Jc.has(x)&&Jc.get(x).get(g)||null},remove(x,g){if(!Jc.has(x))return;let Y=Jc.get(x);Y.delete(g),Y.size===0&&Jc.delete(x)}},Du=1e6,fu=1e3,j1="transitionend",sp=x=>(x&&window.CSS&&window.CSS.escape&&(x=x.replace(/#([^\s"#']+)/g,(g,Y)=>`#${CSS.escape(Y)}`)),x),Ou=x=>x==null?`${x}`:Object.prototype.toString.call(x).match(/\s([a-z]+)/i)[1].toLowerCase(),_u=x=>{do x+=Math.floor(Math.random()*Du);while(document.getElementById(x));return x},Pu=x=>{if(!x)return 0;let{transitionDuration:g,transitionDelay:Y}=window.getComputedStyle(x),D=Number.parseFloat(g),I=Number.parseFloat(Y);return!D&&!I?0:(g=g.split(",")[0],Y=Y.split(",")[0],(Number.parseFloat(g)+Number.parseFloat(Y))*fu)},bp=x=>{x.dispatchEvent(new Event(j1))},ac=x=>!x||typeof x!="object"?!1:(typeof x.jquery<"u"&&(x=x[0]),typeof x.nodeType<"u"),yc=x=>ac(x)?x.jquery?x[0]:x:typeof x=="string"&&x.length>0?document.querySelector(sp(x)):null,Or=x=>{if(!ac(x)||x.getClientRects().length===0)return!1;let g=getComputedStyle(x).getPropertyValue("visibility")==="visible",Y=x.closest("details:not([open])");if(!Y)return g;if(Y!==x){let D=x.closest("summary");if(D&&D.parentNode!==Y||D===null)return!1}return g},Bc=x=>!x||x.nodeType!==Node.ELEMENT_NODE||x.classList.contains("disabled")?!0:typeof x.disabled<"u"?x.disabled:x.hasAttribute("disabled")&&x.getAttribute("disabled")!=="false",mp=x=>{if(!document.documentElement.attachShadow)return null;if(typeof x.getRootNode=="function"){let g=x.getRootNode();return g instanceof ShadowRoot?g:null}return x instanceof ShadowRoot?x:x.parentNode?mp(x.parentNode):null},Cb=()=>{},s0=x=>{x.offsetHeight},Wp=()=>window.jQuery&&!document.body.hasAttribute("data-bs-no-jquery")?window.jQuery:null,M1=[],Ku=x=>{document.readyState==="loading"?(M1.length||document.addEventListener("DOMContentLoaded",()=>{for(let g of M1)g()}),M1.push(x)):x()},kn=()=>document.documentElement.dir==="rtl",Ln=x=>{Ku(()=>{let g=Wp();if(g){let Y=x.NAME,D=g.fn[Y];g.fn[Y]=x.jQueryInterface,g.fn[Y].Constructor=x,g.fn[Y].noConflict=()=>(g.fn[Y]=D,x.jQueryInterface)}})},nn=(x,g=[],Y=x)=>typeof x=="function"?x.call(...g):Y,hp=(x,g,Y=!0)=>{if(!Y){nn(x);return}let I=Pu(g)+5,o=!1,st=({target:Ct})=>{Ct===g&&(o=!0,g.removeEventListener(j1,st),nn(x))};g.addEventListener(j1,st),setTimeout(()=>{o||bp(g)},I)},D1=(x,g,Y,D)=>{let I=x.length,o=x.indexOf(g);return o===-1?!Y&&D?x[I-1]:x[0]:(o+=Y?1:-1,D&&(o=(o+I)%I),x[Math.max(0,Math.min(o,I-1))])},qu=/[^.]*(?=\..*)\.|.*/,$u=/\..*/,tR=/::\d+$/,Y1={},kZ=1,Zp={mouseenter:"mouseover",mouseleave:"mouseout"},eR=new Set(["click","dblclick","mouseup","mousedown","contextmenu","mousewheel","DOMMouseScroll","mouseover","mouseout","mousemove","selectstart","selectend","keydown","keypress","keyup","orientationchange","touchstart","touchmove","touchend","touchcancel","pointerdown","pointermove","pointerup","pointerleave","pointercancel","gesturestart","gesturechange","gestureend","focus","blur","change","reset","select","submit","focusin","focusout","load","unload","beforeunload","resize","move","DOMContentLoaded","readystatechange","error","abort","scroll"]);function pp(x,g){return g&&`${g}::${kZ++}`||x.uidEvent||kZ++}function Vp(x){let g=pp(x);return x.uidEvent=g,Y1[g]=Y1[g]||{},Y1[g]}function iR(x,g){return function Y(D){return f1(D,{delegateTarget:x}),Y.oneOff&&ie.off(x,D.type,g),g.apply(x,[D])}}function lR(x,g,Y){return function D(I){let o=x.querySelectorAll(g);for(let{target:st}=I;st&&st!==this;st=st.parentNode)for(let Ct of o)if(Ct===st)return f1(I,{delegateTarget:st}),D.oneOff&&ie.off(x,I.type,g,Y),Y.apply(st,[I])}}function gp(x,g,Y=null){return Object.values(x).find(D=>D.callable===g&&D.delegationSelector===Y)}function up(x,g,Y){let D=typeof g=="string",I=D?Y:g||Y,o=Rp(x);return eR.has(o)||(o=x),[D,I,o]}function QZ(x,g,Y,D,I){if(typeof g!="string"||!x)return;let[o,st,Ct]=up(g,Y,D);g in Zp&&(st=(gt=>function(Ie){if(!Ie.relatedTarget||Ie.relatedTarget!==Ie.delegateTarget&&!Ie.delegateTarget.contains(Ie.relatedTarget))return gt.call(this,Ie)})(st));let vt=Vp(x),de=vt[Ct]||(vt[Ct]={}),ee=gp(de,st,o?Y:null);if(ee){ee.oneOff=ee.oneOff&&I;return}let ge=pp(st,g.replace(qu,"")),ye=o?lR(x,Y,st):iR(x,st);ye.delegationSelector=o?Y:null,ye.callable=st,ye.oneOff=I,ye.uidEvent=ge,de[ge]=ye,x.addEventListener(Ct,ye,o)}function A1(x,g,Y,D,I){let o=gp(g[Y],D,I);o&&(x.removeEventListener(Y,o,!!I),delete g[Y][o.uidEvent])}function aR(x,g,Y,D){let I=g[Y]||{};for(let[o,st]of Object.entries(I))o.includes(D)&&A1(x,g,Y,st.callable,st.delegationSelector)}function Rp(x){return x=x.replace($u,""),Zp[x]||x}var ie={on(x,g,Y,D){QZ(x,g,Y,D,!1)},one(x,g,Y,D){QZ(x,g,Y,D,!0)},off(x,g,Y,D){if(typeof g!="string"||!x)return;let[I,o,st]=up(g,Y,D),Ct=st!==g,vt=Vp(x),de=vt[st]||{},ee=g.startsWith(".");if(typeof o<"u"){if(!Object.keys(de).length)return;A1(x,vt,st,o,I?Y:null);return}if(ee)for(let ge of Object.keys(vt))aR(x,vt,ge,g.slice(1));for(let[ge,ye]of Object.entries(de)){let jt=ge.replace(tR,"");(!Ct||g.includes(jt))&&A1(x,vt,st,ye.callable,ye.delegationSelector)}},trigger(x,g,Y){if(typeof g!="string"||!x)return null;let D=Wp(),I=Rp(g),o=g!==I,st=null,Ct=!0,vt=!0,de=!1;o&&D&&(st=D.Event(g,Y),D(x).trigger(st),Ct=!st.isPropagationStopped(),vt=!st.isImmediatePropagationStopped(),de=st.isDefaultPrevented());let ee=f1(new Event(g,{bubbles:Ct,cancelable:!0}),Y);return de&&ee.preventDefault(),vt&&x.dispatchEvent(ee),ee.defaultPrevented&&st&&st.preventDefault(),ee}};function f1(x,g={}){for(let[Y,D]of Object.entries(g))try{x[Y]=D}catch{Object.defineProperty(x,Y,{configurable:!0,get(){return D}})}return x}function LZ(x){if(x==="true")return!0;if(x==="false")return!1;if(x===Number(x).toString())return Number(x);if(x===""||x==="null")return null;if(typeof x!="string")return x;try{return JSON.parse(decodeURIComponent(x))}catch{return x}}function x1(x){return x.replace(/[A-Z]/g,g=>`-${g.toLowerCase()}`)}var nc={setDataAttribute(x,g,Y){x.setAttribute(`data-bs-${x1(g)}`,Y)},removeDataAttribute(x,g){x.removeAttribute(`data-bs-${x1(g)}`)},getDataAttributes(x){if(!x)return{};let g={},Y=Object.keys(x.dataset).filter(D=>D.startsWith("bs")&&!D.startsWith("bsConfig"));for(let D of Y){let I=D.replace(/^bs/,"");I=I.charAt(0).toLowerCase()+I.slice(1),g[I]=LZ(x.dataset[D])}return g},getDataAttribute(x,g){return LZ(x.getAttribute(`data-bs-${x1(g)}`))}},So=class{static get Default(){return{}}static get DefaultType(){return{}}static get NAME(){throw new Error('You have to implement the static method "NAME", for each component!')}_getConfig(g){return g=this._mergeConfigObj(g),g=this._configAfterMerge(g),this._typeCheckConfig(g),g}_configAfterMerge(g){return g}_mergeConfigObj(g,Y){let D=ac(Y)?nc.getDataAttribute(Y,"config"):{};return{...this.constructor.Default,...typeof D=="object"?D:{},...ac(Y)?nc.getDataAttributes(Y):{},...typeof g=="object"?g:{}}}_typeCheckConfig(g,Y=this.constructor.DefaultType){for(let[D,I]of Object.entries(Y)){let o=g[D],st=ac(o)?"element":Ou(o);if(!new RegExp(I).test(st))throw new TypeError(`${this.constructor.NAME.toUpperCase()}: Option "${D}" provided type "${st}" but expected type "${I}".`)}}},nR="5.3.8",un=class extends So{constructor(g,Y){super(),g=yc(g),g&&(this._element=g,this._config=this._getConfig(Y),U1.set(this._element,this.constructor.DATA_KEY,this))}dispose(){U1.remove(this._element,this.constructor.DATA_KEY),ie.off(this._element,this.constructor.EVENT_KEY);for(let g of Object.getOwnPropertyNames(this))this[g]=null}_queueCallback(g,Y,D=!0){hp(g,Y,D)}_getConfig(g){return g=this._mergeConfigObj(g,this._element),g=this._configAfterMerge(g),this._typeCheckConfig(g),g}static getInstance(g){return U1.get(yc(g),this.DATA_KEY)}static getOrCreateInstance(g,Y={}){return this.getInstance(g)||new this(g,typeof Y=="object"?Y:null)}static get VERSION(){return nR}static get DATA_KEY(){return`bs.${this.NAME}`}static get EVENT_KEY(){return`.${this.DATA_KEY}`}static eventName(g){return`${g}${this.EVENT_KEY}`}},T1=x=>{let g=x.getAttribute("data-bs-target");if(!g||g==="#"){let Y=x.getAttribute("href");if(!Y||!Y.includes("#")&&!Y.startsWith("."))return null;Y.includes("#")&&!Y.startsWith("#")&&(Y=`#${Y.split("#")[1]}`),g=Y&&Y!=="#"?Y.trim():null}return g?g.split(",").map(Y=>sp(Y)).join(","):null},Te={find(x,g=document.documentElement){return[].concat(...Element.prototype.querySelectorAll.call(g,x))},findOne(x,g=document.documentElement){return Element.prototype.querySelector.call(g,x)},children(x,g){return[].concat(...x.children).filter(Y=>Y.matches(g))},parents(x,g){let Y=[],D=x.parentNode.closest(g);for(;D;)Y.push(D),D=D.parentNode.closest(g);return Y},prev(x,g){let Y=x.previousElementSibling;for(;Y;){if(Y.matches(g))return[Y];Y=Y.previousElementSibling}return[]},next(x,g){let Y=x.nextElementSibling;for(;Y;){if(Y.matches(g))return[Y];Y=Y.nextElementSibling}return[]},focusableChildren(x){let g=["a","button","input","textarea","select","details","[tabindex]",'[contenteditable="true"]'].map(Y=>`${Y}:not([tabindex^="-"])`).join(",");return this.find(g,x).filter(Y=>!Bc(Y)&&Or(Y))},getSelectorFromElement(x){let g=T1(x);return g&&Te.findOne(g)?g:null},getElementFromSelector(x){let g=T1(x);return g?Te.findOne(g):null},getMultipleElementsFromSelector(x){let g=T1(x);return g?Te.find(g):[]}},Hb=(x,g="hide")=>{let Y=`click.dismiss${x.EVENT_KEY}`,D=x.NAME;ie.on(document,Y,`[data-bs-dismiss="${D}"]`,function(I){if(["A","AREA"].includes(this.tagName)&&I.preventDefault(),Bc(this))return;let o=Te.getElementFromSelector(this)||this.closest(`.${D}`);x.getOrCreateInstance(o)[g]()})},dR="alert",cR="bs.alert",Fp=`.${cR}`,oR=`close${Fp}`,rR=`closed${Fp}`,sR="fade",bR="show",kb=class x extends un{static get NAME(){return dR}close(){if(ie.trigger(this._element,oR).defaultPrevented)return;this._element.classList.remove(bR);let Y=this._element.classList.contains(sR);this._queueCallback(()=>this._destroyElement(),this._element,Y)}_destroyElement(){this._element.remove(),ie.trigger(this._element,rR),this.dispose()}static jQueryInterface(g){return this.each(function(){let Y=x.getOrCreateInstance(this);if(typeof g=="string"){if(Y[g]===void 0||g.startsWith("_")||g==="constructor")throw new TypeError(`No method named "${g}"`);Y[g](this)}})}};Hb(kb,"close");Ln(kb);var mR="button",WR="bs.button",hR=`.${WR}`,ZR=".data-api",pR="active",EZ='[data-bs-toggle="button"]',VR=`click${hR}${ZR}`,Qb=class x extends un{static get NAME(){return mR}toggle(){this._element.setAttribute("aria-pressed",this._element.classList.toggle(pR))}static jQueryInterface(g){return this.each(function(){let Y=x.getOrCreateInstance(this);g==="toggle"&&Y[g]()})}};ie.on(document,VR,EZ,x=>{x.preventDefault();let g=x.target.closest(EZ);Qb.getOrCreateInstance(g).toggle()});Ln(Qb);var gR="swipe",_r=".bs.swipe",uR=`touchstart${_r}`,RR=`touchmove${_r}`,FR=`touchend${_r}`,GR=`pointerdown${_r}`,NR=`pointerup${_r}`,IR="touch",UR="pen",MR="pointer-event",YR=40,xR={endCallback:null,leftCallback:null,rightCallback:null},TR={endCallback:"(function|null)",leftCallback:"(function|null)",rightCallback:"(function|null)"},Lb=class x extends So{constructor(g,Y){super(),this._element=g,!(!g||!x.isSupported())&&(this._config=this._getConfig(Y),this._deltaX=0,this._supportPointerEvents=!!window.PointerEvent,this._initEvents())}static get Default(){return xR}static get DefaultType(){return TR}static get NAME(){return gR}dispose(){ie.off(this._element,_r)}_start(g){if(!this._supportPointerEvents){this._deltaX=g.touches[0].clientX;return}this._eventIsPointerPenTouch(g)&&(this._deltaX=g.clientX)}_end(g){this._eventIsPointerPenTouch(g)&&(this._deltaX=g.clientX-this._deltaX),this._handleSwipe(),nn(this._config.endCallback)}_move(g){this._deltaX=g.touches&&g.touches.length>1?0:g.touches[0].clientX-this._deltaX}_handleSwipe(){let g=Math.abs(this._deltaX);if(g<=YR)return;let Y=g/this._deltaX;this._deltaX=0,Y&&nn(Y>0?this._config.rightCallback:this._config.leftCallback)}_initEvents(){this._supportPointerEvents?(ie.on(this._element,GR,g=>this._start(g)),ie.on(this._element,NR,g=>this._end(g)),this._element.classList.add(MR)):(ie.on(this._element,uR,g=>this._start(g)),ie.on(this._element,RR,g=>this._move(g)),ie.on(this._element,FR,g=>this._end(g)))}_eventIsPointerPenTouch(g){return this._supportPointerEvents&&(g.pointerType===UR||g.pointerType===IR)}static isSupported(){return"ontouchstart"in document.documentElement||navigator.maxTouchPoints>0}},XR="carousel",JR="bs.carousel",kc=`.${JR}`,Gp=".data-api",yR="ArrowLeft",BR="ArrowRight",SR=500,n0="next",jr="prev",wr="left",Bb="right",CR=`slide${kc}`,X1=`slid${kc}`,kR=`keydown${kc}`,QR=`mouseenter${kc}`,LR=`mouseleave${kc}`,ER=`dragstart${kc}`,zR=`load${kc}${Gp}`,jR=`click${kc}${Gp}`,Np="carousel",Yb="active",AR="slide",wR="carousel-item-end",vR="carousel-item-start",HR="carousel-item-next",DR="carousel-item-prev",Ip=".active",Up=".carousel-item",fR=Ip+Up,OR=".carousel-item img",_R=".carousel-indicators",PR="[data-bs-slide], [data-bs-slide-to]",KR='[data-bs-ride="carousel"]',qR={[yR]:Bb,[BR]:wr},$R={interval:5e3,keyboard:!0,pause:"hover",ride:!1,touch:!0,wrap:!0},tF={interval:"(number|boolean)",keyboard:"boolean",pause:"(string|boolean)",ride:"(boolean|string)",touch:"boolean",wrap:"boolean"},c0=class x extends un{constructor(g,Y){super(g,Y),this._interval=null,this._activeElement=null,this._isSliding=!1,this.touchTimeout=null,this._swipeHelper=null,this._indicatorsElement=Te.findOne(_R,this._element),this._addEventListeners(),this._config.ride===Np&&this.cycle()}static get Default(){return $R}static get DefaultType(){return tF}static get NAME(){return XR}next(){this._slide(n0)}nextWhenVisible(){!document.hidden&&Or(this._element)&&this.next()}prev(){this._slide(jr)}pause(){this._isSliding&&bp(this._element),this._clearInterval()}cycle(){this._clearInterval(),this._updateInterval(),this._interval=setInterval(()=>this.nextWhenVisible(),this._config.interval)}_maybeEnableCycle(){if(this._config.ride){if(this._isSliding){ie.one(this._element,X1,()=>this.cycle());return}this.cycle()}}to(g){let Y=this._getItems();if(g>Y.length-1||g<0)return;if(this._isSliding){ie.one(this._element,X1,()=>this.to(g));return}let D=this._getItemIndex(this._getActive());if(D===g)return;let I=g>D?n0:jr;this._slide(I,Y[g])}dispose(){this._swipeHelper&&this._swipeHelper.dispose(),super.dispose()}_configAfterMerge(g){return g.defaultInterval=g.interval,g}_addEventListeners(){this._config.keyboard&&ie.on(this._element,kR,g=>this._keydown(g)),this._config.pause==="hover"&&(ie.on(this._element,QR,()=>this.pause()),ie.on(this._element,LR,()=>this._maybeEnableCycle())),this._config.touch&&Lb.isSupported()&&this._addTouchEventListeners()}_addTouchEventListeners(){for(let D of Te.find(OR,this._element))ie.on(D,ER,I=>I.preventDefault());let Y={leftCallback:()=>this._slide(this._directionToOrder(wr)),rightCallback:()=>this._slide(this._directionToOrder(Bb)),endCallback:()=>{this._config.pause==="hover"&&(this.pause(),this.touchTimeout&&clearTimeout(this.touchTimeout),this.touchTimeout=setTimeout(()=>this._maybeEnableCycle(),SR+this._config.interval))}};this._swipeHelper=new Lb(this._element,Y)}_keydown(g){if(/input|textarea/i.test(g.target.tagName))return;let Y=qR[g.key];Y&&(g.preventDefault(),this._slide(this._directionToOrder(Y)))}_getItemIndex(g){return this._getItems().indexOf(g)}_setActiveIndicatorElement(g){if(!this._indicatorsElement)return;let Y=Te.findOne(Ip,this._indicatorsElement);Y.classList.remove(Yb),Y.removeAttribute("aria-current");let D=Te.findOne(`[data-bs-slide-to="${g}"]`,this._indicatorsElement);D&&(D.classList.add(Yb),D.setAttribute("aria-current","true"))}_updateInterval(){let g=this._activeElement||this._getActive();if(!g)return;let Y=Number.parseInt(g.getAttribute("data-bs-interval"),10);this._config.interval=Y||this._config.defaultInterval}_slide(g,Y=null){if(this._isSliding)return;let D=this._getActive(),I=g===n0,o=Y||D1(this._getItems(),D,I,this._config.wrap);if(o===D)return;let st=this._getItemIndex(o),Ct=jt=>ie.trigger(this._element,jt,{relatedTarget:o,direction:this._orderToDirection(g),from:this._getItemIndex(D),to:st});if(Ct(CR).defaultPrevented||!D||!o)return;let de=!!this._interval;this.pause(),this._isSliding=!0,this._setActiveIndicatorElement(st),this._activeElement=o;let ee=I?vR:wR,ge=I?HR:DR;o.classList.add(ge),s0(o),D.classList.add(ee),o.classList.add(ee);let ye=()=>{o.classList.remove(ee,ge),o.classList.add(Yb),D.classList.remove(Yb,ge,ee),this._isSliding=!1,Ct(X1)};this._queueCallback(ye,D,this._isAnimated()),de&&this.cycle()}_isAnimated(){return this._element.classList.contains(AR)}_getActive(){return Te.findOne(fR,this._element)}_getItems(){return Te.find(Up,this._element)}_clearInterval(){this._interval&&(clearInterval(this._interval),this._interval=null)}_directionToOrder(g){return kn()?g===wr?jr:n0:g===wr?n0:jr}_orderToDirection(g){return kn()?g===jr?wr:Bb:g===jr?Bb:wr}static jQueryInterface(g){return this.each(function(){let Y=x.getOrCreateInstance(this,g);if(typeof g=="number"){Y.to(g);return}if(typeof g=="string"){if(Y[g]===void 0||g.startsWith("_")||g==="constructor")throw new TypeError(`No method named "${g}"`);Y[g]()}})}};ie.on(document,jR,PR,function(x){let g=Te.getElementFromSelector(this);if(!g||!g.classList.contains(Np))return;x.preventDefault();let Y=c0.getOrCreateInstance(g),D=this.getAttribute("data-bs-slide-to");if(D){Y.to(D),Y._maybeEnableCycle();return}if(nc.getDataAttribute(this,"slide")==="next"){Y.next(),Y._maybeEnableCycle();return}Y.prev(),Y._maybeEnableCycle()});ie.on(window,zR,()=>{let x=Te.find(KR);for(let g of x)c0.getOrCreateInstance(g)});Ln(c0);var eF="collapse",iF="bs.collapse",b0=`.${iF}`,lF=".data-api",aF=`show${b0}`,nF=`shown${b0}`,dF=`hide${b0}`,cF=`hidden${b0}`,oF=`click${b0}${lF}`,J1="show",Hr="collapse",xb="collapsing",rF="collapsed",sF=`:scope .${Hr} .${Hr}`,bF="collapse-horizontal",mF="width",WF="height",hF=".collapse.show, .collapse.collapsing",w1='[data-bs-toggle="collapse"]',ZF={parent:null,toggle:!0},pF={parent:"(null|element)",toggle:"boolean"},Eb=class x extends un{constructor(g,Y){super(g,Y),this._isTransitioning=!1,this._triggerArray=[];let D=Te.find(w1);for(let I of D){let o=Te.getSelectorFromElement(I),st=Te.find(o).filter(Ct=>Ct===this._element);o!==null&&st.length&&this._triggerArray.push(I)}this._initializeChildren(),this._config.parent||this._addAriaAndCollapsedClass(this._triggerArray,this._isShown()),this._config.toggle&&this.toggle()}static get Default(){return ZF}static get DefaultType(){return pF}static get NAME(){return eF}toggle(){this._isShown()?this.hide():this.show()}show(){if(this._isTransitioning||this._isShown())return;let g=[];if(this._config.parent&&(g=this._getFirstLevelChildren(hF).filter(Ct=>Ct!==this._element).map(Ct=>x.getOrCreateInstance(Ct,{toggle:!1}))),g.length&&g[0]._isTransitioning||ie.trigger(this._element,aF).defaultPrevented)return;for(let Ct of g)Ct.hide();let D=this._getDimension();this._element.classList.remove(Hr),this._element.classList.add(xb),this._element.style[D]=0,this._addAriaAndCollapsedClass(this._triggerArray,!0),this._isTransitioning=!0;let I=()=>{this._isTransitioning=!1,this._element.classList.remove(xb),this._element.classList.add(Hr,J1),this._element.style[D]="",ie.trigger(this._element,nF)},st=`scroll${D[0].toUpperCase()+D.slice(1)}`;this._queueCallback(I,this._element,!0),this._element.style[D]=`${this._element[st]}px`}hide(){if(this._isTransitioning||!this._isShown()||ie.trigger(this._element,dF).defaultPrevented)return;let Y=this._getDimension();this._element.style[Y]=`${this._element.getBoundingClientRect()[Y]}px`,s0(this._element),this._element.classList.add(xb),this._element.classList.remove(Hr,J1);for(let I of this._triggerArray){let o=Te.getElementFromSelector(I);o&&!this._isShown(o)&&this._addAriaAndCollapsedClass([I],!1)}this._isTransitioning=!0;let D=()=>{this._isTransitioning=!1,this._element.classList.remove(xb),this._element.classList.add(Hr),ie.trigger(this._element,cF)};this._element.style[Y]="",this._queueCallback(D,this._element,!0)}_isShown(g=this._element){return g.classList.contains(J1)}_configAfterMerge(g){return g.toggle=!!g.toggle,g.parent=yc(g.parent),g}_getDimension(){return this._element.classList.contains(bF)?mF:WF}_initializeChildren(){if(!this._config.parent)return;let g=this._getFirstLevelChildren(w1);for(let Y of g){let D=Te.getElementFromSelector(Y);D&&this._addAriaAndCollapsedClass([Y],this._isShown(D))}}_getFirstLevelChildren(g){let Y=Te.find(sF,this._config.parent);return Te.find(g,this._config.parent).filter(D=>!Y.includes(D))}_addAriaAndCollapsedClass(g,Y){if(g.length)for(let D of g)D.classList.toggle(rF,!Y),D.setAttribute("aria-expanded",Y)}static jQueryInterface(g){let Y={};return typeof g=="string"&&/show|hide/.test(g)&&(Y.toggle=!1),this.each(function(){let D=x.getOrCreateInstance(this,Y);if(typeof g=="string"){if(typeof D[g]>"u")throw new TypeError(`No method named "${g}"`);D[g]()}})}};ie.on(document,oF,w1,function(x){(x.target.tagName==="A"||x.delegateTarget&&x.delegateTarget.tagName==="A")&&x.preventDefault();for(let g of Te.getMultipleElementsFromSelector(this))Eb.getOrCreateInstance(g,{toggle:!1}).toggle()});Ln(Eb);var zZ="dropdown",VF="bs.dropdown",Co=`.${VF}`,O1=".data-api",gF="Escape",jZ="Tab",uF="ArrowUp",AZ="ArrowDown",RF=2,FF=`hide${Co}`,GF=`hidden${Co}`,NF=`show${Co}`,IF=`shown${Co}`,Mp=`click${Co}${O1}`,Yp=`keydown${Co}${O1}`,UF=`keyup${Co}${O1}`,vr="show",MF="dropup",YF="dropend",xF="dropstart",TF="dropup-center",XF="dropdown-center",yo='[data-bs-toggle="dropdown"]:not(.disabled):not(:disabled)',JF=`${yo}.${vr}`,Sb=".dropdown-menu",yF=".navbar",BF=".navbar-nav",SF=".dropdown-menu .dropdown-item:not(.disabled):not(:disabled)",CF=kn()?"top-end":"top-start",kF=kn()?"top-start":"top-end",QF=kn()?"bottom-end":"bottom-start",LF=kn()?"bottom-start":"bottom-end",EF=kn()?"left-start":"right-start",zF=kn()?"right-start":"left-start",jF="top",AF="bottom",wF={autoClose:!0,boundary:"clippingParents",display:"dynamic",offset:[0,2],popperConfig:null,reference:"toggle"},vF={autoClose:"(boolean|string)",boundary:"(string|element)",display:"string",offset:"(array|string|function)",popperConfig:"(null|object|function)",reference:"(string|element|object)"},Sc=class x extends un{constructor(g,Y){super(g,Y),this._popper=null,this._parent=this._element.parentNode,this._menu=Te.next(this._element,Sb)[0]||Te.prev(this._element,Sb)[0]||Te.findOne(Sb,this._parent),this._inNavbar=this._detectNavbar()}static get Default(){return wF}static get DefaultType(){return vF}static get NAME(){return zZ}toggle(){return this._isShown()?this.hide():this.show()}show(){if(Bc(this._element)||this._isShown())return;let g={relatedTarget:this._element};if(!ie.trigger(this._element,NF,g).defaultPrevented){if(this._createPopper(),"ontouchstart"in document.documentElement&&!this._parent.closest(BF))for(let D of[].concat(...document.body.children))ie.on(D,"mouseover",Cb);this._element.focus(),this._element.setAttribute("aria-expanded",!0),this._menu.classList.add(vr),this._element.classList.add(vr),ie.trigger(this._element,IF,g)}}hide(){if(Bc(this._element)||!this._isShown())return;let g={relatedTarget:this._element};this._completeHide(g)}dispose(){this._popper&&this._popper.destroy(),super.dispose()}update(){this._inNavbar=this._detectNavbar(),this._popper&&this._popper.update()}_completeHide(g){if(!ie.trigger(this._element,FF,g).defaultPrevented){if("ontouchstart"in document.documentElement)for(let D of[].concat(...document.body.children))ie.off(D,"mouseover",Cb);this._popper&&this._popper.destroy(),this._menu.classList.remove(vr),this._element.classList.remove(vr),this._element.setAttribute("aria-expanded","false"),nc.removeDataAttribute(this._menu,"popper"),ie.trigger(this._element,GF,g)}}_getConfig(g){if(g=super._getConfig(g),typeof g.reference=="object"&&!ac(g.reference)&&typeof g.reference.getBoundingClientRect!="function")throw new TypeError(`${zZ.toUpperCase()}: Option "reference" provided type "object" without a required "getBoundingClientRect" method.`);return g}_createPopper(){if(typeof Mb>"u")throw new TypeError("Bootstrap's dropdowns require Popper (https://popper.js.org/docs/v2/)");let g=this._element;this._config.reference==="parent"?g=this._parent:ac(this._config.reference)?g=yc(this._config.reference):typeof this._config.reference=="object"&&(g=this._config.reference);let Y=this._getPopperConfig();this._popper=a0(g,this._menu,Y)}_isShown(){return this._menu.classList.contains(vr)}_getPlacement(){let g=this._parent;if(g.classList.contains(YF))return EF;if(g.classList.contains(xF))return zF;if(g.classList.contains(TF))return jF;if(g.classList.contains(XF))return AF;let Y=getComputedStyle(this._menu).getPropertyValue("--bs-position").trim()==="end";return g.classList.contains(MF)?Y?kF:CF:Y?LF:QF}_detectNavbar(){return this._element.closest(yF)!==null}_getOffset(){let{offset:g}=this._config;return typeof g=="string"?g.split(",").map(Y=>Number.parseInt(Y,10)):typeof g=="function"?Y=>g(Y,this._element):g}_getPopperConfig(){let g={placement:this._getPlacement(),modifiers:[{name:"preventOverflow",options:{boundary:this._config.boundary}},{name:"offset",options:{offset:this._getOffset()}}]};return(this._inNavbar||this._config.display==="static")&&(nc.setDataAttribute(this._menu,"popper","static"),g.modifiers=[{name:"applyStyles",enabled:!1}]),{...g,...nn(this._config.popperConfig,[void 0,g])}}_selectMenuItem({key:g,target:Y}){let D=Te.find(SF,this._menu).filter(I=>Or(I));D.length&&D1(D,Y,g===AZ,!D.includes(Y)).focus()}static jQueryInterface(g){return this.each(function(){let Y=x.getOrCreateInstance(this,g);if(typeof g=="string"){if(typeof Y[g]>"u")throw new TypeError(`No method named "${g}"`);Y[g]()}})}static clearMenus(g){if(g.button===RF||g.type==="keyup"&&g.key!==jZ)return;let Y=Te.find(JF);for(let D of Y){let I=x.getInstance(D);if(!I||I._config.autoClose===!1)continue;let o=g.composedPath(),st=o.includes(I._menu);if(o.includes(I._element)||I._config.autoClose==="inside"&&!st||I._config.autoClose==="outside"&&st||I._menu.contains(g.target)&&(g.type==="keyup"&&g.key===jZ||/input|select|option|textarea|form/i.test(g.target.tagName)))continue;let Ct={relatedTarget:I._element};g.type==="click"&&(Ct.clickEvent=g),I._completeHide(Ct)}}static dataApiKeydownHandler(g){let Y=/input|textarea/i.test(g.target.tagName),D=g.key===gF,I=[uF,AZ].includes(g.key);if(!I&&!D||Y&&!D)return;g.preventDefault();let o=this.matches(yo)?this:Te.prev(this,yo)[0]||Te.next(this,yo)[0]||Te.findOne(yo,g.delegateTarget.parentNode),st=x.getOrCreateInstance(o);if(I){g.stopPropagation(),st.show(),st._selectMenuItem(g);return}st._isShown()&&(g.stopPropagation(),st.hide(),o.focus())}};ie.on(document,Yp,yo,Sc.dataApiKeydownHandler);ie.on(document,Yp,Sb,Sc.dataApiKeydownHandler);ie.on(document,Mp,Sc.clearMenus);ie.on(document,UF,Sc.clearMenus);ie.on(document,Mp,yo,function(x){x.preventDefault(),Sc.getOrCreateInstance(this).toggle()});Ln(Sc);var xp="backdrop",HF="fade",wZ="show",vZ=`mousedown.bs.${xp}`,DF={className:"modal-backdrop",clickCallback:null,isAnimated:!1,isVisible:!0,rootElement:"body"},fF={className:"string",clickCallback:"(function|null)",isAnimated:"boolean",isVisible:"boolean",rootElement:"(element|string)"},zb=class extends So{constructor(g){super(),this._config=this._getConfig(g),this._isAppended=!1,this._element=null}static get Default(){return DF}static get DefaultType(){return fF}static get NAME(){return xp}show(g){if(!this._config.isVisible){nn(g);return}this._append();let Y=this._getElement();this._config.isAnimated&&s0(Y),Y.classList.add(wZ),this._emulateAnimation(()=>{nn(g)})}hide(g){if(!this._config.isVisible){nn(g);return}this._getElement().classList.remove(wZ),this._emulateAnimation(()=>{this.dispose(),nn(g)})}dispose(){this._isAppended&&(ie.off(this._element,vZ),this._element.remove(),this._isAppended=!1)}_getElement(){if(!this._element){let g=document.createElement("div");g.className=this._config.className,this._config.isAnimated&&g.classList.add(HF),this._element=g}return this._element}_configAfterMerge(g){return g.rootElement=yc(g.rootElement),g}_append(){if(this._isAppended)return;let g=this._getElement();this._config.rootElement.append(g),ie.on(g,vZ,()=>{nn(this._config.clickCallback)}),this._isAppended=!0}_emulateAnimation(g){hp(g,this._getElement(),this._config.isAnimated)}},OF="focustrap",_F="bs.focustrap",jb=`.${_F}`,PF=`focusin${jb}`,KF=`keydown.tab${jb}`,qF="Tab",$F="forward",HZ="backward",tG={autofocus:!0,trapElement:null},eG={autofocus:"boolean",trapElement:"element"},Ab=class extends So{constructor(g){super(),this._config=this._getConfig(g),this._isActive=!1,this._lastTabNavDirection=null}static get Default(){return tG}static get DefaultType(){return eG}static get NAME(){return OF}activate(){this._isActive||(this._config.autofocus&&this._config.trapElement.focus(),ie.off(document,jb),ie.on(document,PF,g=>this._handleFocusin(g)),ie.on(document,KF,g=>this._handleKeydown(g)),this._isActive=!0)}deactivate(){this._isActive&&(this._isActive=!1,ie.off(document,jb))}_handleFocusin(g){let{trapElement:Y}=this._config;if(g.target===document||g.target===Y||Y.contains(g.target))return;let D=Te.focusableChildren(Y);D.length===0?Y.focus():this._lastTabNavDirection===HZ?D[D.length-1].focus():D[0].focus()}_handleKeydown(g){g.key===qF&&(this._lastTabNavDirection=g.shiftKey?HZ:$F)}},DZ=".fixed-top, .fixed-bottom, .is-fixed, .sticky-top",fZ=".sticky-top",Tb="padding-right",OZ="margin-right",o0=class{constructor(){this._element=document.body}getWidth(){let g=document.documentElement.clientWidth;return Math.abs(window.innerWidth-g)}hide(){let g=this.getWidth();this._disableOverFlow(),this._setElementAttributes(this._element,Tb,Y=>Y+g),this._setElementAttributes(DZ,Tb,Y=>Y+g),this._setElementAttributes(fZ,OZ,Y=>Y-g)}reset(){this._resetElementAttributes(this._element,"overflow"),this._resetElementAttributes(this._element,Tb),this._resetElementAttributes(DZ,Tb),this._resetElementAttributes(fZ,OZ)}isOverflowing(){return this.getWidth()>0}_disableOverFlow(){this._saveInitialAttribute(this._element,"overflow"),this._element.style.overflow="hidden"}_setElementAttributes(g,Y,D){let I=this.getWidth(),o=st=>{if(st!==this._element&&window.innerWidth>st.clientWidth+I)return;this._saveInitialAttribute(st,Y);let Ct=window.getComputedStyle(st).getPropertyValue(Y);st.style.setProperty(Y,`${D(Number.parseFloat(Ct))}px`)};this._applyManipulationCallback(g,o)}_saveInitialAttribute(g,Y){let D=g.style.getPropertyValue(Y);D&&nc.setDataAttribute(g,Y,D)}_resetElementAttributes(g,Y){let D=I=>{let o=nc.getDataAttribute(I,Y);if(o===null){I.style.removeProperty(Y);return}nc.removeDataAttribute(I,Y),I.style.setProperty(Y,o)};this._applyManipulationCallback(g,D)}_applyManipulationCallback(g,Y){if(ac(g)){Y(g);return}for(let D of Te.find(g,this._element))Y(D)}},iG="modal",lG="bs.modal",Qn=`.${lG}`,aG=".data-api",nG="Escape",dG=`hide${Qn}`,cG=`hidePrevented${Qn}`,Tp=`hidden${Qn}`,Xp=`show${Qn}`,oG=`shown${Qn}`,rG=`resize${Qn}`,sG=`click.dismiss${Qn}`,bG=`mousedown.dismiss${Qn}`,mG=`keydown.dismiss${Qn}`,WG=`click${Qn}${aG}`,_Z="modal-open",hG="fade",PZ="show",y1="modal-static",ZG=".modal.show",pG=".modal-dialog",VG=".modal-body",gG='[data-bs-toggle="modal"]',uG={backdrop:!0,focus:!0,keyboard:!0},RG={backdrop:"(boolean|string)",focus:"boolean",keyboard:"boolean"},Dr=class x extends un{constructor(g,Y){super(g,Y),this._dialog=Te.findOne(pG,this._element),this._backdrop=this._initializeBackDrop(),this._focustrap=this._initializeFocusTrap(),this._isShown=!1,this._isTransitioning=!1,this._scrollBar=new o0,this._addEventListeners()}static get Default(){return uG}static get DefaultType(){return RG}static get NAME(){return iG}toggle(g){return this._isShown?this.hide():this.show(g)}show(g){this._isShown||this._isTransitioning||ie.trigger(this._element,Xp,{relatedTarget:g}).defaultPrevented||(this._isShown=!0,this._isTransitioning=!0,this._scrollBar.hide(),document.body.classList.add(_Z),this._adjustDialog(),this._backdrop.show(()=>this._showElement(g)))}hide(){!this._isShown||this._isTransitioning||ie.trigger(this._element,dG).defaultPrevented||(this._isShown=!1,this._isTransitioning=!0,this._focustrap.deactivate(),this._element.classList.remove(PZ),this._queueCallback(()=>this._hideModal(),this._element,this._isAnimated()))}dispose(){ie.off(window,Qn),ie.off(this._dialog,Qn),this._backdrop.dispose(),this._focustrap.deactivate(),super.dispose()}handleUpdate(){this._adjustDialog()}_initializeBackDrop(){return new zb({isVisible:!!this._config.backdrop,isAnimated:this._isAnimated()})}_initializeFocusTrap(){return new Ab({trapElement:this._element})}_showElement(g){document.body.contains(this._element)||document.body.append(this._element),this._element.style.display="block",this._element.removeAttribute("aria-hidden"),this._element.setAttribute("aria-modal",!0),this._element.setAttribute("role","dialog"),this._element.scrollTop=0;let Y=Te.findOne(VG,this._dialog);Y&&(Y.scrollTop=0),s0(this._element),this._element.classList.add(PZ);let D=()=>{this._config.focus&&this._focustrap.activate(),this._isTransitioning=!1,ie.trigger(this._element,oG,{relatedTarget:g})};this._queueCallback(D,this._dialog,this._isAnimated())}_addEventListeners(){ie.on(this._element,mG,g=>{if(g.key===nG){if(this._config.keyboard){this.hide();return}this._triggerBackdropTransition()}}),ie.on(window,rG,()=>{this._isShown&&!this._isTransitioning&&this._adjustDialog()}),ie.on(this._element,bG,g=>{ie.one(this._element,sG,Y=>{if(!(this._element!==g.target||this._element!==Y.target)){if(this._config.backdrop==="static"){this._triggerBackdropTransition();return}this._config.backdrop&&this.hide()}})})}_hideModal(){this._element.style.display="none",this._element.setAttribute("aria-hidden",!0),this._element.removeAttribute("aria-modal"),this._element.removeAttribute("role"),this._isTransitioning=!1,this._backdrop.hide(()=>{document.body.classList.remove(_Z),this._resetAdjustments(),this._scrollBar.reset(),ie.trigger(this._element,Tp)})}_isAnimated(){return this._element.classList.contains(hG)}_triggerBackdropTransition(){if(ie.trigger(this._element,cG).defaultPrevented)return;let Y=this._element.scrollHeight>document.documentElement.clientHeight,D=this._element.style.overflowY;D==="hidden"||this._element.classList.contains(y1)||(Y||(this._element.style.overflowY="hidden"),this._element.classList.add(y1),this._queueCallback(()=>{this._element.classList.remove(y1),this._queueCallback(()=>{this._element.style.overflowY=D},this._dialog)},this._dialog),this._element.focus())}_adjustDialog(){let g=this._element.scrollHeight>document.documentElement.clientHeight,Y=this._scrollBar.getWidth(),D=Y>0;if(D&&!g){let I=kn()?"paddingLeft":"paddingRight";this._element.style[I]=`${Y}px`}if(!D&&g){let I=kn()?"paddingRight":"paddingLeft";this._element.style[I]=`${Y}px`}}_resetAdjustments(){this._element.style.paddingLeft="",this._element.style.paddingRight=""}static jQueryInterface(g,Y){return this.each(function(){let D=x.getOrCreateInstance(this,g);if(typeof g=="string"){if(typeof D[g]>"u")throw new TypeError(`No method named "${g}"`);D[g](Y)}})}};ie.on(document,WG,gG,function(x){let g=Te.getElementFromSelector(this);["A","AREA"].includes(this.tagName)&&x.preventDefault(),ie.one(g,Xp,I=>{I.defaultPrevented||ie.one(g,Tp,()=>{Or(this)&&this.focus()})});let Y=Te.findOne(ZG);Y&&Dr.getInstance(Y).hide(),Dr.getOrCreateInstance(g).toggle(this)});Hb(Dr);Ln(Dr);var FG="offcanvas",GG="bs.offcanvas",dc=`.${GG}`,Jp=".data-api",NG=`load${dc}${Jp}`,IG="Escape",KZ="show",qZ="showing",$Z="hiding",UG="offcanvas-backdrop",yp=".offcanvas.show",MG=`show${dc}`,YG=`shown${dc}`,xG=`hide${dc}`,tp=`hidePrevented${dc}`,Bp=`hidden${dc}`,TG=`resize${dc}`,XG=`click${dc}${Jp}`,JG=`keydown.dismiss${dc}`,yG='[data-bs-toggle="offcanvas"]',BG={backdrop:!0,keyboard:!0,scroll:!1},SG={backdrop:"(boolean|string)",keyboard:"boolean",scroll:"boolean"},Cc=class x extends un{constructor(g,Y){super(g,Y),this._isShown=!1,this._backdrop=this._initializeBackDrop(),this._focustrap=this._initializeFocusTrap(),this._addEventListeners()}static get Default(){return BG}static get DefaultType(){return SG}static get NAME(){return FG}toggle(g){return this._isShown?this.hide():this.show(g)}show(g){if(this._isShown||ie.trigger(this._element,MG,{relatedTarget:g}).defaultPrevented)return;this._isShown=!0,this._backdrop.show(),this._config.scroll||new o0().hide(),this._element.setAttribute("aria-modal",!0),this._element.setAttribute("role","dialog"),this._element.classList.add(qZ);let D=()=>{(!this._config.scroll||this._config.backdrop)&&this._focustrap.activate(),this._element.classList.add(KZ),this._element.classList.remove(qZ),ie.trigger(this._element,YG,{relatedTarget:g})};this._queueCallback(D,this._element,!0)}hide(){if(!this._isShown||ie.trigger(this._element,xG).defaultPrevented)return;this._focustrap.deactivate(),this._element.blur(),this._isShown=!1,this._element.classList.add($Z),this._backdrop.hide();let Y=()=>{this._element.classList.remove(KZ,$Z),this._element.removeAttribute("aria-modal"),this._element.removeAttribute("role"),this._config.scroll||new o0().reset(),ie.trigger(this._element,Bp)};this._queueCallback(Y,this._element,!0)}dispose(){this._backdrop.dispose(),this._focustrap.deactivate(),super.dispose()}_initializeBackDrop(){let g=()=>{if(this._config.backdrop==="static"){ie.trigger(this._element,tp);return}this.hide()},Y=!!this._config.backdrop;return new zb({className:UG,isVisible:Y,isAnimated:!0,rootElement:this._element.parentNode,clickCallback:Y?g:null})}_initializeFocusTrap(){return new Ab({trapElement:this._element})}_addEventListeners(){ie.on(this._element,JG,g=>{if(g.key===IG){if(this._config.keyboard){this.hide();return}ie.trigger(this._element,tp)}})}static jQueryInterface(g){return this.each(function(){let Y=x.getOrCreateInstance(this,g);if(typeof g=="string"){if(Y[g]===void 0||g.startsWith("_")||g==="constructor")throw new TypeError(`No method named "${g}"`);Y[g](this)}})}};ie.on(document,XG,yG,function(x){let g=Te.getElementFromSelector(this);if(["A","AREA"].includes(this.tagName)&&x.preventDefault(),Bc(this))return;ie.one(g,Bp,()=>{Or(this)&&this.focus()});let Y=Te.findOne(yp);Y&&Y!==g&&Cc.getInstance(Y).hide(),Cc.getOrCreateInstance(g).toggle(this)});ie.on(window,NG,()=>{for(let x of Te.find(yp))Cc.getOrCreateInstance(x).show()});ie.on(window,TG,()=>{for(let x of Te.find("[aria-modal][class*=show][class*=offcanvas-]"))getComputedStyle(x).position!=="fixed"&&Cc.getOrCreateInstance(x).hide()});Hb(Cc);Ln(Cc);var CG=/^aria-[\w-]*$/i,Sp={"*":["class","dir","id","lang","role",CG],a:["target","href","title","rel"],area:[],b:[],br:[],col:[],code:[],dd:[],div:[],dl:[],dt:[],em:[],hr:[],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],i:[],img:["src","srcset","alt","title","width","height"],li:[],ol:[],p:[],pre:[],s:[],small:[],span:[],sub:[],sup:[],strong:[],u:[],ul:[]},kG=new Set(["background","cite","href","itemtype","longdesc","poster","src","xlink:href"]),QG=/^(?!javascript:)(?:[a-z0-9+.-]+:|[^&:/?#]*(?:[/?#]|$))/i,LG=(x,g)=>{let Y=x.nodeName.toLowerCase();return g.includes(Y)?kG.has(Y)?!!QG.test(x.nodeValue):!0:g.filter(D=>D instanceof RegExp).some(D=>D.test(Y))};function EG(x,g,Y){if(!x.length)return x;if(Y&&typeof Y=="function")return Y(x);let I=new window.DOMParser().parseFromString(x,"text/html"),o=[].concat(...I.body.querySelectorAll("*"));for(let st of o){let Ct=st.nodeName.toLowerCase();if(!Object.keys(g).includes(Ct)){st.remove();continue}let vt=[].concat(...st.attributes),de=[].concat(g["*"]||[],g[Ct]||[]);for(let ee of vt)LG(ee,de)||st.removeAttribute(ee.nodeName)}return I.body.innerHTML}var zG="TemplateFactory",jG={allowList:Sp,content:{},extraClass:"",html:!1,sanitize:!0,sanitizeFn:null,template:"<div></div>"},AG={allowList:"object",content:"object",extraClass:"(string|function)",html:"boolean",sanitize:"boolean",sanitizeFn:"(null|function)",template:"string"},wG={entry:"(string|element|function|null)",selector:"(string|element)"},v1=class extends So{constructor(g){super(),this._config=this._getConfig(g)}static get Default(){return jG}static get DefaultType(){return AG}static get NAME(){return zG}getContent(){return Object.values(this._config.content).map(g=>this._resolvePossibleFunction(g)).filter(Boolean)}hasContent(){return this.getContent().length>0}changeContent(g){return this._checkContent(g),this._config.content={...this._config.content,...g},this}toHtml(){let g=document.createElement("div");g.innerHTML=this._maybeSanitize(this._config.template);for(let[I,o]of Object.entries(this._config.content))this._setContent(g,o,I);let Y=g.children[0],D=this._resolvePossibleFunction(this._config.extraClass);return D&&Y.classList.add(...D.split(" ")),Y}_typeCheckConfig(g){super._typeCheckConfig(g),this._checkContent(g.content)}_checkContent(g){for(let[Y,D]of Object.entries(g))super._typeCheckConfig({selector:Y,entry:D},wG)}_setContent(g,Y,D){let I=Te.findOne(D,g);if(I){if(Y=this._resolvePossibleFunction(Y),!Y){I.remove();return}if(ac(Y)){this._putElementInTemplate(yc(Y),I);return}if(this._config.html){I.innerHTML=this._maybeSanitize(Y);return}I.textContent=Y}}_maybeSanitize(g){return this._config.sanitize?EG(g,this._config.allowList,this._config.sanitizeFn):g}_resolvePossibleFunction(g){return nn(g,[void 0,this])}_putElementInTemplate(g,Y){if(this._config.html){Y.innerHTML="",Y.append(g);return}Y.textContent=g.textContent}},vG="tooltip",HG=new Set(["sanitize","allowList","sanitizeFn"]),B1="fade",DG="modal",Xb="show",fG=".tooltip-inner",ep=`.${DG}`,ip="hide.bs.modal",d0="hover",S1="focus",C1="click",OG="manual",_G="hide",PG="hidden",KG="show",qG="shown",$G="inserted",tN="click",eN="focusin",iN="focusout",lN="mouseenter",aN="mouseleave",nN={AUTO:"auto",TOP:"top",RIGHT:kn()?"left":"right",BOTTOM:"bottom",LEFT:kn()?"right":"left"},dN={allowList:Sp,animation:!0,boundary:"clippingParents",container:!1,customClass:"",delay:0,fallbackPlacements:["top","right","bottom","left"],html:!1,offset:[0,6],placement:"top",popperConfig:null,sanitize:!0,sanitizeFn:null,selector:!1,template:'<div class="tooltip" role="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>',title:"",trigger:"hover focus"},cN={allowList:"object",animation:"boolean",boundary:"(string|element)",container:"(string|element|boolean)",customClass:"(string|function)",delay:"(number|object)",fallbackPlacements:"array",html:"boolean",offset:"(array|string|function)",placement:"(string|function)",popperConfig:"(null|object|function)",sanitize:"boolean",sanitizeFn:"(null|function)",selector:"(string|boolean)",template:"string",title:"(string|element|function)",trigger:"string"},fr=class x extends un{constructor(g,Y){if(typeof Mb>"u")throw new TypeError("Bootstrap's tooltips require Popper (https://popper.js.org/docs/v2/)");super(g,Y),this._isEnabled=!0,this._timeout=0,this._isHovered=null,this._activeTrigger={},this._popper=null,this._templateFactory=null,this._newContent=null,this.tip=null,this._setListeners(),this._config.selector||this._fixTitle()}static get Default(){return dN}static get DefaultType(){return cN}static get NAME(){return vG}enable(){this._isEnabled=!0}disable(){this._isEnabled=!1}toggleEnabled(){this._isEnabled=!this._isEnabled}toggle(){if(this._isEnabled){if(this._isShown()){this._leave();return}this._enter()}}dispose(){clearTimeout(this._timeout),ie.off(this._element.closest(ep),ip,this._hideModalHandler),this._element.getAttribute("data-bs-original-title")&&this._element.setAttribute("title",this._element.getAttribute("data-bs-original-title")),this._disposePopper(),super.dispose()}show(){if(this._element.style.display==="none")throw new Error("Please use show on visible elements");if(!(this._isWithContent()&&this._isEnabled))return;let g=ie.trigger(this._element,this.constructor.eventName(KG)),D=(mp(this._element)||this._element.ownerDocument.documentElement).contains(this._element);if(g.defaultPrevented||!D)return;this._disposePopper();let I=this._getTipElement();this._element.setAttribute("aria-describedby",I.getAttribute("id"));let{container:o}=this._config;if(this._element.ownerDocument.documentElement.contains(this.tip)||(o.append(I),ie.trigger(this._element,this.constructor.eventName($G))),this._popper=this._createPopper(I),I.classList.add(Xb),"ontouchstart"in document.documentElement)for(let Ct of[].concat(...document.body.children))ie.on(Ct,"mouseover",Cb);let st=()=>{ie.trigger(this._element,this.constructor.eventName(qG)),this._isHovered===!1&&this._leave(),this._isHovered=!1};this._queueCallback(st,this.tip,this._isAnimated())}hide(){if(!this._isShown()||ie.trigger(this._element,this.constructor.eventName(_G)).defaultPrevented)return;if(this._getTipElement().classList.remove(Xb),"ontouchstart"in document.documentElement)for(let I of[].concat(...document.body.children))ie.off(I,"mouseover",Cb);this._activeTrigger[C1]=!1,this._activeTrigger[S1]=!1,this._activeTrigger[d0]=!1,this._isHovered=null;let D=()=>{this._isWithActiveTrigger()||(this._isHovered||this._disposePopper(),this._element.removeAttribute("aria-describedby"),ie.trigger(this._element,this.constructor.eventName(PG)))};this._queueCallback(D,this.tip,this._isAnimated())}update(){this._popper&&this._popper.update()}_isWithContent(){return!!this._getTitle()}_getTipElement(){return this.tip||(this.tip=this._createTipElement(this._newContent||this._getContentForTemplate())),this.tip}_createTipElement(g){let Y=this._getTemplateFactory(g).toHtml();if(!Y)return null;Y.classList.remove(B1,Xb),Y.classList.add(`bs-${this.constructor.NAME}-auto`);let D=_u(this.constructor.NAME).toString();return Y.setAttribute("id",D),this._isAnimated()&&Y.classList.add(B1),Y}setContent(g){this._newContent=g,this._isShown()&&(this._disposePopper(),this.show())}_getTemplateFactory(g){return this._templateFactory?this._templateFactory.changeContent(g):this._templateFactory=new v1({...this._config,content:g,extraClass:this._resolvePossibleFunction(this._config.customClass)}),this._templateFactory}_getContentForTemplate(){return{[fG]:this._getTitle()}}_getTitle(){return this._resolvePossibleFunction(this._config.title)||this._element.getAttribute("data-bs-original-title")}_initializeOnDelegatedTarget(g){return this.constructor.getOrCreateInstance(g.delegateTarget,this._getDelegateConfig())}_isAnimated(){return this._config.animation||this.tip&&this.tip.classList.contains(B1)}_isShown(){return this.tip&&this.tip.classList.contains(Xb)}_createPopper(g){let Y=nn(this._config.placement,[this,g,this._element]),D=nN[Y.toUpperCase()];return a0(this._element,g,this._getPopperConfig(D))}_getOffset(){let{offset:g}=this._config;return typeof g=="string"?g.split(",").map(Y=>Number.parseInt(Y,10)):typeof g=="function"?Y=>g(Y,this._element):g}_resolvePossibleFunction(g){return nn(g,[this._element,this._element])}_getPopperConfig(g){let Y={placement:g,modifiers:[{name:"flip",options:{fallbackPlacements:this._config.fallbackPlacements}},{name:"offset",options:{offset:this._getOffset()}},{name:"preventOverflow",options:{boundary:this._config.boundary}},{name:"arrow",options:{element:`.${this.constructor.NAME}-arrow`}},{name:"preSetPlacement",enabled:!0,phase:"beforeMain",fn:D=>{this._getTipElement().setAttribute("data-popper-placement",D.state.placement)}}]};return{...Y,...nn(this._config.popperConfig,[void 0,Y])}}_setListeners(){let g=this._config.trigger.split(" ");for(let Y of g)if(Y==="click")ie.on(this._element,this.constructor.eventName(tN),this._config.selector,D=>{let I=this._initializeOnDelegatedTarget(D);I._activeTrigger[C1]=!(I._isShown()&&I._activeTrigger[C1]),I.toggle()});else if(Y!==OG){let D=Y===d0?this.constructor.eventName(lN):this.constructor.eventName(eN),I=Y===d0?this.constructor.eventName(aN):this.constructor.eventName(iN);ie.on(this._element,D,this._config.selector,o=>{let st=this._initializeOnDelegatedTarget(o);st._activeTrigger[o.type==="focusin"?S1:d0]=!0,st._enter()}),ie.on(this._element,I,this._config.selector,o=>{let st=this._initializeOnDelegatedTarget(o);st._activeTrigger[o.type==="focusout"?S1:d0]=st._element.contains(o.relatedTarget),st._leave()})}this._hideModalHandler=()=>{this._element&&this.hide()},ie.on(this._element.closest(ep),ip,this._hideModalHandler)}_fixTitle(){let g=this._element.getAttribute("title");g&&(!this._element.getAttribute("aria-label")&&!this._element.textContent.trim()&&this._element.setAttribute("aria-label",g),this._element.setAttribute("data-bs-original-title",g),this._element.removeAttribute("title"))}_enter(){if(this._isShown()||this._isHovered){this._isHovered=!0;return}this._isHovered=!0,this._setTimeout(()=>{this._isHovered&&this.show()},this._config.delay.show)}_leave(){this._isWithActiveTrigger()||(this._isHovered=!1,this._setTimeout(()=>{this._isHovered||this.hide()},this._config.delay.hide))}_setTimeout(g,Y){clearTimeout(this._timeout),this._timeout=setTimeout(g,Y)}_isWithActiveTrigger(){return Object.values(this._activeTrigger).includes(!0)}_getConfig(g){let Y=nc.getDataAttributes(this._element);for(let D of Object.keys(Y))HG.has(D)&&delete Y[D];return g={...Y,...typeof g=="object"&&g?g:{}},g=this._mergeConfigObj(g),g=this._configAfterMerge(g),this._typeCheckConfig(g),g}_configAfterMerge(g){return g.container=g.container===!1?document.body:yc(g.container),typeof g.delay=="number"&&(g.delay={show:g.delay,hide:g.delay}),typeof g.title=="number"&&(g.title=g.title.toString()),typeof g.content=="number"&&(g.content=g.content.toString()),g}_getDelegateConfig(){let g={};for(let[Y,D]of Object.entries(this._config))this.constructor.Default[Y]!==D&&(g[Y]=D);return g.selector=!1,g.trigger="manual",g}_disposePopper(){this._popper&&(this._popper.destroy(),this._popper=null),this.tip&&(this.tip.remove(),this.tip=null)}static jQueryInterface(g){return this.each(function(){let Y=x.getOrCreateInstance(this,g);if(typeof g=="string"){if(typeof Y[g]>"u")throw new TypeError(`No method named "${g}"`);Y[g]()}})}};Ln(fr);var oN="popover",rN=".popover-header",sN=".popover-body",bN={...fr.Default,content:"",offset:[0,8],placement:"right",template:'<div class="popover" role="tooltip"><div class="popover-arrow"></div><h3 class="popover-header"></h3><div class="popover-body"></div></div>',trigger:"click"},mN={...fr.DefaultType,content:"(null|string|element|function)"},H1=class x extends fr{static get Default(){return bN}static get DefaultType(){return mN}static get NAME(){return oN}_isWithContent(){return this._getTitle()||this._getContent()}_getContentForTemplate(){return{[rN]:this._getTitle(),[sN]:this._getContent()}}_getContent(){return this._resolvePossibleFunction(this._config.content)}static jQueryInterface(g){return this.each(function(){let Y=x.getOrCreateInstance(this,g);if(typeof g=="string"){if(typeof Y[g]>"u")throw new TypeError(`No method named "${g}"`);Y[g]()}})}};Ln(H1);var WN="scrollspy",hN="bs.scrollspy",_1=`.${hN}`,ZN=".data-api",pN=`activate${_1}`,lp=`click${_1}`,VN=`load${_1}${ZN}`,gN="dropdown-item",Ar="active",uN='[data-bs-spy="scroll"]',k1="[href]",RN=".nav, .list-group",ap=".nav-link",FN=".nav-item",GN=".list-group-item",NN=`${ap}, ${FN} > ${ap}, ${GN}`,IN=".dropdown",UN=".dropdown-toggle",MN={offset:null,rootMargin:"0px 0px -25%",smoothScroll:!1,target:null,threshold:[.1,.5,1]},YN={offset:"(number|null)",rootMargin:"string",smoothScroll:"boolean",target:"element",threshold:"array"},wb=class x extends un{constructor(g,Y){super(g,Y),this._targetLinks=new Map,this._observableSections=new Map,this._rootElement=getComputedStyle(this._element).overflowY==="visible"?null:this._element,this._activeTarget=null,this._observer=null,this._previousScrollData={visibleEntryTop:0,parentScrollTop:0},this.refresh()}static get Default(){return MN}static get DefaultType(){return YN}static get NAME(){return WN}refresh(){this._initializeTargetsAndObservables(),this._maybeEnableSmoothScroll(),this._observer?this._observer.disconnect():this._observer=this._getNewObserver();for(let g of this._observableSections.values())this._observer.observe(g)}dispose(){this._observer.disconnect(),super.dispose()}_configAfterMerge(g){return g.target=yc(g.target)||document.body,g.rootMargin=g.offset?`${g.offset}px 0px -30%`:g.rootMargin,typeof g.threshold=="string"&&(g.threshold=g.threshold.split(",").map(Y=>Number.parseFloat(Y))),g}_maybeEnableSmoothScroll(){this._config.smoothScroll&&(ie.off(this._config.target,lp),ie.on(this._config.target,lp,k1,g=>{let Y=this._observableSections.get(g.target.hash);if(Y){g.preventDefault();let D=this._rootElement||window,I=Y.offsetTop-this._element.offsetTop;if(D.scrollTo){D.scrollTo({top:I,behavior:"smooth"});return}D.scrollTop=I}}))}_getNewObserver(){let g={root:this._rootElement,threshold:this._config.threshold,rootMargin:this._config.rootMargin};return new IntersectionObserver(Y=>this._observerCallback(Y),g)}_observerCallback(g){let Y=st=>this._targetLinks.get(`#${st.target.id}`),D=st=>{this._previousScrollData.visibleEntryTop=st.target.offsetTop,this._process(Y(st))},I=(this._rootElement||document.documentElement).scrollTop,o=I>=this._previousScrollData.parentScrollTop;this._previousScrollData.parentScrollTop=I;for(let st of g){if(!st.isIntersecting){this._activeTarget=null,this._clearActiveClass(Y(st));continue}let Ct=st.target.offsetTop>=this._previousScrollData.visibleEntryTop;if(o&&Ct){if(D(st),!I)return;continue}!o&&!Ct&&D(st)}}_initializeTargetsAndObservables(){this._targetLinks=new Map,this._observableSections=new Map;let g=Te.find(k1,this._config.target);for(let Y of g){if(!Y.hash||Bc(Y))continue;let D=Te.findOne(decodeURI(Y.hash),this._element);Or(D)&&(this._targetLinks.set(decodeURI(Y.hash),Y),this._observableSections.set(Y.hash,D))}}_process(g){this._activeTarget!==g&&(this._clearActiveClass(this._config.target),this._activeTarget=g,g.classList.add(Ar),this._activateParents(g),ie.trigger(this._element,pN,{relatedTarget:g}))}_activateParents(g){if(g.classList.contains(gN)){Te.findOne(UN,g.closest(IN)).classList.add(Ar);return}for(let Y of Te.parents(g,RN))for(let D of Te.prev(Y,NN))D.classList.add(Ar)}_clearActiveClass(g){g.classList.remove(Ar);let Y=Te.find(`${k1}.${Ar}`,g);for(let D of Y)D.classList.remove(Ar)}static jQueryInterface(g){return this.each(function(){let Y=x.getOrCreateInstance(this,g);if(typeof g=="string"){if(Y[g]===void 0||g.startsWith("_")||g==="constructor")throw new TypeError(`No method named "${g}"`);Y[g]()}})}};ie.on(window,VN,()=>{for(let x of Te.find(uN))wb.getOrCreateInstance(x)});Ln(wb);var xN="tab",TN="bs.tab",ko=`.${TN}`,XN=`hide${ko}`,JN=`hidden${ko}`,yN=`show${ko}`,BN=`shown${ko}`,SN=`click${ko}`,CN=`keydown${ko}`,kN=`load${ko}`,QN="ArrowLeft",np="ArrowRight",LN="ArrowUp",dp="ArrowDown",Q1="Home",cp="End",Bo="active",op="fade",L1="show",EN="dropdown",Cp=".dropdown-toggle",zN=".dropdown-menu",E1=`:not(${Cp})`,jN='.list-group, .nav, [role="tablist"]',AN=".nav-item, .list-group-item",wN=`.nav-link${E1}, .list-group-item${E1}, [role="tab"]${E1}`,kp='[data-bs-toggle="tab"], [data-bs-toggle="pill"], [data-bs-toggle="list"]',z1=`${wN}, ${kp}`,vN=`.${Bo}[data-bs-toggle="tab"], .${Bo}[data-bs-toggle="pill"], .${Bo}[data-bs-toggle="list"]`,r0=class x extends un{constructor(g){super(g),this._parent=this._element.closest(jN),this._parent&&(this._setInitialAttributes(this._parent,this._getChildren()),ie.on(this._element,CN,Y=>this._keydown(Y)))}static get NAME(){return xN}show(){let g=this._element;if(this._elemIsActive(g))return;let Y=this._getActiveElem(),D=Y?ie.trigger(Y,XN,{relatedTarget:g}):null;ie.trigger(g,yN,{relatedTarget:Y}).defaultPrevented||D&&D.defaultPrevented||(this._deactivate(Y,g),this._activate(g,Y))}_activate(g,Y){if(!g)return;g.classList.add(Bo),this._activate(Te.getElementFromSelector(g));let D=()=>{if(g.getAttribute("role")!=="tab"){g.classList.add(L1);return}g.removeAttribute("tabindex"),g.setAttribute("aria-selected",!0),this._toggleDropDown(g,!0),ie.trigger(g,BN,{relatedTarget:Y})};this._queueCallback(D,g,g.classList.contains(op))}_deactivate(g,Y){if(!g)return;g.classList.remove(Bo),g.blur(),this._deactivate(Te.getElementFromSelector(g));let D=()=>{if(g.getAttribute("role")!=="tab"){g.classList.remove(L1);return}g.setAttribute("aria-selected",!1),g.setAttribute("tabindex","-1"),this._toggleDropDown(g,!1),ie.trigger(g,JN,{relatedTarget:Y})};this._queueCallback(D,g,g.classList.contains(op))}_keydown(g){if(![QN,np,LN,dp,Q1,cp].includes(g.key))return;g.stopPropagation(),g.preventDefault();let Y=this._getChildren().filter(I=>!Bc(I)),D;if([Q1,cp].includes(g.key))D=Y[g.key===Q1?0:Y.length-1];else{let I=[np,dp].includes(g.key);D=D1(Y,g.target,I,!0)}D&&(D.focus({preventScroll:!0}),x.getOrCreateInstance(D).show())}_getChildren(){return Te.find(z1,this._parent)}_getActiveElem(){return this._getChildren().find(g=>this._elemIsActive(g))||null}_setInitialAttributes(g,Y){this._setAttributeIfNotExists(g,"role","tablist");for(let D of Y)this._setInitialAttributesOnChild(D)}_setInitialAttributesOnChild(g){g=this._getInnerElement(g);let Y=this._elemIsActive(g),D=this._getOuterElement(g);g.setAttribute("aria-selected",Y),D!==g&&this._setAttributeIfNotExists(D,"role","presentation"),Y||g.setAttribute("tabindex","-1"),this._setAttributeIfNotExists(g,"role","tab"),this._setInitialAttributesOnTargetPanel(g)}_setInitialAttributesOnTargetPanel(g){let Y=Te.getElementFromSelector(g);Y&&(this._setAttributeIfNotExists(Y,"role","tabpanel"),g.id&&this._setAttributeIfNotExists(Y,"aria-labelledby",`${g.id}`))}_toggleDropDown(g,Y){let D=this._getOuterElement(g);if(!D.classList.contains(EN))return;let I=(o,st)=>{let Ct=Te.findOne(o,D);Ct&&Ct.classList.toggle(st,Y)};I(Cp,Bo),I(zN,L1),D.setAttribute("aria-expanded",Y)}_setAttributeIfNotExists(g,Y,D){g.hasAttribute(Y)||g.setAttribute(Y,D)}_elemIsActive(g){return g.classList.contains(Bo)}_getInnerElement(g){return g.matches(z1)?g:Te.findOne(z1,g)}_getOuterElement(g){return g.closest(AN)||g}static jQueryInterface(g){return this.each(function(){let Y=x.getOrCreateInstance(this);if(typeof g=="string"){if(Y[g]===void 0||g.startsWith("_")||g==="constructor")throw new TypeError(`No method named "${g}"`);Y[g]()}})}};ie.on(document,SN,kp,function(x){["A","AREA"].includes(this.tagName)&&x.preventDefault(),!Bc(this)&&r0.getOrCreateInstance(this).show()});ie.on(window,kN,()=>{for(let x of Te.find(vN))r0.getOrCreateInstance(x)});Ln(r0);var HN="toast",DN="bs.toast",Qc=`.${DN}`,fN=`mouseover${Qc}`,ON=`mouseout${Qc}`,_N=`focusin${Qc}`,PN=`focusout${Qc}`,KN=`hide${Qc}`,qN=`hidden${Qc}`,$N=`show${Qc}`,tI=`shown${Qc}`,eI="fade",rp="hide",Jb="show",yb="showing",iI={animation:"boolean",autohide:"boolean",delay:"number"},lI={animation:!0,autohide:!0,delay:5e3},vb=class x extends un{constructor(g,Y){super(g,Y),this._timeout=null,this._hasMouseInteraction=!1,this._hasKeyboardInteraction=!1,this._setListeners()}static get Default(){return lI}static get DefaultType(){return iI}static get NAME(){return HN}show(){if(ie.trigger(this._element,$N).defaultPrevented)return;this._clearTimeout(),this._config.animation&&this._element.classList.add(eI);let Y=()=>{this._element.classList.remove(yb),ie.trigger(this._element,tI),this._maybeScheduleHide()};this._element.classList.remove(rp),s0(this._element),this._element.classList.add(Jb,yb),this._queueCallback(Y,this._element,this._config.animation)}hide(){if(!this.isShown()||ie.trigger(this._element,KN).defaultPrevented)return;let Y=()=>{this._element.classList.add(rp),this._element.classList.remove(yb,Jb),ie.trigger(this._element,qN)};this._element.classList.add(yb),this._queueCallback(Y,this._element,this._config.animation)}dispose(){this._clearTimeout(),this.isShown()&&this._element.classList.remove(Jb),super.dispose()}isShown(){return this._element.classList.contains(Jb)}_maybeScheduleHide(){this._config.autohide&&(this._hasMouseInteraction||this._hasKeyboardInteraction||(this._timeout=setTimeout(()=>{this.hide()},this._config.delay)))}_onInteraction(g,Y){switch(g.type){case"mouseover":case"mouseout":{this._hasMouseInteraction=Y;break}case"focusin":case"focusout":{this._hasKeyboardInteraction=Y;break}}if(Y){this._clearTimeout();return}let D=g.relatedTarget;this._element===D||this._element.contains(D)||this._maybeScheduleHide()}_setListeners(){ie.on(this._element,fN,g=>this._onInteraction(g,!0)),ie.on(this._element,ON,g=>this._onInteraction(g,!1)),ie.on(this._element,_N,g=>this._onInteraction(g,!0)),ie.on(this._element,PN,g=>this._onInteraction(g,!1))}_clearTimeout(){clearTimeout(this._timeout),this._timeout=null}static jQueryInterface(g){return this.each(function(){let Y=x.getOrCreateInstance(this,g);if(typeof g=="string"){if(typeof Y[g]>"u")throw new TypeError(`No method named "${g}"`);Y[g](this)}})}};Hb(vb);Ln(vb);var Qp={id:"greggs_points",type:"circle",source:"greggs",minzoom:7,paint:{"circle-radius":{stops:[[9,10],[11,20],[16,35]]},"circle-color":"rgb(251, 169, 23)","circle-stroke-color":"rgb(8, 66, 125)","circle-stroke-width":1.5,"circle-opacity":["interpolate",["linear"],["zoom"],7,0,8,1,9,.5],"circle-stroke-opacity":["interpolate",["linear"],["zoom"],7,0,8,1]}},Lp={id:"greggs_heat",type:"heatmap",source:"greggs",maxzoom:9,paint:{"heatmap-weight":["interpolate",["linear"],1.25,0,0,6,1],"heatmap-intensity":["interpolate",["linear"],["zoom"],0,1,9,3],"heatmap-color":["interpolate",["linear"],["heatmap-density"],0,"rgba(8, 66, 125, 0)",.2,"rgb(57,87,105)",.4,"rgb(105,107,84)",.6,"rgb(154,128,64)",.8,"rgb(202,148,43)",1,"rgb(251, 169, 23)"],"heatmap-radius":["interpolate",["linear"],["zoom"],0,2,9,20],"heatmap-opacity":["interpolate",["linear"],["zoom"],7,1,9,0]}},Ep={id:"pret_points",type:"circle",source:"pret",minzoom:7,layout:{visibility:"none"},paint:{"circle-radius":{stops:[[9,10],[11,20],[16,35]]},"circle-color":"rgb(140, 29, 38)","circle-stroke-color":"rgb(255, 255, 255)","circle-stroke-width":1.5,"circle-opacity":["interpolate",["linear"],["zoom"],7,0,8,1,9,.5],"circle-stroke-opacity":["interpolate",["linear"],["zoom"],7,0,8,1]}},zp={id:"pret_heat",type:"heatmap",source:"pret",maxzoom:9,layout:{visibility:"none"},paint:{"heatmap-weight":["interpolate",["linear"],1.25,0,0,6,1],"heatmap-intensity":["interpolate",["linear"],["zoom"],0,1,9,3],"heatmap-color":["interpolate",["linear"],["heatmap-density"],0,"rgba(255, 255, 255, 0)",.2,"rgb(232, 210, 452)",.4,"rgb(209, 165, 348)",.6,"rgb(186, 119, 245)",.8,"rgb(163, 74, 141)",1,"rgb(140, 29, 38)"],"heatmap-radius":["interpolate",["linear"],["zoom"],0,2,9,20],"heatmap-opacity":["interpolate",["linear"],["zoom"],7,1,9,0]}};var wp=eZ(Ap()),Ba=wp.default,aI={weekday:"long",year:"numeric",month:"long",day:"numeric"},hd=new P1.default.Map({container:"map",style:"https://tiles.openfreemap.org/styles/liberty",zoom:5.205985389161131,center:{lng:-3.8,lat:53.82777852234969},customAttribution:'Uses <a href="https://ratings.food.gov.uk">FHRS</a> Data'}),K1={},m0="greggs",fb={greggs:{url:"static/latest_greggs.geojson",p_layer:Qp,h_layer:Lp},pret:{url:"static/latest_pret.geojson",p_layer:Ep,h_layer:zp}};async function nI(x){var g=[];g.push(Object.keys(fb).forEach(function(Y){fetch(fb[Y].url).then(D=>D.json()).then(D=>{x.addSource(Y,{type:"geojson",data:D}).addLayer(fb[Y].p_layer).addLayer(fb[Y].h_layer),K1[Y]=rZ(D.features)})})),await Promise.all(g)}hd.on("load",function(){nI(this),"geolocation"in navigator||Ba("#locate").fadeOut(500)});["greggs","pret"].forEach(function(x){hd.on("click",x+"_points",function(g){var Y=g.features[0].geometry.coordinates.slice();let I=new Date(g.features[0].properties.RatingDate).toLocaleDateString("en-GB",aI);for(var o=`<p>Post Code: ${g.features[0].properties.PostCode} in ${g.features[0].properties.LocalAuthorityName}</p><p>FHRS Rating: ${g.features[0].properties.RatingValue}</p><p>Rating Date: ${I}</p>`;Math.abs(g.lngLat.lng-Y[0])>180;)Y[0]+=g.lngLat.lng>Y[0]?360:-360;let st=`
          <div class="card border border-dark bg-primary-subtle m-2">
            <div class="card-body">
                <ul class="list-group list-group-flush">
                    <li class="list-group-item"><strong>Address:</strong> ${g.features[0].properties.PostCode} in ${g.features[0].properties.LocalAuthorityName}</li>
                    <li class="list-group-item"><strong>FHRS Rating:</strong> ${g.features[0].properties.RatingValue}</li>
                    <li class="list-group-item"><strong>Rating Date:</strong> ${I}</li>
                </ul>
            </div>
          </div>
        `;new P1.default.Popup().setLngLat(Y).setHTML(st).addTo(hd)}),hd.on("mouseenter",x+"_points",function(){hd.getCanvas().style.cursor="pointer"}),hd.on("mouseleave",x+"_points",function(){hd.getCanvas().style.cursor=""})});Ba("#lookup").submit(function(x){x.preventDefault();var g=Ba("input").first().val();Ba("input").first().val(""),Ba.getJSON("https://api.postcodes.io/postcodes/"+g).done(function(Y){Ba("#inputPostcode").removeClass("is-invalid");var D=c1([Y.result.longitude,Y.result.latitude]),I=r1(D,K1[m0]);hd.flyTo({center:I.geometry.coordinates,zoom:14,essential:!0})}).fail(function(){Ba(".invalid-feedback").text("Enter a valid UK Post Code"),Ba("#inputPostcode").addClass("is-invalid")})});Ba("#switch").click(function(){m0=="greggs"?(m0="pret",hd.setLayoutProperty("greggs_points","visibility","none").setLayoutProperty("greggs_heat","visibility","none").setLayoutProperty("pret_points","visibility","visible").setLayoutProperty("pret_heat","visibility","visible"),Ba("#pcbutton").text("Nearest Pret").removeClass("greggs").addClass("pret"),Ba("#switch").text("Switch to Greggs")):(m0="greggs",hd.setLayoutProperty("pret_points","visibility","none").setLayoutProperty("pret_heat","visibility","none").setLayoutProperty("greggs_points","visibility","visible").setLayoutProperty("greggs_heat","visibility","visible"),Ba("#pcbutton").text("Nearest Greggs").removeClass("pret").addClass("greggs"),Ba("#switch").text("Switch to Pret"))});function dI(x){var g=c1([x.coords.longitude,x.coords.latitude]),Y=r1(g,K1[m0]);hd.flyTo({center:Y.geometry.coordinates,zoom:14,essential:!0})}function cI(){Ba("#inputPostcode").addClass("is-invalid"),Ba(".invalid-feedback").text("Couldn't geolocate you!")}Ba("#locate").click(function(){navigator.geolocation.getCurrentPosition(dI,cI,{enableHighAccuracy:!0,timeout:2500})});
/*! Bundled license information:

maplibre-gl/dist/maplibre-gl.js:
  (**
   * MapLibre GL JS
   * @license 3-Clause BSD. Full text of license: https://github.com/maplibre/maplibre-gl-js/blob/v5.13.0/LICENSE.txt
   *)

jquery/dist/jquery.js:
  (*!
   * jQuery JavaScript Library v3.7.1
   * https://jquery.com/
   *
   * Copyright OpenJS Foundation and other contributors
   * Released under the MIT license
   * https://jquery.org/license
   *
   * Date: 2023-08-28T13:37Z
   *)

bootstrap/dist/js/bootstrap.esm.js:
  (*!
    * Bootstrap v5.3.8 (https://getbootstrap.com/)
    * Copyright 2011-2025 The Bootstrap Authors (https://github.com/twbs/bootstrap/graphs/contributors)
    * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE)
    *)
*/
//# sourceMappingURL=bundle.js.map
