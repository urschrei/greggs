var qg=Object.create;var e1=Object.defineProperty;var $g=Object.getOwnPropertyDescriptor;var tR=Object.getOwnPropertyNames;var eR=Object.getPrototypeOf,lR=Object.prototype.hasOwnProperty;var iR=(M,p)=>()=>(p||M((p={exports:{}}).exports,p),p.exports),aR=(M,p)=>{for(var U in p)e1(M,U,{get:p[U],enumerable:!0})},nR=(M,p,U,E)=>{if(p&&typeof p=="object"||typeof p=="function")for(let I of tR(p))!lR.call(M,I)&&I!==U&&e1(M,I,{get:()=>p[I],enumerable:!(E=$g(p,I))||E.enumerable});return M};var dR=(M,p,U)=>(U=M!=null?qg(eR(M)):{},nR(p||!M||!M.__esModule?e1(U,"default",{value:M,enumerable:!0}):U,M));var $Z=iR((l1,i1)=>{(function(M,p){typeof l1=="object"&&typeof i1<"u"?i1.exports=p():typeof define=="function"&&define.amd?define(p):(M=typeof globalThis<"u"?globalThis:M||self,M.maplibregl=p())})(l1,(function(){"use strict";var M={},p={};function U(I,o,lt){if(p[I]=lt,I==="index"){var Ft="var sharedModule = {}; ("+p.shared+")(sharedModule); ("+p.worker+")(sharedModule);",Ut={};return p.shared(Ut),p.index(M,Ut),typeof window<"u"&&M.setWorkerUrl(window.URL.createObjectURL(new Blob([Ft],{type:"text/javascript"}))),M}}U("shared",["exports"],(function(I){"use strict";function o(i,t,l,n){return new(l||(l=Promise))((function(d,s){function b(R){try{V(n.next(R))}catch(F){s(F)}}function Z(R){try{V(n.throw(R))}catch(F){s(F)}}function V(R){var F;R.done?d(R.value):(F=R.value,F instanceof l?F:new l((function(N){N(F)}))).then(b,Z)}V((n=n.apply(i,t||[])).next())}))}function lt(i,t){this.x=i,this.y=t}function Ft(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var Ut,Et;typeof SuppressedError=="function"&&SuppressedError,lt.prototype={clone(){return new lt(this.x,this.y)},add(i){return this.clone()._add(i)},sub(i){return this.clone()._sub(i)},multByPoint(i){return this.clone()._multByPoint(i)},divByPoint(i){return this.clone()._divByPoint(i)},mult(i){return this.clone()._mult(i)},div(i){return this.clone()._div(i)},rotate(i){return this.clone()._rotate(i)},rotateAround(i,t){return this.clone()._rotateAround(i,t)},matMult(i){return this.clone()._matMult(i)},unit(){return this.clone()._unit()},perp(){return this.clone()._perp()},round(){return this.clone()._round()},mag(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals(i){return this.x===i.x&&this.y===i.y},dist(i){return Math.sqrt(this.distSqr(i))},distSqr(i){let t=i.x-this.x,l=i.y-this.y;return t*t+l*l},angle(){return Math.atan2(this.y,this.x)},angleTo(i){return Math.atan2(this.y-i.y,this.x-i.x)},angleWith(i){return this.angleWithSep(i.x,i.y)},angleWithSep(i,t){return Math.atan2(this.x*t-this.y*i,this.x*i+this.y*t)},_matMult(i){let t=i[2]*this.x+i[3]*this.y;return this.x=i[0]*this.x+i[1]*this.y,this.y=t,this},_add(i){return this.x+=i.x,this.y+=i.y,this},_sub(i){return this.x-=i.x,this.y-=i.y,this},_mult(i){return this.x*=i,this.y*=i,this},_div(i){return this.x/=i,this.y/=i,this},_multByPoint(i){return this.x*=i.x,this.y*=i.y,this},_divByPoint(i){return this.x/=i.x,this.y/=i.y,this},_unit(){return this._div(this.mag()),this},_perp(){let i=this.y;return this.y=this.x,this.x=-i,this},_rotate(i){let t=Math.cos(i),l=Math.sin(i),n=l*this.x+t*this.y;return this.x=t*this.x-l*this.y,this.y=n,this},_rotateAround(i,t){let l=Math.cos(i),n=Math.sin(i),d=t.y+n*(this.x-t.x)+l*(this.y-t.y);return this.x=t.x+l*(this.x-t.x)-n*(this.y-t.y),this.y=d,this},_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},constructor:lt},lt.convert=function(i){if(i instanceof lt)return i;if(Array.isArray(i))return new lt(+i[0],+i[1]);if(i.x!==void 0&&i.y!==void 0)return new lt(+i.x,+i.y);throw new Error("Expected [x, y] or {x, y} point format")};var Bt=(function(){if(Et)return Ut;function i(t,l,n,d){this.cx=3*t,this.bx=3*(n-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*l,this.by=3*(d-l)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=l,this.p2x=n,this.p2y=d}return Et=1,Ut=i,i.prototype={sampleCurveX:function(t){return((this.ax*t+this.bx)*t+this.cx)*t},sampleCurveY:function(t){return((this.ay*t+this.by)*t+this.cy)*t},sampleCurveDerivativeX:function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},solveCurveX:function(t,l){if(l===void 0&&(l=1e-6),t<0)return 0;if(t>1)return 1;for(var n=t,d=0;d<8;d++){var s=this.sampleCurveX(n)-t;if(Math.abs(s)<l)return n;var b=this.sampleCurveDerivativeX(n);if(Math.abs(b)<1e-6)break;n-=s/b}var Z=0,V=1;for(n=t,d=0;d<20&&(s=this.sampleCurveX(n),!(Math.abs(s-t)<l));d++)t>s?Z=n:V=n,n=.5*(V-Z)+Z;return n},solve:function(t,l){return this.sampleCurveY(this.solveCurveX(t,l))}},Ut})(),ft=Ft(Bt);let le,Ct;function rt(){return le==null&&(le=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),le}function ne(){if(Ct==null&&(Ct=!1,rt())){let t=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(t){for(let n=0;n<25;n++){let d=4*n;t.fillStyle=`rgb(${d},${d+1},${d+2})`,t.fillRect(n%5,Math.floor(n/5),1,1)}let l=t.getImageData(0,0,5,5).data;for(let n=0;n<100;n++)if(n%4!=3&&l[n]!==n){Ct=!0;break}}}return Ct||!1}var Kt=1e-6,$t=typeof Float32Array<"u"?Float32Array:Array;function Ie(){var i=new $t(9);return $t!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[5]=0,i[6]=0,i[7]=0),i[0]=1,i[4]=1,i[8]=1,i}function Ue(i){return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function oe(){var i=new $t(3);return $t!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0),i}function ce(i){var t=i[0],l=i[1],n=i[2];return Math.sqrt(t*t+l*l+n*n)}function ge(i,t,l){var n=new $t(3);return n[0]=i,n[1]=t,n[2]=l,n}function ue(i,t,l){return i[0]=t[0]+l[0],i[1]=t[1]+l[1],i[2]=t[2]+l[2],i}function Qe(i,t,l){return i[0]=t[0]*l,i[1]=t[1]*l,i[2]=t[2]*l,i}function ke(i,t,l){var n=t[0],d=t[1],s=t[2],b=l[0],Z=l[1],V=l[2];return i[0]=d*V-s*Z,i[1]=s*b-n*V,i[2]=n*Z-d*b,i}var Me,He=ce;function Cl(i,t,l){var n=t[0],d=t[1],s=t[2],b=t[3];return i[0]=l[0]*n+l[4]*d+l[8]*s+l[12]*b,i[1]=l[1]*n+l[5]*d+l[9]*s+l[13]*b,i[2]=l[2]*n+l[6]*d+l[10]*s+l[14]*b,i[3]=l[3]*n+l[7]*d+l[11]*s+l[15]*b,i}function cl(){var i=new $t(4);return $t!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0),i[3]=1,i}function pi(i,t,l,n){var d=arguments.length>4&&arguments[4]!==void 0?arguments[4]:"zyx",s=Math.PI/360;t*=s,n*=s,l*=s;var b=Math.sin(t),Z=Math.cos(t),V=Math.sin(l),R=Math.cos(l),F=Math.sin(n),N=Math.cos(n);switch(d){case"xyz":i[0]=b*R*N+Z*V*F,i[1]=Z*V*N-b*R*F,i[2]=Z*R*F+b*V*N,i[3]=Z*R*N-b*V*F;break;case"xzy":i[0]=b*R*N-Z*V*F,i[1]=Z*V*N-b*R*F,i[2]=Z*R*F+b*V*N,i[3]=Z*R*N+b*V*F;break;case"yxz":i[0]=b*R*N+Z*V*F,i[1]=Z*V*N-b*R*F,i[2]=Z*R*F-b*V*N,i[3]=Z*R*N+b*V*F;break;case"yzx":i[0]=b*R*N+Z*V*F,i[1]=Z*V*N+b*R*F,i[2]=Z*R*F-b*V*N,i[3]=Z*R*N-b*V*F;break;case"zxy":i[0]=b*R*N-Z*V*F,i[1]=Z*V*N+b*R*F,i[2]=Z*R*F+b*V*N,i[3]=Z*R*N-b*V*F;break;case"zyx":i[0]=b*R*N-Z*V*F,i[1]=Z*V*N+b*R*F,i[2]=Z*R*F-b*V*N,i[3]=Z*R*N+b*V*F;break;default:throw new Error("Unknown angle order "+d)}return i}function Fl(){var i=new $t(2);return $t!=Float32Array&&(i[0]=0,i[1]=0),i}function Ul(i,t){var l=new $t(2);return l[0]=i,l[1]=t,l}oe(),Me=new $t(4),$t!=Float32Array&&(Me[0]=0,Me[1]=0,Me[2]=0,Me[3]=0),oe(),ge(1,0,0),ge(0,1,0),cl(),cl(),Ie(),Fl();let se=8192;function Ei(i,t,l){return t*(se/(i.tileSize*Math.pow(2,l-i.tileID.overscaledZ)))}function Ml(i,t){return(i%t+t)%t}function Xi(i,t,l){return i*(1-l)+t*l}function Ea(i){if(i<=0)return 0;if(i>=1)return 1;let t=i*i,l=t*i;return 4*(i<.5?l:3*(i-t)+l-.75)}function ci(i,t,l,n){let d=new ft(i,t,l,n);return s=>d.solve(s)}let gi=ci(.25,.1,.25,1);function el(i,t,l){return Math.min(l,Math.max(t,i))}function ml(i,t,l){let n=l-t,d=((i-t)%n+n)%n+t;return d===t?l:d}function ll(i,...t){for(let l of t)for(let n in l)i[n]=l[n];return i}let zi=1;function Al(i,t,l){let n={};for(let d in i)n[d]=t.call(this,i[d],d,i);return n}function ji(i,t,l){let n={};for(let d in i)t.call(this,i[d],d,i)&&(n[d]=i[d]);return n}function oi(i){return Array.isArray(i)?i.map(oi):typeof i=="object"&&i?Al(i,oi):i}let Ra={};function Le(i){Ra[i]||(typeof console<"u"&&console.warn(i),Ra[i]=!0)}function si(i,t,l){return(l.y-i.y)*(t.x-i.x)>(t.y-i.y)*(l.x-i.x)}function Ji(i){return typeof WorkerGlobalScope<"u"&&i!==void 0&&i instanceof WorkerGlobalScope}let Ee=null;function Ri(i){return typeof ImageBitmap<"u"&&i instanceof ImageBitmap}let ui="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function za(i,t,l,n,d){return o(this,void 0,void 0,(function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");let s=new VideoFrame(i,{timestamp:0});try{let b=s?.format;if(!b||!b.startsWith("BGR")&&!b.startsWith("RGB"))throw new Error(`Unrecognized format ${b}`);let Z=b.startsWith("BGR"),V=new Uint8ClampedArray(n*d*4);if(yield s.copyTo(V,(function(R,F,N,x,T){let X=4*Math.max(-F,0),B=(Math.max(0,N)-N)*x*4+X,C=4*x,z=Math.max(0,F),f=Math.max(0,N);return{rect:{x:z,y:f,width:Math.min(R.width,F+x)-z,height:Math.min(R.height,N+T)-f},layout:[{offset:B,stride:C}]}})(i,t,l,n,d)),Z)for(let R=0;R<V.length;R+=4){let F=V[R];V[R]=V[R+2],V[R+2]=F}return V}finally{s.close()}}))}let ea,Yl;function Fi(i,t,l,n){return i.addEventListener(t,l,n),{unsubscribe:()=>{i.removeEventListener(t,l,n)}}}function la(i){return i*Math.PI/180}function Ql(i){return i/Math.PI*180}let ua={touchstart:!0,touchmove:!0,touchmoveWindow:!0,touchend:!0,touchcancel:!0},ja={dblclick:!0,click:!0,mouseover:!0,mouseout:!0,mousedown:!0,mousemove:!0,mousemoveWindow:!0,mouseup:!0,mouseupWindow:!0,contextmenu:!0,wheel:!0},ia="AbortError";function Fa(){return new Error(ia)}let Ai={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function Sn(i){return Ai.REGISTERED_PROTOCOLS[i.substring(0,i.indexOf("://"))]}let an="global-dispatcher";class wi extends Error{constructor(t,l,n,d){super(`AJAXError: ${l} (${t}): ${n}`),this.status=t,this.statusText=l,this.url=n,this.body=d}}let Gi=()=>Ji(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,nt=function(i,t){if(/:\/\//.test(i.url)&&!/^https?:|^file:/.test(i.url)){let n=Sn(i.url);if(n)return n(i,t);if(Ji(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:i,targetMapId:an},t)}if(!(/^file:/.test(l=i.url)||/^file:/.test(Gi())&&!/^\w+:/.test(l))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return(function(n,d){return o(this,void 0,void 0,(function*(){let s=new Request(n.url,{method:n.method||"GET",body:n.body,credentials:n.credentials,headers:n.headers,cache:n.cache,referrer:Gi(),signal:d.signal}),b,Z;n.type!=="json"||s.headers.has("Accept")||s.headers.set("Accept","application/json");try{b=yield fetch(s)}catch(R){throw new wi(0,R.message,n.url,new Blob)}if(!b.ok){let R=yield b.blob();throw new wi(b.status,b.statusText,n.url,R)}Z=n.type==="arrayBuffer"||n.type==="image"?b.arrayBuffer():n.type==="json"?b.json():b.text();let V=yield Z;if(d.signal.aborted)throw Fa();return{data:V,cacheControl:b.headers.get("Cache-Control"),expires:b.headers.get("Expires")}}))})(i,t);if(Ji(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:i,mustQueue:!0,targetMapId:an},t)}var l;return(function(n,d){return new Promise(((s,b)=>{var Z;let V=new XMLHttpRequest;V.open(n.method||"GET",n.url,!0),n.type!=="arrayBuffer"&&n.type!=="image"||(V.responseType="arraybuffer");for(let R in n.headers)V.setRequestHeader(R,n.headers[R]);n.type==="json"&&(V.responseType="text",!((Z=n.headers)===null||Z===void 0)&&Z.Accept||V.setRequestHeader("Accept","application/json")),V.withCredentials=n.credentials==="include",V.onerror=()=>{b(new Error(V.statusText))},V.onload=()=>{if(!d.signal.aborted)if((V.status>=200&&V.status<300||V.status===0)&&V.response!==null){let R=V.response;if(n.type==="json")try{R=JSON.parse(V.response)}catch(F){return void b(F)}s({data:R,cacheControl:V.getResponseHeader("Cache-Control"),expires:V.getResponseHeader("Expires")})}else{let R=new Blob([V.response],{type:V.getResponseHeader("Content-Type")});b(new wi(V.status,V.statusText,n.url,R))}},d.signal.addEventListener("abort",(()=>{V.abort(),b(Fa())})),V.send(n.body)}))})(i,t)};function Q(i){if(!i||i.indexOf("://")<=0||i.indexOf("data:image/")===0||i.indexOf("blob:")===0)return!0;let t=new URL(i),l=window.location;return t.protocol===l.protocol&&t.host===l.host}function k(i,t,l){l[i]&&l[i].indexOf(t)!==-1||(l[i]=l[i]||[],l[i].push(t))}function j(i,t,l){if(l&&l[i]){let n=l[i].indexOf(t);n!==-1&&l[i].splice(n,1)}}class P{constructor(t,l={}){ll(this,l),this.type=t}}class $ extends P{constructor(t,l={}){super("error",ll({error:t},l))}}class st{on(t,l){return this._listeners=this._listeners||{},k(t,l,this._listeners),{unsubscribe:()=>{this.off(t,l)}}}off(t,l){return j(t,l,this._listeners),j(t,l,this._oneTimeListeners),this}once(t,l){return l?(this._oneTimeListeners=this._oneTimeListeners||{},k(t,l,this._oneTimeListeners),this):new Promise((n=>this.once(t,n)))}fire(t,l){typeof t=="string"&&(t=new P(t,l||{}));let n=t.type;if(this.listens(n)){t.target=this;let d=this._listeners&&this._listeners[n]?this._listeners[n].slice():[];for(let Z of d)Z.call(this,t);let s=this._oneTimeListeners&&this._oneTimeListeners[n]?this._oneTimeListeners[n].slice():[];for(let Z of s)j(n,Z,this._oneTimeListeners),Z.call(this,t);let b=this._eventedParent;b&&(ll(t,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),b.fire(t))}else t instanceof $&&console.error(t.error);return this}listens(t){return this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t)}setEventedParent(t,l){return this._eventedParent=t,this._eventedParentData=l,this}}var D={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},centerAltitude:{type:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},roll:{type:"number",default:0,units:"degrees"},state:{type:"state",default:{}},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},"font-faces":{type:"array",value:"fontFaces"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},encoding:{type:"enum",values:{mvt:{},mlt:{}},default:"mvt"},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},"color-relief":{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_color-relief","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_color-relief":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"projectionDefinition",default:"mercator","property-type":"data-constant",transition:!1,expression:{interpolated:!0,parameters:["zoom"]}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_color-relief","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"numberArray",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-altitude":{type:"numberArray",default:45,minimum:0,maximum:90,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"colorArray",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"colorArray",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-method":{type:"enum",values:{standard:{},basic:{},combined:{},igor:{},multidirectional:{}},default:"standard",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},"paint_color-relief":{"color-relief-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"color-relief-color":{type:"color",transition:!1,expression:{interpolated:!0,parameters:["elevation"]},"property-type":"color-ramp"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};let ot=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function Vt(i,t){let l={};for(let n in i)n!=="ref"&&(l[n]=i[n]);return ot.forEach((n=>{n in t&&(l[n]=t[n])})),l}function pt(i,t){if(Array.isArray(i)){if(!Array.isArray(t)||i.length!==t.length)return!1;for(let l=0;l<i.length;l++)if(!pt(i[l],t[l]))return!1;return!0}if(typeof i=="object"&&i!==null&&t!==null){if(typeof t!="object"||Object.keys(i).length!==Object.keys(t).length)return!1;for(let l in i)if(!pt(i[l],t[l]))return!1;return!0}return i===t}function gt(i,t){i.push(t)}function kt(i,t,l){gt(l,{command:"addSource",args:[i,t[i]]})}function Ht(i,t,l){gt(t,{command:"removeSource",args:[i]}),l[i]=!0}function ie(i,t,l,n){Ht(i,l,n),kt(i,t,l)}function Pe(i,t,l){let n;for(n in i[l])if(Object.prototype.hasOwnProperty.call(i[l],n)&&n!=="data"&&!pt(i[l][n],t[l][n]))return!1;for(n in t[l])if(Object.prototype.hasOwnProperty.call(t[l],n)&&n!=="data"&&!pt(i[l][n],t[l][n]))return!1;return!0}function be(i,t,l,n,d,s){i=i||{},t=t||{};for(let b in i)Object.prototype.hasOwnProperty.call(i,b)&&(pt(i[b],t[b])||l.push({command:s,args:[n,b,t[b],d]}));for(let b in t)Object.prototype.hasOwnProperty.call(t,b)&&!Object.prototype.hasOwnProperty.call(i,b)&&(pt(i[b],t[b])||l.push({command:s,args:[n,b,t[b],d]}))}function Re(i){return i.id}function Te(i,t){return i[t.id]=t,i}class Mt{constructor(t,l,n,d){this.message=(t?`${t}: `:"")+n,d&&(this.identifier=d),l!=null&&l.__line__&&(this.line=l.__line__)}}function ze(i,...t){for(let l of t)for(let n in l)i[n]=l[n];return i}class Xe extends Error{constructor(t,l){super(l),this.message=l,this.key=t}}class Wl{constructor(t,l=[]){this.parent=t,this.bindings={};for(let[n,d]of l)this.bindings[n]=d}concat(t){return new Wl(this,t)}get(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(`${t} not found in scope.`)}has(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)}}let Je={kind:"null"},xt={kind:"number"},jt={kind:"string"},_t={kind:"boolean"},ri={kind:"color"},nn={kind:"projectionDefinition"},xl={kind:"object"},Pt={kind:"value"},Ga={kind:"collator"},Cn={kind:"formatted"},Qn={kind:"padding"},vi={kind:"colorArray"},dn={kind:"numberArray"},kn={kind:"resolvedImage"},Ln={kind:"variableAnchorOffsetCollection"};function Ni(i,t){return{kind:"array",itemType:i,N:t}}function ye(i){if(i.kind==="array"){let t=ye(i.itemType);return typeof i.N=="number"?`array<${t}, ${i.N}>`:i.itemType.kind==="value"?"array":`array<${t}>`}return i.kind}let Bb=[Je,xt,jt,_t,ri,nn,Cn,xl,Ni(Pt),Qn,dn,vi,kn,Ln];function aa(i,t){if(t.kind==="error")return null;if(i.kind==="array"){if(t.kind==="array"&&(t.N===0&&t.itemType.kind==="value"||!aa(i.itemType,t.itemType))&&(typeof i.N!="number"||i.N===t.N))return null}else{if(i.kind===t.kind)return null;if(i.kind==="value"){for(let l of Bb)if(!aa(l,t))return null}}return`Expected ${ye(i)} but found ${ye(t)} instead.`}function Rd(i,t){return t.some((l=>l.kind===i.kind))}function De(i,t){return t.some((l=>l==="null"?i===null:l==="array"?Array.isArray(i):l==="object"?i&&!Array.isArray(i)&&typeof i=="object":l===typeof i))}function Aa(i,t){return i.kind==="array"&&t.kind==="array"?i.itemType.kind===t.itemType.kind&&typeof i.N=="number":i.kind===t.kind}let jo=.96422,En=.82521,Ao=4/29,zn=6/29,Mr=3*zn*zn,Yr=zn*zn*zn,Sb=Math.PI/180,xr=180/Math.PI;function Tr(i){return(i%=360)<0&&(i+=360),i}function Xr([i,t,l,n]){let d,s,b=vo((.2225045*(i=wo(i))+.7168786*(t=wo(t))+.0606169*(l=wo(l)))/1);i===t&&t===l?d=s=b:(d=vo((.4360747*i+.3850649*t+.1430804*l)/jo),s=vo((.0139322*i+.0971045*t+.7141733*l)/En));let Z=116*b-16;return[Z<0?0:Z,500*(d-b),200*(b-s),n]}function wo(i){return i<=.04045?i/12.92:Math.pow((i+.055)/1.055,2.4)}function vo(i){return i>Yr?Math.pow(i,1/3):i/Mr+Ao}function Jr([i,t,l,n]){let d=(i+16)/116,s=isNaN(t)?d:d+t/500,b=isNaN(l)?d:d-l/200;return d=1*Do(d),s=jo*Do(s),b=En*Do(b),[Ho(3.1338561*s-1.6168667*d-.4906146*b),Ho(-.9787684*s+1.9161415*d+.033454*b),Ho(.0719453*s-.2289914*d+1.4052427*b),n]}function Ho(i){return(i=i<=.00304?12.92*i:1.055*Math.pow(i,1/2.4)-.055)<0?0:i>1?1:i}function Do(i){return i>zn?i*i*i:Mr*(i-Ao)}let yr=Object.hasOwn||function(i,t){return Object.prototype.hasOwnProperty.call(i,t)};function Na(i,t){return yr(i,t)?i[t]:void 0}function Fc(i){return parseInt(i.padEnd(2,i),16)/255}function Br(i,t){return na(t?i/100:i,0,1)}function na(i,t,l){return Math.min(Math.max(t,i),l)}function Sr(i){return!i.some(Number.isNaN)}let Cb={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};function wa(i,t,l){return i+l*(t-i)}function cn(i,t,l){return i.map(((n,d)=>wa(n,t[d],l)))}class me{constructor(t,l,n,d=1,s=!0){this.r=t,this.g=l,this.b=n,this.a=d,s||(this.r*=d,this.g*=d,this.b*=d,d||this.overwriteGetter("rgb",[t,l,n,d]))}static parse(t){if(t instanceof me)return t;if(typeof t!="string")return;let l=(function(n){if((n=n.toLowerCase().trim())==="transparent")return[0,0,0,0];let d=Na(Cb,n);if(d){let[b,Z,V]=d;return[b/255,Z/255,V/255,1]}if(n.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(n)){let b=n.length<6?1:2,Z=1;return[Fc(n.slice(Z,Z+=b)),Fc(n.slice(Z,Z+=b)),Fc(n.slice(Z,Z+=b)),Fc(n.slice(Z,Z+b)||"ff")]}if(n.startsWith("rgb")){let b=n.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(b){let[Z,V,R,F,N,x,T,X,B,C,z,f]=b,A=[F||" ",T||" ",C].join("");if(A==="  "||A==="  /"||A===",,"||A===",,,"){let H=[R,x,B].join(""),at=H==="%%%"?100:H===""?255:0;if(at){let dt=[na(+V/at,0,1),na(+N/at,0,1),na(+X/at,0,1),z?Br(+z,f):1];if(Sr(dt))return dt}}return}}let s=n.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(s){let[b,Z,V,R,F,N,x,T,X]=s,B=[V||" ",F||" ",x].join("");if(B==="  "||B==="  /"||B===",,"||B===",,,"){let C=[+Z,na(+R,0,100),na(+N,0,100),T?Br(+T,X):1];if(Sr(C))return(function([z,f,A,H]){function at(dt){let Wt=(dt+z/30)%12,Nt=f*Math.min(A,1-A);return A-Nt*Math.max(-1,Math.min(Wt-3,9-Wt,1))}return z=Tr(z),f/=100,A/=100,[at(0),at(8),at(4),H]})(C)}}})(t);return l?new me(...l,!1):void 0}get rgb(){let{r:t,g:l,b:n,a:d}=this,s=d||1/0;return this.overwriteGetter("rgb",[t/s,l/s,n/s,d])}get hcl(){return this.overwriteGetter("hcl",(function(t){let[l,n,d,s]=Xr(t),b=Math.sqrt(n*n+d*d);return[Math.round(1e4*b)?Tr(Math.atan2(d,n)*xr):NaN,b,l,s]})(this.rgb))}get lab(){return this.overwriteGetter("lab",Xr(this.rgb))}overwriteGetter(t,l){return Object.defineProperty(this,t,{value:l}),l}toString(){let[t,l,n,d]=this.rgb;return`rgba(${[t,l,n].map((s=>Math.round(255*s))).join(",")},${d})`}static interpolate(t,l,n,d="rgb"){switch(d){case"rgb":{let[s,b,Z,V]=cn(t.rgb,l.rgb,n);return new me(s,b,Z,V,!1)}case"hcl":{let[s,b,Z,V]=t.hcl,[R,F,N,x]=l.hcl,T,X;if(isNaN(s)||isNaN(R))isNaN(s)?isNaN(R)?T=NaN:(T=R,Z!==1&&Z!==0||(X=F)):(T=s,N!==1&&N!==0||(X=b));else{let A=R-s;R>s&&A>180?A-=360:R<s&&s-R>180&&(A+=360),T=s+n*A}let[B,C,z,f]=(function([A,H,at,dt]){return A=isNaN(A)?0:A*Sb,Jr([at,Math.cos(A)*H,Math.sin(A)*H,dt])})([T,X??wa(b,F,n),wa(Z,N,n),wa(V,x,n)]);return new me(B,C,z,f,!1)}case"lab":{let[s,b,Z,V]=Jr(cn(t.lab,l.lab,n));return new me(s,b,Z,V,!1)}}}}me.black=new me(0,0,0,1),me.white=new me(1,1,1,1),me.transparent=new me(0,0,0,0),me.red=new me(1,0,0,1);class yi{constructor(t,l,n){this.sensitivity=t?l?"variant":"case":l?"accent":"base",this.locale=n,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(t,l){return this.collator.compare(t,l)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}let he=["bottom","center","top"];class va{constructor(t,l,n,d,s,b){this.text=t,this.image=l,this.scale=n,this.fontStack=d,this.textColor=s,this.verticalAlign=b}}class Zl{constructor(t){this.sections=t}static fromString(t){return new Zl([new va(t,null,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some((t=>t.text.length!==0||t.image&&t.image.name.length!==0))}static factory(t){return t instanceof Zl?t:Zl.fromString(t)}toString(){return this.sections.length===0?"":this.sections.map((t=>t.text)).join("")}}class wl{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof wl)return t;if(typeof t=="number")return new wl([t,t,t,t]);if(Array.isArray(t)&&!(t.length<1||t.length>4)){for(let l of t)if(typeof l!="number")return;switch(t.length){case 1:t=[t[0],t[0],t[0],t[0]];break;case 2:t=[t[0],t[1],t[0],t[1]];break;case 3:t=[t[0],t[1],t[2],t[1]]}return new wl(t)}}toString(){return JSON.stringify(this.values)}static interpolate(t,l,n){return new wl(cn(t.values,l.values,n))}}class vl{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof vl)return t;if(typeof t=="number")return new vl([t]);if(Array.isArray(t)){for(let l of t)if(typeof l!="number")return;return new vl(t)}}toString(){return JSON.stringify(this.values)}static interpolate(t,l,n){return new vl(cn(t.values,l.values,n))}}class Gl{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof Gl)return t;if(typeof t=="string"){let n=me.parse(t);return n?new Gl([n]):void 0}if(!Array.isArray(t))return;let l=[];for(let n of t){if(typeof n!="string")return;let d=me.parse(n);if(!d)return;l.push(d)}return new Gl(l)}toString(){return JSON.stringify(this.values)}static interpolate(t,l,n,d="rgb"){let s=[];if(t.values.length!=l.values.length)throw new Error(`colorArray: Arrays have mismatched length (${t.values.length} vs. ${l.values.length}), cannot interpolate.`);for(let b=0;b<t.values.length;b++)s.push(me.interpolate(t.values[b],l.values[b],n,d));return new Gl(s)}}class Be extends Error{constructor(t){super(t),this.name="RuntimeError"}toJSON(){return this.message}}let Gc=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class ti{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof ti)return t;if(Array.isArray(t)&&!(t.length<1)&&t.length%2==0){for(let l=0;l<t.length;l+=2){let n=t[l],d=t[l+1];if(typeof n!="string"||!Gc.has(n)||!Array.isArray(d)||d.length!==2||typeof d[0]!="number"||typeof d[1]!="number")return}return new ti(t)}}toString(){return JSON.stringify(this.values)}static interpolate(t,l,n){let d=t.values,s=l.values;if(d.length!==s.length)throw new Be(`Cannot interpolate values of different length. from: ${t.toString()}, to: ${l.toString()}`);let b=[];for(let Z=0;Z<d.length;Z+=2){if(d[Z]!==s[Z])throw new Be(`Cannot interpolate values containing mismatched anchors. from[${Z}]: ${d[Z]}, to[${Z}]: ${s[Z]}`);b.push(d[Z]);let[V,R]=d[Z+1],[F,N]=s[Z+1];b.push([wa(V,F,n),wa(R,N,n)])}return new ti(b)}}class bi{constructor(t){this.name=t.name,this.available=t.available}toString(){return this.name}static fromString(t){return t?new bi({name:t,available:!1}):null}}class Hl{constructor(t,l,n){this.from=t,this.to=l,this.transition=n}static interpolate(t,l,n){return new Hl(t,l,n)}static parse(t){return t instanceof Hl?t:Array.isArray(t)&&t.length===3&&typeof t[0]=="string"&&typeof t[1]=="string"&&typeof t[2]=="number"?new Hl(t[0],t[1],t[2]):typeof t=="object"&&typeof t.from=="string"&&typeof t.to=="string"&&typeof t.transition=="number"?new Hl(t.from,t.to,t.transition):typeof t=="string"?new Hl(t,t,1):void 0}}function Cr(i,t,l,n){return typeof i=="number"&&i>=0&&i<=255&&typeof t=="number"&&t>=0&&t<=255&&typeof l=="number"&&l>=0&&l<=255?n===void 0||typeof n=="number"&&n>=0&&n<=1?null:`Invalid rgba value [${[i,t,l,n].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof n=="number"?[i,t,l,n]:[i,t,l]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Ha(i){if(i===null||typeof i=="string"||typeof i=="boolean"||typeof i=="number"||i instanceof Hl||i instanceof me||i instanceof yi||i instanceof Zl||i instanceof wl||i instanceof vl||i instanceof Gl||i instanceof ti||i instanceof bi)return!0;if(Array.isArray(i)){for(let t of i)if(!Ha(t))return!1;return!0}if(typeof i=="object"){for(let t in i)if(!Ha(i[t]))return!1;return!0}return!1}function je(i){if(i===null)return Je;if(typeof i=="string")return jt;if(typeof i=="boolean")return _t;if(typeof i=="number")return xt;if(i instanceof me)return ri;if(i instanceof Hl)return nn;if(i instanceof yi)return Ga;if(i instanceof Zl)return Cn;if(i instanceof wl)return Qn;if(i instanceof vl)return dn;if(i instanceof Gl)return vi;if(i instanceof ti)return Ln;if(i instanceof bi)return kn;if(Array.isArray(i)){let t=i.length,l;for(let n of i){let d=je(n);if(l){if(l===d)continue;l=Pt;break}l=d}return Ni(l||Pt,t)}return xl}function jn(i){let t=typeof i;return i===null?"":t==="string"||t==="number"||t==="boolean"?String(i):i instanceof me||i instanceof Hl||i instanceof Zl||i instanceof wl||i instanceof vl||i instanceof Gl||i instanceof ti||i instanceof bi?i.toString():JSON.stringify(i)}class Da{constructor(t,l){this.type=t,this.value=l}static parse(t,l){if(t.length!==2)return l.error(`'literal' expression requires exactly one argument, but found ${t.length-1} instead.`);if(!Ha(t[1]))return l.error("invalid value");let n=t[1],d=je(n),s=l.expectedType;return d.kind!=="array"||d.N!==0||!s||s.kind!=="array"||typeof s.N=="number"&&s.N!==0||(d=s),new Da(d,n)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}let ud={string:jt,number:xt,boolean:_t,object:xl};class mi{constructor(t,l){this.type=t,this.args=l}static parse(t,l){if(t.length<2)return l.error("Expected at least one argument.");let n,d=1,s=t[0];if(s==="array"){let Z,V;if(t.length>2){let R=t[1];if(typeof R!="string"||!(R in ud)||R==="object")return l.error('The item type argument of "array" must be one of string, number, boolean',1);Z=ud[R],d++}else Z=Pt;if(t.length>3){if(t[2]!==null&&(typeof t[2]!="number"||t[2]<0||t[2]!==Math.floor(t[2])))return l.error('The length argument to "array" must be a positive integer literal',2);V=t[2],d++}n=Ni(Z,V)}else{if(!ud[s])throw new Error(`Types doesn't contain name = ${s}`);n=ud[s]}let b=[];for(;d<t.length;d++){let Z=l.parse(t[d],d,Pt);if(!Z)return null;b.push(Z)}return new mi(n,b)}evaluate(t){for(let l=0;l<this.args.length;l++){let n=this.args[l].evaluate(t);if(!aa(this.type,je(n)))return n;if(l===this.args.length-1)throw new Be(`Expected value to be of type ${ye(this.type)}, but found ${ye(je(n))} instead.`)}throw new Error}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every((t=>t.outputDefined()))}}let Ae={"to-boolean":_t,"to-color":ri,"to-number":xt,"to-string":jt};class da{constructor(t,l){this.type=t,this.args=l}static parse(t,l){if(t.length<2)return l.error("Expected at least one argument.");let n=t[0];if(!Ae[n])throw new Error(`Can't parse ${n} as it is not part of the known types`);if((n==="to-boolean"||n==="to-string")&&t.length!==2)return l.error("Expected one argument.");let d=Ae[n],s=[];for(let b=1;b<t.length;b++){let Z=l.parse(t[b],b,Pt);if(!Z)return null;s.push(Z)}return new da(d,s)}evaluate(t){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(t);case"color":{let l,n;for(let d of this.args){if(l=d.evaluate(t),n=null,l instanceof me)return l;if(typeof l=="string"){let s=t.parseColor(l);if(s)return s}else if(Array.isArray(l)&&(n=l.length<3||l.length>4?`Invalid rgba value ${JSON.stringify(l)}: expected an array containing either three or four numeric values.`:Cr(l[0],l[1],l[2],l[3]),!n))return new me(l[0]/255,l[1]/255,l[2]/255,l[3])}throw new Be(n||`Could not parse color from value '${typeof l=="string"?l:JSON.stringify(l)}'`)}case"padding":{let l;for(let n of this.args){l=n.evaluate(t);let d=wl.parse(l);if(d)return d}throw new Be(`Could not parse padding from value '${typeof l=="string"?l:JSON.stringify(l)}'`)}case"numberArray":{let l;for(let n of this.args){l=n.evaluate(t);let d=vl.parse(l);if(d)return d}throw new Be(`Could not parse numberArray from value '${typeof l=="string"?l:JSON.stringify(l)}'`)}case"colorArray":{let l;for(let n of this.args){l=n.evaluate(t);let d=Gl.parse(l);if(d)return d}throw new Be(`Could not parse colorArray from value '${typeof l=="string"?l:JSON.stringify(l)}'`)}case"variableAnchorOffsetCollection":{let l;for(let n of this.args){l=n.evaluate(t);let d=ti.parse(l);if(d)return d}throw new Be(`Could not parse variableAnchorOffsetCollection from value '${typeof l=="string"?l:JSON.stringify(l)}'`)}case"number":{let l=null;for(let n of this.args){if(l=n.evaluate(t),l===null)return 0;let d=Number(l);if(!isNaN(d))return d}throw new Be(`Could not convert ${JSON.stringify(l)} to number.`)}case"formatted":return Zl.fromString(jn(this.args[0].evaluate(t)));case"resolvedImage":return bi.fromString(jn(this.args[0].evaluate(t)));case"projectionDefinition":return this.args[0].evaluate(t);default:return jn(this.args[0].evaluate(t))}}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every((t=>t.outputDefined()))}}let pe=["Unknown","Point","LineString","Polygon"];class de{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache=new Map,this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?pe[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(t){let l=this._parseColorCache.get(t);return l||(l=me.parse(t),this._parseColorCache.set(t,l)),l}}class An{constructor(t,l,n=[],d,s=new Wl,b=[]){this.registry=t,this.path=n,this.key=n.map((Z=>`[${Z}]`)).join(""),this.scope=s,this.errors=b,this.expectedType=d,this._isConstant=l}parse(t,l,n,d,s={}){return l?this.concat(l,n,d)._parse(t,s):this._parse(t,s)}_parse(t,l){function n(d,s,b){return b==="assert"?new mi(s,[d]):b==="coerce"?new da(s,[d]):d}if(t!==null&&typeof t!="string"&&typeof t!="boolean"&&typeof t!="number"||(t=["literal",t]),Array.isArray(t)){if(t.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');let d=t[0];if(typeof d!="string")return this.error(`Expression name must be a string, but found ${typeof d} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;let s=this.registry[d];if(s){let b=s.parse(t,this);if(!b)return null;if(this.expectedType){let Z=this.expectedType,V=b.type;if(Z.kind!=="string"&&Z.kind!=="number"&&Z.kind!=="boolean"&&Z.kind!=="object"&&Z.kind!=="array"||V.kind!=="value"){if(Z.kind==="projectionDefinition"&&["string","array"].includes(V.kind)||["color","formatted","resolvedImage"].includes(Z.kind)&&["value","string"].includes(V.kind)||["padding","numberArray"].includes(Z.kind)&&["value","number","array"].includes(V.kind)||Z.kind==="colorArray"&&["value","string","array"].includes(V.kind)||Z.kind==="variableAnchorOffsetCollection"&&["value","array"].includes(V.kind))b=n(b,Z,l.typeAnnotation||"coerce");else if(this.checkSubtype(Z,V))return null}else b=n(b,Z,l.typeAnnotation||"assert")}if(!(b instanceof Da)&&b.type.kind!=="resolvedImage"&&this._isConstant(b)){let Z=new de;try{b=new Da(b.type,b.evaluate(Z))}catch(V){return this.error(V.message),null}}return b}return this.error(`Unknown expression "${d}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(t===void 0?"'undefined' value invalid. Use null instead.":typeof t=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof t} instead.`)}concat(t,l,n){let d=typeof t=="number"?this.path.concat(t):this.path,s=n?this.scope.concat(n):this.scope;return new An(this.registry,this._isConstant,d,l||null,s,this.errors)}error(t,...l){let n=`${this.key}${l.map((d=>`[${d}]`)).join("")}`;this.errors.push(new Xe(n,t))}checkSubtype(t,l){let n=aa(t,l);return n&&this.error(n),n}}class Ve{constructor(t,l){this.type=l.type,this.bindings=[].concat(t),this.result=l}evaluate(t){return this.result.evaluate(t)}eachChild(t){for(let l of this.bindings)t(l[1]);t(this.result)}static parse(t,l){if(t.length<4)return l.error(`Expected at least 3 arguments, but found ${t.length-1} instead.`);let n=[];for(let s=1;s<t.length-1;s+=2){let b=t[s];if(typeof b!="string")return l.error(`Expected string, but found ${typeof b} instead.`,s);if(/[^a-zA-Z0-9_]/.test(b))return l.error("Variable names must contain only alphanumeric characters or '_'.",s);let Z=l.parse(t[s+1],s+1);if(!Z)return null;n.push([b,Z])}let d=l.parse(t[t.length-1],t.length-1,l.expectedType,n);return d?new Ve(n,d):null}outputDefined(){return this.result.outputDefined()}}class wn{constructor(t,l){this.type=l.type,this.name=t,this.boundExpression=l}static parse(t,l){if(t.length!==2||typeof t[1]!="string")return l.error("'var' expression requires exactly one string literal argument.");let n=t[1];return l.scope.has(n)?new wn(n,l.scope.get(n)):l.error(`Unknown variable "${n}". Make sure "${n}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(t){return this.boundExpression.evaluate(t)}eachChild(){}outputDefined(){return!1}}class Hi{constructor(t,l,n){this.type=t,this.index=l,this.input=n}static parse(t,l){if(t.length!==3)return l.error(`Expected 2 arguments, but found ${t.length-1} instead.`);let n=l.parse(t[1],1,xt),d=l.parse(t[2],2,Ni(l.expectedType||Pt));return n&&d?new Hi(d.type.itemType,n,d):null}evaluate(t){let l=this.index.evaluate(t),n=this.input.evaluate(t);if(l<0)throw new Be(`Array index out of bounds: ${l} < 0.`);if(l>=n.length)throw new Be(`Array index out of bounds: ${l} > ${n.length-1}.`);if(l!==Math.floor(l))throw new Be(`Array index must be an integer, but found ${l} instead.`);return n[l]}eachChild(t){t(this.index),t(this.input)}outputDefined(){return!1}}class Fd{constructor(t,l){this.type=_t,this.needle=t,this.haystack=l}static parse(t,l){if(t.length!==3)return l.error(`Expected 2 arguments, but found ${t.length-1} instead.`);let n=l.parse(t[1],1,Pt),d=l.parse(t[2],2,Pt);return n&&d?Rd(n.type,[_t,jt,xt,Je,Pt])?new Fd(n,d):l.error(`Expected first argument to be of type boolean, string, number or null, but found ${ye(n.type)} instead`):null}evaluate(t){let l=this.needle.evaluate(t),n=this.haystack.evaluate(t);if(!n)return!1;if(!De(l,["boolean","string","number","null"]))throw new Be(`Expected first argument to be of type boolean, string, number or null, but found ${ye(je(l))} instead.`);if(!De(n,["string","array"]))throw new Be(`Expected second argument to be of type array or string, but found ${ye(je(n))} instead.`);return n.indexOf(l)>=0}eachChild(t){t(this.needle),t(this.haystack)}outputDefined(){return!0}}class on{constructor(t,l,n){this.type=xt,this.needle=t,this.haystack=l,this.fromIndex=n}static parse(t,l){if(t.length<=2||t.length>=5)return l.error(`Expected 2 or 3 arguments, but found ${t.length-1} instead.`);let n=l.parse(t[1],1,Pt),d=l.parse(t[2],2,Pt);if(!n||!d)return null;if(!Rd(n.type,[_t,jt,xt,Je,Pt]))return l.error(`Expected first argument to be of type boolean, string, number or null, but found ${ye(n.type)} instead`);if(t.length===4){let s=l.parse(t[3],3,xt);return s?new on(n,d,s):null}return new on(n,d)}evaluate(t){let l=this.needle.evaluate(t),n=this.haystack.evaluate(t);if(!De(l,["boolean","string","number","null"]))throw new Be(`Expected first argument to be of type boolean, string, number or null, but found ${ye(je(l))} instead.`);let d;if(this.fromIndex&&(d=this.fromIndex.evaluate(t)),De(n,["string"])){let s=n.indexOf(l,d);return s===-1?-1:[...n.slice(0,s)].length}if(De(n,["array"]))return n.indexOf(l,d);throw new Be(`Expected second argument to be of type array or string, but found ${ye(je(n))} instead.`)}eachChild(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)}outputDefined(){return!1}}class Nc{constructor(t,l,n,d,s,b){this.inputType=t,this.type=l,this.input=n,this.cases=d,this.outputs=s,this.otherwise=b}static parse(t,l){if(t.length<5)return l.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if(t.length%2!=1)return l.error("Expected an even number of arguments.");let n,d;l.expectedType&&l.expectedType.kind!=="value"&&(d=l.expectedType);let s={},b=[];for(let R=2;R<t.length-1;R+=2){let F=t[R],N=t[R+1];Array.isArray(F)||(F=[F]);let x=l.concat(R);if(F.length===0)return x.error("Expected at least one branch label.");for(let X of F){if(typeof X!="number"&&typeof X!="string")return x.error("Branch labels must be numbers or strings.");if(typeof X=="number"&&Math.abs(X)>Number.MAX_SAFE_INTEGER)return x.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof X=="number"&&Math.floor(X)!==X)return x.error("Numeric branch labels must be integer values.");if(n){if(x.checkSubtype(n,je(X)))return null}else n=je(X);if(s[String(X)]!==void 0)return x.error("Branch labels must be unique.");s[String(X)]=b.length}let T=l.parse(N,R,d);if(!T)return null;d=d||T.type,b.push(T)}let Z=l.parse(t[1],1,Pt);if(!Z)return null;let V=l.parse(t[t.length-1],t.length-1,d);return V?Z.type.kind!=="value"&&l.concat(1).checkSubtype(n,Z.type)?null:new Nc(n,d,Z,s,b,V):null}evaluate(t){let l=this.input.evaluate(t);return(je(l)===this.inputType&&this.outputs[this.cases[l]]||this.otherwise).evaluate(t)}eachChild(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)}outputDefined(){return this.outputs.every((t=>t.outputDefined()))&&this.otherwise.outputDefined()}}class Gd{constructor(t,l,n){this.type=t,this.branches=l,this.otherwise=n}static parse(t,l){if(t.length<4)return l.error(`Expected at least 3 arguments, but found only ${t.length-1}.`);if(t.length%2!=0)return l.error("Expected an odd number of arguments.");let n;l.expectedType&&l.expectedType.kind!=="value"&&(n=l.expectedType);let d=[];for(let b=1;b<t.length-1;b+=2){let Z=l.parse(t[b],b,_t);if(!Z)return null;let V=l.parse(t[b+1],b+1,n);if(!V)return null;d.push([Z,V]),n=n||V.type}let s=l.parse(t[t.length-1],t.length-1,n);if(!s)return null;if(!n)throw new Error("Can't infer output type");return new Gd(n,d,s)}evaluate(t){for(let[l,n]of this.branches)if(l.evaluate(t))return n.evaluate(t);return this.otherwise.evaluate(t)}eachChild(t){for(let[l,n]of this.branches)t(l),t(n);t(this.otherwise)}outputDefined(){return this.branches.every((([t,l])=>l.outputDefined()))&&this.otherwise.outputDefined()}}class Nd{constructor(t,l,n,d){this.type=t,this.input=l,this.beginIndex=n,this.endIndex=d}static parse(t,l){if(t.length<=2||t.length>=5)return l.error(`Expected 2 or 3 arguments, but found ${t.length-1} instead.`);let n=l.parse(t[1],1,Pt),d=l.parse(t[2],2,xt);if(!n||!d)return null;if(!Rd(n.type,[Ni(Pt),jt,Pt]))return l.error(`Expected first argument to be of type array or string, but found ${ye(n.type)} instead`);if(t.length===4){let s=l.parse(t[3],3,xt);return s?new Nd(n.type,n,d,s):null}return new Nd(n.type,n,d)}evaluate(t){let l=this.input.evaluate(t),n=this.beginIndex.evaluate(t),d;if(this.endIndex&&(d=this.endIndex.evaluate(t)),De(l,["string"]))return[...l].slice(n,d).join("");if(De(l,["array"]))return l.slice(n,d);throw new Be(`Expected first argument to be of type array or string, but found ${ye(je(l))} instead.`)}eachChild(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)}outputDefined(){return!1}}function Ic(i,t){let l=i.length-1,n,d,s=0,b=l,Z=0;for(;s<=b;)if(Z=Math.floor((s+b)/2),n=i[Z],d=i[Z+1],n<=t){if(Z===l||t<d)return Z;s=Z+1}else{if(!(n>t))throw new Be("Input is not a number.");b=Z-1}return 0}class vn{constructor(t,l,n){this.type=t,this.input=l,this.labels=[],this.outputs=[];for(let[d,s]of n)this.labels.push(d),this.outputs.push(s)}static parse(t,l){if(t.length-1<4)return l.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return l.error("Expected an even number of arguments.");let n=l.parse(t[1],1,xt);if(!n)return null;let d=[],s=null;l.expectedType&&l.expectedType.kind!=="value"&&(s=l.expectedType);for(let b=1;b<t.length;b+=2){let Z=b===1?-1/0:t[b],V=t[b+1],R=b,F=b+1;if(typeof Z!="number")return l.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',R);if(d.length&&d[d.length-1][0]>=Z)return l.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',R);let N=l.parse(V,F,s);if(!N)return null;s=s||N.type,d.push([Z,N])}return new vn(s,n,d)}evaluate(t){let l=this.labels,n=this.outputs;if(l.length===1)return n[0].evaluate(t);let d=this.input.evaluate(t);if(d<=l[0])return n[0].evaluate(t);let s=l.length;return d>=l[s-1]?n[s-1].evaluate(t):n[Ic(l,d)].evaluate(t)}eachChild(t){t(this.input);for(let l of this.outputs)t(l)}outputDefined(){return this.outputs.every((t=>t.outputDefined()))}}function Qr(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var ca,kl,Uc=(function(){if(kl)return ca;function i(t,l,n,d){this.cx=3*t,this.bx=3*(n-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*l,this.by=3*(d-l)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=l,this.p2x=n,this.p2y=d}return kl=1,ca=i,i.prototype={sampleCurveX:function(t){return((this.ax*t+this.bx)*t+this.cx)*t},sampleCurveY:function(t){return((this.ay*t+this.by)*t+this.cy)*t},sampleCurveDerivativeX:function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},solveCurveX:function(t,l){if(l===void 0&&(l=1e-6),t<0)return 0;if(t>1)return 1;for(var n=t,d=0;d<8;d++){var s=this.sampleCurveX(n)-t;if(Math.abs(s)<l)return n;var b=this.sampleCurveDerivativeX(n);if(Math.abs(b)<1e-6)break;n-=s/b}var Z=0,V=1;for(n=t,d=0;d<20&&(s=this.sampleCurveX(n),!(Math.abs(s-t)<l));d++)t>s?Z=n:V=n,n=.5*(V-Z)+Z;return n},solve:function(t,l){return this.sampleCurveY(this.solveCurveX(t,l))}},ca})(),kr=Qr(Uc);class Ll{constructor(t,l,n,d,s){this.type=t,this.operator=l,this.interpolation=n,this.input=d,this.labels=[],this.outputs=[];for(let[b,Z]of s)this.labels.push(b),this.outputs.push(Z)}static interpolationFactor(t,l,n,d){let s=0;if(t.name==="exponential")s=hl(l,t.base,n,d);else if(t.name==="linear")s=hl(l,1,n,d);else if(t.name==="cubic-bezier"){let b=t.controlPoints;s=new kr(b[0],b[1],b[2],b[3]).solve(hl(l,1,n,d))}return s}static parse(t,l){let[n,d,s,...b]=t;if(!Array.isArray(d)||d.length===0)return l.error("Expected an interpolation type expression.",1);if(d[0]==="linear")d={name:"linear"};else if(d[0]==="exponential"){let R=d[1];if(typeof R!="number")return l.error("Exponential interpolation requires a numeric base.",1,1);d={name:"exponential",base:R}}else{if(d[0]!=="cubic-bezier")return l.error(`Unknown interpolation type ${String(d[0])}`,1,0);{let R=d.slice(1);if(R.length!==4||R.some((F=>typeof F!="number"||F<0||F>1)))return l.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);d={name:"cubic-bezier",controlPoints:R}}}if(t.length-1<4)return l.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return l.error("Expected an even number of arguments.");if(s=l.parse(s,2,xt),!s)return null;let Z=[],V=null;n!=="interpolate-hcl"&&n!=="interpolate-lab"||l.expectedType==vi?l.expectedType&&l.expectedType.kind!=="value"&&(V=l.expectedType):V=ri;for(let R=0;R<b.length;R+=2){let F=b[R],N=b[R+1],x=R+3,T=R+4;if(typeof F!="number")return l.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',x);if(Z.length&&Z[Z.length-1][0]>=F)return l.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',x);let X=l.parse(N,T,V);if(!X)return null;V=V||X.type,Z.push([F,X])}return Aa(V,xt)||Aa(V,nn)||Aa(V,ri)||Aa(V,Qn)||Aa(V,dn)||Aa(V,vi)||Aa(V,Ln)||Aa(V,Ni(xt))?new Ll(V,n,d,s,Z):l.error(`Type ${ye(V)} is not interpolatable.`)}evaluate(t){let l=this.labels,n=this.outputs;if(l.length===1)return n[0].evaluate(t);let d=this.input.evaluate(t);if(d<=l[0])return n[0].evaluate(t);let s=l.length;if(d>=l[s-1])return n[s-1].evaluate(t);let b=Ic(l,d),Z=Ll.interpolationFactor(this.interpolation,d,l[b],l[b+1]),V=n[b].evaluate(t),R=n[b+1].evaluate(t);switch(this.operator){case"interpolate":switch(this.type.kind){case"number":return wa(V,R,Z);case"color":return me.interpolate(V,R,Z);case"padding":return wl.interpolate(V,R,Z);case"colorArray":return Gl.interpolate(V,R,Z);case"numberArray":return vl.interpolate(V,R,Z);case"variableAnchorOffsetCollection":return ti.interpolate(V,R,Z);case"array":return cn(V,R,Z);case"projectionDefinition":return Hl.interpolate(V,R,Z)}case"interpolate-hcl":switch(this.type.kind){case"color":return me.interpolate(V,R,Z,"hcl");case"colorArray":return Gl.interpolate(V,R,Z,"hcl")}case"interpolate-lab":switch(this.type.kind){case"color":return me.interpolate(V,R,Z,"lab");case"colorArray":return Gl.interpolate(V,R,Z,"lab")}}}eachChild(t){t(this.input);for(let l of this.outputs)t(l)}outputDefined(){return this.outputs.every((t=>t.outputDefined()))}}function hl(i,t,l,n){let d=n-l,s=i-l;return d===0?0:t===1?s/d:(Math.pow(t,s)-1)/(Math.pow(t,d)-1)}let Di={color:me.interpolate,number:wa,padding:wl.interpolate,numberArray:vl.interpolate,colorArray:Gl.interpolate,variableAnchorOffsetCollection:ti.interpolate,array:cn};class Hn{constructor(t,l){this.type=t,this.args=l}static parse(t,l){if(t.length<2)return l.error("Expected at least one argument.");let n=null,d=l.expectedType;d&&d.kind!=="value"&&(n=d);let s=[];for(let Z of t.slice(1)){let V=l.parse(Z,1+s.length,n,void 0,{typeAnnotation:"omit"});if(!V)return null;n=n||V.type,s.push(V)}if(!n)throw new Error("No output type");let b=d&&s.some((Z=>aa(d,Z.type)));return new Hn(b?Pt:n,s)}evaluate(t){let l,n=null,d=0;for(let s of this.args)if(d++,n=s.evaluate(t),n&&n instanceof bi&&!n.available&&(l||(l=n.name),n=null,d===this.args.length&&(n=l)),n!==null)break;return n}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every((t=>t.outputDefined()))}}function Oo(i,t){return i==="=="||i==="!="?t.kind==="boolean"||t.kind==="string"||t.kind==="number"||t.kind==="null"||t.kind==="value":t.kind==="string"||t.kind==="number"||t.kind==="value"}function Lr(i,t,l,n){return n.compare(t,l)===0}function Oi(i,t,l){let n=i!=="=="&&i!=="!=";return class qZ{constructor(s,b,Z){this.type=_t,this.lhs=s,this.rhs=b,this.collator=Z,this.hasUntypedArgument=s.type.kind==="value"||b.type.kind==="value"}static parse(s,b){if(s.length!==3&&s.length!==4)return b.error("Expected two or three arguments.");let Z=s[0],V=b.parse(s[1],1,Pt);if(!V)return null;if(!Oo(Z,V.type))return b.concat(1).error(`"${Z}" comparisons are not supported for type '${ye(V.type)}'.`);let R=b.parse(s[2],2,Pt);if(!R)return null;if(!Oo(Z,R.type))return b.concat(2).error(`"${Z}" comparisons are not supported for type '${ye(R.type)}'.`);if(V.type.kind!==R.type.kind&&V.type.kind!=="value"&&R.type.kind!=="value")return b.error(`Cannot compare types '${ye(V.type)}' and '${ye(R.type)}'.`);n&&(V.type.kind==="value"&&R.type.kind!=="value"?V=new mi(R.type,[V]):V.type.kind!=="value"&&R.type.kind==="value"&&(R=new mi(V.type,[R])));let F=null;if(s.length===4){if(V.type.kind!=="string"&&R.type.kind!=="string"&&V.type.kind!=="value"&&R.type.kind!=="value")return b.error("Cannot use collator to compare non-string types.");if(F=b.parse(s[3],3,Ga),!F)return null}return new qZ(V,R,F)}evaluate(s){let b=this.lhs.evaluate(s),Z=this.rhs.evaluate(s);if(n&&this.hasUntypedArgument){let V=je(b),R=je(Z);if(V.kind!==R.kind||V.kind!=="string"&&V.kind!=="number")throw new Be(`Expected arguments for "${i}" to be (string, string) or (number, number), but found (${V.kind}, ${R.kind}) instead.`)}if(this.collator&&!n&&this.hasUntypedArgument){let V=je(b),R=je(Z);if(V.kind!=="string"||R.kind!=="string")return t(s,b,Z)}return this.collator?l(s,b,Z,this.collator.evaluate(s)):t(s,b,Z)}eachChild(s){s(this.lhs),s(this.rhs),this.collator&&s(this.collator)}outputDefined(){return!0}}}let Mc=Oi("==",(function(i,t,l){return t===l}),Lr),fo=Oi("!=",(function(i,t,l){return t!==l}),(function(i,t,l,n){return!Lr(0,t,l,n)})),Qb=Oi("<",(function(i,t,l){return t<l}),(function(i,t,l,n){return n.compare(t,l)<0})),Er=Oi(">",(function(i,t,l){return t>l}),(function(i,t,l,n){return n.compare(t,l)>0})),Yc=Oi("<=",(function(i,t,l){return t<=l}),(function(i,t,l,n){return n.compare(t,l)<=0})),xc=Oi(">=",(function(i,t,l){return t>=l}),(function(i,t,l,n){return n.compare(t,l)>=0}));class Wi{constructor(t,l,n){this.type=Ga,this.locale=n,this.caseSensitive=t,this.diacriticSensitive=l}static parse(t,l){if(t.length!==2)return l.error("Expected one argument.");let n=t[1];if(typeof n!="object"||Array.isArray(n))return l.error("Collator options argument must be an object.");let d=l.parse(n["case-sensitive"]!==void 0&&n["case-sensitive"],1,_t);if(!d)return null;let s=l.parse(n["diacritic-sensitive"]!==void 0&&n["diacritic-sensitive"],1,_t);if(!s)return null;let b=null;return n.locale&&(b=l.parse(n.locale,1,jt),!b)?null:new Wi(d,s,b)}evaluate(t){return new yi(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)}eachChild(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)}outputDefined(){return!1}}class Tc{constructor(t,l,n,d,s){this.type=jt,this.number=t,this.locale=l,this.currency=n,this.minFractionDigits=d,this.maxFractionDigits=s}static parse(t,l){if(t.length!==3)return l.error("Expected two arguments.");let n=l.parse(t[1],1,xt);if(!n)return null;let d=t[2];if(typeof d!="object"||Array.isArray(d))return l.error("NumberFormat options argument must be an object.");let s=null;if(d.locale&&(s=l.parse(d.locale,1,jt),!s))return null;let b=null;if(d.currency&&(b=l.parse(d.currency,1,jt),!b))return null;let Z=null;if(d["min-fraction-digits"]&&(Z=l.parse(d["min-fraction-digits"],1,xt),!Z))return null;let V=null;return d["max-fraction-digits"]&&(V=l.parse(d["max-fraction-digits"],1,xt),!V)?null:new Tc(n,s,b,Z,V)}evaluate(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))}eachChild(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)}outputDefined(){return!1}}class sn{constructor(t){this.type=Cn,this.sections=t}static parse(t,l){if(t.length<2)return l.error("Expected at least one argument.");let n=t[1];if(!Array.isArray(n)&&typeof n=="object")return l.error("First argument must be an image or text section.");let d=[],s=!1;for(let b=1;b<=t.length-1;++b){let Z=t[b];if(s&&typeof Z=="object"&&!Array.isArray(Z)){s=!1;let V=null;if(Z["font-scale"]&&(V=l.parse(Z["font-scale"],1,xt),!V))return null;let R=null;if(Z["text-font"]&&(R=l.parse(Z["text-font"],1,Ni(jt)),!R))return null;let F=null;if(Z["text-color"]&&(F=l.parse(Z["text-color"],1,ri),!F))return null;let N=null;if(Z["vertical-align"]){if(typeof Z["vertical-align"]=="string"&&!he.includes(Z["vertical-align"]))return l.error(`'vertical-align' must be one of: 'bottom', 'center', 'top' but found '${Z["vertical-align"]}' instead.`);if(N=l.parse(Z["vertical-align"],1,jt),!N)return null}let x=d[d.length-1];x.scale=V,x.font=R,x.textColor=F,x.verticalAlign=N}else{let V=l.parse(t[b],1,Pt);if(!V)return null;let R=V.type.kind;if(R!=="string"&&R!=="value"&&R!=="null"&&R!=="resolvedImage")return l.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");s=!0,d.push({content:V,scale:null,font:null,textColor:null,verticalAlign:null})}}return new sn(d)}evaluate(t){return new Zl(this.sections.map((l=>{let n=l.content.evaluate(t);return je(n)===kn?new va("",n,null,null,null,l.verticalAlign?l.verticalAlign.evaluate(t):null):new va(jn(n),null,l.scale?l.scale.evaluate(t):null,l.font?l.font.evaluate(t).join(","):null,l.textColor?l.textColor.evaluate(t):null,l.verticalAlign?l.verticalAlign.evaluate(t):null)})))}eachChild(t){for(let l of this.sections)t(l.content),l.scale&&t(l.scale),l.font&&t(l.font),l.textColor&&t(l.textColor),l.verticalAlign&&t(l.verticalAlign)}outputDefined(){return!1}}class _o{constructor(t){this.type=kn,this.input=t}static parse(t,l){if(t.length!==2)return l.error("Expected two arguments.");let n=l.parse(t[1],1,jt);return n?new _o(n):l.error("No image name provided.")}evaluate(t){let l=this.input.evaluate(t),n=bi.fromString(l);return n&&t.availableImages&&(n.available=t.availableImages.indexOf(l)>-1),n}eachChild(t){t(this.input)}outputDefined(){return!1}}class Id{constructor(t){this.type=xt,this.input=t}static parse(t,l){if(t.length!==2)return l.error(`Expected 1 argument, but found ${t.length-1} instead.`);let n=l.parse(t[1],1);return n?n.type.kind!=="array"&&n.type.kind!=="string"&&n.type.kind!=="value"?l.error(`Expected argument of type string or array, but found ${ye(n.type)} instead.`):new Id(n):null}evaluate(t){let l=this.input.evaluate(t);if(typeof l=="string")return[...l].length;if(Array.isArray(l))return l.length;throw new Be(`Expected value to be of type string or array, but found ${ye(je(l))} instead.`)}eachChild(t){t(this.input)}outputDefined(){return!1}}let oa=8192;function kb(i,t){let l=(180+i[0])/360,n=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i[1]*Math.PI/360)))/360,d=Math.pow(2,t.z);return[Math.round(l*d*oa),Math.round(n*d*oa)]}function Ko(i,t){let l=Math.pow(2,t.z);return[(d=(i[0]/oa+t.x)/l,360*d-180),(n=(i[1]/oa+t.y)/l,360/Math.PI*Math.atan(Math.exp((180-360*n)*Math.PI/180))-90)];var n,d}function Ud(i,t){i[0]=Math.min(i[0],t[0]),i[1]=Math.min(i[1],t[1]),i[2]=Math.max(i[2],t[0]),i[3]=Math.max(i[3],t[1])}function Oa(i,t){return!(i[0]<=t[0]||i[2]>=t[2]||i[1]<=t[1]||i[3]>=t[3])}function Lb(i,t,l){let n=i[0]-t[0],d=i[1]-t[1],s=i[0]-l[0],b=i[1]-l[1];return n*b-s*d==0&&n*s<=0&&d*b<=0}function Md(i,t,l,n){return(d=[n[0]-l[0],n[1]-l[1]])[0]*(s=[t[0]-i[0],t[1]-i[1]])[1]-d[1]*s[0]!=0&&!(!wr(i,t,l,n)||!wr(l,n,i,t));var d,s}function zr(i,t,l){for(let n of l)for(let d=0;d<n.length-1;++d)if(Md(i,t,n[d],n[d+1]))return!0;return!1}function Dn(i,t,l=!1){let n=!1;for(let Z of t)for(let V=0;V<Z.length-1;V++){if(Lb(i,Z[V],Z[V+1]))return l;(s=Z[V])[1]>(d=i)[1]!=(b=Z[V+1])[1]>d[1]&&d[0]<(b[0]-s[0])*(d[1]-s[1])/(b[1]-s[1])+s[0]&&(n=!n)}var d,s,b;return n}function jr(i,t){for(let l of t)if(Dn(i,l))return!0;return!1}function Ar(i,t){for(let l of i)if(!Dn(l,t))return!1;for(let l=0;l<i.length-1;++l)if(zr(i[l],i[l+1],t))return!1;return!0}function Eb(i,t){for(let l of t)if(Ar(i,l))return!0;return!1}function wr(i,t,l,n){let d=n[0]-l[0],s=n[1]-l[1],b=(i[0]-l[0])*s-d*(i[1]-l[1]),Z=(t[0]-l[0])*s-d*(t[1]-l[1]);return b>0&&Z<0||b<0&&Z>0}function Po(i,t,l){let n=[];for(let d=0;d<i.length;d++){let s=[];for(let b=0;b<i[d].length;b++){let Z=kb(i[d][b],l);Ud(t,Z),s.push(Z)}n.push(s)}return n}function vr(i,t,l){let n=[];for(let d=0;d<i.length;d++){let s=Po(i[d],t,l);n.push(s)}return n}function qo(i,t,l,n){if(i[0]<l[0]||i[0]>l[2]){let d=.5*n,s=i[0]-l[0]>d?-n:l[0]-i[0]>d?n:0;s===0&&(s=i[0]-l[2]>d?-n:l[2]-i[0]>d?n:0),i[0]+=s}Ud(t,i)}function $o(i,t,l,n){let d=Math.pow(2,n.z)*oa,s=[n.x*oa,n.y*oa],b=[];for(let Z of i)for(let V of Z){let R=[V.x+s[0],V.y+s[1]];qo(R,t,l,d),b.push(R)}return b}function ts(i,t,l,n){let d=Math.pow(2,n.z)*oa,s=[n.x*oa,n.y*oa],b=[];for(let V of i){let R=[];for(let F of V){let N=[F.x+s[0],F.y+s[1]];Ud(t,N),R.push(N)}b.push(R)}if(t[2]-t[0]<=d/2){(Z=t)[0]=Z[1]=1/0,Z[2]=Z[3]=-1/0;for(let V of b)for(let R of V)qo(R,t,l,d)}var Z;return b}class rn{constructor(t,l){this.type=_t,this.geojson=t,this.geometries=l}static parse(t,l){if(t.length!==2)return l.error(`'within' expression requires exactly one argument, but found ${t.length-1} instead.`);if(Ha(t[1])){let n=t[1];if(n.type==="FeatureCollection"){let d=[];for(let s of n.features){let{type:b,coordinates:Z}=s.geometry;b==="Polygon"&&d.push(Z),b==="MultiPolygon"&&d.push(...Z)}if(d.length)return new rn(n,{type:"MultiPolygon",coordinates:d})}else if(n.type==="Feature"){let d=n.geometry.type;if(d==="Polygon"||d==="MultiPolygon")return new rn(n,n.geometry)}else if(n.type==="Polygon"||n.type==="MultiPolygon")return new rn(n,n)}return l.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return(function(l,n){let d=[1/0,1/0,-1/0,-1/0],s=[1/0,1/0,-1/0,-1/0],b=l.canonicalID();if(n.type==="Polygon"){let Z=Po(n.coordinates,s,b),V=$o(l.geometry(),d,s,b);if(!Oa(d,s))return!1;for(let R of V)if(!Dn(R,Z))return!1}if(n.type==="MultiPolygon"){let Z=vr(n.coordinates,s,b),V=$o(l.geometry(),d,s,b);if(!Oa(d,s))return!1;for(let R of V)if(!jr(R,Z))return!1}return!0})(t,this.geometries);if(t.geometryType()==="LineString")return(function(l,n){let d=[1/0,1/0,-1/0,-1/0],s=[1/0,1/0,-1/0,-1/0],b=l.canonicalID();if(n.type==="Polygon"){let Z=Po(n.coordinates,s,b),V=ts(l.geometry(),d,s,b);if(!Oa(d,s))return!1;for(let R of V)if(!Ar(R,Z))return!1}if(n.type==="MultiPolygon"){let Z=vr(n.coordinates,s,b),V=ts(l.geometry(),d,s,b);if(!Oa(d,s))return!1;for(let R of V)if(!Eb(R,Z))return!1}return!0})(t,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let Hr=class{constructor(i=[],t=(l,n)=>l<n?-1:l>n?1:0){if(this.data=i,this.length=this.data.length,this.compare=t,this.length>0)for(let l=(this.length>>1)-1;l>=0;l--)this._down(l)}push(i){this.data.push(i),this._up(this.length++)}pop(){if(this.length===0)return;let i=this.data[0],t=this.data.pop();return--this.length>0&&(this.data[0]=t,this._down(0)),i}peek(){return this.data[0]}_up(i){let{data:t,compare:l}=this,n=t[i];for(;i>0;){let d=i-1>>1,s=t[d];if(l(n,s)>=0)break;t[i]=s,i=d}t[i]=n}_down(i){let{data:t,compare:l}=this,n=this.length>>1,d=t[i];for(;i<n;){let s=1+(i<<1),b=s+1;if(b<this.length&&l(t[b],t[s])<0&&(s=b),l(t[s],d)>=0)break;t[i]=t[s],i=s}t[i]=d}};function Dr(i,t,l=0,n=i.length-1,d=Xc){for(;n>l;){if(n-l>600){let V=n-l+1,R=t-l+1,F=Math.log(V),N=.5*Math.exp(2*F/3),x=.5*Math.sqrt(F*N*(V-N)/V)*(R-V/2<0?-1:1);Dr(i,t,Math.max(l,Math.floor(t-R*N/V+x)),Math.min(n,Math.floor(t+(V-R)*N/V+x)),d)}let s=i[t],b=l,Z=n;for(Yd(i,l,t),d(i[n],s)>0&&Yd(i,l,n);b<Z;){for(Yd(i,b,Z),b++,Z--;d(i[b],s)<0;)b++;for(;d(i[Z],s)>0;)Z--}d(i[l],s)===0?Yd(i,l,Z):(Z++,Yd(i,Z,n)),Z<=t&&(l=Z+1),t<=Z&&(n=Z-1)}}function Yd(i,t,l){let n=i[t];i[t]=i[l],i[l]=n}function Xc(i,t){return i<t?-1:i>t?1:0}function xd(i,t){if(i.length<=1)return[i];let l=[],n,d;for(let s of i){let b=jb(s);b!==0&&(s.area=Math.abs(b),d===void 0&&(d=b<0),d===b<0?(n&&l.push(n),n=[s]):n.push(s))}if(n&&l.push(n),t>1)for(let s=0;s<l.length;s++)l[s].length<=t||(Dr(l[s],t,1,l[s].length-1,zb),l[s]=l[s].slice(0,t));return l}function zb(i,t){return t.area-i.area}function jb(i){let t=0;for(let l,n,d=0,s=i.length,b=s-1;d<s;b=d++)l=i[d],n=i[b],t+=(n.x-l.x)*(l.y+n.y);return t}let Or=1/298.257223563,Jc=Or*(2-Or),es=Math.PI/180;class ls{constructor(t){let l=6378.137*es*1e3,n=Math.cos(t*es),d=1/(1-Jc*(1-n*n)),s=Math.sqrt(d);this.kx=l*s*n,this.ky=l*s*d*(1-Jc)}distance(t,l){let n=this.wrap(t[0]-l[0])*this.kx,d=(t[1]-l[1])*this.ky;return Math.sqrt(n*n+d*d)}pointOnLine(t,l){let n,d,s,b,Z=1/0;for(let V=0;V<t.length-1;V++){let R=t[V][0],F=t[V][1],N=this.wrap(t[V+1][0]-R)*this.kx,x=(t[V+1][1]-F)*this.ky,T=0;N===0&&x===0||(T=(this.wrap(l[0]-R)*this.kx*N+(l[1]-F)*this.ky*x)/(N*N+x*x),T>1?(R=t[V+1][0],F=t[V+1][1]):T>0&&(R+=N/this.kx*T,F+=x/this.ky*T)),N=this.wrap(l[0]-R)*this.kx,x=(l[1]-F)*this.ky;let X=N*N+x*x;X<Z&&(Z=X,n=R,d=F,s=V,b=T)}return{point:[n,d],index:s,t:Math.max(0,Math.min(1,b))}}wrap(t){for(;t<-180;)t+=360;for(;t>180;)t-=360;return t}}function fr(i,t){return t[0]-i[0]}function Td(i){return i[1]-i[0]+1}function sa(i,t){return i[1]>=i[0]&&i[1]<t}function is(i,t){if(i[0]>i[1])return[null,null];let l=Td(i);if(t){if(l===2)return[i,null];let d=Math.floor(l/2);return[[i[0],i[0]+d],[i[0]+d,i[1]]]}if(l===1)return[i,null];let n=Math.floor(l/2)-1;return[[i[0],i[0]+n],[i[0]+n+1,i[1]]]}function as(i,t){if(!sa(t,i.length))return[1/0,1/0,-1/0,-1/0];let l=[1/0,1/0,-1/0,-1/0];for(let n=t[0];n<=t[1];++n)Ud(l,i[n]);return l}function ns(i){let t=[1/0,1/0,-1/0,-1/0];for(let l of i)for(let n of l)Ud(t,n);return t}function ds(i){return i[0]!==-1/0&&i[1]!==-1/0&&i[2]!==1/0&&i[3]!==1/0}function cs(i,t,l){if(!ds(i)||!ds(t))return NaN;let n=0,d=0;return i[2]<t[0]&&(n=t[0]-i[2]),i[0]>t[2]&&(n=i[0]-t[2]),i[1]>t[3]&&(d=i[1]-t[3]),i[3]<t[1]&&(d=t[1]-i[3]),l.distance([0,0],[n,d])}function bn(i,t,l){let n=l.pointOnLine(t,i);return l.distance(i,n.point)}function os(i,t,l,n,d){let s=Math.min(bn(i,[l,n],d),bn(t,[l,n],d)),b=Math.min(bn(l,[i,t],d),bn(n,[i,t],d));return Math.min(s,b)}function Ab(i,t,l,n,d){if(!sa(t,i.length)||!sa(n,l.length))return 1/0;let s=1/0;for(let b=t[0];b<t[1];++b){let Z=i[b],V=i[b+1];for(let R=n[0];R<n[1];++R){let F=l[R],N=l[R+1];if(Md(Z,V,F,N))return 0;s=Math.min(s,os(Z,V,F,N,d))}}return s}function Fe(i,t,l,n,d){if(!sa(t,i.length)||!sa(n,l.length))return NaN;let s=1/0;for(let b=t[0];b<=t[1];++b)for(let Z=n[0];Z<=n[1];++Z)if(s=Math.min(s,d.distance(i[b],l[Z])),s===0)return s;return s}function wb(i,t,l){if(Dn(i,t,!0))return 0;let n=1/0;for(let d of t){let s=d[0],b=d[d.length-1];if(s!==b&&(n=Math.min(n,bn(i,[b,s],l)),n===0))return n;let Z=l.pointOnLine(d,i);if(n=Math.min(n,l.distance(i,Z.point)),n===0)return n}return n}function vb(i,t,l,n){if(!sa(t,i.length))return NaN;for(let s=t[0];s<=t[1];++s)if(Dn(i[s],l,!0))return 0;let d=1/0;for(let s=t[0];s<t[1];++s){let b=i[s],Z=i[s+1];for(let V of l)for(let R=0,F=V.length,N=F-1;R<F;N=R++){let x=V[N],T=V[R];if(Md(b,Z,x,T))return 0;d=Math.min(d,os(b,Z,x,T,n))}}return d}function _r(i,t){for(let l of i)for(let n of l)if(Dn(n,t,!0))return!0;return!1}function Hb(i,t,l,n=1/0){let d=ns(i),s=ns(t);if(n!==1/0&&cs(d,s,l)>=n)return n;if(Oa(d,s)){if(_r(i,t))return 0}else if(_r(t,i))return 0;let b=1/0;for(let Z of i)for(let V=0,R=Z.length,F=R-1;V<R;F=V++){let N=Z[F],x=Z[V];for(let T of t)for(let X=0,B=T.length,C=B-1;X<B;C=X++){let z=T[C],f=T[X];if(Md(N,x,z,f))return 0;b=Math.min(b,os(N,x,z,f,l))}}return b}function Kr(i,t,l,n,d,s){if(!s)return;let b=cs(as(n,s),d,l);b<t&&i.push([b,s,[0,0]])}function yc(i,t,l,n,d,s,b){if(!s||!b)return;let Z=cs(as(n,s),as(d,b),l);Z<t&&i.push([Z,s,b])}function Bc(i,t,l,n,d=1/0){let s=Math.min(n.distance(i[0],l[0][0]),d);if(s===0)return s;let b=new Hr([[0,[0,i.length-1],[0,0]]],fr),Z=ns(l);for(;b.length>0;){let V=b.pop();if(V[0]>=s)continue;let R=V[1],F=t?50:100;if(Td(R)<=F){if(!sa(R,i.length))return NaN;if(t){let N=vb(i,R,l,n);if(isNaN(N)||N===0)return N;s=Math.min(s,N)}else for(let N=R[0];N<=R[1];++N){let x=wb(i[N],l,n);if(s=Math.min(s,x),s===0)return 0}}else{let N=is(R,t);Kr(b,s,n,i,Z,N[0]),Kr(b,s,n,i,Z,N[1])}}return s}function Sc(i,t,l,n,d,s=1/0){let b=Math.min(s,d.distance(i[0],l[0]));if(b===0)return b;let Z=new Hr([[0,[0,i.length-1],[0,l.length-1]]],fr);for(;Z.length>0;){let V=Z.pop();if(V[0]>=b)continue;let R=V[1],F=V[2],N=t?50:100,x=n?50:100;if(Td(R)<=N&&Td(F)<=x){if(!sa(R,i.length)&&sa(F,l.length))return NaN;let T;if(t&&n)T=Ab(i,R,l,F,d),b=Math.min(b,T);else if(t&&!n){let X=i.slice(R[0],R[1]+1);for(let B=F[0];B<=F[1];++B)if(T=bn(l[B],X,d),b=Math.min(b,T),b===0)return b}else if(!t&&n){let X=l.slice(F[0],F[1]+1);for(let B=R[0];B<=R[1];++B)if(T=bn(i[B],X,d),b=Math.min(b,T),b===0)return b}else T=Fe(i,R,l,F,d),b=Math.min(b,T)}else{let T=is(R,t),X=is(F,n);yc(Z,b,d,i,l,T[0],X[0]),yc(Z,b,d,i,l,T[0],X[1]),yc(Z,b,d,i,l,T[1],X[0]),yc(Z,b,d,i,l,T[1],X[1])}}return b}function ss(i){return i.type==="MultiPolygon"?i.coordinates.map((t=>({type:"Polygon",coordinates:t}))):i.type==="MultiLineString"?i.coordinates.map((t=>({type:"LineString",coordinates:t}))):i.type==="MultiPoint"?i.coordinates.map((t=>({type:"Point",coordinates:t}))):[i]}class mn{constructor(t,l){this.type=xt,this.geojson=t,this.geometries=l}static parse(t,l){if(t.length!==2)return l.error(`'distance' expression requires exactly one argument, but found ${t.length-1} instead.`);if(Ha(t[1])){let n=t[1];if(n.type==="FeatureCollection")return new mn(n,n.features.map((d=>ss(d.geometry))).flat());if(n.type==="Feature")return new mn(n,ss(n.geometry));if("type"in n&&"coordinates"in n)return new mn(n,ss(n))}return l.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return(function(l,n){let d=l.geometry(),s=d.flat().map((V=>Ko([V.x,V.y],l.canonical)));if(d.length===0)return NaN;let b=new ls(s[0][1]),Z=1/0;for(let V of n){switch(V.type){case"Point":Z=Math.min(Z,Sc(s,!1,[V.coordinates],!1,b,Z));break;case"LineString":Z=Math.min(Z,Sc(s,!1,V.coordinates,!0,b,Z));break;case"Polygon":Z=Math.min(Z,Bc(s,!1,V.coordinates,b,Z))}if(Z===0)return Z}return Z})(t,this.geometries);if(t.geometryType()==="LineString")return(function(l,n){let d=l.geometry(),s=d.flat().map((V=>Ko([V.x,V.y],l.canonical)));if(d.length===0)return NaN;let b=new ls(s[0][1]),Z=1/0;for(let V of n){switch(V.type){case"Point":Z=Math.min(Z,Sc(s,!0,[V.coordinates],!1,b,Z));break;case"LineString":Z=Math.min(Z,Sc(s,!0,V.coordinates,!0,b,Z));break;case"Polygon":Z=Math.min(Z,Bc(s,!0,V.coordinates,b,Z))}if(Z===0)return Z}return Z})(t,this.geometries);if(t.geometryType()==="Polygon")return(function(l,n){let d=l.geometry();if(d.length===0||d[0].length===0)return NaN;let s=xd(d,0).map((V=>V.map((R=>R.map((F=>Ko([F.x,F.y],l.canonical))))))),b=new ls(s[0][0][0][1]),Z=1/0;for(let V of n)for(let R of s){switch(V.type){case"Point":Z=Math.min(Z,Bc([V.coordinates],!1,R,b,Z));break;case"LineString":Z=Math.min(Z,Bc(V.coordinates,!0,R,b,Z));break;case"Polygon":Z=Math.min(Z,Hb(R,V.coordinates,b,Z))}if(Z===0)return Z}return Z})(t,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}class Xd{constructor(t){this.type=Pt,this.key=t}static parse(t,l){if(t.length!==2)return l.error(`Expected 1 argument, but found ${t.length-1} instead.`);let n=t[1];return n==null?l.error("Global state property must be defined."):typeof n!="string"?l.error(`Global state property must be string, but found ${typeof t[1]} instead.`):new Xd(n)}evaluate(t){var l;let n=(l=t.globals)===null||l===void 0?void 0:l.globalState;return n&&Object.keys(n).length!==0?Na(n,this.key):null}eachChild(){}outputDefined(){return!1}}let On={"==":Mc,"!=":fo,">":Er,"<":Qb,">=":xc,"<=":Yc,array:mi,at:Hi,boolean:mi,case:Gd,coalesce:Hn,collator:Wi,format:sn,image:_o,in:Fd,"index-of":on,interpolate:Ll,"interpolate-hcl":Ll,"interpolate-lab":Ll,length:Id,let:Ve,literal:Da,match:Nc,number:mi,"number-format":Tc,object:mi,slice:Nd,step:vn,string:mi,"to-boolean":da,"to-color":da,"to-number":da,"to-string":da,var:wn,within:rn,distance:mn,"global-state":Xd};class Bi{constructor(t,l,n,d){this.name=t,this.type=l,this._evaluate=n,this.args=d}evaluate(t){return this._evaluate(t,this.args)}eachChild(t){this.args.forEach(t)}outputDefined(){return!1}static parse(t,l){let n=t[0],d=Bi.definitions[n];if(!d)return l.error(`Unknown expression "${n}". If you wanted a literal array, use ["literal", [...]].`,0);let s=Array.isArray(d)?d[0]:d.type,b=Array.isArray(d)?[[d[1],d[2]]]:d.overloads,Z=b.filter((([R])=>!Array.isArray(R)||R.length===t.length-1)),V=null;for(let[R,F]of Z){V=new An(l.registry,Cc,l.path,null,l.scope);let N=[],x=!1;for(let T=1;T<t.length;T++){let X=t[T],B=Array.isArray(R)?R[T-1]:R.type,C=V.parse(X,1+N.length,B);if(!C){x=!0;break}N.push(C)}if(!x)if(Array.isArray(R)&&R.length!==N.length)V.error(`Expected ${R.length} arguments, but found ${N.length} instead.`);else{for(let T=0;T<N.length;T++){let X=Array.isArray(R)?R[T]:R.type,B=N[T];V.concat(T+1).checkSubtype(X,B.type)}if(V.errors.length===0)return new Bi(n,s,F,N)}}if(Z.length===1)l.errors.push(...V.errors);else{let R=(Z.length?Z:b).map((([N])=>{return x=N,Array.isArray(x)?`(${x.map(ye).join(", ")})`:`(${ye(x.type)}...)`;var x})).join(" | "),F=[];for(let N=1;N<t.length;N++){let x=l.parse(t[N],1+F.length);if(!x)return null;F.push(ye(x.type))}l.error(`Expected arguments of type ${R}, but found (${F.join(", ")}) instead.`)}return null}static register(t,l){Bi.definitions=l;for(let n in l)t[n]=Bi}}function Pr(i,[t,l,n,d]){t=t.evaluate(i),l=l.evaluate(i),n=n.evaluate(i);let s=d?d.evaluate(i):1,b=Cr(t,l,n,s);if(b)throw new Be(b);return new me(t/255,l/255,n/255,s,!1)}function qr(i,t){return i in t}function rs(i,t){let l=t[i];return l===void 0?null:l}function Wn(i){return{type:i}}function Cc(i){if(i instanceof wn)return Cc(i.boundExpression);if(i instanceof Bi&&i.name==="error"||i instanceof Wi||i instanceof rn||i instanceof mn||i instanceof Xd)return!1;let t=i instanceof da||i instanceof mi,l=!0;return i.eachChild((n=>{l=t?l&&Cc(n):l&&n instanceof Da})),!!l&&Qc(i)&&kc(i,["zoom","heatmap-density","elevation","line-progress","accumulated","is-supported-script"])}function Qc(i){if(i instanceof Bi&&(i.name==="get"&&i.args.length===1||i.name==="feature-state"||i.name==="has"&&i.args.length===1||i.name==="properties"||i.name==="geometry-type"||i.name==="id"||/^filter-/.test(i.name))||i instanceof rn||i instanceof mn)return!1;let t=!0;return i.eachChild((l=>{t&&!Qc(l)&&(t=!1)})),t}function Jd(i){if(i instanceof Bi&&i.name==="feature-state")return!1;let t=!0;return i.eachChild((l=>{t&&!Jd(l)&&(t=!1)})),t}function kc(i,t){if(i instanceof Bi&&t.indexOf(i.name)>=0)return!1;let l=!0;return i.eachChild((n=>{l&&!kc(n,t)&&(l=!1)})),l}function $r(i){return{result:"success",value:i}}function fn(i){return{result:"error",value:i}}function _n(i){return i["property-type"]==="data-driven"||i["property-type"]==="cross-faded-data-driven"}function t0(i){return!!i.expression&&i.expression.parameters.indexOf("zoom")>-1}function bs(i){return!!i.expression&&i.expression.interpolated}function We(i){return i instanceof Number?"number":i instanceof String?"string":i instanceof Boolean?"boolean":Array.isArray(i)?"array":i===null?"null":typeof i}function Lc(i){return typeof i=="object"&&i!==null&&!Array.isArray(i)&&je(i)===xl}function Db(i){return i}function e0(i,t){let l=i.stops&&typeof i.stops[0][0]=="object",n=l||!(l||i.property!==void 0),d=i.type||(bs(t)?"exponential":"interval"),s=(function(F){switch(F.type){case"color":return me.parse;case"padding":return wl.parse;case"numberArray":return vl.parse;case"colorArray":return Gl.parse;default:return null}})(t);if(s&&((i=ze({},i)).stops&&(i.stops=i.stops.map((F=>[F[0],s(F[1])]))),i.default=s(i.default?i.default:t.default)),i.colorSpace&&(b=i.colorSpace)!=="rgb"&&b!=="hcl"&&b!=="lab")throw new Error(`Unknown color space: "${i.colorSpace}"`);var b;let Z=(function(F){switch(F){case"exponential":return l0;case"interval":return Ob;case"categorical":return ms;case"identity":return fb;default:throw new Error(`Unknown function type "${F}"`)}})(d),V,R;if(d==="categorical"){V=Object.create(null);for(let F of i.stops)V[F[0]]=F[1];R=typeof i.stops[0][0]}if(l){let F={},N=[];for(let X=0;X<i.stops.length;X++){let B=i.stops[X],C=B[0].zoom;F[C]===void 0&&(F[C]={zoom:C,type:i.type,property:i.property,default:i.default,stops:[]},N.push(C)),F[C].stops.push([B[0].value,B[1]])}let x=[];for(let X of N)x.push([F[X].zoom,e0(F[X],t)]);let T={name:"linear"};return{kind:"composite",interpolationType:T,interpolationFactor:Ll.interpolationFactor.bind(void 0,T),zoomStops:x.map((X=>X[0])),evaluate:({zoom:X},B)=>l0({stops:x,base:i.base},t,X).evaluate(X,B)}}if(n){let F=d==="exponential"?{name:"exponential",base:i.base!==void 0?i.base:1}:null;return{kind:"camera",interpolationType:F,interpolationFactor:Ll.interpolationFactor.bind(void 0,F),zoomStops:i.stops.map((N=>N[0])),evaluate:({zoom:N})=>Z(i,t,N,V,R)}}return{kind:"source",evaluate(F,N){let x=N&&N.properties?N.properties[i.property]:void 0;return x===void 0?yd(i.default,t.default):Z(i,t,x,V,R)}}}function yd(i,t,l){return i!==void 0?i:t!==void 0?t:l!==void 0?l:void 0}function ms(i,t,l,n,d){return yd(typeof l===d?n[l]:void 0,i.default,t.default)}function Ob(i,t,l){if(We(l)!=="number")return yd(i.default,t.default);let n=i.stops.length;if(n===1||l<=i.stops[0][0])return i.stops[0][1];if(l>=i.stops[n-1][0])return i.stops[n-1][1];let d=Ic(i.stops.map((s=>s[0])),l);return i.stops[d][1]}function l0(i,t,l){let n=i.base!==void 0?i.base:1;if(We(l)!=="number")return yd(i.default,t.default);let d=i.stops.length;if(d===1||l<=i.stops[0][0])return i.stops[0][1];if(l>=i.stops[d-1][0])return i.stops[d-1][1];let s=Ic(i.stops.map((F=>F[0])),l),b=(function(F,N,x,T){let X=T-x,B=F-x;return X===0?0:N===1?B/X:(Math.pow(N,B)-1)/(Math.pow(N,X)-1)})(l,n,i.stops[s][0],i.stops[s+1][0]),Z=i.stops[s][1],V=i.stops[s+1][1],R=Di[t.type]||Db;return typeof Z.evaluate=="function"?{evaluate(...F){let N=Z.evaluate.apply(void 0,F),x=V.evaluate.apply(void 0,F);if(N!==void 0&&x!==void 0)return R(N,x,b,i.colorSpace)}}:R(Z,V,b,i.colorSpace)}function fb(i,t,l){switch(t.type){case"color":l=me.parse(l);break;case"formatted":l=Zl.fromString(l.toString());break;case"resolvedImage":l=bi.fromString(l.toString());break;case"padding":l=wl.parse(l);break;case"colorArray":l=Gl.parse(l);break;case"numberArray":l=vl.parse(l);break;default:We(l)===t.type||t.type==="enum"&&t.values[l]||(l=void 0)}return yd(l,i.default,t.default)}Bi.register(On,{error:[{kind:"error"},[jt],(i,[t])=>{throw new Be(t.evaluate(i))}],typeof:[jt,[Pt],(i,[t])=>ye(je(t.evaluate(i)))],"to-rgba":[Ni(xt,4),[ri],(i,[t])=>{let[l,n,d,s]=t.evaluate(i).rgb;return[255*l,255*n,255*d,s]}],rgb:[ri,[xt,xt,xt],Pr],rgba:[ri,[xt,xt,xt,xt],Pr],has:{type:_t,overloads:[[[jt],(i,[t])=>qr(t.evaluate(i),i.properties())],[[jt,xl],(i,[t,l])=>qr(t.evaluate(i),l.evaluate(i))]]},get:{type:Pt,overloads:[[[jt],(i,[t])=>rs(t.evaluate(i),i.properties())],[[jt,xl],(i,[t,l])=>rs(t.evaluate(i),l.evaluate(i))]]},"feature-state":[Pt,[jt],(i,[t])=>rs(t.evaluate(i),i.featureState||{})],properties:[xl,[],i=>i.properties()],"geometry-type":[jt,[],i=>i.geometryType()],id:[Pt,[],i=>i.id()],zoom:[xt,[],i=>i.globals.zoom],"heatmap-density":[xt,[],i=>i.globals.heatmapDensity||0],elevation:[xt,[],i=>i.globals.elevation||0],"line-progress":[xt,[],i=>i.globals.lineProgress||0],accumulated:[Pt,[],i=>i.globals.accumulated===void 0?null:i.globals.accumulated],"+":[xt,Wn(xt),(i,t)=>{let l=0;for(let n of t)l+=n.evaluate(i);return l}],"*":[xt,Wn(xt),(i,t)=>{let l=1;for(let n of t)l*=n.evaluate(i);return l}],"-":{type:xt,overloads:[[[xt,xt],(i,[t,l])=>t.evaluate(i)-l.evaluate(i)],[[xt],(i,[t])=>-t.evaluate(i)]]},"/":[xt,[xt,xt],(i,[t,l])=>t.evaluate(i)/l.evaluate(i)],"%":[xt,[xt,xt],(i,[t,l])=>t.evaluate(i)%l.evaluate(i)],ln2:[xt,[],()=>Math.LN2],pi:[xt,[],()=>Math.PI],e:[xt,[],()=>Math.E],"^":[xt,[xt,xt],(i,[t,l])=>Math.pow(t.evaluate(i),l.evaluate(i))],sqrt:[xt,[xt],(i,[t])=>Math.sqrt(t.evaluate(i))],log10:[xt,[xt],(i,[t])=>Math.log(t.evaluate(i))/Math.LN10],ln:[xt,[xt],(i,[t])=>Math.log(t.evaluate(i))],log2:[xt,[xt],(i,[t])=>Math.log(t.evaluate(i))/Math.LN2],sin:[xt,[xt],(i,[t])=>Math.sin(t.evaluate(i))],cos:[xt,[xt],(i,[t])=>Math.cos(t.evaluate(i))],tan:[xt,[xt],(i,[t])=>Math.tan(t.evaluate(i))],asin:[xt,[xt],(i,[t])=>Math.asin(t.evaluate(i))],acos:[xt,[xt],(i,[t])=>Math.acos(t.evaluate(i))],atan:[xt,[xt],(i,[t])=>Math.atan(t.evaluate(i))],min:[xt,Wn(xt),(i,t)=>Math.min(...t.map((l=>l.evaluate(i))))],max:[xt,Wn(xt),(i,t)=>Math.max(...t.map((l=>l.evaluate(i))))],abs:[xt,[xt],(i,[t])=>Math.abs(t.evaluate(i))],round:[xt,[xt],(i,[t])=>{let l=t.evaluate(i);return l<0?-Math.round(-l):Math.round(l)}],floor:[xt,[xt],(i,[t])=>Math.floor(t.evaluate(i))],ceil:[xt,[xt],(i,[t])=>Math.ceil(t.evaluate(i))],"filter-==":[_t,[jt,Pt],(i,[t,l])=>i.properties()[t.value]===l.value],"filter-id-==":[_t,[Pt],(i,[t])=>i.id()===t.value],"filter-type-==":[_t,[jt],(i,[t])=>i.geometryType()===t.value],"filter-<":[_t,[jt,Pt],(i,[t,l])=>{let n=i.properties()[t.value],d=l.value;return typeof n==typeof d&&n<d}],"filter-id-<":[_t,[Pt],(i,[t])=>{let l=i.id(),n=t.value;return typeof l==typeof n&&l<n}],"filter->":[_t,[jt,Pt],(i,[t,l])=>{let n=i.properties()[t.value],d=l.value;return typeof n==typeof d&&n>d}],"filter-id->":[_t,[Pt],(i,[t])=>{let l=i.id(),n=t.value;return typeof l==typeof n&&l>n}],"filter-<=":[_t,[jt,Pt],(i,[t,l])=>{let n=i.properties()[t.value],d=l.value;return typeof n==typeof d&&n<=d}],"filter-id-<=":[_t,[Pt],(i,[t])=>{let l=i.id(),n=t.value;return typeof l==typeof n&&l<=n}],"filter->=":[_t,[jt,Pt],(i,[t,l])=>{let n=i.properties()[t.value],d=l.value;return typeof n==typeof d&&n>=d}],"filter-id->=":[_t,[Pt],(i,[t])=>{let l=i.id(),n=t.value;return typeof l==typeof n&&l>=n}],"filter-has":[_t,[Pt],(i,[t])=>t.value in i.properties()],"filter-has-id":[_t,[],i=>i.id()!==null&&i.id()!==void 0],"filter-type-in":[_t,[Ni(jt)],(i,[t])=>t.value.indexOf(i.geometryType())>=0],"filter-id-in":[_t,[Ni(Pt)],(i,[t])=>t.value.indexOf(i.id())>=0],"filter-in-small":[_t,[jt,Ni(Pt)],(i,[t,l])=>l.value.indexOf(i.properties()[t.value])>=0],"filter-in-large":[_t,[jt,Ni(Pt)],(i,[t,l])=>(function(n,d,s,b){for(;s<=b;){let Z=s+b>>1;if(d[Z]===n)return!0;d[Z]>n?b=Z-1:s=Z+1}return!1})(i.properties()[t.value],l.value,0,l.value.length-1)],all:{type:_t,overloads:[[[_t,_t],(i,[t,l])=>t.evaluate(i)&&l.evaluate(i)],[Wn(_t),(i,t)=>{for(let l of t)if(!l.evaluate(i))return!1;return!0}]]},any:{type:_t,overloads:[[[_t,_t],(i,[t,l])=>t.evaluate(i)||l.evaluate(i)],[Wn(_t),(i,t)=>{for(let l of t)if(l.evaluate(i))return!0;return!1}]]},"!":[_t,[_t],(i,[t])=>!t.evaluate(i)],"is-supported-script":[_t,[jt],(i,[t])=>{let l=i.globals&&i.globals.isSupportedScript;return!l||l(t.evaluate(i))}],upcase:[jt,[jt],(i,[t])=>t.evaluate(i).toUpperCase()],downcase:[jt,[jt],(i,[t])=>t.evaluate(i).toLowerCase()],concat:[jt,Wn(Pt),(i,t)=>t.map((l=>jn(l.evaluate(i)))).join("")],"resolved-locale":[jt,[Ga],(i,[t])=>t.evaluate(i).resolvedLocale()]});class Ec{constructor(t,l,n){this.expression=t,this._warningHistory={},this._evaluator=new de,this._defaultValue=l?(function(d){if(d.type==="color"&&Lc(d.default))return new me(0,0,0,0);switch(d.type){case"color":return me.parse(d.default)||null;case"padding":return wl.parse(d.default)||null;case"numberArray":return vl.parse(d.default)||null;case"colorArray":return Gl.parse(d.default)||null;case"variableAnchorOffsetCollection":return ti.parse(d.default)||null;case"projectionDefinition":return Hl.parse(d.default)||null;default:return d.default===void 0?null:d.default}})(l):null,this._enumValues=l&&l.type==="enum"?l.values:null,this._globalState=n}evaluateWithoutErrorHandling(t,l,n,d,s,b){return this._globalState&&(t=Kn(t,this._globalState)),this._evaluator.globals=t,this._evaluator.feature=l,this._evaluator.featureState=n,this._evaluator.canonical=d,this._evaluator.availableImages=s||null,this._evaluator.formattedSection=b,this.expression.evaluate(this._evaluator)}evaluate(t,l,n,d,s,b){this._globalState&&(t=Kn(t,this._globalState)),this._evaluator.globals=t,this._evaluator.feature=l||null,this._evaluator.featureState=n||null,this._evaluator.canonical=d,this._evaluator.availableImages=s||null,this._evaluator.formattedSection=b||null;try{let Z=this.expression.evaluate(this._evaluator);if(Z==null||typeof Z=="number"&&Z!=Z)return this._defaultValue;if(this._enumValues&&!(Z in this._enumValues))throw new Be(`Expected value to be one of ${Object.keys(this._enumValues).map((V=>JSON.stringify(V))).join(", ")}, but found ${JSON.stringify(Z)} instead.`);return Z}catch(Z){return this._warningHistory[Z.message]||(this._warningHistory[Z.message]=!0,typeof console<"u"&&console.warn(Z.message)),this._defaultValue}}}function zc(i){return Array.isArray(i)&&i.length>0&&typeof i[0]=="string"&&i[0]in On}function jc(i,t,l){let n=new An(On,Cc,[],t?(function(s){let b={color:ri,string:jt,number:xt,enum:jt,boolean:_t,formatted:Cn,padding:Qn,numberArray:dn,colorArray:vi,projectionDefinition:nn,resolvedImage:kn,variableAnchorOffsetCollection:Ln};return s.type==="array"?Ni(b[s.value]||Pt,s.length):b[s.type]})(t):void 0),d=n.parse(i,void 0,void 0,void 0,t&&t.type==="string"?{typeAnnotation:"coerce"}:void 0);return d?$r(new Ec(d,t,l)):fn(n.errors)}class Zn{constructor(t,l,n){this.kind=t,this._styleExpression=l,this.isStateDependent=t!=="constant"&&!Jd(l.expression),this.globalStateRefs=Hc(l.expression),this._globalState=n}evaluateWithoutErrorHandling(t,l,n,d,s,b){return this._globalState&&(t=Kn(t,this._globalState)),this._styleExpression.evaluateWithoutErrorHandling(t,l,n,d,s,b)}evaluate(t,l,n,d,s,b){return this._globalState&&(t=Kn(t,this._globalState)),this._styleExpression.evaluate(t,l,n,d,s,b)}}class Ac{constructor(t,l,n,d,s){this.kind=t,this.zoomStops=n,this._styleExpression=l,this.isStateDependent=t!=="camera"&&!Jd(l.expression),this.globalStateRefs=Hc(l.expression),this.interpolationType=d,this._globalState=s}evaluateWithoutErrorHandling(t,l,n,d,s,b){return this._globalState&&(t=Kn(t,this._globalState)),this._styleExpression.evaluateWithoutErrorHandling(t,l,n,d,s,b)}evaluate(t,l,n,d,s,b){return this._globalState&&(t=Kn(t,this._globalState)),this._styleExpression.evaluate(t,l,n,d,s,b)}interpolationFactor(t,l,n){return this.interpolationType?Ll.interpolationFactor(this.interpolationType,t,l,n):0}}function i0(i,t,l){let n=jc(i,t,l);if(n.result==="error")return n;let d=n.value.expression,s=Qc(d);if(!s&&!_n(t))return fn([new Xe("","data expressions not supported")]);let b=kc(d,["zoom"]);if(!b&&!t0(t))return fn([new Xe("","zoom expressions not supported")]);let Z=vc(d);return Z||b?Z instanceof Xe?fn([Z]):Z instanceof Ll&&!bs(t)?fn([new Xe("",'"interpolate" expressions cannot be used with this property')]):$r(Z?new Ac(s?"camera":"composite",n.value,Z.labels,Z instanceof Ll?Z.interpolation:void 0,l):new Zn(s?"constant":"source",n.value,l)):fn([new Xe("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class wc{constructor(t,l){this._parameters=t,this._specification=l,ze(this,e0(this._parameters,this._specification))}static deserialize(t){return new wc(t._parameters,t._specification)}static serialize(t){return{_parameters:t._parameters,_specification:t._specification}}}function vc(i){let t=null;if(i instanceof Ve)t=vc(i.result);else if(i instanceof Hn){for(let l of i.args)if(t=vc(l),t)break}else(i instanceof vn||i instanceof Ll)&&i.input instanceof Bi&&i.input.name==="zoom"&&(t=i);return t instanceof Xe||i.eachChild((l=>{let n=vc(l);n instanceof Xe?t=n:!t&&n?t=new Xe("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):t&&n&&t!==n&&(t=new Xe("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))})),t}function Hc(i,t=new Set){return i instanceof Xd&&t.add(i.key),i.eachChild((l=>{Hc(l,t)})),t}function Kn(i,t){let{zoom:l,heatmapDensity:n,elevation:d,lineProgress:s,isSupportedScript:b,accumulated:Z}=i??{};return{zoom:l,heatmapDensity:n,elevation:d,lineProgress:s,isSupportedScript:b,accumulated:Z,globalState:t}}function Dc(i){if(i===!0||i===!1)return!0;if(!Array.isArray(i)||i.length===0)return!1;switch(i[0]){case"has":return i.length>=2&&i[1]!=="$id"&&i[1]!=="$type";case"in":return i.length>=3&&(typeof i[1]!="string"||Array.isArray(i[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return i.length!==3||Array.isArray(i[1])||Array.isArray(i[2]);case"any":case"all":for(let t of i.slice(1))if(!Dc(t)&&typeof t!="boolean")return!1;return!0;default:return!0}}let a0={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Bd(i,t){if(i==null)return{filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set};Dc(i)||(i=Sd(i));let l=jc(i,a0,t);if(l.result==="error")throw new Error(l.value.map((n=>`${n.key}: ${n.message}`)).join(", "));return{filter:(n,d,s)=>l.value.evaluate(n,d,{},s),needGeometry:Ws(i),getGlobalStateRefs:()=>Hc(l.value.expression)}}function _b(i,t){return i<t?-1:i>t?1:0}function Ws(i){if(!Array.isArray(i))return!1;if(i[0]==="within"||i[0]==="distance")return!0;for(let t=1;t<i.length;t++)if(Ws(i[t]))return!0;return!1}function Sd(i){if(!i)return!0;let t=i[0];return i.length<=1?t!=="any":t==="=="?Oc(i[1],i[2],"=="):t==="!="?fc(Oc(i[1],i[2],"==")):t==="<"||t===">"||t==="<="||t===">="?Oc(i[1],i[2],t):t==="any"?(l=i.slice(1),["any"].concat(l.map(Sd))):t==="all"?["all"].concat(i.slice(1).map(Sd)):t==="none"?["all"].concat(i.slice(1).map(Sd).map(fc)):t==="in"?n0(i[1],i.slice(2)):t==="!in"?fc(n0(i[1],i.slice(2))):t==="has"?d0(i[1]):t!=="!has"||fc(d0(i[1]));var l}function Oc(i,t,l){switch(i){case"$type":return[`filter-type-${l}`,t];case"$id":return[`filter-id-${l}`,t];default:return[`filter-${l}`,i,t]}}function n0(i,t){if(t.length===0)return!1;switch(i){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some((l=>typeof l!=typeof t[0]))?["filter-in-large",i,["literal",t.sort(_b)]]:["filter-in-small",i,["literal",t]]}}function d0(i){switch(i){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",i]}}function fc(i){return["!",i]}function Zs(i){let t=typeof i;if(t==="number"||t==="boolean"||t==="string"||i==null)return JSON.stringify(i);if(Array.isArray(i)){let d="[";for(let s of i)d+=`${Zs(s)},`;return`${d}]`}let l=Object.keys(i).sort(),n="{";for(let d=0;d<l.length;d++)n+=`${JSON.stringify(l[d])}:${Zs(i[l[d]])},`;return`${n}}`}function c0(i){let t="";for(let l of ot)t+=`/${Zs(i[l])}`;return t}function hs(i){let t=i.value;return t?[new Mt(i.key,t,"constants have been deprecated as of v8")]:[]}function Oe(i){return i instanceof Number||i instanceof String||i instanceof Boolean?i.valueOf():i}function Ia(i){if(Array.isArray(i))return i.map(Ia);if(i instanceof Object&&!(i instanceof Number||i instanceof String||i instanceof Boolean)){let t={};for(let l in i)t[l]=Ia(i[l]);return t}return Oe(i)}function Zi(i){let t=i.key,l=i.value,n=i.valueSpec||{},d=i.objectElementValidators||{},s=i.style,b=i.styleSpec,Z=i.validateSpec,V=[],R=We(l);if(R!=="object")return[new Mt(t,l,`object expected, ${R} found`)];for(let F in l){let N=F.split(".")[0],x=Na(n,N)||n["*"],T;if(Na(d,N))T=d[N];else if(Na(n,N))T=Z;else if(d["*"])T=d["*"];else{if(!n["*"]){V.push(new Mt(t,l[F],`unknown property "${F}"`));continue}T=Z}V=V.concat(T({key:(t&&`${t}.`)+F,value:l[F],valueSpec:x,style:s,styleSpec:b,object:l,objectKey:F,validateSpec:Z},l))}for(let F in n)d[F]||n[F].required&&n[F].default===void 0&&l[F]===void 0&&V.push(new Mt(t,l,`missing required property "${F}"`));return V}function Cd(i){let t=i.value,l=i.valueSpec,n=i.style,d=i.styleSpec,s=i.key,b=i.arrayElementValidator||i.validateSpec;if(We(t)!=="array")return[new Mt(s,t,`array expected, ${We(t)} found`)];if(l.length&&t.length!==l.length)return[new Mt(s,t,`array length ${l.length} expected, length ${t.length} found`)];if(l["min-length"]&&t.length<l["min-length"])return[new Mt(s,t,`array length at least ${l["min-length"]} expected, length ${t.length} found`)];let Z={type:l.value,values:l.values};d.$version<7&&(Z.function=l.function),We(l.value)==="object"&&(Z=l.value);let V=[];for(let R=0;R<t.length;R++)V=V.concat(b({array:t,arrayIndex:R,value:t[R],valueSpec:Z,validateSpec:i.validateSpec,style:n,styleSpec:d,key:`${s}[${R}]`}));return V}function hn(i){let t=i.key,l=i.value,n=i.valueSpec,d=We(l);return d==="number"&&l!=l&&(d="NaN"),d!=="number"?[new Mt(t,l,`number expected, ${d} found`)]:"minimum"in n&&l<n.minimum?[new Mt(t,l,`${l} is less than the minimum value ${n.minimum}`)]:"maximum"in n&&l>n.maximum?[new Mt(t,l,`${l} is greater than the maximum value ${n.maximum}`)]:[]}function o0(i){let t=i.valueSpec,l=Oe(i.value.type),n,d,s,b={},Z=l!=="categorical"&&i.value.property===void 0,V=!Z,R=We(i.value.stops)==="array"&&We(i.value.stops[0])==="array"&&We(i.value.stops[0][0])==="object",F=Zi({key:i.key,value:i.value,valueSpec:i.styleSpec.function,validateSpec:i.validateSpec,style:i.style,styleSpec:i.styleSpec,objectElementValidators:{stops:function(T){if(l==="identity")return[new Mt(T.key,T.value,'identity function may not have a "stops" property')];let X=[],B=T.value;return X=X.concat(Cd({key:T.key,value:B,valueSpec:T.valueSpec,validateSpec:T.validateSpec,style:T.style,styleSpec:T.styleSpec,arrayElementValidator:N})),We(B)==="array"&&B.length===0&&X.push(new Mt(T.key,B,"array must have at least one stop")),X},default:function(T){return T.validateSpec({key:T.key,value:T.value,valueSpec:t,validateSpec:T.validateSpec,style:T.style,styleSpec:T.styleSpec})}}});return l==="identity"&&Z&&F.push(new Mt(i.key,i.value,'missing required property "property"')),l==="identity"||i.value.stops||F.push(new Mt(i.key,i.value,'missing required property "stops"')),l==="exponential"&&i.valueSpec.expression&&!bs(i.valueSpec)&&F.push(new Mt(i.key,i.value,"exponential functions not supported")),i.styleSpec.$version>=8&&(V&&!_n(i.valueSpec)?F.push(new Mt(i.key,i.value,"property functions not supported")):Z&&!t0(i.valueSpec)&&F.push(new Mt(i.key,i.value,"zoom functions not supported"))),l!=="categorical"&&!R||i.value.property!==void 0||F.push(new Mt(i.key,i.value,'"property" property is required')),F;function N(T){let X=[],B=T.value,C=T.key;if(We(B)!=="array")return[new Mt(C,B,`array expected, ${We(B)} found`)];if(B.length!==2)return[new Mt(C,B,`array length 2 expected, length ${B.length} found`)];if(R){if(We(B[0])!=="object")return[new Mt(C,B,`object expected, ${We(B[0])} found`)];if(B[0].zoom===void 0)return[new Mt(C,B,"object stop key must have zoom")];if(B[0].value===void 0)return[new Mt(C,B,"object stop key must have value")];if(s&&s>Oe(B[0].zoom))return[new Mt(C,B[0].zoom,"stop zoom values must appear in ascending order")];Oe(B[0].zoom)!==s&&(s=Oe(B[0].zoom),d=void 0,b={}),X=X.concat(Zi({key:`${C}[0]`,value:B[0],valueSpec:{zoom:{}},validateSpec:T.validateSpec,style:T.style,styleSpec:T.styleSpec,objectElementValidators:{zoom:hn,value:x}}))}else X=X.concat(x({key:`${C}[0]`,value:B[0],validateSpec:T.validateSpec,style:T.style,styleSpec:T.styleSpec},B));return zc(Ia(B[1]))?X.concat([new Mt(`${C}[1]`,B[1],"expressions are not allowed in function stops.")]):X.concat(T.validateSpec({key:`${C}[1]`,value:B[1],valueSpec:t,validateSpec:T.validateSpec,style:T.style,styleSpec:T.styleSpec}))}function x(T,X){let B=We(T.value),C=Oe(T.value),z=T.value!==null?T.value:X;if(n){if(B!==n)return[new Mt(T.key,z,`${B} stop domain type must match previous stop domain type ${n}`)]}else n=B;if(B!=="number"&&B!=="string"&&B!=="boolean")return[new Mt(T.key,z,"stop domain value must be a number, string, or boolean")];if(B!=="number"&&l!=="categorical"){let f=`number expected, ${B} found`;return _n(t)&&l===void 0&&(f+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Mt(T.key,z,f)]}return l!=="categorical"||B!=="number"||isFinite(C)&&Math.floor(C)===C?l!=="categorical"&&B==="number"&&d!==void 0&&C<d?[new Mt(T.key,z,"stop domain values must appear in ascending order")]:(d=C,l==="categorical"&&C in b?[new Mt(T.key,z,"stop domain values must be unique")]:(b[C]=!0,[])):[new Mt(T.key,z,`integer expected, found ${C}`)]}}function Pn(i){let t=(i.expressionContext==="property"?i0:jc)(Ia(i.value),i.valueSpec);if(t.result==="error")return t.value.map((n=>new Mt(`${i.key}${n.key}`,i.value,n.message)));let l=t.value.expression||t.value._styleExpression.expression;if(i.expressionContext==="property"&&i.propertyKey==="text-font"&&!l.outputDefined())return[new Mt(i.key,i.value,`Invalid data expression for "${i.propertyKey}". Output values must be contained as literals within the expression.`)];if(i.expressionContext==="property"&&i.propertyType==="layout"&&!Jd(l))return[new Mt(i.key,i.value,'"feature-state" data expressions are not supported with layout properties.')];if(i.expressionContext==="filter"&&!Jd(l))return[new Mt(i.key,i.value,'"feature-state" data expressions are not supported with filters.')];if(i.expressionContext&&i.expressionContext.indexOf("cluster")===0){if(!kc(l,["zoom","feature-state"]))return[new Mt(i.key,i.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(i.expressionContext==="cluster-initial"&&!Qc(l))return[new Mt(i.key,i.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Vs(i){let t=i.key,l=i.value,n=We(l);return n!=="string"?[new Mt(t,l,`color expected, ${n} found`)]:me.parse(String(l))?[]:[new Mt(t,l,`color expected, "${l}" found`)]}function Qd(i){let t=i.key,l=i.value,n=i.valueSpec,d=[];return Array.isArray(n.values)?n.values.indexOf(Oe(l))===-1&&d.push(new Mt(t,l,`expected one of [${n.values.join(", ")}], ${JSON.stringify(l)} found`)):Object.keys(n.values).indexOf(Oe(l))===-1&&d.push(new Mt(t,l,`expected one of [${Object.keys(n.values).join(", ")}], ${JSON.stringify(l)} found`)),d}function ps(i){return Dc(Ia(i.value))?Pn(ze({},i,{expressionContext:"filter",valueSpec:{value:"boolean"}})):s0(i)}function s0(i){let t=i.value,l=i.key;if(We(t)!=="array")return[new Mt(l,t,`array expected, ${We(t)} found`)];let n=i.styleSpec,d,s=[];if(t.length<1)return[new Mt(l,t,"filter array must have at least 1 element")];switch(s=s.concat(Qd({key:`${l}[0]`,value:t[0],valueSpec:n.filter_operator,style:i.style,styleSpec:i.styleSpec})),Oe(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&Oe(t[1])==="$type"&&s.push(new Mt(l,t,`"$type" cannot be use with operator "${t[0]}"`));case"==":case"!=":t.length!==3&&s.push(new Mt(l,t,`filter array for operator "${t[0]}" must have 3 elements`));case"in":case"!in":t.length>=2&&(d=We(t[1]),d!=="string"&&s.push(new Mt(`${l}[1]`,t[1],`string expected, ${d} found`)));for(let b=2;b<t.length;b++)d=We(t[b]),Oe(t[1])==="$type"?s=s.concat(Qd({key:`${l}[${b}]`,value:t[b],valueSpec:n.geometry_type,style:i.style,styleSpec:i.styleSpec})):d!=="string"&&d!=="number"&&d!=="boolean"&&s.push(new Mt(`${l}[${b}]`,t[b],`string, number, or boolean expected, ${d} found`));break;case"any":case"all":case"none":for(let b=1;b<t.length;b++)s=s.concat(s0({key:`${l}[${b}]`,value:t[b],style:i.style,styleSpec:i.styleSpec}));break;case"has":case"!has":d=We(t[1]),t.length!==2?s.push(new Mt(l,t,`filter array for "${t[0]}" operator must have 2 elements`)):d!=="string"&&s.push(new Mt(`${l}[1]`,t[1],`string expected, ${d} found`))}return s}function gs(i,t){let l=i.key,n=i.validateSpec,d=i.style,s=i.styleSpec,b=i.value,Z=i.objectKey,V=s[`${t}_${i.layerType}`];if(!V)return[];let R=Z.match(/^(.*)-transition$/);if(t==="paint"&&R&&V[R[1]]&&V[R[1]].transition)return n({key:l,value:b,valueSpec:s.transition,style:d,styleSpec:s});let F=i.valueSpec||V[Z];if(!F)return[new Mt(l,b,`unknown property "${Z}"`)];let N;if(We(b)==="string"&&_n(F)&&!F.tokens&&(N=/^{([^}]+)}$/.exec(b)))return[new Mt(l,b,`"${Z}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(N[1])} }\`.`)];let x=[];return i.layerType==="symbol"&&Z==="text-font"&&Lc(Ia(b))&&Oe(b.type)==="identity"&&x.push(new Mt(l,b,'"text-font" does not support identity functions')),x.concat(n({key:i.key,value:b,valueSpec:F,style:d,styleSpec:s,expressionContext:"property",propertyType:t,propertyKey:Z}))}function Rs(i){return gs(i,"paint")}function kd(i){return gs(i,"layout")}function r0(i){let t=[],l=i.value,n=i.key,d=i.style,s=i.styleSpec;if(We(l)!=="object")return[new Mt(n,l,`object expected, ${We(l)} found`)];l.type||l.ref||t.push(new Mt(n,l,'either "type" or "ref" is required'));let b=Oe(l.type),Z=Oe(l.ref);if(l.id){let V=Oe(l.id);for(let R=0;R<i.arrayIndex;R++){let F=d.layers[R];Oe(F.id)===V&&t.push(new Mt(n,l.id,`duplicate layer id "${l.id}", previously used at line ${F.id.__line__}`))}}if("ref"in l){let V;["type","source","source-layer","filter","layout"].forEach((R=>{R in l&&t.push(new Mt(n,l[R],`"${R}" is prohibited for ref layers`))})),d.layers.forEach((R=>{Oe(R.id)===Z&&(V=R)})),V?V.ref?t.push(new Mt(n,l.ref,"ref cannot reference another ref layer")):b=Oe(V.type):t.push(new Mt(n,l.ref,`ref layer "${Z}" not found`))}else if(b!=="background")if(l.source){let V=d.sources&&d.sources[l.source],R=V&&Oe(V.type);V?R==="vector"&&b==="raster"?t.push(new Mt(n,l.source,`layer "${l.id}" requires a raster source`)):R!=="raster-dem"&&b==="hillshade"||R!=="raster-dem"&&b==="color-relief"?t.push(new Mt(n,l.source,`layer "${l.id}" requires a raster-dem source`)):R==="raster"&&b!=="raster"?t.push(new Mt(n,l.source,`layer "${l.id}" requires a vector source`)):R!=="vector"||l["source-layer"]?R==="raster-dem"&&b!=="hillshade"&&b!=="color-relief"?t.push(new Mt(n,l.source,"raster-dem source can only be used with layer type 'hillshade' or 'color-relief'.")):b!=="line"||!l.paint||!l.paint["line-gradient"]||R==="geojson"&&V.lineMetrics||t.push(new Mt(n,l,`layer "${l.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):t.push(new Mt(n,l,`layer "${l.id}" must specify a "source-layer"`)):t.push(new Mt(n,l.source,`source "${l.source}" not found`))}else t.push(new Mt(n,l,'missing required property "source"'));return t=t.concat(Zi({key:n,value:l,valueSpec:s.layer,style:i.style,styleSpec:i.styleSpec,validateSpec:i.validateSpec,objectElementValidators:{"*":()=>[],type:()=>i.validateSpec({key:`${n}.type`,value:l.type,valueSpec:s.layer.type,style:i.style,styleSpec:i.styleSpec,validateSpec:i.validateSpec,object:l,objectKey:"type"}),filter:ps,layout:V=>Zi({layer:l,key:V.key,value:V.value,style:V.style,styleSpec:V.styleSpec,validateSpec:V.validateSpec,objectElementValidators:{"*":R=>kd(ze({layerType:b},R))}}),paint:V=>Zi({layer:l,key:V.key,value:V.value,style:V.style,styleSpec:V.styleSpec,validateSpec:V.validateSpec,objectElementValidators:{"*":R=>Rs(ze({layerType:b},R))}})}})),t}function fa(i){let t=i.value,l=i.key,n=We(t);return n!=="string"?[new Mt(l,t,`string expected, ${n} found`)]:[]}let us={promoteId:function({key:i,value:t}){if(We(t)==="string")return fa({key:i,value:t});{let l=[];for(let n in t)l.push(...fa({key:`${i}.${n}`,value:t[n]}));return l}}};function b0(i){let t=i.value,l=i.key,n=i.styleSpec,d=i.style,s=i.validateSpec;if(!t.type)return[new Mt(l,t,'"type" is required')];let b=Oe(t.type),Z;switch(b){case"vector":case"raster":return Z=Zi({key:l,value:t,valueSpec:n[`source_${b.replace("-","_")}`],style:i.style,styleSpec:n,objectElementValidators:us,validateSpec:s}),Z;case"raster-dem":return Z=(function(V){var R;let F=(R=V.sourceName)!==null&&R!==void 0?R:"",N=V.value,x=V.styleSpec,T=x.source_raster_dem,X=V.style,B=[],C=We(N);if(N===void 0)return B;if(C!=="object")return B.push(new Mt("source_raster_dem",N,`object expected, ${C} found`)),B;let z=Oe(N.encoding)==="custom",f=["redFactor","greenFactor","blueFactor","baseShift"],A=V.value.encoding?`"${V.value.encoding}"`:"Default";for(let H in N)!z&&f.includes(H)?B.push(new Mt(H,N[H],`In "${F}": "${H}" is only valid when "encoding" is set to "custom". ${A} encoding found`)):T[H]?B=B.concat(V.validateSpec({key:H,value:N[H],valueSpec:T[H],validateSpec:V.validateSpec,style:X,styleSpec:x})):B.push(new Mt(H,N[H],`unknown property "${H}"`));return B})({sourceName:l,value:t,style:i.style,styleSpec:n,validateSpec:s}),Z;case"geojson":if(Z=Zi({key:l,value:t,valueSpec:n.source_geojson,style:d,styleSpec:n,validateSpec:s,objectElementValidators:us}),t.cluster)for(let V in t.clusterProperties){let[R,F]=t.clusterProperties[V],N=typeof R=="string"?[R,["accumulated"],["get",V]]:R;Z.push(...Pn({key:`${l}.${V}.map`,value:F,expressionContext:"cluster-map"})),Z.push(...Pn({key:`${l}.${V}.reduce`,value:N,expressionContext:"cluster-reduce"}))}return Z;case"video":return Zi({key:l,value:t,valueSpec:n.source_video,style:d,validateSpec:s,styleSpec:n});case"image":return Zi({key:l,value:t,valueSpec:n.source_image,style:d,validateSpec:s,styleSpec:n});case"canvas":return[new Mt(l,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Qd({key:`${l}.type`,value:t.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]}})}}function Fs(i){let t=i.value,l=i.styleSpec,n=l.light,d=i.style,s=[],b=We(t);if(t===void 0)return s;if(b!=="object")return s=s.concat([new Mt("light",t,`object expected, ${b} found`)]),s;for(let Z in t){let V=Z.match(/^(.*)-transition$/);s=s.concat(V&&n[V[1]]&&n[V[1]].transition?i.validateSpec({key:Z,value:t[Z],valueSpec:l.transition,validateSpec:i.validateSpec,style:d,styleSpec:l}):n[Z]?i.validateSpec({key:Z,value:t[Z],valueSpec:n[Z],validateSpec:i.validateSpec,style:d,styleSpec:l}):[new Mt(Z,t[Z],`unknown property "${Z}"`)])}return s}function Gs(i){let t=i.value,l=i.styleSpec,n=l.sky,d=i.style,s=We(t);if(t===void 0)return[];if(s!=="object")return[new Mt("sky",t,`object expected, ${s} found`)];let b=[];for(let Z in t)b=b.concat(n[Z]?i.validateSpec({key:Z,value:t[Z],valueSpec:n[Z],style:d,styleSpec:l}):[new Mt(Z,t[Z],`unknown property "${Z}"`)]);return b}function qn(i){let t=i.value,l=i.styleSpec,n=l.terrain,d=i.style,s=[],b=We(t);if(t===void 0)return s;if(b!=="object")return s=s.concat([new Mt("terrain",t,`object expected, ${b} found`)]),s;for(let Z in t)s=s.concat(n[Z]?i.validateSpec({key:Z,value:t[Z],valueSpec:n[Z],validateSpec:i.validateSpec,style:d,styleSpec:l}):[new Mt(Z,t[Z],`unknown property "${Z}"`)]);return s}function m0(i){let t=[],l=i.value,n=i.key;if(Array.isArray(l)){let d=[],s=[];for(let b in l)l[b].id&&d.includes(l[b].id)&&t.push(new Mt(n,l,`all the sprites' ids must be unique, but ${l[b].id} is duplicated`)),d.push(l[b].id),l[b].url&&s.includes(l[b].url)&&t.push(new Mt(n,l,`all the sprites' URLs must be unique, but ${l[b].url} is duplicated`)),s.push(l[b].url),t=t.concat(Zi({key:`${n}[${b}]`,value:l[b],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:i.validateSpec}));return t}return fa({key:n,value:l})}function W0(i){return t=i.value,t&&t.constructor===Object?[]:[new Mt(i.key,i.value,`object expected, ${We(i.value)} found`)];var t}let Z0={"*":()=>[],array:Cd,boolean:function(i){let t=i.value,l=i.key,n=We(t);return n!=="boolean"?[new Mt(l,t,`boolean expected, ${n} found`)]:[]},number:hn,color:Vs,constants:hs,enum:Qd,filter:ps,function:o0,layer:r0,object:Zi,source:b0,light:Fs,sky:Gs,terrain:qn,projection:function(i){let t=i.value,l=i.styleSpec,n=l.projection,d=i.style,s=We(t);if(t===void 0)return[];if(s!=="object")return[new Mt("projection",t,`object expected, ${s} found`)];let b=[];for(let Z in t)b=b.concat(n[Z]?i.validateSpec({key:Z,value:t[Z],valueSpec:n[Z],style:d,styleSpec:l}):[new Mt(Z,t[Z],`unknown property "${Z}"`)]);return b},projectionDefinition:function(i){let t=i.key,l=i.value;l=l instanceof String?l.valueOf():l;let n=We(l);return n!=="array"||(function(d){return Array.isArray(d)&&d.length===3&&typeof d[0]=="string"&&typeof d[1]=="string"&&typeof d[2]=="number"})(l)||(function(d){return!!["interpolate","step","literal"].includes(d[0])})(l)?["array","string"].includes(n)?[]:[new Mt(t,l,`projection expected, invalid type "${n}" found`)]:[new Mt(t,l,`projection expected, invalid array ${JSON.stringify(l)} found`)]},string:fa,formatted:function(i){return fa(i).length===0?[]:Pn(i)},resolvedImage:function(i){return fa(i).length===0?[]:Pn(i)},padding:function(i){let t=i.key,l=i.value;if(We(l)==="array"){if(l.length<1||l.length>4)return[new Mt(t,l,`padding requires 1 to 4 values; ${l.length} values found`)];let n={type:"number"},d=[];for(let s=0;s<l.length;s++)d=d.concat(i.validateSpec({key:`${t}[${s}]`,value:l[s],validateSpec:i.validateSpec,valueSpec:n}));return d}return hn({key:t,value:l,valueSpec:{}})},numberArray:function(i){let t=i.key,l=i.value;if(We(l)==="array"){let n={type:"number"};if(l.length<1)return[new Mt(t,l,"array length at least 1 expected, length 0 found")];let d=[];for(let s=0;s<l.length;s++)d=d.concat(i.validateSpec({key:`${t}[${s}]`,value:l[s],validateSpec:i.validateSpec,valueSpec:n}));return d}return hn({key:t,value:l,valueSpec:{}})},colorArray:function(i){let t=i.key,l=i.value;if(We(l)==="array"){if(l.length<1)return[new Mt(t,l,"array length at least 1 expected, length 0 found")];let n=[];for(let d=0;d<l.length;d++)n=n.concat(Vs({key:`${t}[${d}]`,value:l[d]}));return n}return Vs({key:t,value:l})},variableAnchorOffsetCollection:function(i){let t=i.key,l=i.value,n=We(l),d=i.styleSpec;if(n!=="array"||l.length<1||l.length%2!=0)return[new Mt(t,l,"variableAnchorOffsetCollection requires a non-empty array of even length")];let s=[];for(let b=0;b<l.length;b+=2)s=s.concat(Qd({key:`${t}[${b}]`,value:l[b],valueSpec:d.layout_symbol["text-anchor"]})),s=s.concat(Cd({key:`${t}[${b+1}]`,value:l[b+1],valueSpec:{length:2,value:"number"},validateSpec:i.validateSpec,style:i.style,styleSpec:d}));return s},sprite:m0,state:W0};function _c(i){let t=i.value,l=i.valueSpec,n=i.styleSpec;return i.validateSpec=_c,l.expression&&Lc(Oe(t))?o0(i):l.expression&&zc(Ia(t))?Pn(i):l.type&&Z0[l.type]?Z0[l.type](i):Zi(ze({},i,{valueSpec:l.type?n[l.type]:l}))}function h0(i){let t=i.value,l=i.key,n=fa(i);return n.length||(t.indexOf("{fontstack}")===-1&&n.push(new Mt(l,t,'"glyphs" url must include a "{fontstack}" token')),t.indexOf("{range}")===-1&&n.push(new Mt(l,t,'"glyphs" url must include a "{range}" token'))),n}function Si(i,t=D){let l=[];return l=l.concat(_c({key:"",value:i,valueSpec:t.$root,styleSpec:t,style:i,validateSpec:_c,objectElementValidators:{glyphs:h0,"*":()=>[]}})),i.constants&&(l=l.concat(hs({key:"constants",value:i.constants}))),$n(l)}function ei(i){return function(t){return i(Object.assign({},t,{validateSpec:_c}))}}function $n(i){return[].concat(i).sort(((t,l)=>t.line-l.line))}function qe(i){return function(...t){return $n(i.apply(this,t))}}Si.source=qe(ei(b0)),Si.sprite=qe(ei(m0)),Si.glyphs=qe(ei(h0)),Si.light=qe(ei(Fs)),Si.sky=qe(ei(Gs)),Si.terrain=qe(ei(qn)),Si.state=qe(ei(W0)),Si.layer=qe(ei(r0)),Si.filter=qe(ei(ps)),Si.paintProperty=qe(ei(Rs)),Si.layoutProperty=qe(ei(kd));let Ld=D,Vn=Si,Kb=Vn.light,Pb=Vn.sky,Ed=Vn.paintProperty,V0=Vn.layoutProperty;function Kc(i,t){let l=!1;if(t&&t.length)for(let n of t)i.fire(new $(new Error(n.message))),l=!0;return l}class zd{constructor(t,l,n){let d=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;let b=new Int32Array(this.arrayBuffer);t=b[0],this.d=(l=b[1])+2*(n=b[2]);for(let V=0;V<this.d*this.d;V++){let R=b[3+V],F=b[3+V+1];d.push(R===F?null:b.subarray(R,F))}let Z=b[3+d.length+1];this.keys=b.subarray(b[3+d.length],Z),this.bboxes=b.subarray(Z),this.insert=this._insertReadonly}else{this.d=l+2*n;for(let b=0;b<this.d*this.d;b++)d.push([]);this.keys=[],this.bboxes=[]}this.n=l,this.extent=t,this.padding=n,this.scale=l/t,this.uid=0;let s=n/l*t;this.min=-s,this.max=t+s}insert(t,l,n,d,s){this._forEachCell(l,n,d,s,this._insertCell,this.uid++,void 0,void 0),this.keys.push(t),this.bboxes.push(l),this.bboxes.push(n),this.bboxes.push(d),this.bboxes.push(s)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(t,l,n,d,s,b){this.cells[s].push(b)}query(t,l,n,d,s){let b=this.min,Z=this.max;if(t<=b&&l<=b&&Z<=n&&Z<=d&&!s)return Array.prototype.slice.call(this.keys);{let V=[];return this._forEachCell(t,l,n,d,this._queryCell,V,{},s),V}}_queryCell(t,l,n,d,s,b,Z,V){let R=this.cells[s];if(R!==null){let F=this.keys,N=this.bboxes;for(let x=0;x<R.length;x++){let T=R[x];if(Z[T]===void 0){let X=4*T;(V?V(N[X+0],N[X+1],N[X+2],N[X+3]):t<=N[X+2]&&l<=N[X+3]&&n>=N[X+0]&&d>=N[X+1])?(Z[T]=!0,b.push(F[T])):Z[T]=!1}}}}_forEachCell(t,l,n,d,s,b,Z,V){let R=this._convertToCellCoord(t),F=this._convertToCellCoord(l),N=this._convertToCellCoord(n),x=this._convertToCellCoord(d);for(let T=R;T<=N;T++)for(let X=F;X<=x;X++){let B=this.d*X+T;if((!V||V(this._convertFromCellCoord(T),this._convertFromCellCoord(X),this._convertFromCellCoord(T+1),this._convertFromCellCoord(X+1)))&&s.call(this,t,l,n,d,B,b,Z,V))return}}_convertFromCellCoord(t){return(t-this.padding)/this.scale}_convertToCellCoord(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;let t=this.cells,l=3+this.cells.length+1+1,n=0;for(let b=0;b<this.cells.length;b++)n+=this.cells[b].length;let d=new Int32Array(l+n+this.keys.length+this.bboxes.length);d[0]=this.extent,d[1]=this.n,d[2]=this.padding;let s=l;for(let b=0;b<t.length;b++){let Z=t[b];d[3+b]=s,d.set(Z,s),s+=Z.length}return d[3+t.length]=s,d.set(this.keys,s),s+=this.keys.length,d[3+t.length+1]=s,d.set(this.bboxes,s),s+=this.bboxes.length,d.buffer}static serialize(t,l){let n=t.toArrayBuffer();return l&&l.push(n),{buffer:n}}static deserialize(t){return new zd(t.buffer)}}let fi={};function Qt(i,t,l={}){if(fi[i])throw new Error(`${i} is already registered.`);Object.defineProperty(t,"_classRegistryKey",{value:i,writeable:!1}),fi[i]={klass:t,omit:l.omit||[],shallow:l.shallow||[]}}Qt("Object",Object),Qt("Set",Set),Qt("TransferableGridIndex",zd),Qt("Color",me),Qt("Error",Error),Qt("AJAXError",wi),Qt("ResolvedImage",bi),Qt("StylePropertyFunction",wc),Qt("StyleExpression",Ec,{omit:["_evaluator"]}),Qt("ZoomDependentExpression",Ac),Qt("ZoomConstantExpression",Zn),Qt("CompoundExpression",Bi,{omit:["_evaluate"]});for(let i in On)On[i]._classRegistryKey||Qt(`Expression_${i}`,On[i]);function td(i){return i&&typeof ArrayBuffer<"u"&&(i instanceof ArrayBuffer||i.constructor&&i.constructor.name==="ArrayBuffer")}function Ns(i){return i.$name||i.constructor._classRegistryKey}function p0(i){return!(function(t){if(t===null||typeof t!="object")return!1;let l=Ns(t);return!(!l||l==="Object")})(i)&&(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp||i instanceof Blob||i instanceof Error||td(i)||Ri(i)||ArrayBuffer.isView(i)||i instanceof ImageData)}function jd(i,t){if(p0(i))return(td(i)||Ri(i))&&t&&t.push(i),ArrayBuffer.isView(i)&&t&&t.push(i.buffer),i instanceof ImageData&&t&&t.push(i.data.buffer),i;if(Array.isArray(i)){let s=[];for(let b of i)s.push(jd(b,t));return s}if(typeof i!="object")throw new Error("can't serialize object of type "+typeof i);let l=Ns(i);if(!l)throw new Error(`can't serialize object of unregistered class ${i.constructor.name}`);if(!fi[l])throw new Error(`${l} is not registered.`);let{klass:n}=fi[l],d=n.serialize?n.serialize(i,t):{};if(n.serialize){if(t&&d===t[t.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(let s in i){if(!i.hasOwnProperty(s)||fi[l].omit.indexOf(s)>=0)continue;let b=i[s];d[s]=fi[l].shallow.indexOf(s)>=0?b:jd(b,t)}i instanceof Error&&(d.message=i.message)}if(d.$name)throw new Error("$name property is reserved for worker serialization logic.");return l!=="Object"&&(d.$name=l),d}function Ua(i){if(p0(i))return i;if(Array.isArray(i))return i.map(Ua);if(typeof i!="object")throw new Error("can't deserialize object of type "+typeof i);let t=Ns(i)||"Object";if(!fi[t])throw new Error(`can't deserialize unregistered class ${t}`);let{klass:l}=fi[t];if(!l)throw new Error(`can't deserialize unregistered class ${t}`);if(l.deserialize)return l.deserialize(i);let n=Object.create(l.prototype);for(let d of Object.keys(i)){if(d==="$name")continue;let s=i[d];n[d]=fi[t].shallow.indexOf(d)>=0?s:Ua(s)}return n}class Is{constructor(){this.first=!0}update(t,l){let n=Math.floor(t);return this.first?(this.first=!1,this.lastIntegerZoom=n,this.lastIntegerZoomTime=0,this.lastZoom=t,this.lastFloorZoom=n,!0):(this.lastFloorZoom>n?(this.lastIntegerZoom=n+1,this.lastIntegerZoomTime=l):this.lastFloorZoom<n&&(this.lastIntegerZoom=n,this.lastIntegerZoomTime=l),t!==this.lastZoom&&(this.lastZoom=t,this.lastFloorZoom=n,!0))}}function qb(i){return/[\u02EA\u02EB\u2E80-\u2FDF\u2FF0-\u303F\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FD-\u30FF\u3105-\u312F\u31A0-\u4DBF\u4E00-\uA48C\uA490-\uA4C6\uF900-\uFA6D\uFA70-\uFAD9\uFE10-\uFE1F\uFE30-\uFE4F\uFF00-\uFFEF]|\uD81B[\uDFE0-\uDFFF]|[\uD81C-\uD822\uD840-\uD868\uD86A-\uD86D\uD86F-\uD872\uD874-\uD879\uD880-\uD883\uD885-\uD88C][\uDC00-\uDFFF]|\uD823[\uDC00-\uDCD5\uDCFF-\uDD1E\uDD80-\uDDF2]|\uD82B[\uDFF0-\uDFFF]|\uD82C[\uDC00-\uDEFB]|\uD83C[\uDE00-\uDEFF]|\uD869[\uDC00-\uDEDF\uDF00-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEAD\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0\uDFF0-\uDFFF]|\uD87B[\uDC00-\uDE5D]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A\uDF50-\uDFFF]|\uD88D[\uDC00-\uDC79]/gim.test(String.fromCodePoint(i))}function ed(i){return/[\u02EA\u02EB\u1100-\u11FF\u1400-\u167F\u18B0-\u18F5\u2E80-\u2E99\u2E9B-\u2EF3\u2F00-\u2FD5\u2FF0-\u3007\u3012\u3013\u3020-\u302F\u3031-\u303F\u3041-\u3096\u309D-\u30FB\u30FD-\u30FF\u3105-\u312F\u3131-\u318E\u3190-\uA48C\uA490-\uA4C6\uA960-\uA97C\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFE10-\uFE1F\uFE30-\uFE48\uFE50-\uFE57\uFE5F-\uFE62\uFE67-\uFE6F\uFF00-\uFF07\uFF0A-\uFF0C\uFF0E-\uFF19\uFF1F-\uFF3A\uFF3C\uFF3E\uFF40-\uFF5A\uFFE0-\uFFE2\uFFE4-\uFFE7]|\uD802[\uDD80-\uDD9F]|\uD805[\uDD80-\uDDFF]|\uD806[\uDE00-\uDEBF]|\uD811[\uDC00-\uDE7F]|\uD81B[\uDFE0-\uDFE4\uDFF0-\uDFF6]|[\uD81C-\uD822\uD83D\uD840-\uD868\uD86A-\uD86D\uD86F-\uD872\uD874-\uD879\uD880-\uD883\uD885-\uD88C][\uDC00-\uDFFF]|\uD823[\uDC00-\uDCD5\uDCFF-\uDD1E\uDD80-\uDDF2]|\uD82B[\uDFF0-\uDFF3\uDFF5-\uDFFB\uDFFD\uDFFE]|\uD82C[\uDC00-\uDD22\uDD30-\uDEFB]|\uD833[\uDEC0-\uDFCF]|\uD834[\uDC00-\uDDFF\uDEE0-\uDF7F]|\uD836[\uDC00-\uDEAF]|\uD83C[\uDC00-\uDE00\uDF00-\uDFFF]|\uD83E[\uDD00-\uDEFF]|\uD869[\uDC00-\uDEDF\uDF00-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEAD\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0\uDFF0-\uDFFF]|\uD87B[\uDC00-\uDE5D]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A\uDF50-\uDFFF]|\uD88D[\uDC00-\uDC79]/gim.test(String.fromCodePoint(i))}function g0(i){return/\s/u.test(String.fromCodePoint(i))}function Ad(i){for(let t of i)if(ed(t.codePointAt(0)))return!0;return!1}function Pc(i){for(let t of i)if(!u0(t.codePointAt(0)))return!1;return!0}function Us(i){let t=i.map((l=>{try{return new RegExp(`\\p{sc=${l}}`,"u").source}catch{return null}})).filter((l=>l));return new RegExp(t.join("|"),"u")}let R0=Us(["Arab","Dupl","Mong","Ougr","Syrc"]);function u0(i){return!R0.test(String.fromCodePoint(i))}function Ms(i){return!(ed(i)||(t=i,/[\xA7\xA9\xAE\xB1\xBC-\xBE\xD7\xF7\u2016\u2020\u2021\u2030\u2031\u203B\u203C\u2042\u2047-\u2049\u2051\u2100-\u218F\u221E\u2234\u2235\u2300-\u2307\u230C-\u231F\u2324-\u2328\u232B\u237D-\u239A\u23BE-\u23CD\u23CF\u23D1-\u23DB\u23E2-\u2422\u2424-\u24FF\u25A0-\u2619\u2620-\u2767\u2776-\u2793\u2B12-\u2B2F\u2B50-\u2B59\u2BB8-\u2BEB\u3000-\u303F\u30A0-\u30FF\uE000-\uF8FF\uFE30-\uFE6F\uFF00-\uFFEF\uFFFC\uFFFD]|[\uDB80-\uDBFF][\uDC00-\uDFFF]/gim.test(String.fromCodePoint(t))));var t}let Ys=Us(["Adlm","Arab","Armi","Avst","Chrs","Cprt","Egyp","Elym","Gara","Hatr","Hebr","Hung","Khar","Lydi","Mand","Mani","Mend","Merc","Mero","Narb","Nbat","Nkoo","Orkh","Palm","Phli","Phlp","Phnx","Prti","Rohg","Samr","Sarb","Sogo","Syrc","Thaa","Todr","Yezi"]);function xs(i){return Ys.test(String.fromCodePoint(i))}function $b(i,t){return!(!t&&xs(i)||/[\u0900-\u0DFF\u0F00-\u109F\u1780-\u17FF]/gim.test(String.fromCodePoint(i)))}function F0(i){for(let t of i)if(xs(t.codePointAt(0)))return!0;return!1}let _a=new class{constructor(){this.TIMEOUT=5e3,this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null,this.loadScriptResolve=()=>{}}setState(i){this.pluginStatus=i.pluginStatus,this.pluginURL=i.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(i){if(_a.isParsed())throw new Error("RTL text plugin already registered.");this.applyArabicShaping=i.applyArabicShaping,this.processBidirectionalText=i.processBidirectionalText,this.processStyledBidirectionalText=i.processStyledBidirectionalText,this.loadScriptResolve()}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getRTLTextPluginStatus(){return this.pluginStatus}syncState(i,t){return o(this,void 0,void 0,(function*(){if(this.isParsed())return this.getState();if(i.pluginStatus!=="loading")return this.setState(i),i;let l=i.pluginURL,n=new Promise((s=>{this.loadScriptResolve=s}));t(l);let d=new Promise((s=>setTimeout((()=>s()),this.TIMEOUT)));if(yield Promise.race([n,d]),this.isParsed()){let s={pluginStatus:"loaded",pluginURL:l};return this.setState(s),s}throw this.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${l}`)}))}};class Ge{constructor(t,l){this.isSupportedScript=tm,this.zoom=t,l?(this.now=l.now||0,this.fadeDuration=l.fadeDuration||0,this.zoomHistory=l.zoomHistory||new Is,this.transition=l.transition||{}):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Is,this.transition={})}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){let t=this.zoom,l=t-Math.floor(t),n=this.crossFadingFactor();return t>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:l+(1-l)*n}:{fromScale:.5,toScale:1,t:1-(1-n)*l}}}function tm(i){return(function(t,l){for(let n of t)if(!$b(n.codePointAt(0),l))return!1;return!0})(i,_a.getRTLTextPluginStatus()==="loaded")}let wd="-transition";class vd{constructor(t,l,n){this.property=t,this.value=l,this.expression=(function(d,s,b){if(Lc(d))return new wc(d,s);if(zc(d)){let Z=i0(d,s,b);if(Z.result==="error")throw new Error(Z.value.map((V=>`${V.key}: ${V.message}`)).join(", "));return Z.value}{let Z=d;return s.type==="color"&&typeof d=="string"?Z=me.parse(d):s.type!=="padding"||typeof d!="number"&&!Array.isArray(d)?s.type!=="numberArray"||typeof d!="number"&&!Array.isArray(d)?s.type!=="colorArray"||typeof d!="string"&&!Array.isArray(d)?s.type==="variableAnchorOffsetCollection"&&Array.isArray(d)?Z=ti.parse(d):s.type==="projectionDefinition"&&typeof d=="string"&&(Z=Hl.parse(d)):Z=Gl.parse(d):Z=vl.parse(d):Z=wl.parse(d),{globalStateRefs:new Set,_globalState:null,kind:"constant",evaluate:()=>Z}}})(l===void 0?t.specification.default:l,t.specification,n)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}getGlobalStateRefs(){return this.expression.globalStateRefs||new Set}possiblyEvaluate(t,l,n){return this.property.possiblyEvaluate(this,t,l,n)}}class Ts{constructor(t,l){this.property=t,this.value=new vd(t,void 0,l)}transitioned(t,l){return new Xs(this.property,this.value,l,ll({},t.transition,this.transition),t.now)}untransitioned(){return new Xs(this.property,this.value,null,{},0)}}class G0{constructor(t,l){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues),this._globalState=l}getValue(t){return oi(this._values[t].value.value)}setValue(t,l){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new Ts(this._values[t].property,this._globalState)),this._values[t].value=new vd(this._values[t].property,l===null?void 0:oi(l),this._globalState)}getTransition(t){return oi(this._values[t].transition)}setTransition(t,l){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new Ts(this._values[t].property,this._globalState)),this._values[t].transition=oi(l)||void 0}serialize(){let t={};for(let l of Object.keys(this._values)){let n=this.getValue(l);n!==void 0&&(t[l]=n);let d=this.getTransition(l);d!==void 0&&(t[`${l}${wd}`]=d)}return t}transitioned(t,l){let n=new Js(this._properties);for(let d of Object.keys(this._values))n._values[d]=this._values[d].transitioned(t,l._values[d]);return n}untransitioned(){let t=new Js(this._properties);for(let l of Object.keys(this._values))t._values[l]=this._values[l].untransitioned();return t}}class Xs{constructor(t,l,n,d,s){this.property=t,this.value=l,this.begin=s+d.delay||0,this.end=this.begin+d.duration||0,t.specification.transition&&(d.delay||d.duration)&&(this.prior=n)}possiblyEvaluate(t,l,n){let d=t.now||0,s=this.value.possiblyEvaluate(t,l,n),b=this.prior;if(b){if(d>this.end)return this.prior=null,s;if(this.value.isDataDriven())return this.prior=null,s;if(d<this.begin)return b.possiblyEvaluate(t,l,n);{let Z=(d-this.begin)/(this.end-this.begin);return this.property.interpolate(b.possiblyEvaluate(t,l,n),s,Ea(Z))}}return s}}class Js{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)}possiblyEvaluate(t,l,n){let d=new pn(this._properties);for(let s of Object.keys(this._values))d._values[s]=this._values[s].possiblyEvaluate(t,l,n);return d}hasTransition(){for(let t of Object.keys(this._values))if(this._values[t].prior)return!0;return!1}}class N0{constructor(t,l){this._properties=t,this._values=Object.create(t.defaultPropertyValues),this._globalState=l}hasValue(t){return this._values[t].value!==void 0}getValue(t){return oi(this._values[t].value)}setValue(t,l){this._values[t]=new vd(this._values[t].property,l===null?void 0:oi(l),this._globalState)}serialize(){let t={};for(let l of Object.keys(this._values)){let n=this.getValue(l);n!==void 0&&(t[l]=n)}return t}possiblyEvaluate(t,l,n){let d=new pn(this._properties);for(let s of Object.keys(this._values))d._values[s]=this._values[s].possiblyEvaluate(t,l,n);return d}}class _i{constructor(t,l,n){this.property=t,this.value=l,this.parameters=n}isConstant(){return this.value.kind==="constant"}constantOr(t){return this.value.kind==="constant"?this.value.value:t}evaluate(t,l,n,d){return this.property.evaluate(this.value,this.parameters,t,l,n,d)}}class pn{constructor(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)}get(t){return this._values[t]}}class At{constructor(t){this.specification=t}possiblyEvaluate(t,l){if(t.isDataDriven())throw new Error("Value should not be data driven");return t.expression.evaluate(l)}interpolate(t,l,n){let d=Di[this.specification.type];return d?d(t,l,n):t}}class Dt{constructor(t,l){this.specification=t,this.overrides=l}possiblyEvaluate(t,l,n,d){return new _i(this,t.expression.kind==="constant"||t.expression.kind==="camera"?{kind:"constant",value:t.expression.evaluate(l,null,{},n,d)}:t.expression,l)}interpolate(t,l,n){if(t.value.kind!=="constant"||l.value.kind!=="constant")return t;if(t.value.value===void 0||l.value.value===void 0)return new _i(this,{kind:"constant",value:void 0},t.parameters);let d=Di[this.specification.type];if(d){let s=d(t.value.value,l.value.value,n);return new _i(this,{kind:"constant",value:s},t.parameters)}return t}evaluate(t,l,n,d,s,b){return t.kind==="constant"?t.value:t.evaluate(l,n,d,s,b)}}class Hd extends Dt{possiblyEvaluate(t,l,n,d){if(t.value===void 0)return new _i(this,{kind:"constant",value:void 0},l);if(t.expression.kind==="constant"){let s=t.expression.evaluate(l,null,{},n,d),b=t.property.specification.type==="resolvedImage"&&typeof s!="string"?s.name:s,Z=this._calculate(b,b,b,l);return new _i(this,{kind:"constant",value:Z},l)}if(t.expression.kind==="camera"){let s=this._calculate(t.expression.evaluate({zoom:l.zoom-1}),t.expression.evaluate({zoom:l.zoom}),t.expression.evaluate({zoom:l.zoom+1}),l);return new _i(this,{kind:"constant",value:s},l)}return new _i(this,t.expression,l)}evaluate(t,l,n,d,s,b){if(t.kind==="source"){let Z=t.evaluate(l,n,d,s,b);return this._calculate(Z,Z,Z,l)}return t.kind==="composite"?this._calculate(t.evaluate({zoom:Math.floor(l.zoom)-1},n,d),t.evaluate({zoom:Math.floor(l.zoom)},n,d),t.evaluate({zoom:Math.floor(l.zoom)+1},n,d),l):t.value}_calculate(t,l,n,d){return d.zoom>d.zoomHistory.lastIntegerZoom?{from:t,to:l}:{from:n,to:l}}interpolate(t){return t}}class I0{constructor(t){this.specification=t}possiblyEvaluate(t,l,n,d){if(t.value!==void 0){if(t.expression.kind==="constant"){let s=t.expression.evaluate(l,null,{},n,d);return this._calculate(s,s,s,l)}return this._calculate(t.expression.evaluate(new Ge(Math.floor(l.zoom-1),l)),t.expression.evaluate(new Ge(Math.floor(l.zoom),l)),t.expression.evaluate(new Ge(Math.floor(l.zoom+1),l)),l)}}_calculate(t,l,n,d){return d.zoom>d.zoomHistory.lastIntegerZoom?{from:t,to:l}:{from:n,to:l}}interpolate(t){return t}}class Dd{constructor(t){this.specification=t}possiblyEvaluate(t,l,n,d){return!!t.expression.evaluate(l,null,{},n,d)}interpolate(){return!1}}class Dl{constructor(t){this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(let l in t){let n=t[l];n.specification.overridable&&this.overridableProperties.push(l);let d=this.defaultPropertyValues[l]=new vd(n,void 0,void 0),s=this.defaultTransitionablePropertyValues[l]=new Ts(n,void 0);this.defaultTransitioningPropertyValues[l]=s.untransitioned(),this.defaultPossiblyEvaluatedValues[l]=d.possiblyEvaluate({})}}}Qt("DataDrivenProperty",Dt),Qt("DataConstantProperty",At),Qt("CrossFadedDataDrivenProperty",Hd),Qt("CrossFadedProperty",I0),Qt("ColorRampProperty",Dd);class Ci extends st{constructor(t,l,n){if(super(),this.id=t.id,this.type=t.type,this._globalState=n,this._featureFilter={filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set},t.type!=="custom"&&(this.metadata=t.metadata,this.minzoom=t.minzoom,this.maxzoom=t.maxzoom,t.type!=="background"&&(this.source=t.source,this.sourceLayer=t["source-layer"],this.filter=t.filter,this._featureFilter=Bd(t.filter,n)),l.layout&&(this._unevaluatedLayout=new N0(l.layout,n)),l.paint)){this._transitionablePaint=new G0(l.paint,n);for(let d in t.paint)this.setPaintProperty(d,t.paint[d],{validate:!1});for(let d in t.layout)this.setLayoutProperty(d,t.layout[d],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new pn(l.paint)}}setFilter(t){this.filter=t,this._featureFilter=Bd(t,this._globalState)}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(t){return t==="visibility"?this.visibility:this._unevaluatedLayout.getValue(t)}getLayoutAffectingGlobalStateRefs(){let t=new Set;if(this._unevaluatedLayout)for(let l in this._unevaluatedLayout._values){let n=this._unevaluatedLayout._values[l];for(let d of n.getGlobalStateRefs())t.add(d)}for(let l of this._featureFilter.getGlobalStateRefs())t.add(l);return t}getPaintAffectingGlobalStateRefs(){var t;let l=new globalThis.Map;if(this._transitionablePaint)for(let n in this._transitionablePaint._values){let d=this._transitionablePaint._values[n].value;for(let s of d.getGlobalStateRefs()){let b=(t=l.get(s))!==null&&t!==void 0?t:[];b.push({name:n,value:d.value}),l.set(s,b)}}return l}setLayoutProperty(t,l,n={}){l!=null&&this._validate(V0,`layers.${this.id}.layout.${t}`,t,l,n)||(t!=="visibility"?this._unevaluatedLayout.setValue(t,l):this.visibility=l)}getPaintProperty(t){return t.endsWith(wd)?this._transitionablePaint.getTransition(t.slice(0,-11)):this._transitionablePaint.getValue(t)}setPaintProperty(t,l,n={}){if(l!=null&&this._validate(Ed,`layers.${this.id}.paint.${t}`,t,l,n))return!1;if(t.endsWith(wd))return this._transitionablePaint.setTransition(t.slice(0,-11),l||void 0),!1;{let d=this._transitionablePaint._values[t],s=d.property.specification["property-type"]==="cross-faded-data-driven",b=d.value.isDataDriven(),Z=d.value;this._transitionablePaint.setValue(t,l),this._handleSpecialPaintPropertyUpdate(t);let V=this._transitionablePaint._values[t].value;return V.isDataDriven()||b||s||this._handleOverridablePaintPropertyUpdate(t,Z,V)}}_handleSpecialPaintPropertyUpdate(t){}_handleOverridablePaintPropertyUpdate(t,l,n){return!1}isHidden(t,l=!1){return!!(this.minzoom&&t<(l?Math.floor(this.minzoom):this.minzoom))||!!(this.maxzoom&&t>=this.maxzoom)||this.visibility==="none"}updateTransitions(t){this._transitioningPaint=this._transitionablePaint.transitioned(t,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(t,l){t.getCrossfadeParameters&&(this._crossfadeParameters=t.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(t,void 0,l)),this.paint=this._transitioningPaint.possiblyEvaluate(t,void 0,l)}serialize(){let t={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(t.layout=t.layout||{},t.layout.visibility=this.visibility),ji(t,((l,n)=>!(l===void 0||n==="layout"&&!Object.keys(l).length||n==="paint"&&!Object.keys(l).length)))}_validate(t,l,n,d,s={}){return(!s||s.validate!==!1)&&Kc(this,t.call(Vn,{key:l,layerType:this.type,objectKey:n,value:d,styleSpec:D,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(let t in this.paint._values){let l=this.paint.get(t);if(l instanceof _i&&_n(l.property.specification)&&(l.value.kind==="source"||l.value.kind==="composite")&&l.value.isStateDependent)return!0}return!1}}let U0;var em={get paint(){return U0=U0||new Dl({"raster-opacity":new At(D.paint_raster["raster-opacity"]),"raster-hue-rotate":new At(D.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new At(D.paint_raster["raster-brightness-min"]),"raster-brightness-max":new At(D.paint_raster["raster-brightness-max"]),"raster-saturation":new At(D.paint_raster["raster-saturation"]),"raster-contrast":new At(D.paint_raster["raster-contrast"]),"raster-resampling":new At(D.paint_raster["raster-resampling"]),"raster-fade-duration":new At(D.paint_raster["raster-fade-duration"])})}};class lm extends Ci{constructor(t,l){super(t,em,l)}}let im={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Od{constructor(t,l){this._structArray=t,this._pos1=l*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Ne{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(t,l){return t._trim(),l&&(t.isTransferred=!0,l.push(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}}static deserialize(t){let l=Object.create(this.prototype);return l.arrayBuffer=t.arrayBuffer,l.length=t.length,l.capacity=t.arrayBuffer.byteLength/l.bytesPerElement,l._refreshViews(),l}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(t){this.reserve(t),this.length=t}reserve(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);let l=this.uint8;this._refreshViews(),l&&this.uint8.set(l)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function il(i,t=1){let l=0,n=0;return{members:i.map((d=>{let s=im[d.type].BYTES_PER_ELEMENT,b=l=M0(l,Math.max(t,s)),Z=d.components||1;return n=Math.max(n,s),l+=s*Z,{name:d.name,type:d.type,components:Z,offset:b}})),size:M0(l,Math.max(n,t)),alignment:t}}function M0(i,t){return Math.ceil(i/t)*t}class fd extends Ne{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,l){let n=this.length;return this.resize(n+1),this.emplace(n,t,l)}emplace(t,l,n){let d=2*t;return this.int16[d+0]=l,this.int16[d+1]=n,t}}fd.prototype.bytesPerElement=4,Qt("StructArrayLayout2i4",fd);class _d extends Ne{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,l,n){let d=this.length;return this.resize(d+1),this.emplace(d,t,l,n)}emplace(t,l,n,d){let s=3*t;return this.int16[s+0]=l,this.int16[s+1]=n,this.int16[s+2]=d,t}}_d.prototype.bytesPerElement=6,Qt("StructArrayLayout3i6",_d);class ys extends Ne{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,l,n,d){let s=this.length;return this.resize(s+1),this.emplace(s,t,l,n,d)}emplace(t,l,n,d,s){let b=4*t;return this.int16[b+0]=l,this.int16[b+1]=n,this.int16[b+2]=d,this.int16[b+3]=s,t}}ys.prototype.bytesPerElement=8,Qt("StructArrayLayout4i8",ys);class Bs extends Ne{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,l,n,d,s,b){let Z=this.length;return this.resize(Z+1),this.emplace(Z,t,l,n,d,s,b)}emplace(t,l,n,d,s,b,Z){let V=6*t;return this.int16[V+0]=l,this.int16[V+1]=n,this.int16[V+2]=d,this.int16[V+3]=s,this.int16[V+4]=b,this.int16[V+5]=Z,t}}Bs.prototype.bytesPerElement=12,Qt("StructArrayLayout2i4i12",Bs);class Ma extends Ne{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,l,n,d,s,b){let Z=this.length;return this.resize(Z+1),this.emplace(Z,t,l,n,d,s,b)}emplace(t,l,n,d,s,b,Z){let V=4*t,R=8*t;return this.int16[V+0]=l,this.int16[V+1]=n,this.uint8[R+4]=d,this.uint8[R+5]=s,this.uint8[R+6]=b,this.uint8[R+7]=Z,t}}Ma.prototype.bytesPerElement=8,Qt("StructArrayLayout2i4ub8",Ma);class ld extends Ne{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,l){let n=this.length;return this.resize(n+1),this.emplace(n,t,l)}emplace(t,l,n){let d=2*t;return this.float32[d+0]=l,this.float32[d+1]=n,t}}ld.prototype.bytesPerElement=8,Qt("StructArrayLayout2f8",ld);class Kd extends Ne{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,l,n,d,s,b,Z,V,R,F){let N=this.length;return this.resize(N+1),this.emplace(N,t,l,n,d,s,b,Z,V,R,F)}emplace(t,l,n,d,s,b,Z,V,R,F,N){let x=10*t;return this.uint16[x+0]=l,this.uint16[x+1]=n,this.uint16[x+2]=d,this.uint16[x+3]=s,this.uint16[x+4]=b,this.uint16[x+5]=Z,this.uint16[x+6]=V,this.uint16[x+7]=R,this.uint16[x+8]=F,this.uint16[x+9]=N,t}}Kd.prototype.bytesPerElement=20,Qt("StructArrayLayout10ui20",Kd);class qc extends Ne{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,l,n,d,s,b,Z,V){let R=this.length;return this.resize(R+1),this.emplace(R,t,l,n,d,s,b,Z,V)}emplace(t,l,n,d,s,b,Z,V,R){let F=8*t;return this.uint16[F+0]=l,this.uint16[F+1]=n,this.uint16[F+2]=d,this.uint16[F+3]=s,this.uint16[F+4]=b,this.uint16[F+5]=Z,this.uint16[F+6]=V,this.uint16[F+7]=R,t}}qc.prototype.bytesPerElement=16,Qt("StructArrayLayout8ui16",qc);class Pd extends Ne{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,l,n,d,s,b,Z,V,R,F,N,x){let T=this.length;return this.resize(T+1),this.emplace(T,t,l,n,d,s,b,Z,V,R,F,N,x)}emplace(t,l,n,d,s,b,Z,V,R,F,N,x,T){let X=12*t;return this.int16[X+0]=l,this.int16[X+1]=n,this.int16[X+2]=d,this.int16[X+3]=s,this.uint16[X+4]=b,this.uint16[X+5]=Z,this.uint16[X+6]=V,this.uint16[X+7]=R,this.int16[X+8]=F,this.int16[X+9]=N,this.int16[X+10]=x,this.int16[X+11]=T,t}}Pd.prototype.bytesPerElement=24,Qt("StructArrayLayout4i4ui4i24",Pd);class Ss extends Ne{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,l,n){let d=this.length;return this.resize(d+1),this.emplace(d,t,l,n)}emplace(t,l,n,d){let s=3*t;return this.float32[s+0]=l,this.float32[s+1]=n,this.float32[s+2]=d,t}}Ss.prototype.bytesPerElement=12,Qt("StructArrayLayout3f12",Ss);class id extends Ne{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t){let l=this.length;return this.resize(l+1),this.emplace(l,t)}emplace(t,l){return this.uint32[1*t+0]=l,t}}id.prototype.bytesPerElement=4,Qt("StructArrayLayout1ul4",id);class gn extends Ne{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,l,n,d,s,b,Z,V,R){let F=this.length;return this.resize(F+1),this.emplace(F,t,l,n,d,s,b,Z,V,R)}emplace(t,l,n,d,s,b,Z,V,R,F){let N=10*t,x=5*t;return this.int16[N+0]=l,this.int16[N+1]=n,this.int16[N+2]=d,this.int16[N+3]=s,this.int16[N+4]=b,this.int16[N+5]=Z,this.uint32[x+3]=V,this.uint16[N+8]=R,this.uint16[N+9]=F,t}}gn.prototype.bytesPerElement=20,Qt("StructArrayLayout6i1ul2ui20",gn);class Cs extends Ne{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,l,n,d,s,b){let Z=this.length;return this.resize(Z+1),this.emplace(Z,t,l,n,d,s,b)}emplace(t,l,n,d,s,b,Z){let V=6*t;return this.int16[V+0]=l,this.int16[V+1]=n,this.int16[V+2]=d,this.int16[V+3]=s,this.int16[V+4]=b,this.int16[V+5]=Z,t}}Cs.prototype.bytesPerElement=12,Qt("StructArrayLayout2i2i2i12",Cs);class $c extends Ne{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,l,n,d,s){let b=this.length;return this.resize(b+1),this.emplace(b,t,l,n,d,s)}emplace(t,l,n,d,s,b){let Z=4*t,V=8*t;return this.float32[Z+0]=l,this.float32[Z+1]=n,this.float32[Z+2]=d,this.int16[V+6]=s,this.int16[V+7]=b,t}}$c.prototype.bytesPerElement=16,Qt("StructArrayLayout2f1f2i16",$c);class Rn extends Ne{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,l,n,d,s,b){let Z=this.length;return this.resize(Z+1),this.emplace(Z,t,l,n,d,s,b)}emplace(t,l,n,d,s,b,Z){let V=16*t,R=4*t,F=8*t;return this.uint8[V+0]=l,this.uint8[V+1]=n,this.float32[R+1]=d,this.float32[R+2]=s,this.int16[F+6]=b,this.int16[F+7]=Z,t}}Rn.prototype.bytesPerElement=16,Qt("StructArrayLayout2ub2f2i16",Rn);class to extends Ne{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,l,n){let d=this.length;return this.resize(d+1),this.emplace(d,t,l,n)}emplace(t,l,n,d){let s=3*t;return this.uint16[s+0]=l,this.uint16[s+1]=n,this.uint16[s+2]=d,t}}to.prototype.bytesPerElement=6,Qt("StructArrayLayout3ui6",to);class Qs extends Ne{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,l,n,d,s,b,Z,V,R,F,N,x,T,X,B,C,z){let f=this.length;return this.resize(f+1),this.emplace(f,t,l,n,d,s,b,Z,V,R,F,N,x,T,X,B,C,z)}emplace(t,l,n,d,s,b,Z,V,R,F,N,x,T,X,B,C,z,f){let A=24*t,H=12*t,at=48*t;return this.int16[A+0]=l,this.int16[A+1]=n,this.uint16[A+2]=d,this.uint16[A+3]=s,this.uint32[H+2]=b,this.uint32[H+3]=Z,this.uint32[H+4]=V,this.uint16[A+10]=R,this.uint16[A+11]=F,this.uint16[A+12]=N,this.float32[H+7]=x,this.float32[H+8]=T,this.uint8[at+36]=X,this.uint8[at+37]=B,this.uint8[at+38]=C,this.uint32[H+10]=z,this.int16[A+22]=f,t}}Qs.prototype.bytesPerElement=48,Qt("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",Qs);class eo extends Ne{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,l,n,d,s,b,Z,V,R,F,N,x,T,X,B,C,z,f,A,H,at,dt,Wt,Nt,Rt,It,St,Tt){let Xt=this.length;return this.resize(Xt+1),this.emplace(Xt,t,l,n,d,s,b,Z,V,R,F,N,x,T,X,B,C,z,f,A,H,at,dt,Wt,Nt,Rt,It,St,Tt)}emplace(t,l,n,d,s,b,Z,V,R,F,N,x,T,X,B,C,z,f,A,H,at,dt,Wt,Nt,Rt,It,St,Tt,Xt){let ut=32*t,wt=16*t;return this.int16[ut+0]=l,this.int16[ut+1]=n,this.int16[ut+2]=d,this.int16[ut+3]=s,this.int16[ut+4]=b,this.int16[ut+5]=Z,this.int16[ut+6]=V,this.int16[ut+7]=R,this.uint16[ut+8]=F,this.uint16[ut+9]=N,this.uint16[ut+10]=x,this.uint16[ut+11]=T,this.uint16[ut+12]=X,this.uint16[ut+13]=B,this.uint16[ut+14]=C,this.uint16[ut+15]=z,this.uint16[ut+16]=f,this.uint16[ut+17]=A,this.uint16[ut+18]=H,this.uint16[ut+19]=at,this.uint16[ut+20]=dt,this.uint16[ut+21]=Wt,this.uint16[ut+22]=Nt,this.uint32[wt+12]=Rt,this.float32[wt+13]=It,this.float32[wt+14]=St,this.uint16[ut+30]=Tt,this.uint16[ut+31]=Xt,t}}eo.prototype.bytesPerElement=64,Qt("StructArrayLayout8i15ui1ul2f2ui64",eo);class lo extends Ne{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t){let l=this.length;return this.resize(l+1),this.emplace(l,t)}emplace(t,l){return this.float32[1*t+0]=l,t}}lo.prototype.bytesPerElement=4,Qt("StructArrayLayout1f4",lo);class m extends Ne{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,l,n){let d=this.length;return this.resize(d+1),this.emplace(d,t,l,n)}emplace(t,l,n,d){let s=3*t;return this.uint16[6*t+0]=l,this.float32[s+1]=n,this.float32[s+2]=d,t}}m.prototype.bytesPerElement=12,Qt("StructArrayLayout1ui2f12",m);class e extends Ne{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,l,n){let d=this.length;return this.resize(d+1),this.emplace(d,t,l,n)}emplace(t,l,n,d){let s=4*t;return this.uint32[2*t+0]=l,this.uint16[s+2]=n,this.uint16[s+3]=d,t}}e.prototype.bytesPerElement=8,Qt("StructArrayLayout1ul2ui8",e);class a extends Ne{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,l){let n=this.length;return this.resize(n+1),this.emplace(n,t,l)}emplace(t,l,n){let d=2*t;return this.uint16[d+0]=l,this.uint16[d+1]=n,t}}a.prototype.bytesPerElement=4,Qt("StructArrayLayout2ui4",a);class c extends Ne{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t){let l=this.length;return this.resize(l+1),this.emplace(l,t)}emplace(t,l){return this.uint16[1*t+0]=l,t}}c.prototype.bytesPerElement=2,Qt("StructArrayLayout1ui2",c);class r extends Ne{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,l,n,d){let s=this.length;return this.resize(s+1),this.emplace(s,t,l,n,d)}emplace(t,l,n,d,s){let b=4*t;return this.float32[b+0]=l,this.float32[b+1]=n,this.float32[b+2]=d,this.float32[b+3]=s,t}}r.prototype.bytesPerElement=16,Qt("StructArrayLayout4f16",r);class W extends Od{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new lt(this.anchorPointX,this.anchorPointY)}}W.prototype.size=20;class h extends gn{get(t){return new W(this,t)}}Qt("CollisionBoxArray",h);class g extends Od{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(t){this._structArray.uint8[this._pos1+37]=t}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(t){this._structArray.uint8[this._pos1+38]=t}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(t){this._structArray.uint32[this._pos4+10]=t}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}g.prototype.size=48;class u extends Qs{get(t){return new g(this,t)}}Qt("PlacedSymbolArray",u);class G extends Od{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(t){this._structArray.uint32[this._pos4+12]=t}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}G.prototype.size=64;class Y extends eo{get(t){return new G(this,t)}}Qt("SymbolInstanceArray",Y);class y extends lo{getoffsetX(t){return this.float32[1*t+0]}}Qt("GlyphOffsetArray",y);class J extends _d{getx(t){return this.int16[3*t+0]}gety(t){return this.int16[3*t+1]}gettileUnitDistanceFromAnchor(t){return this.int16[3*t+2]}}Qt("SymbolLineVertexArray",J);class S extends Od{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}S.prototype.size=12;class L extends m{get(t){return new S(this,t)}}Qt("TextAnchorOffsetArray",L);class w extends Od{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}w.prototype.size=8;class v extends e{get(t){return new w(this,t)}}Qt("FeatureIndexArray",v);class O extends fd{}class K extends fd{}class tt extends fd{}class _ extends Bs{}class et extends Ma{}class it extends ld{}class q extends Kd{}class ct extends qc{}class ht extends Pd{}class bt extends Ss{}class mt extends id{}class Zt extends Cs{}class Jt extends Rn{}class Yt extends to{}class Gt extends a{}let zt=il([{name:"a_pos",components:2,type:"Int16"}],4),{members:ee}=zt;class te{constructor(t=[]){this._forceNewSegmentOnNextPrepare=!1,this.segments=t}prepareSegment(t,l,n,d){let s=this.segments[this.segments.length-1];return t>te.MAX_VERTEX_ARRAY_LENGTH&&Le(`Max vertices per segment is ${te.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${t}. Consider using the \`fillLargeMeshArrays\` function if you require meshes with more than ${te.MAX_VERTEX_ARRAY_LENGTH} vertices.`),this._forceNewSegmentOnNextPrepare||!s||s.vertexLength+t>te.MAX_VERTEX_ARRAY_LENGTH||s.sortKey!==d?this.createNewSegment(l,n,d):s}createNewSegment(t,l,n){let d={vertexOffset:t.length,primitiveOffset:l.length,vertexLength:0,primitiveLength:0,vaos:{}};return n!==void 0&&(d.sortKey=n),this._forceNewSegmentOnNextPrepare=!1,this.segments.push(d),d}getOrCreateLatestSegment(t,l,n){return this.prepareSegment(0,t,l,n)}forceNewSegmentOnNextPrepare(){this._forceNewSegmentOnNextPrepare=!0}get(){return this.segments}destroy(){for(let t of this.segments)for(let l in t.vaos)t.vaos[l].destroy()}static simpleSegment(t,l,n,d){return new te([{vertexOffset:t,primitiveOffset:l,vertexLength:n,primitiveLength:d,vaos:{},sortKey:0}])}}function Se(i,t){return 256*(i=el(Math.floor(i),0,255))+el(Math.floor(t),0,255)}te.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Qt("SegmentVector",te);let Ce=il([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]),fe=il([{name:"a_dasharray_from",components:4,type:"Uint16"},{name:"a_dasharray_to",components:4,type:"Uint16"}]);var Ye,Vl,we,ol={exports:{}},al={exports:{}},sl={exports:{}},hi=(function(){if(we)return ol.exports;we=1;var i=(Ye||(Ye=1,al.exports=function(l,n){var d,s,b,Z,V,R,F,N;for(s=l.length-(d=3&l.length),b=n,V=3432918353,R=461845907,N=0;N<s;)F=255&l.charCodeAt(N)|(255&l.charCodeAt(++N))<<8|(255&l.charCodeAt(++N))<<16|(255&l.charCodeAt(++N))<<24,++N,b=27492+(65535&(Z=5*(65535&(b=(b^=F=(65535&(F=(F=(65535&F)*V+(((F>>>16)*V&65535)<<16)&4294967295)<<15|F>>>17))*R+(((F>>>16)*R&65535)<<16)&4294967295)<<13|b>>>19))+((5*(b>>>16)&65535)<<16)&4294967295))+((58964+(Z>>>16)&65535)<<16);switch(F=0,d){case 3:F^=(255&l.charCodeAt(N+2))<<16;case 2:F^=(255&l.charCodeAt(N+1))<<8;case 1:b^=F=(65535&(F=(F=(65535&(F^=255&l.charCodeAt(N)))*V+(((F>>>16)*V&65535)<<16)&4294967295)<<15|F>>>17))*R+(((F>>>16)*R&65535)<<16)&4294967295}return b^=l.length,b=2246822507*(65535&(b^=b>>>16))+((2246822507*(b>>>16)&65535)<<16)&4294967295,b=3266489909*(65535&(b^=b>>>13))+((3266489909*(b>>>16)&65535)<<16)&4294967295,(b^=b>>>16)>>>0}),al.exports),t=(Vl||(Vl=1,sl.exports=function(l,n){for(var d,s=l.length,b=n^s,Z=0;s>=4;)d=1540483477*(65535&(d=255&l.charCodeAt(Z)|(255&l.charCodeAt(++Z))<<8|(255&l.charCodeAt(++Z))<<16|(255&l.charCodeAt(++Z))<<24))+((1540483477*(d>>>16)&65535)<<16),b=1540483477*(65535&b)+((1540483477*(b>>>16)&65535)<<16)^(d=1540483477*(65535&(d^=d>>>24))+((1540483477*(d>>>16)&65535)<<16)),s-=4,++Z;switch(s){case 3:b^=(255&l.charCodeAt(Z+2))<<16;case 2:b^=(255&l.charCodeAt(Z+1))<<8;case 1:b=1540483477*(65535&(b^=255&l.charCodeAt(Z)))+((1540483477*(b>>>16)&65535)<<16)}return b=1540483477*(65535&(b^=b>>>13))+((1540483477*(b>>>16)&65535)<<16),(b^=b>>>15)>>>0}),sl.exports);return ol.exports=i,ol.exports.murmur3=i,ol.exports.murmur2=t,ol.exports})(),Ya=Ft(hi);class ra{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(t,l,n,d){this.ids.push(Ka(t)),this.positions.push(l,n,d)}getPositions(t){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");let l=Ka(t),n=0,d=this.ids.length-1;for(;n<d;){let b=n+d>>1;this.ids[b]>=l?d=b:n=b+1}let s=[];for(;this.ids[n]===l;)s.push({index:this.positions[3*n],start:this.positions[3*n+1],end:this.positions[3*n+2]}),n++;return s}static serialize(t,l){let n=new Float64Array(t.ids),d=new Uint32Array(t.positions);return Pa(n,d,0,n.length-1),l&&l.push(n.buffer,d.buffer),{ids:n,positions:d}}static deserialize(t){let l=new ra;return l.ids=t.ids,l.positions=t.positions,l.indexed=!0,l}}function Ka(i){let t=+i;return!isNaN(t)&&t<=Number.MAX_SAFE_INTEGER?t:Ya(String(i))}function Pa(i,t,l,n){for(;l<n;){let d=i[l+n>>1],s=l-1,b=n+1;for(;;){do s++;while(i[s]<d);do b--;while(i[b]>d);if(s>=b)break;un(i,s,b),un(t,3*s,3*b),un(t,3*s+1,3*b+1),un(t,3*s+2,3*b+2)}b-l<n-b?(Pa(i,t,l,b),l=b+1):(Pa(i,t,b+1,n),n=b)}}function un(i,t,l){let n=i[t];i[t]=i[l],i[l]=n}Qt("FeaturePositionMap",ra);class Qi{constructor(t,l){this.gl=t.gl,this.location=l}}class xa extends Qi{constructor(t,l){super(t,l),this.current=0}set(t){this.current!==t&&(this.current=t,this.gl.uniform1f(this.location,t))}}class Ii extends Qi{constructor(t,l){super(t,l),this.current=[0,0,0,0]}set(t){t[0]===this.current[0]&&t[1]===this.current[1]&&t[2]===this.current[2]&&t[3]===this.current[3]||(this.current=t,this.gl.uniform4f(this.location,t[0],t[1],t[2],t[3]))}}class Ta extends Qi{constructor(t,l){super(t,l),this.current=me.transparent}set(t){t.r===this.current.r&&t.g===this.current.g&&t.b===this.current.b&&t.a===this.current.a||(this.current=t,this.gl.uniform4f(this.location,t.r,t.g,t.b,t.a))}}let Fn=new Float32Array(16);function Gn(i){return[Se(255*i.r,255*i.g),Se(255*i.b,255*i.a)]}class $e{constructor(t,l,n){this.value=t,this.uniformNames=l.map((d=>`u_${d}`)),this.type=n}setUniform(t,l,n){t.set(n.constantOr(this.value))}getBinding(t,l,n){return this.type==="color"?new Ta(t,l):new xa(t,l)}}class _e{constructor(t,l){this.uniformNames=l.map((n=>`u_${n}`)),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(t,l){this.pixelRatioFrom=l.pixelRatio,this.pixelRatioTo=t.pixelRatio,this.patternFrom=l.tlbr,this.patternTo=t.tlbr}setConstantDashPositions(t,l){this.dashTo=[0,t.y,t.height,t.width],this.dashFrom=[0,l.y,l.height,l.width]}setUniform(t,l,n,d){let s=null;d==="u_pattern_to"?s=this.patternTo:d==="u_pattern_from"?s=this.patternFrom:d==="u_dasharray_to"?s=this.dashTo:d==="u_dasharray_from"?s=this.dashFrom:d==="u_pixel_ratio_to"?s=this.pixelRatioTo:d==="u_pixel_ratio_from"&&(s=this.pixelRatioFrom),s!==null&&t.set(s)}getBinding(t,l,n){return n.substr(0,9)==="u_pattern"||n.substr(0,12)==="u_dasharray_"?new Ii(t,l):new xa(t,l)}}class pl{constructor(t,l,n,d){this.expression=t,this.type=n,this.maxValue=0,this.paintVertexAttributes=l.map((s=>({name:`a_${s}`,type:"Float32",components:n==="color"?2:1,offset:0}))),this.paintVertexArray=new d}populatePaintArray(t,l,n){let d=this.paintVertexArray.length,s=this.expression.evaluate(new Ge(0,n),l,{},n.canonical,[],n.formattedSection);this.paintVertexArray.resize(t),this._setPaintValue(d,t,s)}updatePaintArray(t,l,n,d,s){let b=this.expression.evaluate(new Ge(0,s),n,d);this._setPaintValue(t,l,b)}_setPaintValue(t,l,n){if(this.type==="color"){let d=Gn(n);for(let s=t;s<l;s++)this.paintVertexArray.emplace(s,d[0],d[1])}else{for(let d=t;d<l;d++)this.paintVertexArray.emplace(d,n);this.maxValue=Math.max(this.maxValue,Math.abs(n))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class xe{constructor(t,l,n,d,s,b){this.expression=t,this.uniformNames=l.map((Z=>`u_${Z}_t`)),this.type=n,this.useIntegerZoom=d,this.zoom=s,this.maxValue=0,this.paintVertexAttributes=l.map((Z=>({name:`a_${Z}`,type:"Float32",components:n==="color"?4:2,offset:0}))),this.paintVertexArray=new b}populatePaintArray(t,l,n){let d=this.expression.evaluate(new Ge(this.zoom,n),l,{},n.canonical,[],n.formattedSection),s=this.expression.evaluate(new Ge(this.zoom+1,n),l,{},n.canonical,[],n.formattedSection),b=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(b,t,d,s)}updatePaintArray(t,l,n,d,s){let b=this.expression.evaluate(new Ge(this.zoom,s),n,d),Z=this.expression.evaluate(new Ge(this.zoom+1,s),n,d);this._setPaintValue(t,l,b,Z)}_setPaintValue(t,l,n,d){if(this.type==="color"){let s=Gn(n),b=Gn(d);for(let Z=t;Z<l;Z++)this.paintVertexArray.emplace(Z,s[0],s[1],b[0],b[1])}else{for(let s=t;s<l;s++)this.paintVertexArray.emplace(s,n,d);this.maxValue=Math.max(this.maxValue,Math.abs(n),Math.abs(d))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(t,l){let n=this.useIntegerZoom?Math.floor(l.zoom):l.zoom,d=el(this.expression.interpolationFactor(n,this.zoom,this.zoom+1),0,1);t.set(d)}getBinding(t,l,n){return new xa(t,l)}}class qa{constructor(t,l,n,d,s,b){this.expression=t,this.type=l,this.useIntegerZoom=n,this.zoom=d,this.layerId=b,this.zoomInPaintVertexArray=new s,this.zoomOutPaintVertexArray=new s}populatePaintArray(t,l,n){let d=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(t),this.zoomOutPaintVertexArray.resize(t),this._setPaintValues(d,t,this.getPositionIds(l),n)}updatePaintArray(t,l,n,d,s){this._setPaintValues(t,l,this.getPositionIds(n),s)}_setPaintValues(t,l,n,d){let s=this.getPositions(d);if(!s||!n)return;let b=s[n.min],Z=s[n.mid],V=s[n.max];if(b&&Z&&V)for(let R=t;R<l;R++)this.emplace(this.zoomInPaintVertexArray,R,Z,b),this.emplace(this.zoomOutPaintVertexArray,R,Z,V)}upload(t){if(this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer){let l=this.getVertexAttributes();this.zoomInPaintVertexBuffer=t.createVertexBuffer(this.zoomInPaintVertexArray,l,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=t.createVertexBuffer(this.zoomOutPaintVertexArray,l,this.expression.isStateDependent)}}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Y0 extends qa{getPositions(t){return t.imagePositions}getPositionIds(t){return t.patterns&&t.patterns[this.layerId]}getVertexAttributes(){return Ce.members}emplace(t,l,n,d){t.emplace(l,n.tlbr[0],n.tlbr[1],n.tlbr[2],n.tlbr[3],d.tlbr[0],d.tlbr[1],d.tlbr[2],d.tlbr[3],n.pixelRatio,d.pixelRatio)}}class x0 extends qa{getPositions(t){return t.dashPositions}getPositionIds(t){return t.dashes&&t.dashes[this.layerId]}getVertexAttributes(){return fe.members}emplace(t,l,n,d){t.emplace(l,0,n.y,n.height,n.width,0,d.y,d.height,d.width)}}class T0{constructor(t,l,n){this.binders={},this._buffers=[];let d=[];for(let s in t.paint._values){if(!n(s))continue;let b=t.paint.get(s);if(!(b instanceof _i&&_n(b.property.specification)))continue;let Z=am(s,t.type),V=b.value,R=b.property.specification.type,F=b.property.useIntegerZoom,N=b.property.specification["property-type"],x=N==="cross-faded"||N==="cross-faded-data-driven";if(V.kind==="constant")this.binders[s]=x?new _e(V.value,Z):new $e(V.value,Z,R),d.push(`/u_${s}`);else if(V.kind==="source"||x){let T=$a(s,R,"source");this.binders[s]=x?s==="line-dasharray"?new x0(V,R,F,l,T,t.id):new Y0(V,R,F,l,T,t.id):new pl(V,Z,R,T),d.push(`/a_${s}`)}else{let T=$a(s,R,"composite");this.binders[s]=new xe(V,Z,R,F,l,T),d.push(`/z_${s}`)}}this.cacheKey=d.sort().join("")}getMaxValue(t){let l=this.binders[t];return l instanceof pl||l instanceof xe?l.maxValue:0}populatePaintArrays(t,l,n){for(let d in this.binders){let s=this.binders[d];(s instanceof pl||s instanceof xe||s instanceof qa)&&s.populatePaintArray(t,l,n)}}setConstantPatternPositions(t,l){for(let n in this.binders){let d=this.binders[n];d instanceof _e&&d.setConstantPatternPositions(t,l)}}setConstantDashPositions(t,l){for(let n in this.binders){let d=this.binders[n];d instanceof _e&&d.setConstantDashPositions(t,l)}}updatePaintArrays(t,l,n,d,s){let b=!1;for(let Z in t){let V=l.getPositions(Z);for(let R of V){let F=n.feature(R.index);for(let N in this.binders){let x=this.binders[N];if((x instanceof pl||x instanceof xe||x instanceof qa)&&x.expression.isStateDependent===!0){let T=d.paint.get(N);x.expression=T.value,x.updatePaintArray(R.start,R.end,F,t[Z],s),b=!0}}}}return b}defines(){let t=[];for(let l in this.binders){let n=this.binders[l];(n instanceof $e||n instanceof _e)&&t.push(...n.uniformNames.map((d=>`#define HAS_UNIFORM_${d}`)))}return t}getBinderAttributes(){let t=[];for(let l in this.binders){let n=this.binders[l];if(n instanceof pl||n instanceof xe)for(let d=0;d<n.paintVertexAttributes.length;d++)t.push(n.paintVertexAttributes[d].name);else if(n instanceof qa){let d=n.getVertexAttributes();for(let s of d)t.push(s.name)}}return t}getBinderUniforms(){let t=[];for(let l in this.binders){let n=this.binders[l];if(n instanceof $e||n instanceof _e||n instanceof xe)for(let d of n.uniformNames)t.push(d)}return t}getPaintVertexBuffers(){return this._buffers}getUniforms(t,l){let n=[];for(let d in this.binders){let s=this.binders[d];if(s instanceof $e||s instanceof _e||s instanceof xe){for(let b of s.uniformNames)if(l[b]){let Z=s.getBinding(t,l[b],b);n.push({name:b,property:d,binding:Z})}}}return n}setUniforms(t,l,n,d){for(let{name:s,property:b,binding:Z}of l)this.binders[b].setUniform(Z,d,n.get(b),s)}updatePaintBuffers(t){this._buffers=[];for(let l in this.binders){let n=this.binders[l];if(t&&n instanceof qa){let d=t.fromScale===2?n.zoomInPaintVertexBuffer:n.zoomOutPaintVertexBuffer;d&&this._buffers.push(d)}else(n instanceof pl||n instanceof xe)&&n.paintVertexBuffer&&this._buffers.push(n.paintVertexBuffer)}}upload(t){for(let l in this.binders){let n=this.binders[l];(n instanceof pl||n instanceof xe||n instanceof qa)&&n.upload(t)}this.updatePaintBuffers()}destroy(){for(let t in this.binders){let l=this.binders[t];(l instanceof pl||l instanceof xe||l instanceof qa)&&l.destroy()}}}class Nn{constructor(t,l,n=()=>!0){this.programConfigurations={};for(let d of t)this.programConfigurations[d.id]=new T0(d,l,n);this.needsUpload=!1,this._featureMap=new ra,this._bufferOffset=0}populatePaintArrays(t,l,n,d){for(let s in this.programConfigurations)this.programConfigurations[s].populatePaintArrays(t,l,d);l.id!==void 0&&this._featureMap.add(l.id,n,this._bufferOffset,t),this._bufferOffset=t,this.needsUpload=!0}updatePaintArrays(t,l,n,d){for(let s of n)this.needsUpload=this.programConfigurations[s.id].updatePaintArrays(t,this._featureMap,l,s,d)||this.needsUpload}get(t){return this.programConfigurations[t]}upload(t){if(this.needsUpload){for(let l in this.programConfigurations)this.programConfigurations[l].upload(t);this.needsUpload=!1}}destroy(){for(let t in this.programConfigurations)this.programConfigurations[t].destroy()}}function am(i,t){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-dasharray":["dasharray_to","dasharray_from"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[i]||[i.replace(`${t}-`,"").replace(/-/g,"_")]}function $a(i,t,l){let n={color:{source:ld,composite:r},number:{source:lo,composite:ld}},d=(function(s){return{"line-pattern":{source:q,composite:q},"fill-pattern":{source:q,composite:q},"fill-extrusion-pattern":{source:q,composite:q},"line-dasharray":{source:ct,composite:ct}}[s]})(i);return d&&d[l]||n[t][l]}Qt("ConstantBinder",$e),Qt("CrossFadedConstantBinder",_e),Qt("SourceExpressionBinder",pl),Qt("CrossFadedPatternBinder",Y0),Qt("CrossFadedDasharrayBinder",x0),Qt("CompositeExpressionBinder",xe),Qt("ProgramConfiguration",T0,{omit:["_buffers"]}),Qt("ProgramConfigurationSet",Nn);let io=Math.pow(2,14)-1,ks=-io-1;function tn(i){let t=se/i.extent,l=i.loadGeometry();for(let n=0;n<l.length;n++){let d=l[n];for(let s=0;s<d.length;s++){let b=d[s],Z=Math.round(b.x*t),V=Math.round(b.y*t);b.x=el(Z,ks,io),b.y=el(V,ks,io),(Z<b.x||Z>b.x+1||V<b.y||V>b.y+1)&&Le("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return l}function Xa(i,t){return{type:i.type,id:i.id,properties:i.properties,geometry:t?tn(i):[]}}let Ls=-32768;function Es(i,t,l,n,d){i.emplaceBack(Ls+8*t+n,Ls+8*l+d)}class nm{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((l=>l.id)),this.index=t.index,this.hasDependencies=!1,this.layoutVertexArray=new K,this.indexArray=new Yt,this.segments=new te,this.programConfigurations=new Nn(t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter((l=>l.isStateDependent())).map((l=>l.id))}populate(t,l,n){let d=this.layers[0],s=[],b=null,Z=!1,V=d.type==="heatmap";if(d.type==="circle"){let F=d;b=F.layout.get("circle-sort-key"),Z=!b.isConstant(),V=V||F.paint.get("circle-pitch-alignment")==="map"}let R=V?l.subdivisionGranularity.circle:1;for(let{feature:F,id:N,index:x,sourceLayerIndex:T}of t){let X=this.layers[0]._featureFilter.needGeometry,B=Xa(F,X);if(!this.layers[0]._featureFilter.filter(new Ge(this.zoom),B,n))continue;let C=Z?b.evaluate(B,{},n):void 0,z={id:N,properties:F.properties,type:F.type,sourceLayerIndex:T,index:x,geometry:X?B.geometry:tn(F),patterns:{},sortKey:C};s.push(z)}Z&&s.sort(((F,N)=>F.sortKey-N.sortKey));for(let F of s){let{geometry:N,index:x,sourceLayerIndex:T}=F,X=t[x].feature;this.addFeature(F,N,x,n,R),l.featureIndex.insert(X,N,x,T,this.index)}}update(t,l,n){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,l,this.stateDependentLayers,{imagePositions:n})}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,ee),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(t,l,n,d,s=1){let b;switch(s){case 1:b=[0,7];break;case 3:b=[0,2,5,7];break;case 5:b=[0,1,3,4,6,7];break;case 7:b=[0,1,2,3,4,5,6,7];break;default:throw new Error(`Invalid circle bucket granularity: ${s}; valid values are 1, 3, 5, 7.`)}let Z=b.length;for(let V of l)for(let R of V){let F=R.x,N=R.y;if(F<0||F>=se||N<0||N>=se)continue;let x=this.segments.prepareSegment(Z*Z,this.layoutVertexArray,this.indexArray,t.sortKey),T=x.vertexLength;for(let X=0;X<Z;X++)for(let B=0;B<Z;B++)Es(this.layoutVertexArray,F,N,b[B],b[X]);for(let X=0;X<Z-1;X++)for(let B=0;B<Z-1;B++){let C=T+X*Z+B,z=T+(X+1)*Z+B;this.indexArray.emplaceBack(C,z+1,C+1),this.indexArray.emplaceBack(C,z,z+1)}x.vertexLength+=Z*Z,x.primitiveLength+=(Z-1)*(Z-1)*2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,n,{imagePositions:{},canonical:d})}}function K1(i,t){for(let l=0;l<i.length;l++)if(ao(t,i[l]))return!0;for(let l=0;l<t.length;l++)if(ao(i,t[l]))return!0;return!!dm(i,t)}function X0(i,t,l){return!!ao(i,t)||!!cm(t,i,l)}function P1(i,t){if(i.length===1)return $1(t,i[0]);for(let l=0;l<t.length;l++){let n=t[l];for(let d=0;d<n.length;d++)if(ao(i,n[d]))return!0}for(let l=0;l<i.length;l++)if($1(t,i[l]))return!0;for(let l=0;l<t.length;l++)if(dm(i,t[l]))return!0;return!1}function kV(i,t,l){if(i.length>1){if(dm(i,t))return!0;for(let n=0;n<t.length;n++)if(cm(t[n],i,l))return!0}for(let n=0;n<i.length;n++)if(cm(i[n],t,l))return!0;return!1}function dm(i,t){if(i.length===0||t.length===0)return!1;for(let l=0;l<i.length-1;l++){let n=i[l],d=i[l+1];for(let s=0;s<t.length-1;s++)if(LV(n,d,t[s],t[s+1]))return!0}return!1}function LV(i,t,l,n){return si(i,l,n)!==si(t,l,n)&&si(i,t,l)!==si(i,t,n)}function cm(i,t,l){let n=l*l;if(t.length===1)return i.distSqr(t[0])<n;for(let d=1;d<t.length;d++)if(q1(i,t[d-1],t[d])<n)return!0;return!1}function q1(i,t,l){let n=t.distSqr(l);if(n===0)return i.distSqr(t);let d=((i.x-t.x)*(l.x-t.x)+(i.y-t.y)*(l.y-t.y))/n;return i.distSqr(d<0?t:d>1?l:l.sub(t)._mult(d)._add(t))}function $1(i,t){let l,n,d,s=!1;for(let b=0;b<i.length;b++){l=i[b];for(let Z=0,V=l.length-1;Z<l.length;V=Z++)n=l[Z],d=l[V],n.y>t.y!=d.y>t.y&&t.x<(d.x-n.x)*(t.y-n.y)/(d.y-n.y)+n.x&&(s=!s)}return s}function ao(i,t){let l=!1;for(let n=0,d=i.length-1;n<i.length;d=n++){let s=i[n],b=i[d];s.y>t.y!=b.y>t.y&&t.x<(b.x-s.x)*(t.y-s.y)/(b.y-s.y)+s.x&&(l=!l)}return l}function EV(i,t,l){let n=l[0],d=l[2];if(i.x<n.x&&t.x<n.x||i.x>d.x&&t.x>d.x||i.y<n.y&&t.y<n.y||i.y>d.y&&t.y>d.y)return!1;let s=si(i,t,l[0]);return s!==si(i,t,l[1])||s!==si(i,t,l[2])||s!==si(i,t,l[3])}function no(i,t,l){let n=t.paint.get(i).value;return n.kind==="constant"?n.value:l.programConfigurations.get(t.id).getMaxValue(i)}function J0(i){return Math.sqrt(i[0]*i[0]+i[1]*i[1])}function y0(i,t,l,n,d){if(!t[0]&&!t[1])return i;let s=lt.convert(t)._mult(d);l==="viewport"&&s._rotate(-n);let b=[];for(let Z=0;Z<i.length;Z++)b.push(i[Z].sub(s));return b}function zV({queryGeometry:i,size:t},l){return X0(i,l,t)}function jV({queryGeometry:i,size:t,transform:l,unwrappedTileID:n,getElevation:d},s){return X0(i,s,t*(l.projectTileCoordinates(s.x,s.y,n,d).signedDistanceFromCamera/l.cameraToCenterDistance))}function AV({queryGeometry:i,size:t,transform:l,unwrappedTileID:n,getElevation:d},s){let b=l.projectTileCoordinates(s.x,s.y,n,d).signedDistanceFromCamera,Z=t*(l.cameraToCenterDistance/b);return X0(i,om(s,l,n,d),Z)}function wV({queryGeometry:i,size:t,transform:l,unwrappedTileID:n,getElevation:d},s){return X0(i,om(s,l,n,d),t)}function tW({queryGeometry:i,size:t,transform:l,unwrappedTileID:n,getElevation:d,pitchAlignment:s="map",pitchScale:b="map"},Z){let V=s==="map"?b==="map"?zV:jV:b==="map"?AV:wV,R={queryGeometry:i,size:t,transform:l,unwrappedTileID:n,getElevation:d};for(let F of Z)for(let N of F)if(V(R,N))return!0;return!1}function om(i,t,l,n){let d=t.projectTileCoordinates(i.x,i.y,l,n).point;return new lt((.5*d.x+.5)*t.width,(.5*-d.y+.5)*t.height)}let eW,lW;Qt("CircleBucket",nm,{omit:["layers"]});var vV={get paint(){return lW=lW||new Dl({"circle-radius":new Dt(D.paint_circle["circle-radius"]),"circle-color":new Dt(D.paint_circle["circle-color"]),"circle-blur":new Dt(D.paint_circle["circle-blur"]),"circle-opacity":new Dt(D.paint_circle["circle-opacity"]),"circle-translate":new At(D.paint_circle["circle-translate"]),"circle-translate-anchor":new At(D.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new At(D.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new At(D.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Dt(D.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Dt(D.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Dt(D.paint_circle["circle-stroke-opacity"])})},get layout(){return eW=eW||new Dl({"circle-sort-key":new Dt(D.layout_circle["circle-sort-key"])})}};class HV extends Ci{constructor(t,l){super(t,vV,l)}createBucket(t){return new nm(t)}queryRadius(t){let l=t;return no("circle-radius",this,l)+no("circle-stroke-width",this,l)+J0(this.paint.get("circle-translate"))}queryIntersectsFeature({queryGeometry:t,feature:l,featureState:n,geometry:d,transform:s,pixelsToTileUnits:b,unwrappedTileID:Z,getElevation:V}){let R=y0(t,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),-s.bearingInRadians,b),F=this.paint.get("circle-radius").evaluate(l,n)+this.paint.get("circle-stroke-width").evaluate(l,n),N=this.paint.get("circle-pitch-scale"),x=this.paint.get("circle-pitch-alignment"),T,X;return x==="map"?(T=R,X=F*b):(T=(function(B,C,z,f){return B.map((A=>om(A,C,z,f)))})(R,s,Z,V),X=F),tW({queryGeometry:T,size:X,transform:s,unwrappedTileID:Z,getElevation:V,pitchAlignment:x,pitchScale:N},d)}}class iW extends nm{}let aW;Qt("HeatmapBucket",iW,{omit:["layers"]});var DV={get paint(){return aW=aW||new Dl({"heatmap-radius":new Dt(D.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Dt(D.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new At(D.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Dd(D.paint_heatmap["heatmap-color"]),"heatmap-opacity":new At(D.paint_heatmap["heatmap-opacity"])})}};function sm(i,{width:t,height:l},n,d){if(d){if(d instanceof Uint8ClampedArray)d=new Uint8Array(d.buffer);else if(d.length!==t*l*n)throw new RangeError(`mismatched image size. expected: ${d.length} but got: ${t*l*n}`)}else d=new Uint8Array(t*l*n);return i.width=t,i.height=l,i.data=d,i}function nW(i,{width:t,height:l},n){if(t===i.width&&l===i.height)return;let d=sm({},{width:t,height:l},n);rm(i,d,{x:0,y:0},{x:0,y:0},{width:Math.min(i.width,t),height:Math.min(i.height,l)},n),i.width=t,i.height=l,i.data=d.data}function rm(i,t,l,n,d,s){if(d.width===0||d.height===0)return t;if(d.width>i.width||d.height>i.height||l.x>i.width-d.width||l.y>i.height-d.height)throw new RangeError("out of range source coordinates for image copy");if(d.width>t.width||d.height>t.height||n.x>t.width-d.width||n.y>t.height-d.height)throw new RangeError("out of range destination coordinates for image copy");let b=i.data,Z=t.data;if(b===Z)throw new Error("srcData equals dstData, so image is already copied");for(let V=0;V<d.height;V++){let R=((l.y+V)*i.width+l.x)*s,F=((n.y+V)*t.width+n.x)*s;for(let N=0;N<d.width*s;N++)Z[F+N]=b[R+N]}return t}class zs{constructor(t,l){sm(this,t,1,l)}resize(t){nW(this,t,1)}clone(){return new zs({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,l,n,d,s){rm(t,l,n,d,s,1)}}class Ui{constructor(t,l){sm(this,t,4,l)}resize(t){nW(this,t,4)}replace(t,l){l?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t}clone(){return new Ui({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,l,n,d,s){rm(t,l,n,d,s,4)}setPixel(t,l,n){let d=4*(t*this.width+l);this.data[d+0]=Math.round(255*n.r/n.a),this.data[d+1]=Math.round(255*n.g/n.a),this.data[d+2]=Math.round(255*n.b/n.a),this.data[d+3]=Math.round(255*n.a)}}function dW(i){let t={},l=i.resolution||256,n=i.clips?i.clips.length:1,d=i.image||new Ui({width:l,height:n});if(Math.log(l)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${l}`);let s=(b,Z,V)=>{t[i.evaluationKey]=V;let R=i.expression.evaluate(t);d.setPixel(b/4/l,Z/4,R)};if(i.clips)for(let b=0,Z=0;b<n;++b,Z+=4*l)for(let V=0,R=0;V<l;V++,R+=4){let F=V/(l-1),{start:N,end:x}=i.clips[b];s(Z,R,N*(1-F)+x*F)}else for(let b=0,Z=0;b<l;b++,Z+=4)s(0,Z,b/(l-1));return d}Qt("AlphaImage",zs),Qt("RGBAImage",Ui);let bm="big-fb";class OV extends Ci{createBucket(t){return new iW(t)}constructor(t,l){super(t,DV,l),this.heatmapFbos=new Map,this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){t==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=dW({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbos.has(bm)&&this.heatmapFbos.delete(bm)}queryRadius(t){return no("heatmap-radius",this,t)}queryIntersectsFeature({queryGeometry:t,feature:l,featureState:n,geometry:d,transform:s,pixelsToTileUnits:b,unwrappedTileID:Z,getElevation:V}){return tW({queryGeometry:t,size:this.paint.get("heatmap-radius").evaluate(l,n)*b,transform:s,unwrappedTileID:Z,getElevation:V},d)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let cW;var fV={get paint(){return cW=cW||new Dl({"hillshade-illumination-direction":new At(D.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-altitude":new At(D.paint_hillshade["hillshade-illumination-altitude"]),"hillshade-illumination-anchor":new At(D.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new At(D.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new At(D.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new At(D.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new At(D.paint_hillshade["hillshade-accent-color"]),"hillshade-method":new At(D.paint_hillshade["hillshade-method"])})}};class _V extends Ci{constructor(t,l){super(t,fV,l),this.recalculate({zoom:0,zoomHistory:{}},void 0)}getIlluminationProperties(){let t=this.paint.get("hillshade-illumination-direction").values,l=this.paint.get("hillshade-illumination-altitude").values,n=this.paint.get("hillshade-highlight-color").values,d=this.paint.get("hillshade-shadow-color").values,s=Math.max(t.length,l.length,n.length,d.length);t=t.concat(Array(s-t.length).fill(t.at(-1))),l=l.concat(Array(s-l.length).fill(l.at(-1))),n=n.concat(Array(s-n.length).fill(n.at(-1))),d=d.concat(Array(s-d.length).fill(d.at(-1)));let b=l.map(la);return{directionRadians:t.map(la),altitudeRadians:b,shadowColor:d,highlightColor:n}}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}let oW;var KV={get paint(){return oW=oW||new Dl({"color-relief-opacity":new At(D["paint_color-relief"]["color-relief-opacity"]),"color-relief-color":new Dd(D["paint_color-relief"]["color-relief-color"])})}};class mm{constructor(t,l,n,d){this.context=t,this.format=n,this.texture=t.gl.createTexture(),this.update(l,d)}update(t,l,n){let{width:d,height:s}=t,b=!(this.size&&this.size[0]===d&&this.size[1]===s||n),{context:Z}=this,{gl:V}=Z;if(this.useMipmap=!!(l&&l.useMipmap),V.bindTexture(V.TEXTURE_2D,this.texture),Z.pixelStoreUnpackFlipY.set(!1),Z.pixelStoreUnpack.set(1),Z.pixelStoreUnpackPremultiplyAlpha.set(this.format===V.RGBA&&(!l||l.premultiply!==!1)),b)this.size=[d,s],t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||Ri(t)?V.texImage2D(V.TEXTURE_2D,0,this.format,this.format,V.UNSIGNED_BYTE,t):V.texImage2D(V.TEXTURE_2D,0,this.format,d,s,0,this.format,V.UNSIGNED_BYTE,t.data);else{let{x:R,y:F}=n||{x:0,y:0};t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||Ri(t)?V.texSubImage2D(V.TEXTURE_2D,0,R,F,V.RGBA,V.UNSIGNED_BYTE,t):V.texSubImage2D(V.TEXTURE_2D,0,R,F,d,s,V.RGBA,V.UNSIGNED_BYTE,t.data)}this.useMipmap&&this.isSizePowerOfTwo()&&V.generateMipmap(V.TEXTURE_2D),Z.pixelStoreUnpackFlipY.setDefault(),Z.pixelStoreUnpack.setDefault(),Z.pixelStoreUnpackPremultiplyAlpha.setDefault()}bind(t,l,n){let{context:d}=this,{gl:s}=d;s.bindTexture(s.TEXTURE_2D,this.texture),n!==s.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(n=s.LINEAR),t!==this.filter&&(s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,t),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,n||t),this.filter=t),l!==this.wrap&&(s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,l),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,l),this.wrap=l)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){let{gl:t}=this.context;t.deleteTexture(this.texture),this.texture=null}}class sW{constructor(t,l,n,d=1,s=1,b=1,Z=0){if(this.uid=t,l.height!==l.width)throw new RangeError("DEM tiles must be square");if(n&&!["mapbox","terrarium","custom"].includes(n))return void Le(`"${n}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=l.height;let V=this.dim=l.height-2;switch(this.data=new Uint32Array(l.data.buffer),n){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=d,this.greenFactor=s,this.blueFactor=b,this.baseShift=Z;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let R=0;R<V;R++)this.data[this._idx(-1,R)]=this.data[this._idx(0,R)],this.data[this._idx(V,R)]=this.data[this._idx(V-1,R)],this.data[this._idx(R,-1)]=this.data[this._idx(R,0)],this.data[this._idx(R,V)]=this.data[this._idx(R,V-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(V,-1)]=this.data[this._idx(V-1,0)],this.data[this._idx(-1,V)]=this.data[this._idx(0,V-1)],this.data[this._idx(V,V)]=this.data[this._idx(V-1,V-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let R=0;R<V;R++)for(let F=0;F<V;F++){let N=this.get(R,F);N>this.max&&(this.max=N),N<this.min&&(this.min=N)}}get(t,l){let n=new Uint8Array(this.data.buffer),d=4*this._idx(t,l);return this.unpack(n[d],n[d+1],n[d+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(t,l){if(t<-1||t>=this.dim+1||l<-1||l>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(l+1)*this.stride+(t+1)}unpack(t,l,n){return t*this.redFactor+l*this.greenFactor+n*this.blueFactor-this.baseShift}pack(t){return rW(t,this.getUnpackVector())}getPixels(){return new Ui({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(t,l,n){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");let d=l*this.dim,s=l*this.dim+this.dim,b=n*this.dim,Z=n*this.dim+this.dim;switch(l){case-1:d=s-1;break;case 1:s=d+1}switch(n){case-1:b=Z-1;break;case 1:Z=b+1}let V=-l*this.dim,R=-n*this.dim;for(let F=b;F<Z;F++)for(let N=d;N<s;N++)this.data[this._idx(N,F)]=t.data[this._idx(N+V,F+R)]}}function rW(i,t){let l=t[0],n=t[1],d=t[2],s=t[3],b=Math.min(l,n,d),Z=Math.round((i+s)/b);return{r:Math.floor(Z*b/l)%256,g:Math.floor(Z*b/n)%256,b:Math.floor(Z*b/d)%256}}Qt("DEMData",sW);class PV extends Ci{constructor(t,l){super(t,KV,l)}_createColorRamp(t){let l={elevationStops:[],colorStops:[]},n=this._transitionablePaint._values["color-relief-color"].value.expression;if(n instanceof Zn&&n._styleExpression.expression instanceof Ll){this.colorRampExpression=n;let b=n._styleExpression.expression;l.elevationStops=b.labels,l.colorStops=[];for(let Z of l.elevationStops)l.colorStops.push(b.evaluate({globals:{elevation:Z}}))}if(l.elevationStops.length<1&&(l.elevationStops=[0],l.colorStops=[me.transparent]),l.elevationStops.length<2&&(l.elevationStops.push(l.elevationStops[0]+1),l.colorStops.push(l.colorStops[0])),l.elevationStops.length<=t)return l;let d={elevationStops:[],colorStops:[]},s=(l.elevationStops.length-1)/(t-1);for(let b=0;b<l.elevationStops.length-.5;b+=s)d.elevationStops.push(l.elevationStops[Math.round(b)]),d.colorStops.push(l.colorStops[Math.round(b)]);return Le(`Too many colors in specification of ${this.id} color-relief layer, may not render properly. Max possible colors: ${t}, provided: ${l.elevationStops.length}`),d}_colorRampChanged(){return this.colorRampExpression!=this._transitionablePaint._values["color-relief-color"].value.expression}getColorRampTextures(t,l,n){if(this.colorRampTextures&&!this._colorRampChanged())return this.colorRampTextures;let d=this._createColorRamp(l),s=new Ui({width:d.colorStops.length,height:1}),b=new Ui({width:d.colorStops.length,height:1});for(let Z=0;Z<d.elevationStops.length;Z++){let V=rW(d.elevationStops[Z],n);b.setPixel(0,Z,new me(V.r/255,V.g/255,V.b/255,1)),s.setPixel(0,Z,d.colorStops[Z])}return this.colorRampTextures={elevationTexture:new mm(t,b,t.gl.RGBA),colorTexture:new mm(t,s,t.gl.RGBA)},this.colorRampTextures}hasOffscreenPass(){return this.visibility!=="none"&&!!this.colorRampTextures}}let qV=il([{name:"a_pos",components:2,type:"Int16"}],4),{members:$V}=qV;function B0(i,t,l){let n=l.patternDependencies,d=!1;for(let s of t){let b=s.paint.get(`${i}-pattern`);b.isConstant()||(d=!0);let Z=b.constantOr(null);Z&&(d=!0,n[Z.to]=!0,n[Z.from]=!0)}return d}function Wm(i,t,l,n,d){let{zoom:s}=n,b=d.patternDependencies;for(let Z of t){let V=Z.paint.get(`${i}-pattern`).value;if(V.kind!=="constant"){let R=V.evaluate({zoom:s-1},l,{},d.availableImages),F=V.evaluate({zoom:s},l,{},d.availableImages),N=V.evaluate({zoom:s+1},l,{},d.availableImages);R=R&&R.name?R.name:R,F=F&&F.name?F.name:F,N=N&&N.name?N.name:N,b[R]=!0,b[F]=!0,b[N]=!0,l.patterns[Z.id]={min:R,mid:F,max:N}}}return l}function bW(i,t,l,n,d){let s;if(d===(function(b,Z,V,R){let F=0;for(let N=Z,x=V-R;N<V;N+=R)F+=(b[x]-b[N])*(b[N+1]+b[x+1]),x=N;return F})(i,t,l,n)>0)for(let b=t;b<l;b+=n)s=hW(b/n|0,i[b],i[b+1],s);else for(let b=l-n;b>=t;b-=n)s=hW(b/n|0,i[b],i[b+1],s);return s&&co(s,s.next)&&(vs(s),s=s.next),s}function qd(i,t){if(!i)return i;t||(t=i);let l,n=i;do if(l=!1,n.steiner||!co(n,n.next)&&rl(n.prev,n,n.next)!==0)n=n.next;else{if(vs(n),n=t=n.prev,n===n.next)break;l=!0}while(l||n!==t);return t}function js(i,t,l,n,d,s,b){if(!i)return;!b&&s&&(function(V,R,F,N){let x=V;do x.z===0&&(x.z=Zm(x.x,x.y,R,F,N)),x.prevZ=x.prev,x.nextZ=x.next,x=x.next;while(x!==V);x.prevZ.nextZ=null,x.prevZ=null,(function(T){let X,B=1;do{let C,z=T;T=null;let f=null;for(X=0;z;){X++;let A=z,H=0;for(let dt=0;dt<B&&(H++,A=A.nextZ,A);dt++);let at=B;for(;H>0||at>0&&A;)H!==0&&(at===0||!A||z.z<=A.z)?(C=z,z=z.nextZ,H--):(C=A,A=A.nextZ,at--),f?f.nextZ=C:T=C,C.prevZ=f,f=C;z=A}f.nextZ=null,B*=2}while(X>1)})(x)})(i,n,d,s);let Z=i;for(;i.prev!==i.next;){let V=i.prev,R=i.next;if(s?ep(i,n,d,s):tp(i))t.push(V.i,i.i,R.i),vs(i),i=R.next,Z=R.next;else if((i=R)===Z){b?b===1?js(i=lp(qd(i),t),t,l,n,d,s,2):b===2&&ip(i,t,l,n,d,s):js(qd(i),t,l,n,d,s,1);break}}}function tp(i){let t=i.prev,l=i,n=i.next;if(rl(t,l,n)>=0)return!1;let d=t.x,s=l.x,b=n.x,Z=t.y,V=l.y,R=n.y,F=Math.min(d,s,b),N=Math.min(Z,V,R),x=Math.max(d,s,b),T=Math.max(Z,V,R),X=n.next;for(;X!==t;){if(X.x>=F&&X.x<=x&&X.y>=N&&X.y<=T&&As(d,Z,s,V,b,R,X.x,X.y)&&rl(X.prev,X,X.next)>=0)return!1;X=X.next}return!0}function ep(i,t,l,n){let d=i.prev,s=i,b=i.next;if(rl(d,s,b)>=0)return!1;let Z=d.x,V=s.x,R=b.x,F=d.y,N=s.y,x=b.y,T=Math.min(Z,V,R),X=Math.min(F,N,x),B=Math.max(Z,V,R),C=Math.max(F,N,x),z=Zm(T,X,t,l,n),f=Zm(B,C,t,l,n),A=i.prevZ,H=i.nextZ;for(;A&&A.z>=z&&H&&H.z<=f;){if(A.x>=T&&A.x<=B&&A.y>=X&&A.y<=C&&A!==d&&A!==b&&As(Z,F,V,N,R,x,A.x,A.y)&&rl(A.prev,A,A.next)>=0||(A=A.prevZ,H.x>=T&&H.x<=B&&H.y>=X&&H.y<=C&&H!==d&&H!==b&&As(Z,F,V,N,R,x,H.x,H.y)&&rl(H.prev,H,H.next)>=0))return!1;H=H.nextZ}for(;A&&A.z>=z;){if(A.x>=T&&A.x<=B&&A.y>=X&&A.y<=C&&A!==d&&A!==b&&As(Z,F,V,N,R,x,A.x,A.y)&&rl(A.prev,A,A.next)>=0)return!1;A=A.prevZ}for(;H&&H.z<=f;){if(H.x>=T&&H.x<=B&&H.y>=X&&H.y<=C&&H!==d&&H!==b&&As(Z,F,V,N,R,x,H.x,H.y)&&rl(H.prev,H,H.next)>=0)return!1;H=H.nextZ}return!0}function lp(i,t){let l=i;do{let n=l.prev,d=l.next.next;!co(n,d)&&WW(n,l,l.next,d)&&ws(n,d)&&ws(d,n)&&(t.push(n.i,l.i,d.i),vs(l),vs(l.next),l=i=d),l=l.next}while(l!==i);return qd(l)}function ip(i,t,l,n,d,s){let b=i;do{let Z=b.next.next;for(;Z!==b.prev;){if(b.i!==Z.i&&op(b,Z)){let V=ZW(b,Z);return b=qd(b,b.next),V=qd(V,V.next),js(b,t,l,n,d,s,0),void js(V,t,l,n,d,s,0)}Z=Z.next}b=b.next}while(b!==i)}function ap(i,t){let l=i.x-t.x;return l===0&&(l=i.y-t.y,l===0)&&(l=(i.next.y-i.y)/(i.next.x-i.x)-(t.next.y-t.y)/(t.next.x-t.x)),l}function np(i,t){let l=(function(d,s){let b=s,Z=d.x,V=d.y,R,F=-1/0;if(co(d,b))return b;do{if(co(d,b.next))return b.next;if(V<=b.y&&V>=b.next.y&&b.next.y!==b.y){let B=b.x+(V-b.y)*(b.next.x-b.x)/(b.next.y-b.y);if(B<=Z&&B>F&&(F=B,R=b.x<b.next.x?b:b.next,B===Z))return R}b=b.next}while(b!==s);if(!R)return null;let N=R,x=R.x,T=R.y,X=1/0;b=R;do{if(Z>=b.x&&b.x>=x&&Z!==b.x&&mW(V<T?Z:F,V,x,T,V<T?F:Z,V,b.x,b.y)){let B=Math.abs(V-b.y)/(Z-b.x);ws(b,d)&&(B<X||B===X&&(b.x>R.x||b.x===R.x&&dp(R,b)))&&(R=b,X=B)}b=b.next}while(b!==N);return R})(i,t);if(!l)return t;let n=ZW(l,i);return qd(n,n.next),qd(l,l.next)}function dp(i,t){return rl(i.prev,i,t.prev)<0&&rl(t.next,i,i.next)<0}function Zm(i,t,l,n,d){return(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=(i-l)*d|0)|i<<8))|i<<4))|i<<2))|i<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-n)*d|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function cp(i){let t=i,l=i;do(t.x<l.x||t.x===l.x&&t.y<l.y)&&(l=t),t=t.next;while(t!==i);return l}function mW(i,t,l,n,d,s,b,Z){return(d-b)*(t-Z)>=(i-b)*(s-Z)&&(i-b)*(n-Z)>=(l-b)*(t-Z)&&(l-b)*(s-Z)>=(d-b)*(n-Z)}function As(i,t,l,n,d,s,b,Z){return!(i===b&&t===Z)&&mW(i,t,l,n,d,s,b,Z)}function op(i,t){return i.next.i!==t.i&&i.prev.i!==t.i&&!(function(l,n){let d=l;do{if(d.i!==l.i&&d.next.i!==l.i&&d.i!==n.i&&d.next.i!==n.i&&WW(d,d.next,l,n))return!0;d=d.next}while(d!==l);return!1})(i,t)&&(ws(i,t)&&ws(t,i)&&(function(l,n){let d=l,s=!1,b=(l.x+n.x)/2,Z=(l.y+n.y)/2;do d.y>Z!=d.next.y>Z&&d.next.y!==d.y&&b<(d.next.x-d.x)*(Z-d.y)/(d.next.y-d.y)+d.x&&(s=!s),d=d.next;while(d!==l);return s})(i,t)&&(rl(i.prev,i,t.prev)||rl(i,t.prev,t))||co(i,t)&&rl(i.prev,i,i.next)>0&&rl(t.prev,t,t.next)>0)}function rl(i,t,l){return(t.y-i.y)*(l.x-t.x)-(t.x-i.x)*(l.y-t.y)}function co(i,t){return i.x===t.x&&i.y===t.y}function WW(i,t,l,n){let d=C0(rl(i,t,l)),s=C0(rl(i,t,n)),b=C0(rl(l,n,i)),Z=C0(rl(l,n,t));return d!==s&&b!==Z||!(d!==0||!S0(i,l,t))||!(s!==0||!S0(i,n,t))||!(b!==0||!S0(l,i,n))||!(Z!==0||!S0(l,t,n))}function S0(i,t,l){return t.x<=Math.max(i.x,l.x)&&t.x>=Math.min(i.x,l.x)&&t.y<=Math.max(i.y,l.y)&&t.y>=Math.min(i.y,l.y)}function C0(i){return i>0?1:i<0?-1:0}function ws(i,t){return rl(i.prev,i,i.next)<0?rl(i,t,i.next)>=0&&rl(i,i.prev,t)>=0:rl(i,t,i.prev)<0||rl(i,i.next,t)<0}function ZW(i,t){let l=hm(i.i,i.x,i.y),n=hm(t.i,t.x,t.y),d=i.next,s=t.prev;return i.next=t,t.prev=i,l.next=d,d.prev=l,n.next=l,l.prev=n,s.next=n,n.prev=s,n}function hW(i,t,l,n){let d=hm(i,t,l);return n?(d.next=n.next,d.prev=n,n.next.prev=d,n.next=d):(d.prev=d,d.next=d),d}function vs(i){i.next.prev=i.prev,i.prev.next=i.next,i.prevZ&&(i.prevZ.nextZ=i.nextZ),i.nextZ&&(i.nextZ.prevZ=i.prevZ)}function hm(i,t,l){return{i,x:t,y:l,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}class oo{constructor(t,l){if(l>t)throw new Error("Min granularity must not be greater than base granularity.");this._baseZoomGranularity=t,this._minGranularity=l}getGranularityForZoomLevel(t){return Math.max(Math.floor(this._baseZoomGranularity/(1<<t)),this._minGranularity,1)}}class Q0{constructor(t){this.fill=t.fill,this.line=t.line,this.tile=t.tile,this.stencil=t.stencil,this.circle=t.circle}}Q0.noSubdivision=new Q0({fill:new oo(0,0),line:new oo(0,0),tile:new oo(0,0),stencil:new oo(0,0),circle:1}),Qt("SubdivisionGranularityExpression",oo),Qt("SubdivisionGranularitySetting",Q0);let so=-32768,Hs=32767;class sp{constructor(t,l){this._vertexBuffer=[],this._vertexDictionary=new Map,this._used=!1,this._granularity=t,this._granularityCellSize=se/t,this._canonical=l}_getKey(t,l){return(t+=32768)<<16|l+32768}_vertexToIndex(t,l){if(t<-32768||l<-32768||t>32767||l>32767)throw new Error("Vertex coordinates are out of signed 16 bit integer range.");let n=0|Math.round(t),d=0|Math.round(l),s=this._getKey(n,d);if(this._vertexDictionary.has(s))return this._vertexDictionary.get(s);let b=this._vertexBuffer.length/2;return this._vertexDictionary.set(s,b),this._vertexBuffer.push(n,d),b}_subdivideTrianglesScanline(t){if(this._granularity<2)return(function(d,s){let b=[];for(let Z=0;Z<s.length;Z+=3){let V=s[Z],R=s[Z+1],F=s[Z+2],N=d[2*V],x=d[2*V+1];(d[2*R]-N)*(d[2*F+1]-x)-(d[2*R+1]-x)*(d[2*F]-N)>0?(b.push(V),b.push(F),b.push(R)):(b.push(V),b.push(R),b.push(F))}return b})(this._vertexBuffer,t);let l=[],n=t.length;for(let d=0;d<n;d+=3){let s=[t[d+0],t[d+1],t[d+2]],b=[this._vertexBuffer[2*t[d+0]+0],this._vertexBuffer[2*t[d+0]+1],this._vertexBuffer[2*t[d+1]+0],this._vertexBuffer[2*t[d+1]+1],this._vertexBuffer[2*t[d+2]+0],this._vertexBuffer[2*t[d+2]+1]],Z=1/0,V=1/0,R=-1/0,F=-1/0;for(let B=0;B<3;B++){let C=b[2*B],z=b[2*B+1];Z=Math.min(Z,C),R=Math.max(R,C),V=Math.min(V,z),F=Math.max(F,z)}if(Z===R||V===F)continue;let N=Math.floor(Z/this._granularityCellSize),x=Math.ceil(R/this._granularityCellSize),T=Math.floor(V/this._granularityCellSize),X=Math.ceil(F/this._granularityCellSize);if(N!==x||T!==X)for(let B=T;B<X;B++){let C=this._scanlineGenerateVertexRingForCellRow(B,b,s);rp(this._vertexBuffer,C,l)}else l.push(...s)}return l}_scanlineGenerateVertexRingForCellRow(t,l,n){let d=t*this._granularityCellSize,s=d+this._granularityCellSize,b=[];for(let Z=0;Z<3;Z++){let V=l[2*Z],R=l[2*Z+1],F=l[2*(Z+1)%6],N=l[(2*(Z+1)+1)%6],x=l[2*(Z+2)%6],T=l[(2*(Z+2)+1)%6],X=F-V,B=N-R,C=X===0,z=B===0,f=(d-R)/B,A=(s-R)/B,H=Math.min(f,A),at=Math.max(f,A);if(!z&&(H>=1||at<=0)||z&&(R<d||R>s)){N>=d&&N<=s&&b.push(n[(Z+1)%3]);continue}!z&&H>0&&b.push(this._vertexToIndex(V+X*H,R+B*H));let dt=V+X*Math.max(H,0),Wt=V+X*Math.min(at,1);C||this._generateIntraEdgeVertices(b,V,R,F,N,dt,Wt),!z&&at<1&&b.push(this._vertexToIndex(V+X*at,R+B*at)),(z||N>=d&&N<=s)&&b.push(n[(Z+1)%3]),!z&&(N<=d||N>=s)&&this._generateInterEdgeVertices(b,V,R,F,N,x,T,Wt,d,s)}return b}_generateIntraEdgeVertices(t,l,n,d,s,b,Z){let V=d-l,R=s-n,F=R===0,N=F?Math.min(l,d):Math.min(b,Z),x=F?Math.max(l,d):Math.max(b,Z),T=Math.floor(N/this._granularityCellSize)+1,X=Math.ceil(x/this._granularityCellSize)-1;if(F?l<d:b<Z)for(let B=T;B<=X;B++){let C=B*this._granularityCellSize;t.push(this._vertexToIndex(C,n+R*(C-l)/V))}else for(let B=X;B>=T;B--){let C=B*this._granularityCellSize;t.push(this._vertexToIndex(C,n+R*(C-l)/V))}}_generateInterEdgeVertices(t,l,n,d,s,b,Z,V,R,F){let N=s-n,x=b-d,T=Z-s,X=(R-s)/T,B=(F-s)/T,C=Math.min(X,B),z=Math.max(X,B),f=d+x*C,A=Math.floor(Math.min(f,V)/this._granularityCellSize)+1,H=Math.ceil(Math.max(f,V)/this._granularityCellSize)-1,at=V<f,dt=T===0;if(dt&&(Z===R||Z===F))return;if(dt||C>=1||z<=0){let Nt=n-Z,Rt=b+(l-b)*Math.min((R-Z)/Nt,(F-Z)/Nt);A=Math.floor(Math.min(Rt,V)/this._granularityCellSize)+1,H=Math.ceil(Math.max(Rt,V)/this._granularityCellSize)-1,at=V<Rt}let Wt=N>0?F:R;if(at)for(let Nt=A;Nt<=H;Nt++)t.push(this._vertexToIndex(Nt*this._granularityCellSize,Wt));else for(let Nt=H;Nt>=A;Nt--)t.push(this._vertexToIndex(Nt*this._granularityCellSize,Wt))}_generateOutline(t){let l=[];for(let n of t){let d=$d(n,this._granularity,!0),s=this._pointArrayToIndices(d),b=[];for(let Z=1;Z<s.length;Z++)b.push(s[Z-1]),b.push(s[Z]);l.push(b)}return l}_handlePoles(t){let l=!1,n=!1;this._canonical&&(this._canonical.y===0&&(l=!0),this._canonical.y===(1<<this._canonical.z)-1&&(n=!0)),(l||n)&&this._fillPoles(t,l,n)}_ensureNoPoleVertices(){let t=this._vertexBuffer;for(let l=0;l<t.length;l+=2){let n=t[l+1];n===so&&(t[l+1]=-32767),n===Hs&&(t[l+1]=32766)}}_generatePoleQuad(t,l,n,d,s,b){d>s!=(b===so)?(t.push(l),t.push(n),t.push(this._vertexToIndex(d,b)),t.push(n),t.push(this._vertexToIndex(s,b)),t.push(this._vertexToIndex(d,b))):(t.push(n),t.push(l),t.push(this._vertexToIndex(d,b)),t.push(this._vertexToIndex(s,b)),t.push(n),t.push(this._vertexToIndex(d,b)))}_fillPoles(t,l,n){let d=this._vertexBuffer,s=se,b=t.length;for(let Z=2;Z<b;Z+=3){let V=t[Z-2],R=t[Z-1],F=t[Z],N=d[2*V],x=d[2*V+1],T=d[2*R],X=d[2*R+1],B=d[2*F],C=d[2*F+1];l&&(x===0&&X===0&&this._generatePoleQuad(t,V,R,N,T,so),X===0&&C===0&&this._generatePoleQuad(t,R,F,T,B,so),C===0&&x===0&&this._generatePoleQuad(t,F,V,B,N,so)),n&&(x===s&&X===s&&this._generatePoleQuad(t,V,R,N,T,Hs),X===s&&C===s&&this._generatePoleQuad(t,R,F,T,B,Hs),C===s&&x===s&&this._generatePoleQuad(t,F,V,B,N,Hs))}}_initializeVertices(t){for(let l=0;l<t.length;l+=2)this._vertexToIndex(t[l],t[l+1])}subdividePolygonInternal(t,l){if(this._used)throw new Error("Subdivision: multiple use not allowed.");this._used=!0;let{flattened:n,holeIndices:d}=(function(Z){let V=[],R=[];for(let F of Z)if(F.length!==0){F!==Z[0]&&V.push(R.length/2);for(let N=0;N<F.length;N++)R.push(F[N].x),R.push(F[N].y)}return{flattened:R,holeIndices:V}})(t),s;this._initializeVertices(n);try{let Z=(function(R,F,N=2){let x=F&&F.length,T=x?F[0]*N:R.length,X=bW(R,0,T,N,!0),B=[];if(!X||X.next===X.prev)return B;let C,z,f;if(x&&(X=(function(A,H,at,dt){let Wt=[];for(let Nt=0,Rt=H.length;Nt<Rt;Nt++){let It=bW(A,H[Nt]*dt,Nt<Rt-1?H[Nt+1]*dt:A.length,dt,!1);It===It.next&&(It.steiner=!0),Wt.push(cp(It))}Wt.sort(ap);for(let Nt=0;Nt<Wt.length;Nt++)at=np(Wt[Nt],at);return at})(R,F,X,N)),R.length>80*N){C=R[0],z=R[1];let A=C,H=z;for(let at=N;at<T;at+=N){let dt=R[at],Wt=R[at+1];dt<C&&(C=dt),Wt<z&&(z=Wt),dt>A&&(A=dt),Wt>H&&(H=Wt)}f=Math.max(A-C,H-z),f=f!==0?32767/f:0}return js(X,B,N,C,z,f,0),B})(n,d),V=this._convertIndices(n,Z);s=this._subdivideTrianglesScanline(V)}catch(Z){console.error(Z)}let b=[];return l&&(b=this._generateOutline(t)),this._ensureNoPoleVertices(),this._handlePoles(s),{verticesFlattened:this._vertexBuffer,indicesTriangles:s,indicesLineList:b}}_convertIndices(t,l){let n=[];for(let d=0;d<l.length;d++)n.push(this._vertexToIndex(t[2*l[d]],t[2*l[d]+1]));return n}_pointArrayToIndices(t){let l=[];for(let n=0;n<t.length;n++){let d=t[n];l.push(this._vertexToIndex(d.x,d.y))}return l}}function VW(i,t,l,n=!0){return new sp(l,t).subdividePolygonInternal(i,n)}function $d(i,t,l=!1){if(!i||i.length<1)return[];if(i.length<2)return[];let n=i[0],d=i[i.length-1],s=l&&(n.x!==d.x||n.y!==d.y);if(t<2)return s?[...i,i[0]]:[...i];let b=Math.floor(se/t),Z=[];Z.push(new lt(i[0].x,i[0].y));let V=i.length,R=s?V:V-1;for(let F=0;F<R;F++){let N=i[F],x=F<V-1?i[F+1]:i[0],T=N.x,X=N.y,B=x.x,C=x.y,z=T!==B,f=X!==C;if(!z&&!f)continue;let A=B-T,H=C-X,at=Math.abs(A),dt=Math.abs(H),Wt=T,Nt=X;for(;;){let It=A>0?(Math.floor(Wt/b)+1)*b:(Math.ceil(Wt/b)-1)*b,St=H>0?(Math.floor(Nt/b)+1)*b:(Math.ceil(Nt/b)-1)*b,Tt=Math.abs(Wt-It),Xt=Math.abs(Nt-St),ut=Math.abs(Wt-B),wt=Math.abs(Nt-C),vt=z?Tt/at:Number.POSITIVE_INFINITY,Ot=f?Xt/dt:Number.POSITIVE_INFINITY;if((ut<=Tt||!z)&&(wt<=Xt||!f))break;if(vt<Ot&&z||!f){Wt=It,Nt+=H*vt;let Lt=new lt(Wt,Math.round(Nt));Z[Z.length-1].x===Lt.x&&Z[Z.length-1].y===Lt.y||Z.push(Lt)}else{Wt+=A*Ot,Nt=St;let Lt=new lt(Math.round(Wt),Nt);Z[Z.length-1].x===Lt.x&&Z[Z.length-1].y===Lt.y||Z.push(Lt)}}let Rt=new lt(B,C);Z[Z.length-1].x===Rt.x&&Z[Z.length-1].y===Rt.y||Z.push(Rt)}return Z}function rp(i,t,l){if(t.length===0)throw new Error("Subdivision vertex ring is empty.");let n=0,d=i[2*t[0]];for(let V=1;V<t.length;V++){let R=i[2*t[V]];R<d&&(d=R,n=V)}let s=t.length,b=n,Z=(b+1)%s;for(;;){let V=b-1>=0?b-1:s-1,R=(Z+1)%s,F=i[2*t[V]],N=i[2*t[R]],x=i[2*t[b]],T=i[2*t[b]+1],X=i[2*t[Z]+1],B=!1;if(F<N)B=!0;else if(F>N)B=!1;else{let C=X-T,z=-(i[2*t[Z]]-x),f=T<X?1:-1;((F-x)*C+(i[2*t[V]+1]-T)*z)*f>((N-x)*C+(i[2*t[R]+1]-T)*z)*f&&(B=!0)}if(B){let C=t[V],z=t[b],f=t[Z];C!==z&&C!==f&&z!==f&&l.push(f,z,C),b--,b<0&&(b=s-1)}else{let C=t[R],z=t[b],f=t[Z];C!==z&&C!==f&&z!==f&&l.push(f,z,C),Z++,Z>=s&&(Z=0)}if(V===R)break}}function pW(i,t,l,n,d,s,b,Z,V){let R=d.length/2,F=b&&Z&&V;if(R<te.MAX_VERTEX_ARRAY_LENGTH){let N=t.prepareSegment(R,l,n),x=N.vertexLength;for(let B=0;B<s.length;B+=3)n.emplaceBack(x+s[B],x+s[B+1],x+s[B+2]);let T,X;N.vertexLength+=R,N.primitiveLength+=s.length/3,F&&(X=b.prepareSegment(R,l,Z),T=X.vertexLength,X.vertexLength+=R);for(let B=0;B<d.length;B+=2)i(d[B],d[B+1]);if(F)for(let B=0;B<V.length;B++){let C=V[B];for(let z=1;z<C.length;z+=2)Z.emplaceBack(T+C[z-1],T+C[z]);X.primitiveLength+=C.length/2}}else(function(N,x,T,X,B,C){let z=[];for(let dt=0;dt<X.length/2;dt++)z.push(-1);let f={count:0},A=0,H=N.getOrCreateLatestSegment(x,T),at=H.vertexLength;for(let dt=2;dt<B.length;dt+=3){let Wt=B[dt-2],Nt=B[dt-1],Rt=B[dt],It=z[Wt]<A,St=z[Nt]<A,Tt=z[Rt]<A;H.vertexLength+((It?1:0)+(St?1:0)+(Tt?1:0))>te.MAX_VERTEX_ARRAY_LENGTH&&(H=N.createNewSegment(x,T),A=f.count,It=!0,St=!0,Tt=!0,at=0);let Xt=Ds(z,X,C,f,Wt,It,H),ut=Ds(z,X,C,f,Nt,St,H),wt=Ds(z,X,C,f,Rt,Tt,H);T.emplaceBack(at+Xt-A,at+ut-A,at+wt-A),H.primitiveLength++}})(t,l,n,d,s,i),F&&(function(N,x,T,X,B,C){let z=[];for(let dt=0;dt<X.length/2;dt++)z.push(-1);let f={count:0},A=0,H=N.getOrCreateLatestSegment(x,T),at=H.vertexLength;for(let dt=0;dt<B.length;dt++){let Wt=B[dt];for(let Nt=1;Nt<B[dt].length;Nt+=2){let Rt=Wt[Nt-1],It=Wt[Nt],St=z[Rt]<A,Tt=z[It]<A;H.vertexLength+((St?1:0)+(Tt?1:0))>te.MAX_VERTEX_ARRAY_LENGTH&&(H=N.createNewSegment(x,T),A=f.count,St=!0,Tt=!0,at=0);let Xt=Ds(z,X,C,f,Rt,St,H),ut=Ds(z,X,C,f,It,Tt,H);T.emplaceBack(at+Xt-A,at+ut-A),H.primitiveLength++}}})(b,l,Z,d,V,i),t.forceNewSegmentOnNextPrepare(),b?.forceNewSegmentOnNextPrepare()}function Ds(i,t,l,n,d,s,b){if(s){let Z=n.count;return l(t[2*d],t[2*d+1]),i[d]=n.count,n.count++,b.vertexLength++,Z}return i[d]}class Vm{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((l=>l.id)),this.index=t.index,this.hasDependencies=!1,this.patternFeatures=[],this.layoutVertexArray=new tt,this.indexArray=new Yt,this.indexArray2=new Gt,this.programConfigurations=new Nn(t.layers,t.zoom),this.segments=new te,this.segments2=new te,this.stateDependentLayerIds=this.layers.filter((l=>l.isStateDependent())).map((l=>l.id))}populate(t,l,n){this.hasDependencies=B0("fill",this.layers,l);let d=this.layers[0].layout.get("fill-sort-key"),s=!d.isConstant(),b=[];for(let{feature:Z,id:V,index:R,sourceLayerIndex:F}of t){let N=this.layers[0]._featureFilter.needGeometry,x=Xa(Z,N);if(!this.layers[0]._featureFilter.filter(new Ge(this.zoom),x,n))continue;let T=s?d.evaluate(x,{},n,l.availableImages):void 0,X={id:V,properties:Z.properties,type:Z.type,sourceLayerIndex:F,index:R,geometry:N?x.geometry:tn(Z),patterns:{},sortKey:T};b.push(X)}s&&b.sort(((Z,V)=>Z.sortKey-V.sortKey));for(let Z of b){let{geometry:V,index:R,sourceLayerIndex:F}=Z;if(this.hasDependencies){let N=Wm("fill",this.layers,Z,{zoom:this.zoom},l);this.patternFeatures.push(N)}else this.addFeature(Z,V,R,n,{},l.subdivisionGranularity);l.featureIndex.insert(t[R].feature,V,R,F,this.index)}}update(t,l,n){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,l,this.stateDependentLayers,{imagePositions:n})}addFeatures(t,l,n){for(let d of this.patternFeatures)this.addFeature(d,d.geometry,d.index,l,n,t.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,$V),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(t,l,n,d,s,b){for(let Z of xd(l,500)){let V=VW(Z,d,b.fill.getGranularityForZoomLevel(d.z)),R=this.layoutVertexArray;pW(((F,N)=>{R.emplaceBack(F,N)}),this.segments,this.layoutVertexArray,this.indexArray,V.verticesFlattened,V.indicesTriangles,this.segments2,this.indexArray2,V.indicesLineList)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,n,{imagePositions:s,canonical:d})}}let gW,RW;Qt("FillBucket",Vm,{omit:["layers","patternFeatures"]});var bp={get paint(){return RW=RW||new Dl({"fill-antialias":new At(D.paint_fill["fill-antialias"]),"fill-opacity":new Dt(D.paint_fill["fill-opacity"]),"fill-color":new Dt(D.paint_fill["fill-color"]),"fill-outline-color":new Dt(D.paint_fill["fill-outline-color"]),"fill-translate":new At(D.paint_fill["fill-translate"]),"fill-translate-anchor":new At(D.paint_fill["fill-translate-anchor"]),"fill-pattern":new Hd(D.paint_fill["fill-pattern"])})},get layout(){return gW=gW||new Dl({"fill-sort-key":new Dt(D.layout_fill["fill-sort-key"])})}};class mp extends Ci{constructor(t,l){super(t,bp,l)}recalculate(t,l){super.recalculate(t,l);let n=this.paint._values["fill-outline-color"];n.value.kind==="constant"&&n.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(t){return new Vm(t)}queryRadius(){return J0(this.paint.get("fill-translate"))}queryIntersectsFeature({queryGeometry:t,geometry:l,transform:n,pixelsToTileUnits:d}){return P1(y0(t,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),-n.bearingInRadians,d),l)}isTileClipped(){return!0}}let Wp=il([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),Zp=il([{name:"a_centroid",components:2,type:"Int16"}],4),{members:hp}=Wp;class ro{constructor(t,l,n,d,s){this.properties={},this.extent=n,this.type=0,this.id=void 0,this._pbf=t,this._geometry=-1,this._keys=d,this._values=s,t.readFields(Vp,this,l)}loadGeometry(){let t=this._pbf;t.pos=this._geometry;let l=t.readVarint()+t.pos,n=[],d,s=1,b=0,Z=0,V=0;for(;t.pos<l;){if(b<=0){let R=t.readVarint();s=7&R,b=R>>3}if(b--,s===1||s===2)Z+=t.readSVarint(),V+=t.readSVarint(),s===1&&(d&&n.push(d),d=[]),d&&d.push(new lt(Z,V));else{if(s!==7)throw new Error(`unknown command ${s}`);d&&d.push(d[0].clone())}}return d&&n.push(d),n}bbox(){let t=this._pbf;t.pos=this._geometry;let l=t.readVarint()+t.pos,n=1,d=0,s=0,b=0,Z=1/0,V=-1/0,R=1/0,F=-1/0;for(;t.pos<l;){if(d<=0){let N=t.readVarint();n=7&N,d=N>>3}if(d--,n===1||n===2)s+=t.readSVarint(),b+=t.readSVarint(),s<Z&&(Z=s),s>V&&(V=s),b<R&&(R=b),b>F&&(F=b);else if(n!==7)throw new Error(`unknown command ${n}`)}return[Z,R,V,F]}toGeoJSON(t,l,n){let d=this.extent*Math.pow(2,n),s=this.extent*t,b=this.extent*l,Z=this.loadGeometry();function V(x){return[360*(x.x+s)/d-180,360/Math.PI*Math.atan(Math.exp((1-2*(x.y+b)/d)*Math.PI))-90]}function R(x){return x.map(V)}let F;if(this.type===1){let x=[];for(let X of Z)x.push(X[0]);let T=R(x);F=x.length===1?{type:"Point",coordinates:T[0]}:{type:"MultiPoint",coordinates:T}}else if(this.type===2){let x=Z.map(R);F=x.length===1?{type:"LineString",coordinates:x[0]}:{type:"MultiLineString",coordinates:x}}else{if(this.type!==3)throw new Error("unknown feature type");{let x=(function(X){let B=X.length;if(B<=1)return[X];let C=[],z,f;for(let A=0;A<B;A++){let H=pp(X[A]);H!==0&&(f===void 0&&(f=H<0),f===H<0?(z&&C.push(z),z=[X[A]]):z&&z.push(X[A]))}return z&&C.push(z),C})(Z),T=[];for(let X of x)T.push(X.map(R));F=T.length===1?{type:"Polygon",coordinates:T[0]}:{type:"MultiPolygon",coordinates:T}}}let N={type:"Feature",geometry:F,properties:this.properties};return this.id!=null&&(N.id=this.id),N}}function Vp(i,t,l){i===1?t.id=l.readVarint():i===2?(function(n,d){let s=n.readVarint()+n.pos;for(;n.pos<s;){let b=d._keys[n.readVarint()],Z=d._values[n.readVarint()];d.properties[b]=Z}})(l,t):i===3?t.type=l.readVarint():i===4&&(t._geometry=l.pos)}function pp(i){let t=0;for(let l,n,d=0,s=i.length,b=s-1;d<s;b=d++)l=i[d],n=i[b],t+=(n.x-l.x)*(l.y+n.y);return t}ro.types=["Unknown","Point","LineString","Polygon"];class uW{constructor(t,l){this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(gp,this,l),this.length=this._features.length}feature(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];let l=this._pbf.readVarint()+this._pbf.pos;return new ro(this._pbf,l,this.extent,this._keys,this._values)}}function gp(i,t,l){i===15?t.version=l.readVarint():i===1?t.name=l.readString():i===5?t.extent=l.readVarint():i===2?t._features.push(l.pos):i===3?t._keys.push(l.readString()):i===4&&t._values.push((function(n){let d=null,s=n.readVarint()+n.pos;for(;n.pos<s;){let b=n.readVarint()>>3;d=b===1?n.readString():b===2?n.readFloat():b===3?n.readDouble():b===4?n.readVarint64():b===5?n.readVarint():b===6?n.readSVarint():b===7?n.readBoolean():null}if(d==null)throw new Error("unknown feature value");return d})(l))}class FW{constructor(t,l){this.layers=t.readFields(Rp,{},l)}}function Rp(i,t,l){if(i===3){let n=new uW(l,l.readVarint()+l.pos);n.length&&(t[n.name]=n)}}let pm=Math.pow(2,13);function Os(i,t,l,n,d,s,b,Z){i.emplaceBack(t,l,2*Math.floor(n*pm)+b,d*pm*2,s*pm*2,Math.round(Z))}class gm{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((l=>l.id)),this.index=t.index,this.hasDependencies=!1,this.layoutVertexArray=new _,this.centroidVertexArray=new O,this.indexArray=new Yt,this.programConfigurations=new Nn(t.layers,t.zoom),this.segments=new te,this.stateDependentLayerIds=this.layers.filter((l=>l.isStateDependent())).map((l=>l.id))}populate(t,l,n){this.features=[],this.hasDependencies=B0("fill-extrusion",this.layers,l);for(let{feature:d,id:s,index:b,sourceLayerIndex:Z}of t){let V=this.layers[0]._featureFilter.needGeometry,R=Xa(d,V);if(!this.layers[0]._featureFilter.filter(new Ge(this.zoom),R,n))continue;let F={id:s,sourceLayerIndex:Z,index:b,geometry:V?R.geometry:tn(d),properties:d.properties,type:d.type,patterns:{}};this.hasDependencies?this.features.push(Wm("fill-extrusion",this.layers,F,{zoom:this.zoom},l)):this.addFeature(F,F.geometry,b,n,{},l.subdivisionGranularity),l.featureIndex.insert(d,F.geometry,b,Z,this.index,!0)}}addFeatures(t,l,n){for(let d of this.features){let{geometry:s}=d;this.addFeature(d,s,d.index,l,n,t.subdivisionGranularity)}}update(t,l,n){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,l,this.stateDependentLayers,{imagePositions:n})}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,hp),this.centroidVertexBuffer=t.createVertexBuffer(this.centroidVertexArray,Zp.members,!0),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(t,l,n,d,s,b){for(let Z of xd(l,500)){let V={x:0,y:0,sampleCount:0},R=this.layoutVertexArray.length;this.processPolygon(V,d,t,Z,b);let F=this.layoutVertexArray.length-R,N=Math.floor(V.x/V.sampleCount),x=Math.floor(V.y/V.sampleCount);for(let T=0;T<F;T++)this.centroidVertexArray.emplaceBack(N,x)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,n,{imagePositions:s,canonical:d})}processPolygon(t,l,n,d,s){if(d.length<1||GW(d[0]))return;for(let N of d)N.length!==0&&up(t,N);let b={segment:this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray)},Z=s.fill.getGranularityForZoomLevel(l.z),V=ro.types[n.type]==="Polygon";for(let N of d){if(N.length===0||GW(N))continue;let x=$d(N,Z,V);this._generateSideFaces(x,b)}if(!V)return;let R=VW(d,l,Z,!1),F=this.layoutVertexArray;pW(((N,x)=>{Os(F,N,x,0,0,1,1,0)}),this.segments,this.layoutVertexArray,this.indexArray,R.verticesFlattened,R.indicesTriangles)}_generateSideFaces(t,l){let n=0;for(let d=1;d<t.length;d++){let s=t[d],b=t[d-1];if(Fp(s,b))continue;l.segment.vertexLength+4>te.MAX_VERTEX_ARRAY_LENGTH&&(l.segment=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));let Z=s.sub(b)._perp()._unit(),V=b.dist(s);n+V>32768&&(n=0),Os(this.layoutVertexArray,s.x,s.y,Z.x,Z.y,0,0,n),Os(this.layoutVertexArray,s.x,s.y,Z.x,Z.y,0,1,n),n+=V,Os(this.layoutVertexArray,b.x,b.y,Z.x,Z.y,0,0,n),Os(this.layoutVertexArray,b.x,b.y,Z.x,Z.y,0,1,n);let R=l.segment.vertexLength;this.indexArray.emplaceBack(R,R+2,R+1),this.indexArray.emplaceBack(R+1,R+2,R+3),l.segment.vertexLength+=4,l.segment.primitiveLength+=2}}}function up(i,t){for(let l=0;l<t.length;l++){let n=t[l];l===t.length-1&&t[0].x===n.x&&t[0].y===n.y||(i.x+=n.x,i.y+=n.y,i.sampleCount++)}}function Fp(i,t){return i.x===t.x&&(i.x<0||i.x>se)||i.y===t.y&&(i.y<0||i.y>se)}function GW(i){return i.every((t=>t.x<0))||i.every((t=>t.x>se))||i.every((t=>t.y<0))||i.every((t=>t.y>se))}let NW;Qt("FillExtrusionBucket",gm,{omit:["layers","features"]});var Gp={get paint(){return NW=NW||new Dl({"fill-extrusion-opacity":new At(D["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Dt(D["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new At(D["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new At(D["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Hd(D["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Dt(D["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Dt(D["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new At(D["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class Np extends Ci{constructor(t,l){super(t,Gp,l)}createBucket(t){return new gm(t)}queryRadius(){return J0(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature({queryGeometry:t,feature:l,featureState:n,geometry:d,transform:s,pixelsToTileUnits:b,pixelPosMatrix:Z}){let V=y0(t,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),-s.bearingInRadians,b),R=this.paint.get("fill-extrusion-height").evaluate(l,n),F=this.paint.get("fill-extrusion-base").evaluate(l,n),N=(function(T,X){let B=[];for(let C of T){let z=[C.x,C.y,0,1];Cl(z,z,X),B.push(new lt(z[0]/z[3],z[1]/z[3]))}return B})(V,Z),x=(function(T,X,B,C){let z=[],f=[],A=C[8]*X,H=C[9]*X,at=C[10]*X,dt=C[11]*X,Wt=C[8]*B,Nt=C[9]*B,Rt=C[10]*B,It=C[11]*B;for(let St of T){let Tt=[],Xt=[];for(let ut of St){let wt=ut.x,vt=ut.y,Ot=C[0]*wt+C[4]*vt+C[12],Lt=C[1]*wt+C[5]*vt+C[13],re=C[2]*wt+C[6]*vt+C[14],ve=C[3]*wt+C[7]*vt+C[15],gl=re+at,_l=ve+dt,ba=Ot+Wt,Vi=Lt+Nt,El=re+Rt,Kl=ve+It,nl=new lt((Ot+A)/_l,(Lt+H)/_l);nl.z=gl/_l,Tt.push(nl);let zl=new lt(ba/Kl,Vi/Kl);zl.z=El/Kl,Xt.push(zl)}z.push(Tt),f.push(Xt)}return[z,f]})(d,F,R,Z);return(function(T,X,B){let C=1/0;P1(B,X)&&(C=IW(B,X[0]));for(let z=0;z<X.length;z++){let f=X[z],A=T[z];for(let H=0;H<f.length-1;H++){let at=f[H],dt=[at,f[H+1],A[H+1],A[H],at];K1(B,dt)&&(C=Math.min(C,IW(B,dt)))}}return C!==1/0&&C})(x[0],x[1],N)}}function fs(i,t){return i.x*t.x+i.y*t.y}function IW(i,t){if(i.length===1){let l=0,n=t[l++],d;for(;!d||n.equals(d);)if(d=t[l++],!d)return 1/0;for(;l<t.length;l++){let s=t[l],b=i[0],Z=d.sub(n),V=s.sub(n),R=b.sub(n),F=fs(Z,Z),N=fs(Z,V),x=fs(V,V),T=fs(R,Z),X=fs(R,V),B=F*x-N*N,C=(x*T-N*X)/B,z=(F*X-N*T)/B,f=n.z*(1-C-z)+d.z*C+s.z*z;if(isFinite(f))return f}return 1/0}{let l=1/0;for(let n of t)l=Math.min(l,n.z);return l}}let Ip=il([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:Up}=Ip,Mp=il([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:Yp}=Mp,xp=Math.cos(Math.PI/180*37.5),UW=Math.pow(2,14)/.5;class Rm{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((l=>l.id)),this.index=t.index,this.hasDependencies=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach((l=>{this.gradients[l.id]={}})),this.layoutVertexArray=new et,this.layoutVertexArray2=new it,this.indexArray=new Yt,this.programConfigurations=new Nn(t.layers,t.zoom),this.segments=new te,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter((l=>l.isStateDependent())).map((l=>l.id))}populate(t,l,n){this.hasDependencies=B0("line",this.layers,l)||this.hasLineDasharray(this.layers);let d=this.layers[0].layout.get("line-sort-key"),s=!d.isConstant(),b=[];for(let{feature:Z,id:V,index:R,sourceLayerIndex:F}of t){let N=this.layers[0]._featureFilter.needGeometry,x=Xa(Z,N);if(!this.layers[0]._featureFilter.filter(new Ge(this.zoom),x,n))continue;let T=s?d.evaluate(x,{},n):void 0,X={id:V,properties:Z.properties,type:Z.type,sourceLayerIndex:F,index:R,geometry:N?x.geometry:tn(Z),patterns:{},dashes:{},sortKey:T};b.push(X)}s&&b.sort(((Z,V)=>Z.sortKey-V.sortKey));for(let Z of b){let{geometry:V,index:R,sourceLayerIndex:F}=Z;this.hasDependencies?(B0("line",this.layers,l)?Wm("line",this.layers,Z,{zoom:this.zoom},l):this.hasLineDasharray(this.layers)&&this.addLineDashDependencies(this.layers,Z,this.zoom,l),this.patternFeatures.push(Z)):this.addFeature(Z,V,R,n,{},{},l.subdivisionGranularity),l.featureIndex.insert(t[R].feature,V,R,F,this.index)}}update(t,l,n,d){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,l,this.stateDependentLayers,{imagePositions:n,dashPositions:d})}addFeatures(t,l,n,d){for(let s of this.patternFeatures)this.addFeature(s,s.geometry,s.index,l,n,d,t.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,Yp)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Up),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(t){if(t.properties&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_end"))return{start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}}addFeature(t,l,n,d,s,b,Z){let V=this.layers[0].layout,R=V.get("line-join").evaluate(t,{}),F=V.get("line-cap"),N=V.get("line-miter-limit"),x=V.get("line-round-limit");this.lineClips=this.lineFeatureClips(t);for(let T of l)this.addLine(T,t,R,F,N,x,d,Z);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,n,{imagePositions:s,dashPositions:b,canonical:d})}addLine(t,l,n,d,s,b,Z,V){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,t=$d(t,Z?V.line.getGranularityForZoomLevel(Z.z):1),this.lineClips){this.lineClipsArray.push(this.lineClips);for(let A=0;A<t.length-1;A++)this.totalDistance+=t[A].dist(t[A+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}let R=ro.types[l.type]==="Polygon",F=t.length;for(;F>=2&&t[F-1].equals(t[F-2]);)F--;let N=0;for(;N<F-1&&t[N].equals(t[N+1]);)N++;if(F<(R?3:2))return;n==="bevel"&&(s=1.05);let x=this.overscaling<=16?122880/(512*this.overscaling):0,T=this.segments.prepareSegment(10*F,this.layoutVertexArray,this.indexArray),X,B,C,z,f;this.e1=this.e2=-1,R&&(X=t[F-2],f=t[N].sub(X)._unit()._perp());for(let A=N;A<F;A++){if(C=A===F-1?R?t[N+1]:void 0:t[A+1],C&&t[A].equals(C))continue;f&&(z=f),X&&(B=X),X=t[A],f=C?C.sub(X)._unit()._perp():z,z=z||f;let H=z.add(f);H.x===0&&H.y===0||H._unit();let at=z.x*f.x+z.y*f.y,dt=H.x*f.x+H.y*f.y,Wt=dt!==0?1/dt:1/0,Nt=2*Math.sqrt(2-2*dt),Rt=dt<xp&&B&&C,It=z.x*f.y-z.y*f.x>0;if(Rt&&A>N){let Xt=X.dist(B);if(Xt>2*x){let ut=X.sub(X.sub(B)._mult(x/Xt)._round());this.updateDistance(B,ut),this.addCurrentVertex(ut,z,0,0,T),B=ut}}let St=B&&C,Tt=St?n:R?"butt":d;if(St&&Tt==="round"&&(Wt<b?Tt="miter":Wt<=2&&(Tt="fakeround")),Tt==="miter"&&Wt>s&&(Tt="bevel"),Tt==="bevel"&&(Wt>2&&(Tt="flipbevel"),Wt<s&&(Tt="miter")),B&&this.updateDistance(B,X),Tt==="miter")H._mult(Wt),this.addCurrentVertex(X,H,0,0,T);else if(Tt==="flipbevel"){if(Wt>100)H=f.mult(-1);else{let Xt=Wt*z.add(f).mag()/z.sub(f).mag();H._perp()._mult(Xt*(It?-1:1))}this.addCurrentVertex(X,H,0,0,T),this.addCurrentVertex(X,H.mult(-1),0,0,T)}else if(Tt==="bevel"||Tt==="fakeround"){let Xt=-Math.sqrt(Wt*Wt-1),ut=It?Xt:0,wt=It?0:Xt;if(B&&this.addCurrentVertex(X,z,ut,wt,T),Tt==="fakeround"){let vt=Math.round(180*Nt/Math.PI/20);for(let Ot=1;Ot<vt;Ot++){let Lt=Ot/vt;if(Lt!==.5){let ve=Lt-.5;Lt+=Lt*ve*(Lt-1)*((1.0904+at*(at*(3.55645-1.43519*at)-3.2452))*ve*ve+(.848013+at*(.215638*at-1.06021)))}let re=f.sub(z)._mult(Lt)._add(z)._unit()._mult(It?-1:1);this.addHalfVertex(X,re.x,re.y,!1,It,0,T)}}C&&this.addCurrentVertex(X,f,-ut,-wt,T)}else if(Tt==="butt")this.addCurrentVertex(X,H,0,0,T);else if(Tt==="square"){let Xt=B?1:-1;this.addCurrentVertex(X,H,Xt,Xt,T)}else Tt==="round"&&(B&&(this.addCurrentVertex(X,z,0,0,T),this.addCurrentVertex(X,z,1,1,T,!0)),C&&(this.addCurrentVertex(X,f,-1,-1,T,!0),this.addCurrentVertex(X,f,0,0,T)));if(Rt&&A<F-1){let Xt=X.dist(C);if(Xt>2*x){let ut=X.add(C.sub(X)._mult(x/Xt)._round());this.updateDistance(X,ut),this.addCurrentVertex(ut,f,0,0,T),X=ut}}}}addCurrentVertex(t,l,n,d,s,b=!1){let Z=l.y*d-l.x,V=-l.y-l.x*d;this.addHalfVertex(t,l.x+l.y*n,l.y-l.x*n,b,!1,n,s),this.addHalfVertex(t,Z,V,b,!0,-d,s),this.distance>UW/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(t,l,n,d,s,b))}addHalfVertex({x:t,y:l},n,d,s,b,Z,V){let R=.5*(this.lineClips?this.scaledDistance*(UW-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((t<<1)+(s?1:0),(l<<1)+(b?1:0),Math.round(63*n)+128,Math.round(63*d)+128,1+(Z===0?0:Z<0?-1:1)|(63&R)<<2,R>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);let F=V.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,F,this.e2),V.primitiveLength++),b?this.e2=F:this.e1=F}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(t,l){this.distance+=t.dist(l),this.updateScaledDistance()}hasLineDasharray(t){for(let l of t){let n=l.paint.get("line-dasharray");if(n&&!n.isConstant())return!0}return!1}addLineDashDependencies(t,l,n,d){for(let s of t){let b=s.paint.get("line-dasharray");if(!b||b.value.kind==="constant")continue;let Z=s.layout.get("line-cap")==="round",V={dasharray:b.value.evaluate({zoom:n-1},l,{}),round:Z},R={dasharray:b.value.evaluate({zoom:n},l,{}),round:Z},F={dasharray:b.value.evaluate({zoom:n+1},l,{}),round:Z},N=`${V.dasharray.join(",")},${V.round}`,x=`${R.dasharray.join(",")},${R.round}`,T=`${F.dasharray.join(",")},${F.round}`;d.dashDependencies[N]=V,d.dashDependencies[x]=R,d.dashDependencies[T]=F,l.dashes[s.id]={min:N,mid:x,max:T}}}}let MW,YW;Qt("LineBucket",Rm,{omit:["layers","patternFeatures"]});var xW={get paint(){return YW=YW||new Dl({"line-opacity":new Dt(D.paint_line["line-opacity"]),"line-color":new Dt(D.paint_line["line-color"]),"line-translate":new At(D.paint_line["line-translate"]),"line-translate-anchor":new At(D.paint_line["line-translate-anchor"]),"line-width":new Dt(D.paint_line["line-width"]),"line-gap-width":new Dt(D.paint_line["line-gap-width"]),"line-offset":new Dt(D.paint_line["line-offset"]),"line-blur":new Dt(D.paint_line["line-blur"]),"line-dasharray":new Hd(D.paint_line["line-dasharray"]),"line-pattern":new Hd(D.paint_line["line-pattern"]),"line-gradient":new Dd(D.paint_line["line-gradient"])})},get layout(){return MW=MW||new Dl({"line-cap":new At(D.layout_line["line-cap"]),"line-join":new Dt(D.layout_line["line-join"]),"line-miter-limit":new At(D.layout_line["line-miter-limit"]),"line-round-limit":new At(D.layout_line["line-round-limit"]),"line-sort-key":new Dt(D.layout_line["line-sort-key"])})}};class Tp extends Dt{possiblyEvaluate(t,l){return l=new Ge(Math.floor(l.zoom),{now:l.now,fadeDuration:l.fadeDuration,zoomHistory:l.zoomHistory,transition:l.transition}),super.possiblyEvaluate(t,l)}evaluate(t,l,n,d){return l=ll({},l,{zoom:Math.floor(l.zoom)}),super.evaluate(t,l,n,d)}}let k0;class Xp extends Ci{constructor(t,l){super(t,xW,l),this.gradientVersion=0,k0||(k0=new Tp(xW.paint.properties["line-width"].specification),k0.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(t){if(t==="line-gradient"){let l=this.gradientExpression();this.stepInterpolant=!!(function(n){return n._styleExpression!==void 0})(l)&&l._styleExpression.expression instanceof vn,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(t,l){super.recalculate(t,l),this.paint._values["line-floorwidth"]=k0.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,t)}createBucket(t){return new Rm(t)}queryRadius(t){let l=t,n=TW(no("line-width",this,l),no("line-gap-width",this,l)),d=no("line-offset",this,l);return n/2+Math.abs(d)+J0(this.paint.get("line-translate"))}queryIntersectsFeature({queryGeometry:t,feature:l,featureState:n,geometry:d,transform:s,pixelsToTileUnits:b}){let Z=y0(t,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),-s.bearingInRadians,b),V=b/2*TW(this.paint.get("line-width").evaluate(l,n),this.paint.get("line-gap-width").evaluate(l,n)),R=this.paint.get("line-offset").evaluate(l,n);return R&&(d=(function(F,N){let x=[];for(let T=0;T<F.length;T++){let X=F[T],B=[];for(let C=0;C<X.length;C++){let z=X[C-1],f=X[C],A=X[C+1],H=C===0?new lt(0,0):f.sub(z)._unit()._perp(),at=C===X.length-1?new lt(0,0):A.sub(f)._unit()._perp(),dt=H._add(at)._unit(),Wt=dt.x*at.x+dt.y*at.y;Wt!==0&&dt._mult(1/Wt),B.push(dt._mult(N)._add(f))}x.push(B)}return x})(d,R*b)),(function(F,N,x){for(let T=0;T<N.length;T++){let X=N[T];if(F.length>=3){for(let B=0;B<X.length;B++)if(ao(F,X[B]))return!0}if(kV(F,X,x))return!0}return!1})(Z,d,V)}isTileClipped(){return!0}}function TW(i,t){return t>0?t+2*i:i}let Jp=il([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),yp=il([{name:"a_projected_pos",components:3,type:"Float32"}],4);il([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);let Bp=il([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);il([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);let XW=il([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Sp=il([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function Cp(i,t,l){return i.sections.forEach((n=>{n.text=(function(d,s,b){let Z=s.layout.get("text-transform").evaluate(b,{});return Z==="uppercase"?d=d.toLocaleUpperCase():Z==="lowercase"&&(d=d.toLocaleLowerCase()),_a.applyArabicShaping&&(d=_a.applyArabicShaping(d)),d})(n.text,t,l)})),i}il([{name:"triangle",components:3,type:"Uint16"}]),il([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),il([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),il([{type:"Float32",name:"offsetX"}]),il([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),il([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);var Tl=24;let _s={"!":"\uFE15","#":"\uFF03",$:"\uFF04","%":"\uFF05","&":"\uFF06","(":"\uFE35",")":"\uFE36","*":"\uFF0A","+":"\uFF0B",",":"\uFE10","-":"\uFE32",".":"\u30FB","/":"\uFF0F",":":"\uFE13",";":"\uFE14","<":"\uFE3F","=":"\uFF1D",">":"\uFE40","?":"\uFE16","@":"\uFF20","[":"\uFE47","\\":"\uFF3C","]":"\uFE48","^":"\uFF3E",_:"\uFE33","`":"\uFF40","{":"\uFE37","|":"\u2015","}":"\uFE38","~":"\uFF5E","\xA2":"\uFFE0","\xA3":"\uFFE1","\xA5":"\uFFE5","\xA6":"\uFFE4","\xAC":"\uFFE2","\xAF":"\uFFE3","\u2013":"\uFE32","\u2014":"\uFE31","\u2018":"\uFE43","\u2019":"\uFE44","\u201C":"\uFE41","\u201D":"\uFE42","\u2026":"\uFE19","\u22EF":"\uFE19","\u2027":"\u30FB","\u20A9":"\uFFE6","\u3001":"\uFE11","\u3002":"\uFE12","\u3008":"\uFE3F","\u3009":"\uFE40","\u300A":"\uFE3D","\u300B":"\uFE3E","\u300C":"\uFE41","\u300D":"\uFE42","\u300E":"\uFE43","\u300F":"\uFE44","\u3010":"\uFE3B","\u3011":"\uFE3C","\u3014":"\uFE39","\u3015":"\uFE3A","\u3016":"\uFE17","\u3017":"\uFE18","\uFF01":"\uFE15","\uFF08":"\uFE35","\uFF09":"\uFE36","\uFF0C":"\uFE10","\uFF0D":"\uFE32","\uFF0E":"\u30FB","\uFF1A":"\uFE13","\uFF1B":"\uFE14","\uFF1C":"\uFE3F","\uFF1E":"\uFE40","\uFF1F":"\uFE16","\uFF3B":"\uFE47","\uFF3D":"\uFE48","\uFF3F":"\uFE33","\uFF5B":"\uFE37","\uFF5C":"\u2015","\uFF5D":"\uFE38","\uFF5F":"\uFE35","\uFF60":"\uFE36","\uFF61":"\uFE12","\uFF62":"\uFE41","\uFF63":"\uFE42"},Qp={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},kp={40:!0};function JW(i,t,l,n,d,s){if("fontStack"in t){let b=l[t.fontStack],Z=b&&b[i];return Z?Z.metrics.advance*t.scale+d:0}{let b=n[t.imageName];return b?b.displaySize[0]*t.scale*Tl/s+d:0}}function yW(i,t,l,n){let d=Math.pow(i-t,2);return n?i<t?d/2:2*d:d+Math.abs(l)*l}function Lp(i,t,l){let n=0;return i===10&&(n-=1e4),l&&(n+=150),i!==40&&i!==65288||(n+=50),t!==41&&t!==65289||(n+=50),n}function BW(i,t,l,n,d,s){let b=null,Z=yW(t,l,d,s);for(let V of n){let R=yW(t-V.x,l,d,s)+V.badness;R<=Z&&(b=V,Z=R)}return{index:i,x:t,priorBreak:b,badness:Z}}function SW(i){return i?SW(i.priorBreak).concat(i.index):[]}class bo{constructor(t="",l=[],n=[]){this.text=t,this.sections=l,this.sectionIndex=n,this.imageSectionID=null}static fromFeature(t,l){let n=new bo;for(let d=0;d<t.sections.length;d++){let s=t.sections[d];s.image?n.addImageSection(s):n.addTextSection(s,l)}return n}length(){return[...this.text].length}getSection(t){return this.sections[this.sectionIndex[t]]}getSectionIndex(t){return this.sectionIndex[t]}verticalizePunctuation(){this.text=(function(t){let l="",n={premature:!0,value:void 0},d=t[Symbol.iterator](),s=d.next(),b=t[Symbol.iterator]();b.next();let Z=b.next();for(;!s.done;)l+=!Z.done&&Ms(Z.value.codePointAt(0))&&!_s[Z.value]||!n.premature&&Ms(n.value.codePointAt(0))&&!_s[n.value]||!_s[s.value]?s.value:_s[s.value],n={value:s.value,premature:!1},s=d.next(),Z=b.next();return l})(this.text)}hasZeroWidthSpaces(){return this.text.includes("\u200B")}trim(){let t=this.text.match(/^\s*/),l=t?t[0].length:0,n=this.text.match(/\S\s*$/),d=n?n[0].length-1:0;this.text=this.text.substring(l,this.text.length-d),this.sectionIndex=this.sectionIndex.slice(l,this.sectionIndex.length-d)}substring(t,l){let n=[...this.text].slice(t,l).join(""),d=this.sectionIndex.slice(t,l);return new bo(n,this.sections,d)}toCodeUnitIndex(t){return[...this.text].slice(0,t).join("").length}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce(((t,l)=>Math.max(t,this.sections[l].scale)),0)}getMaxImageSize(t){let l=0,n=0;for(let d=0;d<this.length();d++){let s=this.getSection(d);if("imageName"in s){let b=t[s.imageName];if(!b)continue;let Z=b.displaySize;l=Math.max(l,Z[0]),n=Math.max(n,Z[1])}}return{maxImageWidth:l,maxImageHeight:n}}addTextSection(t,l){this.text+=t.text,this.sections.push({scale:t.scale||1,verticalAlign:t.verticalAlign||"bottom",fontStack:t.fontStack||l});let n=this.sections.length-1;this.sectionIndex.push(...[...t.text].map((()=>n)))}addImageSection(t){let l=t.image?t.image.name:"";if(l.length===0)return void Le("Can't add FormattedSection with an empty image.");let n=this.getNextImageSectionCharCode();n?(this.text+=String.fromCharCode(n),this.sections.push({scale:1,verticalAlign:t.verticalAlign||"bottom",imageName:l}),this.sectionIndex.push(this.sections.length-1)):Le("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}determineLineBreaks(t,l,n,d,s){let b=[],Z=this.determineAverageLineWidth(t,l,n,d,s),V=this.hasZeroWidthSpaces(),R=0,F=0,N=this.text[Symbol.iterator](),x=N.next(),T=this.text[Symbol.iterator]();T.next();let X=T.next(),B=this.text[Symbol.iterator]();B.next(),B.next();let C=B.next();for(;!x.done;){let z=this.getSection(F),f=x.value.codePointAt(0);if(g0(f)||(R+=JW(f,z,n,d,t,s)),!X.done){let A=qb(f),H=X.value.codePointAt(0);(Qp[f]||A||"imageName"in z||!C.done&&kp[H])&&b.push(BW(F+1,R,Z,b,Lp(f,H,A&&V),!1))}F++,x=N.next(),X=T.next(),C=B.next()}return SW(BW(this.length(),R,Z,b,0,!0))}determineAverageLineWidth(t,l,n,d,s){let b=0,Z=0;for(let V of this.text){let R=this.getSection(Z);b+=JW(V.codePointAt(0),R,n,d,t,s),Z++}return b/Math.max(1,Math.ceil(b/l))}}let um=4294967296,CW=1/um,QW=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");class Fm{constructor(t=new Uint8Array(16)){this.buf=ArrayBuffer.isView(t)?t:new Uint8Array(t),this.dataView=new DataView(this.buf.buffer),this.pos=0,this.type=0,this.length=this.buf.length}readFields(t,l,n=this.length){for(;this.pos<n;){let d=this.readVarint(),s=d>>3,b=this.pos;this.type=7&d,t(s,l,this),this.pos===b&&this.skip(d)}return l}readMessage(t,l){return this.readFields(t,l,this.readVarint()+this.pos)}readFixed32(){let t=this.dataView.getUint32(this.pos,!0);return this.pos+=4,t}readSFixed32(){let t=this.dataView.getInt32(this.pos,!0);return this.pos+=4,t}readFixed64(){let t=this.dataView.getUint32(this.pos,!0)+this.dataView.getUint32(this.pos+4,!0)*um;return this.pos+=8,t}readSFixed64(){let t=this.dataView.getUint32(this.pos,!0)+this.dataView.getInt32(this.pos+4,!0)*um;return this.pos+=8,t}readFloat(){let t=this.dataView.getFloat32(this.pos,!0);return this.pos+=4,t}readDouble(){let t=this.dataView.getFloat64(this.pos,!0);return this.pos+=8,t}readVarint(t){let l=this.buf,n,d;return d=l[this.pos++],n=127&d,d<128?n:(d=l[this.pos++],n|=(127&d)<<7,d<128?n:(d=l[this.pos++],n|=(127&d)<<14,d<128?n:(d=l[this.pos++],n|=(127&d)<<21,d<128?n:(d=l[this.pos],n|=(15&d)<<28,(function(s,b,Z){let V=Z.buf,R,F;if(F=V[Z.pos++],R=(112&F)>>4,F<128||(F=V[Z.pos++],R|=(127&F)<<3,F<128)||(F=V[Z.pos++],R|=(127&F)<<10,F<128)||(F=V[Z.pos++],R|=(127&F)<<17,F<128)||(F=V[Z.pos++],R|=(127&F)<<24,F<128)||(F=V[Z.pos++],R|=(1&F)<<31,F<128))return mo(s,R,b);throw new Error("Expected varint not more than 10 bytes")})(n,t,this)))))}readVarint64(){return this.readVarint(!0)}readSVarint(){let t=this.readVarint();return t%2==1?(t+1)/-2:t/2}readBoolean(){return!!this.readVarint()}readString(){let t=this.readVarint()+this.pos,l=this.pos;return this.pos=t,t-l>=12&&QW?QW.decode(this.buf.subarray(l,t)):(function(n,d,s){let b="",Z=d;for(;Z<s;){let V=n[Z],R,F,N,x=null,T=V>239?4:V>223?3:V>191?2:1;if(Z+T>s)break;T===1?V<128&&(x=V):T===2?(R=n[Z+1],(192&R)==128&&(x=(31&V)<<6|63&R,x<=127&&(x=null))):T===3?(R=n[Z+1],F=n[Z+2],(192&R)==128&&(192&F)==128&&(x=(15&V)<<12|(63&R)<<6|63&F,(x<=2047||x>=55296&&x<=57343)&&(x=null))):T===4&&(R=n[Z+1],F=n[Z+2],N=n[Z+3],(192&R)==128&&(192&F)==128&&(192&N)==128&&(x=(15&V)<<18|(63&R)<<12|(63&F)<<6|63&N,(x<=65535||x>=1114112)&&(x=null))),x===null?(x=65533,T=1):x>65535&&(x-=65536,b+=String.fromCharCode(x>>>10&1023|55296),x=56320|1023&x),b+=String.fromCharCode(x),Z+=T}return b})(this.buf,l,t)}readBytes(){let t=this.readVarint()+this.pos,l=this.buf.subarray(this.pos,t);return this.pos=t,l}readPackedVarint(t=[],l){let n=this.readPackedEnd();for(;this.pos<n;)t.push(this.readVarint(l));return t}readPackedSVarint(t=[]){let l=this.readPackedEnd();for(;this.pos<l;)t.push(this.readSVarint());return t}readPackedBoolean(t=[]){let l=this.readPackedEnd();for(;this.pos<l;)t.push(this.readBoolean());return t}readPackedFloat(t=[]){let l=this.readPackedEnd();for(;this.pos<l;)t.push(this.readFloat());return t}readPackedDouble(t=[]){let l=this.readPackedEnd();for(;this.pos<l;)t.push(this.readDouble());return t}readPackedFixed32(t=[]){let l=this.readPackedEnd();for(;this.pos<l;)t.push(this.readFixed32());return t}readPackedSFixed32(t=[]){let l=this.readPackedEnd();for(;this.pos<l;)t.push(this.readSFixed32());return t}readPackedFixed64(t=[]){let l=this.readPackedEnd();for(;this.pos<l;)t.push(this.readFixed64());return t}readPackedSFixed64(t=[]){let l=this.readPackedEnd();for(;this.pos<l;)t.push(this.readSFixed64());return t}readPackedEnd(){return this.type===2?this.readVarint()+this.pos:this.pos+1}skip(t){let l=7&t;if(l===0)for(;this.buf[this.pos++]>127;);else if(l===2)this.pos=this.readVarint()+this.pos;else if(l===5)this.pos+=4;else{if(l!==1)throw new Error(`Unimplemented type: ${l}`);this.pos+=8}}writeTag(t,l){this.writeVarint(t<<3|l)}realloc(t){let l=this.length||16;for(;l<this.pos+t;)l*=2;if(l!==this.length){let n=new Uint8Array(l);n.set(this.buf),this.buf=n,this.dataView=new DataView(n.buffer),this.length=l}}finish(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)}writeFixed32(t){this.realloc(4),this.dataView.setInt32(this.pos,t,!0),this.pos+=4}writeSFixed32(t){this.realloc(4),this.dataView.setInt32(this.pos,t,!0),this.pos+=4}writeFixed64(t){this.realloc(8),this.dataView.setInt32(this.pos,-1&t,!0),this.dataView.setInt32(this.pos+4,Math.floor(t*CW),!0),this.pos+=8}writeSFixed64(t){this.realloc(8),this.dataView.setInt32(this.pos,-1&t,!0),this.dataView.setInt32(this.pos+4,Math.floor(t*CW),!0),this.pos+=8}writeVarint(t){(t=+t||0)>268435455||t<0?(function(l,n){let d,s;if(l>=0?(d=l%4294967296|0,s=l/4294967296|0):(d=~(-l%4294967296),s=~(-l/4294967296),4294967295^d?d=d+1|0:(d=0,s=s+1|0)),l>=18446744073709552e3||l<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");n.realloc(10),(function(b,Z,V){V.buf[V.pos++]=127&b|128,b>>>=7,V.buf[V.pos++]=127&b|128,b>>>=7,V.buf[V.pos++]=127&b|128,b>>>=7,V.buf[V.pos++]=127&b|128,V.buf[V.pos]=127&(b>>>=7)})(d,0,n),(function(b,Z){let V=(7&b)<<4;Z.buf[Z.pos++]|=V|((b>>>=3)?128:0),b&&(Z.buf[Z.pos++]=127&b|((b>>>=7)?128:0),b&&(Z.buf[Z.pos++]=127&b|((b>>>=7)?128:0),b&&(Z.buf[Z.pos++]=127&b|((b>>>=7)?128:0),b&&(Z.buf[Z.pos++]=127&b|((b>>>=7)?128:0),b&&(Z.buf[Z.pos++]=127&b)))))})(s,n)})(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))}writeSVarint(t){this.writeVarint(t<0?2*-t-1:2*t)}writeBoolean(t){this.writeVarint(+t)}writeString(t){t=String(t),this.realloc(4*t.length),this.pos++;let l=this.pos;this.pos=(function(d,s,b){for(let Z,V,R=0;R<s.length;R++){if(Z=s.charCodeAt(R),Z>55295&&Z<57344){if(!V){Z>56319||R+1===s.length?(d[b++]=239,d[b++]=191,d[b++]=189):V=Z;continue}if(Z<56320){d[b++]=239,d[b++]=191,d[b++]=189,V=Z;continue}Z=V-55296<<10|Z-56320|65536,V=null}else V&&(d[b++]=239,d[b++]=191,d[b++]=189,V=null);Z<128?d[b++]=Z:(Z<2048?d[b++]=Z>>6|192:(Z<65536?d[b++]=Z>>12|224:(d[b++]=Z>>18|240,d[b++]=Z>>12&63|128),d[b++]=Z>>6&63|128),d[b++]=63&Z|128)}return b})(this.buf,t,this.pos);let n=this.pos-l;n>=128&&kW(l,n,this),this.pos=l-1,this.writeVarint(n),this.pos+=n}writeFloat(t){this.realloc(4),this.dataView.setFloat32(this.pos,t,!0),this.pos+=4}writeDouble(t){this.realloc(8),this.dataView.setFloat64(this.pos,t,!0),this.pos+=8}writeBytes(t){let l=t.length;this.writeVarint(l),this.realloc(l);for(let n=0;n<l;n++)this.buf[this.pos++]=t[n]}writeRawMessage(t,l){this.pos++;let n=this.pos;t(l,this);let d=this.pos-n;d>=128&&kW(n,d,this),this.pos=n-1,this.writeVarint(d),this.pos+=d}writeMessage(t,l,n){this.writeTag(t,2),this.writeRawMessage(l,n)}writePackedVarint(t,l){l.length&&this.writeMessage(t,Ep,l)}writePackedSVarint(t,l){l.length&&this.writeMessage(t,zp,l)}writePackedBoolean(t,l){l.length&&this.writeMessage(t,wp,l)}writePackedFloat(t,l){l.length&&this.writeMessage(t,jp,l)}writePackedDouble(t,l){l.length&&this.writeMessage(t,Ap,l)}writePackedFixed32(t,l){l.length&&this.writeMessage(t,vp,l)}writePackedSFixed32(t,l){l.length&&this.writeMessage(t,Hp,l)}writePackedFixed64(t,l){l.length&&this.writeMessage(t,Dp,l)}writePackedSFixed64(t,l){l.length&&this.writeMessage(t,Op,l)}writeBytesField(t,l){this.writeTag(t,2),this.writeBytes(l)}writeFixed32Field(t,l){this.writeTag(t,5),this.writeFixed32(l)}writeSFixed32Field(t,l){this.writeTag(t,5),this.writeSFixed32(l)}writeFixed64Field(t,l){this.writeTag(t,1),this.writeFixed64(l)}writeSFixed64Field(t,l){this.writeTag(t,1),this.writeSFixed64(l)}writeVarintField(t,l){this.writeTag(t,0),this.writeVarint(l)}writeSVarintField(t,l){this.writeTag(t,0),this.writeSVarint(l)}writeStringField(t,l){this.writeTag(t,2),this.writeString(l)}writeFloatField(t,l){this.writeTag(t,5),this.writeFloat(l)}writeDoubleField(t,l){this.writeTag(t,1),this.writeDouble(l)}writeBooleanField(t,l){this.writeVarintField(t,+l)}}function mo(i,t,l){return l?4294967296*t+(i>>>0):4294967296*(t>>>0)+(i>>>0)}function kW(i,t,l){let n=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(7*Math.LN2));l.realloc(n);for(let d=l.pos-1;d>=i;d--)l.buf[d+n]=l.buf[d]}function Ep(i,t){for(let l=0;l<i.length;l++)t.writeVarint(i[l])}function zp(i,t){for(let l=0;l<i.length;l++)t.writeSVarint(i[l])}function jp(i,t){for(let l=0;l<i.length;l++)t.writeFloat(i[l])}function Ap(i,t){for(let l=0;l<i.length;l++)t.writeDouble(i[l])}function wp(i,t){for(let l=0;l<i.length;l++)t.writeBoolean(i[l])}function vp(i,t){for(let l=0;l<i.length;l++)t.writeFixed32(i[l])}function Hp(i,t){for(let l=0;l<i.length;l++)t.writeSFixed32(i[l])}function Dp(i,t){for(let l=0;l<i.length;l++)t.writeFixed64(i[l])}function Op(i,t){for(let l=0;l<i.length;l++)t.writeSFixed64(i[l])}function fp(i,t,l){i===1&&l.readMessage(_p,t)}function _p(i,t,l){if(i===3){let{id:n,bitmap:d,width:s,height:b,left:Z,top:V,advance:R}=l.readMessage(Kp,{});t.push({id:n,bitmap:new zs({width:s+6,height:b+6},d),metrics:{width:s,height:b,left:Z,top:V,advance:R}})}}function Kp(i,t,l){i===1?t.id=l.readVarint():i===2?t.bitmap=l.readBytes():i===3?t.width=l.readVarint():i===4?t.height=l.readVarint():i===5?t.left=l.readSVarint():i===6?t.top=l.readSVarint():i===7&&(t.advance=l.readVarint())}function LW(i){let t=0,l=0;for(let b of i)t+=b.w*b.h,l=Math.max(l,b.w);i.sort(((b,Z)=>Z.h-b.h));let n=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),l),h:1/0}],d=0,s=0;for(let b of i)for(let Z=n.length-1;Z>=0;Z--){let V=n[Z];if(!(b.w>V.w||b.h>V.h)){if(b.x=V.x,b.y=V.y,s=Math.max(s,b.y+b.h),d=Math.max(d,b.x+b.w),b.w===V.w&&b.h===V.h){let R=n.pop();R&&Z<n.length&&(n[Z]=R)}else b.h===V.h?(V.x+=b.w,V.w-=b.w):b.w===V.w?(V.y+=b.h,V.h-=b.h):(n.push({x:V.x+b.w,y:V.y,w:V.w-b.w,h:b.h}),V.y+=b.h,V.h-=b.h);break}}return{w:d,h:s,fill:t/(d*s)||0}}class Gm{constructor(t,{pixelRatio:l,version:n,stretchX:d,stretchY:s,content:b,textFitWidth:Z,textFitHeight:V}){this.paddedRect=t,this.pixelRatio=l,this.stretchX=d,this.stretchY=s,this.content=b,this.version=n,this.textFitWidth=Z,this.textFitHeight=V}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class EW{constructor(t,l){let n={},d={};this.haveRenderCallbacks=[];let s=[];this.addImages(t,n,s),this.addImages(l,d,s);let{w:b,h:Z}=LW(s),V=new Ui({width:b||1,height:Z||1});for(let R in t){let F=t[R],N=n[R].paddedRect;Ui.copy(F.data,V,{x:0,y:0},{x:N.x+1,y:N.y+1},F.data)}for(let R in l){let F=l[R],N=d[R].paddedRect,x=N.x+1,T=N.y+1,X=F.data.width,B=F.data.height;Ui.copy(F.data,V,{x:0,y:0},{x,y:T},F.data),Ui.copy(F.data,V,{x:0,y:B-1},{x,y:T-1},{width:X,height:1}),Ui.copy(F.data,V,{x:0,y:0},{x,y:T+B},{width:X,height:1}),Ui.copy(F.data,V,{x:X-1,y:0},{x:x-1,y:T},{width:1,height:B}),Ui.copy(F.data,V,{x:0,y:0},{x:x+X,y:T},{width:1,height:B})}this.image=V,this.iconPositions=n,this.patternPositions=d}addImages(t,l,n){for(let d in t){let s=t[d],b={x:0,y:0,w:s.data.width+2,h:s.data.height+2};n.push(b),l[d]=new Gm(b,s),s.hasRenderCallback&&this.haveRenderCallbacks.push(d)}}patchUpdatedImages(t,l){t.dispatchRenderCallbacks(this.haveRenderCallbacks);for(let n in t.updatedImages)this.patchUpdatedImage(this.iconPositions[n],t.getImage(n),l),this.patchUpdatedImage(this.patternPositions[n],t.getImage(n),l)}patchUpdatedImage(t,l,n){if(!t||!l||t.version===l.version)return;t.version=l.version;let[d,s]=t.tl;n.update(l.data,void 0,{x:d,y:s})}}var ad;function L0(i,t,l,n,d,s,b,Z,V,R,F,N,x,T,X){let B=bo.fromFeature(i,d),C;N===I.ay.vertical&&B.verticalizePunctuation();let z=B.determineLineBreaks(R,s,t,n,T),{processBidirectionalText:f,processStyledBidirectionalText:A}=_a;if(f&&B.sections.length===1){C=[],z=z.map((Wt=>B.toCodeUnitIndex(Wt)));let dt=f(B.toString(),z);for(let Wt of dt){let Nt=[...Wt].map((()=>0));C.push(new bo(Wt,B.sections,Nt))}}else if(A){C=[],z=z.map((Rt=>B.toCodeUnitIndex(Rt)));let dt=0,Wt=[];for(let Rt of B.text)Wt.push(...Array(Rt.length).fill(B.sectionIndex[dt])),dt++;let Nt=A(B.text,Wt,z);for(let Rt of Nt){let It=[],St="";for(let Tt of Rt[0])It.push(Rt[1][St.length]),St+=Tt;C.push(new bo(Rt[0],B.sections,It))}}else C=(function(dt,Wt){let Nt=[],Rt=0;for(let It of Wt)Nt.push(dt.substring(Rt,It)),Rt=It;return Rt<dt.length()&&Nt.push(dt.substring(Rt,dt.length())),Nt})(B,z);let H=[],at={positionedLines:H,text:B.toString(),top:F[1],bottom:F[1],left:F[0],right:F[0],writingMode:N,iconsInText:!1,verticalizable:!1};return(function(dt,Wt,Nt,Rt,It,St,Tt,Xt,ut,wt,vt,Ot){let Lt=0,re=0,ve=0,gl=0,_l=Xt==="right"?1:Xt==="left"?0:.5,ba=Tl/Ot,Vi=0;for(let nl of It){nl.trim();let zl=nl.getMaxScale(),ii={positionedGlyphs:[],lineOffset:0};dt.positionedLines[Vi]=ii;let ai=ii.positionedGlyphs,Mi=0;if(!nl.length()){re+=St,++Vi;continue}let Pl=Pp(Rt,nl,ba),Yi=0;for(let yl of nl.text){let Ke=nl.getSection(Yi),Rl=yl.codePointAt(0),tl=qp(ut,vt,Rl),Bl={glyph:Rl,imageName:null,x:Lt,y:re+-17,vertical:tl,scale:1,fontStack:"",sectionIndex:nl.getSectionIndex(Yi),metrics:null,rect:null},Mn;if("fontStack"in Ke){if(Mn=$p(Ke,Rl,tl,Pl,Wt,Nt),!Mn)continue;Bl.fontStack=Ke.fontStack}else{if(dt.iconsInText=!0,Ke.scale*=ba,Mn=tg(Ke,tl,zl,Pl,Rt),!Mn)continue;Mi=Math.max(Mi,Mn.imageOffset),Bl.imageName=Ke.imageName}let{rect:Ba,metrics:dr,baselineOffset:sd}=Mn;Bl.y+=sd,Bl.scale=Ke.scale,Bl.metrics=dr,Bl.rect=Ba,ai.push(Bl),tl?(dt.verticalizable=!0,Lt+=("imageName"in Ke?dr.advance:Tl)*Ke.scale+wt):Lt+=dr.advance*Ke.scale+wt,Yi++}ai.length!==0&&(ve=Math.max(Lt-wt,ve),eg(ai,0,ai.length-1,_l)),Lt=0,ii.lineOffset=Math.max(Mi,(zl-1)*Tl);let ma=St*zl+Mi;re+=ma,gl=Math.max(ma,gl),++Vi}let{horizontalAlign:El,verticalAlign:Kl}=Nm(Tt);(function(nl,zl,ii,ai,Mi,Pl,Yi,ma,yl){let Ke=(zl-ii)*Mi,Rl=0;Rl=Pl!==Yi?-ma*ai- -17:-ai*yl*Yi+.5*Yi;for(let tl of nl)for(let Bl of tl.positionedGlyphs)Bl.x+=Ke,Bl.y+=Rl})(dt.positionedLines,_l,El,Kl,ve,gl,St,re,It.length),dt.top+=-Kl*re,dt.bottom=dt.top+re,dt.left+=-El*ve,dt.right=dt.left+ve})(at,t,l,n,C,b,Z,V,N,R,x,X),!(function(dt){for(let Wt of dt)if(Wt.positionedGlyphs.length!==0)return!1;return!0})(H)&&at}function Nm(i){let t=.5,l=.5;switch(i){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(i){case"bottom":case"bottom-right":case"bottom-left":l=1;break;case"top":case"top-right":case"top-left":l=0}return{horizontalAlign:t,verticalAlign:l}}function Pp(i,t,l){let n=t.getMaxScale()*Tl,{maxImageWidth:d,maxImageHeight:s}=t.getMaxImageSize(i),b=Math.max(n,s*l);return{verticalLineContentWidth:Math.max(n,d*l),horizontalLineContentHeight:b}}function zW(i){switch(i){case"top":return 0;case"center":return .5;default:return 1}}function qp(i,t,l){return!(i===I.ay.horizontal||!t&&!ed(l)||t&&(g0(l)||(n=l,/\p{sc=Arab}/u.test(String.fromCodePoint(n)))));var n}function $p(i,t,l,n,d,s){let b=s[i.fontStack],Z=(function(R,F,N,x){if(R&&R.rect)return R;let T=F[N.fontStack],X=T&&T[x];return X?{rect:null,metrics:X.metrics}:null})(b&&b[t],d,i,t);if(Z===null)return null;let V;if(l)V=n.verticalLineContentWidth-i.scale*Tl;else{let R=zW(i.verticalAlign);V=(n.horizontalLineContentHeight-i.scale*Tl)*R}return{rect:Z.rect,metrics:Z.metrics,baselineOffset:V}}function tg(i,t,l,n,d){let s=d[i.imageName];if(!s)return null;let b=s.paddedRect,Z=s.displaySize,V={width:Z[0],height:Z[1],left:1,top:-3,advance:t?Z[1]:Z[0]},R;if(t)R=n.verticalLineContentWidth-Z[1]*i.scale;else{let F=zW(i.verticalAlign);R=(n.horizontalLineContentHeight-Z[1]*i.scale)*F}return{rect:b,metrics:V,baselineOffset:R,imageOffset:(t?Z[0]:Z[1])*i.scale-Tl*l}}function eg(i,t,l,n){if(n===0)return;let d=i[l],s=(i[l].x+d.metrics.advance*d.scale)*n;for(let b=t;b<=l;b++)i[b].x-=s}function lg(i,t,l){let{horizontalAlign:n,verticalAlign:d}=Nm(l),s=t[0]-i.displaySize[0]*n,b=t[1]-i.displaySize[1]*d;return{image:i,top:b,bottom:b+i.displaySize[1],left:s,right:s+i.displaySize[0]}}function jW(i){var t,l;let n=i.left,d=i.top,s=i.right-n,b=i.bottom-d,Z=(t=i.image.textFitWidth)!==null&&t!==void 0?t:"stretchOrShrink",V=(l=i.image.textFitHeight)!==null&&l!==void 0?l:"stretchOrShrink",R=(i.image.content[2]-i.image.content[0])/(i.image.content[3]-i.image.content[1]);if(V==="proportional"){if(Z==="stretchOnly"&&s/b<R||Z==="proportional"){let F=Math.ceil(b*R);n*=F/s,s=F}}else if(Z==="proportional"&&V==="stretchOnly"&&R!==0&&s/b>R){let F=Math.ceil(s/R);d*=F/b,b=F}return{x1:n,y1:d,x2:n+s,y2:d+b}}function AW(i,t,l,n,d,s){let b=i.image,Z;if(b.content){let C=b.content,z=b.pixelRatio||1;Z=[C[0]/z,C[1]/z,b.displaySize[0]-C[2]/z,b.displaySize[1]-C[3]/z]}let V=t.left*s,R=t.right*s,F,N,x,T;l==="width"||l==="both"?(T=d[0]+V-n[3],N=d[0]+R+n[1]):(T=d[0]+(V+R-b.displaySize[0])/2,N=T+b.displaySize[0]);let X=t.top*s,B=t.bottom*s;return l==="height"||l==="both"?(F=d[1]+X-n[0],x=d[1]+B+n[2]):(F=d[1]+(X+B-b.displaySize[1])/2,x=F+b.displaySize[1]),{image:b,top:F,right:N,bottom:x,left:T,collisionPadding:Z}}Qt("ImagePosition",Gm),Qt("ImageAtlas",EW),I.ay=void 0,(ad=I.ay||(I.ay={}))[ad.none=0]="none",ad[ad.horizontal=1]="horizontal",ad[ad.vertical=2]="vertical",ad[ad.horizontalOnly=3]="horizontalOnly";let In=128,nd=32640;function wW(i,t){let{expression:l}=t;if(l.kind==="constant")return{kind:"constant",layoutSize:l.evaluate(new Ge(i+1))};if(l.kind==="source")return{kind:"source"};{let{zoomStops:n,interpolationType:d}=l,s=0;for(;s<n.length&&n[s]<=i;)s++;s=Math.max(0,s-1);let b=s;for(;b<n.length&&n[b]<i+1;)b++;b=Math.min(n.length-1,b);let Z=n[s],V=n[b];return l.kind==="composite"?{kind:"composite",minZoom:Z,maxZoom:V,interpolationType:d}:{kind:"camera",minZoom:Z,maxZoom:V,minSize:l.evaluate(new Ge(Z)),maxSize:l.evaluate(new Ge(V)),interpolationType:d}}}function Im(i,t,l){let n="never",d=i.get(t);return d?n=d:i.get(l)&&(n="always"),n}let ig=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function E0(i,t,l,n,d,s,b,Z,V,R,F,N,x){let T=Z?Math.min(nd,Math.round(Z[0])):0,X=Z?Math.min(nd,Math.round(Z[1])):0;i.emplaceBack(t,l,Math.round(32*n),Math.round(32*d),s,b,(T<<1)+(V?1:0),X,16*R,16*F,256*N,256*x)}function Um(i,t,l){i.emplaceBack(t.x,t.y,l),i.emplaceBack(t.x,t.y,l),i.emplaceBack(t.x,t.y,l),i.emplaceBack(t.x,t.y,l)}function ag(i){for(let t of i.sections)if(F0(t.text))return!0;return!1}class Mm{constructor(t){this.layoutVertexArray=new ht,this.indexArray=new Yt,this.programConfigurations=t,this.segments=new te,this.dynamicLayoutVertexArray=new bt,this.opacityVertexArray=new mt,this.hasVisibleVertices=!1,this.placedSymbolArray=new u}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(t,l,n,d){this.isEmpty()||(n&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Jp.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,l),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,yp.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,ig,!0),this.opacityVertexBuffer.itemSize=1),(n||d)&&this.programConfigurations.upload(t))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}Qt("SymbolBuffers",Mm);class Ym{constructor(t,l,n){this.layoutVertexArray=new t,this.layoutAttributes=l,this.indexArray=new n,this.segments=new te,this.collisionVertexArray=new Jt}upload(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,Bp.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}Qt("CollisionBuffers",Ym);class Wo{constructor(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((b=>b.id)),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasDependencies=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[];let l=this.layers[0]._unevaluatedLayout._values;this.textSizeData=wW(this.zoom,l["text-size"]),this.iconSizeData=wW(this.zoom,l["icon-size"]);let n=this.layers[0].layout,d=n.get("symbol-sort-key"),s=n.get("symbol-z-order");this.canOverlap=Im(n,"text-overlap","text-allow-overlap")!=="never"||Im(n,"icon-overlap","icon-allow-overlap")!=="never"||n.get("text-ignore-placement")||n.get("icon-ignore-placement"),this.sortFeaturesByKey=s!=="viewport-y"&&!d.isConstant(),this.sortFeaturesByY=(s==="viewport-y"||s==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,n.get("symbol-placement")==="point"&&(this.writingModes=n.get("text-writing-mode").map((b=>I.ay[b]))),this.stateDependentLayerIds=this.layers.filter((b=>b.isStateDependent())).map((b=>b.id)),this.sourceID=t.sourceID}createArrays(){this.text=new Mm(new Nn(this.layers,this.zoom,(t=>/^text/.test(t)))),this.icon=new Mm(new Nn(this.layers,this.zoom,(t=>/^icon/.test(t)))),this.glyphOffsetArray=new y,this.lineVertexArray=new J,this.symbolInstances=new Y,this.textAnchorOffsets=new L}calculateGlyphDependencies(t,l,n,d,s){for(let b of t)if(l[b.codePointAt(0)]=!0,(n||d)&&s){let Z=_s[b];Z&&(l[Z.codePointAt(0)]=!0)}}populate(t,l,n){let d=this.layers[0],s=d.layout,b=s.get("text-font"),Z=s.get("text-field"),V=s.get("icon-image"),R=(Z.value.kind!=="constant"||Z.value.value instanceof Zl&&!Z.value.value.isEmpty()||Z.value.value.toString().length>0)&&(b.value.kind!=="constant"||b.value.value.length>0),F=V.value.kind!=="constant"||!!V.value.value||Object.keys(V.parameters).length>0,N=s.get("symbol-sort-key");if(this.features=[],!R&&!F)return;let x=l.iconDependencies,T=l.glyphDependencies,X=l.availableImages,B=new Ge(this.zoom);for(let{feature:C,id:z,index:f,sourceLayerIndex:A}of t){let H=d._featureFilter.needGeometry,at=Xa(C,H);if(!d._featureFilter.filter(B,at,n))continue;let dt,Wt;if(H||(at.geometry=tn(C)),R){let Rt=d.getValueAndResolveTokens("text-field",at,n,X),It=Zl.factory(Rt),St=this.hasRTLText=this.hasRTLText||ag(It);(!St||_a.getRTLTextPluginStatus()==="unavailable"||St&&_a.isParsed())&&(dt=Cp(It,d,at))}if(F){let Rt=d.getValueAndResolveTokens("icon-image",at,n,X);Wt=Rt instanceof bi?Rt:bi.fromString(Rt)}if(!dt&&!Wt)continue;let Nt=this.sortFeaturesByKey?N.evaluate(at,{},n):void 0;if(this.features.push({id:z,text:dt,icon:Wt,index:f,sourceLayerIndex:A,geometry:at.geometry,properties:C.properties,type:ro.types[C.type],sortKey:Nt}),Wt&&(x[Wt.name]=!0),dt){let Rt=b.evaluate(at,{},n).join(","),It=s.get("text-rotation-alignment")!=="viewport"&&s.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(I.ay.vertical)>=0;for(let St of dt.sections)if(St.image)x[St.image.name]=!0;else{let Tt=Ad(dt.toString()),Xt=St.fontStack||Rt,ut=T[Xt]=T[Xt]||{};this.calculateGlyphDependencies(St.text,ut,It,this.allowVerticalPlacement,Tt)}}}s.get("symbol-placement")==="line"&&(this.features=(function(C){let z={},f={},A=[],H=0;function at(Rt){A.push(C[Rt]),H++}function dt(Rt,It,St){let Tt=f[Rt];return delete f[Rt],f[It]=Tt,A[Tt].geometry[0].pop(),A[Tt].geometry[0]=A[Tt].geometry[0].concat(St[0]),Tt}function Wt(Rt,It,St){let Tt=z[It];return delete z[It],z[Rt]=Tt,A[Tt].geometry[0].shift(),A[Tt].geometry[0]=St[0].concat(A[Tt].geometry[0]),Tt}function Nt(Rt,It,St){let Tt=St?It[0][It[0].length-1]:It[0][0];return`${Rt}:${Tt.x}:${Tt.y}`}for(let Rt=0;Rt<C.length;Rt++){let It=C[Rt],St=It.geometry,Tt=It.text?It.text.toString():null;if(!Tt){at(Rt);continue}let Xt=Nt(Tt,St),ut=Nt(Tt,St,!0);if(Xt in f&&ut in z&&f[Xt]!==z[ut]){let wt=Wt(Xt,ut,St),vt=dt(Xt,ut,A[wt].geometry);delete z[Xt],delete f[ut],f[Nt(Tt,A[vt].geometry,!0)]=vt,A[wt].geometry=null}else Xt in f?dt(Xt,ut,St):ut in z?Wt(Xt,ut,St):(at(Rt),z[Xt]=H-1,f[ut]=H-1)}return A.filter((Rt=>Rt.geometry))})(this.features)),this.sortFeaturesByKey&&this.features.sort(((C,z)=>C.sortKey-z.sortKey))}update(t,l,n){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(t,l,this.layers,{imagePositions:n}),this.icon.programConfigurations.updatePaintArrays(t,l,this.layers,{imagePositions:n}))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(t,l){let n=this.lineVertexArray.length;if(t.segment!==void 0){let d=t.dist(l[t.segment+1]),s=t.dist(l[t.segment]),b={};for(let Z=t.segment+1;Z<l.length;Z++)b[Z]={x:l[Z].x,y:l[Z].y,tileUnitDistanceFromAnchor:d},Z<l.length-1&&(d+=l[Z+1].dist(l[Z]));for(let Z=t.segment||0;Z>=0;Z--)b[Z]={x:l[Z].x,y:l[Z].y,tileUnitDistanceFromAnchor:s},Z>0&&(s+=l[Z-1].dist(l[Z]));for(let Z=0;Z<l.length;Z++){let V=b[Z];this.lineVertexArray.emplaceBack(V.x,V.y,V.tileUnitDistanceFromAnchor)}}return{lineStartIndex:n,lineLength:this.lineVertexArray.length-n}}addSymbols(t,l,n,d,s,b,Z,V,R,F,N,x){let T=t.indexArray,X=t.layoutVertexArray,B=t.segments.prepareSegment(4*l.length,X,T,this.canOverlap?b.sortKey:void 0),C=this.glyphOffsetArray.length,z=B.vertexLength,f=this.allowVerticalPlacement&&Z===I.ay.vertical?Math.PI/2:0,A=b.text&&b.text.sections;for(let H=0;H<l.length;H++){let{tl:at,tr:dt,bl:Wt,br:Nt,tex:Rt,pixelOffsetTL:It,pixelOffsetBR:St,minFontScaleX:Tt,minFontScaleY:Xt,glyphOffset:ut,isSDF:wt,sectionIndex:vt}=l[H],Ot=B.vertexLength,Lt=ut[1];E0(X,V.x,V.y,at.x,Lt+at.y,Rt.x,Rt.y,n,wt,It.x,It.y,Tt,Xt),E0(X,V.x,V.y,dt.x,Lt+dt.y,Rt.x+Rt.w,Rt.y,n,wt,St.x,It.y,Tt,Xt),E0(X,V.x,V.y,Wt.x,Lt+Wt.y,Rt.x,Rt.y+Rt.h,n,wt,It.x,St.y,Tt,Xt),E0(X,V.x,V.y,Nt.x,Lt+Nt.y,Rt.x+Rt.w,Rt.y+Rt.h,n,wt,St.x,St.y,Tt,Xt),Um(t.dynamicLayoutVertexArray,V,f),T.emplaceBack(Ot,Ot+2,Ot+1),T.emplaceBack(Ot+1,Ot+2,Ot+3),B.vertexLength+=4,B.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(ut[0]),H!==l.length-1&&vt===l[H+1].sectionIndex||t.programConfigurations.populatePaintArrays(X.length,b,b.index,{imagePositions:{},canonical:x,formattedSection:A&&A[vt]})}t.placedSymbolArray.emplaceBack(V.x,V.y,C,this.glyphOffsetArray.length-C,z,R,F,V.segment,n?n[0]:0,n?n[1]:0,d[0],d[1],Z,0,!1,0,N)}_addCollisionDebugVertex(t,l,n,d,s,b){return l.emplaceBack(0,0),t.emplaceBack(n.x,n.y,d,s,Math.round(b.x),Math.round(b.y))}addCollisionDebugVertices(t,l,n,d,s,b,Z){let V=s.segments.prepareSegment(4,s.layoutVertexArray,s.indexArray),R=V.vertexLength,F=s.layoutVertexArray,N=s.collisionVertexArray,x=Z.anchorX,T=Z.anchorY;this._addCollisionDebugVertex(F,N,b,x,T,new lt(t,l)),this._addCollisionDebugVertex(F,N,b,x,T,new lt(n,l)),this._addCollisionDebugVertex(F,N,b,x,T,new lt(n,d)),this._addCollisionDebugVertex(F,N,b,x,T,new lt(t,d)),V.vertexLength+=4;let X=s.indexArray;X.emplaceBack(R,R+1),X.emplaceBack(R+1,R+2),X.emplaceBack(R+2,R+3),X.emplaceBack(R+3,R),V.primitiveLength+=4}addDebugCollisionBoxes(t,l,n,d){for(let s=t;s<l;s++){let b=this.collisionBoxArray.get(s);this.addCollisionDebugVertices(b.x1,b.y1,b.x2,b.y2,d?this.textCollisionBox:this.iconCollisionBox,b.anchorPoint,n)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Ym(Zt,XW.members,Gt),this.iconCollisionBox=new Ym(Zt,XW.members,Gt);for(let t=0;t<this.symbolInstances.length;t++){let l=this.symbolInstances.get(t);this.addDebugCollisionBoxes(l.textBoxStartIndex,l.textBoxEndIndex,l,!0),this.addDebugCollisionBoxes(l.verticalTextBoxStartIndex,l.verticalTextBoxEndIndex,l,!0),this.addDebugCollisionBoxes(l.iconBoxStartIndex,l.iconBoxEndIndex,l,!1),this.addDebugCollisionBoxes(l.verticalIconBoxStartIndex,l.verticalIconBoxEndIndex,l,!1)}}_deserializeCollisionBoxesForSymbol(t,l,n,d,s,b,Z,V,R){let F={};for(let N=l;N<n;N++){let x=t.get(N);F.textBox={x1:x.x1,y1:x.y1,x2:x.x2,y2:x.y2,anchorPointX:x.anchorPointX,anchorPointY:x.anchorPointY},F.textFeatureIndex=x.featureIndex;break}for(let N=d;N<s;N++){let x=t.get(N);F.verticalTextBox={x1:x.x1,y1:x.y1,x2:x.x2,y2:x.y2,anchorPointX:x.anchorPointX,anchorPointY:x.anchorPointY},F.verticalTextFeatureIndex=x.featureIndex;break}for(let N=b;N<Z;N++){let x=t.get(N);F.iconBox={x1:x.x1,y1:x.y1,x2:x.x2,y2:x.y2,anchorPointX:x.anchorPointX,anchorPointY:x.anchorPointY},F.iconFeatureIndex=x.featureIndex;break}for(let N=V;N<R;N++){let x=t.get(N);F.verticalIconBox={x1:x.x1,y1:x.y1,x2:x.x2,y2:x.y2,anchorPointX:x.anchorPointX,anchorPointY:x.anchorPointY},F.verticalIconFeatureIndex=x.featureIndex;break}return F}deserializeCollisionBoxes(t){this.collisionArrays=[];for(let l=0;l<this.symbolInstances.length;l++){let n=this.symbolInstances.get(l);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,n.textBoxStartIndex,n.textBoxEndIndex,n.verticalTextBoxStartIndex,n.verticalTextBoxEndIndex,n.iconBoxStartIndex,n.iconBoxEndIndex,n.verticalIconBoxStartIndex,n.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(t,l){let n=t.placedSymbolArray.get(l),d=n.vertexStartIndex+4*n.numGlyphs;for(let s=n.vertexStartIndex;s<d;s+=4)t.indexArray.emplaceBack(s,s+2,s+1),t.indexArray.emplaceBack(s+1,s+2,s+3)}getSortedSymbolIndexes(t){if(this.sortedAngle===t&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;let l=Math.sin(t),n=Math.cos(t),d=[],s=[],b=[];for(let Z=0;Z<this.symbolInstances.length;++Z){b.push(Z);let V=this.symbolInstances.get(Z);d.push(0|Math.round(l*V.anchorX+n*V.anchorY)),s.push(V.featureIndex)}return b.sort(((Z,V)=>d[Z]-d[V]||s[V]-s[Z])),b}addToSortKeyRanges(t,l){let n=this.sortKeyRanges[this.sortKeyRanges.length-1];n&&n.sortKey===l?n.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:l,symbolInstanceStart:t,symbolInstanceEnd:t+1})}sortFeatures(t){if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(let l of this.symbolInstanceIndexes){let n=this.symbolInstances.get(l);this.featureSortOrder.push(n.featureIndex),[n.rightJustifiedTextSymbolIndex,n.centerJustifiedTextSymbolIndex,n.leftJustifiedTextSymbolIndex].forEach(((d,s,b)=>{d>=0&&b.indexOf(d)===s&&this.addIndicesForPlacedSymbol(this.text,d)})),n.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,n.verticalPlacedTextSymbolIndex),n.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,n.placedIconSymbolIndex),n.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,n.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let vW,HW;Qt("SymbolBucket",Wo,{omit:["layers","collisionBoxArray","features","compareText"]}),Wo.MAX_GLYPHS=65535,Wo.addDynamicAttributes=Um;var xm={get paint(){return HW=HW||new Dl({"icon-opacity":new Dt(D.paint_symbol["icon-opacity"]),"icon-color":new Dt(D.paint_symbol["icon-color"]),"icon-halo-color":new Dt(D.paint_symbol["icon-halo-color"]),"icon-halo-width":new Dt(D.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Dt(D.paint_symbol["icon-halo-blur"]),"icon-translate":new At(D.paint_symbol["icon-translate"]),"icon-translate-anchor":new At(D.paint_symbol["icon-translate-anchor"]),"text-opacity":new Dt(D.paint_symbol["text-opacity"]),"text-color":new Dt(D.paint_symbol["text-color"],{runtimeType:ri,getOverride:i=>i.textColor,hasOverride:i=>!!i.textColor}),"text-halo-color":new Dt(D.paint_symbol["text-halo-color"]),"text-halo-width":new Dt(D.paint_symbol["text-halo-width"]),"text-halo-blur":new Dt(D.paint_symbol["text-halo-blur"]),"text-translate":new At(D.paint_symbol["text-translate"]),"text-translate-anchor":new At(D.paint_symbol["text-translate-anchor"])})},get layout(){return vW=vW||new Dl({"symbol-placement":new At(D.layout_symbol["symbol-placement"]),"symbol-spacing":new At(D.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new At(D.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Dt(D.layout_symbol["symbol-sort-key"]),"symbol-z-order":new At(D.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new At(D.layout_symbol["icon-allow-overlap"]),"icon-overlap":new At(D.layout_symbol["icon-overlap"]),"icon-ignore-placement":new At(D.layout_symbol["icon-ignore-placement"]),"icon-optional":new At(D.layout_symbol["icon-optional"]),"icon-rotation-alignment":new At(D.layout_symbol["icon-rotation-alignment"]),"icon-size":new Dt(D.layout_symbol["icon-size"]),"icon-text-fit":new At(D.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new At(D.layout_symbol["icon-text-fit-padding"]),"icon-image":new Dt(D.layout_symbol["icon-image"]),"icon-rotate":new Dt(D.layout_symbol["icon-rotate"]),"icon-padding":new Dt(D.layout_symbol["icon-padding"]),"icon-keep-upright":new At(D.layout_symbol["icon-keep-upright"]),"icon-offset":new Dt(D.layout_symbol["icon-offset"]),"icon-anchor":new Dt(D.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new At(D.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new At(D.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new At(D.layout_symbol["text-rotation-alignment"]),"text-field":new Dt(D.layout_symbol["text-field"]),"text-font":new Dt(D.layout_symbol["text-font"]),"text-size":new Dt(D.layout_symbol["text-size"]),"text-max-width":new Dt(D.layout_symbol["text-max-width"]),"text-line-height":new At(D.layout_symbol["text-line-height"]),"text-letter-spacing":new Dt(D.layout_symbol["text-letter-spacing"]),"text-justify":new Dt(D.layout_symbol["text-justify"]),"text-radial-offset":new Dt(D.layout_symbol["text-radial-offset"]),"text-variable-anchor":new At(D.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new Dt(D.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new Dt(D.layout_symbol["text-anchor"]),"text-max-angle":new At(D.layout_symbol["text-max-angle"]),"text-writing-mode":new At(D.layout_symbol["text-writing-mode"]),"text-rotate":new Dt(D.layout_symbol["text-rotate"]),"text-padding":new At(D.layout_symbol["text-padding"]),"text-keep-upright":new At(D.layout_symbol["text-keep-upright"]),"text-transform":new Dt(D.layout_symbol["text-transform"]),"text-offset":new Dt(D.layout_symbol["text-offset"]),"text-allow-overlap":new At(D.layout_symbol["text-allow-overlap"]),"text-overlap":new At(D.layout_symbol["text-overlap"]),"text-ignore-placement":new At(D.layout_symbol["text-ignore-placement"]),"text-optional":new At(D.layout_symbol["text-optional"])})}};class DW{constructor(t){if(t.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=t.property.overrides?t.property.overrides.runtimeType:Je,this.defaultValue=t}evaluate(t){if(t.formattedSection){let l=this.defaultValue.property.overrides;if(l&&l.hasOverride(t.formattedSection))return l.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default}eachChild(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Qt("FormatSectionOverride",DW,{omit:["defaultValue"]});class z0 extends Ci{constructor(t,l){super(t,xm,l)}recalculate(t,l){if(super.recalculate(t,l),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){let n=this.layout.get("text-writing-mode");if(n){let d=[];for(let s of n)d.indexOf(s)<0&&d.push(s);this.layout._values["text-writing-mode"]=d}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(t,l,n,d){let s=this.layout.get(t).evaluate(l,{},n,d),b=this._unevaluatedLayout._values[t];return b.isDataDriven()||zc(b.value)||!s?s:(function(Z,V){return V.replace(/{([^{}]+)}/g,((R,F)=>Z&&F in Z?String(Z[F]):""))})(l.properties,s)}createBucket(t){return new Wo(t)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(let t of xm.paint.overridableProperties){if(!z0.hasPaintOverride(this.layout,t))continue;let l=this.paint.get(t),n=new DW(l),d=new Ec(n,l.property.specification),s=null;s=l.value.kind==="constant"||l.value.kind==="source"?new Zn("source",d):new Ac("composite",d,l.value.zoomStops),this.paint._values[t]=new _i(l.property,s,l.parameters)}}_handleOverridablePaintPropertyUpdate(t,l,n){return!(!this.layout||l.isDataDriven()||n.isDataDriven())&&z0.hasPaintOverride(this.layout,t)}static hasPaintOverride(t,l){let n=t.get("text-field"),d=xm.paint.properties[l],s=!1,b=Z=>{for(let V of Z)if(d.overrides&&d.overrides.hasOverride(V))return void(s=!0)};if(n.value.kind==="constant"&&n.value.value instanceof Zl)b(n.value.value.sections);else if(n.value.kind==="source"||n.value.kind==="composite"){let Z=R=>{s||(R instanceof Da&&je(R.value)===Cn?b(R.value.sections):R instanceof sn?b(R.sections):R.eachChild(Z))},V=n.value;V._styleExpression&&Z(V._styleExpression.expression)}return s}}let OW;var ng={get paint(){return OW=OW||new Dl({"background-color":new At(D.paint_background["background-color"]),"background-pattern":new I0(D.paint_background["background-pattern"]),"background-opacity":new At(D.paint_background["background-opacity"])})}};class dg extends Ci{constructor(t,l){super(t,ng,l)}}class cg extends Ci{constructor(t,l){super(t,{},l),this.onAdd=n=>{this.implementation.onAdd&&this.implementation.onAdd(n,n.painter.context.gl)},this.onRemove=n=>{this.implementation.onRemove&&this.implementation.onRemove(n,n.painter.context.gl)},this.implementation=t}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class og{constructor(t){this._methodToThrottle=t,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout((()=>{this._triggered=!1,this._methodToThrottle()}),0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}let sg={once:!0},Tm=63710088e-1;class dd{constructor(t,l){if(isNaN(t)||isNaN(l))throw new Error(`Invalid LngLat object: (${t}, ${l})`);if(this.lng=+t,this.lat=+l,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new dd(ml(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(t){let l=Math.PI/180,n=this.lat*l,d=t.lat*l,s=Math.sin(n)*Math.sin(d)+Math.cos(n)*Math.cos(d)*Math.cos((t.lng-this.lng)*l);return Tm*Math.acos(Math.min(s,1))}static convert(t){if(t instanceof dd)return t;if(Array.isArray(t)&&(t.length===2||t.length===3))return new dd(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&typeof t=="object"&&t!==null)return new dd(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}let fW=2*Math.PI*Tm;function _W(i){return fW*Math.cos(i*Math.PI/180)}function KW(i){return(180+i)/360}function PW(i){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i*Math.PI/360)))/360}function qW(i,t){return i/_W(t)}function $W(i){return 360*i-180}function j0(i){return 360/Math.PI*Math.atan(Math.exp((180-360*i)*Math.PI/180))-90}function tZ(i,t){return i*_W(j0(t))}class Ks{constructor(t,l,n=0){this.x=+t,this.y=+l,this.z=+n}static fromLngLat(t,l=0){let n=dd.convert(t);return new Ks(KW(n.lng),PW(n.lat),qW(l,n.lat))}toLngLat(){return new dd($W(this.x),j0(this.y))}toAltitude(){return tZ(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/fW*(t=j0(this.y),1/Math.cos(t*Math.PI/180));var t}}function eZ(i,t,l){var n=2*Math.PI*6378137/256/Math.pow(2,l);return[i*n-2*Math.PI*6378137/2,t*n-2*Math.PI*6378137/2]}class Xm{constructor(t,l,n){if(!(function(d,s,b){return!(d<0||d>25||b<0||b>=Math.pow(2,d)||s<0||s>=Math.pow(2,d))})(t,l,n))throw new Error(`x=${l}, y=${n}, z=${t} outside of bounds. 0<=x<${Math.pow(2,t)}, 0<=y<${Math.pow(2,t)} 0<=z<=25 `);this.z=t,this.x=l,this.y=n,this.key=Zo(0,t,t,l,n)}equals(t){return this.z===t.z&&this.x===t.x&&this.y===t.y}url(t,l,n){let d=(b=this.y,Z=this.z,V=eZ(256*(s=this.x),256*(b=Math.pow(2,Z)-b-1),Z),R=eZ(256*(s+1),256*(b+1),Z),V[0]+","+V[1]+","+R[0]+","+R[1]);var s,b,Z,V,R;let F=(function(N,x,T){let X,B="";for(let C=N;C>0;C--)X=1<<C-1,B+=(x&X?1:0)+(T&X?2:0);return B})(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(n==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,l>1?"@2x":"").replace(/{quadkey}/g,F).replace(/{bbox-epsg-3857}/g,d)}isChildOf(t){let l=this.z-t.z;return l>0&&t.x===this.x>>l&&t.y===this.y>>l}getTilePoint(t){let l=Math.pow(2,this.z);return new lt((t.x*l-this.x)*se,(t.y*l-this.y)*se)}toString(){return`${this.z}/${this.x}/${this.y}`}}class lZ{constructor(t,l){this.wrap=t,this.canonical=l,this.key=Zo(t,l.z,l.z,l.x,l.y)}}class Ki{constructor(t,l,n,d,s){if(this.terrainRttPosMatrix32f=null,t<n)throw new Error(`overscaledZ should be >= z; overscaledZ = ${t}; z = ${n}`);this.overscaledZ=t,this.wrap=l,this.canonical=new Xm(n,+d,+s),this.key=Zo(l,t,n,d,s)}clone(){return new Ki(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)}scaledTo(t){if(t>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${t}; overscaledZ = ${this.overscaledZ}`);let l=this.canonical.z-t;return t>this.canonical.z?new Ki(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Ki(t,this.wrap,t,this.canonical.x>>l,this.canonical.y>>l)}isOverscaled(){return this.overscaledZ>this.canonical.z}calculateScaledKey(t,l){if(t>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${t}; overscaledZ = ${this.overscaledZ}`);let n=this.canonical.z-t;return t>this.canonical.z?Zo(this.wrap*+l,t,this.canonical.z,this.canonical.x,this.canonical.y):Zo(this.wrap*+l,t,t,this.canonical.x>>n,this.canonical.y>>n)}isChildOf(t){if(t.wrap!==this.wrap||this.overscaledZ-t.overscaledZ<=0)return!1;if(t.overscaledZ===0)return this.overscaledZ>0;let l=this.canonical.z-t.canonical.z;return!(l<0)&&t.canonical.x===this.canonical.x>>l&&t.canonical.y===this.canonical.y>>l}children(t){if(this.overscaledZ>=t)return[new Ki(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];let l=this.canonical.z+1,n=2*this.canonical.x,d=2*this.canonical.y;return[new Ki(l,this.wrap,l,n,d),new Ki(l,this.wrap,l,n+1,d),new Ki(l,this.wrap,l,n,d+1),new Ki(l,this.wrap,l,n+1,d+1)]}isLessThan(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))}wrapped(){return new Ki(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(t){return new Ki(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new lZ(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(t){return this.canonical.getTilePoint(new Ks(t.x-this.wrap,t.y))}}function Zo(i,t,l,n,d){(i*=2)<0&&(i=-1*i-1);let s=1<<l;return(s*s*i+s*d+n).toString(36)+l.toString(36)+t.toString(36)}function Ps(i,t){return t?i.properties[t]:i.id}function rg(i,t){let l={id:i.id};if(t.removeAllProperties&&(delete i.removeProperties,delete i.addOrUpdateProperties,delete t.removeProperties),t.removeProperties)for(let n of t.removeProperties){let d=i.addOrUpdateProperties.findIndex((s=>s.key===n));d>-1&&i.addOrUpdateProperties.splice(d,1)}return(i.removeAllProperties||t.removeAllProperties)&&(l.removeAllProperties=!0),(i.removeProperties||t.removeProperties)&&(l.removeProperties=[...i.removeProperties||[],...t.removeProperties||[]]),(i.addOrUpdateProperties||t.addOrUpdateProperties)&&(l.addOrUpdateProperties=[...i.addOrUpdateProperties||[],...t.addOrUpdateProperties||[]]),(i.newGeometry||t.newGeometry)&&(l.newGeometry=t.newGeometry||i.newGeometry),l}function iZ(i){var t,l;if(!i)return{};let n={};return n.removeAll=i.removeAll,n.remove=new Set(i.remove||[]),n.add=new Map((t=i.add)===null||t===void 0?void 0:t.map((d=>[d.id,d]))),n.update=new Map((l=i.update)===null||l===void 0?void 0:l.map((d=>[d.id,d]))),n}Qt("CanonicalTileID",Xm),Qt("OverscaledTileID",Ki,{omit:["terrainRttPosMatrix32f"]});class aZ{constructor(t){this._stringToNumber={},this._numberToString=[];for(let l=0;l<t.length;l++){let n=t[l];this._stringToNumber[n]=l,this._numberToString[l]=n}}encode(t){return this._stringToNumber[t]}decode(t){if(t>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${t} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[t]}}class nZ{constructor(t,l,n,d,s){this.type="Feature",this._vectorTileFeature=t,t._z=l,t._x=n,t._y=d,this.properties=t.properties,this.id=s}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(t){this._geometry=t}toJSON(){let t={geometry:this.geometry};for(let l in this)l!=="_geometry"&&l!=="_vectorTileFeature"&&(t[l]=this[l]);return t}}class ho{_name;dataBuffer;nullabilityBuffer;_size;constructor(t,l,n){this._name=t,this.dataBuffer=l,typeof n=="number"?this._size=n:(this.nullabilityBuffer=n,this._size=n.size())}getValue(t){return this.nullabilityBuffer&&!this.nullabilityBuffer.get(t)?null:this.getValueFromBuffer(t)}has(t){return this.nullabilityBuffer&&this.nullabilityBuffer.get(t)||!this.nullabilityBuffer}get name(){return this._name}get size(){return this._size}}class A0 extends ho{}class Jm extends A0{getValueFromBuffer(t){return this.dataBuffer[t]}}class ym extends A0{getValueFromBuffer(t){return this.dataBuffer[t]}}class dZ extends ho{delta;constructor(t,l,n,d){super(t,l,d),this.delta=n}}class Bm extends dZ{constructor(t,l,n,d){super(t,Int32Array.of(l),n,d)}getValueFromBuffer(t){return this.dataBuffer[0]+t*this.delta}}class Sm extends ho{constructor(t,l,n){super(t,Int32Array.of(l),n)}getValueFromBuffer(t){return this.dataBuffer[0]}}class bg{_name;_geometryVector;_idVector;_propertyVectors;_extent;propertyVectorsMap;constructor(t,l,n,d,s=4096){this._name=t,this._geometryVector=l,this._idVector=n,this._propertyVectors=d,this._extent=s}get name(){return this._name}get idVector(){return this._idVector}get geometryVector(){return this._geometryVector}get propertyVectors(){return this._propertyVectors}getPropertyVector(t){return this.propertyVectorsMap||(this.propertyVectorsMap=new Map(this._propertyVectors.map((l=>[l.name,l])))),this.propertyVectorsMap.get(t)}*[Symbol.iterator](){let t=this.geometryVector[Symbol.iterator](),l=0;for(;l<this.numFeatures;){let n;this.idVector&&(n=this.containsMaxSaveIntegerValues(this.idVector)?Number(this.idVector.getValue(l)):this.idVector.getValue(l));let d=t?.next().value,s={};for(let b of this.propertyVectors){if(!b)continue;let Z=b.name,V=b.getValue(l);V!==null&&(s[Z]=V)}l++,yield{id:n,geometry:d,properties:s}}}get numFeatures(){return this.geometryVector.numGeometries}get extent(){return this._extent}getFeatures(){let t=[],l=this.geometryVector.getGeometries();for(let n=0;n<this.numFeatures;n++){let d;this.idVector&&(d=this.containsMaxSaveIntegerValues(this.idVector)?Number(this.idVector.getValue(n)):this.idVector.getValue(n));let s={coordinates:l[n],type:this.geometryVector.geometryType(n)},b={};for(let Z of this.propertyVectors){if(!Z)continue;let V=Z.name,R=Z.getValue(n);R!==null&&(b[V]=R)}t.push({id:d,geometry:s,properties:b})}return t}containsMaxSaveIntegerValues(t){return t instanceof Jm||t instanceof Sm&&t instanceof Bm||t instanceof ym}}class mg{value;constructor(t){this.value=t}get(){return this.value}set(t){this.value=t}increment(){return this.value++}add(t){this.value+=t}}var Ol,Ze,Un,Ja,tc,ki,Xl,Jl,cZ,Pi;(function(i){i.PRESENT="PRESENT",i.DATA="DATA",i.OFFSET="OFFSET",i.LENGTH="LENGTH"})(Ol||(Ol={}));class Cm{_dictionaryType;_offsetType;_lengthType;constructor(t,l,n){this._dictionaryType=t,this._offsetType=l,this._lengthType=n}get dictionaryType(){return this._dictionaryType}get offsetType(){return this._offsetType}get lengthType(){return this._lengthType}}function Nl(i,t,l){let n=new Int32Array(l),d=0,s=t.get();for(let b=0;b<n.length;b++){let Z=i[s++],V=127&Z;Z<128||(Z=i[s++],V|=(127&Z)<<7,Z<128||(Z=i[s++],V|=(127&Z)<<14,Z<128||(Z=i[s++],V|=(127&Z)<<21,Z<128||(Z=i[s++],V|=(15&Z)<<28)))),n[d++]=V}return t.set(s),n}function w0(i,t,l){let n=new BigInt64Array(l);for(let d=0;d<n.length;d++)n[d]=Zg(i,t);return n}function Wg(i,t){let l,n;return n=i[t.get()],t.increment(),l=127&n,n<128?l:(n=i[t.get()],t.increment(),l|=(127&n)<<7,n<128?l:(n=i[t.get()],t.increment(),l|=(127&n)<<14,n<128?l:(n=i[t.get()],t.increment(),l|=(127&n)<<21,n<128?l:(n=i[t.get()],l|=(15&n)<<28,(function(d,s,b){let Z,V;if(V=s[b.get()],b.increment(),Z=(112&V)>>4,V<128||(V=s[b.get()],b.increment(),Z|=(127&V)<<3,V<128)||(V=s[b.get()],b.increment(),Z|=(127&V)<<10,V<128)||(V=s[b.get()],b.increment(),Z|=(127&V)<<17,V<128)||(V=s[b.get()],b.increment(),Z|=(127&V)<<24,V<128)||(V=s[b.get()],b.increment(),Z|=(1&V)<<31,V<128))return 4294967296*Z+(d>>>0);throw new Error("Expected varint not more than 10 bytes")})(l,i,t)))))}function oZ(i,t,l,n){throw new Error("FastPFor is not implemented yet.")}function ec(i){return i>>>1^-(1&i)}function Vo(i){return i>>1n^-(1n&i)}function Zg(i,t){let l=0n,n=0,d=t.get();for(;d<i.length;){let s=i[d++];if(l|=BigInt(127&s)<<BigInt(n),!(128&s))break;if(n+=7,n>=64)throw new Error("Varint too long")}return t.set(d),l}function sZ(i,t,l){let n=new Int32Array(l),d=0;for(let s=0;s<t;s++){let b=i[s];n.fill(i[s+t],d,d+b),d+=b}return n}function rZ(i,t,l){let n=new BigInt64Array(l),d=0;for(let s=0;s<t;s++){let b=Number(i[s]);n.fill(i[s+t],d,d+b),d+=b}return n}function bZ(i,t,l){let n=new Float64Array(l),d=0;for(let s=0;s<t;s++){let b=i[s];n.fill(i[s+t],d,d+b),d+=b}return n}function Qm(i){let t=i.length/4*4,l=1;if(t>=4)for(let n=i[0];l<t-4;l+=4)n=i[l]+=n,n=i[l+1]+=n,n=i[l+2]+=n,n=i[l+3]+=n;for(;l!=i.length;)i[l]+=i[l-1],++l}function mZ(i){i[0]=i[0]>>>1^-(1&i[0]),i[1]=i[1]>>>1^-(1&i[1]);let t=i.length/4*4,l=2;if(t>=4)for(;l<t-4;l+=4){let n=i[l],d=i[l+1],s=i[l+2],b=i[l+3];i[l]=(n>>>1^-(1&n))+i[l-2],i[l+1]=(d>>>1^-(1&d))+i[l-1],i[l+2]=(s>>>1^-(1&s))+i[l],i[l+3]=(b>>>1^-(1&b))+i[l+1]}for(;l!=i.length;l+=2)i[l]=(i[l]>>>1^-(1&i[l]))+i[l-2],i[l+1]=(i[l+1]>>>1^-(1&i[l+1]))+i[l-1]}function cd(i,t,l){return Math.min(l,Math.max(t,i))}(function(i){i.NONE="NONE",i.DELTA="DELTA",i.COMPONENTWISE_DELTA="COMPONENTWISE_DELTA",i.RLE="RLE",i.MORTON="MORTON",i.PDE="PDE"})(Ze||(Ze={})),(function(i){i.NONE="NONE",i.FAST_PFOR="FAST_PFOR",i.VARINT="VARINT",i.ALP="ALP"})(Un||(Un={})),(function(i){i.NONE="NONE",i.SINGLE="SINGLE",i.SHARED="SHARED",i.VERTEX="VERTEX",i.MORTON="MORTON",i.FSST="FSST"})(Ja||(Ja={})),(function(i){i.VERTEX="VERTEX",i.INDEX="INDEX",i.STRING="STRING",i.KEY="KEY"})(tc||(tc={})),(function(i){i.VAR_BINARY="VAR_BINARY",i.GEOMETRIES="GEOMETRIES",i.PARTS="PARTS",i.RINGS="RINGS",i.TRIANGLES="TRIANGLES",i.SYMBOL="SYMBOL",i.DICTIONARY="DICTIONARY"})(ki||(ki={}));class lc{_physicalStreamType;_logicalStreamType;_logicalLevelTechnique1;_logicalLevelTechnique2;_physicalLevelTechnique;_numValues;_byteLength;constructor(t,l,n,d,s,b,Z){this._physicalStreamType=t,this._logicalStreamType=l,this._logicalLevelTechnique1=n,this._logicalLevelTechnique2=d,this._physicalLevelTechnique=s,this._numValues=b,this._byteLength=Z}static decode(t,l){let n=t[l.get()],d=Object.values(Ol)[n>>4],s=null;switch(d){case Ol.DATA:s=new Cm(Object.values(Ja)[15&n]);break;case Ol.OFFSET:s=new Cm(null,Object.values(tc)[15&n]);break;case Ol.LENGTH:s=new Cm(null,null,Object.values(ki)[15&n])}l.increment();let b=t[l.get()],Z=Object.values(Ze)[b>>5],V=Object.values(Ze)[b>>2&7],R=Object.values(Un)[3&b];l.increment();let F=Nl(t,l,2);return new lc(d,s,Z,V,R,F[0],F[1])}get physicalStreamType(){return this._physicalStreamType}get logicalStreamType(){return this._logicalStreamType}get logicalLevelTechnique1(){return this._logicalLevelTechnique1}get logicalLevelTechnique2(){return this._logicalLevelTechnique2}get physicalLevelTechnique(){return this._physicalLevelTechnique}get numValues(){return this._numValues}get byteLength(){return this._byteLength}getDecompressedCount(){return this._numValues}}class v0 extends lc{num_bits;coordinate_shift;constructor(t,l,n,d,s,b,Z,V,R){super(t,l,n,d,s,b,Z),this.num_bits=V,this.coordinate_shift=R}static decode(t,l){let n=lc.decode(t,l),d=Nl(t,l,2);return new v0(n.physicalStreamType,n.logicalStreamType,n.logicalLevelTechnique1,n.logicalLevelTechnique2,n.physicalLevelTechnique,n.numValues,n.byteLength,d[0],d[1])}static decodePartial(t,l,n){let d=Nl(l,n,2);return new v0(t.physicalStreamType,t.logicalStreamType,t.logicalLevelTechnique1,t.logicalLevelTechnique2,t.physicalLevelTechnique,t.numValues,t.byteLength,d[0],d[1])}numBits(){return this.num_bits}coordinateShift(){return this.coordinate_shift}}class qs extends lc{_runs;_numRleValues;constructor(t,l,n,d,s,b,Z,V,R){super(t,l,n,d,s,b,Z),this._runs=V,this._numRleValues=R}static decode(t,l){let n=lc.decode(t,l),d=Nl(t,l,2);return new qs(n.physicalStreamType,n.logicalStreamType,n.logicalLevelTechnique1,n.logicalLevelTechnique2,n.physicalLevelTechnique,n.numValues,n.byteLength,d[0],d[1])}static decodePartial(t,l,n){let d=Nl(l,n,2);return new qs(t.physicalStreamType,t.logicalStreamType,t.logicalLevelTechnique1,t.logicalLevelTechnique2,t.physicalLevelTechnique,t.numValues,t.byteLength,d[0],d[1])}get runs(){return this._runs}get numRleValues(){return this._numRleValues}getDecompressedCount(){return this._numRleValues}}class li{static decode(t,l){let n=lc.decode(t,l);return n.logicalLevelTechnique1===Ze.MORTON?v0.decodePartial(n,t,l):Ze.RLE!==n.logicalLevelTechnique1&&Ze.RLE!==n.logicalLevelTechnique2||Un.NONE===n.physicalLevelTechnique?n:qs.decodePartial(n,t,l)}}(function(i){i[i.FLAT=0]="FLAT",i[i.CONST=1]="CONST",i[i.SEQUENCE=2]="SEQUENCE",i[i.DICTIONARY=3]="DICTIONARY",i[i.FSST_DICTIONARY=4]="FSST_DICTIONARY"})(Xl||(Xl={}));class ya{values;_size;constructor(t,l){this.values=t,this._size=l}get(t){let l=Math.floor(t/8);return(this.values[l]>>t%8&1)==1}set(t,l){let n=Math.floor(t/8);this.values[n]=this.values[n]|(l?1:0)<<t%8}getInt(t){let l=Math.floor(t/8);return this.values[l]>>t%8&1}size(){return this._size}getBuffer(){return this.values}}class ae{constructor(){}static decodeIntStream(t,l,n,d,s){let b=ae.decodePhysicalLevelTechnique(t,l,n);return this.decodeIntBuffer(b,n,d,s)}static decodeLengthStreamToOffsetBuffer(t,l,n){let d=ae.decodePhysicalLevelTechnique(t,l,n);return this.decodeLengthToOffsetBuffer(d,n)}static decodePhysicalLevelTechnique(t,l,n){let d=n.physicalLevelTechnique;if(d===Un.FAST_PFOR)return oZ();if(d===Un.VARINT)return Nl(t,l,n.numValues);if(d===Un.NONE){let s=l.get();l.add(n.byteLength);let b=t.subarray(s,l.get());return new Int32Array(b)}throw new Error("Specified physicalLevelTechnique is not supported (yet).")}static decodeConstIntStream(t,l,n,d){let s=ae.decodePhysicalLevelTechnique(t,l,n);if(s.length===1){let b=s[0];return d?ec(b):b}return d?(function(b){return ec(b[1])})(s):(function(b){return b[1]})(s)}static decodeSequenceIntStream(t,l,n){return(function(d){if(d.length==2){let s=ec(d[1]);return[s,s]}return[ec(d[2]),ec(d[3])]})(ae.decodePhysicalLevelTechnique(t,l,n))}static decodeSequenceLongStream(t,l,n){return(function(d){if(d.length==2){let s=Vo(d[1]);return[s,s]}return[Vo(d[2]),Vo(d[3])]})(w0(t,l,n.numValues))}static decodeLongStream(t,l,n,d){let s=w0(t,l,n.numValues);return this.decodeLongBuffer(s,n,d)}static decodeLongFloat64Stream(t,l,n,d){let s=(function(b,Z,V){let R=new Float64Array(Z);for(let F=0;F<Z;F++)R[F]=Wg(b,V);return R})(t,n.numValues,l);return this.decodeFloat64Buffer(s,n,d)}static decodeConstLongStream(t,l,n,d){let s=w0(t,l,n.numValues);if(s.length===1){let b=s[0];return d?Vo(b):b}return d?(function(b){return Vo(b[1])})(s):(function(b){return b[1]})(s)}static decodeIntBuffer(t,l,n,d){switch(l.logicalLevelTechnique1){case Ze.DELTA:return l.logicalLevelTechnique2===Ze.RLE?(function(s,b,Z){let V=new Int32Array(Z),R=0,F=0;for(let N=0;N<b;N++){let x=s[N],T=ec(s[N+b]);for(let X=0;X<x;X++)F+=T,V[R++]=F}return V})(t,l.runs,l.numRleValues):((function(s){s[0]=s[0]>>>1^-(1&s[0]);let b=s.length/4*4,Z=1;if(b>=4)for(;Z<b-4;Z+=4){let V=s[Z],R=s[Z+1],F=s[Z+2],N=s[Z+3];s[Z]=(V>>>1^-(1&V))+s[Z-1],s[Z+1]=(R>>>1^-(1&R))+s[Z],s[Z+2]=(F>>>1^-(1&F))+s[Z+1],s[Z+3]=(N>>>1^-(1&N))+s[Z+2]}for(;Z!=s.length;++Z)s[Z]=(s[Z]>>>1^-(1&s[Z]))+s[Z-1]})(t),t);case Ze.RLE:return(function(s,b,Z){return Z?(function(V,R,F){let N=new Int32Array(F),x=0;for(let T=0;T<R;T++){let X=V[T],B=V[T+R];B=B>>>1^-(1&B),N.fill(B,x,x+X),x+=X}return N})(s,b.runs,b.numRleValues):sZ(s,b.runs,b.numRleValues)})(t,l,n);case Ze.MORTON:return Qm(t),t;case Ze.COMPONENTWISE_DELTA:return d?((function(s,b,Z,V){let R=s[0]>>>1^-(1&s[0]),F=s[1]>>>1^-(1&s[1]);s[0]=cd(Math.round(R*b),Z,V),s[1]=cd(Math.round(F*b),Z,V);let N=s.length/16,x=2;if(N>=4)for(;x<N-4;x+=4){let T=s[x],X=s[x+1],B=(T>>>1^-(1&T))+R,C=(X>>>1^-(1&X))+F;s[x]=cd(Math.round(B*b),Z,V),s[x+1]=cd(Math.round(C*b),Z,V);let z=s[x+2],f=s[x+3];R=(z>>>1^-(1&z))+B,F=(f>>>1^-(1&f))+C,s[x+2]=cd(Math.round(R*b),Z,V),s[x+3]=cd(Math.round(F*b),Z,V)}for(;x!=s.length;x+=2)R+=s[x]>>>1^-(1&s[x]),F+=s[x+1]>>>1^-(1&s[x+1]),s[x]=cd(Math.round(R*b),Z,V),s[x+1]=cd(Math.round(F*b),Z,V)})(t,d.scale,d.min,d.max),t):(mZ(t),t);case Ze.NONE:return n&&(function(s){for(let b=0;b<s.length;b++){let Z=s[b];s[b]=Z>>>1^-(1&Z)}})(t),t;default:throw new Error(`The specified Logical level technique is not supported: ${l.logicalLevelTechnique1}`)}}static decodeLongBuffer(t,l,n){switch(l.logicalLevelTechnique1){case Ze.DELTA:return l.logicalLevelTechnique2===Ze.RLE?(function(d,s,b){let Z=new BigInt64Array(b),V=0,R=0n;for(let F=0;F<s;F++){let N=Number(d[F]),x=Vo(d[F+s]);for(let T=0;T<N;T++)R+=x,Z[V++]=R}return Z})(t,l.runs,l.numRleValues):((function(d){d[0]=d[0]>>1n^-(1n&d[0]);let s=d.length/4*4,b=1;if(s>=4)for(;b<s-4;b+=4){let Z=d[b],V=d[b+1],R=d[b+2],F=d[b+3];d[b]=(Z>>1n^-(1n&Z))+d[b-1],d[b+1]=(V>>1n^-(1n&V))+d[b],d[b+2]=(R>>1n^-(1n&R))+d[b+1],d[b+3]=(F>>1n^-(1n&F))+d[b+2]}for(;b!=d.length;++b)d[b]=(d[b]>>1n^-(1n&d[b]))+d[b-1]})(t),t);case Ze.RLE:return(function(d,s,b){return b?(function(Z,V,R){let F=new BigInt64Array(R),N=0;for(let x=0;x<V;x++){let T=Number(Z[x]),X=Z[x+V];X=X>>1n^-(1n&X),F.fill(X,N,N+T),N+=T}return F})(d,s.runs,s.numRleValues):rZ(d,s.runs,s.numRleValues)})(t,l,n);case Ze.NONE:return n&&(function(d){for(let s=0;s<d.length;s++){let b=d[s];d[s]=b>>1n^-(1n&b)}})(t),t;default:throw new Error(`The specified Logical level technique is not supported: ${l.logicalLevelTechnique1}`)}}static decodeFloat64Buffer(t,l,n){switch(l.logicalLevelTechnique1){case Ze.DELTA:return l.logicalLevelTechnique2===Ze.RLE&&(t=bZ(t,l.runs,l.numRleValues)),(function(d){d[0]=d[0]%2==1?(d[0]+1)/-2:d[0]/2;let s=d.length/4*4,b=1;if(s>=4)for(;b<s-4;b+=4){let Z=d[b],V=d[b+1],R=d[b+2],F=d[b+3];d[b]=(Z%2==1?(Z+1)/-2:Z/2)+d[b-1],d[b+1]=(V%2==1?(V+1)/-2:V/2)+d[b],d[b+2]=(R%2==1?(R+1)/-2:R/2)+d[b+1],d[b+3]=(F%2==1?(F+1)/-2:F/2)+d[b+2]}for(;b!=d.length;++b)d[b]=(d[b]%2==1?(d[b]+1)/-2:d[b]/2)+d[b-1]})(t),t;case Ze.RLE:return(function(d,s,b){return b?(function(Z,V,R){let F=new Float64Array(R),N=0;for(let x=0;x<V;x++){let T=Z[x],X=Z[x+V];X=X%2==1?(X+1)/-2:X/2,F.fill(X,N,N+T),N+=T}return F})(d,s.runs,s.numRleValues):bZ(d,s.runs,s.numRleValues)})(t,l,n);case Ze.NONE:return n&&(function(d){for(let s=0;s<d.length;s++){let b=d[s];d[s]=b%2==1?(b+1)/-2:b/2}})(t),t;default:throw new Error(`The specified Logical level technique is not supported: ${l.logicalLevelTechnique1}`)}}static decodeLengthToOffsetBuffer(t,l){if(l.logicalLevelTechnique1===Ze.DELTA&&l.logicalLevelTechnique2===Ze.NONE)return(function(n){let d=new Int32Array(n.length+1);d[0]=0,d[1]=ec(n[0]);let s=d[1],b=2;for(;b!=d.length;++b){let Z=n[b-1];s+=Z>>>1^-(1&Z),d[b]=d[b-1]+s}return d})(t);if(l.logicalLevelTechnique1===Ze.RLE&&l.logicalLevelTechnique2===Ze.NONE)return(function(n,d,s){let b=new Int32Array(s+1);b[0]=0;let Z=1,V=b[0];for(let R=0;R<d;R++){let F=n[R],N=n[R+d];for(let x=Z;x<Z+F;x++)b[x]=N+V,V=b[x];Z+=F}return b})(t,l.runs,l.numRleValues);if(l.logicalLevelTechnique1===Ze.NONE&&l.logicalLevelTechnique2===Ze.NONE){(function(d){let s=0;for(let b=0;b<d.length;b++)d[b]+=s,s=d[b]})(t);let n=new Int32Array(l.numValues+1);return n[0]=0,n.set(t,1),n}if(l.logicalLevelTechnique1===Ze.DELTA&&l.logicalLevelTechnique2===Ze.RLE){let n=(function(d,s,b){let Z=new Int32Array(b+1);Z[0]=0;let V=1,R=Z[0];for(let F=0;F<s;F++){let N=d[F],x=d[F+s];x=x>>>1^-(1&x);for(let T=V;T<V+N;T++)Z[T]=x+R,R=Z[T];V+=N}return Z})(t,l.runs,l.numRleValues);return Qm(n),n}throw new Error("Only delta encoding is supported for transforming length to offset streams yet.")}static decodeNullableIntStream(t,l,n,d,s){let b=n.physicalLevelTechnique===Un.FAST_PFOR?oZ():Nl(t,l,n.numValues);return this.decodeNullableIntBuffer(b,n,d,s)}static decodeNullableLongStream(t,l,n,d,s){let b=w0(t,l,n.numValues);return this.decodeNullableLongBuffer(b,n,d,s)}static decodeNullableIntBuffer(t,l,n,d){switch(l.logicalLevelTechnique1){case Ze.DELTA:return l.logicalLevelTechnique2===Ze.RLE&&(t=sZ(t,l.runs,l.numRleValues)),(function(s,b){let Z=new Int32Array(s.size()),V=0;s.get(0)?(Z[0]=s.get(0)?b[0]>>>1^-(1&b[0]):0,V=1):Z[0]=0;let R=1;for(;R!=Z.length;++R)Z[R]=s.get(R)?Z[R-1]+(b[V]>>>1^-(1&b[V++])):Z[R-1];return Z})(d,t);case Ze.RLE:return(function(s,b,Z,V){let R=b;return Z?(function(F,N,x){let T=new Int32Array(F.size()),X=0;for(let B=0;B<x;B++){let C=N[B],z=N[B+x];z=z>>>1^-(1&z);for(let f=X;f<X+C;f++)F.get(f)?T[f]=z:(T[f]=0,X++);X+=C}return T})(V,s,R.runs):(function(F,N,x){let T=new Int32Array(F.size()),X=0;for(let B=0;B<x;B++){let C=N[B],z=N[B+x];for(let f=X;f<X+C;f++)F.get(f)?T[f]=z:(T[f]=0,X++);X+=C}return T})(V,s,R.runs)})(t,l,n,d);case Ze.MORTON:return Qm(t),t;case Ze.COMPONENTWISE_DELTA:return mZ(t),t;case Ze.NONE:return t=n?(function(s,b){let Z=new Int32Array(s.size()),V=0,R=0;for(;R!=Z.length;++R)if(s.get(R)){let F=b[V++];Z[R]=F>>>1^-(1&F)}else Z[R]=0;return Z})(d,t):(function(s,b){let Z=new Int32Array(s.size()),V=0,R=0;for(;R!=Z.length;++R)Z[R]=s.get(R)?b[V++]:0;return Z})(d,t),t;default:throw new Error("The specified Logical level technique is not supported")}}static decodeNullableLongBuffer(t,l,n,d){switch(l.logicalLevelTechnique1){case Ze.DELTA:return l.logicalLevelTechnique2===Ze.RLE&&(t=rZ(t,l.runs,l.numRleValues)),(function(s,b){let Z=new BigInt64Array(s.size()),V=0;s.get(0)?(Z[0]=s.get(0)?b[0]>>1n^-(1n&b[0]):0n,V=1):Z[0]=0n;let R=1;for(;R!=Z.length;++R)Z[R]=s.get(R)?Z[R-1]+(b[V]>>1n^-(1n&b[V++])):Z[R-1];return Z})(d,t);case Ze.RLE:return(function(s,b,Z,V){let R=b;return Z?(function(F,N,x){let T=new BigInt64Array(F.size()),X=0;for(let B=0;B<x;B++){let C=Number(N[B]),z=N[B+x];z=z>>1n^-(1n&z);for(let f=X;f<X+C;f++)F.get(f)?T[f]=z:(T[f]=0n,X++);X+=C}return T})(V,s,R.runs):(function(F,N,x){let T=new BigInt64Array(F.size()),X=0;for(let B=0;B<x;B++){let C=Number(N[B]),z=N[B+x];for(let f=X;f<X+C;f++)F.get(f)?T[f]=z:(T[f]=0n,X++);X+=C}return T})(V,s,R.runs)})(t,l,n,d);case Ze.NONE:return t=n?(function(s,b){let Z=new BigInt64Array(s.size()),V=0,R=0;for(;R!=Z.length;++R)if(s.get(R)){let F=b[V++];Z[R]=F>>1n^-(1n&F)}else Z[R]=0n;return Z})(d,t):(function(s,b){let Z=new BigInt64Array(s.size()),V=0,R=0;for(;R!=Z.length;++R)Z[R]=s.get(R)?b[V++]:0n;return Z})(d,t),t;default:throw new Error("The specified Logical level technique is not supported")}}static getVectorType(t,l,n,d){let s=t.logicalLevelTechnique1;if(s===Ze.RLE)return t.runs===1?Xl.CONST:Xl.FLAT;let b=l instanceof ya?l.size():l;if(s===Ze.DELTA&&t.logicalLevelTechnique2===Ze.RLE){let Z=t.runs,V=2;if(t.numRleValues!==b)return Xl.FLAT;if(Z===1)return Xl.SEQUENCE;if(Z===2){let R=d.get(),F;if(t.physicalLevelTechnique===Un.VARINT)F=Nl(n,d,4);else{let N=d.get();F=new Int32Array(n.buffer,n.byteOffset+N,4)}if(d.set(R),F[2]===V&&F[3]===V)return Xl.SEQUENCE}}return t.numValues===1?Xl.CONST:Xl.FLAT}}class WZ extends A0{getValueFromBuffer(t){return this.dataBuffer[t]}}class ZZ extends dZ{constructor(t,l,n,d){super(t,BigInt64Array.of(l),n,d)}getValueFromBuffer(t){return this.dataBuffer[0]+BigInt(t)*this.delta}}class po{_geometryOffsets;_partOffsets;_ringOffsets;constructor(t,l,n){this._geometryOffsets=t,this._partOffsets=l,this._ringOffsets=n}get geometryOffsets(){return this._geometryOffsets}get partOffsets(){return this._partOffsets}get ringOffsets(){return this._ringOffsets}}class hg{tileExtent;_numBits;_coordinateShift;minBound;maxBound;constructor(t,l){this._coordinateShift=t<0?Math.abs(t):0,this.tileExtent=l+this._coordinateShift,this._numBits=Math.ceil(Math.log2(this.tileExtent)),this.minBound=t,this.maxBound=l}validateCoordinates(t){if(t.x<this.minBound||t.y<this.minBound||t.x>this.maxBound||t.y>this.maxBound)throw new Error("The specified tile buffer size is currently not supported.")}numBits(){return this._numBits}coordinateShift(){return this._coordinateShift}}class go extends hg{encode(t){this.validateCoordinates(t);let l=t.x+this._coordinateShift,n=t.y+this._coordinateShift,d=0;for(let s=0;s<this._numBits;s++)d|=(l&1<<s)<<s|(n&1<<s)<<s+1;return d}decode(t){return{x:this.decodeMorton(t)-this._coordinateShift,y:this.decodeMorton(t>>1)-this._coordinateShift}}decodeMorton(t){let l=0;for(let n=0;n<this._numBits;n++)l|=(t&1<<2*n)>>n;return l}static decode(t,l,n){return{x:go.decodeMorton(t,l)-n,y:go.decodeMorton(t>>1,l)-n}}static decodeMorton(t,l){let n=0;for(let d=0;d<l;d++)n|=(t&1<<2*d)>>d;return n}}(function(i){i[i.POINT=0]="POINT",i[i.LINESTRING=1]="LINESTRING",i[i.POLYGON=2]="POLYGON",i[i.MULTIPOINT=3]="MULTIPOINT",i[i.MULTILINESTRING=4]="MULTILINESTRING",i[i.MULTIPOLYGON=5]="MULTIPOLYGON"})(Jl||(Jl={})),(function(i){i[i.POINT=0]="POINT",i[i.LINESTRING=1]="LINESTRING",i[i.POLYGON=2]="POLYGON"})(cZ||(cZ={})),(function(i){i[i.MORTON=0]="MORTON",i[i.VEC_2=1]="VEC_2",i[i.VEC_3=2]="VEC_3"})(Pi||(Pi={}));class Vg{createPoint(t){return[[t]]}createMultiPoint(t){return t.map((l=>[l]))}createLineString(t){return[t]}createMultiLineString(t){return t}createPolygon(t,l){return[t,...l]}createMultiPolygon(t){return t.flat()}}function hZ(i){let t=new Array(i.numGeometries),l=1,n=1,d=1,s=0,b=new Vg,Z=0,V=0,R=i.mortonSettings,F=i.topologyVector,N=F.geometryOffsets,x=F.partOffsets,T=F.ringOffsets,X=i.vertexOffsets,B=i.containsPolygonGeometry(),C=i.vertexBuffer;for(let z=0;z<i.numGeometries;z++){let f=i.geometryType(z);if(f===Jl.POINT){if(X&&X.length!==0)if(i.vertexBufferType===Pi.VEC_2){let A=2*X[V++],H=new lt(C[A],C[A+1]);t[s++]=b.createPoint(H)}else{let A=X[V++],H=go.decode(C[A],R.numBits,R.coordinateShift),at=new lt(H.x,H.y);t[s++]=b.createPoint(at)}else{let A=new lt(C[Z++],C[Z++]);t[s++]=b.createPoint(A)}N&&d++,x&&l++,T&&n++}else if(f===Jl.MULTIPOINT){let A=N[d]-N[d-1];d++;let H=new Array(A);if(X&&X.length!==0){for(let at=0;at<A;at++){let dt=2*X[V++];H[at]=new lt(C[dt],C[dt+1])}t[s++]=b.createMultiPoint(H)}else{for(let at=0;at<A;at++){let dt=C[Z++],Wt=C[Z++];H[at]=new lt(dt,Wt)}t[s++]=b.createMultiPoint(H)}}else if(f===Jl.LINESTRING){let A,H=0;B?(H=T[n]-T[n-1],n++):H=x[l]-x[l-1],l++,X&&X.length!==0?(A=i.vertexBufferType===Pi.VEC_2?Lm(C,X,V,H,!1):Em(C,X,V,H,!1,R),V+=H):(A=km(C,Z,H,!1),Z+=2*H),t[s++]=b.createLineString(A),N&&d++}else if(f===Jl.POLYGON){let A=x[l]-x[l-1];l++;let H=new Array(A-1),at=T[n]-T[n-1];if(n++,X&&X.length!==0){let dt=i.vertexBufferType===Pi.VEC_2?D0(C,X,V,at):O0(C,X,V,at,0,R);V+=at;for(let Wt=0;Wt<H.length;Wt++)at=T[n]-T[n-1],n++,H[Wt]=i.vertexBufferType===Pi.VEC_2?D0(C,X,V,at):O0(C,X,V,at,0,R),V+=at;t[s++]=b.createPolygon(dt,H)}else{let dt=H0(C,Z,at);Z+=2*at;for(let Wt=0;Wt<H.length;Wt++)at=T[n]-T[n-1],n++,H[Wt]=H0(C,Z,at),Z+=2*at;t[s++]=b.createPolygon(dt,H)}N&&d++}else if(f===Jl.MULTILINESTRING){let A=N[d]-N[d-1];d++;let H=new Array(A);if(X&&X.length!==0){for(let at=0;at<A;at++){let dt=0;B?(dt=T[n]-T[n-1],n++):dt=x[l]-x[l-1],l++;let Wt=i.vertexBufferType===Pi.VEC_2?Lm(C,X,V,dt,!1):Em(C,X,V,dt,!1,R);H[at]=Wt,V+=dt}t[s++]=b.createMultiLineString(H)}else{for(let at=0;at<A;at++){let dt=0;B?(dt=T[n]-T[n-1],n++):dt=x[l]-x[l-1],l++,H[at]=km(C,Z,dt,!1),Z+=2*dt}t[s++]=b.createMultiLineString(H)}}else{if(f!==Jl.MULTIPOLYGON)throw new Error("The specified geometry type is currently not supported.");{let A=N[d]-N[d-1];d++;let H=new Array(A),at=0;if(X&&X.length!==0){for(let dt=0;dt<A;dt++){let Wt=x[l]-x[l-1];l++;let Nt=new Array(Wt-1);at=T[n]-T[n-1],n++;let Rt=i.vertexBufferType===Pi.VEC_2?D0(C,X,V,at):O0(C,X,V,at,0,R);V+=at;for(let It=0;It<Nt.length;It++)at=T[n]-T[n-1],n++,Nt[It]=i.vertexBufferType===Pi.VEC_2?D0(C,X,V,at):O0(C,X,V,at,0,R),V+=at;H[dt]=b.createPolygon(Rt,Nt)}t[s++]=b.createMultiPolygon(H)}else{for(let dt=0;dt<A;dt++){let Wt=x[l]-x[l-1];l++;let Nt=new Array(Wt-1);at=T[n]-T[n-1],n++;let Rt=H0(C,Z,at);Z+=2*at;for(let It=0;It<Nt.length;It++){let St=T[n]-T[n-1];n++,Nt[It]=H0(C,Z,St),Z+=2*St}H[dt]=b.createPolygon(Rt,Nt)}t[s++]=b.createMultiPolygon(H)}}}}return t}function H0(i,t,l){return km(i,t,l,!0)}function D0(i,t,l,n){return Lm(i,t,l,n,!0)}function O0(i,t,l,n,d,s){return Em(i,t,l,n,!0,s)}function km(i,t,l,n){let d=new Array(n?l+1:l);for(let s=0;s<2*l;s+=2)d[s/2]=new lt(i[t+s],i[t+s+1]);return n&&(d[d.length-1]=d[0]),d}function Lm(i,t,l,n,d){let s=new Array(d?n+1:n);for(let b=0;b<2*n;b+=2){let Z=2*t[l+b/2];s[b/2]=new lt(i[Z],i[Z+1])}return d&&(s[s.length-1]=s[0]),s}function Em(i,t,l,n,d,s){let b=new Array(d?n+1:n);for(let Z=0;Z<n;Z++){let V=go.decode(i[t[l+Z]],s.numBits,s.coordinateShift);b[Z]=new lt(V.x,V.y)}return d&&(b[b.length-1]=b[0]),b}class VZ{_vertexBufferType;_topologyVector;_vertexOffsets;_vertexBuffer;_mortonSettings;constructor(t,l,n,d,s){this._vertexBufferType=t,this._topologyVector=l,this._vertexOffsets=n,this._vertexBuffer=d,this._mortonSettings=s}get vertexBufferType(){return this._vertexBufferType}get topologyVector(){return this._topologyVector}get vertexOffsets(){return this._vertexOffsets}get vertexBuffer(){return this._vertexBuffer}*[Symbol.iterator](){let t=hZ(this),l=0;for(;l<this.numGeometries;)yield{coordinates:t[l],type:this.geometryType(l)},l++}getSimpleEncodedVertex(t){let l=this.vertexOffsets?2*this.vertexOffsets[t]:2*t;return[this.vertexBuffer[l],this.vertexBuffer[l+1]]}getVertex(t){if(this.vertexOffsets&&this.mortonSettings){let n=go.decode(this.vertexBuffer[this.vertexOffsets[t]],this.mortonSettings.numBits,this.mortonSettings.coordinateShift);return[n.x,n.y]}let l=this.vertexOffsets?2*this.vertexOffsets[t]:2*t;return[this.vertexBuffer[l],this.vertexBuffer[l+1]]}getGeometries(){return hZ(this)}get mortonSettings(){return this._mortonSettings}}class $s extends VZ{_numGeometries;_geometryType;constructor(t,l,n,d,s,b,Z){super(n,d,s,b,Z),this._numGeometries=t,this._geometryType=l}static createMortonEncoded(t,l,n,d,s,b){return new $s(t,l,Pi.MORTON,n,d,s,b)}static create(t,l,n,d,s){return new $s(t,l,Pi.VEC_2,n,d,s)}geometryType(t){return this._geometryType}get numGeometries(){return this._numGeometries}containsPolygonGeometry(){return this._geometryType===Jl.POLYGON||this._geometryType===Jl.MULTIPOLYGON}containsSingleGeometryType(){return!0}}class tr extends VZ{_geometryTypes;constructor(t,l,n,d,s,b){super(t,n,d,s,b),this._geometryTypes=l}static createMortonEncoded(t,l,n,d,s){return new tr(Pi.MORTON,t,l,n,d,s)}static create(t,l,n,d){return new tr(Pi.VEC_2,t,l,n,d)}geometryType(t){return this._geometryTypes[t]}get numGeometries(){return this._geometryTypes.length}containsPolygonGeometry(){for(let t=0;t<this.numGeometries;t++)if(this.geometryType(t)===Jl.POLYGON||this.geometryType(t)===Jl.MULTIPOLYGON)return!0;return!1}containsSingleGeometryType(){return!1}}class pZ{_triangleOffsets;_indexBuffer;_vertexBuffer;_topologyVector;constructor(t,l,n,d){this._triangleOffsets=t,this._indexBuffer=l,this._vertexBuffer=n,this._topologyVector=d}get triangleOffsets(){return this._triangleOffsets}get indexBuffer(){return this._indexBuffer}get vertexBuffer(){return this._vertexBuffer}get topologyVector(){return this._topologyVector}getGeometries(){if(!this._topologyVector)throw new Error("Cannot convert GpuVector to coordinates without topology information");let t=new Array(this.numGeometries),l=this._topologyVector,n=l.partOffsets,d=l.ringOffsets,s=l.geometryOffsets,b=0,Z=1,V=1,R=1;for(let F=0;F<this.numGeometries;F++)switch(this.geometryType(F)){case Jl.POLYGON:{let N=n[Z]-n[Z-1];Z++;let x=[];for(let T=0;T<N;T++){let X=d[V]-d[V-1];V++;let B=[];for(let C=0;C<X;C++){let z=this._vertexBuffer[b++],f=this._vertexBuffer[b++];B.push(new lt(z,f))}B.length>0&&B.push(B[0]),x.push(B)}t[F]=x,s&&R++}break;case Jl.MULTIPOLYGON:{let N=s[R]-s[R-1];R++;let x=[];for(let T=0;T<N;T++){let X=n[Z]-n[Z-1];Z++;for(let B=0;B<X;B++){let C=d[V]-d[V-1];V++;let z=[];for(let f=0;f<C;f++){let A=this._vertexBuffer[b++],H=this._vertexBuffer[b++];z.push(new lt(A,H))}z.length>0&&z.push(z[0]),x.push(z)}}t[F]=x}}return t}[Symbol.iterator](){return null}}class f0 extends pZ{_numGeometries;_geometryType;constructor(t,l,n,d,s,b){super(n,d,s,b),this._numGeometries=t,this._geometryType=l}static create(t,l,n,d,s,b){return new f0(t,l,n,d,s,b)}geometryType(t){return this._geometryType}get numGeometries(){return this._numGeometries}containsSingleGeometryType(){return!0}}class _0 extends pZ{_geometryTypes;constructor(t,l,n,d,s){super(l,n,d,s),this._geometryTypes=t}static create(t,l,n,d,s){return new _0(t,l,n,d,s)}geometryType(t){return this._geometryTypes[t]}get numGeometries(){return this._geometryTypes.length}containsSingleGeometryType(){return!1}}function pg(i,t,l,n,d){let s=li.decode(i,l),b=null,Z=null,V=null,R=null,F=null,N=null,x=null,T=null;if(ae.getVectorType(s,n,i,l)===Xl.CONST){let B=ae.decodeConstIntStream(i,l,s,!1);for(let C=0;C<t-1;C++){let z=li.decode(i,l);switch(z.physicalStreamType){case Ol.LENGTH:switch(z.logicalStreamType.lengthType){case ki.GEOMETRIES:b=ae.decodeLengthStreamToOffsetBuffer(i,l,z);break;case ki.PARTS:Z=ae.decodeLengthStreamToOffsetBuffer(i,l,z);break;case ki.RINGS:V=ae.decodeLengthStreamToOffsetBuffer(i,l,z);break;case ki.TRIANGLES:x=ae.decodeLengthStreamToOffsetBuffer(i,l,z)}break;case Ol.OFFSET:switch(z.logicalStreamType.offsetType){case tc.VERTEX:R=ae.decodeIntStream(i,l,z,!1);break;case tc.INDEX:T=ae.decodeIntStream(i,l,z,!1)}break;case Ol.DATA:if(Ja.VERTEX===z.logicalStreamType.dictionaryType)F=ae.decodeIntStream(i,l,z,!0,d);else{let f=z;N={numBits:f.numBits(),coordinateShift:f.coordinateShift()},F=ae.decodeIntStream(i,l,z,!1,d)}}}if(T!==null){if(b!=null||Z!=null){let C=new po(b,Z,V);return f0.create(n,B,x,T,F,C)}return f0.create(n,B,x,T,F)}return N===null?$s.create(n,B,new po(b,Z,V),R,F):$s.createMortonEncoded(n,B,new po(b,Z,V),R,F,N)}let X=ae.decodeIntStream(i,l,s,!1);for(let B=0;B<t-1;B++){let C=li.decode(i,l);switch(C.physicalStreamType){case Ol.LENGTH:switch(C.logicalStreamType.lengthType){case ki.GEOMETRIES:b=ae.decodeIntStream(i,l,C,!1);break;case ki.PARTS:Z=ae.decodeIntStream(i,l,C,!1);break;case ki.RINGS:V=ae.decodeIntStream(i,l,C,!1);break;case ki.TRIANGLES:x=ae.decodeLengthStreamToOffsetBuffer(i,l,C)}break;case Ol.OFFSET:switch(C.logicalStreamType.offsetType){case tc.VERTEX:R=ae.decodeIntStream(i,l,C,!1);break;case tc.INDEX:T=ae.decodeIntStream(i,l,C,!1)}break;case Ol.DATA:if(Ja.VERTEX===C.logicalStreamType.dictionaryType)F=ae.decodeIntStream(i,l,C,!0,d);else{let z=C;N={numBits:z.numBits(),coordinateShift:z.coordinateShift()},F=ae.decodeIntStream(i,l,C,!1,d)}}}return T!==null&&Z===null?_0.create(X,x,T,F):(b!==null?(b=zm(X,b,2),Z!==null&&V!==null?(Z=gZ(X,b,Z,!1),V=(function(B,C,z,f){let A=new Int32Array(z[z.length-1]+1),H=0;A[0]=H;let at=1,dt=1,Wt=0;for(let Nt=0;Nt<B.length;Nt++){let Rt=B[Nt],It=C[Nt+1]-C[Nt];if(Rt!==0&&Rt!==3)for(let St=0;St<It;St++){let Tt=z[at]-z[at-1];at++;for(let Xt=0;Xt<Tt;Xt++)H=A[dt++]=H+f[Wt++]}else for(let St=0;St<It;St++)A[dt++]=++H,at++}return A})(X,b,Z,V)):Z!==null&&(Z=(function(B,C,z){let f=new Int32Array(C[C.length-1]+1),A=0;f[0]=A;let H=1,at=0;for(let dt=0;dt<B.length;dt++){let Wt=B[dt],Nt=C[dt+1]-C[dt];if(Wt===4||Wt===1)for(let Rt=0;Rt<Nt;Rt++)A=f[H++]=A+z[at++];else for(let Rt=0;Rt<Nt;Rt++)f[H++]=++A}return f})(X,b,Z))):Z!==null&&V!==null?(Z=zm(X,Z,1),V=gZ(X,Z,V,!0)):Z!==null&&(Z=zm(X,Z,0)),T!==null?_0.create(X,x,T,F,new po(b,Z,V)):N===null?tr.create(X,new po(b,Z,V),R,F):tr.createMortonEncoded(X,new po(b,Z,V),R,F,N))}function zm(i,t,l){let n=new Int32Array(i.length+1),d=0;n[0]=d;let s=0;for(let b=0;b<i.length;b++)d=n[b+1]=d+(i[b]>l?t[s++]:1);return n}function gZ(i,t,l,n){let d=new Int32Array(t[t.length-1]+1),s=0;d[0]=s;let b=1,Z=0;for(let V=0;V<i.length;V++){let R=i[V],F=t[V+1]-t[V];if(R===5||R===2||n&&(R===4||R===1))for(let N=0;N<F;N++)s=d[b++]=s+l[Z++];else for(let N=0;N<F;N++)d[b++]=++s}return d}class gg extends ho{dataVector;constructor(t,l,n){super(t,l.getBuffer(),n),this.dataVector=l}getValueFromBuffer(t){return this.dataVector.get(t)}}class Rg extends A0{getValueFromBuffer(t){return this.dataBuffer[t]}}class RZ extends ho{constructor(t,l,n){super(t,BigInt64Array.of(l),n)}getValueFromBuffer(t){return this.dataBuffer[0]}}function ug(i,t,l){for(let n=0;n<i;n++){let d=li.decode(t,l);l.add(d.byteLength)}}function er(i,t,l){return uZ(i,Math.ceil(t/8),l)}function uZ(i,t,l){let n=new Uint8Array(t),d=0;for(;d<t;){let s=i[l.increment()];if(s<=127){let b=s+3,Z=i[l.increment()],V=d+b;n.fill(Z,d,V),d=V}else{let b=256-s;for(let Z=0;Z<b;Z++)n[d++]=i[l.increment()]}}return n}let Fg=new TextDecoder;function jm(i,t,l){return l-t>=12?Fg.decode(i.subarray(t,l)):(function(n,d,s){let b="",Z=d;for(;Z<s;){let V=n[Z],R,F,N,x=null,T=V>239?4:V>223?3:V>191?2:1;if(Z+T>s)break;T===1?V<128&&(x=V):T===2?(R=n[Z+1],(192&R)==128&&(x=(31&V)<<6|63&R,x<=127&&(x=null))):T===3?(R=n[Z+1],F=n[Z+2],(192&R)==128&&(192&F)==128&&(x=(15&V)<<12|(63&R)<<6|63&F,(x<=2047||x>=55296&&x<=57343)&&(x=null))):T===4&&(R=n[Z+1],F=n[Z+2],N=n[Z+3],(192&R)==128&&(192&F)==128&&(192&N)==128&&(x=(15&V)<<18|(63&R)<<12|(63&F)<<6|63&N,(x<=65535||x>=1114112)&&(x=null))),x===null?(x=65533,T=1):x>65535&&(x-=65536,b+=String.fromCharCode(x>>>10&1023|55296),x=56320|1023&x),b+=String.fromCharCode(x),Z+=T}return b})(i,t,l)}class Am extends ho{offsetBuffer;constructor(t,l,n,d){super(t,n,d),this.offsetBuffer=l}}class FZ extends Am{textEncoder;constructor(t,l,n,d){super(t,l,n,d??l.length-1),this.textEncoder=new TextEncoder}getValueFromBuffer(t){return jm(this.dataBuffer,this.offsetBuffer[t],this.offsetBuffer[t+1])}}class Ro extends Am{indexBuffer;textEncoder;constructor(t,l,n,d,s){super(t,n,d,s??l.length),this.indexBuffer=l,this.indexBuffer=l,this.textEncoder=new TextEncoder}getValueFromBuffer(t){let l=this.indexBuffer[t];return jm(this.dataBuffer,this.offsetBuffer[l],this.offsetBuffer[l+1])}}class GZ extends Am{indexBuffer;symbolOffsetBuffer;symbolTableBuffer;textEncoder;symbolLengthBuffer;lengthBuffer;decodedDictionary;constructor(t,l,n,d,s,b,Z){super(t,n,d,Z),this.indexBuffer=l,this.symbolOffsetBuffer=s,this.symbolTableBuffer=b,this.textEncoder=new TextEncoder}getValueFromBuffer(t){this.decodedDictionary==null&&(this.symbolLengthBuffer==null&&(this.symbolLengthBuffer=this.offsetToLengthBuffer(this.symbolOffsetBuffer),this.lengthBuffer=this.offsetToLengthBuffer(this.offsetBuffer)),this.decodedDictionary=(function(n,d,s){let b=[],Z=new Array(d.length).fill(0);for(let V=1;V<d.length;V++)Z[V]=Z[V-1]+d[V-1];for(let V=0;V<s.length;V++)if(s[V]===255)b.push(s[++V]);else{let R=d[s[V]],F=Z[s[V]];for(let N=0;N<R;N++)b.push(n[F+N])}return new Uint8Array(b)})(this.symbolTableBuffer,this.symbolLengthBuffer,this.dataBuffer));let l=this.indexBuffer[t];return jm(this.decodedDictionary,this.offsetBuffer[l],this.offsetBuffer[l+1])}offsetToLengthBuffer(t){let l=new Uint32Array(t.length-1),n=t[0];for(let d=1;d<t.length;d++){let s=t[d];l[d-1]=s-n,n=s}return l}}class lr{static ROOT_COLUMN_NAME="default";static NESTED_COLUMN_SEPARATOR=":";constructor(){}static decode(t,l,n,d,s){let b=null,Z=null,V=null,R=null,F=null,N=null,x=null,T=null;for(let X=0;X<d;X++){let B=li.decode(l,n);if(B.byteLength!==0)switch(B.physicalStreamType){case Ol.PRESENT:{let C=er(l,B.numValues,n);N=new ya(C,B.numValues);break}case Ol.OFFSET:Z=s!=null||N!=null?ae.decodeNullableIntStream(l,n,B,!1,s??N):ae.decodeIntStream(l,n,B,!1);break;case Ol.LENGTH:{let C=ae.decodeLengthStreamToOffsetBuffer(l,n,B);ki.DICTIONARY===B.logicalStreamType.lengthType?b=C:ki.SYMBOL===B.logicalStreamType.lengthType?R=C:x=C;break}case Ol.DATA:{let C=l.subarray(n.get(),n.get()+B.byteLength);n.add(B.byteLength);let z=B.logicalStreamType.dictionaryType;Ja.FSST===z?F=C:Ja.SINGLE===z||Ja.SHARED===z?V=C:Ja.NONE===z&&(T=C);break}}}return this.decodeFsstDictionaryVector(t,F,Z,b,V,R,s??N)??this.decodeDictionaryVector(t,V,Z,b,s??N)??this.decodePlainStringVector(t,x,T,Z,s??N)}static decodeFsstDictionaryVector(t,l,n,d,s,b,Z){return l?new GZ(t,n,d,s,b,l,Z):null}static decodeDictionaryVector(t,l,n,d,s){return l?s?new Ro(t,n,d,l,s):new Ro(t,n,d,l):null}static decodePlainStringVector(t,l,n,d,s){if(!l||!n)return null;if(d)return s?new Ro(t,d,l,n,s):new Ro(t,d,l,n);if(s&&s.size()!==l.length-1){let b=new Int32Array(s.size()),Z=0;for(let V=0;V<s.size();V++)b[V]=s.get(V)?Z++:0;return new Ro(t,b,l,n,s)}return s?new FZ(t,l,n,s):new FZ(t,l,n)}static decodeSharedDictionary(t,l,n,d,s){let b=null,Z=null,V=null,R=null,F=!1;for(;!F;){let X=li.decode(t,l);switch(X.physicalStreamType){case Ol.LENGTH:ki.DICTIONARY===X.logicalStreamType.lengthType?b=ae.decodeLengthStreamToOffsetBuffer(t,l,X):V=ae.decodeLengthStreamToOffsetBuffer(t,l,X);break;case Ol.DATA:Ja.SINGLE===X.logicalStreamType.dictionaryType||Ja.SHARED===X.logicalStreamType.dictionaryType?(Z=t.subarray(l.get(),l.get()+X.byteLength),F=!0):R=t.subarray(l.get(),l.get()+X.byteLength),l.add(X.byteLength)}}let N=n.complexType.children,x=[],T=0;for(let X of N){let B=Nl(t,l,1)[0];if(B==0)continue;let C=`${n.name}${X.name===lr.ROOT_COLUMN_NAME?"":lr.NESTED_COLUMN_SEPARATOR+X.name}`;if(s&&!s.has(C)){ug(B,t,l);continue}if(B!==2||X.type!=="scalarField"||X.scalarField.physicalType!==9)throw new Error("Currently only optional string fields are implemented for a struct.");let z=li.decode(t,l),f=er(t,z.numValues,l),A=li.decode(t,l),H=(A instanceof qs?A.numRleValues:A.numValues)!==d?ae.decodeNullableIntStream(t,l,A,!1,new ya(f,z.numValues)):ae.decodeIntStream(t,l,A,!1);x[T++]=R?new GZ(C,H,b,Z,V,R,new ya(f,z.numValues)):new Ro(C,H,b,Z,new ya(f,z.numValues))}return x}}function Gg(i,t,l,n,d,s){return l.type==="scalarType"?(function(b,Z,V,R,F,N){let x=null,T=0;if(b===0)return null;if(N.nullable){let B=li.decode(Z,V);T=B.numValues;let C=V.get(),z=er(Z,T,V);V.set(C+B.byteLength),x=new ya(z,B.numValues)}let X=x??R;switch(F.physicalType){case 4:case 3:return(function(B,C,z,f,A){let H=li.decode(B,C),at=ae.getVectorType(H,A,B,C),dt=f.physicalType===3;if(at===Xl.FLAT){let Wt=ir(A)?ae.decodeNullableIntStream(B,C,H,dt,A):ae.decodeIntStream(B,C,H,dt);return new Jm(z.name,Wt,A)}if(at===Xl.SEQUENCE){let Wt=ae.decodeSequenceIntStream(B,C,H);return new Bm(z.name,Wt[0],Wt[1],H.numRleValues)}{let Wt=ae.decodeConstIntStream(B,C,H,dt);return new Sm(z.name,Wt,A)}})(Z,V,N,F,X);case 9:return lr.decode(N.name,Z,V,N.nullable?b-1:b,x);case 0:return(function(B,C,z,f,A){let H=li.decode(B,C),at=H.numValues,dt=C.get(),Wt=ir(A)?(function(Rt,It,St,Tt){let Xt=uZ(Rt,Math.ceil(It/8),St),ut=new ya(Xt,It),wt=Tt.size(),vt=new ya(new Uint8Array(wt),wt),Ot=0;for(let Lt=0;Lt<Tt.size();Lt++){let re=!!Tt.get(Lt)&&ut.get(Ot++);vt.set(Lt,re)}return vt.getBuffer()})(B,at,C,A):er(B,at,C);C.set(dt+H.byteLength);let Nt=new ya(Wt,at);return new gg(z.name,Nt,A)})(Z,V,N,0,X);case 6:case 5:return(function(B,C,z,f,A){let H=li.decode(B,C),at=ae.getVectorType(H,f,B,C),dt=A.physicalType===5;if(at===Xl.FLAT){let Wt=ir(f)?ae.decodeNullableLongStream(B,C,H,dt,f):ae.decodeLongStream(B,C,H,dt);return new WZ(z.name,Wt,f)}if(at===Xl.SEQUENCE){let Wt=ae.decodeSequenceLongStream(B,C,H);return new ZZ(z.name,Wt[0],Wt[1],H.numRleValues)}{let Wt=ae.decodeConstLongStream(B,C,H,dt);return new RZ(z.name,Wt,f)}})(Z,V,N,X,F);case 7:return(function(B,C,z,f){let A=li.decode(B,C),H=ir(f)?(function(at,dt,Wt,Nt){let Rt=dt.get(),It=Rt+Nt*Float32Array.BYTES_PER_ELEMENT,St=new Uint8Array(at.subarray(Rt,It)).buffer,Tt=new Float32Array(St);dt.set(It);let Xt=Wt.size(),ut=new Float32Array(Xt),wt=0;for(let vt=0;vt<Xt;vt++)ut[vt]=Wt.get(vt)?Tt[wt++]:0;return ut})(B,C,f,A.numValues):(function(at,dt,Wt){let Nt=dt.get(),Rt=Nt+Wt*Float32Array.BYTES_PER_ELEMENT,It=new Uint8Array(at.subarray(Nt,Rt)).buffer,St=new Float32Array(It);return dt.set(Rt),St})(B,C,A.numValues);return new Rg(z.name,H,f)})(Z,V,N,X);case 8:return(function(B,C,z,f){let A=li.decode(B,C),H=ir(f)?(function(at,dt,Wt,Nt){let Rt=dt.get(),It=Rt+Nt*Float64Array.BYTES_PER_ELEMENT,St=new Uint8Array(at.subarray(Rt,It)).buffer,Tt=new Float64Array(St);dt.set(It);let Xt=Wt.size(),ut=new Float64Array(Xt),wt=0;for(let vt=0;vt<Xt;vt++)ut[vt]=Wt.get(vt)?Tt[wt++]:0;return ut})(B,C,f,A.numValues):(function(at,dt,Wt){let Nt=dt.get(),Rt=Nt+Wt*Float64Array.BYTES_PER_ELEMENT,It=new Uint8Array(at.subarray(Nt,Rt)).buffer,St=new Float64Array(It);return dt.set(Rt),St})(B,C,A.numValues);return new ym(z.name,H,f)})(Z,V,N,X);default:throw new Error(`The specified data type for the field is currently not supported: ${F}`)}})(n,i,t,d,l.scalarType,l):n!=1?null:lr.decodeSharedDictionary(i,t,l,d,s)}function ir(i){return i instanceof ya}class K0{static decodeColumnType(t){switch(t){case 0:case 1:case 2:case 3:{let l={};l.nullable=!!(1&t),l.columnScope=0;let n={};return n.physicalType=t>1?6:4,n.type="physicalType",l.scalarType=n,l.type="scalarType",l}case 4:{let l={nullable:!1,columnScope:0},n={type:"physicalType",physicalType:0};return l.type="complexType",l.complexType=n,l}case 30:{let l={nullable:!1,columnScope:0},n={type:"physicalType",physicalType:1};return l.type="complexType",l.complexType=n,l}default:return this.mapScalarType(t)}}static columnTypeHasName(t){return t>=10}static columnTypeHasChildren(t){return t===30}static hasStreamCount(t){if(t.name==="id")return!1;if(t.type==="scalarType"){let l=t.scalarType;if(l.type==="physicalType")switch(l.physicalType){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:default:return!1;case 9:return!0}else if(l.type==="logicalType")return!1}else if(t.type==="complexType"){let l=t.complexType;if(l.type==="physicalType")switch(l.physicalType){case 0:case 1:return!0;default:return!1}}return console.warn("Unexpected column type in hasStreamCount",t),!1}static mapScalarType(t){let l=null;switch(t){case 10:case 11:l=0;break;case 12:case 13:l=1;break;case 14:case 15:l=2;break;case 16:case 17:l=3;break;case 18:case 19:l=4;break;case 20:case 21:l=5;break;case 22:case 23:l=6;break;case 24:case 25:l=7;break;case 26:case 27:l=8;break;case 28:case 29:l=9;break;default:return null}let n={};n.nullable=!!(1&t),n.columnScope=0;let d={type:"physicalType"};return d.physicalType=l,n.type="scalarType",n.scalarType=d,n}}let Ng=new TextDecoder;function NZ(i,t){let l=Nl(i,t,1)[0];if(l===0)return"";let n=t.get(),d=i.subarray(n,n+l);return t.add(l),Ng.decode(d)}function IZ(i,t){let l=Nl(i,t,1)[0]>>>0,n=!!(4&l),d=!!(2&l),s=Nl(i,t,1)[0]>>>0,b={};if(1&l&&(b.nullable=!0),d){let Z={};if(n?(Z.type="logicalType",Z.logicalType=s):(Z.type="physicalType",Z.physicalType=s),8&l){let V=Nl(i,t,1)[0]>>>0;Z.children=new Array(V);for(let R=0;R<V;R++)Z.children[R]=IZ(i,t)}b.type="complexField",b.complexField=Z}else{let Z={};n?(Z.type="logicalType",Z.logicalType=s):(Z.type="physicalType",Z.physicalType=s),b.type="scalarField",b.scalarField=Z}return b}function Ig(i,t){let l=Nl(i,t,1)[0]>>>0,n=K0.decodeColumnType(l);if(!n)throw new Error(`Unsupported column type code: ${l}`);if(K0.columnTypeHasName(l)?n.name=NZ(i,t):l>=0&&l<=3?n.name="id":l===4&&(n.name="geometry"),K0.columnTypeHasChildren(l)){let d=Nl(i,t,1)[0]>>>0,s=n.complexType;s.children=new Array(d);for(let b=0;b<d;b++)s.children[b]=IZ(i,t)}return n}function Ug(i,t){let l={featureTables:[]},n={};n.name=NZ(i,t);let d=Nl(i,t,1)[0]>>>0,s=Nl(i,t,1)[0]>>>0;n.columns=new Array(s);for(let b=0;b<s;b++)n.columns[b]=Ig(i,t);return l.featureTables.push(n),[l,d]}function Mg(i,t,l,n,d,s,b=!1){let Z=t.scalarType.physicalType,V=ae.getVectorType(d,s,i,l);if(Z===4)switch(V){case Xl.FLAT:{let R=ae.decodeIntStream(i,l,d,!1);return new Jm(n,R,s)}case Xl.SEQUENCE:{let R=ae.decodeSequenceIntStream(i,l,d);return new Bm(n,R[0],R[1],d.numRleValues)}case Xl.CONST:{let R=ae.decodeConstIntStream(i,l,d,!1);return new Sm(n,R,s)}}else switch(V){case Xl.FLAT:{if(b){let F=ae.decodeLongFloat64Stream(i,l,d,!1);return new ym(n,F,s)}let R=ae.decodeLongStream(i,l,d,!1);return new WZ(n,R,s)}case Xl.SEQUENCE:{let R=ae.decodeSequenceLongStream(i,l,d);return new ZZ(n,R[0],R[1],d.numRleValues)}case Xl.CONST:{let R=ae.decodeConstLongStream(i,l,d,!1);return new RZ(n,R,s)}}throw new Error("Vector type not supported for id column.")}class Yg{constructor(t,l){var n;switch(this._featureData=t,this.properties=this._featureData.properties||{},(n=this._featureData.geometry)===null||n===void 0?void 0:n.type){case Jl.POINT:case Jl.MULTIPOINT:this.type=1;break;case Jl.LINESTRING:case Jl.MULTILINESTRING:this.type=2;break;case Jl.POLYGON:case Jl.MULTIPOLYGON:this.type=3;break;default:this.type=0}this.extent=l,this.id=Number(this._featureData.id)}projectPoint(t,l,n,d){return[360*(t.x+l)/d-180,360/Math.PI*Math.atan(Math.exp((1-2*(t.y+n)/d)*Math.PI))-90]}projectLine(t,l,n,d){return t.map((s=>this.projectPoint(s,l,n,d)))}toGeoJSON(t,l,n){let d=this.extent*Math.pow(2,n),s=this.extent*t,b=this.extent*l,Z=this.loadGeometry(),V;switch(this.type){case 1:{let F=[];for(let x of Z)F.push(x[0]);let N=this.projectLine(F,s,b,d);V=F.length===1?{type:"Point",coordinates:N[0]}:{type:"MultiPoint",coordinates:N};break}case 2:{let F=Z.map((N=>this.projectLine(N,s,b,d)));V=F.length===1?{type:"LineString",coordinates:F[0]}:{type:"MultiLineString",coordinates:F};break}case 3:{let F=xd(Z),N=[];for(let x of F)N.push(x.map((T=>this.projectLine(T,s,b,d))));V=N.length===1?{type:"Polygon",coordinates:N[0]}:{type:"MultiPolygon",coordinates:N};break}default:throw new Error(`unknown feature type: ${this.type}`)}let R={type:"Feature",geometry:V,properties:this.properties};return this.id!=null&&(R.id=this.id),R}loadGeometry(){let t=[];for(let l of this._featureData.geometry.coordinates){let n=[];for(let d of l)n.push(new lt(d.x,d.y));t.push(n)}return t}bbox(){return[0,0,0,0]}}class xg{constructor(t){this.features=[],this.featureTable=t,this.name=t.name,this.extent=t.extent,this.version=2,this.features=t.getFeatures(),this.length=this.features.length}feature(t){return new Yg(this.features[t],this.extent)}}class UZ{constructor(t){this.layers={};let l=(function(n,d,s=!0){let b=new mg(0),Z=[];for(;b.get()<n.length;){let V=Nl(n,b,1)[0]>>>0,R=b.get()+V;if(R>n.length)throw new Error(`Block overruns tile: ${R} > ${n.length}`);if(Nl(n,b,1)[0]>>>0!=1){b.set(R);continue}let F=Ug(n,b),N=F[1],x=F[0].featureTables[0],T=null,X=null,B=[],C=0;for(let f of x.columns){let A=f.name;if(A==="id"){let H=null;if(f.nullable){let dt=li.decode(n,b),Wt=b.get(),Nt=er(n,dt.numValues,b);b.set(Wt+dt.byteLength),H=new ya(Nt,dt.numValues)}let at=li.decode(n,b);C=at.getDecompressedCount(),T=Mg(n,f,b,A,at,H??C,s)}else if(A==="geometry"){let H=Nl(n,b,1)[0];if(C===0){let at=b.get();C=li.decode(n,b).getDecompressedCount(),b.set(at)}X=pg(n,H,b,C,d)}else{let H=K0.hasStreamCount(f)?Nl(n,b,1)[0]:1;if(H===0&&f.type==="scalarType")continue;let at=Gg(n,b,f,H,C,void 0);at&&(Array.isArray(at)?B.push(...at):B.push(at))}}let z=new bg(x.name,X,T,B,N);Z.push(z),b.set(R)}return Z})(new Uint8Array(t));this.layers=l.reduce(((n,d)=>Object.assign(Object.assign({},n),{[d.name]:new xg(d)})),{})}}class ic{constructor(){this.minX=1/0,this.maxX=-1/0,this.minY=1/0,this.maxY=-1/0}extend(t){return this.minX=Math.min(this.minX,t.x),this.minY=Math.min(this.minY,t.y),this.maxX=Math.max(this.maxX,t.x),this.maxY=Math.max(this.maxY,t.y),this}expandBy(t){return this.minX-=t,this.minY-=t,this.maxX+=t,this.maxY+=t,(this.minX>this.maxX||this.minY>this.maxY)&&(this.minX=1/0,this.maxX=-1/0,this.minY=1/0,this.maxY=-1/0),this}shrinkBy(t){return this.expandBy(-t)}map(t){let l=new ic;return l.extend(t(new lt(this.minX,this.minY))),l.extend(t(new lt(this.maxX,this.minY))),l.extend(t(new lt(this.minX,this.maxY))),l.extend(t(new lt(this.maxX,this.maxY))),l}static fromPoints(t){let l=new ic;for(let n of t)l.extend(n);return l}contains(t){return t.x>=this.minX&&t.x<=this.maxX&&t.y>=this.minY&&t.y<=this.maxY}empty(){return this.minX>this.maxX}width(){return this.maxX-this.minX}height(){return this.maxY-this.minY}covers(t){return!this.empty()&&!t.empty()&&t.minX>=this.minX&&t.maxX<=this.maxX&&t.minY>=this.minY&&t.maxY<=this.maxY}intersects(t){return!this.empty()&&!t.empty()&&t.minX<=this.maxX&&t.maxX>=this.minX&&t.minY<=this.maxY&&t.maxY>=this.minY}}let wm="_geojsonTileLayer";class MZ{constructor(t,l){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new zd(se,16,0),this.grid3D=new zd(se,16,0),this.featureIndexArray=new v,this.promoteId=l}insert(t,l,n,d,s,b){let Z=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(n,d,s);let V=b?this.grid3D:this.grid;for(let R=0;R<l.length;R++){let F=l[R],N=[1/0,1/0,-1/0,-1/0];for(let x=0;x<F.length;x++){let T=F[x];N[0]=Math.min(N[0],T.x),N[1]=Math.min(N[1],T.y),N[2]=Math.max(N[2],T.x),N[3]=Math.max(N[3],T.y)}N[0]<se&&N[1]<se&&N[2]>=0&&N[3]>=0&&V.insert(Z,N[0],N[1],N[2],N[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=this.encoding!=="mlt"?new FW(new Fm(this.rawTileData)).layers:new UZ(this.rawTileData).layers,this.sourceLayerCoder=new aZ(this.vtLayers?Object.keys(this.vtLayers).sort():[wm])),this.vtLayers}query(t,l,n,d){this.loadVTLayers();let s=t.params,b=se/t.tileSize/t.scale,Z=Bd(s.filter,s.globalState),V=t.queryGeometry,R=t.queryPadding*b,F=ic.fromPoints(V),N=this.grid.query(F.minX-R,F.minY-R,F.maxX+R,F.maxY+R),x=ic.fromPoints(t.cameraQueryGeometry).expandBy(R),T=this.grid3D.query(x.minX,x.minY,x.maxX,x.maxY,((C,z,f,A)=>(function(H,at,dt,Wt,Nt){for(let It of H)if(at<=It.x&&dt<=It.y&&Wt>=It.x&&Nt>=It.y)return!0;let Rt=[new lt(at,dt),new lt(at,Nt),new lt(Wt,Nt),new lt(Wt,dt)];if(H.length>2){for(let It of Rt)if(ao(H,It))return!0}for(let It=0;It<H.length-1;It++)if(EV(H[It],H[It+1],Rt))return!0;return!1})(t.cameraQueryGeometry,C-R,z-R,f+R,A+R)));for(let C of T)N.push(C);N.sort(Tg);let X={},B;for(let C=0;C<N.length;C++){let z=N[C];if(z===B)continue;B=z;let f=this.featureIndexArray.get(z),A=null;this.loadMatchingFeature(X,f.bucketIndex,f.sourceLayerIndex,f.featureIndex,Z,s.layers,s.availableImages,l,n,d,((H,at,dt)=>(A||(A=tn(H)),at.queryIntersectsFeature({queryGeometry:V,feature:H,featureState:dt,geometry:A,zoom:this.z,transform:t.transform,pixelsToTileUnits:b,pixelPosMatrix:t.pixelPosMatrix,unwrappedTileID:this.tileID.toUnwrapped(),getElevation:t.getElevation}))))}return X}loadMatchingFeature(t,l,n,d,s,b,Z,V,R,F,N){let x=this.bucketLayerIDs[l];if(b&&!x.some((C=>b.has(C))))return;let T=this.sourceLayerCoder.decode(n),X=this.vtLayers[T].feature(d);if(s.needGeometry){let C=Xa(X,!0);if(!s.filter(new Ge(this.tileID.overscaledZ),C,this.tileID.canonical))return}else if(!s.filter(new Ge(this.tileID.overscaledZ),X))return;let B=this.getId(X,T);for(let C=0;C<x.length;C++){let z=x[C];if(b&&!b.has(z))continue;let f=V[z];if(!f)continue;let A={};B&&F&&(A=F.getState(f.sourceLayer||wm,B));let H=ll({},R[z]);H.paint=YZ(H.paint,f.paint,X,A,Z),H.layout=YZ(H.layout,f.layout,X,A,Z);let at=!N||N(X,f,A);if(!at)continue;let dt=new nZ(X,this.z,this.x,this.y,B);dt.layer=H;let Wt=t[z];Wt===void 0&&(Wt=t[z]=[]),Wt.push({featureIndex:d,feature:dt,intersectionZ:at})}}lookupSymbolFeatures(t,l,n,d,s,b,Z,V){let R={};this.loadVTLayers();let F=Bd(s.filterSpec,s.globalState);for(let N of t)this.loadMatchingFeature(R,n,d,N,F,b,Z,V,l);return R}hasLayer(t){for(let l of this.bucketLayerIDs)for(let n of l)if(t===n)return!0;return!1}getId(t,l){var n;let d=t.id;return this.promoteId&&(d=t.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[l]],typeof d=="boolean"&&(d=Number(d)),d===void 0&&(!((n=t.properties)===null||n===void 0)&&n.cluster)&&this.promoteId&&(d=Number(t.properties.cluster_id))),d}}function YZ(i,t,l,n,d){return Al(i,((s,b)=>{let Z=t instanceof pn?t.get(b):null;return Z&&Z.evaluate?Z.evaluate(l,n,d):Z}))}function Tg(i,t){return t-i}function xZ(i,t,l,n,d){let s=[];for(let b=0;b<i.length;b++){let Z=i[b],V;for(let R=0;R<Z.length-1;R++){let F=Z[R],N=Z[R+1];F.x<t&&N.x<t||(F.x<t?F=new lt(t,F.y+(t-F.x)/(N.x-F.x)*(N.y-F.y))._round():N.x<t&&(N=new lt(t,F.y+(t-F.x)/(N.x-F.x)*(N.y-F.y))._round()),F.y<l&&N.y<l||(F.y<l?F=new lt(F.x+(l-F.y)/(N.y-F.y)*(N.x-F.x),l)._round():N.y<l&&(N=new lt(F.x+(l-F.y)/(N.y-F.y)*(N.x-F.x),l)._round()),F.x>=n&&N.x>=n||(F.x>=n?F=new lt(n,F.y+(n-F.x)/(N.x-F.x)*(N.y-F.y))._round():N.x>=n&&(N=new lt(n,F.y+(n-F.x)/(N.x-F.x)*(N.y-F.y))._round()),F.y>=d&&N.y>=d||(F.y>=d?F=new lt(F.x+(d-F.y)/(N.y-F.y)*(N.x-F.x),d)._round():N.y>=d&&(N=new lt(F.x+(d-F.y)/(N.y-F.y)*(N.x-F.x),d)._round()),V&&F.equals(V[V.length-1])||(V=[F],s.push(V)),V.push(N)))))}}return s}function TZ(i,t,l,n,d){switch(t){case 1:return(function(s,b,Z,V){let R=[];for(let F of s)for(let N of F){let x=V===0?N.x:N.y;x>=b&&x<=Z&&R.push([N])}return R})(i,l,n,d);case 2:return XZ(i,l,n,d,!1);case 3:return XZ(i,l,n,d,!0)}return[]}function Xg(i,t,l,n,d){let s=n===0?Jg:yg,b=[],Z=[];for(let F=0;F<i.length-1;F++){let N=i[F],x=i[F+1],T=n===0?N.x:N.y,X=n===0?x.x:x.y,B=!1;T<t?X>t&&b.push(s(N,x,t)):T>l?X<l&&b.push(s(N,x,l)):b.push(N),X<t&&T>=t&&(b.push(s(N,x,t)),B=!0),X>l&&T<=l&&(b.push(s(N,x,l)),B=!0),!d&&B&&(Z.push(b),b=[])}let V=i.length-1,R=n===0?i[V].x:i[V].y;return R>=t&&R<=l&&b.push(i[V]),d&&b.length>0&&!b[0].equals(b[b.length-1])&&b.push(new lt(b[0].x,b[0].y)),b.length>0&&Z.push(b),Z}function XZ(i,t,l,n,d){let s=[];for(let b of i){let Z=Xg(b,t,l,n,d);Z.length>0&&s.push(...Z)}return s}function Jg(i,t,l){return new lt(l,i.y+(l-i.x)/(t.x-i.x)*(t.y-i.y))}function yg(i,t,l){return new lt(i.x+(l-i.y)/(t.y-i.y)*(t.x-i.x),l)}Qt("FeatureIndex",MZ,{omit:["rawTileData","sourceLayerCoder"]});class od extends lt{constructor(t,l,n,d){super(t,l),this.angle=n,d!==void 0&&(this.segment=d)}clone(){return new od(this.x,this.y,this.angle,this.segment)}}function JZ(i,t,l,n,d){if(t.segment===void 0||l===0)return!0;let s=t,b=t.segment+1,Z=0;for(;Z>-l/2;){if(b--,b<0)return!1;Z-=i[b].dist(s),s=i[b]}Z+=i[b].dist(i[b+1]),b++;let V=[],R=0;for(;Z<l/2;){let F=i[b],N=i[b+1];if(!N)return!1;let x=i[b-1].angleTo(F)-F.angleTo(N);for(x=Math.abs((x+3*Math.PI)%(2*Math.PI)-Math.PI),V.push({distance:Z,angleDelta:x}),R+=x;Z-V[0].distance>n;)R-=V.shift().angleDelta;if(R>d)return!1;b++,Z+=F.dist(N)}return!0}function yZ(i){let t=0;for(let l=0;l<i.length-1;l++)t+=i[l].dist(i[l+1]);return t}function BZ(i,t,l){return i?.6*t*l:0}function SZ(i,t){return Math.max(i?i.right-i.left:0,t?t.right-t.left:0)}function Bg(i,t,l,n,d,s){let b=BZ(l,d,s),Z=SZ(l,n)*s,V=0,R=yZ(i)/2;for(let F=0;F<i.length-1;F++){let N=i[F],x=i[F+1],T=N.dist(x);if(V+T>R){let X=(R-V)/T,B=Di.number(N.x,x.x,X),C=Di.number(N.y,x.y,X),z=new od(B,C,x.angleTo(N),F);return z._round(),!b||JZ(i,z,Z,b,t)?z:void 0}V+=T}}function Sg(i,t,l,n,d,s,b,Z,V){let R=BZ(n,s,b),F=SZ(n,d),N=F*b,x=i[0].x===0||i[0].x===V||i[0].y===0||i[0].y===V;return t-N<t/4&&(t=N+t/4),CZ(i,x?t/2*Z%t:(F/2+2*s)*b*Z%t,t,R,l,N,x,!1,V)}function CZ(i,t,l,n,d,s,b,Z,V){let R=s/2,F=yZ(i),N=0,x=t-l,T=[];for(let X=0;X<i.length-1;X++){let B=i[X],C=i[X+1],z=B.dist(C),f=C.angleTo(B);for(;x+l<N+z;){x+=l;let A=(x-N)/z,H=Di.number(B.x,C.x,A),at=Di.number(B.y,C.y,A);if(H>=0&&H<V&&at>=0&&at<V&&x-R>=0&&x+R<=F){let dt=new od(H,at,f,X);dt._round(),n&&!JZ(i,dt,s,n,d)||T.push(dt)}}N+=z}return Z||T.length||b||(T=CZ(i,N/2,l,n,d,s,b,!0,V)),T}function QZ(i,t,l,n){let d=[],s=i.image,b=s.pixelRatio,Z=s.paddedRect.w-2,V=s.paddedRect.h-2,R={x1:i.left,y1:i.top,x2:i.right,y2:i.bottom},F=s.stretchX||[[0,Z]],N=s.stretchY||[[0,V]],x=(ut,wt)=>ut+wt[1]-wt[0],T=F.reduce(x,0),X=N.reduce(x,0),B=Z-T,C=V-X,z=0,f=T,A=0,H=X,at=0,dt=B,Wt=0,Nt=C;if(s.content&&n){let ut=s.content,wt=ut[2]-ut[0],vt=ut[3]-ut[1];(s.textFitWidth||s.textFitHeight)&&(R=jW(i)),z=P0(F,0,ut[0]),A=P0(N,0,ut[1]),f=P0(F,ut[0],ut[2]),H=P0(N,ut[1],ut[3]),at=ut[0]-z,Wt=ut[1]-A,dt=wt-f,Nt=vt-H}let Rt=R.x1,It=R.y1,St=R.x2-Rt,Tt=R.y2-It,Xt=(ut,wt,vt,Ot)=>{let Lt=q0(ut.stretch-z,f,St,Rt),re=$0(ut.fixed-at,dt,ut.stretch,T),ve=q0(wt.stretch-A,H,Tt,It),gl=$0(wt.fixed-Wt,Nt,wt.stretch,X),_l=q0(vt.stretch-z,f,St,Rt),ba=$0(vt.fixed-at,dt,vt.stretch,T),Vi=q0(Ot.stretch-A,H,Tt,It),El=$0(Ot.fixed-Wt,Nt,Ot.stretch,X),Kl=new lt(Lt,ve),nl=new lt(_l,ve),zl=new lt(_l,Vi),ii=new lt(Lt,Vi),ai=new lt(re/b,gl/b),Mi=new lt(ba/b,El/b),Pl=t*Math.PI/180;if(Pl){let yl=Math.sin(Pl),Ke=Math.cos(Pl),Rl=[Ke,-yl,yl,Ke];Kl._matMult(Rl),nl._matMult(Rl),ii._matMult(Rl),zl._matMult(Rl)}let Yi=ut.stretch+ut.fixed,ma=wt.stretch+wt.fixed;return{tl:Kl,tr:nl,bl:ii,br:zl,tex:{x:s.paddedRect.x+1+Yi,y:s.paddedRect.y+1+ma,w:vt.stretch+vt.fixed-Yi,h:Ot.stretch+Ot.fixed-ma},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:ai,pixelOffsetBR:Mi,minFontScaleX:dt/b/St,minFontScaleY:Nt/b/Tt,isSDF:l}};if(n&&(s.stretchX||s.stretchY)){let ut=kZ(F,B,T),wt=kZ(N,C,X);for(let vt=0;vt<ut.length-1;vt++){let Ot=ut[vt],Lt=ut[vt+1];for(let re=0;re<wt.length-1;re++)d.push(Xt(Ot,wt[re],Lt,wt[re+1]))}}else d.push(Xt({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:Z+1},{fixed:0,stretch:V+1}));return d}function P0(i,t,l){let n=0;for(let d of i)n+=Math.max(t,Math.min(l,d[1]))-Math.max(t,Math.min(l,d[0]));return n}function kZ(i,t,l){let n=[{fixed:-1,stretch:0}];for(let[d,s]of i){let b=n[n.length-1];n.push({fixed:d-b.stretch,stretch:b.stretch}),n.push({fixed:d-b.stretch,stretch:b.stretch+(s-d)})}return n.push({fixed:t+1,stretch:l}),n}function q0(i,t,l,n){return i/t*l+n}function $0(i,t,l,n){return i-t*l/n}Qt("Anchor",od);class tb{constructor(t,l,n,d,s,b,Z,V,R,F){var N;if(this.boxStartIndex=t.length,R){let x=b.top,T=b.bottom,X=b.collisionPadding;X&&(x-=X[1],T+=X[3]);let B=T-x;B>0&&(B=Math.max(10,B),this.circleDiameter=B)}else{let x=!((N=b.image)===null||N===void 0)&&N.content&&(b.image.textFitWidth||b.image.textFitHeight)?jW(b):{x1:b.left,y1:b.top,x2:b.right,y2:b.bottom};x.y1=x.y1*Z-V[0],x.y2=x.y2*Z+V[2],x.x1=x.x1*Z-V[3],x.x2=x.x2*Z+V[1];let T=b.collisionPadding;if(T&&(x.x1-=T[0]*Z,x.y1-=T[1]*Z,x.x2+=T[2]*Z,x.y2+=T[3]*Z),F){let X=new lt(x.x1,x.y1),B=new lt(x.x2,x.y1),C=new lt(x.x1,x.y2),z=new lt(x.x2,x.y2),f=F*Math.PI/180;X._rotate(f),B._rotate(f),C._rotate(f),z._rotate(f),x.x1=Math.min(X.x,B.x,C.x,z.x),x.x2=Math.max(X.x,B.x,C.x,z.x),x.y1=Math.min(X.y,B.y,C.y,z.y),x.y2=Math.max(X.y,B.y,C.y,z.y)}t.emplaceBack(l.x,l.y,x.x1,x.y1,x.x2,x.y2,n,d,s)}this.boxEndIndex=t.length}}class Cg{constructor(t=[],l=(n,d)=>n<d?-1:n>d?1:0){if(this.data=t,this.length=this.data.length,this.compare=l,this.length>0)for(let n=(this.length>>1)-1;n>=0;n--)this._down(n)}push(t){this.data.push(t),this._up(this.length++)}pop(){if(this.length===0)return;let t=this.data[0],l=this.data.pop();return--this.length>0&&(this.data[0]=l,this._down(0)),t}peek(){return this.data[0]}_up(t){let{data:l,compare:n}=this,d=l[t];for(;t>0;){let s=t-1>>1,b=l[s];if(n(d,b)>=0)break;l[t]=b,t=s}l[t]=d}_down(t){let{data:l,compare:n}=this,d=this.length>>1,s=l[t];for(;t<d;){let b=1+(t<<1),Z=b+1;if(Z<this.length&&n(l[Z],l[b])<0&&(b=Z),n(l[b],s)>=0)break;l[t]=l[b],t=b}l[t]=s}}function Qg(i,t=1,l=!1){let n=ic.fromPoints(i[0]),d=Math.min(n.width(),n.height()),s=d/2,b=new Cg([],kg),{minX:Z,minY:V,maxX:R,maxY:F}=n;if(d===0)return new lt(Z,V);for(let T=Z;T<R;T+=d)for(let X=V;X<F;X+=d)b.push(new uo(T+s,X+s,s,i));let N=(function(T){let X=0,B=0,C=0,z=T[0];for(let f=0,A=z.length,H=A-1;f<A;H=f++){let at=z[f],dt=z[H],Wt=at.x*dt.y-dt.x*at.y;B+=(at.x+dt.x)*Wt,C+=(at.y+dt.y)*Wt,X+=3*Wt}return new uo(B/X,C/X,0,T)})(i),x=b.length;for(;b.length;){let T=b.pop();(T.d>N.d||!N.d)&&(N=T,l&&console.log("found best %d after %d probes",Math.round(1e4*T.d)/1e4,x)),T.max-N.d<=t||(s=T.h/2,b.push(new uo(T.p.x-s,T.p.y-s,s,i)),b.push(new uo(T.p.x+s,T.p.y-s,s,i)),b.push(new uo(T.p.x-s,T.p.y+s,s,i)),b.push(new uo(T.p.x+s,T.p.y+s,s,i)),x+=4)}return l&&(console.log(`num probes: ${x}`),console.log(`best distance: ${N.d}`)),N.p}function kg(i,t){return t.max-i.max}function uo(i,t,l,n){this.p=new lt(i,t),this.h=l,this.d=(function(d,s){let b=!1,Z=1/0;for(let V=0;V<s.length;V++){let R=s[V];for(let F=0,N=R.length,x=N-1;F<N;x=F++){let T=R[F],X=R[x];T.y>d.y!=X.y>d.y&&d.x<(X.x-T.x)*(d.y-T.y)/(X.y-T.y)+T.x&&(b=!b),Z=Math.min(Z,q1(d,T,X))}}return(b?1:-1)*Math.sqrt(Z)})(this.p,n),this.max=this.d+this.h*Math.SQRT2}var fl;I.aO=void 0,(fl=I.aO||(I.aO={}))[fl.center=1]="center",fl[fl.left=2]="left",fl[fl.right=3]="right",fl[fl.top=4]="top",fl[fl.bottom=5]="bottom",fl[fl["top-left"]=6]="top-left",fl[fl["top-right"]=7]="top-right",fl[fl["bottom-left"]=8]="bottom-left",fl[fl["bottom-right"]=9]="bottom-right";let vm=Number.POSITIVE_INFINITY;function LZ(i,t){return t[1]!==vm?(function(l,n,d){let s=0,b=0;switch(n=Math.abs(n),d=Math.abs(d),l){case"top-right":case"top-left":case"top":b=d-7;break;case"bottom-right":case"bottom-left":case"bottom":b=7-d}switch(l){case"top-right":case"bottom-right":case"right":s=-n;break;case"top-left":case"bottom-left":case"left":s=n}return[s,b]})(i,t[0],t[1]):(function(l,n){let d=0,s=0;n<0&&(n=0);let b=n/Math.SQRT2;switch(l){case"top-right":case"top-left":s=b-7;break;case"bottom-right":case"bottom-left":s=7-b;break;case"bottom":s=7-n;break;case"top":s=n-7}switch(l){case"top-right":case"bottom-right":d=-b;break;case"top-left":case"bottom-left":d=b;break;case"left":d=n;break;case"right":d=-n}return[d,s]})(i,t[0])}function EZ(i,t,l){var n;let d=i.layout,s=(n=d.get("text-variable-anchor-offset"))===null||n===void 0?void 0:n.evaluate(t,{},l);if(s){let Z=s.values,V=[];for(let R=0;R<Z.length;R+=2){let F=V[R]=Z[R],N=Z[R+1].map((x=>x*Tl));F.startsWith("top")?N[1]-=7:F.startsWith("bottom")&&(N[1]+=7),V[R+1]=N}return new ti(V)}let b=d.get("text-variable-anchor");if(b){let Z;Z=i._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[d.get("text-radial-offset").evaluate(t,{},l)*Tl,vm]:d.get("text-offset").evaluate(t,{},l).map((R=>R*Tl));let V=[];for(let R of b)V.push(R,LZ(R,Z));return new ti(V)}return null}function Hm(i){switch(i){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Lg(i,t,l,n,d,s,b,Z,V,R,F,N){let x=s.textMaxSize.evaluate(t,{});x===void 0&&(x=b);let T=i.layers[0].layout,X=T.get("icon-offset").evaluate(t,{},F),B=jZ(l.horizontal),C=b/24,z=i.tilePixelRatio*C,f=i.tilePixelRatio*x/24,A=i.tilePixelRatio*Z,H=i.tilePixelRatio*T.get("symbol-spacing"),at=T.get("text-padding")*i.tilePixelRatio,dt=(function(vt,Ot,Lt,re=1){let ve=vt.get("icon-padding").evaluate(Ot,{},Lt),gl=ve&&ve.values;return[gl[0]*re,gl[1]*re,gl[2]*re,gl[3]*re]})(T,t,F,i.tilePixelRatio),Wt=T.get("text-max-angle")/180*Math.PI,Nt=T.get("text-rotation-alignment")!=="viewport"&&T.get("symbol-placement")!=="point",Rt=T.get("icon-rotation-alignment")==="map"&&T.get("symbol-placement")!=="point",It=T.get("symbol-placement"),St=H/2,Tt=T.get("icon-text-fit"),Xt;n&&Tt!=="none"&&(i.allowVerticalPlacement&&l.vertical&&(Xt=AW(n,l.vertical,Tt,T.get("icon-text-fit-padding"),X,C)),B&&(n=AW(n,B,Tt,T.get("icon-text-fit-padding"),X,C)));let ut=F?N.line.getGranularityForZoomLevel(F.z):1,wt=(vt,Ot)=>{Ot.x<0||Ot.x>=se||Ot.y<0||Ot.y>=se||(function(Lt,re,ve,gl,_l,ba,Vi,El,Kl,nl,zl,ii,ai,Mi,Pl,Yi,ma,yl,Ke,Rl,tl,Bl,Mn,Ba,dr){let sd=Lt.addToLineVertexArray(re,ve),ac,Fo,Go,No,HZ=0,DZ=0,OZ=0,fZ=0,$m=-1,t1=-1,Yn={},_Z=Ya("");if(Lt.allowVerticalPlacement&&gl.vertical){let ni=El.layout.get("text-rotate").evaluate(tl,{},Ba)+90;Go=new tb(Kl,re,nl,zl,ii,gl.vertical,ai,Mi,Pl,ni),Vi&&(No=new tb(Kl,re,nl,zl,ii,Vi,ma,yl,Pl,ni))}if(_l){let ni=El.layout.get("icon-rotate").evaluate(tl,{}),qi=El.layout.get("icon-text-fit")!=="none",nc=QZ(_l,ni,Mn,qi),Ca=Vi?QZ(Vi,ni,Mn,qi):void 0;Fo=new tb(Kl,re,nl,zl,ii,_l,ma,yl,!1,ni),HZ=4*nc.length;let dc=Lt.iconSizeData,en=null;dc.kind==="source"?(en=[In*El.layout.get("icon-size").evaluate(tl,{})],en[0]>nd&&Le(`${Lt.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):dc.kind==="composite"&&(en=[In*Bl.compositeIconSizes[0].evaluate(tl,{},Ba),In*Bl.compositeIconSizes[1].evaluate(tl,{},Ba)],(en[0]>nd||en[1]>nd)&&Le(`${Lt.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),Lt.addSymbols(Lt.icon,nc,en,Rl,Ke,tl,I.ay.none,re,sd.lineStartIndex,sd.lineLength,-1,Ba),$m=Lt.icon.placedSymbolArray.length-1,Ca&&(DZ=4*Ca.length,Lt.addSymbols(Lt.icon,Ca,en,Rl,Ke,tl,I.ay.vertical,re,sd.lineStartIndex,sd.lineLength,-1,Ba),t1=Lt.icon.placedSymbolArray.length-1)}let KZ=Object.keys(gl.horizontal);for(let ni of KZ){let qi=gl.horizontal[ni];if(!ac){_Z=Ya(qi.text);let Ca=El.layout.get("text-rotate").evaluate(tl,{},Ba);ac=new tb(Kl,re,nl,zl,ii,qi,ai,Mi,Pl,Ca)}let nc=qi.positionedLines.length===1;if(OZ+=zZ(Lt,re,qi,ba,El,Pl,tl,Yi,sd,gl.vertical?I.ay.horizontal:I.ay.horizontalOnly,nc?KZ:[ni],Yn,$m,Bl,Ba),nc)break}gl.vertical&&(fZ+=zZ(Lt,re,gl.vertical,ba,El,Pl,tl,Yi,sd,I.ay.vertical,["vertical"],Yn,t1,Bl,Ba));let jg=ac?ac.boxStartIndex:Lt.collisionBoxArray.length,Ag=ac?ac.boxEndIndex:Lt.collisionBoxArray.length,wg=Go?Go.boxStartIndex:Lt.collisionBoxArray.length,vg=Go?Go.boxEndIndex:Lt.collisionBoxArray.length,Hg=Fo?Fo.boxStartIndex:Lt.collisionBoxArray.length,Dg=Fo?Fo.boxEndIndex:Lt.collisionBoxArray.length,Og=No?No.boxStartIndex:Lt.collisionBoxArray.length,fg=No?No.boxEndIndex:Lt.collisionBoxArray.length,Sa=-1,lb=(ni,qi)=>ni&&ni.circleDiameter?Math.max(ni.circleDiameter,qi):qi;Sa=lb(ac,Sa),Sa=lb(Go,Sa),Sa=lb(Fo,Sa),Sa=lb(No,Sa);let PZ=Sa>-1?1:0;PZ&&(Sa*=dr/Tl),Lt.glyphOffsetArray.length>=Wo.MAX_GLYPHS&&Le("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),tl.sortKey!==void 0&&Lt.addToSortKeyRanges(Lt.symbolInstances.length,tl.sortKey);let _g=EZ(El,tl,Ba),[Kg,Pg]=(function(ni,qi){let nc=ni.length,Ca=qi?.values;if(Ca?.length>0)for(let dc=0;dc<Ca.length;dc+=2){let en=Ca[dc+1];ni.emplaceBack(I.aO[Ca[dc]],en[0],en[1])}return[nc,ni.length]})(Lt.textAnchorOffsets,_g);Lt.symbolInstances.emplaceBack(re.x,re.y,Yn.right>=0?Yn.right:-1,Yn.center>=0?Yn.center:-1,Yn.left>=0?Yn.left:-1,Yn.vertical||-1,$m,t1,_Z,jg,Ag,wg,vg,Hg,Dg,Og,fg,nl,OZ,fZ,HZ,DZ,PZ,0,ai,Sa,Kg,Pg)})(i,Ot,vt,l,n,d,Xt,i.layers[0],i.collisionBoxArray,t.index,t.sourceLayerIndex,i.index,z,[at,at,at,at],Nt,V,A,dt,Rt,X,t,s,R,F,b)};if(It==="line")for(let vt of xZ(t.geometry,0,0,se,se)){let Ot=$d(vt,ut),Lt=Sg(Ot,H,Wt,l.vertical||B,n,24,f,i.overscaling,se);for(let re of Lt)B&&Eg(i,B.text,St,re)||wt(Ot,re)}else if(It==="line-center"){for(let vt of t.geometry)if(vt.length>1){let Ot=$d(vt,ut),Lt=Bg(Ot,Wt,l.vertical||B,n,24,f);Lt&&wt(Ot,Lt)}}else if(t.type==="Polygon")for(let vt of xd(t.geometry,0)){let Ot=Qg(vt,16);wt($d(vt[0],ut,!0),new od(Ot.x,Ot.y,0))}else if(t.type==="LineString")for(let vt of t.geometry){let Ot=$d(vt,ut);wt(Ot,new od(Ot[0].x,Ot[0].y,0))}else if(t.type==="Point")for(let vt of t.geometry)for(let Ot of vt)wt([Ot],new od(Ot.x,Ot.y,0))}function zZ(i,t,l,n,d,s,b,Z,V,R,F,N,x,T,X){let B=(function(f,A,H,at,dt,Wt,Nt,Rt){let It=at.layout.get("text-rotate").evaluate(Wt,{})*Math.PI/180,St=[];for(let Tt of A.positionedLines)for(let Xt of Tt.positionedGlyphs){if(!Xt.rect)continue;let ut=Xt.rect||{},wt=4,vt=!0,Ot=1,Lt=0,re=(dt||Rt)&&Xt.vertical,ve=Xt.metrics.advance*Xt.scale/2;if(Rt&&A.verticalizable&&(Lt=Tt.lineOffset/2-(Xt.imageName?-(Tl-Xt.metrics.width*Xt.scale)/2:(Xt.scale-1)*Tl)),Xt.imageName){let yl=Nt[Xt.imageName];vt=yl.sdf,Ot=yl.pixelRatio,wt=1/Ot}let gl=dt?[Xt.x+ve,Xt.y]:[0,0],_l=dt?[0,0]:[Xt.x+ve+H[0],Xt.y+H[1]-Lt],ba=[0,0];re&&(ba=_l,_l=[0,0]);let Vi=Xt.metrics.isDoubleResolution?2:1,El=(Xt.metrics.left-wt)*Xt.scale-ve+_l[0],Kl=(-Xt.metrics.top-wt)*Xt.scale+_l[1],nl=El+ut.w/Vi*Xt.scale/Ot,zl=Kl+ut.h/Vi*Xt.scale/Ot,ii=new lt(El,Kl),ai=new lt(nl,Kl),Mi=new lt(El,zl),Pl=new lt(nl,zl);if(re){let yl=new lt(-ve,ve- -17),Ke=-Math.PI/2,Rl=12-ve,tl=new lt(22-Rl,-(Xt.imageName?Rl:0)),Bl=new lt(...ba);ii._rotateAround(Ke,yl)._add(tl)._add(Bl),ai._rotateAround(Ke,yl)._add(tl)._add(Bl),Mi._rotateAround(Ke,yl)._add(tl)._add(Bl),Pl._rotateAround(Ke,yl)._add(tl)._add(Bl)}if(It){let yl=Math.sin(It),Ke=Math.cos(It),Rl=[Ke,-yl,yl,Ke];ii._matMult(Rl),ai._matMult(Rl),Mi._matMult(Rl),Pl._matMult(Rl)}let Yi=new lt(0,0),ma=new lt(0,0);St.push({tl:ii,tr:ai,bl:Mi,br:Pl,tex:ut,writingMode:A.writingMode,glyphOffset:gl,sectionIndex:Xt.sectionIndex,isSDF:vt,pixelOffsetTL:Yi,pixelOffsetBR:ma,minFontScaleX:0,minFontScaleY:0})}return St})(0,l,Z,d,s,b,n,i.allowVerticalPlacement),C=i.textSizeData,z=null;C.kind==="source"?(z=[In*d.layout.get("text-size").evaluate(b,{})],z[0]>nd&&Le(`${i.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):C.kind==="composite"&&(z=[In*T.compositeTextSizes[0].evaluate(b,{},X),In*T.compositeTextSizes[1].evaluate(b,{},X)],(z[0]>nd||z[1]>nd)&&Le(`${i.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),i.addSymbols(i.text,B,z,Z,s,b,R,t,V.lineStartIndex,V.lineLength,x,X);for(let f of F)N[f]=i.text.placedSymbolArray.length-1;return 4*B.length}function jZ(i){for(let t in i)return i[t];return null}function Eg(i,t,l,n){let d=i.compareText;if(t in d){let s=d[t];for(let b=s.length-1;b>=0;b--)if(n.dist(s[b])<l)return!0}else d[t]=[];return d[t].push(n),!1}let AZ=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Dm{static from(t){if(!(t instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");let[l,n]=new Uint8Array(t,0,2);if(l!==219)throw new Error("Data does not appear to be in a KDBush format.");let d=n>>4;if(d!==1)throw new Error(`Got v${d} data when expected v1.`);let s=AZ[15&n];if(!s)throw new Error("Unrecognized array type.");let[b]=new Uint16Array(t,2,1),[Z]=new Uint32Array(t,4,1);return new Dm(Z,b,s,t)}constructor(t,l=64,n=Float64Array,d){if(isNaN(t)||t<0)throw new Error(`Unpexpected numItems value: ${t}.`);this.numItems=+t,this.nodeSize=Math.min(Math.max(+l,2),65535),this.ArrayType=n,this.IndexArrayType=t<65536?Uint16Array:Uint32Array;let s=AZ.indexOf(this.ArrayType),b=2*t*this.ArrayType.BYTES_PER_ELEMENT,Z=t*this.IndexArrayType.BYTES_PER_ELEMENT,V=(8-Z%8)%8;if(s<0)throw new Error(`Unexpected typed array class: ${n}.`);d&&d instanceof ArrayBuffer?(this.data=d,this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+Z+V,2*t),this._pos=2*t,this._finished=!0):(this.data=new ArrayBuffer(8+b+Z+V),this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+Z+V,2*t),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+s]),new Uint16Array(this.data,2,1)[0]=l,new Uint32Array(this.data,4,1)[0]=t)}add(t,l){let n=this._pos>>1;return this.ids[n]=n,this.coords[this._pos++]=t,this.coords[this._pos++]=l,n}finish(){let t=this._pos>>1;if(t!==this.numItems)throw new Error(`Added ${t} items when expected ${this.numItems}.`);return Om(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(t,l,n,d){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");let{ids:s,coords:b,nodeSize:Z}=this,V=[0,s.length-1,0],R=[];for(;V.length;){let F=V.pop()||0,N=V.pop()||0,x=V.pop()||0;if(N-x<=Z){for(let C=x;C<=N;C++){let z=b[2*C],f=b[2*C+1];z>=t&&z<=n&&f>=l&&f<=d&&R.push(s[C])}continue}let T=x+N>>1,X=b[2*T],B=b[2*T+1];X>=t&&X<=n&&B>=l&&B<=d&&R.push(s[T]),(F===0?t<=X:l<=B)&&(V.push(x),V.push(T-1),V.push(1-F)),(F===0?n>=X:d>=B)&&(V.push(T+1),V.push(N),V.push(1-F))}return R}within(t,l,n){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");let{ids:d,coords:s,nodeSize:b}=this,Z=[0,d.length-1,0],V=[],R=n*n;for(;Z.length;){let F=Z.pop()||0,N=Z.pop()||0,x=Z.pop()||0;if(N-x<=b){for(let C=x;C<=N;C++)vZ(s[2*C],s[2*C+1],t,l)<=R&&V.push(d[C]);continue}let T=x+N>>1,X=s[2*T],B=s[2*T+1];vZ(X,B,t,l)<=R&&V.push(d[T]),(F===0?t-n<=X:l-n<=B)&&(Z.push(x),Z.push(T-1),Z.push(1-F)),(F===0?t+n>=X:l+n>=B)&&(Z.push(T+1),Z.push(N),Z.push(1-F))}return V}}function Om(i,t,l,n,d,s){if(d-n<=l)return;let b=n+d>>1;wZ(i,t,b,n,d,s),Om(i,t,l,n,b-1,1-s),Om(i,t,l,b+1,d,1-s)}function wZ(i,t,l,n,d,s){for(;d>n;){if(d-n>600){let R=d-n+1,F=l-n+1,N=Math.log(R),x=.5*Math.exp(2*N/3),T=.5*Math.sqrt(N*x*(R-x)/R)*(F-R/2<0?-1:1);wZ(i,t,l,Math.max(n,Math.floor(l-F*x/R+T)),Math.min(d,Math.floor(l+(R-F)*x/R+T)),s)}let b=t[2*l+s],Z=n,V=d;for(ar(i,t,n,l),t[2*d+s]>b&&ar(i,t,n,d);Z<V;){for(ar(i,t,Z,V),Z++,V--;t[2*Z+s]<b;)Z++;for(;t[2*V+s]>b;)V--}t[2*n+s]===b?ar(i,t,n,V):(V++,ar(i,t,V,d)),V<=l&&(n=V+1),l<=V&&(d=V-1)}}function ar(i,t,l,n){fm(i,l,n),fm(t,2*l,2*n),fm(t,2*l+1,2*n+1)}function fm(i,t,l){let n=i[t];i[t]=i[l],i[l]=n}function vZ(i,t,l,n){let d=i-l,s=t-n;return d*d+s*s}var _m;I.cG=void 0,(_m=I.cG||(I.cG={})).create="create",_m.load="load",_m.fullLoad="fullLoad";let eb=null,nr=[],Km=1e3/60,Pm="loadTime",qm="fullLoadTime",zg={mark(i){performance.mark(i)},frame(i){let t=i;eb!=null&&nr.push(t-eb),eb=t},clearMetrics(){eb=null,nr=[],performance.clearMeasures(Pm),performance.clearMeasures(qm);for(let i in I.cG)performance.clearMarks(I.cG[i])},getPerformanceMetrics(){performance.measure(Pm,I.cG.create,I.cG.load),performance.measure(qm,I.cG.create,I.cG.fullLoad);let i=performance.getEntriesByName(Pm)[0].duration,t=performance.getEntriesByName(qm)[0].duration,l=nr.length,n=1/(nr.reduce(((s,b)=>s+b),0)/l/1e3),d=nr.filter((s=>s>Km)).reduce(((s,b)=>s+(b-Km)/Km),0);return{loadTime:i,fullLoadTime:t,fps:n,percentDroppedFrames:d/(l+d)*100,totalFrames:l}}};I.$=ne,I.A=$t,I.B=Kc,I.C=Vn,I.D=At,I.E=st,I.F=function([i,t,l]){return t+=90,t*=Math.PI/180,l*=Math.PI/180,{x:i*Math.cos(t)*Math.sin(l),y:i*Math.sin(t)*Math.sin(l),z:i*Math.cos(l)}},I.G=Di,I.H=Ge,I.I=Gm,I.J=Pb,I.K=function(i){if(Ee==null){let t=i.navigator?i.navigator.userAgent:null;Ee=!!i.safari||!(!t||!(/\b(iPad|iPhone|iPod)\b/.test(t)||t.match("Safari")&&!t.match("Chrome")))}return Ee},I.L=class{constructor(i,t){this.target=i,this.mapId=t,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new og((()=>this.process())),this.subscription=Fi(this.target,"message",(l=>this.receive(l)),!1),this.globalScope=Ji(self)?i:window}registerMessageHandler(i,t){this.messageHandlers[i]=t}unregisterMessageHandler(i){delete this.messageHandlers[i]}sendAsync(i,t){return new Promise(((l,n)=>{let d=Math.round(1e18*Math.random()).toString(36).substring(0,10),s=t?Fi(t.signal,"abort",(()=>{s?.unsubscribe(),delete this.resolveRejects[d];let V={id:d,type:"<cancel>",origin:location.origin,targetMapId:i.targetMapId,sourceMapId:this.mapId};this.target.postMessage(V)}),sg):null;this.resolveRejects[d]={resolve:V=>{s?.unsubscribe(),l(V)},reject:V=>{s?.unsubscribe(),n(V)}};let b=[],Z=Object.assign(Object.assign({},i),{id:d,sourceMapId:this.mapId,origin:location.origin,data:jd(i.data,b)});this.target.postMessage(Z,{transfer:b})}))}receive(i){let t=i.data,l=t.id;if(!(t.origin!=="file://"&&location.origin!=="file://"&&t.origin!=="resource://android"&&location.origin!=="resource://android"&&t.origin!==location.origin||t.targetMapId&&this.mapId!==t.targetMapId)){if(t.type==="<cancel>"){delete this.tasks[l];let n=this.abortControllers[l];return delete this.abortControllers[l],void(n&&n.abort())}if(Ji(self)||t.mustQueue)return this.tasks[l]=t,this.taskQueue.push(l),void this.invoker.trigger();this.processTask(l,t)}}process(){if(this.taskQueue.length===0)return;let i=this.taskQueue.shift(),t=this.tasks[i];delete this.tasks[i],this.taskQueue.length>0&&this.invoker.trigger(),t&&this.processTask(i,t)}processTask(i,t){return o(this,void 0,void 0,(function*(){if(t.type==="<response>"){let d=this.resolveRejects[i];return delete this.resolveRejects[i],d?void(t.error?d.reject(Ua(t.error)):d.resolve(Ua(t.data))):void 0}if(!this.messageHandlers[t.type])return void this.completeTask(i,new Error(`Could not find a registered handler for ${t.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));let l=Ua(t.data),n=new AbortController;this.abortControllers[i]=n;try{let d=yield this.messageHandlers[t.type](t.sourceMapId,l,n);this.completeTask(i,null,d)}catch(d){this.completeTask(i,d)}}))}completeTask(i,t,l){let n=[];delete this.abortControllers[i];let d={id:i,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:t?jd(t):null,data:jd(l,n)};this.target.postMessage(d,{transfer:n})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},I.M=an,I.N=function(){var i=new $t(16);return $t!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0),i[0]=1,i[5]=1,i[10]=1,i[15]=1,i},I.O=function(i,t,l){var n,d,s,b,Z,V,R,F,N,x,T,X,B=l[0],C=l[1],z=l[2];return t===i?(i[12]=t[0]*B+t[4]*C+t[8]*z+t[12],i[13]=t[1]*B+t[5]*C+t[9]*z+t[13],i[14]=t[2]*B+t[6]*C+t[10]*z+t[14],i[15]=t[3]*B+t[7]*C+t[11]*z+t[15]):(d=t[1],s=t[2],b=t[3],Z=t[4],V=t[5],R=t[6],F=t[7],N=t[8],x=t[9],T=t[10],X=t[11],i[0]=n=t[0],i[1]=d,i[2]=s,i[3]=b,i[4]=Z,i[5]=V,i[6]=R,i[7]=F,i[8]=N,i[9]=x,i[10]=T,i[11]=X,i[12]=n*B+Z*C+N*z+t[12],i[13]=d*B+V*C+x*z+t[13],i[14]=s*B+R*C+T*z+t[14],i[15]=b*B+F*C+X*z+t[15]),i},I.P=lt,I.Q=function(i,t,l){var n=l[0],d=l[1],s=l[2];return i[0]=t[0]*n,i[1]=t[1]*n,i[2]=t[2]*n,i[3]=t[3]*n,i[4]=t[4]*d,i[5]=t[5]*d,i[6]=t[6]*d,i[7]=t[7]*d,i[8]=t[8]*s,i[9]=t[9]*s,i[10]=t[10]*s,i[11]=t[11]*s,i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15],i},I.R=Ui,I.S=function(i,t,l){var n=t[0],d=t[1],s=t[2],b=t[3],Z=t[4],V=t[5],R=t[6],F=t[7],N=t[8],x=t[9],T=t[10],X=t[11],B=t[12],C=t[13],z=t[14],f=t[15],A=l[0],H=l[1],at=l[2],dt=l[3];return i[0]=A*n+H*Z+at*N+dt*B,i[1]=A*d+H*V+at*x+dt*C,i[2]=A*s+H*R+at*T+dt*z,i[3]=A*b+H*F+at*X+dt*f,i[4]=(A=l[4])*n+(H=l[5])*Z+(at=l[6])*N+(dt=l[7])*B,i[5]=A*d+H*V+at*x+dt*C,i[6]=A*s+H*R+at*T+dt*z,i[7]=A*b+H*F+at*X+dt*f,i[8]=(A=l[8])*n+(H=l[9])*Z+(at=l[10])*N+(dt=l[11])*B,i[9]=A*d+H*V+at*x+dt*C,i[10]=A*s+H*R+at*T+dt*z,i[11]=A*b+H*F+at*X+dt*f,i[12]=(A=l[12])*n+(H=l[13])*Z+(at=l[14])*N+(dt=l[15])*B,i[13]=A*d+H*V+at*x+dt*C,i[14]=A*s+H*R+at*T+dt*z,i[15]=A*b+H*F+at*X+dt*f,i},I.T=mm,I.U=function(i,t){let l={};for(let n=0;n<t.length;n++){let d=t[n];d in i&&(l[d]=i[d])}return l},I.V=dd,I.W=ml,I.X=PW,I.Y=KW,I.Z=rt,I._=o,I.a=Ai,I.a$=ue,I.a0=za,I.a1=Ki,I.a2=$W,I.a3=j0,I.a4=se,I.a5=function(i,t,l){if(!i)return t||{};if(!t)return i||{};let n=iZ(i),d=iZ(t);(function(b,Z){Z.removeAll&&(b.add.clear(),b.update.clear(),b.remove.clear(),Z.remove.clear());for(let V of Z.remove)b.add.delete(V),b.update.delete(V);for(let[V,R]of Z.update){let F=b.update.get(V);F&&(Z.update.set(V,rg(F,R)),b.update.delete(V))}})(n,d);let s={};if((n.removeAll||d.removeAll)&&(s.removeAll=!0),s.remove=new Set([...n.remove,...d.remove]),s.add=new Map([...n.add,...d.add]),s.update=new Map([...n.update,...d.update]),s.remove.size&&s.add.size)for(let b of s.add.keys())s.remove.delete(b);return(function(b){let Z={};return b.removeAll&&(Z.removeAll=b.removeAll),b.remove&&(Z.remove=Array.from(b.remove)),b.add&&(Z.add=Array.from(b.add.values())),b.update&&(Z.update=Array.from(b.update.values())),Z})(s)},I.a6=function(i,t){if(i==null)return!0;if(i.type==="Feature")return Ps(i,t)!=null;if(i.type==="FeatureCollection"){let l=new Set;for(let n of i.features){let d=Ps(n,t);if(d==null||l.has(d))return!1;l.add(d)}return!0}return!1},I.a7=function(i,t){let l=new Map;if(i!=null)if(i.type==="Feature")l.set(Ps(i,t),i);else for(let n of i.features)l.set(Ps(n,t),n);return l},I.a8=function(i,t,l){var n,d;if(t.removeAll)i.clear();else if(t.remove)for(let s of t.remove)i.delete(s);if(t.add)for(let s of t.add){let b=Ps(s,l);b!=null&&i.set(b,s)}if(t.update)for(let s of t.update){let b=i.get(s.id);if(!b)continue;let Z=!!s.newGeometry,V=s.removeAllProperties||((n=s.removeProperties)===null||n===void 0?void 0:n.length)>0||((d=s.addOrUpdateProperties)===null||d===void 0?void 0:d.length)>0;if((Z||V)&&(b=Object.assign({},b),i.set(s.id,b),Z&&(b.geometry=s.newGeometry),V)){if(b.properties=s.removeAllProperties?{}:Object.assign({},b.properties||{}),s.removeProperties)for(let R of s.removeProperties)delete b.properties[R];if(s.addOrUpdateProperties)for(let{key:R,value:F}of s.addOrUpdateProperties)b.properties[R]=F}}},I.a9=wm,I.aA=function(i,t){var l=t[0],n=t[1],d=t[2],s=t[3],b=t[4],Z=t[5],V=t[6],R=t[7],F=t[8],N=t[9],x=t[10],T=t[11],X=t[12],B=t[13],C=t[14],z=t[15],f=l*Z-n*b,A=l*V-d*b,H=l*R-s*b,at=n*V-d*Z,dt=n*R-s*Z,Wt=d*R-s*V,Nt=F*B-N*X,Rt=F*C-x*X,It=F*z-T*X,St=N*C-x*B,Tt=N*z-T*B,Xt=x*z-T*C,ut=f*Xt-A*Tt+H*St+at*It-dt*Rt+Wt*Nt;return ut?(i[0]=(Z*Xt-V*Tt+R*St)*(ut=1/ut),i[1]=(d*Tt-n*Xt-s*St)*ut,i[2]=(B*Wt-C*dt+z*at)*ut,i[3]=(x*dt-N*Wt-T*at)*ut,i[4]=(V*It-b*Xt-R*Rt)*ut,i[5]=(l*Xt-d*It+s*Rt)*ut,i[6]=(C*H-X*Wt-z*A)*ut,i[7]=(F*Wt-x*H+T*A)*ut,i[8]=(b*Tt-Z*It+R*Nt)*ut,i[9]=(n*It-l*Tt-s*Nt)*ut,i[10]=(X*dt-B*H+z*f)*ut,i[11]=(N*H-F*dt-T*f)*ut,i[12]=(Z*Rt-b*St-V*Nt)*ut,i[13]=(l*St-n*Rt+d*Nt)*ut,i[14]=(B*A-X*at-C*f)*ut,i[15]=(F*at-N*A+x*f)*ut,i):null},I.aB=Fl,I.aC=function(i){var t=i[0],l=i[1];return Math.sqrt(t*t+l*l)},I.aD=function(i){return i[0]=0,i[1]=0,i},I.aE=function(i,t,l){return i[0]=t[0]*l,i[1]=t[1]*l,i},I.aF=Um,I.aG=Cl,I.aH=function(i,t,l,n){let d=t.y-i.y,s=t.x-i.x,b=n.y-l.y,Z=n.x-l.x,V=b*s-Z*d;if(V===0)return null;let R=(Z*(i.y-l.y)-b*(i.x-l.x))/V;return new lt(i.x+R*s,i.y+R*d)},I.aI=xZ,I.aJ=K1,I.aK=function(i){let t=1/0,l=1/0,n=-1/0,d=-1/0;for(let s of i)t=Math.min(t,s.x),l=Math.min(l,s.y),n=Math.max(n,s.x),d=Math.max(d,s.y);return[t,l,n,d]},I.aL=Tl,I.aM=Ei,I.aN=function(i,t,l,n,d=!1){if(!l[0]&&!l[1])return[0,0];let s=d?n==="map"?-i.bearingInRadians:0:n==="viewport"?i.bearingInRadians:0;if(s){let b=Math.sin(s),Z=Math.cos(s);l=[l[0]*Z-l[1]*b,l[0]*b+l[1]*Z]}return[d?l[0]:Ei(t,l[0],i.zoom),d?l[1]:Ei(t,l[1],i.zoom)]},I.aP=Im,I.aQ=Hm,I.aR=Nm,I.aS=Dm,I.aT=il,I.aU=Q0,I.aV=O,I.aW=te,I.aX=Yt,I.aY=Ql,I.aZ=tZ,I.a_=Qe,I.aa=Ks,I.ab=ic,I.ac=25,I.ad=Xm,I.ae=i=>{let t=window.document.createElement("video");return t.muted=!0,new Promise((l=>{t.onloadstart=()=>{l(t)};for(let n of i){let d=window.document.createElement("source");Q(n)||(t.crossOrigin="Anonymous"),d.src=n,t.appendChild(d)}}))},I.af=Mt,I.ag=function(){return zi++},I.ah=h,I.ai=Wo,I.aj=Bd,I.ak=Xa,I.al=nZ,I.am=function(i){let t={};if(i.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,((l,n,d,s)=>{let b=d||s;return t[n]=!b||b.toLowerCase(),""})),t["max-age"]){let l=parseInt(t["max-age"],10);isNaN(l)?delete t["max-age"]:t["max-age"]=l}return t},I.an=el,I.ao=85.051129,I.ap=la,I.aq=function(i){return Math.pow(2,i)},I.ar=Ue,I.as=qW,I.at=function(i){return Math.log(i)/Math.LN2},I.au=function(i){var t=i[0],l=i[1];return t*t+l*l},I.av=class{constructor(i,t){this.max=i,this.onRemove=t,this.reset()}reset(){for(let i in this.data)for(let t of this.data[i])t.timeout&&clearTimeout(t.timeout),this.onRemove(t.value);return this.data={},this.order=[],this}add(i,t,l){let n=i.wrapped().key;this.data[n]===void 0&&(this.data[n]=[]);let d={value:t,timeout:void 0};if(l!==void 0&&(d.timeout=setTimeout((()=>{this.remove(i,d)}),l)),this.data[n].push(d),this.order.push(n),this.order.length>this.max){let s=this._getAndRemoveByKey(this.order[0]);s&&this.onRemove(s)}return this}has(i){return i.wrapped().key in this.data}getAndRemove(i){return this.has(i)?this._getAndRemoveByKey(i.wrapped().key):null}_getAndRemoveByKey(i){let t=this.data[i].shift();return t.timeout&&clearTimeout(t.timeout),this.data[i].length===0&&delete this.data[i],this.order.splice(this.order.indexOf(i),1),t.value}getByKey(i){let t=this.data[i];return t?t[0].value:null}get(i){return this.has(i)?this.data[i.wrapped().key][0].value:null}remove(i,t){if(!this.has(i))return this;let l=i.wrapped().key,n=t===void 0?0:this.data[l].indexOf(t),d=this.data[l][n];return this.data[l].splice(n,1),d.timeout&&clearTimeout(d.timeout),this.data[l].length===0&&delete this.data[l],this.onRemove(d.value),this.order.splice(this.order.indexOf(l),1),this}setMaxSize(i){for(this.max=i;this.order.length>this.max;){let t=this._getAndRemoveByKey(this.order[0]);t&&this.onRemove(t)}return this}filter(i){let t=[];for(let l in this.data)for(let n of this.data[l])i(n.value)||t.push(n);for(let l of t)this.remove(l.value.tileID,l)}},I.aw=function(i){if(!i.length)return new Set;let t=Math.max(...i.map((V=>V.canonical.z))),l=1/0,n=-1/0,d=1/0,s=-1/0,b=[];for(let V of i){let{x:R,y:F,z:N}=V.canonical,x=Math.pow(2,t-N),T=R*x,X=F*x;b.push({id:V,x:T,y:X}),T<l&&(l=T),T>n&&(n=T),X<d&&(d=X),X>s&&(s=X)}let Z=new Set;for(let V of b)V.x!==l&&V.x!==n&&V.y!==d&&V.y!==s||Z.add(V.id);return Z},I.ax=function(i,t){let l=0,n=0;if(i.kind==="constant")n=i.layoutSize;else if(i.kind!=="source"){let{interpolationType:d,minZoom:s,maxZoom:b}=i,Z=d?el(Ll.interpolationFactor(d,t,s,b),0,1):0;i.kind==="camera"?n=Di.number(i.minSize,i.maxSize,Z):l=Z}return{uSizeT:l,uSize:n}},I.az=function(i,{uSize:t,uSizeT:l},{lowerSize:n,upperSize:d}){return i.kind==="source"?n/In:i.kind==="composite"?Di.number(n/In,d/In,l):t},I.b=Ri,I.b$=class extends Qi{constructor(i,t){super(i,t),this.current=Fn}set(i){if(i[12]!==this.current[12]||i[0]!==this.current[0])return this.current=i,void this.gl.uniformMatrix4fv(this.location,!1,i);for(let t=1;t<16;t++)if(i[t]!==this.current[t]){this.current=i,this.gl.uniformMatrix4fv(this.location,!1,i);break}}},I.b0=function(i){var t=new $t(3);return t[0]=i[0],t[1]=i[1],t[2]=i[2],t},I.b1=function(i,t,l){return i[0]=t[0]-l[0],i[1]=t[1]-l[1],i[2]=t[2]-l[2],i},I.b2=function(i,t){var l=t[0],n=t[1],d=t[2],s=l*l+n*n+d*d;return s>0&&(s=1/Math.sqrt(s)),i[0]=t[0]*s,i[1]=t[1]*s,i[2]=t[2]*s,i},I.b3=ke,I.b4=function(i,t){return i[0]*t[0]+i[1]*t[1]+i[2]*t[2]},I.b5=function(i,t,l){return i[0]=t[0]*l[0],i[1]=t[1]*l[1],i[2]=t[2]*l[2],i[3]=t[3]*l[3],i},I.b6=ce,I.b7=function(i,t,l){let n=t[0]*l[0]+t[1]*l[1]+t[2]*l[2];return n===0?null:(-(i[0]*l[0]+i[1]*l[1]+i[2]*l[2])-l[3])/n},I.b8=He,I.b9=function(i,t,l){return i[0]=t[0]*l,i[1]=t[1]*l,i[2]=t[2]*l,i[3]=t[3]*l,i},I.bA=pi,I.bB=function(i,t,l){var n=l[0],d=l[1],s=l[2],b=l[3],Z=t[0],V=t[1],R=t[2],F=d*R-s*V,N=s*Z-n*R,x=n*V-d*Z;return i[0]=Z+b*(F+=F)+d*(x+=x)-s*(N+=N),i[1]=V+b*N+s*F-n*x,i[2]=R+b*x+n*N-d*F,i},I.bC=function(i,t,l){let n=(d=[i[0],i[1],i[2],t[0],t[1],t[2],l[0],l[1],l[2]])[0]*((F=d[8])*(b=d[4])-(Z=d[5])*(R=d[7]))+d[1]*(-F*(s=d[3])+Z*(V=d[6]))+d[2]*(R*s-b*V);var d,s,b,Z,V,R,F;if(n===0)return null;let N=ke([],[t[0],t[1],t[2]],[l[0],l[1],l[2]]),x=ke([],[l[0],l[1],l[2]],[i[0],i[1],i[2]]),T=ke([],[i[0],i[1],i[2]],[t[0],t[1],t[2]]),X=Qe([],N,-i[3]);return ue(X,X,Qe([],x,-t[3])),ue(X,X,Qe([],T,-l[3])),Qe(X,X,1/n),X},I.bD=Tm,I.bE=function(){return new Float64Array(4)},I.bF=function(i,t,l,n){var d=[],s=[];return d[0]=t[0]-l[0],d[1]=t[1]-l[1],d[2]=t[2]-l[2],s[0]=d[0]*Math.cos(n)-d[1]*Math.sin(n),s[1]=d[0]*Math.sin(n)+d[1]*Math.cos(n),s[2]=d[2],i[0]=s[0]+l[0],i[1]=s[1]+l[1],i[2]=s[2]+l[2],i},I.bG=function(i,t,l,n){var d=[],s=[];return d[0]=t[0]-l[0],d[1]=t[1]-l[1],d[2]=t[2]-l[2],s[0]=d[0],s[1]=d[1]*Math.cos(n)-d[2]*Math.sin(n),s[2]=d[1]*Math.sin(n)+d[2]*Math.cos(n),i[0]=s[0]+l[0],i[1]=s[1]+l[1],i[2]=s[2]+l[2],i},I.bH=function(i,t,l,n){var d=[],s=[];return d[0]=t[0]-l[0],d[1]=t[1]-l[1],d[2]=t[2]-l[2],s[0]=d[2]*Math.sin(n)+d[0]*Math.cos(n),s[1]=d[1],s[2]=d[2]*Math.cos(n)-d[0]*Math.sin(n),i[0]=s[0]+l[0],i[1]=s[1]+l[1],i[2]=s[2]+l[2],i},I.bI=function(i,t,l){var n=Math.sin(l),d=Math.cos(l),s=t[0],b=t[1],Z=t[2],V=t[3],R=t[8],F=t[9],N=t[10],x=t[11];return t!==i&&(i[4]=t[4],i[5]=t[5],i[6]=t[6],i[7]=t[7],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15]),i[0]=s*d-R*n,i[1]=b*d-F*n,i[2]=Z*d-N*n,i[3]=V*d-x*n,i[8]=s*n+R*d,i[9]=b*n+F*d,i[10]=Z*n+N*d,i[11]=V*n+x*d,i},I.bJ=function(i,t){let l=Ml(i,360),n=Ml(t,360),d=n-l,s=n>l?d-360:d+360;return Math.abs(d)<Math.abs(s)?d:s},I.bK=function(i){return i[0]=0,i[1]=0,i[2]=0,i},I.bL=function(i,t,l,n){let d=Math.sqrt(i*i+t*t),s=Math.sqrt(l*l+n*n);i/=d,t/=d,l/=s,n/=s;let b=Math.acos(i*l+t*n);return-t*l+i*n>0?b:-b},I.bM=function(i,t){let l=Ml(i,2*Math.PI),n=Ml(t,2*Math.PI);return Math.min(Math.abs(l-n),Math.abs(l-n+2*Math.PI),Math.abs(l-n-2*Math.PI))},I.bN=function(){let i={},t=D.$version;for(let l in D.$root){let n=D.$root[l];if(n.required){let d=null;d=l==="version"?t:n.type==="array"?[]:{},d!=null&&(i[l]=d)}}return i},I.bO=Gi,I.bP=Is,I.bQ=function i(t,l){if(Array.isArray(t)){if(!Array.isArray(l)||t.length!==l.length)return!1;for(let n=0;n<t.length;n++)if(!i(t[n],l[n]))return!1;return!0}if(typeof t=="object"&&t!==null&&l!==null){if(typeof l!="object"||Object.keys(t).length!==Object.keys(l).length)return!1;for(let n in t)if(!i(t[n],l[n]))return!1;return!0}return t===l},I.bR=function(i){i=i.slice();let t=Object.create(null);for(let l=0;l<i.length;l++)t[i[l].id]=i[l];for(let l=0;l<i.length;l++)"ref"in i[l]&&(i[l]=Vt(i[l],t[i[l].ref]));return i},I.bS=function(i,t){if(i.type==="custom")return new cg(i,t);switch(i.type){case"background":return new dg(i,t);case"circle":return new HV(i,t);case"color-relief":return new PV(i,t);case"fill":return new mp(i,t);case"fill-extrusion":return new Np(i,t);case"heatmap":return new OV(i,t);case"hillshade":return new _V(i,t);case"line":return new Xp(i,t);case"raster":return new lm(i,t);case"symbol":return new z0(i,t)}},I.bT=i=>i.type==="raster",I.bU=oi,I.bV=function(i,t){if(!i)return[{command:"setStyle",args:[t]}];let l=[];try{if(!pt(i.version,t.version))return[{command:"setStyle",args:[t]}];pt(i.center,t.center)||l.push({command:"setCenter",args:[t.center]}),pt(i.state,t.state)||l.push({command:"setGlobalState",args:[t.state]}),pt(i.centerAltitude,t.centerAltitude)||l.push({command:"setCenterAltitude",args:[t.centerAltitude]}),pt(i.zoom,t.zoom)||l.push({command:"setZoom",args:[t.zoom]}),pt(i.bearing,t.bearing)||l.push({command:"setBearing",args:[t.bearing]}),pt(i.pitch,t.pitch)||l.push({command:"setPitch",args:[t.pitch]}),pt(i.roll,t.roll)||l.push({command:"setRoll",args:[t.roll]}),pt(i.sprite,t.sprite)||l.push({command:"setSprite",args:[t.sprite]}),pt(i.glyphs,t.glyphs)||l.push({command:"setGlyphs",args:[t.glyphs]}),pt(i.transition,t.transition)||l.push({command:"setTransition",args:[t.transition]}),pt(i.light,t.light)||l.push({command:"setLight",args:[t.light]}),pt(i.terrain,t.terrain)||l.push({command:"setTerrain",args:[t.terrain]}),pt(i.sky,t.sky)||l.push({command:"setSky",args:[t.sky]}),pt(i.projection,t.projection)||l.push({command:"setProjection",args:[t.projection]});let n={},d=[];(function(b,Z,V,R){let F;for(F in Z=Z||{},b=b||{})Object.prototype.hasOwnProperty.call(b,F)&&(Object.prototype.hasOwnProperty.call(Z,F)||Ht(F,V,R));for(F in Z)Object.prototype.hasOwnProperty.call(Z,F)&&(Object.prototype.hasOwnProperty.call(b,F)?pt(b[F],Z[F])||(b[F].type==="geojson"&&Z[F].type==="geojson"&&Pe(b,Z,F)?gt(V,{command:"setGeoJSONSourceData",args:[F,Z[F].data]}):ie(F,Z,V,R)):kt(F,Z,V))})(i.sources,t.sources,d,n);let s=[];i.layers&&i.layers.forEach((b=>{"source"in b&&n[b.source]?l.push({command:"removeLayer",args:[b.id]}):s.push(b)})),l=l.concat(d),(function(b,Z,V){Z=Z||[];let R=(b=b||[]).map(Re),F=Z.map(Re),N=b.reduce(Te,{}),x=Z.reduce(Te,{}),T=R.slice(),X=Object.create(null),B,C,z,f,A;for(let H=0,at=0;H<R.length;H++)B=R[H],Object.prototype.hasOwnProperty.call(x,B)?at++:(gt(V,{command:"removeLayer",args:[B]}),T.splice(T.indexOf(B,at),1));for(let H=0,at=0;H<F.length;H++)B=F[F.length-1-H],T[T.length-1-H]!==B&&(Object.prototype.hasOwnProperty.call(N,B)?(gt(V,{command:"removeLayer",args:[B]}),T.splice(T.lastIndexOf(B,T.length-at),1)):at++,f=T[T.length-H],gt(V,{command:"addLayer",args:[x[B],f]}),T.splice(T.length-H,0,B),X[B]=!0);for(let H=0;H<F.length;H++)if(B=F[H],C=N[B],z=x[B],!X[B]&&!pt(C,z))if(pt(C.source,z.source)&&pt(C["source-layer"],z["source-layer"])&&pt(C.type,z.type)){for(A in be(C.layout,z.layout,V,B,null,"setLayoutProperty"),be(C.paint,z.paint,V,B,null,"setPaintProperty"),pt(C.filter,z.filter)||gt(V,{command:"setFilter",args:[B,z.filter]}),pt(C.minzoom,z.minzoom)&&pt(C.maxzoom,z.maxzoom)||gt(V,{command:"setLayerZoomRange",args:[B,z.minzoom,z.maxzoom]}),C)Object.prototype.hasOwnProperty.call(C,A)&&A!=="layout"&&A!=="paint"&&A!=="filter"&&A!=="metadata"&&A!=="minzoom"&&A!=="maxzoom"&&(A.indexOf("paint.")===0?be(C[A],z[A],V,B,A.slice(6),"setPaintProperty"):pt(C[A],z[A])||gt(V,{command:"setLayerProperty",args:[B,A,z[A]]}));for(A in z)Object.prototype.hasOwnProperty.call(z,A)&&!Object.prototype.hasOwnProperty.call(C,A)&&A!=="layout"&&A!=="paint"&&A!=="filter"&&A!=="metadata"&&A!=="minzoom"&&A!=="maxzoom"&&(A.indexOf("paint.")===0?be(C[A],z[A],V,B,A.slice(6),"setPaintProperty"):pt(C[A],z[A])||gt(V,{command:"setLayerProperty",args:[B,A,z[A]]}))}else gt(V,{command:"removeLayer",args:[B]}),f=T[T.lastIndexOf(B)+1],gt(V,{command:"addLayer",args:[z,f]})})(s,t.layers,l)}catch(n){console.warn("Unable to compute style diff:",n),l=[{command:"setStyle",args:[t]}]}return l},I.bW=function(i){let t=[],l=i.id;return l===void 0&&t.push({message:`layers.${l}: missing required property "id"`}),i.render===void 0&&t.push({message:`layers.${l}: missing required method "render"`}),i.renderingMode&&i.renderingMode!=="2d"&&i.renderingMode!=="3d"&&t.push({message:`layers.${l}: property "renderingMode" must be either "2d" or "3d"`}),t},I.bX=Al,I.bY=ji,I.bZ=class extends Qi{constructor(i,t){super(i,t),this.current=0}set(i){this.current!==i&&(this.current=i,this.gl.uniform1i(this.location,i))}},I.b_=Ta,I.ba=function(i,t){return i[0]*t[0]+i[1]*t[1]+i[2]*t[2]+i[3]},I.bb=lZ,I.bc=Zo,I.bd=function(i,t,l,n,d){var s=1/Math.tan(t/2);if(i[0]=s/l,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=s,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=-1,i[12]=0,i[13]=0,i[15]=0,d!=null&&d!==1/0){var b=1/(n-d);i[10]=(d+n)*b,i[14]=2*d*n*b}else i[10]=-1,i[14]=-2*n;return i},I.be=function(i){var t=new $t(16);return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],t[9]=i[9],t[10]=i[10],t[11]=i[11],t[12]=i[12],t[13]=i[13],t[14]=i[14],t[15]=i[15],t},I.bf=function(i,t,l){var n=Math.sin(l),d=Math.cos(l),s=t[0],b=t[1],Z=t[2],V=t[3],R=t[4],F=t[5],N=t[6],x=t[7];return t!==i&&(i[8]=t[8],i[9]=t[9],i[10]=t[10],i[11]=t[11],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15]),i[0]=s*d+R*n,i[1]=b*d+F*n,i[2]=Z*d+N*n,i[3]=V*d+x*n,i[4]=R*d-s*n,i[5]=F*d-b*n,i[6]=N*d-Z*n,i[7]=x*d-V*n,i},I.bg=function(i,t,l){var n=Math.sin(l),d=Math.cos(l),s=t[4],b=t[5],Z=t[6],V=t[7],R=t[8],F=t[9],N=t[10],x=t[11];return t!==i&&(i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[3],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15]),i[4]=s*d+R*n,i[5]=b*d+F*n,i[6]=Z*d+N*n,i[7]=V*d+x*n,i[8]=R*d-s*n,i[9]=F*d-b*n,i[10]=N*d-Z*n,i[11]=x*d-V*n,i},I.bh=function(){let i=new Float32Array(16);return Ue(i),i},I.bi=function(){let i=new Float64Array(16);return Ue(i),i},I.bj=function(){return new Float64Array(16)},I.bk=function(i,t,l){let n=new Float64Array(4);return pi(n,i,t-90,l),n},I.bl=function(i,t,l,n){var d,s,b,Z,V,R=t[0],F=t[1],N=t[2],x=t[3],T=l[0],X=l[1],B=l[2],C=l[3];return(s=R*T+F*X+N*B+x*C)<0&&(s=-s,T=-T,X=-X,B=-B,C=-C),1-s>Kt?(d=Math.acos(s),b=Math.sin(d),Z=Math.sin((1-n)*d)/b,V=Math.sin(n*d)/b):(Z=1-n,V=n),i[0]=Z*R+V*T,i[1]=Z*F+V*X,i[2]=Z*N+V*B,i[3]=Z*x+V*C,i},I.bm=function(i){let t=new Float64Array(9);var l,n,d,s,b,Z,V,R,F,N,x,T,X,B,C,z,f,A;N=(d=(n=i)[0])*(V=d+d),x=(s=n[1])*V,X=(b=n[2])*V,B=b*(R=s+s),z=(Z=n[3])*V,f=Z*R,A=Z*(F=b+b),(l=t)[0]=1-(T=s*R)-(C=b*F),l[3]=x-A,l[6]=X+f,l[1]=x+A,l[4]=1-N-C,l[7]=B-z,l[2]=X-f,l[5]=B+z,l[8]=1-N-T;let H=Ql(-Math.asin(el(t[2],-1,1))),at,dt;return Math.hypot(t[5],t[8])<.001?(at=0,dt=-Ql(Math.atan2(t[3],t[4]))):(at=Ql(t[5]===0&&t[8]===0?0:Math.atan2(t[5],t[8])),dt=Ql(t[1]===0&&t[0]===0?0:Math.atan2(t[1],t[0]))),{roll:at,pitch:H+90,bearing:dt}},I.bn=function(i,t){return i.roll==t.roll&&i.pitch==t.pitch&&i.bearing==t.bearing},I.bo=me,I.bp=xa,I.bq=so,I.br=Hs,I.bs=oo,I.bt=Xi,I.bu=Ea,I.bv=Hl,I.bw=function(i,t,l,n,d){return Xi(n,d,el((i-t)/(l-t),0,1))},I.bx=Ml,I.by=function(){return new Float64Array(3)},I.bz=function(i,t,l,n){return i[0]=t[0]+l[0]*n,i[1]=t[1]+l[1]*n,i[2]=t[2]+l[2]*n,i},I.c=Fa,I.c$=class{constructor(i){this._marks={start:[i.url,"start"].join("#"),end:[i.url,"end"].join("#"),measure:i.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let i=performance.getEntriesByName(this._marks.measure);return i.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),i=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),i}},I.c0=Ii,I.c1=class extends Qi{constructor(i,t){super(i,t),this.current=[0,0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]||(this.current=i,this.gl.uniform3f(this.location,i[0],i[1],i[2]))}},I.c2=class extends Qi{constructor(i,t){super(i,t),this.current=[0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]||(this.current=i,this.gl.uniform2f(this.location,i[0],i[1]))}},I.c3=Ie,I.c4=function(i,t){var l=Math.sin(t),n=Math.cos(t);return i[0]=n,i[1]=l,i[2]=0,i[3]=-l,i[4]=n,i[5]=0,i[6]=0,i[7]=0,i[8]=1,i},I.c5=function(i,t,l){var n=t[0],d=t[1],s=t[2];return i[0]=n*l[0]+d*l[3]+s*l[6],i[1]=n*l[1]+d*l[4]+s*l[7],i[2]=n*l[2]+d*l[5]+s*l[8],i},I.c6=function(i,t,l,n,d,s,b){var Z=1/(t-l),V=1/(n-d),R=1/(s-b);return i[0]=-2*Z,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=-2*V,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=2*R,i[11]=0,i[12]=(t+l)*Z,i[13]=(d+n)*V,i[14]=(b+s)*R,i[15]=1,i},I.c7=class extends Qi{constructor(i,t){super(i,t),this.current=new Array}set(i){if(i!=this.current){this.current=i;let t=new Float32Array(4*i.length);for(let l=0;l<i.length;l++)t[4*l]=i[l].r,t[4*l+1]=i[l].g,t[4*l+2]=i[l].b,t[4*l+3]=i[l].a;this.gl.uniform4fv(this.location,t)}}},I.c8=class extends Qi{constructor(i,t){super(i,t),this.current=new Array}set(i){if(i!=this.current){this.current=i;let t=new Float32Array(i);this.gl.uniform1fv(this.location,t)}}},I.c9=class extends $c{},I.cA=function(i){return ua[i]||ja[i]},I.cB=function(i,t,l){var n=t[0],d=t[1];return i[0]=l[0]*n+l[4]*d+l[12],i[1]=l[1]*n+l[5]*d+l[13],i},I.cC=function(i,t){let{x:l,y:n}=Ks.fromLngLat(t);return!(i<0||i>25||n<0||n>=1||l<0||l>=1)},I.cD=function(i,t){return i[0]=t[0],i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=t[1],i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=t[2],i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i},I.cE=class extends _d{},I.cF=zg,I.cH=function(i){return i.message===ia},I.cI=wi,I.cJ=function(i,t){Ai.REGISTERED_PROTOCOLS[i]=t},I.cK=function(i){delete Ai.REGISTERED_PROTOCOLS[i]},I.cL=function(i,t){let l={};for(let d=0;d<i.length;d++){let s=t&&t[i[d].id]||c0(i[d]);t&&(t[i[d].id]=s);let b=l[s];b||(b=l[s]=[]),b.push(i[d])}let n=[];for(let d in l)n.push(l[d]);return n},I.cM=Qt,I.cN=aZ,I.cO=MZ,I.cP=EW,I.cQ=function(i){i.bucket.createArrays(),i.bucket.tilePixelRatio=se/(512*i.bucket.overscaling),i.bucket.compareText={},i.bucket.iconsNeedLinear=!1;let t=i.bucket.layers[0],l=t.layout,n=t._unevaluatedLayout._values,d={layoutIconSize:n["icon-size"].possiblyEvaluate(new Ge(i.bucket.zoom+1),i.canonical),layoutTextSize:n["text-size"].possiblyEvaluate(new Ge(i.bucket.zoom+1),i.canonical),textMaxSize:n["text-size"].possiblyEvaluate(new Ge(18))};if(i.bucket.textSizeData.kind==="composite"){let{minZoom:R,maxZoom:F}=i.bucket.textSizeData;d.compositeTextSizes=[n["text-size"].possiblyEvaluate(new Ge(R),i.canonical),n["text-size"].possiblyEvaluate(new Ge(F),i.canonical)]}if(i.bucket.iconSizeData.kind==="composite"){let{minZoom:R,maxZoom:F}=i.bucket.iconSizeData;d.compositeIconSizes=[n["icon-size"].possiblyEvaluate(new Ge(R),i.canonical),n["icon-size"].possiblyEvaluate(new Ge(F),i.canonical)]}let s=l.get("text-line-height")*Tl,b=l.get("text-rotation-alignment")!=="viewport"&&l.get("symbol-placement")!=="point",Z=l.get("text-keep-upright"),V=l.get("text-size");for(let R of i.bucket.features){let F=l.get("text-font").evaluate(R,{},i.canonical).join(","),N=V.evaluate(R,{},i.canonical),x=d.layoutTextSize.evaluate(R,{},i.canonical),T=d.layoutIconSize.evaluate(R,{},i.canonical),X={horizontal:{},vertical:void 0},B=R.text,C,z=[0,0];if(B){let H=B.toString(),at=l.get("text-letter-spacing").evaluate(R,{},i.canonical)*Tl,dt=Pc(H)?at:0,Wt=l.get("text-anchor").evaluate(R,{},i.canonical),Nt=EZ(t,R,i.canonical);if(!Nt){let Tt=l.get("text-radial-offset").evaluate(R,{},i.canonical);z=Tt?LZ(Wt,[Tt*Tl,vm]):l.get("text-offset").evaluate(R,{},i.canonical).map((Xt=>Xt*Tl))}let Rt=b?"center":l.get("text-justify").evaluate(R,{},i.canonical),It=l.get("symbol-placement")==="point"?l.get("text-max-width").evaluate(R,{},i.canonical)*Tl:1/0,St=()=>{i.bucket.allowVerticalPlacement&&Ad(H)&&(X.vertical=L0(B,i.glyphMap,i.glyphPositions,i.imagePositions,F,It,s,Wt,"left",dt,z,I.ay.vertical,!0,x,N))};if(!b&&Nt){let Tt=new Set;if(Rt==="auto")for(let ut=0;ut<Nt.values.length;ut+=2)Tt.add(Hm(Nt.values[ut]));else Tt.add(Rt);let Xt=!1;for(let ut of Tt)if(!X.horizontal[ut])if(Xt)X.horizontal[ut]=X.horizontal[0];else{let wt=L0(B,i.glyphMap,i.glyphPositions,i.imagePositions,F,It,s,"center",ut,dt,z,I.ay.horizontal,!1,x,N);wt&&(X.horizontal[ut]=wt,Xt=wt.positionedLines.length===1)}St()}else{Rt==="auto"&&(Rt=Hm(Wt));let Tt=L0(B,i.glyphMap,i.glyphPositions,i.imagePositions,F,It,s,Wt,Rt,dt,z,I.ay.horizontal,!1,x,N);Tt&&(X.horizontal[Rt]=Tt),St(),Ad(H)&&b&&Z&&(X.vertical=L0(B,i.glyphMap,i.glyphPositions,i.imagePositions,F,It,s,Wt,Rt,dt,z,I.ay.vertical,!1,x,N))}}let f=!1;if(R.icon&&R.icon.name){let H=i.imageMap[R.icon.name];H&&(C=lg(i.imagePositions[R.icon.name],l.get("icon-offset").evaluate(R,{},i.canonical),l.get("icon-anchor").evaluate(R,{},i.canonical)),f=!!H.sdf,i.bucket.sdfIcons===void 0?i.bucket.sdfIcons=f:i.bucket.sdfIcons!==f&&Le("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(H.pixelRatio!==i.bucket.pixelRatio||l.get("icon-rotate").constantOr(1)!==0)&&(i.bucket.iconsNeedLinear=!0))}let A=jZ(X.horizontal)||X.vertical;i.bucket.iconsInText=!!A&&A.iconsInText,(A||C)&&Lg(i.bucket,R,X,C,i.imageMap,d,x,T,z,f,i.canonical,i.subdivisionGranularity)}i.showCollisionBoxes&&i.bucket.generateCollisionDebugBuffers()},I.cR=Vm,I.cS=gm,I.cT=Rm,I.cU=uW,I.cV=Fm,I.cW=ro,I.cX=function(i,t,l,n,d,s){let b=TZ(i,t,l,d,0);return b=TZ(b,t,n,s,1),b},I.cY=class{constructor(i){this.maxEntries=i,this.map=new Map}get(i){let t=this.map.get(i);return t!==void 0&&(this.map.delete(i),this.map.set(i,t)),t}set(i,t){if(this.map.has(i))this.map.delete(i);else if(this.map.size>=this.maxEntries){let l=this.map.keys().next().value;this.map.delete(l)}this.map.set(i,t)}clear(){this.map.clear()}},I.cZ=FW,I.c_=UZ,I.ca=Sp,I.cb=class extends to{},I.cc=bm,I.cd=function(i){return i<=1?1:Math.pow(2,Math.ceil(Math.log(i)/Math.LN2))},I.ce=dW,I.cf=function(i,t,l){var n=t[0],d=t[1],s=t[2],b=l[3]*n+l[7]*d+l[11]*s+l[15];return i[0]=(l[0]*n+l[4]*d+l[8]*s+l[12])/(b=b||1),i[1]=(l[1]*n+l[5]*d+l[9]*s+l[13])/b,i[2]=(l[2]*n+l[6]*d+l[10]*s+l[14])/b,i},I.cg=class extends ys{},I.ch=class extends c{},I.ci=function(i,t){return i[0]===t[0]&&i[1]===t[1]&&i[2]===t[2]&&i[3]===t[3]&&i[4]===t[4]&&i[5]===t[5]&&i[6]===t[6]&&i[7]===t[7]&&i[8]===t[8]&&i[9]===t[9]&&i[10]===t[10]&&i[11]===t[11]&&i[12]===t[12]&&i[13]===t[13]&&i[14]===t[14]&&i[15]===t[15]},I.cj=function(i,t){var l=i[0],n=i[1],d=i[2],s=i[3],b=i[4],Z=i[5],V=i[6],R=i[7],F=i[8],N=i[9],x=i[10],T=i[11],X=i[12],B=i[13],C=i[14],z=i[15],f=t[0],A=t[1],H=t[2],at=t[3],dt=t[4],Wt=t[5],Nt=t[6],Rt=t[7],It=t[8],St=t[9],Tt=t[10],Xt=t[11],ut=t[12],wt=t[13],vt=t[14],Ot=t[15];return Math.abs(l-f)<=Kt*Math.max(1,Math.abs(l),Math.abs(f))&&Math.abs(n-A)<=Kt*Math.max(1,Math.abs(n),Math.abs(A))&&Math.abs(d-H)<=Kt*Math.max(1,Math.abs(d),Math.abs(H))&&Math.abs(s-at)<=Kt*Math.max(1,Math.abs(s),Math.abs(at))&&Math.abs(b-dt)<=Kt*Math.max(1,Math.abs(b),Math.abs(dt))&&Math.abs(Z-Wt)<=Kt*Math.max(1,Math.abs(Z),Math.abs(Wt))&&Math.abs(V-Nt)<=Kt*Math.max(1,Math.abs(V),Math.abs(Nt))&&Math.abs(R-Rt)<=Kt*Math.max(1,Math.abs(R),Math.abs(Rt))&&Math.abs(F-It)<=Kt*Math.max(1,Math.abs(F),Math.abs(It))&&Math.abs(N-St)<=Kt*Math.max(1,Math.abs(N),Math.abs(St))&&Math.abs(x-Tt)<=Kt*Math.max(1,Math.abs(x),Math.abs(Tt))&&Math.abs(T-Xt)<=Kt*Math.max(1,Math.abs(T),Math.abs(Xt))&&Math.abs(X-ut)<=Kt*Math.max(1,Math.abs(X),Math.abs(ut))&&Math.abs(B-wt)<=Kt*Math.max(1,Math.abs(B),Math.abs(wt))&&Math.abs(C-vt)<=Kt*Math.max(1,Math.abs(C),Math.abs(vt))&&Math.abs(z-Ot)<=Kt*Math.max(1,Math.abs(z),Math.abs(Ot))},I.ck=function(i,t){return i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[3],i[4]=t[4],i[5]=t[5],i[6]=t[6],i[7]=t[7],i[8]=t[8],i[9]=t[9],i[10]=t[10],i[11]=t[11],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15],i},I.cl=i=>i.type==="symbol",I.cm=i=>i.type==="circle",I.cn=i=>i.type==="heatmap",I.co=i=>i.type==="line",I.cp=i=>i.type==="fill",I.cq=i=>i.type==="fill-extrusion",I.cr=i=>i.type==="hillshade",I.cs=i=>i.type==="color-relief",I.ct=i=>i.type==="background",I.cu=i=>i.type==="custom",I.cv=ci,I.cw=function(i,t,l){let n=Ul(t.x-l.x,t.y-l.y),d=Ul(i.x-l.x,i.y-l.y);var s,b;return Ql(Math.atan2(n[0]*d[1]-n[1]*d[0],(s=n)[0]*(b=d)[0]+s[1]*b[1]))},I.cx=gi,I.cy=function(i,t){return ja[t]&&(i instanceof MouseEvent||i instanceof WheelEvent)},I.cz=function(i,t){return ua[t]&&"touches"in i},I.d=Q,I.d0=function(i,t,l,n,d){return o(this,void 0,void 0,(function*(){if(ne())try{return yield za(i,t,l,n,d)}catch{}return(function(s,b,Z,V,R){let F=s.width,N=s.height;ea&&Yl||(ea=new OffscreenCanvas(F,N),Yl=ea.getContext("2d",{willReadFrequently:!0})),ea.width=F,ea.height=N,Yl.drawImage(s,0,0,F,N);let x=Yl.getImageData(b,Z,V,R);return Yl.clearRect(0,0,F,N),x.data})(i,t,l,n,d)}))},I.d1=sW,I.d2=Ft,I.d3=jc,I.d4=_a,I.e=ll,I.f=i=>o(void 0,void 0,void 0,(function*(){if(i.byteLength===0)return createImageBitmap(new ImageData(1,1));let t=new Blob([new Uint8Array(i)],{type:"image/png"});try{return createImageBitmap(t)}catch(l){throw new Error(`Could not load image because of ${l.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}})),I.g=Sn,I.h=i=>new Promise(((t,l)=>{let n=new Image;n.onload=()=>{t(n),URL.revokeObjectURL(n.src),n.onload=null,window.requestAnimationFrame((()=>{n.src=ui}))},n.onerror=()=>l(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));let d=new Blob([new Uint8Array(i)],{type:"image/png"});n.src=i.byteLength?URL.createObjectURL(d):ui})),I.i=Ji,I.j=(i,t)=>nt(ll(i,{type:"json"}),t),I.k=$,I.l=P,I.m=nt,I.n=(i,t)=>nt(ll(i,{type:"arrayBuffer"}),t),I.o=function(i){return new Fm(i).readFields(fp,[])},I.p=LW,I.q=function(i){return/[\u02EA\u02EB\u1100-\u11FF\u2E80-\u2FDF\u3000-\u30FF\u3105-\u312F\u3131-\u318E\u31A0-\u4DBF\u4E00-\uA48C\uA490-\uA4C6\uA960-\uA97C\uAC00-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFE10-\uFE1F\uFE30-\uFE4F\uFF00-\uFFEF]|\uD81B[\uDFE0-\uDFFF]|[\uD81C-\uD822\uD840-\uD868\uD86A-\uD86D\uD86F-\uD872\uD874-\uD879\uD880-\uD883\uD885-\uD88C][\uDC00-\uDFFF]|\uD823[\uDC00-\uDCD5\uDCFF-\uDD1E\uDD80-\uDDF2]|\uD82B[\uDFF0-\uDFFF]|\uD82C[\uDC00-\uDEFB]|\uD83C[\uDE00-\uDEFF]|\uD869[\uDC00-\uDEDF\uDF00-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEAD\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0\uDFF0-\uDFFF]|\uD87B[\uDC00-\uDE5D]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A\uDF50-\uDFFF]|\uD88D[\uDC00-\uDC79]/gim.test(String.fromCodePoint(i))},I.r=zs,I.s=Fi,I.t=Dl,I.u=D,I.v=Ld,I.w=Le,I.x=G0,I.y=Kb,I.z=wd})),U("worker",["./shared"],(function(I){"use strict";class o{constructor(Q,k){this.keyCache={},Q&&this.replace(Q,k)}replace(Q,k){this._layerConfigs={},this._layers={},this.update(Q,[],k)}update(Q,k,j){for(let $ of Q){this._layerConfigs[$.id]=$;let st=this._layers[$.id]=I.bS($,j);st._featureFilter=I.aj(st.filter,j),this.keyCache[$.id]&&delete this.keyCache[$.id]}for(let $ of k)delete this.keyCache[$],delete this._layerConfigs[$],delete this._layers[$];this.familiesBySource={};let P=I.cL(Object.values(this._layerConfigs),this.keyCache);for(let $ of P){let st=$.map((kt=>this._layers[kt.id])),D=st[0];if(D.visibility==="none")continue;let ot=D.source||"",Vt=this.familiesBySource[ot];Vt||(Vt=this.familiesBySource[ot]={});let pt=D.sourceLayer||I.a9,gt=Vt[pt];gt||(gt=Vt[pt]=[]),gt.push(st)}}}class lt{constructor(Q){let k={},j=[];for(let D in Q){let ot=Q[D],Vt=k[D]={};for(let pt in ot){let gt=ot[+pt];if(!gt||gt.bitmap.width===0||gt.bitmap.height===0)continue;let kt={x:0,y:0,w:gt.bitmap.width+2,h:gt.bitmap.height+2};j.push(kt),Vt[pt]={rect:kt,metrics:gt.metrics}}}let{w:P,h:$}=I.p(j),st=new I.r({width:P||1,height:$||1});for(let D in Q){let ot=Q[D];for(let Vt in ot){let pt=ot[+Vt];if(!pt||pt.bitmap.width===0||pt.bitmap.height===0)continue;let gt=k[D][Vt].rect;I.r.copy(pt.bitmap,st,{x:0,y:0},{x:gt.x+1,y:gt.y+1},pt.bitmap)}}this.image=st,this.positions=k}}I.cM("GlyphAtlas",lt);class Ft{constructor(Q){this.tileID=new I.a1(Q.tileID.overscaledZ,Q.tileID.wrap,Q.tileID.canonical.z,Q.tileID.canonical.x,Q.tileID.canonical.y),this.uid=Q.uid,this.zoom=Q.zoom,this.pixelRatio=Q.pixelRatio,this.tileSize=Q.tileSize,this.source=Q.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=Q.showCollisionBoxes,this.collectResourceTiming=!!Q.collectResourceTiming,this.returnDependencies=!!Q.returnDependencies,this.promoteId=Q.promoteId,this.inFlightDependencies=[]}parse(Q,k,j,P,$){return I._(this,void 0,void 0,(function*(){this.status="parsing",this.data=Q,this.collisionBoxArray=new I.ah;let st=new I.cN(Object.keys(Q.layers).sort()),D=new I.cO(this.tileID,this.promoteId);D.bucketLayerIDs=[];let ot={},Vt={featureIndex:D,iconDependencies:{},patternDependencies:{},glyphDependencies:{},dashDependencies:{},availableImages:j,subdivisionGranularity:$},pt=k.familiesBySource[this.source];for(let jt in pt){let _t=Q.layers[jt];if(!_t)continue;_t.version===1&&I.w(`Vector tile source "${this.source}" layer "${jt}" does not use vector tile spec v2 and therefore may have some rendering errors.`);let ri=st.encode(jt),nn=[];for(let xl=0;xl<_t.length;xl++){let Pt=_t.feature(xl),Ga=D.getId(Pt,jt);nn.push({feature:Pt,id:Ga,index:xl,sourceLayerIndex:ri})}for(let xl of pt[jt]){let Pt=xl[0];Pt.source!==this.source&&I.w(`layer.source = ${Pt.source} does not equal this.source = ${this.source}`),Pt.isHidden(this.zoom,!0)||(Ut(xl,this.zoom,j),(ot[Pt.id]=Pt.createBucket({index:D.bucketLayerIDs.length,layers:xl,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:ri,sourceID:this.source})).populate(nn,Vt,this.tileID.canonical),D.bucketLayerIDs.push(xl.map((Ga=>Ga.id))))}}let gt=I.bX(Vt.glyphDependencies,(jt=>Object.keys(jt).map(Number)));this.inFlightDependencies.forEach((jt=>jt?.abort())),this.inFlightDependencies=[];let kt=Promise.resolve({});if(Object.keys(gt).length){let jt=new AbortController;this.inFlightDependencies.push(jt),kt=P.sendAsync({type:"GG",data:{stacks:gt,source:this.source,tileID:this.tileID,type:"glyphs"}},jt)}let Ht=Object.keys(Vt.iconDependencies),ie=Promise.resolve({});if(Ht.length){let jt=new AbortController;this.inFlightDependencies.push(jt),ie=P.sendAsync({type:"GI",data:{icons:Ht,source:this.source,tileID:this.tileID,type:"icons"}},jt)}let Pe=Object.keys(Vt.patternDependencies),be=Promise.resolve({});if(Pe.length){let jt=new AbortController;this.inFlightDependencies.push(jt),be=P.sendAsync({type:"GI",data:{icons:Pe,source:this.source,tileID:this.tileID,type:"patterns"}},jt)}let Re=Vt.dashDependencies,Te=Promise.resolve({});if(Object.keys(Re).length){let jt=new AbortController;this.inFlightDependencies.push(jt),Te=P.sendAsync({type:"GDA",data:{dashes:Re}},jt)}let[Mt,ze,Xe,Wl]=yield Promise.all([kt,ie,be,Te]),Je=new lt(Mt),xt=new I.cP(ze,Xe);for(let jt in ot){let _t=ot[jt];_t instanceof I.ai?(Ut(_t.layers,this.zoom,j),I.cQ({bucket:_t,glyphMap:Mt,glyphPositions:Je.positions,imageMap:ze,imagePositions:xt.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical,subdivisionGranularity:Vt.subdivisionGranularity})):_t.hasDependencies&&(_t instanceof I.cR||_t instanceof I.cS||_t instanceof I.cT)&&(Ut(_t.layers,this.zoom,j),_t.addFeatures(Vt,this.tileID.canonical,xt.patternPositions,Wl))}return this.status="done",{buckets:Object.values(ot).filter((jt=>!jt.isEmpty())),featureIndex:D,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Je.image,imageAtlas:xt,dashPositions:Wl,glyphMap:this.returnDependencies?Mt:null,iconMap:this.returnDependencies?ze:null,glyphPositions:this.returnDependencies?Je.positions:null}}))}}function Ut(nt,Q,k){let j=new I.H(Q);for(let P of nt)P.recalculate(j,k)}class Et extends I.cW{constructor(Q,k){super(new I.cV,0,k,[],[]),this.feature=Q,this.type=Q.type,this.properties=Q.tags?Q.tags:{},"id"in Q&&(typeof Q.id=="string"?this.id=parseInt(Q.id,10):typeof Q.id!="number"||isNaN(Q.id)||(this.id=Q.id))}loadGeometry(){let Q=[],k=this.feature.type===1?[this.feature.geometry]:this.feature.geometry;for(let j of k){let P=[];for(let $ of j)P.push(new I.P($[0],$[1]));Q.push(P)}return Q}}class Bt extends I.cU{constructor(Q,k){super(new I.cV),this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.version=k?k.version:1,this.extent=k?k.extent:4096,this.length=Q.length,this.features=Q}feature(Q){return new Et(this.features[Q],this.extent)}}function ft(nt,Q){Q.writeVarintField(15,nt.version||1),Q.writeStringField(1,nt.name||""),Q.writeVarintField(5,nt.extent||4096);let k={keys:[],values:[],keycache:{},valuecache:{}};for(let $=0;$<nt.length;$++)k.feature=nt.feature($),Q.writeMessage(2,le,k);let j=k.keys;for(let $ of j)Q.writeStringField(3,$);let P=k.values;for(let $ of P)Q.writeMessage(4,$t,$)}function le(nt,Q){if(!nt.feature)return;let k=nt.feature;k.id!==void 0&&Q.writeVarintField(1,k.id),Q.writeMessage(2,Ct,nt),Q.writeVarintField(3,k.type),Q.writeMessage(4,Kt,k)}function Ct(nt,Q){for(let k in nt.feature?.properties){let j=nt.feature.properties[k],P=nt.keycache[k];if(j===null)continue;P===void 0&&(nt.keys.push(k),P=nt.keys.length-1,nt.keycache[k]=P),Q.writeVarint(P),typeof j!="string"&&typeof j!="boolean"&&typeof j!="number"&&(j=JSON.stringify(j));let $=typeof j+":"+j,st=nt.valuecache[$];st===void 0&&(nt.values.push(j),st=nt.values.length-1,nt.valuecache[$]=st),Q.writeVarint(st)}}function rt(nt,Q){return(Q<<3)+(7&nt)}function ne(nt){return nt<<1^nt>>31}function Kt(nt,Q){let k=nt.loadGeometry(),j=nt.type,P=0,$=0;for(let st of k){let D=1;j===1&&(D=st.length),Q.writeVarint(rt(1,D));let ot=j===3?st.length-1:st.length;for(let Vt=0;Vt<ot;Vt++){Vt===1&&j!==1&&Q.writeVarint(rt(2,ot-1));let pt=st[Vt].x-P,gt=st[Vt].y-$;Q.writeVarint(ne(pt)),Q.writeVarint(ne(gt)),P+=pt,$+=gt}nt.type===3&&Q.writeVarint(rt(7,1))}}function $t(nt,Q){let k=typeof nt;k==="string"?Q.writeStringField(1,nt):k==="boolean"?Q.writeBooleanField(7,nt):k==="number"&&(nt%1!=0?Q.writeDoubleField(3,nt):nt<0?Q.writeSVarintField(6,nt):Q.writeVarintField(5,nt))}class Ie extends I.cW{constructor(Q,k,j,P,$){super(new I.cV,0,$,[],[]),this.type=Q,this.properties=j||{},this.extent=$,this.pointsArray=k,this.id=P}loadGeometry(){return this.pointsArray.map((Q=>Q.map((k=>new I.P(k.x,k.y)))))}}class Ue extends I.cU{constructor(Q,k,j){super(new I.cV),this.version=2,this._myFeatures=Q,this.name=k,this.length=Q.length,this.extent=j}feature(Q){return this._myFeatures[Q]}}class oe{constructor(){this.layers={}}addLayer(Q){this.layers[Q.name]=Q}}function ce(nt){let Q=(function(k){let j=new I.cV;return(function(P,$){for(let st in P.layers)$.writeMessage(3,ft,P.layers[st])})(k,j),j.finish()})(nt);return Q.byteOffset===0&&Q.byteLength===Q.buffer.byteLength||(Q=new Uint8Array(Q)),{vectorTile:nt,rawData:Q.buffer}}function ge(nt,Q,k){let{extent:j}=nt,P=Math.pow(2,k.z-Q.z),$=(k.x-Q.x*P)*j,st=(k.y-Q.y*P)*j,D=[];for(let ot=0;ot<nt.length;ot++){let Vt=nt.feature(ot),pt=Vt.loadGeometry();for(let kt of pt)for(let Ht of kt)Ht.x=Ht.x*P-$,Ht.y=Ht.y*P-st;let gt=128;pt=I.cX(pt,Vt.type,-gt,-gt,j+gt,j+gt),pt.length!==0&&D.push(new Ie(Vt.type,pt,Vt.properties,Vt.id,j))}return new Ue(D,nt.name,j)}class ue{constructor(Q,k,j){this.actor=Q,this.layerIndex=k,this.availableImages=j,this.fetching={},this.loading={},this.loaded={},this.overzoomedTileResultCache=new I.cY(1e3)}loadVectorTile(Q,k){return I._(this,void 0,void 0,(function*(){let j=yield I.n(Q.request,k);try{return{vectorTile:Q.encoding!=="mlt"?new I.cZ(new I.cV(j.data)):new I.c_(j.data),rawData:j.data,cacheControl:j.cacheControl,expires:j.expires}}catch(P){let $=new Uint8Array(j.data),st=`Unable to parse the tile at ${Q.request.url}, `;throw st+=$[0]===31&&$[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${P.message}`,new Error(st)}}))}loadTile(Q){return I._(this,void 0,void 0,(function*(){let{uid:k,overzoomParameters:j}=Q;j&&(Q.request=j.overzoomRequest);let P=!!(Q&&Q.request&&Q.request.collectResourceTiming)&&new I.c$(Q.request),$=new Ft(Q);this.loading[k]=$;let st=new AbortController;$.abort=st;try{let D=yield this.loadVectorTile(Q,st);if(delete this.loading[k],!D)return null;if(j){let kt=this._getOverzoomTile(Q,D.vectorTile);D.rawData=kt.rawData,D.vectorTile=kt.vectorTile}let ot=D.rawData,Vt={};D.expires&&(Vt.expires=D.expires),D.cacheControl&&(Vt.cacheControl=D.cacheControl);let pt={};if(P){let kt=P.finish();kt&&(pt.resourceTiming=JSON.parse(JSON.stringify(kt)))}$.vectorTile=D.vectorTile;let gt=$.parse(D.vectorTile,this.layerIndex,this.availableImages,this.actor,Q.subdivisionGranularity);this.loaded[k]=$,this.fetching[k]={rawTileData:ot,cacheControl:Vt,resourceTiming:pt};try{let kt=yield gt;return I.e({rawTileData:ot.slice(0),encoding:Q.encoding},kt,Vt,pt)}finally{delete this.fetching[k]}}catch(D){throw delete this.loading[k],$.status="done",this.loaded[k]=$,D}}))}_getOverzoomTile(Q,k){let{tileID:j,source:P,overzoomParameters:$}=Q,{maxZoomTileID:st}=$,D=`${st.key}_${j.key}`,ot=this.overzoomedTileResultCache.get(D);if(ot)return ot;let Vt=new oe,pt=this.layerIndex.familiesBySource[P];for(let kt in pt){let Ht=k.layers[kt];if(!Ht)continue;let ie=ge(Ht,st,j.canonical);ie.length>0&&Vt.addLayer(ie)}let gt=ce(Vt);return this.overzoomedTileResultCache.set(D,gt),gt}reloadTile(Q){return I._(this,void 0,void 0,(function*(){let k=Q.uid;if(!this.loaded||!this.loaded[k])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");let j=this.loaded[k];if(j.showCollisionBoxes=Q.showCollisionBoxes,j.status==="parsing"){let P=yield j.parse(j.vectorTile,this.layerIndex,this.availableImages,this.actor,Q.subdivisionGranularity),$;if(this.fetching[k]){let{rawTileData:st,cacheControl:D,resourceTiming:ot}=this.fetching[k];delete this.fetching[k],$=I.e({rawTileData:st.slice(0),encoding:Q.encoding},P,D,ot)}else $=P;return $}if(j.status==="done"&&j.vectorTile)return j.parse(j.vectorTile,this.layerIndex,this.availableImages,this.actor,Q.subdivisionGranularity)}))}abortTile(Q){return I._(this,void 0,void 0,(function*(){let k=this.loading,j=Q.uid;k&&k[j]&&k[j].abort&&(k[j].abort.abort(),delete k[j])}))}removeTile(Q){return I._(this,void 0,void 0,(function*(){this.loaded&&this.loaded[Q.uid]&&delete this.loaded[Q.uid]}))}}class Qe{constructor(){this.loaded={}}loadTile(Q){return I._(this,void 0,void 0,(function*(){let{uid:k,encoding:j,rawImageData:P,redFactor:$,greenFactor:st,blueFactor:D,baseShift:ot}=Q,Vt=P.width+2,pt=P.height+2,gt=I.b(P)?new I.R({width:Vt,height:pt},yield I.d0(P,-1,-1,Vt,pt)):P,kt=new I.d1(k,gt,j,$,st,D,ot);return this.loaded=this.loaded||{},this.loaded[k]=kt,kt}))}removeTile(Q){let k=this.loaded,j=Q.uid;k&&k[j]&&delete k[j]}}var ke,Me,He=(function(){if(Me)return ke;function nt(k,j){if(k.length!==0){Q(k[0],j);for(var P=1;P<k.length;P++)Q(k[P],!j)}}function Q(k,j){for(var P=0,$=0,st=0,D=k.length,ot=D-1;st<D;ot=st++){var Vt=(k[st][0]-k[ot][0])*(k[ot][1]+k[st][1]),pt=P+Vt;$+=Math.abs(P)>=Math.abs(Vt)?P-pt+Vt:Vt-pt+P,P=pt}P+$>=0!=!!j&&k.reverse()}return Me=1,ke=function k(j,P){var $,st=j&&j.type;if(st==="FeatureCollection")for($=0;$<j.features.length;$++)k(j.features[$],P);else if(st==="GeometryCollection")for($=0;$<j.geometries.length;$++)k(j.geometries[$],P);else if(st==="Feature")k(j.geometry,P);else if(st==="Polygon")nt(j.coordinates,P);else if(st==="MultiPolygon")for($=0;$<j.coordinates.length;$++)nt(j.coordinates[$],P);return j}})(),Cl=I.d2(He);let cl={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:nt=>nt},pi=Math.fround||(Fl=new Float32Array(1),nt=>(Fl[0]=+nt,Fl[0]));var Fl;class Ul{constructor(Q){this.options=Object.assign(Object.create(cl),Q),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(Q){let{log:k,minZoom:j,maxZoom:P}=this.options;k&&console.time("total time");let $=`prepare ${Q.length} points`;k&&console.time($),this.points=Q;let st=[];for(let ot=0;ot<Q.length;ot++){let Vt=Q[ot];if(!Vt.geometry)continue;let[pt,gt]=Vt.geometry.coordinates,kt=pi(Ml(pt)),Ht=pi(Xi(gt));st.push(kt,Ht,1/0,ot,-1,1),this.options.reduce&&st.push(0)}let D=this.trees[P+1]=this._createTree(st);k&&console.timeEnd($);for(let ot=P;ot>=j;ot--){let Vt=+Date.now();D=this.trees[ot]=this._createTree(this._cluster(D,ot)),k&&console.log("z%d: %d clusters in %dms",ot,D.numItems,+Date.now()-Vt)}return k&&console.timeEnd("total time"),this}getClusters(Q,k){let j=((Q[0]+180)%360+360)%360-180,P=Math.max(-90,Math.min(90,Q[1])),$=Q[2]===180?180:((Q[2]+180)%360+360)%360-180,st=Math.max(-90,Math.min(90,Q[3]));if(Q[2]-Q[0]>=360)j=-180,$=180;else if(j>$){let gt=this.getClusters([j,P,180,st],k),kt=this.getClusters([-180,P,$,st],k);return gt.concat(kt)}let D=this.trees[this._limitZoom(k)],ot=D.range(Ml(j),Xi(st),Ml($),Xi(P)),Vt=D.data,pt=[];for(let gt of ot){let kt=this.stride*gt;pt.push(Vt[kt+5]>1?se(Vt,kt,this.clusterProps):this.points[Vt[kt+3]])}return pt}getChildren(Q){let k=this._getOriginId(Q),j=this._getOriginZoom(Q),P="No cluster with the specified id.",$=this.trees[j];if(!$)throw new Error(P);let st=$.data;if(k*this.stride>=st.length)throw new Error(P);let D=this.options.radius/(this.options.extent*Math.pow(2,j-1)),ot=$.within(st[k*this.stride],st[k*this.stride+1],D),Vt=[];for(let pt of ot){let gt=pt*this.stride;st[gt+4]===Q&&Vt.push(st[gt+5]>1?se(st,gt,this.clusterProps):this.points[st[gt+3]])}if(Vt.length===0)throw new Error(P);return Vt}getLeaves(Q,k,j){let P=[];return this._appendLeaves(P,Q,k=k||10,j=j||0,0),P}getTile(Q,k,j){let P=this.trees[this._limitZoom(Q)],$=Math.pow(2,Q),{extent:st,radius:D}=this.options,ot=D/st,Vt=(j-ot)/$,pt=(j+1+ot)/$,gt={features:[]};return this._addTileFeatures(P.range((k-ot)/$,Vt,(k+1+ot)/$,pt),P.data,k,j,$,gt),k===0&&this._addTileFeatures(P.range(1-ot/$,Vt,1,pt),P.data,$,j,$,gt),k===$-1&&this._addTileFeatures(P.range(0,Vt,ot/$,pt),P.data,-1,j,$,gt),gt.features.length?gt:null}getClusterExpansionZoom(Q){let k=this._getOriginZoom(Q)-1;for(;k<=this.options.maxZoom;){let j=this.getChildren(Q);if(k++,j.length!==1)break;Q=j[0].properties.cluster_id}return k}_appendLeaves(Q,k,j,P,$){let st=this.getChildren(k);for(let D of st){let ot=D.properties;if(ot&&ot.cluster?$+ot.point_count<=P?$+=ot.point_count:$=this._appendLeaves(Q,ot.cluster_id,j,P,$):$<P?$++:Q.push(D),Q.length===j)break}return $}_createTree(Q){let k=new I.aS(Q.length/this.stride|0,this.options.nodeSize,Float32Array);for(let j=0;j<Q.length;j+=this.stride)k.add(Q[j],Q[j+1]);return k.finish(),k.data=Q,k}_addTileFeatures(Q,k,j,P,$,st){for(let D of Q){let ot=D*this.stride,Vt=k[ot+5]>1,pt,gt,kt;if(Vt)pt=Ei(k,ot,this.clusterProps),gt=k[ot],kt=k[ot+1];else{let Pe=this.points[k[ot+3]];pt=Pe.properties;let[be,Re]=Pe.geometry.coordinates;gt=Ml(be),kt=Xi(Re)}let Ht={type:1,geometry:[[Math.round(this.options.extent*(gt*$-j)),Math.round(this.options.extent*(kt*$-P))]],tags:pt},ie;ie=Vt||this.options.generateId?k[ot+3]:this.points[k[ot+3]].id,ie!==void 0&&(Ht.id=ie),st.features.push(Ht)}}_limitZoom(Q){return Math.max(this.options.minZoom,Math.min(Math.floor(+Q),this.options.maxZoom+1))}_cluster(Q,k){let{radius:j,extent:P,reduce:$,minPoints:st}=this.options,D=j/(P*Math.pow(2,k)),ot=Q.data,Vt=[],pt=this.stride;for(let gt=0;gt<ot.length;gt+=pt){if(ot[gt+2]<=k)continue;ot[gt+2]=k;let kt=ot[gt],Ht=ot[gt+1],ie=Q.within(ot[gt],ot[gt+1],D),Pe=ot[gt+5],be=Pe;for(let Re of ie){let Te=Re*pt;ot[Te+2]>k&&(be+=ot[Te+5])}if(be>Pe&&be>=st){let Re,Te=kt*Pe,Mt=Ht*Pe,ze=-1,Xe=(gt/pt<<5)+(k+1)+this.points.length;for(let Wl of ie){let Je=Wl*pt;if(ot[Je+2]<=k)continue;ot[Je+2]=k;let xt=ot[Je+5];Te+=ot[Je]*xt,Mt+=ot[Je+1]*xt,ot[Je+4]=Xe,$&&(Re||(Re=this._map(ot,gt,!0),ze=this.clusterProps.length,this.clusterProps.push(Re)),$(Re,this._map(ot,Je)))}ot[gt+4]=Xe,Vt.push(Te/be,Mt/be,1/0,Xe,-1,be),$&&Vt.push(ze)}else{for(let Re=0;Re<pt;Re++)Vt.push(ot[gt+Re]);if(be>1)for(let Re of ie){let Te=Re*pt;if(!(ot[Te+2]<=k)){ot[Te+2]=k;for(let Mt=0;Mt<pt;Mt++)Vt.push(ot[Te+Mt])}}}}return Vt}_getOriginId(Q){return Q-this.points.length>>5}_getOriginZoom(Q){return(Q-this.points.length)%32}_map(Q,k,j){if(Q[k+5]>1){let st=this.clusterProps[Q[k+6]];return j?Object.assign({},st):st}let P=this.points[Q[k+3]].properties,$=this.options.map(P);return j&&$===P?Object.assign({},$):$}}function se(nt,Q,k){return{type:"Feature",id:nt[Q+3],properties:Ei(nt,Q,k),geometry:{type:"Point",coordinates:[(j=nt[Q],360*(j-.5)),Ea(nt[Q+1])]}};var j}function Ei(nt,Q,k){let j=nt[Q+5],P=j>=1e4?`${Math.round(j/1e3)}k`:j>=1e3?Math.round(j/100)/10+"k":j,$=nt[Q+6],st=$===-1?{}:Object.assign({},k[$]);return Object.assign(st,{cluster:!0,cluster_id:nt[Q+3],point_count:j,point_count_abbreviated:P})}function Ml(nt){return nt/360+.5}function Xi(nt){let Q=Math.sin(nt*Math.PI/180),k=.5-.25*Math.log((1+Q)/(1-Q))/Math.PI;return k<0?0:k>1?1:k}function Ea(nt){let Q=(180-360*nt)*Math.PI/180;return 360*Math.atan(Math.exp(Q))/Math.PI-90}function ci(nt,Q,k,j){let P=j,$=Q+(k-Q>>1),st,D=k-Q,ot=nt[Q],Vt=nt[Q+1],pt=nt[k],gt=nt[k+1];for(let kt=Q+3;kt<k;kt+=3){let Ht=gi(nt[kt],nt[kt+1],ot,Vt,pt,gt);if(Ht>P)st=kt,P=Ht;else if(Ht===P){let ie=Math.abs(kt-$);ie<D&&(st=kt,D=ie)}}P>j&&(st-Q>3&&ci(nt,Q,st,j),nt[st+2]=P,k-st>3&&ci(nt,st,k,j))}function gi(nt,Q,k,j,P,$){let st=P-k,D=$-j;if(st!==0||D!==0){let ot=((nt-k)*st+(Q-j)*D)/(st*st+D*D);ot>1?(k=P,j=$):ot>0&&(k+=st*ot,j+=D*ot)}return st=nt-k,D=Q-j,st*st+D*D}function el(nt,Q,k,j){let P={id:nt??null,type:Q,geometry:k,tags:j,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(Q==="Point"||Q==="MultiPoint"||Q==="LineString")ml(P,k);else if(Q==="Polygon")ml(P,k[0]);else if(Q==="MultiLineString")for(let $ of k)ml(P,$);else if(Q==="MultiPolygon")for(let $ of k)ml(P,$[0]);return P}function ml(nt,Q){for(let k=0;k<Q.length;k+=3)nt.minX=Math.min(nt.minX,Q[k]),nt.minY=Math.min(nt.minY,Q[k+1]),nt.maxX=Math.max(nt.maxX,Q[k]),nt.maxY=Math.max(nt.maxY,Q[k+1])}function ll(nt,Q,k,j){if(!Q.geometry)return;let P=Q.geometry.coordinates;if(P&&P.length===0)return;let $=Q.geometry.type,st=Math.pow(k.tolerance/((1<<k.maxZoom)*k.extent),2),D=[],ot=Q.id;if(k.promoteId?ot=Q.properties[k.promoteId]:k.generateId&&(ot=j||0),$==="Point")zi(P,D);else if($==="MultiPoint")for(let Vt of P)zi(Vt,D);else if($==="LineString")Al(P,D,st,!1);else if($==="MultiLineString"){if(k.lineMetrics){for(let Vt of P)D=[],Al(Vt,D,st,!1),nt.push(el(ot,"LineString",D,Q.properties));return}ji(P,D,st,!1)}else if($==="Polygon")ji(P,D,st,!0);else{if($!=="MultiPolygon"){if($==="GeometryCollection"){for(let Vt of Q.geometry.geometries)ll(nt,{id:ot,geometry:Vt,properties:Q.properties},k,j);return}throw new Error("Input data is not a valid GeoJSON object.")}for(let Vt of P){let pt=[];ji(Vt,pt,st,!0),D.push(pt)}}nt.push(el(ot,$,D,Q.properties))}function zi(nt,Q){Q.push(oi(nt[0]),Ra(nt[1]),0)}function Al(nt,Q,k,j){let P,$,st=0;for(let ot=0;ot<nt.length;ot++){let Vt=oi(nt[ot][0]),pt=Ra(nt[ot][1]);Q.push(Vt,pt,0),ot>0&&(st+=j?(P*pt-Vt*$)/2:Math.sqrt(Math.pow(Vt-P,2)+Math.pow(pt-$,2))),P=Vt,$=pt}let D=Q.length-3;Q[2]=1,ci(Q,0,D,k),Q[D+2]=1,Q.size=Math.abs(st),Q.start=0,Q.end=Q.size}function ji(nt,Q,k,j){for(let P=0;P<nt.length;P++){let $=[];Al(nt[P],$,k,j),Q.push($)}}function oi(nt){return nt/360+.5}function Ra(nt){let Q=Math.sin(nt*Math.PI/180),k=.5-.25*Math.log((1+Q)/(1-Q))/Math.PI;return k<0?0:k>1?1:k}function Le(nt,Q,k,j,P,$,st,D){if(j/=Q,$>=(k/=Q)&&st<j)return nt;if(st<k||$>=j)return null;let ot=[];for(let Vt of nt){let pt=Vt.geometry,gt=Vt.type,kt=P===0?Vt.minX:Vt.minY,Ht=P===0?Vt.maxX:Vt.maxY;if(kt>=k&&Ht<j){ot.push(Vt);continue}if(Ht<k||kt>=j)continue;let ie=[];if(gt==="Point"||gt==="MultiPoint")si(pt,ie,k,j,P);else if(gt==="LineString")Ji(pt,ie,k,j,P,!1,D.lineMetrics);else if(gt==="MultiLineString")Ri(pt,ie,k,j,P,!1);else if(gt==="Polygon")Ri(pt,ie,k,j,P,!0);else if(gt==="MultiPolygon")for(let Pe of pt){let be=[];Ri(Pe,be,k,j,P,!0),be.length&&ie.push(be)}if(ie.length){if(D.lineMetrics&&gt==="LineString"){for(let Pe of ie)ot.push(el(Vt.id,gt,Pe,Vt.tags));continue}gt!=="LineString"&&gt!=="MultiLineString"||(ie.length===1?(gt="LineString",ie=ie[0]):gt="MultiLineString"),gt!=="Point"&&gt!=="MultiPoint"||(gt=ie.length===3?"Point":"MultiPoint"),ot.push(el(Vt.id,gt,ie,Vt.tags))}}return ot.length?ot:null}function si(nt,Q,k,j,P){for(let $=0;$<nt.length;$+=3){let st=nt[$+P];st>=k&&st<=j&&ui(Q,nt[$],nt[$+1],nt[$+2])}}function Ji(nt,Q,k,j,P,$,st){let D=Ee(nt),ot=P===0?za:ea,Vt,pt,gt=nt.start;for(let be=0;be<nt.length-3;be+=3){let Re=nt[be],Te=nt[be+1],Mt=nt[be+2],ze=nt[be+3],Xe=nt[be+4],Wl=P===0?Re:Te,Je=P===0?ze:Xe,xt=!1;st&&(Vt=Math.sqrt(Math.pow(Re-ze,2)+Math.pow(Te-Xe,2))),Wl<k?Je>k&&(pt=ot(D,Re,Te,ze,Xe,k),st&&(D.start=gt+Vt*pt)):Wl>j?Je<j&&(pt=ot(D,Re,Te,ze,Xe,j),st&&(D.start=gt+Vt*pt)):ui(D,Re,Te,Mt),Je<k&&Wl>=k&&(pt=ot(D,Re,Te,ze,Xe,k),xt=!0),Je>j&&Wl<=j&&(pt=ot(D,Re,Te,ze,Xe,j),xt=!0),!$&&xt&&(st&&(D.end=gt+Vt*pt),Q.push(D),D=Ee(nt)),st&&(gt+=Vt)}let kt=nt.length-3,Ht=nt[kt],ie=nt[kt+1],Pe=P===0?Ht:ie;Pe>=k&&Pe<=j&&ui(D,Ht,ie,nt[kt+2]),kt=D.length-3,$&&kt>=3&&(D[kt]!==D[0]||D[kt+1]!==D[1])&&ui(D,D[0],D[1],D[2]),D.length&&Q.push(D)}function Ee(nt){let Q=[];return Q.size=nt.size,Q.start=nt.start,Q.end=nt.end,Q}function Ri(nt,Q,k,j,P,$){for(let st of nt)Ji(st,Q,k,j,P,$,!1)}function ui(nt,Q,k,j){nt.push(Q,k,j)}function za(nt,Q,k,j,P,$){let st=($-Q)/(j-Q);return ui(nt,$,k+(P-k)*st,1),st}function ea(nt,Q,k,j,P,$){let st=($-k)/(P-k);return ui(nt,Q+(j-Q)*st,$,1),st}function Yl(nt,Q){let k=[];for(let j=0;j<nt.length;j++){let P=nt[j],$=P.type,st;if($==="Point"||$==="MultiPoint"||$==="LineString")st=Fi(P.geometry,Q);else if($==="MultiLineString"||$==="Polygon"){st=[];for(let D of P.geometry)st.push(Fi(D,Q))}else if($==="MultiPolygon"){st=[];for(let D of P.geometry){let ot=[];for(let Vt of D)ot.push(Fi(Vt,Q));st.push(ot)}}k.push(el(P.id,$,st,P.tags))}return k}function Fi(nt,Q){let k=[];k.size=nt.size,nt.start!==void 0&&(k.start=nt.start,k.end=nt.end);for(let j=0;j<nt.length;j+=3)k.push(nt[j]+Q,nt[j+1],nt[j+2]);return k}function la(nt,Q){if(nt.transformed)return nt;let k=1<<nt.z,j=nt.x,P=nt.y;for(let $ of nt.features){let st=$.geometry,D=$.type;if($.geometry=[],D===1)for(let ot=0;ot<st.length;ot+=2)$.geometry.push(Ql(st[ot],st[ot+1],Q,k,j,P));else for(let ot=0;ot<st.length;ot++){let Vt=[];for(let pt=0;pt<st[ot].length;pt+=2)Vt.push(Ql(st[ot][pt],st[ot][pt+1],Q,k,j,P));$.geometry.push(Vt)}}return nt.transformed=!0,nt}function Ql(nt,Q,k,j,P,$){return[Math.round(k*(nt*j-P)),Math.round(k*(Q*j-$))]}function ua(nt,Q,k,j,P){let $=Q===P.maxZoom?0:P.tolerance/((1<<Q)*P.extent),st={features:[],numPoints:0,numSimplified:0,numFeatures:nt.length,source:null,x:k,y:j,z:Q,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(let D of nt)ja(st,D,$,P);return st}function ja(nt,Q,k,j){let P=Q.geometry,$=Q.type,st=[];if(nt.minX=Math.min(nt.minX,Q.minX),nt.minY=Math.min(nt.minY,Q.minY),nt.maxX=Math.max(nt.maxX,Q.maxX),nt.maxY=Math.max(nt.maxY,Q.maxY),$==="Point"||$==="MultiPoint")for(let D=0;D<P.length;D+=3)st.push(P[D],P[D+1]),nt.numPoints++,nt.numSimplified++;else if($==="LineString")ia(st,P,nt,k,!1,!1);else if($==="MultiLineString"||$==="Polygon")for(let D=0;D<P.length;D++)ia(st,P[D],nt,k,$==="Polygon",D===0);else if($==="MultiPolygon")for(let D=0;D<P.length;D++){let ot=P[D];for(let Vt=0;Vt<ot.length;Vt++)ia(st,ot[Vt],nt,k,!0,Vt===0)}if(st.length){let D=Q.tags||null;if($==="LineString"&&j.lineMetrics){D={};for(let Vt in Q.tags)D[Vt]=Q.tags[Vt];D.mapbox_clip_start=P.start/P.size,D.mapbox_clip_end=P.end/P.size}let ot={geometry:st,type:$==="Polygon"||$==="MultiPolygon"?3:$==="LineString"||$==="MultiLineString"?2:1,tags:D};Q.id!==null&&(ot.id=Q.id),nt.features.push(ot)}}function ia(nt,Q,k,j,P,$){let st=j*j;if(j>0&&Q.size<(P?st:j))return void(k.numPoints+=Q.length/3);let D=[];for(let ot=0;ot<Q.length;ot+=3)(j===0||Q[ot+2]>st)&&(k.numSimplified++,D.push(Q[ot],Q[ot+1])),k.numPoints++;P&&(function(ot,Vt){let pt=0;for(let gt=0,kt=ot.length,Ht=kt-2;gt<kt;Ht=gt,gt+=2)pt+=(ot[gt]-ot[Ht])*(ot[gt+1]+ot[Ht+1]);if(pt>0===Vt)for(let gt=0,kt=ot.length;gt<kt/2;gt+=2){let Ht=ot[gt],ie=ot[gt+1];ot[gt]=ot[kt-2-gt],ot[gt+1]=ot[kt-1-gt],ot[kt-2-gt]=Ht,ot[kt-1-gt]=ie}})(D,$),nt.push(D)}let Fa={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class Ai{constructor(Q,k){let j=(k=this.options=(function($,st){for(let D in st)$[D]=st[D];return $})(Object.create(Fa),k)).debug;if(j&&console.time("preprocess data"),k.maxZoom<0||k.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(k.promoteId&&k.generateId)throw new Error("promoteId and generateId cannot be used together.");let P=(function($,st){let D=[];if($.type==="FeatureCollection")for(let ot=0;ot<$.features.length;ot++)ll(D,$.features[ot],st,ot);else ll(D,$.type==="Feature"?$:{geometry:$},st);return D})(Q,k);this.tiles={},this.tileCoords=[],j&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",k.indexMaxZoom,k.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),P=(function($,st){let D=st.buffer/st.extent,ot=$,Vt=Le($,1,-1-D,D,0,-1,2,st),pt=Le($,1,1-D,2+D,0,-1,2,st);return(Vt||pt)&&(ot=Le($,1,-D,1+D,0,-1,2,st)||[],Vt&&(ot=Yl(Vt,1).concat(ot)),pt&&(ot=ot.concat(Yl(pt,-1)))),ot})(P,k),P.length&&this.splitTile(P,0,0,0),j&&(P.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(Q,k,j,P,$,st,D){let ot=[Q,k,j,P],Vt=this.options,pt=Vt.debug;for(;ot.length;){P=ot.pop(),j=ot.pop(),k=ot.pop(),Q=ot.pop();let gt=1<<k,kt=Sn(k,j,P),Ht=this.tiles[kt];if(!Ht&&(pt>1&&console.time("creation"),Ht=this.tiles[kt]=ua(Q,k,j,P,Vt),this.tileCoords.push({z:k,x:j,y:P}),pt)){pt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",k,j,P,Ht.numFeatures,Ht.numPoints,Ht.numSimplified),console.timeEnd("creation"));let xt=`z${k}`;this.stats[xt]=(this.stats[xt]||0)+1,this.total++}if(Ht.source=Q,$==null){if(k===Vt.indexMaxZoom||Ht.numPoints<=Vt.indexMaxPoints)continue}else{if(k===Vt.maxZoom||k===$)continue;if($!=null){let xt=$-k;if(j!==st>>xt||P!==D>>xt)continue}}if(Ht.source=null,Q.length===0)continue;pt>1&&console.time("clipping");let ie=.5*Vt.buffer/Vt.extent,Pe=.5-ie,be=.5+ie,Re=1+ie,Te=null,Mt=null,ze=null,Xe=null,Wl=Le(Q,gt,j-ie,j+be,0,Ht.minX,Ht.maxX,Vt),Je=Le(Q,gt,j+Pe,j+Re,0,Ht.minX,Ht.maxX,Vt);Q=null,Wl&&(Te=Le(Wl,gt,P-ie,P+be,1,Ht.minY,Ht.maxY,Vt),Mt=Le(Wl,gt,P+Pe,P+Re,1,Ht.minY,Ht.maxY,Vt),Wl=null),Je&&(ze=Le(Je,gt,P-ie,P+be,1,Ht.minY,Ht.maxY,Vt),Xe=Le(Je,gt,P+Pe,P+Re,1,Ht.minY,Ht.maxY,Vt),Je=null),pt>1&&console.timeEnd("clipping"),ot.push(Te||[],k+1,2*j,2*P),ot.push(Mt||[],k+1,2*j,2*P+1),ot.push(ze||[],k+1,2*j+1,2*P),ot.push(Xe||[],k+1,2*j+1,2*P+1)}}getTile(Q,k,j){Q=+Q,k=+k,j=+j;let P=this.options,{extent:$,debug:st}=P;if(Q<0||Q>24)return null;let D=1<<Q,ot=Sn(Q,k=k+D&D-1,j);if(this.tiles[ot])return la(this.tiles[ot],$);st>1&&console.log("drilling down to z%d-%d-%d",Q,k,j);let Vt,pt=Q,gt=k,kt=j;for(;!Vt&&pt>0;)pt--,gt>>=1,kt>>=1,Vt=this.tiles[Sn(pt,gt,kt)];return Vt&&Vt.source?(st>1&&(console.log("found parent tile z%d-%d-%d",pt,gt,kt),console.time("drilling down")),this.splitTile(Vt.source,pt,gt,kt,Q,k,j),st>1&&console.timeEnd("drilling down"),this.tiles[ot]?la(this.tiles[ot],$):null):null}}function Sn(nt,Q,k){return 32*((1<<nt)*k+Q)+nt}class an extends ue{constructor(Q,k,j,P=wi){super(Q,k,j),this._dataUpdateable=new Map,this._createGeoJSONIndex=P}loadVectorTile(Q,k){return I._(this,void 0,void 0,(function*(){let j=Q.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");let P=this._geoJSONIndex.getTile(j.z,j.x,j.y);return P?ce(new Bt(P.features,{version:2,extent:I.a4})):null}))}loadData(Q){return I._(this,void 0,void 0,(function*(){var k;(k=this._pendingRequest)===null||k===void 0||k.abort();let j=this._startPerformance(Q);this._pendingRequest=new AbortController;try{(!this._pendingData||Q.request||Q.data||Q.dataDiff)&&(this._pendingData=this.loadAndProcessGeoJSON(Q,this._pendingRequest));let P=yield this._pendingData;this._geoJSONIndex=this._createGeoJSONIndex(P,Q),this.loaded={};let $=Q.dataDiff&&I.a6(P)?{applyDiff:!0}:{data:P};return this._finishPerformance(j,Q,$),$}catch(P){if(delete this._pendingRequest,I.cH(P))return{abandoned:!0};throw P}}))}_startPerformance(Q){var k;if(!((k=Q?.request)===null||k===void 0)&&k.collectResourceTiming)return new I.c$(Q.request)}_finishPerformance(Q,k,j){if(!Q)return;let P=Q.finish();P&&(j.resourceTiming={},j.resourceTiming[k.source]=JSON.parse(JSON.stringify(P)))}getData(){return I._(this,void 0,void 0,(function*(){return this._pendingData}))}reloadTile(Q){let k=this.loaded;return k&&k[Q.uid]?super.reloadTile(Q):this.loadTile(Q)}loadAndProcessGeoJSON(Q,k){return I._(this,void 0,void 0,(function*(){let j;if(Q.request?j=yield this.loadGeoJSONFromUrl(Q.request,Q.promoteId,k):Q.data?j=this._loadGeoJSONFromObject(Q.data,Q.promoteId):Q.dataDiff&&(j=this._loadGeoJSONFromDiff(Q.dataDiff,Q.promoteId,Q.source)),delete this._pendingRequest,typeof j!="object")throw new Error(`Input data given to '${Q.source}' is not a valid GeoJSON object.`);return Cl(j,!0),Q.filter&&(j=this._filterGeoJSON(j,Q.filter)),j}))}loadGeoJSONFromUrl(Q,k,j){return I._(this,void 0,void 0,(function*(){let P=yield I.j(Q,j);return this._dataUpdateable=I.a6(P.data,k)?I.a7(P.data,k):void 0,P.data}))}_loadGeoJSONFromObject(Q,k){return this._dataUpdateable=I.a6(Q,k)?I.a7(Q,k):void 0,Q}_loadGeoJSONFromDiff(Q,k,j){if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${j}`);I.a8(this._dataUpdateable,Q,k);let P=Array.from(this._dataUpdateable.values());return this._toFeatureCollection(P)}_filterGeoJSON(Q,k){let j=I.d3(k,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(j.result==="error")throw new Error(j.value.map(($=>`${$.key}: ${$.message}`)).join(", "));let P=Q.features.filter(($=>j.value.evaluate({zoom:0},$)));return this._toFeatureCollection(P)}_toFeatureCollection(Q){return{type:"FeatureCollection",features:Q}}removeSource(Q){return I._(this,void 0,void 0,(function*(){this._pendingRequest&&this._pendingRequest.abort()}))}getClusterExpansionZoom(Q){return this._geoJSONIndex.getClusterExpansionZoom(Q.clusterId)}getClusterChildren(Q){return this._geoJSONIndex.getChildren(Q.clusterId)}getClusterLeaves(Q){return this._geoJSONIndex.getLeaves(Q.clusterId,Q.limit,Q.offset)}}function wi(nt,Q){return Q.cluster?new Ul((function({superclusterOptions:k,clusterProperties:j}){if(!j||!k)return k;let P={},$={},st={accumulated:null,zoom:0},D={properties:null},ot=Object.keys(j);for(let Vt of ot){let[pt,gt]=j[Vt],kt=I.d3(gt),Ht=I.d3(typeof pt=="string"?[pt,["accumulated"],["get",Vt]]:pt);P[Vt]=kt.value,$[Vt]=Ht.value}return k.map=Vt=>{D.properties=Vt;let pt={};for(let gt of ot)pt[gt]=P[gt].evaluate(st,D);return pt},k.reduce=(Vt,pt)=>{D.properties=pt;for(let gt of ot)st.accumulated=Vt[gt],Vt[gt]=$[gt].evaluate(st,D)},k})(Q)).load(nt.features):(function(k,j){return new Ai(k,j)})(nt,Q.geojsonVtOptions)}class Gi{constructor(Q){this.self=Q,this.actor=new I.L(Q),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.globalStates=new Map,this.self.registerWorkerSource=(k,j)=>{if(this.externalWorkerSourceTypes[k])throw new Error(`Worker source with name "${k}" already registered.`);this.externalWorkerSourceTypes[k]=j},this.self.addProtocol=I.cJ,this.self.removeProtocol=I.cK,this.self.registerRTLTextPlugin=k=>{I.d4.setMethods(k)},this.actor.registerMessageHandler("LDT",((k,j)=>this._getDEMWorkerSource(k,j.source).loadTile(j))),this.actor.registerMessageHandler("RDT",((k,j)=>I._(this,void 0,void 0,(function*(){this._getDEMWorkerSource(k,j.source).removeTile(j)})))),this.actor.registerMessageHandler("GCEZ",((k,j)=>I._(this,void 0,void 0,(function*(){return this._getWorkerSource(k,j.type,j.source).getClusterExpansionZoom(j)})))),this.actor.registerMessageHandler("GCC",((k,j)=>I._(this,void 0,void 0,(function*(){return this._getWorkerSource(k,j.type,j.source).getClusterChildren(j)})))),this.actor.registerMessageHandler("GCL",((k,j)=>I._(this,void 0,void 0,(function*(){return this._getWorkerSource(k,j.type,j.source).getClusterLeaves(j)})))),this.actor.registerMessageHandler("LD",((k,j)=>this._getWorkerSource(k,j.type,j.source).loadData(j))),this.actor.registerMessageHandler("GD",((k,j)=>this._getWorkerSource(k,j.type,j.source).getData())),this.actor.registerMessageHandler("LT",((k,j)=>this._getWorkerSource(k,j.type,j.source).loadTile(j))),this.actor.registerMessageHandler("RT",((k,j)=>this._getWorkerSource(k,j.type,j.source).reloadTile(j))),this.actor.registerMessageHandler("AT",((k,j)=>this._getWorkerSource(k,j.type,j.source).abortTile(j))),this.actor.registerMessageHandler("RMT",((k,j)=>this._getWorkerSource(k,j.type,j.source).removeTile(j))),this.actor.registerMessageHandler("RS",((k,j)=>I._(this,void 0,void 0,(function*(){if(!this.workerSources[k]||!this.workerSources[k][j.type]||!this.workerSources[k][j.type][j.source])return;let P=this.workerSources[k][j.type][j.source];delete this.workerSources[k][j.type][j.source],P.removeSource!==void 0&&P.removeSource(j)})))),this.actor.registerMessageHandler("RM",(k=>I._(this,void 0,void 0,(function*(){delete this.layerIndexes[k],delete this.availableImages[k],delete this.workerSources[k],delete this.demWorkerSources[k],this.globalStates.delete(k)})))),this.actor.registerMessageHandler("SR",((k,j)=>I._(this,void 0,void 0,(function*(){this.referrer=j})))),this.actor.registerMessageHandler("SRPS",((k,j)=>this._syncRTLPluginState(k,j))),this.actor.registerMessageHandler("IS",((k,j)=>I._(this,void 0,void 0,(function*(){this.self.importScripts(j)})))),this.actor.registerMessageHandler("SI",((k,j)=>this._setImages(k,j))),this.actor.registerMessageHandler("UL",((k,j)=>I._(this,void 0,void 0,(function*(){this._getLayerIndex(k).update(j.layers,j.removedIds,this._getGlobalState(k))})))),this.actor.registerMessageHandler("UGS",((k,j)=>I._(this,void 0,void 0,(function*(){let P=this._getGlobalState(k);for(let $ in j)P[$]=j[$]})))),this.actor.registerMessageHandler("SL",((k,j)=>I._(this,void 0,void 0,(function*(){this._getLayerIndex(k).replace(j,this._getGlobalState(k))}))))}_getGlobalState(Q){let k=this.globalStates.get(Q);return k||(k={},this.globalStates.set(Q,k)),k}_setImages(Q,k){return I._(this,void 0,void 0,(function*(){this.availableImages[Q]=k;for(let j in this.workerSources[Q]){let P=this.workerSources[Q][j];for(let $ in P)P[$].availableImages=k}}))}_syncRTLPluginState(Q,k){return I._(this,void 0,void 0,(function*(){return yield I.d4.syncState(k,this.self.importScripts)}))}_getAvailableImages(Q){let k=this.availableImages[Q];return k||(k=[]),k}_getLayerIndex(Q){let k=this.layerIndexes[Q];return k||(k=this.layerIndexes[Q]=new o),k}_getWorkerSource(Q,k,j){if(this.workerSources[Q]||(this.workerSources[Q]={}),this.workerSources[Q][k]||(this.workerSources[Q][k]={}),!this.workerSources[Q][k][j]){let P={sendAsync:($,st)=>($.targetMapId=Q,this.actor.sendAsync($,st))};switch(k){case"vector":this.workerSources[Q][k][j]=new ue(P,this._getLayerIndex(Q),this._getAvailableImages(Q));break;case"geojson":this.workerSources[Q][k][j]=new an(P,this._getLayerIndex(Q),this._getAvailableImages(Q));break;default:this.workerSources[Q][k][j]=new this.externalWorkerSourceTypes[k](P,this._getLayerIndex(Q),this._getAvailableImages(Q))}}return this.workerSources[Q][k][j]}_getDEMWorkerSource(Q,k){return this.demWorkerSources[Q]||(this.demWorkerSources[Q]={}),this.demWorkerSources[Q][k]||(this.demWorkerSources[Q][k]=new Qe),this.demWorkerSources[Q][k]}}return I.i(self)&&(self.worker=new Gi(self)),Gi})),U("index",["exports","./shared"],(function(I,o){"use strict";var lt="5.13.0";function Ft(){var m=new o.A(4);return o.A!=Float32Array&&(m[1]=0,m[2]=0),m[0]=1,m[3]=1,m}let Ut,Et,Bt,ft={frame(m,e,a){let c=requestAnimationFrame((W=>{r(),e(W)})),{unsubscribe:r}=o.s(m.signal,"abort",(()=>{r(),cancelAnimationFrame(c),a(o.c())}),!1)},frameAsync(m){return new Promise(((e,a)=>{this.frame(m,e,a)}))},getImageData(m,e=0){return this.getImageCanvasContext(m).getImageData(-e,-e,m.width+2*e,m.height+2*e)},getImageCanvasContext(m){let e=window.document.createElement("canvas"),a=e.getContext("2d",{willReadFrequently:!0});if(!a)throw new Error("failed to create canvas 2d context");return e.width=m.width,e.height=m.height,a.drawImage(m,0,0,m.width,m.height),a},resolveURL:m=>(Ut||(Ut=document.createElement("a")),Ut.href=m,Ut.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return Bt!==void 0?Bt:!!matchMedia&&(Et==null&&(Et=matchMedia("(prefers-reduced-motion: reduce)")),Et.matches)},set prefersReducedMotion(m){Bt=m}},le=new class{constructor(){this._realTime=typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),this._frozenAt=null}getCurrentTime(){return this._frozenAt!==null?this._frozenAt:this._realTime()}setNow(m){this._frozenAt=m}restoreNow(){this._frozenAt=null}isFrozen(){return this._frozenAt!==null}};function Ct(){return le.getCurrentTime()}class rt{static testProp(e){if(!rt.docStyle)return e[0];for(let a=0;a<e.length;a++)if(e[a]in rt.docStyle)return e[a];return e[0]}static create(e,a,c){let r=window.document.createElement(e);return a!==void 0&&(r.className=a),c&&c.appendChild(r),r}static createNS(e,a){return window.document.createElementNS(e,a)}static disableDrag(){rt.docStyle&&rt.selectProp&&(rt.userSelect=rt.docStyle[rt.selectProp],rt.docStyle[rt.selectProp]="none")}static enableDrag(){rt.docStyle&&rt.selectProp&&(rt.docStyle[rt.selectProp]=rt.userSelect)}static setTransform(e,a){e.style[rt.transformProp]=a}static addEventListener(e,a,c,r={}){e.addEventListener(a,c,"passive"in r?r:r.capture)}static removeEventListener(e,a,c,r={}){e.removeEventListener(a,c,"passive"in r?r:r.capture)}static suppressClickInternal(e){e.preventDefault(),e.stopPropagation(),window.removeEventListener("click",rt.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",rt.suppressClickInternal,!0),window.setTimeout((()=>{window.removeEventListener("click",rt.suppressClickInternal,!0)}),0)}static getScale(e){let a=e.getBoundingClientRect();return{x:a.width/e.offsetWidth||1,y:a.height/e.offsetHeight||1,boundingClientRect:a}}static getPoint(e,a,c){let r=a.boundingClientRect;return new o.P((c.clientX-r.left)/a.x-e.clientLeft,(c.clientY-r.top)/a.y-e.clientTop)}static mousePos(e,a){let c=rt.getScale(e);return rt.getPoint(e,c,a)}static touchPos(e,a){let c=[],r=rt.getScale(e);for(let W=0;W<a.length;W++)c.push(rt.getPoint(e,r,a[W]));return c}static mouseButton(e){return e.button}static remove(e){e.parentNode&&e.parentNode.removeChild(e)}static sanitize(e){let a=new DOMParser().parseFromString(e,"text/html").body||document.createElement("body"),c=a.querySelectorAll("script");for(let r of c)r.remove();return rt.clean(a),a.innerHTML}static isPossiblyDangerous(e,a){let c=a.replace(/\s+/g,"").toLowerCase();return!(!["src","href","xlink:href"].includes(e)||!c.includes("javascript:")&&!c.includes("data:"))||!!e.startsWith("on")||void 0}static clean(e){let a=e.children;for(let c of a)rt.removeAttributes(c),rt.clean(c)}static removeAttributes(e){for(let{name:a,value:c}of e.attributes)rt.isPossiblyDangerous(a,c)&&e.removeAttribute(a)}}rt.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,rt.selectProp=rt.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),rt.transformProp=rt.testProp(["transform","WebkitTransform"]);let ne={supported:!1,testSupport:function(m){!Ie&&$t&&(Ue?oe(m):Kt=m)}},Kt,$t,Ie=!1,Ue=!1;function oe(m){let e=m.createTexture();m.bindTexture(m.TEXTURE_2D,e);try{if(m.texImage2D(m.TEXTURE_2D,0,m.RGBA,m.RGBA,m.UNSIGNED_BYTE,$t),m.isContextLost())return;ne.supported=!0}catch{}m.deleteTexture(e),Ie=!0}var ce;typeof document<"u"&&($t=document.createElement("img"),$t.onload=()=>{Kt&&oe(Kt),Kt=null,Ue=!0},$t.onerror=()=>{Ie=!0,Kt=null},$t.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),(function(m){let e,a,c,r;m.resetRequestQueue=()=>{e=[],a=0,c=0,r={}},m.addThrottleControl=u=>{let G=c++;return r[G]=u,G},m.removeThrottleControl=u=>{delete r[u],h()},m.getImage=(u,G,Y=!0)=>new Promise(((y,J)=>{ne.supported&&(u.headers||(u.headers={}),u.headers.accept="image/webp,*/*"),o.e(u,{type:"image"}),e.push({abortController:G,requestParameters:u,supportImageRefresh:Y,state:"queued",onError:S=>{J(S)},onSuccess:S=>{y(S)}}),h()}));let W=u=>o._(this,void 0,void 0,(function*(){u.state="running";let{requestParameters:G,supportImageRefresh:Y,onError:y,onSuccess:J,abortController:S}=u,L=Y===!1&&!o.i(self)&&!o.g(G.url)&&(!G.headers||Object.keys(G.headers).reduce(((O,K)=>O&&K==="accept"),!0));a++;let w=L?g(G,S):o.m(G,S);try{let O=yield w;delete u.abortController,u.state="completed",O.data instanceof HTMLImageElement||o.b(O.data)?J(O):O.data&&J({data:yield(v=O.data,typeof createImageBitmap=="function"?o.f(v):o.h(v)),cacheControl:O.cacheControl,expires:O.expires})}catch(O){delete u.abortController,y(O)}finally{a--,h()}var v})),h=()=>{let u=(()=>{for(let G of Object.keys(r))if(r[G]())return!0;return!1})()?o.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:o.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let G=a;G<u&&e.length>0;G++){let Y=e.shift();Y.abortController.signal.aborted?G--:W(Y)}},g=(u,G)=>new Promise(((Y,y)=>{let J=new Image,S=u.url,L=u.credentials;L&&L==="include"?J.crossOrigin="use-credentials":(L&&L==="same-origin"||!o.d(S))&&(J.crossOrigin="anonymous"),G.signal.addEventListener("abort",(()=>{J.src="",y(o.c())})),J.fetchPriority="high",J.onload=()=>{J.onerror=J.onload=null,Y({data:J})},J.onerror=()=>{J.onerror=J.onload=null,G.signal.aborted||y(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},J.src=S}))})(ce||(ce={})),ce.resetRequestQueue();class ge{constructor(e){this._transformRequestFn=e??null}transformRequest(e,a){return this._transformRequestFn&&this._transformRequestFn(e,a)||{url:e}}setTransformRequest(e){this._transformRequestFn=e}}function ue(m){let e=[];if(typeof m=="string")e.push({id:"default",url:m});else if(m&&m.length>0){let a=[];for(let{id:c,url:r}of m){let W=`${c}${r}`;a.indexOf(W)===-1&&(a.push(W),e.push({id:c,url:r}))}}return e}function Qe(m,e,a){try{let c=new URL(m);return c.pathname+=`${e}${a}`,c.toString()}catch{throw new Error(`Invalid sprite URL "${m}", must be absolute. Modify style specification directly or use TransformStyleFunction to correct the issue dynamically`)}}function ke(m){let{userImage:e}=m;return!!(e&&e.render&&e.render())&&(m.data.replace(new Uint8Array(e.data.buffer)),!0)}class Me extends o.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new o.R({width:1,height:1}),this.dirty=!0}destroy(){this.atlasTexture&&(this.atlasTexture.destroy(),this.atlasTexture=null);for(let e of Object.keys(this.images))this.removeImage(e);this.patterns={},this.atlasImage=new o.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(e){if(this.loaded!==e&&(this.loaded=e,e)){for(let{ids:a,promiseResolve:c}of this.requestors)c(this._getImagesForIds(a));this.requestors=[]}}getImage(e){let a=this.images[e];if(a&&!a.data&&a.spriteData){let c=a.spriteData;a.data=new o.R({width:c.width,height:c.height},c.context.getImageData(c.x,c.y,c.width,c.height).data),a.spriteData=null}return a}addImage(e,a){if(this.images[e])throw new Error(`Image id ${e} already exist, use updateImage instead`);this._validate(e,a)&&(this.images[e]=a)}_validate(e,a){let c=!0,r=a.data||a.spriteData;return this._validateStretch(a.stretchX,r&&r.width)||(this.fire(new o.k(new Error(`Image "${e}" has invalid "stretchX" value`))),c=!1),this._validateStretch(a.stretchY,r&&r.height)||(this.fire(new o.k(new Error(`Image "${e}" has invalid "stretchY" value`))),c=!1),this._validateContent(a.content,a)||(this.fire(new o.k(new Error(`Image "${e}" has invalid "content" value`))),c=!1),c}_validateStretch(e,a){if(!e)return!0;let c=0;for(let r of e){if(r[0]<c||r[1]<r[0]||a<r[1])return!1;c=r[1]}return!0}_validateContent(e,a){if(!e)return!0;if(e.length!==4)return!1;let c=a.spriteData,r=c&&c.width||a.data.width,W=c&&c.height||a.data.height;return!(e[0]<0||r<e[0]||e[1]<0||W<e[1]||e[2]<0||r<e[2]||e[3]<0||W<e[3]||e[2]<e[0]||e[3]<e[1])}updateImage(e,a,c=!0){let r=this.getImage(e);if(c&&(r.data.width!==a.data.width||r.data.height!==a.data.height))throw new Error(`size mismatch between old image (${r.data.width}x${r.data.height}) and new image (${a.data.width}x${a.data.height}).`);a.version=r.version+1,this.images[e]=a,this.updatedImages[e]=!0}removeImage(e){let a=this.images[e];delete this.images[e],delete this.patterns[e],a.userImage&&a.userImage.onRemove&&a.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(e){return new Promise(((a,c)=>{let r=!0;if(!this.isLoaded())for(let W of e)this.images[W]||(r=!1);this.isLoaded()||r?a(this._getImagesForIds(e)):this.requestors.push({ids:e,promiseResolve:a})}))}_getImagesForIds(e){let a={};for(let c of e){let r=this.getImage(c);r||(this.fire(new o.l("styleimagemissing",{id:c})),r=this.getImage(c)),r?a[c]={data:r.data.clone(),pixelRatio:r.pixelRatio,sdf:r.sdf,version:r.version,stretchX:r.stretchX,stretchY:r.stretchY,content:r.content,textFitWidth:r.textFitWidth,textFitHeight:r.textFitHeight,hasRenderCallback:!!(r.userImage&&r.userImage.render)}:o.w(`Image "${c}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return a}getPixelSize(){let{width:e,height:a}=this.atlasImage;return{width:e,height:a}}getPattern(e){let a=this.patterns[e],c=this.getImage(e);if(!c)return null;if(a&&a.position.version===c.version)return a.position;if(a)a.position.version=c.version;else{let r={w:c.data.width+2,h:c.data.height+2,x:0,y:0},W=new o.I(r,c);this.patterns[e]={bin:r,position:W}}return this._updatePatternAtlas(),this.patterns[e].position}bind(e){let a=e.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new o.T(e,this.atlasImage,a.RGBA),this.atlasTexture.bind(a.LINEAR,a.CLAMP_TO_EDGE)}_updatePatternAtlas(){let e=[];for(let W in this.patterns)e.push(this.patterns[W].bin);let{w:a,h:c}=o.p(e),r=this.atlasImage;r.resize({width:a||1,height:c||1});for(let W in this.patterns){let{bin:h}=this.patterns[W],g=h.x+1,u=h.y+1,G=this.getImage(W).data,Y=G.width,y=G.height;o.R.copy(G,r,{x:0,y:0},{x:g,y:u},{width:Y,height:y}),o.R.copy(G,r,{x:0,y:y-1},{x:g,y:u-1},{width:Y,height:1}),o.R.copy(G,r,{x:0,y:0},{x:g,y:u+y},{width:Y,height:1}),o.R.copy(G,r,{x:Y-1,y:0},{x:g-1,y:u},{width:1,height:y}),o.R.copy(G,r,{x:0,y:0},{x:g+Y,y:u},{width:1,height:y})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(e){for(let a of e){if(this.callbackDispatchedThisFrame[a])continue;this.callbackDispatchedThisFrame[a]=!0;let c=this.getImage(a);c||o.w(`Image with ID: "${a}" was not found`),ke(c)&&this.updateImage(a,c)}}cloneImages(){let e={};for(let a in this.images){let c=this.images[a];e[a]=Object.assign(Object.assign({},c),{data:c.data?c.data.clone():null})}return e}}let He=1e20;function Cl(m,e,a,c,r,W,h,g,u){for(let G=e;G<e+c;G++)cl(m,a*W+G,W,r,h,g,u);for(let G=a;G<a+r;G++)cl(m,G*W+e,1,c,h,g,u)}function cl(m,e,a,c,r,W,h){W[0]=0,h[0]=-He,h[1]=He,r[0]=m[e];for(let g=1,u=0,G=0;g<c;g++){r[g]=m[e+g*a];let Y=g*g;do{let y=W[u];G=(r[g]-r[y]+Y-y*y)/(g-y)/2}while(G<=h[u]&&--u>-1);u++,W[u]=g,h[u]=G,h[u+1]=He}for(let g=0,u=0;g<c;g++){for(;h[u+1]<g;)u++;let G=W[u],Y=g-G;m[e+g*a]=r[G]+Y*Y}}let pi=o.v.layout_symbol["text-font"].default.join(",");class Fl{constructor(e,a,c){this.requestManager=e,this.localIdeographFontFamily=a,this.entries={},this.lang=c}setURL(e){this.url=e}getGlyphs(e){return o._(this,void 0,void 0,(function*(){let a=[];for(let W in e)for(let h of e[W])a.push(this._getAndCacheGlyphsPromise(W,h));let c=yield Promise.all(a),r={};for(let{stack:W,id:h,glyph:g}of c)r[W]||(r[W]={}),r[W][h]=g&&{id:g.id,bitmap:g.bitmap.clone(),metrics:g.metrics};return r}))}_getAndCacheGlyphsPromise(e,a){return o._(this,void 0,void 0,(function*(){let c=this.entries[e];c||(c=this.entries[e]={glyphs:{},requests:{},ranges:{}});let r=c.glyphs[a];return r!==void 0?{stack:e,id:a,glyph:r}:!this.url||this._charUsesLocalIdeographFontFamily(a)?(r=c.glyphs[a]=this._drawGlyph(c,e,a),{stack:e,id:a,glyph:r}):yield this._downloadAndCacheRangePromise(e,a)}))}_downloadAndCacheRangePromise(e,a){return o._(this,void 0,void 0,(function*(){let c=this.entries[e],r=Math.floor(a/256);if(c.ranges[r])return{stack:e,id:a,glyph:null};if(!c.requests[r]){let W=Fl.loadGlyphRange(e,r,this.url,this.requestManager);c.requests[r]=W}try{let W=yield c.requests[r];for(let h in W)c.glyphs[+h]=W[+h];return c.ranges[r]=!0,{stack:e,id:a,glyph:W[a]||null}}catch(W){let h=c.glyphs[a]=this._drawGlyph(c,e,a);return this._warnOnMissingGlyphRange(h,r,a,W),{stack:e,id:a,glyph:h}}}))}_warnOnMissingGlyphRange(e,a,c,r){let W=256*a,h=W+255,g=c.toString(16).padStart(4,"0").toUpperCase();o.w(`Unable to load glyph range ${a}, ${W}-${h}. Rendering codepoint U+${g} locally instead. ${r}`)}_charUsesLocalIdeographFontFamily(e){return!!this.localIdeographFontFamily&&o.q(e)}_drawGlyph(e,a,c){let r=a===pi&&this.localIdeographFontFamily!==""&&this._charUsesLocalIdeographFontFamily(c),W=r?"ideographTinySDF":"tinySDF";e[W]||(e[W]=this._createTinySDF(r?this.localIdeographFontFamily:a));let h=e[W].draw(String.fromCodePoint(c));return{id:c,bitmap:new o.r({width:h.width||60,height:h.height||60},h.data),metrics:{width:h.glyphWidth/2||24,height:h.glyphHeight/2||24,left:h.glyphLeft/2+.5||0,top:h.glyphTop/2-27.5||-8,advance:h.glyphAdvance/2||24,isDoubleResolution:!0}}}_createTinySDF(e){let a=e?e.split(","):[];a.push("sans-serif");let c=a.map((r=>/[-\w]+/.test(r)?r:`'${CSS.escape(r)}'`)).join(",");return new Fl.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:c,fontWeight:this._fontWeight(a[0]),fontStyle:this._fontStyle(a[0]),lang:this.lang})}_fontStyle(e){return/italic/i.test(e)?"italic":/oblique/i.test(e)?"oblique":"normal"}_fontWeight(e){let a={thin:100,hairline:100,"extra light":200,"ultra light":200,light:300,normal:400,regular:400,medium:500,semibold:600,demibold:600,bold:700,"extra bold":800,"ultra bold":800,black:900,heavy:900,"extra black":950,"ultra black":950},c;for(let[r,W]of Object.entries(a))new RegExp(`\\b${r}\\b`,"i").test(e)&&(c=`${W}`);return c}destroy(){for(let e in this.entries){let a=this.entries[e];a.tinySDF&&(a.tinySDF=null),a.ideographTinySDF&&(a.ideographTinySDF=null),a.glyphs={},a.requests={},a.ranges={}}this.entries={}}}Fl.loadGlyphRange=function(m,e,a,c){return o._(this,void 0,void 0,(function*(){let r=256*e,W=r+255,h=c.transformRequest(a.replace("{fontstack}",m).replace("{range}",`${r}-${W}`),"Glyphs"),g=yield o.n(h,new AbortController);if(!g||!g.data)throw new Error(`Could not load glyph range. range: ${e}, ${r}-${W}`);let u={};for(let G of o.o(g.data))u[G.id]=G;return u}))},Fl.TinySDF=class{constructor({fontSize:m=24,buffer:e=3,radius:a=8,cutoff:c=.25,fontFamily:r="sans-serif",fontWeight:W="normal",fontStyle:h="normal",lang:g=null}={}){this.buffer=e,this.cutoff=c,this.radius=a,this.lang=g;let u=this.size=m+4*e,G=this._createCanvas(u),Y=this.ctx=G.getContext("2d",{willReadFrequently:!0});Y.font=`${h} ${W} ${m}px ${r}`,Y.textBaseline="alphabetic",Y.textAlign="left",Y.fillStyle="black",this.gridOuter=new Float64Array(u*u),this.gridInner=new Float64Array(u*u),this.f=new Float64Array(u),this.z=new Float64Array(u+1),this.v=new Uint16Array(u)}_createCanvas(m){let e=document.createElement("canvas");return e.width=e.height=m,e}draw(m){let{width:e,actualBoundingBoxAscent:a,actualBoundingBoxDescent:c,actualBoundingBoxLeft:r,actualBoundingBoxRight:W}=this.ctx.measureText(m),h=Math.ceil(a),g=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(W-r))),u=Math.min(this.size-this.buffer,h+Math.ceil(c)),G=g+2*this.buffer,Y=u+2*this.buffer,y=Math.max(G*Y,0),J=new Uint8ClampedArray(y),S={data:J,width:G,height:Y,glyphWidth:g,glyphHeight:u,glyphTop:h,glyphLeft:0,glyphAdvance:e};if(g===0||u===0)return S;let{ctx:L,buffer:w,gridInner:v,gridOuter:O}=this;this.lang&&(L.lang=this.lang),L.clearRect(w,w,g,u),L.fillText(m,w,w+h);let K=L.getImageData(w,w,g,u);O.fill(He,0,y),v.fill(0,0,y);for(let tt=0;tt<u;tt++)for(let _=0;_<g;_++){let et=K.data[4*(tt*g+_)+3]/255;if(et===0)continue;let it=(tt+w)*G+_+w;if(et===1)O[it]=0,v[it]=He;else{let q=.5-et;O[it]=q>0?q*q:0,v[it]=q<0?q*q:0}}Cl(O,0,0,G,Y,G,this.f,this.v,this.z),Cl(v,w,w,g,u,G,this.f,this.v,this.z);for(let tt=0;tt<y;tt++){let _=Math.sqrt(O[tt])-Math.sqrt(v[tt]);J[tt]=Math.round(255-255*(_/this.radius+this.cutoff))}return S}};class Ul{constructor(){this.specification=o.u.light.position}possiblyEvaluate(e,a){return o.F(e.expression.evaluate(a))}interpolate(e,a,c){return{x:o.G.number(e.x,a.x,c),y:o.G.number(e.y,a.y,c),z:o.G.number(e.z,a.z,c)}}}let se;class Ei extends o.E{constructor(e){super(),se=se||new o.t({anchor:new o.D(o.u.light.anchor),position:new Ul,color:new o.D(o.u.light.color),intensity:new o.D(o.u.light.intensity)}),this._transitionable=new o.x(se,void 0),this.setLight(e),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(e,a={}){if(!this._validate(o.y,e,a))for(let c in e){let r=e[c];c.endsWith(o.z)?this._transitionable.setTransition(c.slice(0,-o.z.length),r):this._transitionable.setValue(c,r)}}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,a,c){return(!c||c.validate!==!1)&&o.B(this,e.call(o.C,{value:a,style:{glyphs:!0,sprite:!0},styleSpec:o.u}))}}let Ml=new o.t({"sky-color":new o.D(o.u.sky["sky-color"]),"horizon-color":new o.D(o.u.sky["horizon-color"]),"fog-color":new o.D(o.u.sky["fog-color"]),"fog-ground-blend":new o.D(o.u.sky["fog-ground-blend"]),"horizon-fog-blend":new o.D(o.u.sky["horizon-fog-blend"]),"sky-horizon-blend":new o.D(o.u.sky["sky-horizon-blend"]),"atmosphere-blend":new o.D(o.u.sky["atmosphere-blend"])});class Xi extends o.E{constructor(e){super(),this._transitionable=new o.x(Ml,void 0),this.setSky(e),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new o.H(0))}setSky(e,a={}){if(!this._validate(o.J,e,a)){e||(e={"sky-color":"transparent","horizon-color":"transparent","fog-color":"transparent","fog-ground-blend":1,"atmosphere-blend":0});for(let c in e){let r=e[c];c.endsWith(o.z)?this._transitionable.setTransition(c.slice(0,-o.z.length),r):this._transitionable.setValue(c,r)}}}getSky(){return this._transitionable.serialize()}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,a,c={}){return c?.validate!==!1&&o.B(this,e.call(o.C,o.e({value:a,style:{glyphs:!0,sprite:!0},styleSpec:o.u})))}calculateFogBlendOpacity(e){return e<60?0:e<70?(e-60)/10:1}}class Ea{constructor(e,a){this.width=e,this.height=a,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(e,a){let c=e.join(",")+String(a);return this.dashEntry[c]||(this.dashEntry[c]=this.addDash(e,a)),this.dashEntry[c]}getDashRanges(e,a,c){let r=[],W=e.length%2==1?-e[e.length-1]*c:0,h=e[0]*c,g=!0;r.push({left:W,right:h,isDash:g,zeroLength:e[0]===0});let u=e[0];for(let G=1;G<e.length;G++){g=!g;let Y=e[G];W=u*c,u+=Y,h=u*c,r.push({left:W,right:h,isDash:g,zeroLength:Y===0})}return r}addRoundDash(e,a,c){let r=a/2;for(let W=-c;W<=c;W++){let h=this.width*(this.nextRow+c+W),g=0,u=e[g];for(let G=0;G<this.width;G++){G/u.right>1&&(u=e[++g]);let Y=Math.abs(G-u.left),y=Math.abs(G-u.right),J=Math.min(Y,y),S,L=W/c*(r+1);if(u.isDash){let w=r-Math.abs(L);S=Math.sqrt(J*J+w*w)}else S=r-Math.sqrt(J*J+L*L);this.data[h+G]=Math.max(0,Math.min(255,S+128))}}}addRegularDash(e){for(let g=e.length-1;g>=0;--g){let u=e[g],G=e[g+1];u.zeroLength?e.splice(g,1):G&&G.isDash===u.isDash&&(G.left=u.left,e.splice(g,1))}let a=e[0],c=e[e.length-1];a.isDash===c.isDash&&(a.left=c.left-this.width,c.right=a.right+this.width);let r=this.width*this.nextRow,W=0,h=e[W];for(let g=0;g<this.width;g++){g/h.right>1&&(h=e[++W]);let u=Math.abs(g-h.left),G=Math.abs(g-h.right),Y=Math.min(u,G);this.data[r+g]=Math.max(0,Math.min(255,(h.isDash?Y:-Y)+128))}}addDash(e,a){let c=a?7:0,r=2*c+1;if(this.nextRow+r>this.height)return o.w("LineAtlas out of space"),null;let W=0;for(let g=0;g<e.length;g++)W+=e[g];if(W!==0){let g=this.width/W,u=this.getDashRanges(e,this.width,g);a?this.addRoundDash(u,g,c):this.addRegularDash(u)}let h={y:this.nextRow+c,height:2*c,width:W};return this.nextRow+=r,this.dirty=!0,h}bind(e){let a=e.gl;this.texture?(a.bindTexture(a.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,a.texSubImage2D(a.TEXTURE_2D,0,0,0,this.width,this.height,a.ALPHA,a.UNSIGNED_BYTE,this.data))):(this.texture=a.createTexture(),a.bindTexture(a.TEXTURE_2D,this.texture),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.REPEAT),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.REPEAT),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.LINEAR),a.texImage2D(a.TEXTURE_2D,0,a.ALPHA,this.width,this.height,0,a.ALPHA,a.UNSIGNED_BYTE,this.data))}}let ci="maplibre_preloaded_worker_pool";class gi{constructor(){this.active={}}acquire(e){if(!this.workers)for(this.workers=[];this.workers.length<gi.workerCount;)this.workers.push(new Worker(o.a.WORKER_URL));return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.numActive()===0&&(this.workers.forEach((a=>{a.terminate()})),this.workers=null)}isPreloaded(){return!!this.active[ci]}numActive(){return Object.keys(this.active).length}}let el=Math.floor(ft.hardwareConcurrency/2),ml,ll;function zi(){return ml||(ml=new gi),ml}gi.workerCount=o.K(globalThis)?Math.max(Math.min(el,3),1):1;class Al{constructor(e,a){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=a;let c=this.workerPool.acquire(a);for(let r=0;r<c.length;r++){let W=new o.L(c[r],a);W.name=`Worker ${r}`,this.actors.push(W)}if(!this.actors.length)throw new Error("No actors found")}broadcast(e,a){let c=[];for(let r of this.actors)c.push(r.sendAsync({type:e,data:a}));return Promise.all(c)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(e=!0){this.actors.forEach((a=>{a.remove()})),this.actors=[],e&&this.workerPool.release(this.id)}registerMessageHandler(e,a){for(let c of this.actors)c.registerMessageHandler(e,a)}unregisterMessageHandler(e){for(let a of this.actors)a.unregisterMessageHandler(e)}}function ji(){return ll||(ll=new Al(zi(),o.M),ll.registerMessageHandler("GR",((m,e,a)=>o.m(e,a)))),ll}function oi(m,e){let a=o.N();return o.O(a,a,[1,1,0]),o.Q(a,a,[.5*m.width,.5*m.height,1]),m.calculatePosMatrix?o.S(a,a,m.calculatePosMatrix(e.toUnwrapped())):a}function Ra(m,e,a,c,r,W,h){var g;let u=(function(J,S,L){if(J)for(let w of J){let v=S[w];if(v&&v.source===L&&v.type==="fill-extrusion")return!0}else for(let w in S){let v=S[w];if(v.source===L&&v.type==="fill-extrusion")return!0}return!1})((g=r?.layers)!==null&&g!==void 0?g:null,e,m.id),G=W.maxPitchScaleFactor(),Y=m.tilesIn(c,G,u);Y.sort(Le);let y=[];for(let J of Y)y.push({wrappedTileID:J.tileID.wrapped().key,queryResults:J.tile.queryRenderedFeatures(e,a,m.getState(),J.queryGeometry,J.cameraQueryGeometry,J.scale,r,W,G,oi(W,J.tileID),h?(S,L)=>h(J.tileID,S,L):void 0)});return(function(J,S){for(let L in J)for(let w of J[L])si(w,S);return J})((function(J){let S={},L={};for(let w of J){let v=w.queryResults,O=w.wrappedTileID,K=L[O]=L[O]||{};for(let tt in v){let _=v[tt],et=K[tt]=K[tt]||{},it=S[tt]=S[tt]||[];for(let q of _)et[q.featureIndex]||(et[q.featureIndex]=!0,it.push(q))}}return S})(y),m)}function Le(m,e){let a=m.tileID,c=e.tileID;return a.overscaledZ-c.overscaledZ||a.canonical.y-c.canonical.y||a.wrap-c.wrap||a.canonical.x-c.canonical.x}function si(m,e){let a=m.feature,c=e.getFeatureState(a.layer["source-layer"],a.id);a.source=a.layer.source,a.layer["source-layer"]&&(a.sourceLayer=a.layer["source-layer"]),a.state=c}function Ji(m,e,a){return o._(this,void 0,void 0,(function*(){let c=m;if(m.url?c=(yield o.j(e.transformRequest(m.url,"Source"),a)).data:yield ft.frameAsync(a),!c)return null;let r=o.U(o.e(c,m),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in c&&c.vector_layers&&(r.vectorLayerIds=c.vector_layers.map((W=>W.id))),r}))}class Ee{constructor(e,a){e&&(a?this.setSouthWest(e).setNorthEast(a):Array.isArray(e)&&(e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1])))}setNorthEast(e){return this._ne=e instanceof o.V?new o.V(e.lng,e.lat):o.V.convert(e),this}setSouthWest(e){return this._sw=e instanceof o.V?new o.V(e.lng,e.lat):o.V.convert(e),this}extend(e){let a=this._sw,c=this._ne,r,W;if(e instanceof o.V)r=e,W=e;else{if(!(e instanceof Ee))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(Ee.convert(e)):this.extend(o.V.convert(e)):e&&("lng"in e||"lon"in e)&&"lat"in e?this.extend(o.V.convert(e)):this;if(r=e._sw,W=e._ne,!r||!W)return this}return a||c?(a.lng=Math.min(r.lng,a.lng),a.lat=Math.min(r.lat,a.lat),c.lng=Math.max(W.lng,c.lng),c.lat=Math.max(W.lat,c.lat)):(this._sw=new o.V(r.lng,r.lat),this._ne=new o.V(W.lng,W.lat)),this}getCenter(){return new o.V((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new o.V(this.getWest(),this.getNorth())}getSouthEast(){return new o.V(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){let{lng:a,lat:c}=o.V.convert(e),r=this._sw.lng<=a&&a<=this._ne.lng;return this._sw.lng>this._ne.lng&&(r=this._sw.lng>=a&&a>=this._ne.lng),this._sw.lat<=c&&c<=this._ne.lat&&r}intersects(e){if((e=Ee.convert(e)).getNorth()<this.getSouth()||e.getSouth()>this.getNorth())return!1;let a=o.W(this.getWest(),-180,180),c=o.W(this.getEast(),-180,180),r=o.W(e.getWest(),-180,180),W=o.W(e.getEast(),-180,180),h=a>c,g=r>W;return!(!h||!g)||(h?W>=a||r<=c:g?c>=r||a<=W:!(r>c||W<a))}static convert(e){return e instanceof Ee?e:e&&new Ee(e)}static fromLngLat(e,a=0){let c=360*a/40075017,r=c/Math.cos(Math.PI/180*e.lat);return new Ee(new o.V(e.lng-r,e.lat-c),new o.V(e.lng+r,e.lat+c))}adjustAntiMeridian(){let e=new o.V(this._sw.lng,this._sw.lat),a=new o.V(this._ne.lng,this._ne.lat);return new Ee(e,e.lng>a.lng?new o.V(a.lng+360,a.lat):a)}}class Ri{constructor(e,a,c){this.bounds=Ee.convert(this.validateBounds(e)),this.minzoom=a||0,this.maxzoom=c||24}validateBounds(e){return Array.isArray(e)&&e.length===4?[Math.max(-180,e[0]),Math.max(-90,e[1]),Math.min(180,e[2]),Math.min(90,e[3])]:[-180,-90,180,90]}contains(e){let a=Math.pow(2,e.z),c=Math.floor(o.Y(this.bounds.getWest())*a),r=Math.floor(o.X(this.bounds.getNorth())*a),W=Math.ceil(o.Y(this.bounds.getEast())*a),h=Math.ceil(o.X(this.bounds.getSouth())*a);return e.x>=c&&e.x<W&&e.y>=r&&e.y<h}}class ui extends o.E{constructor(e,a,c,r){if(super(),this.id=e,this.dispatcher=c,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,o.e(this,o.U(a,["url","scheme","tileSize","promoteId","encoding"])),this._options=o.e({type:"vector"},a),this._collectResourceTiming=a.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(r)}load(){return o._(this,void 0,void 0,(function*(){this._loaded=!1,this.fire(new o.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{let e=yield Ji(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.tileManagers[this.id].clearTiles(),e&&(o.e(this,e),e.bounds&&(this.tileBounds=new Ri(e.bounds,this.minzoom,this.maxzoom)),this.fire(new o.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.l("data",{dataType:"source",sourceDataType:"content"})))}catch(e){this._tileJSONRequest=null,this._loaded=!0,this.fire(new o.k(e))}}))}loaded(){return this._loaded}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}onAdd(e){this.map=e,this.load()}setSourceProperty(e){this._tileJSONRequest&&this._tileJSONRequest.abort(),e(),this.load()}setTiles(e){return this.setSourceProperty((()=>{this._options.tiles=e})),this}setUrl(e){return this.setSourceProperty((()=>{this.url=e,this._options.url=e})),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return o.e({},this._options)}loadTile(e){return o._(this,void 0,void 0,(function*(){let a=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),c={request:this.map._requestManager.transformRequest(a,"Tile"),uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,tileSize:this.tileSize*e.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity,encoding:this.encoding,overzoomParameters:this._getOverzoomParameters(e)};c.request.collectResourceTiming=this._collectResourceTiming;let r="RT";if(e.actor&&e.state!=="expired"){if(e.state==="loading")return new Promise(((W,h)=>{e.reloadPromise={resolve:W,reject:h}}))}else e.actor=this.dispatcher.getActor(),r="LT";e.abortController=new AbortController;try{let W=yield e.actor.sendAsync({type:r,data:c},e.abortController);if(delete e.abortController,e.aborted)return;this._afterTileLoadWorkerResponse(e,W)}catch(W){if(delete e.abortController,e.aborted)return;if(W&&W.status!==404)throw W;this._afterTileLoadWorkerResponse(e,null)}}))}_getOverzoomParameters(e){if(e.tileID.canonical.z<=this.maxzoom||this.map._zoomLevelsToOverscale===void 0)return;let a=e.tileID.scaledTo(this.maxzoom).canonical,c=a.url(this.tiles,this.map.getPixelRatio(),this.scheme);return{maxZoomTileID:a,overzoomRequest:this.map._requestManager.transformRequest(c,"Tile")}}_afterTileLoadWorkerResponse(e,a){if(a&&a.resourceTiming&&(e.resourceTiming=a.resourceTiming),a&&this.map._refreshExpiredTiles&&e.setExpiryData(a),e.loadVectorData(a,this.map.painter),e.reloadPromise){let c=e.reloadPromise;e.reloadPromise=null,this.loadTile(e).then(c.resolve).catch(c.reject)}}abortTile(e){return o._(this,void 0,void 0,(function*(){e.abortController&&(e.abortController.abort(),delete e.abortController),e.actor&&(yield e.actor.sendAsync({type:"AT",data:{uid:e.uid,type:this.type,source:this.id}}))}))}unloadTile(e){return o._(this,void 0,void 0,(function*(){e.unloadVectorData(),e.actor&&(yield e.actor.sendAsync({type:"RMT",data:{uid:e.uid,type:this.type,source:this.id}}))}))}hasTransition(){return!1}}class za extends o.E{constructor(e,a,c,r){super(),this.id=e,this.dispatcher=c,this.setEventedParent(r),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=o.e({type:"raster"},a),o.e(this,o.U(a,["url","scheme","tileSize"]))}load(){return o._(this,arguments,void 0,(function*(e=!1){this._loaded=!1,this.fire(new o.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{let a=yield Ji(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,a&&(o.e(this,a),a.bounds&&(this.tileBounds=new Ri(a.bounds,this.minzoom,this.maxzoom)),this.fire(new o.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.l("data",{dataType:"source",sourceDataType:"content",sourceDataChanged:e})))}catch(a){this._tileJSONRequest=null,this._loaded=!0,this.fire(new o.k(a))}}))}loaded(){return this._loaded}onAdd(e){this.map=e,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(e){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),e(),this.load(!0)}setTiles(e){return this.setSourceProperty((()=>{this._options.tiles=e})),this}setUrl(e){return this.setSourceProperty((()=>{this.url=e,this._options.url=e})),this}serialize(){return o.e({},this._options)}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}loadTile(e){return o._(this,void 0,void 0,(function*(){let a=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);e.abortController=new AbortController;try{let c=yield ce.getImage(this.map._requestManager.transformRequest(a,"Tile"),e.abortController,this.map._refreshExpiredTiles);if(delete e.abortController,e.aborted)return void(e.state="unloaded");if(c&&c.data){this.map._refreshExpiredTiles&&(c.cacheControl||c.expires)&&e.setExpiryData({cacheControl:c.cacheControl,expires:c.expires});let r=this.map.painter.context,W=r.gl,h=c.data;e.texture=this.map.painter.getTileTexture(h.width),e.texture?e.texture.update(h,{useMipmap:!0}):(e.texture=new o.T(r,h,W.RGBA,{useMipmap:!0}),e.texture.bind(W.LINEAR,W.CLAMP_TO_EDGE,W.LINEAR_MIPMAP_NEAREST)),e.state="loaded"}}catch(c){if(delete e.abortController,e.aborted)e.state="unloaded";else if(c)throw e.state="errored",c}}))}abortTile(e){return o._(this,void 0,void 0,(function*(){e.abortController&&(e.abortController.abort(),delete e.abortController)}))}unloadTile(e){return o._(this,void 0,void 0,(function*(){e.texture&&this.map.painter.saveTileTexture(e.texture)}))}hasTransition(){return!1}}class ea extends za{constructor(e,a,c,r){super(e,a,c,r),this.type="raster-dem",this.maxzoom=22,this._options=o.e({type:"raster-dem"},a),this.encoding=a.encoding||"mapbox",this.redFactor=a.redFactor,this.greenFactor=a.greenFactor,this.blueFactor=a.blueFactor,this.baseShift=a.baseShift}loadTile(e){return o._(this,void 0,void 0,(function*(){let a=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),c=this.map._requestManager.transformRequest(a,"Tile");e.neighboringTiles=this._getNeighboringTiles(e.tileID),e.abortController=new AbortController;try{let r=yield ce.getImage(c,e.abortController,this.map._refreshExpiredTiles);if(delete e.abortController,e.aborted)return void(e.state="unloaded");if(r&&r.data){let W=r.data;this.map._refreshExpiredTiles&&(r.cacheControl||r.expires)&&e.setExpiryData({cacheControl:r.cacheControl,expires:r.expires});let h=o.b(W)&&o.Z()?W:yield this.readImageNow(W),g={type:this.type,uid:e.uid,source:this.id,rawImageData:h,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!e.actor||e.state==="expired"){e.actor=this.dispatcher.getActor();let u=yield e.actor.sendAsync({type:"LDT",data:g});e.dem=u,e.needsHillshadePrepare=!0,e.needsTerrainPrepare=!0,e.state="loaded"}}}catch(r){if(delete e.abortController,e.aborted)e.state="unloaded";else if(r)throw e.state="errored",r}}))}readImageNow(e){return o._(this,void 0,void 0,(function*(){if(typeof VideoFrame<"u"&&o.$()){let a=e.width+2,c=e.height+2;try{return new o.R({width:a,height:c},yield o.a0(e,-1,-1,a,c))}catch{}}return ft.getImageData(e,1)}))}_getNeighboringTiles(e){let a=e.canonical,c=Math.pow(2,a.z),r=(a.x-1+c)%c,W=a.x===0?e.wrap-1:e.wrap,h=(a.x+1+c)%c,g=a.x+1===c?e.wrap+1:e.wrap,u={};return u[new o.a1(e.overscaledZ,W,a.z,r,a.y).key]={backfilled:!1},u[new o.a1(e.overscaledZ,g,a.z,h,a.y).key]={backfilled:!1},a.y>0&&(u[new o.a1(e.overscaledZ,W,a.z,r,a.y-1).key]={backfilled:!1},u[new o.a1(e.overscaledZ,e.wrap,a.z,a.x,a.y-1).key]={backfilled:!1},u[new o.a1(e.overscaledZ,g,a.z,h,a.y-1).key]={backfilled:!1}),a.y+1<c&&(u[new o.a1(e.overscaledZ,W,a.z,r,a.y+1).key]={backfilled:!1},u[new o.a1(e.overscaledZ,e.wrap,a.z,a.x,a.y+1).key]={backfilled:!1},u[new o.a1(e.overscaledZ,g,a.z,h,a.y+1).key]={backfilled:!1}),u}unloadTile(e){return o._(this,void 0,void 0,(function*(){e.demTexture&&this.map.painter.saveTileTexture(e.demTexture),e.fbo&&(e.fbo.destroy(),delete e.fbo),e.dem&&delete e.dem,delete e.neighboringTiles,e.state="unloaded",e.actor&&(yield e.actor.sendAsync({type:"RDT",data:{type:this.type,uid:e.uid,source:this.id}}))}))}}function Yl(m){return m.type==="GeometryCollection"?m.geometries.map((e=>e.coordinates)).flat(1/0):m.coordinates.flat(1/0)}function Fi(m){let e=new Ee,a;switch(m.type){case"FeatureCollection":a=m.features.map((c=>Yl(c.geometry))).flat(1/0);break;case"Feature":a=Yl(m.geometry);break;default:a=Yl(m)}if(a.length==0)return e;for(let c=0;c<a.length-1;c+=2)e.extend([a[c],a[c+1]]);return e}class la extends o.E{constructor(e,a,c,r){super(),this.id=e,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._isUpdatingWorker=!1,this._pendingWorkerUpdate={data:a.data},this.actor=c.getActor(),this.setEventedParent(r),this._data=typeof a.data=="string"?{url:a.data}:{geojson:a.data},this._options=o.e({},a),this._collectResourceTiming=a.collectResourceTiming,a.maxzoom!==void 0&&(this.maxzoom=a.maxzoom),a.type&&(this.type=a.type),a.attribution&&(this.attribution=a.attribution),this.promoteId=a.promoteId,a.clusterMaxZoom!==void 0&&this.maxzoom<=a.clusterMaxZoom&&o.w(`The maxzoom value "${this.maxzoom}" is expected to be greater than the clusterMaxZoom value "${a.clusterMaxZoom}".`),this.workerOptions=o.e({source:this.id,cluster:a.cluster||!1,geojsonVtOptions:{buffer:this._pixelsToTileUnits(a.buffer!==void 0?a.buffer:128),tolerance:this._pixelsToTileUnits(a.tolerance!==void 0?a.tolerance:.375),extent:o.a4,maxZoom:this.maxzoom,lineMetrics:a.lineMetrics||!1,generateId:a.generateId||!1},superclusterOptions:{maxZoom:this._getClusterMaxZoom(a.clusterMaxZoom),minPoints:Math.max(2,a.clusterMinPoints||2),extent:o.a4,radius:this._pixelsToTileUnits(a.clusterRadius||50),log:!1,generateId:a.generateId||!1},clusterProperties:a.clusterProperties,filter:a.filter},a.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}_hasPendingWorkerUpdate(){return this._pendingWorkerUpdate.data!==void 0||this._pendingWorkerUpdate.diff!==void 0||this._pendingWorkerUpdate.optionsChanged}_pixelsToTileUnits(e){return e*(o.a4/this.tileSize)}_getClusterMaxZoom(e){let a=e?Math.round(e):this.maxzoom-1;return Number.isInteger(e)||e===void 0||o.w(`Integer expected for option 'clusterMaxZoom': provided value "${e}" rounded to "${a}"`),a}load(){return o._(this,void 0,void 0,(function*(){yield this._updateWorkerData()}))}onAdd(e){this.map=e,this.load()}setData(e,a){this._data=typeof e=="string"?{url:e}:{geojson:e},this._pendingWorkerUpdate={data:e};let c=this._updateWorkerData();return a?c:this}updateData(e,a){this._pendingWorkerUpdate.diff=o.a5(this._pendingWorkerUpdate.diff,e);let c=this._updateWorkerData();return a?c:this}getData(){return o._(this,void 0,void 0,(function*(){let e=o.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:e})}))}getBounds(){return o._(this,void 0,void 0,(function*(){return Fi(yield this.getData())}))}setClusterOptions(e){return this.workerOptions.cluster=e.cluster,e.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=this._pixelsToTileUnits(e.clusterRadius)),e.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=this._getClusterMaxZoom(e.clusterMaxZoom)),this._pendingWorkerUpdate.optionsChanged=!0,this._updateWorkerData(),this}getClusterExpansionZoom(e){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:e,source:this.id}})}getClusterChildren(e){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:e,source:this.id}})}getClusterLeaves(e,a,c){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:e,limit:a,offset:c}})}_updateWorkerData(){return o._(this,void 0,void 0,(function*(){if(this._isUpdatingWorker)return;if(!this._hasPendingWorkerUpdate())return void o.w(`No pending worker updates for GeoJSONSource ${this.id}.`);let{data:e,diff:a}=this._pendingWorkerUpdate,c=o.e({type:this.type},this.workerOptions);e?(typeof e=="string"?(c.request=this.map._requestManager.transformRequest(ft.resolveURL(e),"Source"),c.request.collectResourceTiming=this._collectResourceTiming):c.data=e,this._pendingWorkerUpdate.data=void 0):a&&(c.dataDiff=a,this._pendingWorkerUpdate.diff=void 0),this._pendingWorkerUpdate.optionsChanged=void 0,this._isUpdatingWorker=!0,this.fire(new o.l("dataloading",{dataType:"source"}));try{let r=yield this.actor.sendAsync({type:"LD",data:c});if(this._isUpdatingWorker=!1,this._removed||r.abandoned)return void this.fire(new o.l("dataabort",{dataType:"source"}));r.applyDiff?this._applyDiff(a):this._data={geojson:r.data};let W=null;r.resourceTiming&&r.resourceTiming[this.id]&&(W=r.resourceTiming[this.id].slice(0));let h={dataType:"source"};this._collectResourceTiming&&W&&W.length>0&&o.e(h,{resourceTiming:W}),this.fire(new o.l("data",Object.assign(Object.assign({},h),{sourceDataType:"metadata"}))),this.fire(new o.l("data",Object.assign(Object.assign({},h),{sourceDataType:"content",shouldReloadTileOptions:this._getShouldReloadTileOptions(a)})))}catch(r){if(this._isUpdatingWorker=!1,this._removed)return void this.fire(new o.l("dataabort",{dataType:"source"}));this.fire(new o.k(r))}finally{this._hasPendingWorkerUpdate()&&this._updateWorkerData()}}))}_applyDiff(e){let a=typeof this.promoteId=="string"?this.promoteId:void 0;this._data.url||this._data.updateable||!o.a6(this._data.geojson,a)||(this._data={updateable:o.a7(this._data.geojson,a)}),e&&this._data.updateable?o.a8(this._data.updateable,e,a):o.w("Cannot apply GeoJSONSource#updateData due to internal error")}_getShouldReloadTileOptions(e){if(this._options.cluster||!e||e.removeAll)return;let{add:a=[],update:c=[],remove:r=[]}=e||{},W=new Set([...c.map((h=>h.id)),...r]);for(let h of W.values())if(typeof h!="number"&&this.promoteId==null)return void o.w(`GeoJSONSource "${this.id}": updateData is slower when using string GeoJSON feature IDs (e.g. "${h}"). Consider using promoteId or numeric IDs for better performance.`);return{nextBounds:[...c.map((h=>h.newGeometry)),...a.map((h=>h.geometry))].filter(Boolean).map((h=>Fi(h))),prevIds:W}}shouldReloadTile(e,{nextBounds:a,prevIds:c}){if(!e.latestFeatureIndex)return e.state!=="unloaded";let r=e.latestFeatureIndex.loadVTLayers();for(let u=0;u<e.latestFeatureIndex.featureIndexArray.length;u++){let G=e.latestFeatureIndex.featureIndexArray.get(u),Y=r[o.a9].feature(G.featureIndex),y=e.latestFeatureIndex.getId(Y,o.a9);if(c.has(y))return!0}let{buffer:W,extent:h}=this.workerOptions.geojsonVtOptions,g=(function({x:u,y:G,z:Y},y=0){let J=o.a2((u-y)/Math.pow(2,Y)),S=o.a3((G+1+y)/Math.pow(2,Y)),L=o.a2((u+1+y)/Math.pow(2,Y)),w=o.a3((G-y)/Math.pow(2,Y));return new Ee([J,S],[L,w])})(e.tileID.canonical,W/h);for(let u of a)if(g.intersects(u))return!0;return!1}loaded(){return!this._isUpdatingWorker&&!this._hasPendingWorkerUpdate()}loadTile(e){return o._(this,void 0,void 0,(function*(){let a=e.actor?"RT":"LT";e.actor=this.actor;let c={type:this.type,uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity};e.abortController=new AbortController;let r=yield this.actor.sendAsync({type:a,data:c},e.abortController);delete e.abortController,e.unloadVectorData(),e.aborted||e.loadVectorData(r,this.map.painter,a==="RT")}))}abortTile(e){return o._(this,void 0,void 0,(function*(){e.abortController&&(e.abortController.abort(),delete e.abortController),e.aborted=!0}))}unloadTile(e){return o._(this,void 0,void 0,(function*(){e.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:e.uid,type:this.type,source:this.id}})}))}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return o.e({},this._options,{type:this.type,data:this._data.updateable?{type:"FeatureCollection",features:Array.from(this._data.updateable.values())}:this._data.url||this._data.geojson})}hasTransition(){return!1}}class Ql extends o.E{constructor(e,a,c,r){super(),this.flippedWindingOrder=!1,this.id=e,this.dispatcher=c,this.coordinates=a.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(r),this.options=a}load(e){return o._(this,void 0,void 0,(function*(){this._loaded=!1,this.fire(new o.l("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{let a=yield ce.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,a&&a.data&&(this.image=a.data,e&&(this.coordinates=e),this._finishLoading())}catch(a){this._request=null,this._loaded=!0,this.fire(new o.k(a))}}))}loaded(){return this._loaded}updateImage(e){return e.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=e.url,this.load(e.coordinates).finally((()=>{this.texture=null})),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new o.l("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(e){this.coordinates=e;let a=e.map(o.aa.fromLngLat);var c;return this.tileID=(function(r){let W=o.ab.fromPoints(r),h=W.width(),g=W.height(),u=Math.max(h,g),G=Math.max(0,Math.floor(-Math.log(u)/Math.LN2)),Y=Math.pow(2,G);return new o.ad(G,Math.floor((W.minX+W.maxX)/2*Y),Math.floor((W.minY+W.maxY)/2*Y))})(a),this.terrainTileRanges=this._getOverlappingTileRanges(a),this.minzoom=this.maxzoom=this.tileID.z,this.tileCoords=a.map((r=>this.tileID.getTilePoint(r)._round())),this.flippedWindingOrder=((c=this.tileCoords)[1].x-c[0].x)*(c[2].y-c[0].y)-(c[1].y-c[0].y)*(c[2].x-c[0].x)<0,this.fire(new o.l("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;let e=this.map.painter.context,a=e.gl;this.texture||(this.texture=new o.T(e,this.image,a.RGBA),this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE));let c=!1;for(let r in this.tiles){let W=this.tiles[r];W.state!=="loaded"&&(W.state="loaded",W.texture=this.texture,c=!0)}c&&this.fire(new o.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(e){return o._(this,void 0,void 0,(function*(){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={}):e.state="errored"}))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}_getOverlappingTileRanges(e){let{minX:a,minY:c,maxX:r,maxY:W}=o.ab.fromPoints(e),h={};for(let g=0;g<=o.ac;g++){let u=Math.pow(2,g),G=Math.floor(a*u),Y=Math.floor(c*u),y=Math.floor(r*u),J=Math.floor(W*u);h[g]={minTileX:G,minTileY:Y,maxTileX:y,maxTileY:J}}return h}}class ua extends Ql{constructor(e,a,c,r){super(e,a,c,r),this.roundZoom=!0,this.type="video",this.options=a}load(){return o._(this,void 0,void 0,(function*(){this._loaded=!1;let e=this.options;this.urls=[];for(let a of e.urls)this.urls.push(this.map._requestManager.transformRequest(a,"Source").url);try{let a=yield o.ae(this.urls);if(this._loaded=!0,!a)return;this.video=a,this.video.loop=!0,this.video.addEventListener("playing",(()=>{this.map.triggerRepaint()})),this.map&&this.video.play(),this._finishLoading()}catch(a){this.fire(new o.k(a))}}))}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(e){if(this.video){let a=this.video.seekable;e<a.start(0)||e>a.end(0)?this.fire(new o.k(new o.af(`sources.${this.id}`,null,`Playback for this video can be set only between the ${a.start(0)} and ${a.end(0)}-second mark.`))):this.video.currentTime=e}}getVideo(){return this.video}onAdd(e){this.map||(this.map=e,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;let e=this.map.painter.context,a=e.gl;this.texture?this.video.paused||(this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE),a.texSubImage2D(a.TEXTURE_2D,0,0,0,a.RGBA,a.UNSIGNED_BYTE,this.video)):(this.texture=new o.T(e,this.video,a.RGBA),this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE));let c=!1;for(let r in this.tiles){let W=this.tiles[r];W.state!=="loaded"&&(W.state="loaded",W.texture=this.texture,c=!0)}c&&this.fire(new o.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class ja extends Ql{constructor(e,a,c,r){super(e,a,c,r),a.coordinates?Array.isArray(a.coordinates)&&a.coordinates.length===4&&!a.coordinates.some((W=>!Array.isArray(W)||W.length!==2||W.some((h=>typeof h!="number"))))||this.fire(new o.k(new o.af(`sources.${e}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new o.k(new o.af(`sources.${e}`,null,'missing required property "coordinates"'))),a.animate&&typeof a.animate!="boolean"&&this.fire(new o.k(new o.af(`sources.${e}`,null,'optional "animate" property must be a boolean value'))),a.canvas?typeof a.canvas=="string"||a.canvas instanceof HTMLCanvasElement||this.fire(new o.k(new o.af(`sources.${e}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new o.k(new o.af(`sources.${e}`,null,'missing required property "canvas"'))),this.options=a,this.animate=a.animate===void 0||a.animate}load(){return o._(this,void 0,void 0,(function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new o.k(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}))}getCanvas(){return this.canvas}onAdd(e){this.map=e,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let e=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,e=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,e=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;let a=this.map.painter.context,c=a.gl;this.texture?(e||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new o.T(a,this.canvas,c.RGBA,{premultiply:!0});let r=!1;for(let W in this.tiles){let h=this.tiles[W];h.state!=="loaded"&&(h.state="loaded",h.texture=this.texture,r=!0)}r&&this.fire(new o.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",animate:this.animate,canvas:this.options.canvas,coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(let e of[this.canvas.width,this.canvas.height])if(isNaN(e)||e<=0)return!0;return!1}}let ia={},Fa=m=>{switch(m){case"geojson":return la;case"image":return Ql;case"raster":return za;case"raster-dem":return ea;case"vector":return ui;case"video":return ua;case"canvas":return ja}return ia[m]},Ai="RTLPluginLoaded";class Sn extends o.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=ji()}_syncState(e){return this.status=e,this.dispatcher.broadcast("SRPS",{pluginStatus:e,pluginURL:this.url}).catch((a=>{throw this.status="error",a}))}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(e){return o._(this,arguments,void 0,(function*(a,c=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=ft.resolveURL(a),!this.url)throw new Error(`requested url ${a} is invalid`);if(this.status==="unavailable"){if(!c)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()}))}_requestImport(){return o._(this,void 0,void 0,(function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new o.l(Ai))}))}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let an=null;function wi(){return an||(an=new Sn),an}var Gi,nt;(function(m){m[m.Base=0]="Base",m[m.Parent=1]="Parent"})(Gi||(Gi={})),(function(m){m[m.Departing=0]="Departing",m[m.Incoming=1]="Incoming"})(nt||(nt={}));class Q{constructor(e,a){this.timeAdded=0,this.fadeEndTime=0,this.fadeOpacity=1,this.tileID=e,this.uid=o.ag(),this.uses=0,this.tileSize=a,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}isRenderable(e){return this.hasData()&&(!this.fadeEndTime||this.fadeOpacity>0)&&(e||!this.holdingForSymbolFade())}setCrossFadeLogic({fadingRole:e,fadingDirection:a,fadingParentID:c,fadeEndTime:r}){this.resetFadeLogic(),this.fadingRole=e,this.fadingDirection=a,this.fadingParentID=c,this.fadeEndTime=r}setSelfFadeLogic(e){this.resetFadeLogic(),this.selfFading=!0,this.fadeEndTime=e}resetFadeLogic(){this.fadingRole=null,this.fadingDirection=null,this.fadingParentID=null,this.selfFading=!1,this.timeAdded=Ct(),this.fadeEndTime=0,this.fadeOpacity=1}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(e){this.demTexture&&e.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(e,a,c){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData,this.latestFeatureIndex.encoding=e.encoding):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData,this.latestFeatureIndex.encoding=this.latestEncoding)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=(function(r,W){let h={};if(!W)return h;for(let g of r){let u=g.layerIds.map((G=>W.getLayer(G))).filter(Boolean);if(u.length!==0){g.layers=u,g.stateDependentLayerIds&&(g.stateDependentLayers=g.stateDependentLayerIds.map((G=>u.filter((Y=>Y.id===G))[0])));for(let G of u)h[G.id]=g}}return h})(e.buckets,a?.style),this.hasSymbolBuckets=!1;for(let r in this.buckets){let W=this.buckets[r];if(W instanceof o.ai){if(this.hasSymbolBuckets=!0,!c)break;W.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(let r in this.buckets){let W=this.buckets[r];if(W instanceof o.ai&&W.hasRTLText){this.hasRTLText=!0,wi().lazyLoad();break}}this.queryPadding=0;for(let r in this.buckets){let W=this.buckets[r];this.queryPadding=Math.max(this.queryPadding,a.style.getLayer(r).queryRadius(W))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage),this.dashPositions=e.dashPositions}else this.collisionBoxArray=new o.ah}unloadVectorData(){for(let e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.dashPositions&&(this.dashPositions=null),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(e){return this.buckets[e.id]}upload(e){for(let c in this.buckets){let r=this.buckets[c];r.uploadPending()&&r.upload(e)}let a=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new o.T(e,this.imageAtlas.image,a.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new o.T(e,this.glyphAtlasImage,a.ALPHA),this.glyphAtlasImage=null)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,a,c,r,W,h,g,u,G,Y,y){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:r,cameraQueryGeometry:W,scale:h,tileSize:this.tileSize,pixelPosMatrix:Y,transform:u,params:g,queryPadding:this.queryPadding*G,getElevation:y},e,a,c):{}}querySourceFeatures(e,a){let c=this.latestFeatureIndex;if(!c||!c.rawTileData)return;let r=c.loadVTLayers(),W=a&&a.sourceLayer?a.sourceLayer:"",h=r[o.a9]||r[W];if(!h)return;let g=o.aj(a?.filter,a?.globalState),{z:u,x:G,y:Y}=this.tileID.canonical,y={z:u,x:G,y:Y};for(let J=0;J<h.length;J++){let S=h.feature(J);if(g.needGeometry){let v=o.ak(S,!0);if(!g.filter(new o.H(this.tileID.overscaledZ),v,this.tileID.canonical))continue}else if(!g.filter(new o.H(this.tileID.overscaledZ),S))continue;let L=c.getId(S,W),w=new o.al(S,u,G,Y,L);w.tile=y,e.push(w)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){let a=this.expirationTime;if(e.cacheControl){let c=o.am(e.cacheControl);c["max-age"]&&(this.expirationTime=Date.now()+1e3*c["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){let c=Date.now(),r=!1;if(this.expirationTime>c)r=!1;else if(a)if(this.expirationTime<a)r=!0;else{let W=this.expirationTime-a;W?this.expirationTime=c+Math.max(W,3e4):r=!0}else r=!0;r?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(e,a){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(e).length===0)return;let c=this.latestFeatureIndex.loadVTLayers();for(let r in this.buckets){if(!a.style.hasLayer(r))continue;let W=this.buckets[r],h=W.layers[0].sourceLayer||o.a9,g=c[h],u=e[h];if(!g||!u||Object.keys(u).length===0)continue;W.update(u,g,this.imageAtlas&&this.imageAtlas.patternPositions||{},this.dashPositions||{});let G=a&&a.style&&a.style.getLayer(r);G&&(this.queryPadding=Math.max(this.queryPadding,G.queryRadius(W)))}}holdingForSymbolFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<Ct()}clearSymbolFadeHold(){this.symbolFadeHoldUntil=void 0}setSymbolHoldDuration(e){this.symbolFadeHoldUntil=Ct()+e}setDependencies(e,a){let c={};for(let r of a)c[r]=!0;this.dependencies[e]=c}hasDependency(e,a){for(let c of e){let r=this.dependencies[c];if(r){for(let W of a)if(r[W])return!0}}return!1}}class k{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,a,c){let r=String(a);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][r]=this.stateChanges[e][r]||{},o.e(this.stateChanges[e][r],c),this.deletedStates[e]===null){this.deletedStates[e]={};for(let W in this.state[e])W!==r&&(this.deletedStates[e][W]=null)}else if(this.deletedStates[e]&&this.deletedStates[e][r]===null){this.deletedStates[e][r]={};for(let W in this.state[e][r])c[W]||(this.deletedStates[e][r][W]=null)}else for(let W in c)this.deletedStates[e]&&this.deletedStates[e][r]&&this.deletedStates[e][r][W]===null&&delete this.deletedStates[e][r][W]}removeFeatureState(e,a,c){if(this.deletedStates[e]===null)return;let r=String(a);if(this.deletedStates[e]=this.deletedStates[e]||{},c&&a!==void 0)this.deletedStates[e][r]!==null&&(this.deletedStates[e][r]=this.deletedStates[e][r]||{},this.deletedStates[e][r][c]=null);else if(a!==void 0)if(this.stateChanges[e]&&this.stateChanges[e][r])for(c in this.deletedStates[e][r]={},this.stateChanges[e][r])this.deletedStates[e][r][c]=null;else this.deletedStates[e][r]=null;else this.deletedStates[e]=null}getState(e,a){let c=String(a),r=o.e({},(this.state[e]||{})[c],(this.stateChanges[e]||{})[c]);if(this.deletedStates[e]===null)return{};if(this.deletedStates[e]){let W=this.deletedStates[e][a];if(W===null)return{};for(let h in W)delete r[h]}return r}initializeTileState(e,a){e.setFeatureState(this.state,a)}coalesceChanges(e,a){let c={};for(let r in this.stateChanges){this.state[r]=this.state[r]||{};let W={};for(let h in this.stateChanges[r])this.state[r][h]||(this.state[r][h]={}),o.e(this.state[r][h],this.stateChanges[r][h]),W[h]=this.state[r][h];c[r]=W}for(let r in this.deletedStates){this.state[r]=this.state[r]||{};let W={};if(this.deletedStates[r]===null)for(let h in this.state[r])W[h]={},this.state[r][h]={};else for(let h in this.deletedStates[r]){if(this.deletedStates[r][h]===null)this.state[r][h]={};else for(let g of Object.keys(this.deletedStates[r][h]))delete this.state[r][h][g];W[h]=this.state[r][h]}c[r]=c[r]||{},o.e(c[r],W)}if(this.stateChanges={},this.deletedStates={},Object.keys(c).length!==0)for(let r in e)e[r].setFeatureState(c,a)}}let j=89.25;function P(m,e){let a=o.an(e.lat,-o.ao,o.ao);return new o.P(o.Y(e.lng)*m,o.X(a)*m)}function $(m,e){return new o.aa(e.x/m,e.y/m).toLngLat()}function st(m){return m.cameraToCenterDistance*Math.min(.85*Math.tan(o.ap(90-m.pitch)),Math.tan(o.ap(j-m.pitch)))}function D(m,e){let a=m.canonical,c=e/o.aq(a.z),r=a.x+Math.pow(2,a.z)*m.wrap,W=o.ar(new Float64Array(16));return o.O(W,W,[r*c,a.y*c,0]),o.Q(W,W,[c/o.a4,c/o.a4,1]),W}function ot(m,e,a,c,r){let W=o.aa.fromLngLat(m,e),h=r*o.as(1,m.lat),g=h*Math.cos(o.ap(a)),u=Math.sqrt(h*h-g*g),G=u*Math.sin(o.ap(-c)),Y=u*Math.cos(o.ap(-c));return new o.aa(W.x+G,W.y+Y,W.z+g)}function Vt(m,e,a){let c=e.intersectsFrustum(m);if(!a||c===0)return c;let r=e.intersectsPlane(a);return r===0?0:c===2&&r===2?2:1}function pt(m,e,a){let c=0,r=(a-e)/10;for(let W=0;W<10;W++)c+=r*Math.pow(Math.cos(e+(W+.5)/10*(a-e)),m);return c}function gt(m,e){return function(a,c,r,W,h){let g=2*((m-1)/o.at(Math.cos(o.ap(j-h))/Math.cos(o.ap(j)))-1),u=Math.acos(r/W),G=2*pt(g-1,0,o.ap(h/2)),Y=Math.min(o.ap(j),u+o.ap(h/2)),y=pt(g-1,Math.min(Y,u-o.ap(h/2)),Y),J=Math.atan(c/r),S=Math.hypot(c,r),L=a;return L+=o.at(W/S/Math.max(.5,Math.cos(o.ap(h/2)))),L+=g*o.at(Math.cos(J))/2,L-=o.at(Math.max(1,y/G/e))/2,L}}let kt=gt(9.314,3);function Ht(m,e){let a=(e.roundZoom?Math.round:Math.floor)(m.zoom+o.at(m.tileSize/e.tileSize));return Math.max(0,a)}function ie(m,e){let a=m.getCameraFrustum(),c=m.getClippingPlane(),r=m.screenPointToMercatorCoordinate(m.getCameraPoint()),W=o.aa.fromLngLat(m.center,m.elevation);r.z=W.z+Math.cos(m.pitchInRadians)*m.cameraToCenterDistance/m.worldSize;let h=m.getCoveringTilesDetailsProvider(),g=h.allowVariableZoom(m,e),u=Ht(m,e),G=e.minzoom||0,Y=e.maxzoom!==void 0?e.maxzoom:m.maxZoom,y=Math.min(Math.max(0,u),Y),J=Math.pow(2,y),S=[J*r.x,J*r.y,0],L=[J*W.x,J*W.y,0],w=Math.hypot(W.x-r.x,W.y-r.y),v=Math.abs(W.z-r.z),O=Math.hypot(w,v),K=et=>({zoom:0,x:0,y:0,wrap:et,fullyVisible:!1}),tt=[],_=[];if(m.renderWorldCopies&&h.allowWorldCopies())for(let et=1;et<=3;et++)tt.push(K(-et)),tt.push(K(et));for(tt.push(K(0));tt.length>0;){let et=tt.pop(),it=et.x,q=et.y,ct=et.fullyVisible,ht={x:it,y:q,z:et.zoom},bt=h.getTileBoundingVolume(ht,et.wrap,m.elevation,e);if(!ct){let Yt=Vt(a,bt,c);if(Yt===0)continue;ct=Yt===2}let mt=h.distanceToTile2d(r.x,r.y,ht,bt),Zt=u;g&&(Zt=(e.calculateTileZoom||kt)(m.zoom+o.at(m.tileSize/e.tileSize),mt,v,O,m.fov)),Zt=(e.roundZoom?Math.round:Math.floor)(Zt),Zt=Math.max(0,Zt);let Jt=Math.min(Zt,Y);if(et.wrap=h.getWrap(W,ht,et.wrap),et.zoom>=Jt){if(et.zoom<G)continue;let Yt=y-et.zoom,Gt=S[0]-.5-(it<<Yt),zt=S[1]-.5-(q<<Yt),ee=e.reparseOverscaled?Math.max(et.zoom,Zt):et.zoom;_.push({tileID:new o.a1(et.zoom===Y?ee:et.zoom,et.wrap,et.zoom,it,q),distanceSq:o.au([L[0]-.5-it,L[1]-.5-q]),tileDistanceToCamera:Math.sqrt(Gt*Gt+zt*zt)})}else for(let Yt=0;Yt<4;Yt++)tt.push({zoom:et.zoom+1,x:(it<<1)+Yt%2,y:(q<<1)+(Yt>>1),wrap:et.wrap,fullyVisible:ct})}return _.sort(((et,it)=>et.distanceSq-it.distanceSq)).map((et=>et.tileID))}let Pe=o.ab.fromPoints([new o.P(0,0),new o.P(o.a4,o.a4)]);class be extends o.E{constructor(e,a,c){super(),this.id=e,this.dispatcher=c,this.on("data",(r=>this._dataHandler(r))),this.on("dataloading",(()=>{this._sourceErrored=!1})),this.on("error",(()=>{this._sourceErrored=this._source.loaded()})),this._source=((r,W,h,g)=>{let u=new(Fa(W.type))(r,W,h,g);if(u.id!==r)throw new Error(`Expected Source id to be ${r} instead of ${u.id}`);return u})(e,a,c,this),this._tiles={},this._cache=new o.av(0,(r=>this._unloadTile(r))),this._timers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._rasterFadeDuration=0,this._maxFadingAncestorLevels=5,this._state=new k,this._didEmitContent=!1,this._updated=!1}onAdd(e){this.map=e,this._maxTileCacheSize=e?e._maxTileCacheSize:null,this._maxTileCacheZoomLevels=e?e._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(e)}onRemove(e){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(e)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(let e in this._tiles){let a=this._tiles[e];if(a.state!=="loaded"&&a.state!=="errored")return!1}return!0}getSource(){return this._source}getState(){return this._state}pause(){this._paused=!0}resume(){if(!this._paused)return;let e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(e,a,c){return o._(this,void 0,void 0,(function*(){try{yield this._source.loadTile(e),this._tileLoaded(e,a,c)}catch(r){e.state="errored",r.status!==404?this._source.fire(new o.k(r,{tile:e})):this.update(this.transform,this.terrain)}}))}_unloadTile(e){this._source.unloadTile&&this._source.unloadTile(e)}_abortTile(e){this._source.abortTile&&this._source.abortTile(e),this._source.fire(new o.l("dataabort",{tile:e,coord:e.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(let a in this._tiles){let c=this._tiles[a];c.upload(e),c.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map((e=>e.tileID)).sort(Re).map((e=>e.key))}getRenderableIds(e){let a=[];for(let c in this._tiles)this._isIdRenderable(c,e)&&a.push(this._tiles[c]);return e?a.sort(((c,r)=>{let W=c.tileID,h=r.tileID,g=new o.P(W.canonical.x,W.canonical.y)._rotate(-this.transform.bearingInRadians),u=new o.P(h.canonical.x,h.canonical.y)._rotate(-this.transform.bearingInRadians);return W.overscaledZ-h.overscaledZ||u.y-g.y||u.x-g.x})).map((c=>c.tileID.key)):a.map((c=>c.tileID)).sort(Re).map((c=>c.key))}hasRenderableParent(e){let a=e.overscaledZ-1;if(a>=this._source.minzoom){let c=this.getLoadedTile(e.scaledTo(a));if(c)return this._isIdRenderable(c.tileID.key)}return!1}_isIdRenderable(e,a=!1){var c;return(c=this._tiles[e])===null||c===void 0?void 0:c.isRenderable(a)}reload(e,a=void 0){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(let c in this._tiles)a&&this._source.shouldReloadTile&&!this._source.shouldReloadTile(this._tiles[c],a)||(e?this._reloadTile(c,"expired"):this._tiles[c].state!=="errored"&&this._reloadTile(c,"reloading"))}}_reloadTile(e,a){return o._(this,void 0,void 0,(function*(){let c=this._tiles[e];c&&(c.state!=="loading"&&(c.state=a),yield this._loadTile(c,e,a))}))}_tileLoaded(e,a,c){e.timeAdded=Ct(),e.selfFading&&(e.fadeEndTime=e.timeAdded+this._rasterFadeDuration),c==="expired"&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(a,e),this.getSource().type==="raster-dem"&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),e.aborted||this._source.fire(new o.l("data",{dataType:"source",tile:e,coord:e.tileID}))}_backfillDEM(e){let a=this.getRenderableIds();for(let r=0;r<a.length;r++){let W=a[r];if(e.neighboringTiles&&e.neighboringTiles[W]){let h=this.getTileByID(W);c(e,h),c(h,e)}}function c(r,W){r.needsHillshadePrepare=!0,r.needsTerrainPrepare=!0;let h=W.tileID.canonical.x-r.tileID.canonical.x,g=W.tileID.canonical.y-r.tileID.canonical.y,u=Math.pow(2,r.tileID.canonical.z),G=W.tileID.key;h===0&&g===0||Math.abs(g)>1||(Math.abs(h)>1&&(Math.abs(h+u)===1?h+=u:Math.abs(h-u)===1&&(h-=u)),W.dem&&r.dem&&(r.dem.backfillBorder(W.dem,h,g),r.neighboringTiles&&r.neighboringTiles[G]&&(r.neighboringTiles[G].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,a){let c=this._getLoadedDescendents(a),r=new Set;for(let W of a){let h=c[W.key];if(!h?.length){r.add(W);continue}let g=W.overscaledZ+be.maxOverzooming,u=h.filter((y=>y.tileID.overscaledZ<=g));if(!u.length){r.add(W);continue}let G=Math.min(...u.map((y=>y.tileID.overscaledZ))),Y=u.filter((y=>y.tileID.overscaledZ===G)).map((y=>y.tileID));for(let y of Y)e[y.key]=y;this._areDescendentsComplete(Y,G,W.overscaledZ)||r.add(W)}return r}_getLoadedDescendents(e){var a;let c={};for(let r in this._tiles){let W=this._tiles[r];if(W.hasData())for(let h of e)W.tileID.isChildOf(h)&&(c[a=h.key]||(c[a]=[])).push(W)}return c}_areDescendentsComplete(e,a,c){return e.length===1&&e[0].isOverscaled()?e[0].overscaledZ===a:Math.pow(4,a-c)===e.length}getLoadedTile(e){let a=this._tiles[e.key];return a?.hasData()?a:null}updateCacheSize(e){let a=Math.ceil(e.width/this._source.tileSize)+1,c=Math.ceil(e.height/this._source.tileSize)+1,r=Math.floor(a*c*(this._maxTileCacheZoomLevels===null?o.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),W=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,r):r;this._cache.setMaxSize(W)}handleWrapJump(e){let a=Math.round((e-(this._prevLng===void 0?e:this._prevLng))/360);if(this._prevLng=e,a){let c={};for(let r in this._tiles){let W=this._tiles[r];W.tileID=W.tileID.unwrapTo(W.tileID.wrap+a),c[W.tileID.key]=W}this._tiles=c,this._resetTileReloadTimers()}}update(e,a){if(!this._sourceLoaded||this._paused)return;let c;this.transform=e,this.terrain=a,this.updateCacheSize(e),this.handleWrapJump(this.transform.center.lng),this.used||this.usedForTerrain?this._source.tileID?c=e.getVisibleUnwrappedCoordinates(this._source.tileID).map((u=>new o.a1(u.canonical.z,u.wrap,u.canonical.z,u.canonical.x,u.canonical.y))):(c=ie(e,{tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.type==="vector"&&this.map._zoomLevelsToOverscale!==void 0?e.maxZoom-this.map._zoomLevelsToOverscale:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:a,calculateTileZoom:this._source.calculateTileZoom}),this._source.hasTile&&(c=c.filter((u=>this._source.hasTile(u))))):c=[],this.usedForTerrain&&(c=this._addTerrainIdealTiles(c));let r=c.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,r&&this.fire(new o.l("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));let W=Ht(e,this._source),h=this._updateRetainedTiles(c,W),g=Te(this._source.type);g&&this._rasterFadeDuration>0&&!a&&this._updateFadingTiles(c,h),g?this._cleanUpRasterTiles(h):this._cleanUpVectorTiles(h)}_cleanUpRasterTiles(e){for(let a in this._tiles)e[a]||this._removeTile(a)}_cleanUpVectorTiles(e){for(let a in this._tiles){let c=this._tiles[a];e[a]?c.clearSymbolFadeHold():c.hasSymbolBuckets?c.holdingForSymbolFade()?c.symbolFadeFinished()&&this._removeTile(a):c.setSymbolHoldDuration(this.map._fadeDuration):this._removeTile(a)}}_addTerrainIdealTiles(e){let a=[];for(let c of e)if(c.canonical.z>this._source.minzoom){let r=c.scaledTo(c.canonical.z-1);a.push(r);let W=c.scaledTo(Math.max(this._source.minzoom,Math.min(c.canonical.z,5)));a.push(W)}return e.concat(a)}releaseSymbolFadeTiles(){for(let e in this._tiles)this._tiles[e].holdingForSymbolFade()&&this._removeTile(e)}_updateRetainedTiles(e,a){var c;let r=new Set;for(let G of e)this._addTile(G).hasData()||r.add(G);let W=e.reduce(((G,Y)=>(G[Y.key]=Y,G)),{}),h=this._retainLoadedChildren(W,r),g={},u=Math.max(a-be.maxUnderzooming,this._source.minzoom);for(let G of h){let Y=this._tiles[G.key],y=Y?.wasRequested();for(let J=G.overscaledZ-1;J>=u;--J){let S=G.scaledTo(J);if(g[S.key])break;if(g[S.key]=!0,Y=this.getTile(S),!Y&&y&&(Y=this._addTile(S)),Y){let L=Y.hasData();if((L||!(!((c=this.map)===null||c===void 0)&&c.cancelPendingTileRequestsWhileZooming)||y)&&(W[S.key]=S),y=Y.wasRequested(),L)break}}}return W}_updateFadingTiles(e,a){let c=Ct(),r=o.aw(e);for(let W of e){let h=this._tiles[W.key];h.fadingDirection!==nt.Departing&&h.fadeOpacity!==0||h.resetFadeLogic(),this._updateFadingAncestor(h,a,c)||this._updateFadingDescendents(h,a,c)||this._updateFadingEdge(h,r,c)||h.resetFadeLogic()}}_updateFadingAncestor(e,a,c){if(!e.hasData())return!1;let{tileID:r,fadingRole:W,fadingDirection:h,fadingParentID:g}=e;if(W===Gi.Base&&h===nt.Incoming&&g)return a[g.key]=g,!0;let u=Math.max(r.overscaledZ-this._maxFadingAncestorLevels,this._source.minzoom);for(let G=r.overscaledZ-1;G>=u;G--){let Y=r.scaledTo(G),y=this.getLoadedTile(Y);if(y)return e.setCrossFadeLogic({fadingRole:Gi.Base,fadingDirection:nt.Incoming,fadingParentID:y.tileID,fadeEndTime:c+this._rasterFadeDuration}),y.setCrossFadeLogic({fadingRole:Gi.Parent,fadingDirection:nt.Departing,fadeEndTime:c+this._rasterFadeDuration}),a[Y.key]=Y,!0}return!1}_updateFadingDescendents(e,a,c){if(!e.hasData())return!1;let r=e.tileID.children(this._source.maxzoom),W=this._updateFadingChildren(e,r,a,c);if(W)return!0;for(let h of r){let g=h.children(this._source.maxzoom);this._updateFadingChildren(e,g,a,c)&&(W=!0)}return W}_updateFadingChildren(e,a,c,r){if(a[0].overscaledZ>=this._source.maxzoom)return!1;let W=!1;for(let h of a){let g=this.getLoadedTile(h);if(!g)continue;let{fadingRole:u,fadingDirection:G,fadingParentID:Y}=g;u===Gi.Base&&G===nt.Departing&&Y||(g.setCrossFadeLogic({fadingRole:Gi.Base,fadingDirection:nt.Departing,fadingParentID:e.tileID,fadeEndTime:r+this._rasterFadeDuration}),e.setCrossFadeLogic({fadingRole:Gi.Parent,fadingDirection:nt.Incoming,fadeEndTime:r+this._rasterFadeDuration})),c[h.key]=h,W=!0}return W}_updateFadingEdge(e,a,c){let r=e.tileID;return!!e.selfFading||!e.hasData()&&!!a.has(r)&&(e.setSelfFadeLogic(c+this._rasterFadeDuration),!0)}_addTile(e){let a=this._tiles[e.key];if(a)return a;a=this._cache.getAndRemove(e),a&&(a.resetFadeLogic(),this._setTileReloadTimer(e.key,a),a.tileID=e,this._state.initializeTileState(a,this.map?this.map.painter:null));let c=a;return a||(a=new Q(e,this._source.tileSize*e.overscaleFactor()),this._loadTile(a,e.key,a.state)),a.uses++,this._tiles[e.key]=a,c||this._source.fire(new o.l("dataloading",{tile:a,coord:a.tileID,dataType:"source"})),a}_setTileReloadTimer(e,a){this._clearTileReloadTimer(e);let c=a.getExpiryTimeout();c&&(this._timers[e]=setTimeout((()=>{this._reloadTile(e,"expired"),delete this._timers[e]}),c))}_clearTileReloadTimer(e){let a=this._timers[e];a&&(clearTimeout(a),delete this._timers[e])}_resetTileReloadTimers(){for(let e in this._timers)clearTimeout(this._timers[e]),delete this._timers[e];for(let e in this._tiles)this._setTileReloadTimer(e,this._tiles[e])}refreshTiles(e){for(let a in this._tiles)(this._isIdRenderable(a)||this._tiles[a].state=="errored")&&e.some((c=>c.equals(this._tiles[a].tileID.canonical)))&&this._reloadTile(a,"expired")}_removeTile(e){let a=this._tiles[e];a&&(a.uses--,delete this._tiles[e],this._clearTileReloadTimer(e),a.uses>0||(a.hasData()&&a.state!=="reloading"?this._cache.add(a.tileID,a,a.getExpiryTimeout()):(a.aborted=!0,this._abortTile(a),this._unloadTile(a))))}_dataHandler(e){e.dataType==="source"&&(e.sourceDataType!=="metadata"?e.sourceDataType==="content"&&this._sourceLoaded&&!this._paused&&(this.reload(e.sourceDataChanged,e.shouldReloadTileOptions),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0):this._sourceLoaded=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(let e in this._tiles)this._removeTile(e);this._cache.reset()}tilesIn(e,a,c){let r=[],W=this.transform;if(!W)return r;let h=W.getCoveringTilesDetailsProvider().allowWorldCopies(),g=c?W.getCameraQueryGeometry(e):e,u=S=>W.screenPointToMercatorCoordinate(S,this.terrain),G=this.transformBbox(e,u,!h),Y=this.transformBbox(g,u,!h),y=this.getIds(),J=o.ab.fromPoints(Y);for(let S=0;S<y.length;S++){let L=this._tiles[y[S]];if(L.holdingForSymbolFade())continue;let w=h?[L.tileID]:[L.tileID.unwrapTo(-1),L.tileID.unwrapTo(0)],v=Math.pow(2,W.zoom-L.tileID.overscaledZ),O=a*L.queryPadding*o.a4/L.tileSize/v;for(let K of w){let tt=J.map((_=>K.getTilePoint(new o.aa(_.x,_.y))));if(tt.expandBy(O),tt.intersects(Pe)){let _=G.map((it=>K.getTilePoint(it))),et=Y.map((it=>K.getTilePoint(it)));r.push({tile:L,tileID:h?K:K.unwrapTo(0),queryGeometry:_,cameraQueryGeometry:et,scale:v})}}}return r}transformBbox(e,a,c){let r=e.map(a);if(c){let W=o.ab.fromPoints(e);W.shrinkBy(.001*Math.min(W.width(),W.height()));let h=W.map(a);o.ab.fromPoints(r).covers(h)||(r=r.map((g=>g.x>.5?new o.aa(g.x-1,g.y,g.z):g)))}return r}getVisibleCoordinates(e){let a=this.getRenderableIds(e).map((c=>this._tiles[c].tileID));return this.transform&&this.transform.populateCache(a),a}hasTransition(){if(this._source.hasTransition())return!0;if(Te(this._source.type)&&this._rasterFadeDuration>0){let e=Ct();for(let a in this._tiles)if(this._tiles[a].fadeEndTime>=e)return!0}return!1}setRasterFadeDuration(e){this._rasterFadeDuration=e}setFeatureState(e,a,c){this._state.updateState(e=e||o.a9,a,c)}removeFeatureState(e,a,c){this._state.removeFeatureState(e=e||o.a9,a,c)}getFeatureState(e,a){return this._state.getState(e=e||o.a9,a)}setDependencies(e,a,c){let r=this._tiles[e];r&&r.setDependencies(a,c)}reloadTilesForDependencies(e,a){for(let c in this._tiles)this._tiles[c].hasDependency(e,a)&&this._reloadTile(c,"reloading");this._cache.filter((c=>!c.hasDependency(e,a)))}}function Re(m,e){let a=Math.abs(2*m.wrap)-+(m.wrap<0),c=Math.abs(2*e.wrap)-+(e.wrap<0);return m.overscaledZ-e.overscaledZ||c-a||e.canonical.y-m.canonical.y||e.canonical.x-m.canonical.x}function Te(m){return m==="raster"||m==="image"||m==="video"}be.maxUnderzooming=10,be.maxOverzooming=3;class Mt{constructor(e,a){this.reset(e,a)}reset(e,a){this.points=e||[],this._distances=[0];for(let c=1;c<this.points.length;c++)this._distances[c]=this._distances[c-1]+this.points[c].dist(this.points[c-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(a||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(e){if(this.points.length===1)return this.points[0];e=o.an(e,0,1);let a=1,c=this._distances[a],r=e*this.paddedLength+this.padding;for(;c<r&&a<this._distances.length;)c=this._distances[++a];let W=a-1,h=this._distances[W],g=c-h,u=g>0?(r-h)/g:0;return this.points[W].mult(1-u).add(this.points[a].mult(u))}}function ze(m,e){let a=!0;return m==="always"||m!=="never"&&e!=="never"||(a=!1),a}class Xe{constructor(e,a,c){let r=this.boxCells=[],W=this.circleCells=[];this.xCellCount=Math.ceil(e/c),this.yCellCount=Math.ceil(a/c);for(let h=0;h<this.xCellCount*this.yCellCount;h++)r.push([]),W.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=e,this.height=a,this.xScale=this.xCellCount/e,this.yScale=this.yCellCount/a,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(e,a,c,r,W){this._forEachCell(a,c,r,W,this._insertBoxCell,this.boxUid++),this.boxKeys.push(e),this.bboxes.push(a),this.bboxes.push(c),this.bboxes.push(r),this.bboxes.push(W)}insertCircle(e,a,c,r){this._forEachCell(a-r,c-r,a+r,c+r,this._insertCircleCell,this.circleUid++),this.circleKeys.push(e),this.circles.push(a),this.circles.push(c),this.circles.push(r)}_insertBoxCell(e,a,c,r,W,h){this.boxCells[W].push(h)}_insertCircleCell(e,a,c,r,W,h){this.circleCells[W].push(h)}_query(e,a,c,r,W,h,g){if(c<0||e>this.width||r<0||a>this.height)return[];let u=[];if(e<=0&&a<=0&&this.width<=c&&this.height<=r){if(W)return[{key:null,x1:e,y1:a,x2:c,y2:r}];for(let G=0;G<this.boxKeys.length;G++)u.push({key:this.boxKeys[G],x1:this.bboxes[4*G],y1:this.bboxes[4*G+1],x2:this.bboxes[4*G+2],y2:this.bboxes[4*G+3]});for(let G=0;G<this.circleKeys.length;G++){let Y=this.circles[3*G],y=this.circles[3*G+1],J=this.circles[3*G+2];u.push({key:this.circleKeys[G],x1:Y-J,y1:y-J,x2:Y+J,y2:y+J})}}else this._forEachCell(e,a,c,r,this._queryCell,u,{hitTest:W,overlapMode:h,seenUids:{box:{},circle:{}}},g);return u}query(e,a,c,r){return this._query(e,a,c,r,!1,null)}hitTest(e,a,c,r,W,h){return this._query(e,a,c,r,!0,W,h).length>0}hitTestCircle(e,a,c,r,W){let h=e-c,g=e+c,u=a-c,G=a+c;if(g<0||h>this.width||G<0||u>this.height)return!1;let Y=[];return this._forEachCell(h,u,g,G,this._queryCellCircle,Y,{hitTest:!0,overlapMode:r,circle:{x:e,y:a,radius:c},seenUids:{box:{},circle:{}}},W),Y.length>0}_queryCell(e,a,c,r,W,h,g,u){let{seenUids:G,hitTest:Y,overlapMode:y}=g,J=this.boxCells[W];if(J!==null){let L=this.bboxes;for(let w of J)if(!G.box[w]){G.box[w]=!0;let v=4*w,O=this.boxKeys[w];if(e<=L[v+2]&&a<=L[v+3]&&c>=L[v+0]&&r>=L[v+1]&&(!u||u(O))&&(!Y||!ze(y,O.overlapMode))&&(h.push({key:O,x1:L[v],y1:L[v+1],x2:L[v+2],y2:L[v+3]}),Y))return!0}}let S=this.circleCells[W];if(S!==null){let L=this.circles;for(let w of S)if(!G.circle[w]){G.circle[w]=!0;let v=3*w,O=this.circleKeys[w];if(this._circleAndRectCollide(L[v],L[v+1],L[v+2],e,a,c,r)&&(!u||u(O))&&(!Y||!ze(y,O.overlapMode))){let K=L[v],tt=L[v+1],_=L[v+2];if(h.push({key:O,x1:K-_,y1:tt-_,x2:K+_,y2:tt+_}),Y)return!0}}}return!1}_queryCellCircle(e,a,c,r,W,h,g,u){let{circle:G,seenUids:Y,overlapMode:y}=g,J=this.boxCells[W];if(J!==null){let L=this.bboxes;for(let w of J)if(!Y.box[w]){Y.box[w]=!0;let v=4*w,O=this.boxKeys[w];if(this._circleAndRectCollide(G.x,G.y,G.radius,L[v+0],L[v+1],L[v+2],L[v+3])&&(!u||u(O))&&!ze(y,O.overlapMode))return h.push(!0),!0}}let S=this.circleCells[W];if(S!==null){let L=this.circles;for(let w of S)if(!Y.circle[w]){Y.circle[w]=!0;let v=3*w,O=this.circleKeys[w];if(this._circlesCollide(L[v],L[v+1],L[v+2],G.x,G.y,G.radius)&&(!u||u(O))&&!ze(y,O.overlapMode))return h.push(!0),!0}}}_forEachCell(e,a,c,r,W,h,g,u){let G=this._convertToXCellCoord(e),Y=this._convertToYCellCoord(a),y=this._convertToXCellCoord(c),J=this._convertToYCellCoord(r);for(let S=G;S<=y;S++)for(let L=Y;L<=J;L++)if(W.call(this,e,a,c,r,this.xCellCount*L+S,h,g,u))return}_convertToXCellCoord(e){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(e*this.xScale)))}_convertToYCellCoord(e){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(e*this.yScale)))}_circlesCollide(e,a,c,r,W,h){let g=r-e,u=W-a,G=c+h;return G*G>g*g+u*u}_circleAndRectCollide(e,a,c,r,W,h,g){let u=(h-r)/2,G=Math.abs(e-(r+u));if(G>u+c)return!1;let Y=(g-W)/2,y=Math.abs(a-(W+Y));if(y>Y+c)return!1;if(G<=u||y<=Y)return!0;let J=G-u,S=y-Y;return J*J+S*S<=c*c}}function Wl(m,e,a){let c=o.N();if(!m){let{vecSouth:y,vecEast:J}=xt(e),S=Ft();S[0]=J[0],S[1]=J[1],S[2]=y[0],S[3]=y[1],r=S,(Y=(h=(W=S)[0])*(G=W[3])-(u=W[2])*(g=W[1]))&&(r[0]=G*(Y=1/Y),r[1]=-g*Y,r[2]=-u*Y,r[3]=h*Y),c[0]=S[0],c[1]=S[1],c[4]=S[2],c[5]=S[3]}var r,W,h,g,u,G,Y;return o.Q(c,c,[1/a,1/a,1]),c}function Je(m,e,a,c){if(m){let r=o.N();if(!e){let{vecSouth:W,vecEast:h}=xt(a);r[0]=h[0],r[1]=h[1],r[4]=W[0],r[5]=W[1]}return o.Q(r,r,[c,c,1]),r}return a.pixelsToClipSpaceMatrix}function xt(m){let e=Math.cos(m.rollInRadians),a=Math.sin(m.rollInRadians),c=Math.cos(m.pitchInRadians),r=Math.cos(m.bearingInRadians),W=Math.sin(m.bearingInRadians),h=o.aB();h[0]=-r*c*a-W*e,h[1]=-W*c*a+r*e;let g=o.aC(h);g<1e-9?o.aD(h):o.aE(h,h,1/g);let u=o.aB();u[0]=r*c*e-W*a,u[1]=W*c*e+r*a;let G=o.aC(u);return G<1e-9?o.aD(u):o.aE(u,u,1/G),{vecEast:u,vecSouth:h}}function jt(m,e,a,c){let r;c?(r=[m,e,c(m,e),1],o.aG(r,r,a)):(r=[m,e,0,1],Rd(r,r,a));let W=r[3];return{point:new o.P(r[0]/W,r[1]/W),signedDistanceFromCamera:W,isOccluded:!1}}function _t(m,e){return .5+m/e*.5}function ri(m,e){return m.x>=-e[0]&&m.x<=e[0]&&m.y>=-e[1]&&m.y<=e[1]}function nn(m,e,a,c,r,W,h,g,u,G,Y,y,J){let S=a?m.textSizeData:m.iconSizeData,L=o.ax(S,e.transform.zoom),w=[256/e.width*2+1,256/e.height*2+1],v=a?m.text.dynamicLayoutVertexArray:m.icon.dynamicLayoutVertexArray;v.clear();let O=m.lineVertexArray,K=a?m.text.placedSymbolArray:m.icon.placedSymbolArray,tt=e.transform.width/e.transform.height,_=!1;for(let et=0;et<K.length;et++){let it=K.get(et);if(it.hidden||it.writingMode===o.ay.vertical&&!_){aa(it.numGlyphs,v);continue}_=!1;let q=new o.P(it.anchorX,it.anchorY),ct={getElevation:J,pitchedLabelPlaneMatrix:c,lineVertexArray:O,pitchWithMap:W,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:e.transform,tileAnchorPoint:q,unwrappedTileID:u,width:G,height:Y,translation:y},ht=kn(it.anchorX,it.anchorY,ct);if(!ri(ht.point,w)){aa(it.numGlyphs,v);continue}let bt=_t(e.transform.cameraToCenterDistance,ht.signedDistanceFromCamera),mt=o.az(S,L,it),Zt=W?mt*e.transform.getPitchedTextCorrection(it.anchorX,it.anchorY,u)/bt:mt*bt,Jt=Ga({projectionContext:ct,pitchedLabelPlaneMatrixInverse:r,symbol:it,fontSize:Zt,flip:!1,keepUpright:h,glyphOffsetArray:m.glyphOffsetArray,dynamicLayoutVertexArray:v,aspectRatio:tt,rotateToLine:g});_=Jt.useVertical,(Jt.notEnoughRoom||_||Jt.needsFlipping&&Ga({projectionContext:ct,pitchedLabelPlaneMatrixInverse:r,symbol:it,fontSize:Zt,flip:!0,keepUpright:h,glyphOffsetArray:m.glyphOffsetArray,dynamicLayoutVertexArray:v,aspectRatio:tt,rotateToLine:g}).notEnoughRoom)&&aa(it.numGlyphs,v)}a?m.text.dynamicLayoutVertexBuffer.updateData(v):m.icon.dynamicLayoutVertexBuffer.updateData(v)}function xl(m,e,a,c,r,W,h,g){let u=W.glyphStartIndex+W.numGlyphs,G=W.lineStartIndex,Y=W.lineStartIndex+W.lineLength,y=e.getoffsetX(W.glyphStartIndex),J=e.getoffsetX(u-1),S=ye(m*y,a,c,r,W.segment,G,Y,g,h);if(!S)return null;let L=ye(m*J,a,c,r,W.segment,G,Y,g,h);return L?g.projectionCache.anyProjectionOccluded?null:{first:S,last:L}:null}function Pt(m,e,a,c){return m===o.ay.horizontal&&Math.abs(a.y-e.y)>Math.abs(a.x-e.x)*c?{useVertical:!0}:(m===o.ay.vertical?e.y<a.y:e.x>a.x)?{needsFlipping:!0}:null}function Ga(m){let{projectionContext:e,pitchedLabelPlaneMatrixInverse:a,symbol:c,fontSize:r,flip:W,keepUpright:h,glyphOffsetArray:g,dynamicLayoutVertexArray:u,aspectRatio:G,rotateToLine:Y}=m,y=r/24,J=c.lineOffsetX*y,S=c.lineOffsetY*y,L;if(c.numGlyphs>1){let w=c.glyphStartIndex+c.numGlyphs,v=c.lineStartIndex,O=c.lineStartIndex+c.lineLength,K=xl(y,g,J,S,W,c,Y,e);if(!K)return{notEnoughRoom:!0};let tt=dn(K.first.point.x,K.first.point.y,e,a),_=dn(K.last.point.x,K.last.point.y,e,a);if(h&&!W){let et=Pt(c.writingMode,tt,_,G);if(et)return et}L=[K.first];for(let et=c.glyphStartIndex+1;et<w-1;et++){let it=ye(y*g.getoffsetX(et),J,S,W,c.segment,v,O,e,Y);if(!it)return{notEnoughRoom:!0};L.push(it)}L.push(K.last)}else{if(h&&!W){let v=vi(e.tileAnchorPoint.x,e.tileAnchorPoint.y,e).point,O=c.lineStartIndex+c.segment+1,K=new o.P(e.lineVertexArray.getx(O),e.lineVertexArray.gety(O)),tt=vi(K.x,K.y,e),_=tt.signedDistanceFromCamera>0?tt.point:Cn(e.tileAnchorPoint,K,v,1,e),et=dn(v.x,v.y,e,a),it=dn(_.x,_.y,e,a),q=Pt(c.writingMode,et,it,G);if(q)return q}let w=ye(y*g.getoffsetX(c.glyphStartIndex),J,S,W,c.segment,c.lineStartIndex,c.lineStartIndex+c.lineLength,e,Y);if(!w||e.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};L=[w]}for(let w of L)o.aF(u,w.point,w.angle);return{}}function Cn(m,e,a,c,r){let W=m.add(m.sub(e)._unit()),h=vi(W.x,W.y,r).point,g=a.sub(h);return a.add(g._mult(c/g.mag()))}function Qn(m,e,a){let c=e.projectionCache;if(c.projections[m])return c.projections[m];let r=new o.P(e.lineVertexArray.getx(m),e.lineVertexArray.gety(m)),W=vi(r.x,r.y,e);if(W.signedDistanceFromCamera>0)return c.projections[m]=W.point,c.anyProjectionOccluded=c.anyProjectionOccluded||W.isOccluded,W.point;let h=m-a.direction;return Cn(a.distanceFromAnchor===0?e.tileAnchorPoint:new o.P(e.lineVertexArray.getx(h),e.lineVertexArray.gety(h)),r,a.previousVertex,a.absOffsetX-a.distanceFromAnchor+1,e)}function vi(m,e,a){let c=m+a.translation[0],r=e+a.translation[1],W;return a.pitchWithMap?(W=jt(c,r,a.pitchedLabelPlaneMatrix,a.getElevation),W.isOccluded=!1):(W=a.transform.projectTileCoordinates(c,r,a.unwrappedTileID,a.getElevation),W.point.x=(.5*W.point.x+.5)*a.width,W.point.y=(.5*-W.point.y+.5)*a.height),W}function dn(m,e,a,c){if(a.pitchWithMap){let r=[m,e,0,1];return o.aG(r,r,c),a.transform.projectTileCoordinates(r[0]/r[3],r[1]/r[3],a.unwrappedTileID,a.getElevation).point}return{x:m/a.width*2-1,y:1-e/a.height*2}}function kn(m,e,a){return a.transform.projectTileCoordinates(m,e,a.unwrappedTileID,a.getElevation)}function Ln(m,e,a){return m._unit()._perp()._mult(e*a)}function Ni(m,e,a,c,r,W,h,g,u){if(g.projectionCache.offsets[m])return g.projectionCache.offsets[m];let G=a.add(e);if(m+u.direction<c||m+u.direction>=r)return g.projectionCache.offsets[m]=G,G;let Y=Qn(m+u.direction,g,u),y=Ln(Y.sub(a),h,u.direction),J=a.add(y),S=Y.add(y);return g.projectionCache.offsets[m]=o.aH(W,G,J,S)||G,g.projectionCache.offsets[m]}function ye(m,e,a,c,r,W,h,g,u){let G=c?m-e:m+e,Y=G>0?1:-1,y=0;c&&(Y*=-1,y=Math.PI),Y<0&&(y+=Math.PI);let J,S=Y>0?W+r:W+r+1;g.projectionCache.cachedAnchorPoint?J=g.projectionCache.cachedAnchorPoint:(J=vi(g.tileAnchorPoint.x,g.tileAnchorPoint.y,g).point,g.projectionCache.cachedAnchorPoint=J);let L,w,v=J,O=J,K=0,tt=0,_=Math.abs(G),et=[],it;for(;K+tt<=_;){if(S+=Y,S<W||S>=h)return null;K+=tt,O=v,w=L;let ht={absOffsetX:_,direction:Y,distanceFromAnchor:K,previousVertex:O};if(v=Qn(S,g,ht),a===0)et.push(O),it=v.sub(O);else{let bt,mt=v.sub(O);bt=mt.mag()===0?Ln(Qn(S+Y,g,ht).sub(v),a,Y):Ln(mt,a,Y),w||(w=O.add(bt)),L=Ni(S,bt,v,W,h,w,a,g,ht),et.push(w),it=L.sub(w)}tt=it.mag()}let q=it._mult((_-K)/tt)._add(w||O),ct=y+Math.atan2(v.y-O.y,v.x-O.x);return et.push(q),{point:q,angle:u?ct:0,path:et}}let Bb=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function aa(m,e){for(let a=0;a<m;a++){let c=e.length;e.resize(c+4),e.float32.set(Bb,3*c)}}function Rd(m,e,a){let c=e[0],r=e[1];return m[0]=a[0]*c+a[4]*r+a[12],m[1]=a[1]*c+a[5]*r+a[13],m[3]=a[3]*c+a[7]*r+a[15],m}let De=100;class Aa{constructor(e,a=new Xe(e.width+200,e.height+200,25),c=new Xe(e.width+200,e.height+200,25)){this.transform=e,this.grid=a,this.ignoredGrid=c,this.pitchFactor=Math.cos(e.pitch*Math.PI/180)*e.cameraToCenterDistance,this.screenRightBoundary=e.width+De,this.screenBottomBoundary=e.height+De,this.gridRightBoundary=e.width+200,this.gridBottomBoundary=e.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(e,a,c,r,W,h,g,u,G,Y,y,J){let S=this.projectAndGetPerspectiveRatio(e.anchorPointX+u[0],e.anchorPointY+u[1],W,Y,J),L=c*S.perspectiveRatio,w;if(h||g)w=this._projectCollisionBox(e,L,r,W,h,g,u,S,Y,y,J);else{let it=S.x+(y?y.x*L:0),q=S.y+(y?y.y*L:0);w={allPointsOccluded:!1,box:[it+e.x1*L,q+e.y1*L,it+e.x2*L,q+e.y2*L]}}let[v,O,K,tt]=w.box,_=h?w.allPointsOccluded:S.isOccluded,et=_;return et||(et=S.perspectiveRatio<this.perspectiveRatioCutoff),et||(et=!this.isInsideGrid(v,O,K,tt)),et||a!=="always"&&this.grid.hitTest(v,O,K,tt,a,G)?{box:[v,O,K,tt],placeable:!1,offscreen:!1,occluded:_}:{box:[v,O,K,tt],placeable:!0,offscreen:this.isOffscreen(v,O,K,tt),occluded:_}}placeCollisionCircles(e,a,c,r,W,h,g,u,G,Y,y,J,S,L){let w=[],v=new o.P(a.anchorX,a.anchorY),O=this.getPerspectiveRatio(v.x,v.y,h,L),K=(G?W*this.transform.getPitchedTextCorrection(a.anchorX,a.anchorY,h)/O:W*O)/o.aL,tt={getElevation:L,pitchedLabelPlaneMatrix:g,lineVertexArray:c,pitchWithMap:G,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:this.transform,tileAnchorPoint:v,unwrappedTileID:h,width:this.transform.width,height:this.transform.height,translation:S},_=xl(K,r,a.lineOffsetX*K,a.lineOffsetY*K,!1,a,!1,tt),et=!1,it=!1,q=!0;if(_){let ct=.5*y*O+J,ht=new o.P(-100,-100),bt=new o.P(this.screenRightBoundary,this.screenBottomBoundary),mt=new Mt,Zt=_.first,Jt=_.last,Yt=[];for(let ee=Zt.path.length-1;ee>=1;ee--)Yt.push(Zt.path[ee]);for(let ee=1;ee<Jt.path.length;ee++)Yt.push(Jt.path[ee]);let Gt=2.5*ct;if(G){let ee=this.projectPathToScreenSpace(Yt,tt);Yt=ee.some((te=>te.signedDistanceFromCamera<=0))?[]:ee.map((te=>te.point))}let zt=[];if(Yt.length>0){let ee=Yt[0].clone(),te=Yt[0].clone();for(let Se=1;Se<Yt.length;Se++)ee.x=Math.min(ee.x,Yt[Se].x),ee.y=Math.min(ee.y,Yt[Se].y),te.x=Math.max(te.x,Yt[Se].x),te.y=Math.max(te.y,Yt[Se].y);zt=ee.x>=ht.x&&te.x<=bt.x&&ee.y>=ht.y&&te.y<=bt.y?[Yt]:te.x<ht.x||ee.x>bt.x||te.y<ht.y||ee.y>bt.y?[]:o.aI([Yt],ht.x,ht.y,bt.x,bt.y)}for(let ee of zt){mt.reset(ee,.25*ct);let te=0;te=mt.length<=.5*ct?1:Math.ceil(mt.paddedLength/Gt)+1;for(let Se=0;Se<te;Se++){let Ce=Se/Math.max(te-1,1),fe=mt.lerp(Ce),Ye=fe.x+De,Vl=fe.y+De;w.push(Ye,Vl,ct,0);let we=Ye-ct,ol=Vl-ct,al=Ye+ct,sl=Vl+ct;if(q=q&&this.isOffscreen(we,ol,al,sl),it=it||this.isInsideGrid(we,ol,al,sl),e!=="always"&&this.grid.hitTestCircle(Ye,Vl,ct,e,Y)&&(et=!0,!u))return{circles:[],offscreen:!1,collisionDetected:et}}}}return{circles:!u&&et||!it||O<this.perspectiveRatioCutoff?[]:w,offscreen:q,collisionDetected:et}}projectPathToScreenSpace(e,a){let c=(function(r,W){let h=o.N();return o.aA(h,W.pitchedLabelPlaneMatrix),r.map((g=>{let u=jt(g.x,g.y,h,W.getElevation),G=W.transform.projectTileCoordinates(u.point.x,u.point.y,W.unwrappedTileID,W.getElevation);return G.point.x=(.5*G.point.x+.5)*W.width,G.point.y=(.5*-G.point.y+.5)*W.height,G}))})(e,a);return(function(r){let W=0,h=0,g=0,u=0;for(let G=0;G<r.length;G++)r[G].isOccluded?(g=G+1,u=0):(u++,u>h&&(h=u,W=g));return r.slice(W,W+h)})(c)}queryRenderedSymbols(e){if(e.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};let a=[],c=new o.ab;for(let y of e){let J=new o.P(y.x+De,y.y+De);c.extend(J),a.push(J)}let{minX:r,minY:W,maxX:h,maxY:g}=c,u=this.grid.query(r,W,h,g).concat(this.ignoredGrid.query(r,W,h,g)),G={},Y={};for(let y of u){let J=y.key;if(G[J.bucketInstanceId]===void 0&&(G[J.bucketInstanceId]={}),G[J.bucketInstanceId][J.featureIndex])continue;let S=[new o.P(y.x1,y.y1),new o.P(y.x2,y.y1),new o.P(y.x2,y.y2),new o.P(y.x1,y.y2)];o.aJ(a,S)&&(G[J.bucketInstanceId][J.featureIndex]=!0,Y[J.bucketInstanceId]===void 0&&(Y[J.bucketInstanceId]=[]),Y[J.bucketInstanceId].push(J.featureIndex))}return Y}insertCollisionBox(e,a,c,r,W,h){(c?this.ignoredGrid:this.grid).insert({bucketInstanceId:r,featureIndex:W,collisionGroupID:h,overlapMode:a},e[0],e[1],e[2],e[3])}insertCollisionCircles(e,a,c,r,W,h){let g=c?this.ignoredGrid:this.grid,u={bucketInstanceId:r,featureIndex:W,collisionGroupID:h,overlapMode:a};for(let G=0;G<e.length;G+=4)g.insertCircle(u,e[G],e[G+1],e[G+2])}projectAndGetPerspectiveRatio(e,a,c,r,W){if(W){let h;r?(h=[e,a,r(e,a),1],o.aG(h,h,W)):(h=[e,a,0,1],Rd(h,h,W));let g=h[3];return{x:(h[0]/g+1)/2*this.transform.width+De,y:(-h[1]/g+1)/2*this.transform.height+De,perspectiveRatio:.5+this.transform.cameraToCenterDistance/g*.5,isOccluded:!1,signedDistanceFromCamera:g}}{let h=this.transform.projectTileCoordinates(e,a,c,r);return{x:(h.point.x+1)/2*this.transform.width+De,y:(1-h.point.y)/2*this.transform.height+De,perspectiveRatio:.5+this.transform.cameraToCenterDistance/h.signedDistanceFromCamera*.5,isOccluded:h.isOccluded,signedDistanceFromCamera:h.signedDistanceFromCamera}}}getPerspectiveRatio(e,a,c,r){let W=this.transform.projectTileCoordinates(e,a,c,r);return .5+this.transform.cameraToCenterDistance/W.signedDistanceFromCamera*.5}isOffscreen(e,a,c,r){return c<De||e>=this.screenRightBoundary||r<De||a>this.screenBottomBoundary}isInsideGrid(e,a,c,r){return c>=0&&e<this.gridRightBoundary&&r>=0&&a<this.gridBottomBoundary}getViewportMatrix(){let e=o.ar([]);return o.O(e,e,[-100,-100,0]),e}_projectCollisionBox(e,a,c,r,W,h,g,u,G,Y,y){let J=1,S=0,L=0,w=1,v=e.anchorPointX+g[0],O=e.anchorPointY+g[1];if(h&&!W){let Yt=this.projectAndGetPerspectiveRatio(v+1,O,r,G,y),Gt=Yt.x-u.x,zt=Math.atan((Yt.y-u.y)/Gt)+(Gt<0?Math.PI:0),ee=Math.sin(zt),te=Math.cos(zt);J=te,S=ee,L=-ee,w=te}else if(!h&&W){let Yt=xt(this.transform);J=Yt.vecEast[0],S=Yt.vecEast[1],L=Yt.vecSouth[0],w=Yt.vecSouth[1]}let K=u.x,tt=u.y,_=a;W&&(K=v,tt=O,_=Math.pow(2,-(this.transform.zoom-c.overscaledZ)),_*=this.transform.getPitchedTextCorrection(v,O,r),Y||(_*=o.an(.5+u.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))),Y&&(K+=J*Y.x*_+L*Y.y*_,tt+=S*Y.x*_+w*Y.y*_);let et=e.x1*_,it=e.x2*_,q=(et+it)/2,ct=e.y1*_,ht=e.y2*_,bt=(ct+ht)/2,mt=[{offsetX:et,offsetY:ct},{offsetX:q,offsetY:ct},{offsetX:it,offsetY:ct},{offsetX:it,offsetY:bt},{offsetX:it,offsetY:ht},{offsetX:q,offsetY:ht},{offsetX:et,offsetY:ht},{offsetX:et,offsetY:bt}],Zt=[];for(let{offsetX:Yt,offsetY:Gt}of mt)Zt.push(new o.P(K+J*Yt+L*Gt,tt+S*Yt+w*Gt));let Jt=!1;if(W){let Yt=Zt.map((Gt=>this.projectAndGetPerspectiveRatio(Gt.x,Gt.y,r,G,y)));Jt=Yt.some((Gt=>!Gt.isOccluded)),Zt=Yt.map((Gt=>new o.P(Gt.x,Gt.y)))}else Jt=!0;return{box:o.aK(Zt),allPointsOccluded:!Jt}}}class jo{constructor(e,a,c,r){this.opacity=e?Math.max(0,Math.min(1,e.opacity+(e.placed?a:-a))):r&&c?1:0,this.placed=c}isHidden(){return this.opacity===0&&!this.placed}}class En{constructor(e,a,c,r,W){this.text=new jo(e?e.text:null,a,c,W),this.icon=new jo(e?e.icon:null,a,r,W)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Ao{constructor(e,a,c){this.text=e,this.icon=a,this.skipFade=c}}class zn{constructor(e,a,c,r,W){this.bucketInstanceId=e,this.featureIndex=a,this.sourceLayerIndex=c,this.bucketIndex=r,this.tileID=W}}class Mr{constructor(e){this.crossSourceCollisions=e,this.maxGroupID=0,this.collisionGroups={}}get(e){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[e]){let a=++this.maxGroupID;this.collisionGroups[e]={ID:a,predicate:c=>c.collisionGroupID===a}}return this.collisionGroups[e]}}function Yr(m,e,a,c,r){let{horizontalAlign:W,verticalAlign:h}=o.aR(m);return new o.P(-(W-.5)*e+c[0]*r,-(h-.5)*a+c[1]*r)}class Sb{constructor(e,a,c,r,W){this.transform=e.clone(),this.terrain=a,this.collisionIndex=new Aa(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=c,this.retainedQueryData={},this.collisionGroups=new Mr(r),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=W,W&&(W.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(e){let a=this.terrain;return a?(c,r)=>a.getElevation(e,c,r):null}getBucketParts(e,a,c,r){let W=c.getBucket(a),h=c.latestFeatureIndex;if(!W||!h||a.id!==W.layerIds[0])return;let g=c.collisionBoxArray,u=W.layers[0].layout,G=W.layers[0].paint,Y=Math.pow(2,this.transform.zoom-c.tileID.overscaledZ),y=c.tileSize/o.a4,J=c.tileID.toUnwrapped(),S=u.get("text-rotation-alignment")==="map",L=o.aM(c,1,this.transform.zoom),w=o.aN(this.collisionIndex.transform,c,G.get("text-translate"),G.get("text-translate-anchor")),v=o.aN(this.collisionIndex.transform,c,G.get("icon-translate"),G.get("icon-translate-anchor")),O=Wl(S,this.transform,L);this.retainedQueryData[W.bucketInstanceId]=new zn(W.bucketInstanceId,h,W.sourceLayerIndex,W.index,c.tileID);let K={bucket:W,layout:u,translationText:w,translationIcon:v,unwrappedTileID:J,pitchedLabelPlaneMatrix:O,scale:Y,textPixelRatio:y,holdingForFade:c.holdingForSymbolFade(),collisionBoxArray:g,partiallyEvaluatedTextSize:o.ax(W.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(W.sourceID)};if(r)for(let tt of W.sortKeyRanges){let{sortKey:_,symbolInstanceStart:et,symbolInstanceEnd:it}=tt;e.push({sortKey:_,symbolInstanceStart:et,symbolInstanceEnd:it,parameters:K})}else e.push({symbolInstanceStart:0,symbolInstanceEnd:W.symbolInstances.length,parameters:K})}attemptAnchorPlacement(e,a,c,r,W,h,g,u,G,Y,y,J,S,L,w,v,O,K,tt,_){let et=o.aO[e.textAnchor],it=[e.textOffset0,e.textOffset1],q=Yr(et,c,r,it,W),ct=this.collisionIndex.placeCollisionBox(a,J,u,G,Y,g,h,v,y.predicate,tt,q,_);if((!K||this.collisionIndex.placeCollisionBox(K,J,u,G,Y,g,h,O,y.predicate,tt,q,_).placeable)&&ct.placeable){let ht;if(this.prevPlacement&&this.prevPlacement.variableOffsets[S.crossTileID]&&this.prevPlacement.placements[S.crossTileID]&&this.prevPlacement.placements[S.crossTileID].text&&(ht=this.prevPlacement.variableOffsets[S.crossTileID].anchor),S.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[S.crossTileID]={textOffset:it,width:c,height:r,anchor:et,textBoxScale:W,prevAnchor:ht},this.markUsedJustification(L,et,S,w),L.allowVerticalPlacement&&(this.markUsedOrientation(L,w,S),this.placedOrientations[S.crossTileID]=w),{shift:q,placedGlyphBoxes:ct}}}placeLayerBucketPart(e,a,c){let{bucket:r,layout:W,translationText:h,translationIcon:g,unwrappedTileID:u,pitchedLabelPlaneMatrix:G,textPixelRatio:Y,holdingForFade:y,collisionBoxArray:J,partiallyEvaluatedTextSize:S,collisionGroup:L}=e.parameters,w=W.get("text-optional"),v=W.get("icon-optional"),O=o.aP(W,"text-overlap","text-allow-overlap"),K=O==="always",tt=o.aP(W,"icon-overlap","icon-allow-overlap"),_=tt==="always",et=W.get("text-rotation-alignment")==="map",it=W.get("text-pitch-alignment")==="map",q=W.get("icon-text-fit")!=="none",ct=W.get("symbol-z-order")==="viewport-y",ht=K&&(_||!r.hasIconData()||v),bt=_&&(K||!r.hasTextData()||w);!r.collisionArrays&&J&&r.deserializeCollisionBoxes(J);let mt=this.retainedQueryData[r.bucketInstanceId].tileID,Zt=this._getTerrainElevationFunc(mt),Jt=this.transform.getFastPathSimpleProjectionMatrix(mt),Yt=(Gt,zt,ee)=>{var te,Se;if(a[Gt.crossTileID])return;if(y)return void(this.placements[Gt.crossTileID]=new Ao(!1,!1,!1));let Ce=!1,fe=!1,Ye=!0,Vl=null,we={box:null,placeable:!1,offscreen:null,occluded:!1},ol={placeable:!1},al=null,sl=null,hi=null,Ya=0,ra=0,Ka=0;zt.textFeatureIndex?Ya=zt.textFeatureIndex:Gt.useRuntimeCollisionCircles&&(Ya=Gt.featureIndex),zt.verticalTextFeatureIndex&&(ra=zt.verticalTextFeatureIndex);let Pa=zt.textBox;if(Pa){let Ii=$e=>{let _e=o.ay.horizontal;if(r.allowVerticalPlacement&&!$e&&this.prevPlacement){let pl=this.prevPlacement.placedOrientations[Gt.crossTileID];pl&&(this.placedOrientations[Gt.crossTileID]=pl,_e=pl,this.markUsedOrientation(r,_e,Gt))}return _e},Ta=($e,_e)=>{if(r.allowVerticalPlacement&&Gt.numVerticalGlyphVertices>0&&zt.verticalTextBox){for(let pl of r.writingModes)if(pl===o.ay.vertical?(we=_e(),ol=we):we=$e(),we&&we.placeable)break}else we=$e()},Fn=Gt.textAnchorOffsetStartIndex,Gn=Gt.textAnchorOffsetEndIndex;if(Gn===Fn){let $e=(_e,pl)=>{let xe=this.collisionIndex.placeCollisionBox(_e,O,Y,mt,u,it,et,h,L.predicate,Zt,void 0,Jt);return xe&&xe.placeable&&(this.markUsedOrientation(r,pl,Gt),this.placedOrientations[Gt.crossTileID]=pl),xe};Ta((()=>$e(Pa,o.ay.horizontal)),(()=>{let _e=zt.verticalTextBox;return r.allowVerticalPlacement&&Gt.numVerticalGlyphVertices>0&&_e?$e(_e,o.ay.vertical):{box:null,offscreen:null}})),Ii(we&&we.placeable)}else{let $e=o.aO[(Se=(te=this.prevPlacement)===null||te===void 0?void 0:te.variableOffsets[Gt.crossTileID])===null||Se===void 0?void 0:Se.anchor],_e=(xe,qa,Y0)=>{let x0=xe.x2-xe.x1,T0=xe.y2-xe.y1,Nn=Gt.textBoxScale,am=q&&tt==="never"?qa:null,$a=null,io=O==="never"?1:2,ks="never";$e&&io++;for(let tn=0;tn<io;tn++){for(let Xa=Fn;Xa<Gn;Xa++){let Ls=r.textAnchorOffsets.get(Xa);if($e&&Ls.textAnchor!==$e)continue;let Es=this.attemptAnchorPlacement(Ls,xe,x0,T0,Nn,et,it,Y,mt,u,L,ks,Gt,r,Y0,h,g,am,Zt);if(Es&&($a=Es.placedGlyphBoxes,$a&&$a.placeable))return Ce=!0,Vl=Es.shift,$a}$e?$e=null:ks=O}return c&&!$a&&($a={box:this.collisionIndex.placeCollisionBox(Pa,"always",Y,mt,u,it,et,h,L.predicate,Zt,void 0,Jt).box,offscreen:!1,placeable:!1,occluded:!1}),$a};Ta((()=>_e(Pa,zt.iconBox,o.ay.horizontal)),(()=>{let xe=zt.verticalTextBox;return r.allowVerticalPlacement&&(!we||!we.placeable)&&Gt.numVerticalGlyphVertices>0&&xe?_e(xe,zt.verticalIconBox,o.ay.vertical):{box:null,occluded:!0,offscreen:null}})),we&&(Ce=we.placeable,Ye=we.offscreen);let pl=Ii(we&&we.placeable);if(!Ce&&this.prevPlacement){let xe=this.prevPlacement.variableOffsets[Gt.crossTileID];xe&&(this.variableOffsets[Gt.crossTileID]=xe,this.markUsedJustification(r,xe.anchor,Gt,pl))}}}if(al=we,Ce=al&&al.placeable,Ye=al&&al.offscreen,Gt.useRuntimeCollisionCircles&&Gt.centerJustifiedTextSymbolIndex>=0){let Ii=r.text.placedSymbolArray.get(Gt.centerJustifiedTextSymbolIndex),Ta=o.az(r.textSizeData,S,Ii),Fn=W.get("text-padding");sl=this.collisionIndex.placeCollisionCircles(O,Ii,r.lineVertexArray,r.glyphOffsetArray,Ta,u,G,c,it,L.predicate,Gt.collisionCircleDiameter,Fn,h,Zt),sl.circles.length&&sl.collisionDetected&&!c&&o.w("Collisions detected, but collision boxes are not shown"),Ce=K||sl.circles.length>0&&!sl.collisionDetected,Ye=Ye&&sl.offscreen}if(zt.iconFeatureIndex&&(Ka=zt.iconFeatureIndex),zt.iconBox){let Ii=Ta=>this.collisionIndex.placeCollisionBox(Ta,tt,Y,mt,u,it,et,g,L.predicate,Zt,q&&Vl?Vl:void 0,Jt);ol&&ol.placeable&&zt.verticalIconBox?(hi=Ii(zt.verticalIconBox),fe=hi.placeable):(hi=Ii(zt.iconBox),fe=hi.placeable),Ye=Ye&&hi.offscreen}let un=w||Gt.numHorizontalGlyphVertices===0&&Gt.numVerticalGlyphVertices===0,Qi=v||Gt.numIconVertices===0;un||Qi?Qi?un||(fe=fe&&Ce):Ce=fe&&Ce:fe=Ce=fe&&Ce;let xa=fe&&hi.placeable;if(Ce&&al.placeable&&this.collisionIndex.insertCollisionBox(al.box,O,W.get("text-ignore-placement"),r.bucketInstanceId,ol&&ol.placeable&&ra?ra:Ya,L.ID),xa&&this.collisionIndex.insertCollisionBox(hi.box,tt,W.get("icon-ignore-placement"),r.bucketInstanceId,Ka,L.ID),sl&&Ce&&this.collisionIndex.insertCollisionCircles(sl.circles,O,W.get("text-ignore-placement"),r.bucketInstanceId,Ya,L.ID),c&&this.storeCollisionData(r.bucketInstanceId,ee,zt,al,hi,sl),Gt.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(r.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[Gt.crossTileID]=new Ao((Ce||ht)&&!al?.occluded,(fe||bt)&&!hi?.occluded,Ye||r.justReloaded),a[Gt.crossTileID]=!0};if(ct){if(e.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");let Gt=r.getSortedSymbolIndexes(-this.transform.bearingInRadians);for(let zt=Gt.length-1;zt>=0;--zt){let ee=Gt[zt];Yt(r.symbolInstances.get(ee),r.collisionArrays[ee],ee)}}else for(let Gt=e.symbolInstanceStart;Gt<e.symbolInstanceEnd;Gt++)Yt(r.symbolInstances.get(Gt),r.collisionArrays[Gt],Gt);r.justReloaded=!1}storeCollisionData(e,a,c,r,W,h){if(c.textBox||c.iconBox){let g,u;this.collisionBoxArrays.has(e)?g=this.collisionBoxArrays.get(e):(g=new Map,this.collisionBoxArrays.set(e,g)),g.has(a)?u=g.get(a):(u={text:null,icon:null},g.set(a,u)),c.textBox&&(u.text=r.box),c.iconBox&&(u.icon=W.box)}if(h){let g=this.collisionCircleArrays[e];g===void 0&&(g=this.collisionCircleArrays[e]=[]);for(let u=0;u<h.circles.length;u+=4)g.push(h.circles[u+0]-De),g.push(h.circles[u+1]-De),g.push(h.circles[u+2]),g.push(h.collisionDetected?1:0)}}markUsedJustification(e,a,c,r){let W;W=r===o.ay.vertical?c.verticalPlacedTextSymbolIndex:{left:c.leftJustifiedTextSymbolIndex,center:c.centerJustifiedTextSymbolIndex,right:c.rightJustifiedTextSymbolIndex}[o.aQ(a)];let h=[c.leftJustifiedTextSymbolIndex,c.centerJustifiedTextSymbolIndex,c.rightJustifiedTextSymbolIndex,c.verticalPlacedTextSymbolIndex];for(let g of h)g>=0&&(e.text.placedSymbolArray.get(g).crossTileID=W>=0&&g!==W?0:c.crossTileID)}markUsedOrientation(e,a,c){let r=a===o.ay.horizontal||a===o.ay.horizontalOnly?a:0,W=a===o.ay.vertical?a:0,h=[c.leftJustifiedTextSymbolIndex,c.centerJustifiedTextSymbolIndex,c.rightJustifiedTextSymbolIndex];for(let g of h)e.text.placedSymbolArray.get(g).placedOrientation=r;c.verticalPlacedTextSymbolIndex&&(e.text.placedSymbolArray.get(c.verticalPlacedTextSymbolIndex).placedOrientation=W)}commit(e){this.commitTime=e,this.zoomAtLastRecencyCheck=this.transform.zoom;let a=this.prevPlacement,c=!1;this.prevZoomAdjustment=a?a.zoomAdjustment(this.transform.zoom):0;let r=a?a.symbolFadeChange(e):1,W=a?a.opacities:{},h=a?a.variableOffsets:{},g=a?a.placedOrientations:{};for(let u in this.placements){let G=this.placements[u],Y=W[u];Y?(this.opacities[u]=new En(Y,r,G.text,G.icon),c=c||G.text!==Y.text.placed||G.icon!==Y.icon.placed):(this.opacities[u]=new En(null,r,G.text,G.icon,G.skipFade),c=c||G.text||G.icon)}for(let u in W){let G=W[u];if(!this.opacities[u]){let Y=new En(G,r,!1,!1);Y.isHidden()||(this.opacities[u]=Y,c=c||G.text.placed||G.icon.placed)}}for(let u in h)this.variableOffsets[u]||!this.opacities[u]||this.opacities[u].isHidden()||(this.variableOffsets[u]=h[u]);for(let u in g)this.placedOrientations[u]||!this.opacities[u]||this.opacities[u].isHidden()||(this.placedOrientations[u]=g[u]);if(a&&a.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");c?this.lastPlacementChangeTime=e:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=a?a.lastPlacementChangeTime:e)}updateLayerOpacities(e,a){let c={};for(let r of a){let W=r.getBucket(e);W&&r.latestFeatureIndex&&e.id===W.layerIds[0]&&this.updateBucketOpacities(W,r.tileID,c,r.collisionBoxArray)}}updateBucketOpacities(e,a,c,r){e.hasTextData()&&(e.text.opacityVertexArray.clear(),e.text.hasVisibleVertices=!1),e.hasIconData()&&(e.icon.opacityVertexArray.clear(),e.icon.hasVisibleVertices=!1),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexArray.clear(),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexArray.clear();let W=e.layers[0],h=W.layout,g=new En(null,0,!1,!1,!0),u=h.get("text-allow-overlap"),G=h.get("icon-allow-overlap"),Y=W._unevaluatedLayout.hasValue("text-variable-anchor")||W._unevaluatedLayout.hasValue("text-variable-anchor-offset"),y=h.get("text-rotation-alignment")==="map",J=h.get("text-pitch-alignment")==="map",S=h.get("icon-text-fit")!=="none",L=new En(null,0,u&&(G||!e.hasIconData()||h.get("icon-optional")),G&&(u||!e.hasTextData()||h.get("text-optional")),!0);!e.collisionArrays&&r&&(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData())&&e.deserializeCollisionBoxes(r);let w=(O,K,tt)=>{for(let _=0;_<K/4;_++)O.opacityVertexArray.emplaceBack(tt);O.hasVisibleVertices=O.hasVisibleVertices||tt!==Na},v=this.collisionBoxArrays.get(e.bucketInstanceId);for(let O=0;O<e.symbolInstances.length;O++){let K=e.symbolInstances.get(O),{numHorizontalGlyphVertices:tt,numVerticalGlyphVertices:_,crossTileID:et}=K,it=this.opacities[et];c[et]?it=g:it||(it=L,this.opacities[et]=it),c[et]=!0;let q=K.numIconVertices>0,ct=this.placedOrientations[K.crossTileID],ht=ct===o.ay.vertical,bt=ct===o.ay.horizontal||ct===o.ay.horizontalOnly;if(tt>0||_>0){let Zt=yr(it.text);w(e.text,tt,ht?Na:Zt),w(e.text,_,bt?Na:Zt);let Jt=it.text.isHidden();[K.rightJustifiedTextSymbolIndex,K.centerJustifiedTextSymbolIndex,K.leftJustifiedTextSymbolIndex].forEach((zt=>{zt>=0&&(e.text.placedSymbolArray.get(zt).hidden=Jt||ht?1:0)})),K.verticalPlacedTextSymbolIndex>=0&&(e.text.placedSymbolArray.get(K.verticalPlacedTextSymbolIndex).hidden=Jt||bt?1:0);let Yt=this.variableOffsets[K.crossTileID];Yt&&this.markUsedJustification(e,Yt.anchor,K,ct);let Gt=this.placedOrientations[K.crossTileID];Gt&&(this.markUsedJustification(e,"left",K,Gt),this.markUsedOrientation(e,Gt,K))}if(q){let Zt=yr(it.icon),Jt=!(S&&K.verticalPlacedIconSymbolIndex&&ht);K.placedIconSymbolIndex>=0&&(w(e.icon,K.numIconVertices,Jt?Zt:Na),e.icon.placedSymbolArray.get(K.placedIconSymbolIndex).hidden=it.icon.isHidden()),K.verticalPlacedIconSymbolIndex>=0&&(w(e.icon,K.numVerticalIconVertices,Jt?Na:Zt),e.icon.placedSymbolArray.get(K.verticalPlacedIconSymbolIndex).hidden=it.icon.isHidden())}let mt=v&&v.has(O)?v.get(O):{text:null,icon:null};if(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData()){let Zt=e.collisionArrays[O];if(Zt){let Jt=new o.P(0,0);if(Zt.textBox||Zt.verticalTextBox){let Yt=!0;if(Y){let Gt=this.variableOffsets[et];Gt?(Jt=Yr(Gt.anchor,Gt.width,Gt.height,Gt.textOffset,Gt.textBoxScale),y&&Jt._rotate(J?-this.transform.bearingInRadians:this.transform.bearingInRadians)):Yt=!1}if(Zt.textBox||Zt.verticalTextBox){let Gt;Zt.textBox&&(Gt=ht),Zt.verticalTextBox&&(Gt=bt),xr(e.textCollisionBox.collisionVertexArray,it.text.placed,!Yt||Gt,mt.text,Jt.x,Jt.y)}}if(Zt.iconBox||Zt.verticalIconBox){let Yt=!!(!bt&&Zt.verticalIconBox),Gt;Zt.iconBox&&(Gt=Yt),Zt.verticalIconBox&&(Gt=!Yt),xr(e.iconCollisionBox.collisionVertexArray,it.icon.placed,Gt,mt.icon,S?Jt.x:0,S?Jt.y:0)}}}}if(e.sortFeatures(-this.transform.bearingInRadians),this.retainedQueryData[e.bucketInstanceId]&&(this.retainedQueryData[e.bucketInstanceId].featureSortOrder=e.featureSortOrder),e.hasTextData()&&e.text.opacityVertexBuffer&&e.text.opacityVertexBuffer.updateData(e.text.opacityVertexArray),e.hasIconData()&&e.icon.opacityVertexBuffer&&e.icon.opacityVertexBuffer.updateData(e.icon.opacityVertexArray),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexBuffer&&e.iconCollisionBox.collisionVertexBuffer.updateData(e.iconCollisionBox.collisionVertexArray),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexBuffer&&e.textCollisionBox.collisionVertexBuffer.updateData(e.textCollisionBox.collisionVertexArray),e.text.opacityVertexArray.length!==e.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${e.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${e.text.layoutVertexArray.length}) / 4`);if(e.icon.opacityVertexArray.length!==e.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${e.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${e.icon.layoutVertexArray.length}) / 4`);e.bucketInstanceId in this.collisionCircleArrays&&(e.collisionCircleArray=this.collisionCircleArrays[e.bucketInstanceId],delete this.collisionCircleArrays[e.bucketInstanceId])}symbolFadeChange(e){return this.fadeDuration===0?1:(e-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(e){return Math.max(0,(this.transform.zoom-e)/1.5)}hasTransitions(e){return this.stale||e-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(e,a){let c=this.zoomAtLastRecencyCheck===a?1-this.zoomAdjustment(a):1;return this.zoomAtLastRecencyCheck=a,this.commitTime+this.fadeDuration*c>e}setStale(){this.stale=!0}}function xr(m,e,a,c,r,W){c&&c.length!==0||(c=[0,0,0,0]);let h=c[0]-De,g=c[1]-De,u=c[2]-De,G=c[3]-De;m.emplaceBack(e?1:0,a?1:0,r||0,W||0,h,g),m.emplaceBack(e?1:0,a?1:0,r||0,W||0,u,g),m.emplaceBack(e?1:0,a?1:0,r||0,W||0,u,G),m.emplaceBack(e?1:0,a?1:0,r||0,W||0,h,G)}let Tr=Math.pow(2,25),Xr=Math.pow(2,24),wo=Math.pow(2,17),vo=Math.pow(2,16),Jr=Math.pow(2,9),Ho=Math.pow(2,8),Do=Math.pow(2,1);function yr(m){if(m.opacity===0&&!m.placed)return 0;if(m.opacity===1&&m.placed)return 4294967295;let e=m.placed?1:0,a=Math.floor(127*m.opacity);return a*Tr+e*Xr+a*wo+e*vo+a*Jr+e*Ho+a*Do+e}let Na=0;class Fc{constructor(e){this._sortAcrossTiles=e.layout.get("symbol-z-order")!=="viewport-y"&&!e.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(e,a,c,r,W){let h=this._bucketParts;for(;this._currentTileIndex<e.length;)if(a.getBucketParts(h,r,e[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,W())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,h.sort(((g,u)=>g.sortKey-u.sortKey)));this._currentPartIndex<h.length;)if(a.placeLayerBucketPart(h[this._currentPartIndex],this._seenCrossTileIDs,c),this._currentPartIndex++,W())return!0;return!1}}class Br{constructor(e,a,c,r,W,h,g,u){this.placement=new Sb(e,a,h,g,u),this._currentPlacementIndex=c.length-1,this._forceFullPlacement=r,this._showCollisionBoxes=W,this._done=!1}isDone(){return this._done}continuePlacement(e,a,c){let r=Ct(),W=()=>!this._forceFullPlacement&&Ct()-r>2;for(;this._currentPlacementIndex>=0;){let h=a[e[this._currentPlacementIndex]],g=this.placement.collisionIndex.transform.zoom;if(h.type==="symbol"&&(!h.minzoom||h.minzoom<=g)&&(!h.maxzoom||h.maxzoom>g)){if(this._inProgressLayer||(this._inProgressLayer=new Fc(h)),this._inProgressLayer.continuePlacement(c[h.source],this.placement,this._showCollisionBoxes,h,W))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(e){return this.placement.commit(e),this.placement}}let na=512/o.a4/2;class Sr{constructor(e,a,c){this.tileID=e,this.bucketInstanceId=c,this._symbolsByKey={};let r=new Map;for(let W=0;W<a.length;W++){let h=a.get(W),g=h.key,u=r.get(g);u?u.push(h):r.set(g,[h])}for(let[W,h]of r){let g={positions:h.map((u=>({x:Math.floor(u.anchorX*na),y:Math.floor(u.anchorY*na)}))),crossTileIDs:h.map((u=>u.crossTileID))};if(g.positions.length>128){let u=new o.aS(g.positions.length,16,Uint16Array);for(let{x:G,y:Y}of g.positions)u.add(G,Y);u.finish(),delete g.positions,g.index=u}this._symbolsByKey[W]=g}}getScaledCoordinates(e,a){let{x:c,y:r,z:W}=this.tileID.canonical,{x:h,y:g,z:u}=a.canonical,G=na/Math.pow(2,u-W),Y=(g*o.a4+e.anchorY)*G,y=r*o.a4*na;return{x:Math.floor((h*o.a4+e.anchorX)*G-c*o.a4*na),y:Math.floor(Y-y)}}findMatches(e,a,c){let r=this.tileID.canonical.z<a.canonical.z?1:Math.pow(2,this.tileID.canonical.z-a.canonical.z);for(let W=0;W<e.length;W++){let h=e.get(W);if(h.crossTileID)continue;let g=this._symbolsByKey[h.key];if(!g)continue;let u=this.getScaledCoordinates(h,a);if(g.index){let G=g.index.range(u.x-r,u.y-r,u.x+r,u.y+r).sort();for(let Y of G){let y=g.crossTileIDs[Y];if(!c[y]){c[y]=!0,h.crossTileID=y;break}}}else if(g.positions)for(let G=0;G<g.positions.length;G++){let Y=g.positions[G],y=g.crossTileIDs[G];if(Math.abs(Y.x-u.x)<=r&&Math.abs(Y.y-u.y)<=r&&!c[y]){c[y]=!0,h.crossTileID=y;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map((({crossTileIDs:e})=>e))}}class Cb{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class wa{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(e){let a=Math.round((e-this.lng)/360);if(a!==0)for(let c in this.indexes){let r=this.indexes[c],W={};for(let h in r){let g=r[h];g.tileID=g.tileID.unwrapTo(g.tileID.wrap+a),W[g.tileID.key]=g}this.indexes[c]=W}this.lng=e}addBucket(e,a,c){if(this.indexes[e.overscaledZ]&&this.indexes[e.overscaledZ][e.key]){if(this.indexes[e.overscaledZ][e.key].bucketInstanceId===a.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(e.overscaledZ,this.indexes[e.overscaledZ][e.key])}for(let W=0;W<a.symbolInstances.length;W++)a.symbolInstances.get(W).crossTileID=0;this.usedCrossTileIDs[e.overscaledZ]||(this.usedCrossTileIDs[e.overscaledZ]={});let r=this.usedCrossTileIDs[e.overscaledZ];for(let W in this.indexes){let h=this.indexes[W];if(Number(W)>e.overscaledZ)for(let g in h){let u=h[g];u.tileID.isChildOf(e)&&u.findMatches(a.symbolInstances,e,r)}else{let g=h[e.scaledTo(Number(W)).key];g&&g.findMatches(a.symbolInstances,e,r)}}for(let W=0;W<a.symbolInstances.length;W++){let h=a.symbolInstances.get(W);h.crossTileID||(h.crossTileID=c.generate(),r[h.crossTileID]=!0)}return this.indexes[e.overscaledZ]===void 0&&(this.indexes[e.overscaledZ]={}),this.indexes[e.overscaledZ][e.key]=new Sr(e,a.symbolInstances,a.bucketInstanceId),!0}removeBucketCrossTileIDs(e,a){for(let c of a.getCrossTileIDsLists())for(let r of c)delete this.usedCrossTileIDs[e][r]}removeStaleBuckets(e){let a=!1;for(let c in this.indexes){let r=this.indexes[c];for(let W in r)e[r[W].bucketInstanceId]||(this.removeBucketCrossTileIDs(c,r[W]),delete r[W],a=!0)}return a}}class cn{constructor(){this.layerIndexes={},this.crossTileIDs=new Cb,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(e,a,c){let r=this.layerIndexes[e.id];r===void 0&&(r=this.layerIndexes[e.id]=new wa);let W=!1,h={};r.handleWrapJump(c);for(let g of a){let u=g.getBucket(e);u&&e.id===u.layerIds[0]&&(u.bucketInstanceId||(u.bucketInstanceId=++this.maxBucketInstanceId),r.addBucket(g.tileID,u,this.crossTileIDs)&&(W=!0),h[u.bucketInstanceId]=!0)}return r.removeStaleBuckets(h)&&(W=!0),W}pruneUnusedLayers(e){let a={};e.forEach((c=>{a[c]=!0}));for(let c in this.layerIndexes)a[c]||delete this.layerIndexes[c]}}var me="void main() {fragColor=vec4(1.0);}";let yi={prelude:he(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
out highp vec4 fragColor;`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}mat3 rotationMatrixFromAxisAngle(vec3 u,float angle) {float c=cos(angle);float s=sin(angle);float c2=1.0-c;return mat3(u.x*u.x*c2+      c,u.x*u.y*c2-u.z*s,u.x*u.z*c2+u.y*s,u.y*u.x*c2+u.z*s,u.y*u.y*c2+    c,u.y*u.z*c2-u.x*s,u.z*u.x*c2-u.y*s,u.z*u.y*c2+u.x*s,u.z*u.z*c2+    c
);}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
#ifdef GLOBE
if ((pos.y <-32767.5) || (pos.y > 32766.5)) {return 0.0;}
#endif
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}const float PI=3.141592653589793;uniform mat4 u_projection_matrix;`),projectionMercator:he("","float projectLineThickness(float tileY) {return 1.0;}float projectCircleRadius(float tileY) {return 1.0;}vec4 projectTile(vec2 p) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);return result;}vec4 projectTile(vec2 p,vec2 rawPos) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);if (rawPos.y <-32767.5 || rawPos.y > 32766.5) {result.z=-10000000.0;}return result;}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_projection_matrix*vec4(posInTile,elevation,1.0);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {return projectTileWithElevation(posInTile,elevation);}"),projectionGlobe:he("",`#define GLOBE_RADIUS 6371008.8
uniform highp vec4 u_projection_tile_mercator_coords;uniform highp vec4 u_projection_clipping_plane;uniform highp float u_projection_transition;uniform mat4 u_projection_fallback_matrix;vec3 globeRotateVector(vec3 vec,vec2 angles) {vec3 axisRight=vec3(vec.z,0.0,-vec.x);vec3 axisUp=cross(axisRight,vec);axisRight=normalize(axisRight);axisUp=normalize(axisUp);vec2 t=tan(angles);return normalize(vec+axisRight*t.x+axisUp*t.y);}mat3 globeGetRotationMatrix(vec3 spherePos) {vec3 axisRight=vec3(spherePos.z,0.0,-spherePos.x);vec3 axisDown=cross(axisRight,spherePos);axisRight=normalize(axisRight);axisDown=normalize(axisDown);return mat3(axisRight,axisDown,spherePos
);}float circumferenceRatioAtTileY(float tileY) {float mercator_pos_y=u_projection_tile_mercator_coords.y+u_projection_tile_mercator_coords.w*tileY;float spherical_y=2.0*atan(exp(PI-(mercator_pos_y*PI*2.0)))-PI*0.5;return cos(spherical_y);}float projectLineThickness(float tileY) {float thickness=1.0/circumferenceRatioAtTileY(tileY); 
if (u_projection_transition < 0.999) {return mix(1.0,thickness,u_projection_transition);} else {return thickness;}}vec3 projectToSphere(vec2 translatedPos,vec2 rawPos) {vec2 mercator_pos=u_projection_tile_mercator_coords.xy+u_projection_tile_mercator_coords.zw*translatedPos;vec2 spherical;spherical.x=mercator_pos.x*PI*2.0+PI;spherical.y=2.0*atan(exp(PI-(mercator_pos.y*PI*2.0)))-PI*0.5;float len=cos(spherical.y);vec3 pos=vec3(sin(spherical.x)*len,sin(spherical.y),cos(spherical.x)*len
);if (rawPos.y <-32767.5) {pos=vec3(0.0,1.0,0.0);}if (rawPos.y > 32766.5) {pos=vec3(0.0,-1.0,0.0);}return pos;}vec3 projectToSphere(vec2 posInTile) {return projectToSphere(posInTile,vec2(0.0,0.0));}float globeComputeClippingZ(vec3 spherePos) {return (1.0-(dot(spherePos,u_projection_clipping_plane.xyz)+u_projection_clipping_plane.w));}vec4 interpolateProjection(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);globePosition.z=globeComputeClippingZ(elevatedPos)*globePosition.w;if (u_projection_transition > 0.999) {return globePosition;}vec4 flatPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);const float z_globeness_threshold=0.2;vec4 result=globePosition;result.z=mix(0.0,globePosition.z,clamp((u_projection_transition-z_globeness_threshold)/(1.0-z_globeness_threshold),0.0,1.0));result.xyw=mix(flatPosition.xyw,globePosition.xyw,u_projection_transition);if ((posInTile.y <-32767.5) || (posInTile.y > 32766.5)) {result=globePosition;const float poles_hidden_anim_percentage=0.02;result.z=mix(globePosition.z,100.0,pow(max((1.0-u_projection_transition)/poles_hidden_anim_percentage,0.0),8.0));}return result;}vec4 interpolateProjectionFor3D(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);if (u_projection_transition > 0.999) {return globePosition;}vec4 fallbackPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);return mix(fallbackPosition,globePosition,u_projection_transition);}vec4 projectTile(vec2 posInTile) {return interpolateProjection(posInTile,projectToSphere(posInTile),0.0);}vec4 projectTile(vec2 posInTile,vec2 rawPos) {return interpolateProjection(posInTile,projectToSphere(posInTile,rawPos),0.0);}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return interpolateProjection(posInTile,projectToSphere(posInTile),elevation);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {vec3 spherePos=projectToSphere(posInTile,posInTile);return interpolateProjectionFor3D(posInTile,spherePos,elevation);}`),background:he(`uniform vec4 u_color;uniform float u_opacity;void main() {fragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),backgroundPattern:he(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;void main() {gl_Position=projectTile(a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:he(`in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);float antialiased_blur=v_data.z;float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));fragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);const float epsilon=0.5/255.0;if (fragColor.r < epsilon && fragColor.g < epsilon && fragColor.b < epsilon && fragColor.a < epsilon) {discard;}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform highp float u_globe_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;uniform vec2 u_translate;in vec2 a_pos;out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 pos_raw=a_pos+32768.0;vec2 extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);vec2 circle_center=floor(pos_raw/8.0)+u_translate;float ele=get_elevation(circle_center);v_visibility=calculate_visibility(projectTileWithElevation(circle_center,ele));if (u_pitch_with_map) {
#ifdef GLOBE
vec3 center_vector=projectToSphere(circle_center);
#endif
float angle_scale=u_globe_extrude_scale;vec2 corner_position=circle_center;if (u_scale_with_map) {angle_scale*=(radius+stroke_width);corner_position+=extrude*u_extrude_scale*(radius+stroke_width);} else {
#ifdef GLOBE
vec4 projected_center=interpolateProjection(circle_center,center_vector,ele);
#else
vec4 projected_center=projectTileWithElevation(circle_center,ele);
#endif
corner_position+=extrude*u_extrude_scale*(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);angle_scale*=(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);}
#ifdef GLOBE
vec2 angles=extrude*angle_scale;vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(corner_position,corner_vector,ele);
#else
gl_Position=projectTileWithElevation(corner_position,ele);
#endif
} else {gl_Position=projectTileWithElevation(circle_center,ele);if (gl_Position.z/gl_Position.w > 1.0) {gl_Position.xy=vec2(10000.0);}if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}float antialiasblur=-max(1.0/u_device_pixel_ratio/(radius+stroke_width),blur);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:he(me,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),heatmap:he(`uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);fragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;uniform highp float u_globe_extrude_scale;in vec2 a_pos;out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 pos_raw=a_pos+32768.0;vec2 unscaled_extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 circle_center=floor(pos_raw/8.0);
#ifdef GLOBE
vec2 angles=v_extrude*radius*u_globe_extrude_scale;vec3 center_vector=projectToSphere(circle_center);vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(circle_center+extrude,corner_vector,0.0);
#else
gl_Position=projectTileFor3D(circle_center+extrude,get_elevation(circle_center));
#endif
}`),heatmapTexture:he(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));fragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:he("in float v_placed;in float v_notUsed;void main() {float alpha=0.5;fragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {fragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {fragColor*=.1;}}","in vec2 a_anchor_pos;in vec2 a_placed;in vec2 a_box_real;uniform vec2 u_pixel_extrude_scale;out float v_placed;out float v_notUsed;void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:he("in float v_radius;in vec2 v_extrude;in float v_collision;void main() {float alpha=0.5;float stroke_radius=0.9;float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);fragColor=color*alpha*opacity_t;}","in vec2 a_pos;in float a_radius;in vec2 a_flags;uniform vec2 u_viewport_size;out float v_radius;out vec2 v_extrude;out float v_collision;void main() {float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_collision=collision;gl_Position=vec4((a_pos/u_viewport_size*2.0-1.0)*vec2(1.0,-1.0),0.0,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),colorRelief:he(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;uniform vec4 u_unpack;uniform sampler2D u_elevation_stops;uniform sampler2D u_color_stops;uniform int u_color_ramp_size;uniform float u_opacity;in vec2 v_pos;float getElevation(vec2 coord) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}float getElevationStop(int stop) {float x=(float(stop)+0.5)/float(u_color_ramp_size);vec4 data=texture(u_elevation_stops,vec2(x,0))*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {float el=getElevation(v_pos);int r=(u_color_ramp_size-1);int l=0;float el_l=getElevationStop(l);float el_r=getElevationStop(r);while(r-l > 1){int m=(r+l)/2;float el_m=getElevationStop(m);if(el < el_m){r=m;el_r=el_m;}else
{l=m;el_l=el_m;}}float x=(float(l)+(el-el_l)/(el_r-el_l)+0.5)/float(u_color_ramp_size);fragColor=u_opacity*texture(u_color_stops,vec2(x,0));
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_dimension;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_pos/8192.0)*scale+epsilon;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),debug:he("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);fragColor=mix(u_color,overlay_color,overlay_color.a);}","in vec2 a_pos;out vec2 v_uv;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=projectTileWithElevation(a_pos*u_overlay_scale,get_elevation(a_pos));}"),depth:he(me,`in vec2 a_pos;void main() {
#ifdef GLOBE
gl_Position=projectTileFor3D(a_pos,0.0);
#else
gl_Position=u_projection_matrix*vec4(a_pos,0.0,1.0);
#endif
}`),fill:he(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
fragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_fill_translate;in vec2 a_pos;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);}`),fillOutline:he(`in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=outline_color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillOutlinePattern:he(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;in vec2 v_pos_a;in vec2 v_pos_b;in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillPattern:he(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:he(`in vec4 v_color;void main() {fragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
out vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;vec3 normalForLighting=normal/16384.0;float directional=clamp(dot(normalForLighting,u_lightpos),0.0,1.0);
#ifdef GLOBE
mat3 rotMatrix=globeGetRotationMatrix(spherePos);normalForLighting=rotMatrix*normalForLighting;directional=mix(directional,clamp(dot(normalForLighting,u_lightpos_globe),0.0,1.0),u_projection_transition);
#endif
directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:he(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;in vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);fragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
#ifdef GLOBE
out vec3 v_sphere_pos;
#endif
out vec2 v_pos_a;out vec2 v_pos_b;out vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);v_sphere_pos=elevatedPos;gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,elevation*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:he(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {vec2 epsilon=1.0/u_dimension;float tileSize=u_dimension.x-2.0;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))*tileSize/pow(2.0,exaggeration+(28.2562-u_zoom));fragColor=clamp(vec4(deriv.x/8.0+0.5,deriv.y/8.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:he(`uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform float u_exaggeration;uniform vec4 u_accent;uniform int u_method;uniform float u_altitudes[NUM_ILLUMINATION_SOURCES];uniform float u_azimuths[NUM_ILLUMINATION_SOURCES];uniform vec4 u_shadows[NUM_ILLUMINATION_SOURCES];uniform vec4 u_highlights[NUM_ILLUMINATION_SOURCES];
#define PI 3.141592653589793
#define STANDARD 0
#define COMBINED 1
#define IGOR 2
#define MULTIDIRECTIONAL 3
#define BASIC 4
float get_aspect(vec2 deriv){return deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);}void igor_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float aspect=get_aspect(deriv);float azimuth=u_azimuths[0]+PI;float slope_stength=atan(length(deriv))*2.0/PI;float aspect_strength=1.0-abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);float shadow_strength=slope_stength*aspect_strength;float highlight_strength=slope_stength*(1.0-aspect_strength);fragColor=u_shadows[0]*shadow_strength+u_highlights[0]*highlight_strength;}void standard_hillshade(vec2 deriv){float azimuth=u_azimuths[0]+PI;float slope=atan(0.625*length(deriv));float aspect=get_aspect(deriv);float intensity=u_exaggeration;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadows[0],u_highlights[0],shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);fragColor=accent_color*(1.0-shade_color.a)+shade_color;}void basic_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor=u_highlights[0]*(2.0*shade-1.0);}else
{fragColor=u_shadows[0]*(1.0-2.0*shade);}}void multidirectional_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;fragColor=vec4(0,0,0,0);for(int i=0; i < NUM_ILLUMINATION_SOURCES; i++){float cos_alt=cos(u_altitudes[i]);float sin_alt=sin(u_altitudes[i]);float cos_az=-cos(u_azimuths[i]);float sin_az=-sin(u_azimuths[i]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor+=u_highlights[i]*(2.0*shade-1.0)/float(NUM_ILLUMINATION_SOURCES);}else
{fragColor+=u_shadows[i]*(1.0-2.0*shade)/float(NUM_ILLUMINATION_SOURCES);}}}void combined_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=acos((sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv)));cang=clamp(cang,0.0,PI/2.0);float shade=cang*atan(length(deriv))*4.0/PI/PI;float highlight=(PI/2.0-cang)*atan(length(deriv))*4.0/PI/PI;fragColor=u_shadows[0]*shade+u_highlights[0]*highlight;}void main() {vec4 pixel=texture(u_image,v_pos);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));vec2 deriv=((pixel.rg*8.0)-4.0)/scaleFactor;if (u_method==BASIC) {basic_hillshade(deriv);} else if (u_method==COMBINED) {combined_hillshade(deriv);} else if (u_method==IGOR) {igor_hillshade(deriv);} else if (u_method==MULTIDIRECTIONAL) {multidirectional_hillshade(deriv);} else if (u_method==STANDARD) {standard_hillshade(deriv);} else {standard_hillshade(deriv);}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);v_pos=a_pos/8192.0;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),line:he(`uniform lowp float u_device_pixel_ratio;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp float v_linesofar;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:he(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec2 v_uv;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture(u_image,v_uv);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;in float a_uv_x;in float a_split_index;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec2 v_uv;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:he(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture(u_image,pos_a),texture(u_image,pos_b),u_fade);fragColor=color*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:he(`uniform lowp float u_device_pixel_ratio;uniform lowp float u_lineatlas_width;uniform sampler2D u_image;uniform float u_mix;in vec2 v_normal;in vec2 v_width2;in vec2 v_tex_a;in vec2 v_tex_b;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture(u_image,v_tex_a).a;float sdfdist_b=texture(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfgamma=(u_lineatlas_width/256.0/u_device_pixel_ratio)/min(dasharray_from.w,dasharray_to.w);alpha*=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_tileratio;uniform float u_crossfade_from;uniform float u_crossfade_to;uniform float u_lineatlas_height;out vec2 v_normal;out vec2 v_width2;out vec2 v_tex_a;out vec2 v_tex_b;out float v_gamma_scale;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
float u_patternscale_a_x=u_tileratio/dasharray_from.w/u_crossfade_from;float u_patternscale_a_y=-dasharray_from.z/2.0/u_lineatlas_height;float u_patternscale_b_x=u_tileratio/dasharray_to.w/u_crossfade_to;float u_patternscale_b_y=-dasharray_to.z/2.0/u_lineatlas_height;v_tex_a=vec2(a_linesofar*u_patternscale_a_x/floorwidth,normal.y*u_patternscale_a_y+(float(dasharray_from.y)+0.5)/u_lineatlas_height);v_tex_b=vec2(a_linesofar*u_patternscale_b_x/floorwidth,normal.y*u_patternscale_b_y+(float(dasharray_to.y)+0.5)/u_lineatlas_height);v_width2=vec2(outset,inset);}`),lineGradientSDF:he(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform sampler2D u_image_dash;uniform float u_mix;uniform lowp float u_lineatlas_width;in vec2 v_normal;in vec2 v_width2;in vec2 v_tex_a;in vec2 v_tex_b;in float v_gamma_scale;in highp vec2 v_uv;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture(u_image,v_uv);float sdfdist_a=texture(u_image_dash,v_tex_a).a;float sdfdist_b=texture(u_image_dash,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfgamma=(u_lineatlas_width/256.0)/min(dasharray_from.w,dasharray_to.w);float dash_alpha=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);fragColor=color*(alpha*dash_alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;in float a_uv_x;in float a_split_index;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;uniform float u_tileratio;uniform float u_crossfade_from;uniform float u_crossfade_to;uniform float u_lineatlas_height;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec2 v_uv;out vec2 v_tex_a;out vec2 v_tex_b;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;float texel_height=1.0/u_image_height;float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
float u_patternscale_a_x=u_tileratio/dasharray_from.w/u_crossfade_from;float u_patternscale_a_y=-dasharray_from.z/2.0/u_lineatlas_height;float u_patternscale_b_x=u_tileratio/dasharray_to.w/u_crossfade_to;float u_patternscale_b_y=-dasharray_to.z/2.0/u_lineatlas_height;v_tex_a=vec2(a_linesofar*u_patternscale_a_x/floorwidth,normal.y*u_patternscale_a_y+(float(dasharray_from.y)+0.5)/u_lineatlas_height);v_tex_b=vec2(a_linesofar*u_patternscale_b_x/floorwidth,normal.y*u_patternscale_b_y+(float(dasharray_to.y)+0.5)/u_lineatlas_height);v_width2=vec2(outset,inset);}`),raster:he(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;in vec2 v_pos0;in vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture(u_image0,v_pos0);vec4 color1=texture(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);fragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;uniform vec4 u_coords_top;uniform vec4 u_coords_bottom;in vec2 a_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {vec2 fractionalPos=a_pos/8192.0;vec2 position=mix(mix(u_coords_top.xy,u_coords_top.zw,fractionalPos.x),mix(u_coords_bottom.xy,u_coords_bottom.zw,fractionalPos.x),fractionalPos.y);gl_Position=projectTile(position,position);v_pos0=((fractionalPos-0.5)/u_buffer_scale)+0.5;
#ifdef GLOBE
if (a_pos.y <-32767.5) {v_pos0.y=0.0;}if (a_pos.y > 32766.5) {v_pos0.y=1.0;}
#endif
v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),symbolIcon:he(`uniform sampler2D u_texture;in vec2 v_tex;in float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;fragColor=texture(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_tex;out float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:he(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;in vec2 v_data0;in vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_data0;out vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:he(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;in vec4 v_data0;in vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;fragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec4 v_data0;out vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map && !u_is_along_line) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:he("uniform sampler2D u_texture;uniform vec4 u_fog_color;uniform vec4 u_horizon_color;uniform float u_fog_ground_blend;uniform float u_fog_ground_blend_opacity;uniform float u_horizon_fog_blend;uniform bool u_is_globe_mode;in vec2 v_texture_pos;in float v_fog_depth;const float gamma=2.2;vec4 gammaToLinear(vec4 color) {return pow(color,vec4(gamma));}vec4 linearToGamma(vec4 color) {return pow(color,vec4(1.0/gamma));}void main() {vec4 surface_color=texture(u_texture,vec2(v_texture_pos.x,1.0-v_texture_pos.y));if (!u_is_globe_mode && v_fog_depth > u_fog_ground_blend) {vec4 surface_color_linear=gammaToLinear(surface_color);float blend_color=smoothstep(0.0,1.0,max((v_fog_depth-u_horizon_fog_blend)/(1.0-u_horizon_fog_blend),0.0));vec4 fog_horizon_color_linear=mix(gammaToLinear(u_fog_color),gammaToLinear(u_horizon_color),blend_color);float factor_fog=max(v_fog_depth-u_fog_ground_blend,0.0)/(1.0-u_fog_ground_blend);fragColor=linearToGamma(mix(surface_color_linear,fog_horizon_color_linear,pow(factor_fog,2.0)*u_fog_ground_blend_opacity));} else {fragColor=surface_color;}}","in vec3 a_pos3d;uniform mat4 u_fog_matrix;uniform float u_ele_delta;out vec2 v_texture_pos;out float v_fog_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta);vec4 pos=u_fog_matrix*vec4(a_pos3d.xy,ele,1.0);v_fog_depth=pos.z/pos.w*0.5+0.5;}"),terrainDepth:he("in float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {fragColor=pack(v_depth);}","in vec3 a_pos3d;uniform float u_ele_delta;out float v_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);v_depth=gl_Position.z/gl_Position.w;}"),terrainCoords:he("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;in vec2 v_texture_pos;void main() {vec4 rgba=texture(u_texture,v_texture_pos);fragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}","in vec3 a_pos3d;uniform float u_ele_delta;out vec2 v_texture_pos;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);}"),projectionErrorMeasurement:he("in vec4 v_output_error_encoded;void main() {fragColor=v_output_error_encoded;}","in vec2 a_pos;uniform highp float u_input;uniform highp float u_output_expected;out vec4 v_output_error_encoded;void main() {float real_output=2.0*atan(exp(PI-(u_input*PI*2.0)))-PI*0.5;float error=real_output-u_output_expected;float abs_error=abs(error)*128.0;v_output_error_encoded.x=min(floor(abs_error*256.0),255.0)/255.0;abs_error-=v_output_error_encoded.x;v_output_error_encoded.y=min(floor(abs_error*65536.0),255.0)/255.0;abs_error-=v_output_error_encoded.x/255.0;v_output_error_encoded.z=min(floor(abs_error*16777216.0),255.0)/255.0;v_output_error_encoded.w=error >=0.0 ? 1.0 : 0.0;gl_Position=vec4(a_pos,0.0,1.0);}"),atmosphere:he(`in vec3 view_direction;uniform vec3 u_sun_pos;uniform vec3 u_globe_position;uniform float u_globe_radius;uniform float u_atmosphere_blend;/**Shader use from https:*Made some change to adapt to MapLibre Globe geometry*/const float PI=3.141592653589793;const int iSteps=5;const int jSteps=3;/*radius of the planet*/const float EARTH_RADIUS=6371e3;/*radius of the atmosphere*/const float ATMOS_RADIUS=6471e3;vec2 rsi(vec3 r0,vec3 rd,float sr) {float a=dot(rd,rd);float b=2.0*dot(rd,r0);float c=dot(r0,r0)-(sr*sr);float d=(b*b)-4.0*a*c;if (d < 0.0) return vec2(1e5,-1e5);return vec2((-b-sqrt(d))/(2.0*a),(-b+sqrt(d))/(2.0*a));}vec4 atmosphere(vec3 r,vec3 r0,vec3 pSun,float iSun,float rPlanet,float rAtmos,vec3 kRlh,float kMie,float shRlh,float shMie,float g) {pSun=normalize(pSun);r=normalize(r);vec2 p=rsi(r0,r,rAtmos);if (p.x > p.y) {return vec4(0.0,0.0,0.0,1.0);}if (p.x < 0.0) {p.x=0.0;}vec3 pos=r0+r*p.x;vec2 p2=rsi(r0,r,rPlanet);if (p2.x <=p2.y && p2.x > 0.0) {p.y=min(p.y,p2.x);}float iStepSize=(p.y-p.x)/float(iSteps);float iTime=p.x+iStepSize*0.5;vec3 totalRlh=vec3(0,0,0);vec3 totalMie=vec3(0,0,0);float iOdRlh=0.0;float iOdMie=0.0;float mu=dot(r,pSun);float mumu=mu*mu;float gg=g*g;float pRlh=3.0/(16.0*PI)*(1.0+mumu);float pMie=3.0/(8.0*PI)*((1.0-gg)*(mumu+1.0))/(pow(1.0+gg-2.0*mu*g,1.5)*(2.0+gg));for (int i=0; i < iSteps; i++) {vec3 iPos=r0+r*iTime;float iHeight=length(iPos)-rPlanet;float odStepRlh=exp(-iHeight/shRlh)*iStepSize;float odStepMie=exp(-iHeight/shMie)*iStepSize;iOdRlh+=odStepRlh;iOdMie+=odStepMie;float jStepSize=rsi(iPos,pSun,rAtmos).y/float(jSteps);float jTime=jStepSize*0.5;float jOdRlh=0.0;float jOdMie=0.0;for (int j=0; j < jSteps; j++) {vec3 jPos=iPos+pSun*jTime;float jHeight=length(jPos)-rPlanet;jOdRlh+=exp(-jHeight/shRlh)*jStepSize;jOdMie+=exp(-jHeight/shMie)*jStepSize;jTime+=jStepSize;}vec3 attn=exp(-(kMie*(iOdMie+jOdMie)+kRlh*(iOdRlh+jOdRlh)));totalRlh+=odStepRlh*attn;totalMie+=odStepMie*attn;iTime+=iStepSize;}float opacity=exp(-(length(kRlh)*length(totalRlh)+kMie*length(totalMie)));vec3 color=iSun*(pRlh*kRlh*totalRlh+pMie*kMie*totalMie);return vec4(color,opacity);}void main() {vec3 scale_camera_pos=-u_globe_position*EARTH_RADIUS/u_globe_radius;vec4 color=atmosphere(normalize(view_direction),scale_camera_pos,u_sun_pos,22.0,EARTH_RADIUS,ATMOS_RADIUS,vec3(5.5e-6,13.0e-6,22.4e-6),21e-6,8e3,1.2e3,0.758
);color.rgb=1.0-exp(-1.0*color.rgb);color=pow(color,vec4(1.0/2.2));fragColor=vec4(color.rgb,1.0-color.a)*u_atmosphere_blend;}`,"in vec2 a_pos;uniform mat4 u_inv_proj_matrix;out vec3 view_direction;void main() {view_direction=(u_inv_proj_matrix*vec4(a_pos,0.0,1.0)).xyz;gl_Position=vec4(a_pos,0.0,1.0);}"),sky:he("uniform vec4 u_sky_color;uniform vec4 u_horizon_color;uniform vec2 u_horizon;uniform vec2 u_horizon_normal;uniform float u_sky_horizon_blend;uniform float u_sky_blend;void main() {float x=gl_FragCoord.x;float y=gl_FragCoord.y;float blend=(y-u_horizon.y)*u_horizon_normal.y+(x-u_horizon.x)*u_horizon_normal.x;if (blend > 0.0) {if (blend < u_sky_horizon_blend) {fragColor=mix(u_sky_color,u_horizon_color,pow(1.0-blend/u_sky_horizon_blend,2.0));} else {fragColor=u_sky_color;}}fragColor=mix(fragColor,vec4(vec3(0.0),0.0),u_sky_blend);}","in vec2 a_pos;void main() {gl_Position=vec4(a_pos,1.0,1.0);}")};function he(m,e){let a=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,c=e.match(/in ([\w]+) ([\w]+)/g),r=m.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),W=e.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),h=W?W.concat(r):r,g={};return{fragmentSource:m=m.replace(a,((u,G,Y,y,J)=>(g[J]=!0,G==="define"?`
#ifndef HAS_UNIFORM_u_${J}
in ${Y} ${y} ${J};
#else
uniform ${Y} ${y} u_${J};
#endif
`:`
#ifdef HAS_UNIFORM_u_${J}
    ${Y} ${y} ${J} = u_${J};
#endif
`))),vertexSource:e=e.replace(a,((u,G,Y,y,J)=>{let S=y==="float"?"vec2":"vec4",L=J.match(/color/)?"color":S;return g[J]?G==="define"?`
#ifndef HAS_UNIFORM_u_${J}
uniform lowp float u_${J}_t;
in ${Y} ${S} a_${J};
out ${Y} ${y} ${J};
#else
uniform ${Y} ${y} u_${J};
#endif
`:L==="vec4"?`
#ifndef HAS_UNIFORM_u_${J}
    ${J} = a_${J};
#else
    ${Y} ${y} ${J} = u_${J};
#endif
`:`
#ifndef HAS_UNIFORM_u_${J}
    ${J} = unpack_mix_${L}(a_${J}, u_${J}_t);
#else
    ${Y} ${y} ${J} = u_${J};
#endif
`:G==="define"?`
#ifndef HAS_UNIFORM_u_${J}
uniform lowp float u_${J}_t;
in ${Y} ${S} a_${J};
#else
uniform ${Y} ${y} u_${J};
#endif
`:L==="vec4"?`
#ifndef HAS_UNIFORM_u_${J}
    ${Y} ${y} ${J} = a_${J};
#else
    ${Y} ${y} ${J} = u_${J};
#endif
`:`
#ifndef HAS_UNIFORM_u_${J}
    ${Y} ${y} ${J} = unpack_mix_${L}(a_${J}, u_${J}_t);
#else
    ${Y} ${y} ${J} = u_${J};
#endif
`})),staticAttributes:c,staticUniforms:h}}class va{constructor(e,a,c){this.vertexBuffer=e,this.indexBuffer=a,this.segments=c}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.vertexBuffer=null,this.indexBuffer=null,this.segments=null}}var Zl=o.aT([{name:"a_pos",type:"Int16",components:2}]);let wl="#define PROJECTION_MERCATOR",vl="mercator";class Gl{constructor(){this._cachedMesh=null}get name(){return"mercator"}get useSubdivision(){return!1}get shaderVariantName(){return vl}get shaderDefine(){return wl}get shaderPreludeCode(){return yi.projectionMercator}get vertexShaderPreludeCode(){return yi.projectionMercator.vertexSource}get subdivisionGranularity(){return o.aU.noSubdivision}get useGlobeControls(){return!1}get transitionState(){return 0}get latitudeErrorCorrectionRadians(){return 0}destroy(){}updateGPUdependent(e){}getMeshFromTileID(e,a,c,r,W){if(this._cachedMesh)return this._cachedMesh;let h=new o.aV;h.emplaceBack(0,0),h.emplaceBack(o.a4,0),h.emplaceBack(0,o.a4),h.emplaceBack(o.a4,o.a4);let g=e.createVertexBuffer(h,Zl.members),u=o.aW.simpleSegment(0,0,4,2),G=new o.aX;G.emplaceBack(1,0,2),G.emplaceBack(1,2,3);let Y=e.createIndexBuffer(G);return this._cachedMesh=new va(g,Y,u),this._cachedMesh}recalculate(){}hasTransition(){return!1}setErrorQueryLatitudeDegrees(e){}}class Be{constructor(e=0,a=0,c=0,r=0){if(isNaN(e)||e<0||isNaN(a)||a<0||isNaN(c)||c<0||isNaN(r)||r<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=e,this.bottom=a,this.left=c,this.right=r}interpolate(e,a,c){return a.top!=null&&e.top!=null&&(this.top=o.G.number(e.top,a.top,c)),a.bottom!=null&&e.bottom!=null&&(this.bottom=o.G.number(e.bottom,a.bottom,c)),a.left!=null&&e.left!=null&&(this.left=o.G.number(e.left,a.left,c)),a.right!=null&&e.right!=null&&(this.right=o.G.number(e.right,a.right,c)),this}getCenter(e,a){let c=o.an((this.left+e-this.right)/2,0,e),r=o.an((this.top+a-this.bottom)/2,0,a);return new o.P(c,r)}equals(e){return this.top===e.top&&this.bottom===e.bottom&&this.left===e.left&&this.right===e.right}clone(){return new Be(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function Gc(m,e){if(!m.renderWorldCopies||m.lngRange)return;let a=e.lng-m.center.lng;e.lng+=a>180?-360:a<-180?360:0}function ti(m){return Math.max(0,Math.floor(m))}class bi{constructor(e,a){var c;this.applyConstrain=(r,W)=>this._constrainOverride!==null?this._constrainOverride(r,W):this._callbacks.defaultConstrain(r,W),this._callbacks=e,this._tileSize=512,this._renderWorldCopies=a?.renderWorldCopies===void 0||!!a?.renderWorldCopies,this._minZoom=a?.minZoom||0,this._maxZoom=a?.maxZoom||22,this._minPitch=a?.minPitch==null?0:a?.minPitch,this._maxPitch=a?.maxPitch==null?60:a?.maxPitch,this._constrainOverride=(c=a?.constrainOverride)!==null&&c!==void 0?c:null,this.setMaxBounds(),this._width=0,this._height=0,this._center=new o.V(0,0),this._elevation=0,this._zoom=0,this._tileZoom=ti(this._zoom),this._scale=o.aq(this._zoom),this._bearingInRadians=0,this._fovInRadians=.6435011087932844,this._pitchInRadians=0,this._rollInRadians=0,this._unmodified=!0,this._edgeInsets=new Be,this._minElevationForCurrentTile=0,this._autoCalculateNearFarZ=!0}apply(e,a,c){this._constrainOverride=e.constrainOverride,this._latRange=e.latRange,this._lngRange=e.lngRange,this._width=e.width,this._height=e.height,this._center=e.center,this._elevation=e.elevation,this._minElevationForCurrentTile=e.minElevationForCurrentTile,this._zoom=e.zoom,this._tileZoom=ti(this._zoom),this._scale=o.aq(this._zoom),this._bearingInRadians=e.bearingInRadians,this._fovInRadians=e.fovInRadians,this._pitchInRadians=e.pitchInRadians,this._rollInRadians=e.rollInRadians,this._unmodified=e.unmodified,this._edgeInsets=new Be(e.padding.top,e.padding.bottom,e.padding.left,e.padding.right),this._minZoom=e.minZoom,this._maxZoom=e.maxZoom,this._minPitch=e.minPitch,this._maxPitch=e.maxPitch,this._renderWorldCopies=e.renderWorldCopies,this._cameraToCenterDistance=e.cameraToCenterDistance,this._nearZ=e.nearZ,this._farZ=e.farZ,this._autoCalculateNearFarZ=!c&&e.autoCalculateNearFarZ,a&&this.constrainInternal(),this._calcMatrices()}get pixelsToClipSpaceMatrix(){return this._pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._clipSpaceToPixelsMatrix}get minElevationForCurrentTile(){return this._minElevationForCurrentTile}setMinElevationForCurrentTile(e){this._minElevationForCurrentTile=e}get tileSize(){return this._tileSize}get tileZoom(){return this._tileZoom}get scale(){return this._scale}get width(){return this._width}get height(){return this._height}get bearingInRadians(){return this._bearingInRadians}get lngRange(){return this._lngRange}get latRange(){return this._latRange}get pixelsToGLUnits(){return this._pixelsToGLUnits}get minZoom(){return this._minZoom}setMinZoom(e){this._minZoom!==e&&(this._minZoom=e,this.setZoom(this.applyConstrain(this._center,this.zoom).zoom))}get maxZoom(){return this._maxZoom}setMaxZoom(e){this._maxZoom!==e&&(this._maxZoom=e,this.setZoom(this.applyConstrain(this._center,this.zoom).zoom))}get minPitch(){return this._minPitch}setMinPitch(e){this._minPitch!==e&&(this._minPitch=e,this.setPitch(Math.max(this.pitch,e)))}get maxPitch(){return this._maxPitch}setMaxPitch(e){this._maxPitch!==e&&(this._maxPitch=e,this.setPitch(Math.min(this.pitch,e)))}get renderWorldCopies(){return this._renderWorldCopies}setRenderWorldCopies(e){e===void 0?e=!0:e===null&&(e=!1),this._renderWorldCopies=e}get constrainOverride(){return this._constrainOverride}setConstrainOverride(e){e===void 0&&(e=null),this._constrainOverride!==e&&(this._constrainOverride=e,this.constrainInternal(),this._calcMatrices())}get worldSize(){return this._tileSize*this._scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new o.P(this._width,this._height)}get bearing(){return this._bearingInRadians/Math.PI*180}setBearing(e){let a=o.W(e,-180,180)*Math.PI/180;var c,r,W,h,g,u,G,Y,y;this._bearingInRadians!==a&&(this._unmodified=!1,this._bearingInRadians=a,this._calcMatrices(),this._rotationMatrix=Ft(),c=this._rotationMatrix,W=-this._bearingInRadians,h=(r=this._rotationMatrix)[0],g=r[1],u=r[2],G=r[3],Y=Math.sin(W),y=Math.cos(W),c[0]=h*y+u*Y,c[1]=g*y+G*Y,c[2]=h*-Y+u*y,c[3]=g*-Y+G*y)}get rotationMatrix(){return this._rotationMatrix}get pitchInRadians(){return this._pitchInRadians}get pitch(){return this._pitchInRadians/Math.PI*180}setPitch(e){let a=o.an(e,this.minPitch,this.maxPitch)/180*Math.PI;this._pitchInRadians!==a&&(this._unmodified=!1,this._pitchInRadians=a,this._calcMatrices())}get rollInRadians(){return this._rollInRadians}get roll(){return this._rollInRadians/Math.PI*180}setRoll(e){let a=e/180*Math.PI;this._rollInRadians!==a&&(this._unmodified=!1,this._rollInRadians=a,this._calcMatrices())}get fovInRadians(){return this._fovInRadians}get fov(){return o.aY(this._fovInRadians)}setFov(e){e=o.an(e,.1,150),this.fov!==e&&(this._unmodified=!1,this._fovInRadians=o.ap(e),this._calcMatrices())}get zoom(){return this._zoom}setZoom(e){let a=this.applyConstrain(this._center,e).zoom;this._zoom!==a&&(this._unmodified=!1,this._zoom=a,this._tileZoom=Math.max(0,Math.floor(a)),this._scale=o.aq(a),this.constrainInternal(),this._calcMatrices())}get center(){return this._center}setCenter(e){e.lat===this._center.lat&&e.lng===this._center.lng||(this._unmodified=!1,this._center=e,this.constrainInternal(),this._calcMatrices())}get elevation(){return this._elevation}setElevation(e){e!==this._elevation&&(this._elevation=e,this.constrainInternal(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}setPadding(e){this._edgeInsets.equals(e)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,e,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this._width,this._height)}get pixelsPerMeter(){return this._pixelPerMeter}get unmodified(){return this._unmodified}get cameraToCenterDistance(){return this._cameraToCenterDistance}get nearZ(){return this._nearZ}get farZ(){return this._farZ}get autoCalculateNearFarZ(){return this._autoCalculateNearFarZ}overrideNearFarZ(e,a){this._autoCalculateNearFarZ=!1,this._nearZ=e,this._farZ=a,this._calcMatrices()}clearNearFarZOverride(){this._autoCalculateNearFarZ=!0,this._calcMatrices()}isPaddingEqual(e){return this._edgeInsets.equals(e)}interpolatePadding(e,a,c){this._unmodified=!1,this._edgeInsets.interpolate(e,a,c),this.constrainInternal(),this._calcMatrices()}resize(e,a,c=!0){this._width=e,this._height=a,c&&this.constrainInternal(),this._calcMatrices()}getMaxBounds(){return this._latRange&&this._latRange.length===2&&this._lngRange&&this._lngRange.length===2?new Ee([this._lngRange[0],this._latRange[0]],[this._lngRange[1],this._latRange[1]]):null}setMaxBounds(e){e?(this._lngRange=[e.getWest(),e.getEast()],this._latRange=[e.getSouth(),e.getNorth()],this.constrainInternal()):(this._lngRange=null,this._latRange=[-o.ao,o.ao])}getCameraQueryGeometry(e,a){if(a.length===1)return[a[0],e];{let{minX:c,minY:r,maxX:W,maxY:h}=o.ab.fromPoints(a).extend(e);return[new o.P(c,r),new o.P(W,r),new o.P(W,h),new o.P(c,h),new o.P(c,r)]}}constrainInternal(){if(!this.center||!this._width||!this._height||this._constraining)return;this._constraining=!0;let e=this._unmodified,{center:a,zoom:c}=this.applyConstrain(this.center,this.zoom);this.setCenter(a),this.setZoom(c),this._unmodified=e,this._constraining=!1}_calcMatrices(){if(this._width&&this._height){this._pixelsToGLUnits=[2/this._width,-2/this._height];let e=o.ar(new Float64Array(16));o.Q(e,e,[this._width/2,-this._height/2,1]),o.O(e,e,[1,-1,0]),this._clipSpaceToPixelsMatrix=e,e=o.ar(new Float64Array(16)),o.Q(e,e,[1,-1,1]),o.O(e,e,[-1,-1,0]),o.Q(e,e,[2/this._width,2/this._height,1]),this._pixelsToClipSpaceMatrix=e,this._cameraToCenterDistance=.5/Math.tan(this.fovInRadians/2)*this._height}this._callbacks.calcMatrices()}calculateCenterFromCameraLngLatAlt(e,a,c,r){let W=c!==void 0?c:this.bearing,h=r=r!==void 0?r:this.pitch,g=o.aa.fromLngLat(e,a),u=-Math.cos(o.ap(h)),G=Math.sin(o.ap(h)),Y=G*Math.sin(o.ap(W)),y=-G*Math.cos(o.ap(W)),J=this.elevation,S=a-J,L;u*S>=0||Math.abs(u)<.1?(L=1e4,J=a+L*u):L=-S/u;let w,v,O=o.aZ(1,g.y),K=0;do{if(K+=1,K>10)break;v=L/O,w=new o.aa(g.x+Y*v,g.y+y*v),O=1/w.meterInMercatorCoordinateUnits()}while(Math.abs(L-v*O)>1e-12);return{center:w.toLngLat(),elevation:J,zoom:o.at(this.height/2/Math.tan(this.fovInRadians/2)/v/this.tileSize)}}recalculateZoomAndCenter(e){if(this.elevation-e==0)return;let a=o.as(1,this.center.lat)*this.worldSize,c=this.cameraToCenterDistance/a,r=o.aa.fromLngLat(this.center,this.elevation),W=ot(this.center,this.elevation,this.pitch,this.bearing,c);this._elevation=e;let h=this.calculateCenterFromCameraLngLatAlt(W.toLngLat(),o.aZ(W.z,r.y),this.bearing,this.pitch);this._elevation=h.elevation,this._center=h.center,this.setZoom(h.zoom)}getCameraPoint(){let e=Math.tan(this.pitchInRadians)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new o.P(e*Math.sin(this.rollInRadians),e*Math.cos(this.rollInRadians)))}getCameraAltitude(){return Math.cos(this.pitchInRadians)*this._cameraToCenterDistance/this._pixelPerMeter+this.elevation}getCameraLngLat(){let e=o.as(1,this.center.lat)*this.worldSize;return ot(this.center,this.elevation,this.pitch,this.bearing,this.cameraToCenterDistance/e).toLngLat()}getMercatorTileCoordinates(e){if(!e)return[0,0,1,1];let a=e.canonical.z>=0?1<<e.canonical.z:Math.pow(2,e.canonical.z);return[e.canonical.x/a,e.canonical.y/a,1/a/o.a4,1/a/o.a4]}}class Hl{constructor(e,a){this.min=e,this.max=a,this.center=o.a_([],o.a$([],this.min,this.max),.5)}quadrant(e){let a=[e%2==0,e<2],c=o.b0(this.min),r=o.b0(this.max);for(let W=0;W<a.length;W++)c[W]=a[W]?this.min[W]:this.center[W],r[W]=a[W]?this.center[W]:this.max[W];return r[2]=this.max[2],new Hl(c,r)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}intersectsFrustum(e){let a=!0;for(let c=0;c<e.planes.length;c++){let r=this.intersectsPlane(e.planes[c]);if(r===0)return 0;r===1&&(a=!1)}return a?2:e.aabb.min[0]>this.max[0]||e.aabb.min[1]>this.max[1]||e.aabb.min[2]>this.max[2]||e.aabb.max[0]<this.min[0]||e.aabb.max[1]<this.min[1]||e.aabb.max[2]<this.min[2]?0:1}intersectsPlane(e){let a=e[3],c=e[3];for(let r=0;r<3;r++)e[r]>0?(a+=e[r]*this.min[r],c+=e[r]*this.max[r]):(c+=e[r]*this.min[r],a+=e[r]*this.max[r]);return a>=0?2:c<0?0:1}}class Cr{distanceToTile2d(e,a,c,r){let W=r.distanceX([e,a]),h=r.distanceY([e,a]);return Math.hypot(W,h)}getWrap(e,a,c){return c}getTileBoundingVolume(e,a,c,r){var W,h;let g=0,u=0;if(r?.terrain){let Y=new o.a1(e.z,a,e.z,e.x,e.y),y=r.terrain.getMinMaxElevation(Y);g=(W=y.minElevation)!==null&&W!==void 0?W:Math.min(0,c),u=(h=y.maxElevation)!==null&&h!==void 0?h:Math.max(0,c)}let G=1<<e.z;return new Hl([a+e.x/G,e.y/G,g],[a+(e.x+1)/G,(e.y+1)/G,u])}allowVariableZoom(e,a){let c=e.fov*(Math.abs(Math.cos(e.rollInRadians))*e.height+Math.abs(Math.sin(e.rollInRadians))*e.width)/e.height,r=o.an(78.5-c/2,0,60);return!!a.terrain||e.pitch>r}allowWorldCopies(){return!0}prepareNextFrame(){}}class Ha{constructor(e,a,c){this.points=e,this.planes=a,this.aabb=c}static fromInvProjectionMatrix(e,a=1,c=0,r,W){let h=W?[[6,5,4],[0,1,2],[0,3,7],[2,1,5],[3,2,6],[0,4,5]]:[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]],g=Math.pow(2,c),u=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map((J=>(function(S,L,w,v){let O=o.aG([],S,L),K=1/O[3]/w*v;return o.b5(O,O,[K,K,1/O[3],K])})(J,e,a,g)));r&&(function(J,S,L,w){let v=w?4:0,O=w?0:4,K=0,tt=[],_=[];for(let q=0;q<4;q++){let ct=o.b1([],J[q+O],J[q+v]),ht=o.b6(ct);o.a_(ct,ct,1/ht),tt.push(ht),_.push(ct)}for(let q=0;q<4;q++){let ct=o.b7(J[q+v],_[q],L);K=ct!==null&&ct>=0?Math.max(K,ct):Math.max(K,tt[q])}let et=(function(q,ct){let ht=o.b1([],q[ct[0]],q[ct[1]]),bt=o.b1([],q[ct[2]],q[ct[1]]),mt=[0,0,0,0];return o.b2(mt,o.b3([],ht,bt)),mt[3]=-o.b4(mt,q[ct[0]]),mt})(J,S),it=(function(q,ct){let ht=o.b8(q),bt=o.b9([],q,1/ht),mt=o.b1([],ct,o.a_([],bt,o.b4(ct,bt))),Zt=o.b8(mt);if(Zt>0){let Jt=Math.sqrt(1-bt[3]*bt[3]),Yt=o.a_([],bt,-bt[3]),Gt=o.a$([],Yt,o.a_([],mt,Jt/Zt));return o.ba(ct,Gt)}return null})(L,et);if(it!==null){let q=it/o.b4(_[0],et);K=Math.min(K,q)}for(let q=0;q<4;q++){let ct=Math.min(K,tt[q]);J[q+O]=[J[q+v][0]+_[q][0]*ct,J[q+v][1]+_[q][1]*ct,J[q+v][2]+_[q][2]*ct,1]}})(u,h[0],r,W);let G=h.map((J=>{let S=o.b1([],u[J[0]],u[J[1]]),L=o.b1([],u[J[2]],u[J[1]]),w=o.b2([],o.b3([],S,L)),v=-o.b4(w,u[J[1]]);return w.concat(v)})),Y=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY],y=[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY];for(let J of u)for(let S=0;S<3;S++)Y[S]=Math.min(Y[S],J[S]),y[S]=Math.max(y[S],J[S]);return new Ha(u,G,new Hl(Y,y))}}class je{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(e){this._helper.setMinZoom(e)}setMaxZoom(e){this._helper.setMaxZoom(e)}setMinPitch(e){this._helper.setMinPitch(e)}setMaxPitch(e){this._helper.setMaxPitch(e)}setRenderWorldCopies(e){this._helper.setRenderWorldCopies(e)}setBearing(e){this._helper.setBearing(e)}setPitch(e){this._helper.setPitch(e)}setRoll(e){this._helper.setRoll(e)}setFov(e){this._helper.setFov(e)}setZoom(e){this._helper.setZoom(e)}setCenter(e){this._helper.setCenter(e)}setElevation(e){this._helper.setElevation(e)}setMinElevationForCurrentTile(e){this._helper.setMinElevationForCurrentTile(e)}setPadding(e){this._helper.setPadding(e)}interpolatePadding(e,a,c){return this._helper.interpolatePadding(e,a,c)}isPaddingEqual(e){return this._helper.isPaddingEqual(e)}resize(e,a,c=!0){this._helper.resize(e,a,c)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(e){this._helper.setMaxBounds(e)}setConstrainOverride(e){this._helper.setConstrainOverride(e)}overrideNearFarZ(e,a){this._helper.overrideNearFarZ(e,a)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(e){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),e)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get constrainOverride(){return this._helper.constrainOverride}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(e,a){}constructor(e){this._posMatrixCache=new Map,this._alignedPosMatrixCache=new Map,this._fogMatrixCacheF32=new Map,this.defaultConstrain=(a,c)=>{c=o.an(+c,this.minZoom,this.maxZoom);let r={center:new o.V(a.lng,a.lat),zoom:c},W=this._helper._lngRange;if(!this._helper._renderWorldCopies&&W===null){let _=179.9999999999;W=[-_,_]}let h=this.tileSize*o.aq(r.zoom),g=0,u=h,G=0,Y=h,y=0,J=0,{x:S,y:L}=this.size;if(this._helper._latRange){let _=this._helper._latRange;g=o.X(_[1])*h,u=o.X(_[0])*h,u-g<L&&(y=L/(u-g))}W&&(G=o.W(o.Y(W[0])*h,0,h),Y=o.W(o.Y(W[1])*h,0,h),Y<G&&(Y+=h),Y-G<S&&(J=S/(Y-G)));let{x:w,y:v}=P(h,a),O,K,tt=Math.max(J||0,y||0);if(tt){let _=new o.P(J?(Y+G)/2:w,y?(u+g)/2:v);return r.center=$(h,_).wrap(),r.zoom+=o.at(tt),r}if(this._helper._latRange){let _=L/2;v-_<g&&(K=g+_),v+_>u&&(K=u-_)}if(W){let _=(G+Y)/2,et=w;this._helper._renderWorldCopies&&(et=o.W(w,_-h/2,_+h/2));let it=S/2;et-it<G&&(O=G+it),et+it>Y&&(O=Y-it)}if(O!==void 0||K!==void 0){let _=new o.P(O??w,K??v);r.center=$(h,_).wrap()}return r},this.applyConstrain=(a,c)=>this._helper.applyConstrain(a,c),this._helper=new bi({calcMatrices:()=>{this._calcMatrices()},defaultConstrain:(a,c)=>this.defaultConstrain(a,c)},e),this._coveringTilesDetailsProvider=new Cr}clone(){let e=new je;return e.apply(this),e}apply(e,a,c){this._helper.apply(e,a,c)}get cameraPosition(){return this._cameraPosition}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._viewProjMatrix}get inverseProjectionMatrix(){return this._invProjMatrix}get mercatorMatrix(){return this._mercatorMatrix}getVisibleUnwrappedCoordinates(e){let a=[new o.bb(0,e)];if(this._helper._renderWorldCopies){let c=this.screenPointToMercatorCoordinate(new o.P(0,0)),r=this.screenPointToMercatorCoordinate(new o.P(this._helper._width,0)),W=this.screenPointToMercatorCoordinate(new o.P(this._helper._width,this._helper._height)),h=this.screenPointToMercatorCoordinate(new o.P(0,this._helper._height)),g=Math.floor(Math.min(c.x,r.x,W.x,h.x)),u=Math.floor(Math.max(c.x,r.x,W.x,h.x)),G=1;for(let Y=g-G;Y<=u+G;Y++)Y!==0&&a.push(new o.bb(Y,e))}return a}getCameraFrustum(){return Ha.fromInvProjectionMatrix(this._invViewProjMatrix,this.worldSize)}getClippingPlane(){return null}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(e){let a=this.screenPointToLocation(this.centerPoint,e),c=e?e.getElevationForLngLatZoom(a,this._helper._tileZoom):0;this._helper.recalculateZoomAndCenter(c)}setLocationAtPoint(e,a){let c=o.as(this.elevation,this.center.lat),r=this.screenPointToMercatorCoordinateAtZ(a,c),W=this.screenPointToMercatorCoordinateAtZ(this.centerPoint,c),h=o.aa.fromLngLat(e),g=new o.aa(h.x-(r.x-W.x),h.y-(r.y-W.y));this.setCenter(g?.toLngLat()),this._helper._renderWorldCopies&&this.setCenter(this.center.wrap())}locationToScreenPoint(e,a){return a?this.coordinatePoint(o.aa.fromLngLat(e),a.getElevationForLngLatZoom(e,this._helper._tileZoom),this._pixelMatrix3D):this.coordinatePoint(o.aa.fromLngLat(e))}screenPointToLocation(e,a){var c;return(c=this.screenPointToMercatorCoordinate(e,a))===null||c===void 0?void 0:c.toLngLat()}screenPointToMercatorCoordinate(e,a){if(a){let c=a.pointCoordinate(e);if(c!=null)return c}return this.screenPointToMercatorCoordinateAtZ(e)}screenPointToMercatorCoordinateAtZ(e,a){let c=a||0,r=[e.x,e.y,0,1],W=[e.x,e.y,1,1];o.aG(r,r,this._pixelMatrixInverse),o.aG(W,W,this._pixelMatrixInverse);let h=r[3],g=W[3],u=r[1]/h,G=W[1]/g,Y=r[2]/h,y=W[2]/g,J=Y===y?0:(c-Y)/(y-Y);return new o.aa(o.G.number(r[0]/h,W[0]/g,J)/this.worldSize,o.G.number(u,G,J)/this.worldSize,c)}coordinatePoint(e,a=0,c=this._pixelMatrix){let r=[e.x*this.worldSize,e.y*this.worldSize,a,1];return o.aG(r,r,c),new o.P(r[0]/r[3],r[1]/r[3])}getBounds(){let e=Math.max(0,this._helper._height/2-st(this));return new Ee().extend(this.screenPointToLocation(new o.P(0,e))).extend(this.screenPointToLocation(new o.P(this._helper._width,e))).extend(this.screenPointToLocation(new o.P(this._helper._width,this._helper._height))).extend(this.screenPointToLocation(new o.P(0,this._helper._height)))}isPointOnMapSurface(e,a){return a?a.pointCoordinate(e)!=null:e.y>this.height/2-st(this)}calculatePosMatrix(e,a=!1,c){var r;let W=(r=e.key)!==null&&r!==void 0?r:o.bc(e.wrap,e.canonical.z,e.canonical.z,e.canonical.x,e.canonical.y),h=a?this._alignedPosMatrixCache:this._posMatrixCache;if(h.has(W)){let G=h.get(W);return c?G.f32:G.f64}let g=D(e,this.worldSize);o.S(g,a?this._alignedProjMatrix:this._viewProjMatrix,g);let u={f64:g,f32:new Float32Array(g)};return h.set(W,u),c?u.f32:u.f64}calculateFogMatrix(e){let a=e.key,c=this._fogMatrixCacheF32;if(c.has(a))return c.get(a);let r=D(e,this.worldSize);return o.S(r,this._fogMatrix,r),c.set(a,new Float32Array(r)),c.get(a)}calculateCenterFromCameraLngLatAlt(e,a,c,r){return this._helper.calculateCenterFromCameraLngLatAlt(e,a,c,r)}_calculateNearFarZIfNeeded(e,a,c){if(!this._helper.autoCalculateNearFarZ)return;let r=Math.min(this.elevation,this.minElevationForCurrentTile,this.getCameraAltitude()-100),W=e-r*this._helper._pixelPerMeter/Math.cos(a),h=r<0?W:e,g=Math.PI/2+this.pitchInRadians,u=o.ap(this.fov)*(Math.abs(Math.cos(o.ap(this.roll)))*this.height+Math.abs(Math.sin(o.ap(this.roll)))*this.width)/this.height*(.5+c.y/this.height),G=Math.sin(u)*h/Math.sin(o.an(Math.PI-g-u,.01,Math.PI-.01)),Y=st(this),y=Math.atan(Y/this._helper.cameraToCenterDistance),J=o.ap(.75),S=y>J?2*y*(.5+c.y/(2*Y)):J,L=Math.sin(S)*h/Math.sin(o.an(Math.PI-g-S,.01,Math.PI-.01)),w=Math.min(G,L);this._helper._farZ=1.01*(Math.cos(Math.PI/2-a)*w+h),this._helper._nearZ=this._helper._height/50}_calcMatrices(){if(!this._helper._height)return;let e=this.centerOffset,a=P(this.worldSize,this.center),c=a.x,r=a.y;this._helper._pixelPerMeter=o.as(1,this.center.lat)*this.worldSize;let W=o.ap(Math.min(this.pitch,j)),h=Math.max(this._helper.cameraToCenterDistance/2,this._helper.cameraToCenterDistance+this._helper._elevation*this._helper._pixelPerMeter/Math.cos(W)),g;this._calculateNearFarZIfNeeded(h,W,e),g=new Float64Array(16),o.bd(g,this.fovInRadians,this._helper._width/this._helper._height,this._helper._nearZ,this._helper._farZ),this._invProjMatrix=new Float64Array(16),o.aA(this._invProjMatrix,g),g[8]=2*-e.x/this._helper._width,g[9]=2*e.y/this._helper._height,this._projectionMatrix=o.be(g),o.Q(g,g,[1,-1,1]),o.O(g,g,[0,0,-this._helper.cameraToCenterDistance]),o.bf(g,g,-this.rollInRadians),o.bg(g,g,this.pitchInRadians),o.bf(g,g,-this.bearingInRadians),o.O(g,g,[-c,-r,0]),this._mercatorMatrix=o.Q([],g,[this.worldSize,this.worldSize,this.worldSize]),o.Q(g,g,[1,1,this._helper._pixelPerMeter]),this._pixelMatrix=o.S(new Float64Array(16),this.clipSpaceToPixelsMatrix,g),o.O(g,g,[0,0,-this.elevation]),this._viewProjMatrix=g,this._invViewProjMatrix=o.aA([],g);let u=[0,0,-1,1];o.aG(u,u,this._invViewProjMatrix),this._cameraPosition=[u[0]/u[3],u[1]/u[3],u[2]/u[3]],this._fogMatrix=new Float64Array(16),o.bd(this._fogMatrix,this.fovInRadians,this.width/this.height,h,this._helper._farZ),this._fogMatrix[8]=2*-e.x/this.width,this._fogMatrix[9]=2*e.y/this.height,o.Q(this._fogMatrix,this._fogMatrix,[1,-1,1]),o.O(this._fogMatrix,this._fogMatrix,[0,0,-this.cameraToCenterDistance]),o.bf(this._fogMatrix,this._fogMatrix,-this.rollInRadians),o.bg(this._fogMatrix,this._fogMatrix,this.pitchInRadians),o.bf(this._fogMatrix,this._fogMatrix,-this.bearingInRadians),o.O(this._fogMatrix,this._fogMatrix,[-c,-r,0]),o.Q(this._fogMatrix,this._fogMatrix,[1,1,this._helper._pixelPerMeter]),o.O(this._fogMatrix,this._fogMatrix,[0,0,-this.elevation]),this._pixelMatrix3D=o.S(new Float64Array(16),this.clipSpaceToPixelsMatrix,g);let G=this._helper._width%2/2,Y=this._helper._height%2/2,y=Math.cos(this.bearingInRadians),J=Math.sin(-this.bearingInRadians),S=c-Math.round(c)+y*G+J*Y,L=r-Math.round(r)+y*Y+J*G,w=new Float64Array(g);if(o.O(w,w,[S>.5?S-1:S,L>.5?L-1:L,0]),this._alignedProjMatrix=w,g=o.aA(new Float64Array(16),this._pixelMatrix),!g)throw new Error("failed to invert matrix");this._pixelMatrixInverse=g,this._clearMatrixCaches()}_clearMatrixCaches(){this._posMatrixCache.clear(),this._alignedPosMatrixCache.clear(),this._fogMatrixCacheF32.clear()}maxPitchScaleFactor(){if(!this._pixelMatrixInverse)return 1;let e=this.screenPointToMercatorCoordinate(new o.P(0,0)),a=[e.x*this.worldSize,e.y*this.worldSize,0,1];return o.aG(a,a,this._pixelMatrix)[3]/this._helper.cameraToCenterDistance}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){let e=o.as(1,this.center.lat)*this.worldSize;return ot(this.center,this.elevation,this.pitch,this.bearing,this._helper.cameraToCenterDistance/e).toLngLat()}lngLatToCameraDepth(e,a){let c=o.aa.fromLngLat(e),r=[c.x*this.worldSize,c.y*this.worldSize,a,1];return o.aG(r,r,this._viewProjMatrix),r[2]/r[3]}getProjectionData(e){let{overscaledTileID:a,aligned:c,applyTerrainMatrix:r}=e,W=this._helper.getMercatorTileCoordinates(a),h=a?this.calculatePosMatrix(a,c,!0):null,g;return g=a&&a.terrainRttPosMatrix32f&&r?a.terrainRttPosMatrix32f:h||o.bh(),{mainMatrix:g,tileMercatorCoords:W,clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:g}}isLocationOccluded(e){return!1}getPixelScale(){return 1}getCircleRadiusCorrection(){return 1}getPitchedTextCorrection(e,a,c){return 1}transformLightDirection(e){return o.b0(e)}getRayDirectionFromPixel(e){throw new Error("Not implemented.")}projectTileCoordinates(e,a,c,r){let W=this.calculatePosMatrix(c),h;r?(h=[e,a,r(e,a),1],o.aG(h,h,W)):(h=[e,a,0,1],Rd(h,h,W));let g=h[3];return{point:new o.P(h[0]/g,h[1]/g),signedDistanceFromCamera:g,isOccluded:!1}}populateCache(e){for(let a of e)this.calculatePosMatrix(a)}getMatrixForModel(e,a){let c=o.aa.fromLngLat(e,a),r=c.meterInMercatorCoordinateUnits(),W=o.bi();return o.O(W,W,[c.x,c.y,c.z]),o.bf(W,W,Math.PI),o.bg(W,W,Math.PI/2),o.Q(W,W,[-r,r,r]),W}getProjectionDataForCustomLayer(e=!0){let a=new o.a1(0,0,0,0,0),c=this.getProjectionData({overscaledTileID:a,applyGlobeMatrix:e}),r=D(a,this.worldSize);o.S(r,this._viewProjMatrix,r),c.tileMercatorCoords=[0,0,1,1];let W=[o.a4,o.a4,this.worldSize/this._helper.pixelsPerMeter],h=o.bj();return o.Q(h,r,W),c.fallbackMatrix=h,c.mainMatrix=h,c}getFastPathSimpleProjectionMatrix(e){return this.calculatePosMatrix(e)}}function jn(){o.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}function Da(m){if(m.useSlerp)if(m.k<1){let e=o.bk(m.startEulerAngles.roll,m.startEulerAngles.pitch,m.startEulerAngles.bearing),a=o.bk(m.endEulerAngles.roll,m.endEulerAngles.pitch,m.endEulerAngles.bearing),c=new Float64Array(4);o.bl(c,e,a,m.k);let r=o.bm(c);m.tr.setRoll(r.roll),m.tr.setPitch(r.pitch),m.tr.setBearing(r.bearing)}else m.tr.setRoll(m.endEulerAngles.roll),m.tr.setPitch(m.endEulerAngles.pitch),m.tr.setBearing(m.endEulerAngles.bearing);else m.tr.setRoll(o.G.number(m.startEulerAngles.roll,m.endEulerAngles.roll,m.k)),m.tr.setPitch(o.G.number(m.startEulerAngles.pitch,m.endEulerAngles.pitch,m.k)),m.tr.setBearing(o.G.number(m.startEulerAngles.bearing,m.endEulerAngles.bearing,m.k))}function ud(m,e,a,c,r){let W=r.padding,h=P(r.worldSize,a.getNorthWest()),g=P(r.worldSize,a.getNorthEast()),u=P(r.worldSize,a.getSouthEast()),G=P(r.worldSize,a.getSouthWest()),Y=o.ap(-c),y=h.rotate(Y),J=g.rotate(Y),S=u.rotate(Y),L=G.rotate(Y),w=new o.P(Math.max(y.x,J.x,L.x,S.x),Math.max(y.y,J.y,L.y,S.y)),v=new o.P(Math.min(y.x,J.x,L.x,S.x),Math.min(y.y,J.y,L.y,S.y)),O=w.sub(v),K=(r.width-(W.left+W.right+e.left+e.right))/O.x,tt=(r.height-(W.top+W.bottom+e.top+e.bottom))/O.y;if(tt<0||K<0)return void jn();let _=Math.min(o.at(r.scale*Math.min(K,tt)),m.maxZoom),et=o.P.convert(m.offset),it=new o.P((e.left-e.right)/2,(e.top-e.bottom)/2).rotate(o.ap(c)),q=et.add(it).mult(r.scale/o.aq(_));return{center:$(r.worldSize,h.add(u).div(2).sub(q)),zoom:_,bearing:c}}class mi{get useGlobeControls(){return!1}handlePanInertia(e,a){let c=e.mag(),r=Math.abs(st(a));return{easingOffset:e.mult(Math.min(.75*r/c,1)),easingCenter:a.center}}handleMapControlsRollPitchBearingZoom(e,a){e.bearingDelta&&a.setBearing(a.bearing+e.bearingDelta),e.pitchDelta&&a.setPitch(a.pitch+e.pitchDelta),e.rollDelta&&a.setRoll(a.roll+e.rollDelta),e.zoomDelta&&a.setZoom(a.zoom+e.zoomDelta)}handleMapControlsPan(e,a,c){e.around.distSqr(a.centerPoint)<.01||a.setLocationAtPoint(c,e.around)}cameraForBoxAndBearing(e,a,c,r,W){return ud(e,a,c,r,W)}handleJumpToCenterZoom(e,a){e.zoom!==(a.zoom!==void 0?+a.zoom:e.zoom)&&e.setZoom(+a.zoom),a.center!==void 0&&e.setCenter(o.V.convert(a.center))}handleEaseTo(e,a){let c=e.zoom,r=e.padding,W={roll:e.roll,pitch:e.pitch,bearing:e.bearing},h={roll:a.roll===void 0?e.roll:a.roll,pitch:a.pitch===void 0?e.pitch:a.pitch,bearing:a.bearing===void 0?e.bearing:a.bearing},g=a.zoom!==void 0,u=!e.isPaddingEqual(a.padding),G=!1,Y=g?+a.zoom:e.zoom,y=e.centerPoint.add(a.offsetAsPoint),J=e.screenPointToLocation(y),{center:S,zoom:L}=e.applyConstrain(o.V.convert(a.center||J),Y??c);Gc(e,S);let w=P(e.worldSize,J),v=P(e.worldSize,S).sub(w),O=o.aq(L-c);return G=L!==c,{easeFunc:K=>{if(G&&e.setZoom(o.G.number(c,L,K)),o.bn(W,h)||Da({startEulerAngles:W,endEulerAngles:h,tr:e,k:K,useSlerp:W.roll!=h.roll}),u&&(e.interpolatePadding(r,a.padding,K),y=e.centerPoint.add(a.offsetAsPoint)),a.around)e.setLocationAtPoint(a.around,a.aroundPoint);else{let tt=o.aq(e.zoom-c),_=L>c?Math.min(2,O):Math.max(.5,O),et=Math.pow(_,1-K),it=$(e.worldSize,w.add(v.mult(K*et)).mult(tt));e.setLocationAtPoint(e.renderWorldCopies?it.wrap():it,y)}},isZooming:G,elevationCenter:S}}handleFlyTo(e,a){let c=a.zoom!==void 0,r=e.zoom,W=e.applyConstrain(o.V.convert(a.center||a.locationAtOffset),c?+a.zoom:r),h=W.center,g=W.zoom;Gc(e,h);let u=P(e.worldSize,a.locationAtOffset),G=P(e.worldSize,h).sub(u),Y=G.mag(),y=o.aq(g-r),J;if(a.minZoom!==void 0){let S=Math.min(+a.minZoom,r,g),L=e.applyConstrain(h,S).zoom;J=o.aq(L-r)}return{easeFunc:(S,L,w,v)=>{e.setZoom(S===1?g:r+o.at(L));let O=S===1?h:$(e.worldSize,u.add(G.mult(w)).mult(L));e.setLocationAtPoint(e.renderWorldCopies?O.wrap():O,v)},scaleOfZoom:y,targetCenter:h,scaleOfMinZoom:J,pixelPathLength:Y}}}class Ae{constructor(e,a,c){this.blendFunction=e,this.blendColor=a,this.mask=c}}Ae.Replace=[1,0],Ae.disabled=new Ae(Ae.Replace,o.bo.transparent,[!1,!1,!1,!1]),Ae.unblended=new Ae(Ae.Replace,o.bo.transparent,[!0,!0,!0,!0]),Ae.alphaBlended=new Ae([1,771],o.bo.transparent,[!0,!0,!0,!0]);let da=2305;class pe{constructor(e,a,c){this.enable=e,this.mode=a,this.frontFace=c}}pe.disabled=new pe(!1,1029,da),pe.backCCW=new pe(!0,1029,da),pe.frontCCW=new pe(!0,1028,da);class de{constructor(e,a,c){this.func=e,this.mask=a,this.range=c}}de.ReadOnly=!1,de.ReadWrite=!0,de.disabled=new de(519,de.ReadOnly,[0,1]);let An=7680;class Ve{constructor(e,a,c,r,W,h){this.test=e,this.ref=a,this.mask=c,this.fail=r,this.depthFail=W,this.pass=h}}Ve.disabled=new Ve({func:519,mask:0},0,0,An,An,An);let wn=new WeakMap;function Hi(m){var e;if(wn.has(m))return wn.get(m);{let a=(e=m.getParameter(m.VERSION))===null||e===void 0?void 0:e.startsWith("WebGL 2.0");return wn.set(m,a),a}}class Fd{get awaitingQuery(){return!!this._readbackQueue}constructor(e){this._readbackWaitFrames=4,this._measureWaitFrames=6,this._texWidth=1,this._texHeight=1,this._measuredError=0,this._updateCount=0,this._lastReadbackFrame=-1e3,this._readbackQueue=null,this._cachedRenderContext=e;let a=e.context,c=a.gl;this._texFormat=c.RGBA,this._texType=c.UNSIGNED_BYTE;let r=new o.aV;r.emplaceBack(-1,-1),r.emplaceBack(2,-1),r.emplaceBack(-1,2);let W=new o.aX;W.emplaceBack(0,1,2),this._fullscreenTriangle=new va(a.createVertexBuffer(r,Zl.members),a.createIndexBuffer(W),o.aW.simpleSegment(0,0,r.length,W.length)),this._resultBuffer=new Uint8Array(4),a.activeTexture.set(c.TEXTURE1);let h=c.createTexture();c.bindTexture(c.TEXTURE_2D,h),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,c.CLAMP_TO_EDGE),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,c.CLAMP_TO_EDGE),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,c.NEAREST),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,c.NEAREST),c.texImage2D(c.TEXTURE_2D,0,this._texFormat,this._texWidth,this._texHeight,0,this._texFormat,this._texType,null),this._fbo=a.createFramebuffer(this._texWidth,this._texHeight,!1,!1),this._fbo.colorAttachment.set(h),Hi(c)&&(this._pbo=c.createBuffer(),c.bindBuffer(c.PIXEL_PACK_BUFFER,this._pbo),c.bufferData(c.PIXEL_PACK_BUFFER,4,c.STREAM_READ),c.bindBuffer(c.PIXEL_PACK_BUFFER,null))}destroy(){let e=this._cachedRenderContext.context.gl;this._fullscreenTriangle.destroy(),this._fbo.destroy(),e.deleteBuffer(this._pbo),this._fullscreenTriangle=null,this._fbo=null,this._pbo=null,this._resultBuffer=null}updateErrorLoop(e,a){let c=this._updateCount;return this._readbackQueue?c>=this._readbackQueue.frameNumberIssued+this._readbackWaitFrames&&this._tryReadback():c>=this._lastReadbackFrame+this._measureWaitFrames&&this._renderErrorTexture(e,a),this._updateCount++,this._measuredError}_bindFramebuffer(){let e=this._cachedRenderContext.context,a=e.gl;e.activeTexture.set(a.TEXTURE1),a.bindTexture(a.TEXTURE_2D,this._fbo.colorAttachment.get()),e.bindFramebuffer.set(this._fbo.framebuffer)}_renderErrorTexture(e,a){let c=this._cachedRenderContext.context,r=c.gl;if(this._bindFramebuffer(),c.viewport.set([0,0,this._texWidth,this._texHeight]),c.clear({color:o.bo.transparent}),this._cachedRenderContext.useProgram("projectionErrorMeasurement").draw(c,r.TRIANGLES,de.disabled,Ve.disabled,Ae.unblended,pe.disabled,((W,h)=>({u_input:W,u_output_expected:h}))(e,a),null,null,"$clipping",this._fullscreenTriangle.vertexBuffer,this._fullscreenTriangle.indexBuffer,this._fullscreenTriangle.segments),this._pbo&&Hi(r)){r.bindBuffer(r.PIXEL_PACK_BUFFER,this._pbo),r.readBuffer(r.COLOR_ATTACHMENT0),r.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,0),r.bindBuffer(r.PIXEL_PACK_BUFFER,null);let W=r.fenceSync(r.SYNC_GPU_COMMANDS_COMPLETE,0);r.flush(),this._readbackQueue={frameNumberIssued:this._updateCount,sync:W}}else this._readbackQueue={frameNumberIssued:this._updateCount,sync:null}}_tryReadback(){let e=this._cachedRenderContext.context.gl;if(this._pbo&&this._readbackQueue&&Hi(e)){let a=e.clientWaitSync(this._readbackQueue.sync,0,0);if(a===e.WAIT_FAILED)return o.w("WebGL2 clientWaitSync failed."),this._readbackQueue=null,void(this._lastReadbackFrame=this._updateCount);if(a===e.TIMEOUT_EXPIRED)return;e.bindBuffer(e.PIXEL_PACK_BUFFER,this._pbo),e.getBufferSubData(e.PIXEL_PACK_BUFFER,0,this._resultBuffer,0,4),e.bindBuffer(e.PIXEL_PACK_BUFFER,null)}else this._bindFramebuffer(),e.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,this._resultBuffer);this._readbackQueue=null,this._measuredError=Fd._parseRGBA8float(this._resultBuffer),this._lastReadbackFrame=this._updateCount}static _parseRGBA8float(e){let a=0;return a+=e[0]/256,a+=e[1]/65536,a+=e[2]/16777216,e[3]<127&&(a=-a),a/128}}let on=o.a4/128;function Nc(m,e){let a=m.granularity!==void 0?Math.max(m.granularity,1):1,c=a+(m.generateBorders?2:0),r=a+(m.extendToNorthPole||m.generateBorders?1:0)+(m.extendToSouthPole||m.generateBorders?1:0),W=c+1,h=r+1,g=m.generateBorders?-1:0,u=m.generateBorders||m.extendToNorthPole?-1:0,G=a+(m.generateBorders?1:0),Y=a+(m.generateBorders||m.extendToSouthPole?1:0),y=W*h,J=c*r*6,S=W*h>65536;if(S&&e==="16bit")throw new Error("Granularity is too large and meshes would not fit inside 16 bit vertex indices.");let L=S||e==="32bit",w=new Int16Array(2*y),v=0;for(let tt=u;tt<=Y;tt++)for(let _=g;_<=G;_++){let et=_/a*o.a4;_===-1&&(et=-on),_===a+1&&(et=o.a4+on);let it=tt/a*o.a4;tt===-1&&(it=m.extendToNorthPole?o.bq:-on),tt===a+1&&(it=m.extendToSouthPole?o.br:o.a4+on),w[v++]=et,w[v++]=it}let O=L?new Uint32Array(J):new Uint16Array(J),K=0;for(let tt=0;tt<r;tt++)for(let _=0;_<c;_++){let et=_+1+tt*W,it=_+(tt+1)*W,q=_+1+(tt+1)*W;O[K++]=_+tt*W,O[K++]=it,O[K++]=et,O[K++]=et,O[K++]=it,O[K++]=q}return{vertices:w.buffer.slice(0),indices:O.buffer.slice(0),uses32bitIndices:L}}let Gd=new o.aU({fill:new o.bs(128,2),line:new o.bs(512,0),tile:new o.bs(128,32),stencil:new o.bs(128,1),circle:3});class Nd{constructor(){this._tileMeshCache={},this._errorCorrectionUsable=0,this._errorMeasurementLastValue=0,this._errorCorrectionPreviousValue=0,this._errorMeasurementLastChangeTime=-1e3}get name(){return"vertical-perspective"}get transitionState(){return 1}get useSubdivision(){return!0}get shaderVariantName(){return"globe"}get shaderDefine(){return"#define GLOBE"}get shaderPreludeCode(){return yi.projectionGlobe}get vertexShaderPreludeCode(){return yi.projectionMercator.vertexSource}get subdivisionGranularity(){return Gd}get useGlobeControls(){return!0}get latitudeErrorCorrectionRadians(){return this._errorCorrectionUsable}destroy(){this._errorMeasurement&&this._errorMeasurement.destroy()}updateGPUdependent(e){this._errorMeasurement||(this._errorMeasurement=new Fd(e));let a=o.X(this._errorQueryLatitudeDegrees),c=2*Math.atan(Math.exp(Math.PI-a*Math.PI*2))-.5*Math.PI,r=this._errorMeasurement.updateErrorLoop(a,c),W=Ct();r!==this._errorMeasurementLastValue&&(this._errorCorrectionPreviousValue=this._errorCorrectionUsable,this._errorMeasurementLastValue=r,this._errorMeasurementLastChangeTime=W);let h=Math.min(Math.max((W-this._errorMeasurementLastChangeTime)/1e3/.5,0),1);this._errorCorrectionUsable=o.bt(this._errorCorrectionPreviousValue,-this._errorMeasurementLastValue,o.bu(h))}_getMeshKey(e){return`${e.granularity.toString(36)}_${e.generateBorders?"b":""}${e.extendToNorthPole?"n":""}${e.extendToSouthPole?"s":""}`}getMeshFromTileID(e,a,c,r,W){let h=(W==="stencil"?Gd.stencil:Gd.tile).getGranularityForZoomLevel(a.z);return this._getMesh(e,{granularity:h,generateBorders:c,extendToNorthPole:a.y===0&&r,extendToSouthPole:a.y===(1<<a.z)-1&&r})}_getMesh(e,a){let c=this._getMeshKey(a);if(c in this._tileMeshCache)return this._tileMeshCache[c];let r=(function(W,h){let g=Nc(h,"16bit"),u=o.aV.deserialize({arrayBuffer:g.vertices,length:g.vertices.byteLength/2/2}),G=o.aX.deserialize({arrayBuffer:g.indices,length:g.indices.byteLength/2/3});return new va(W.createVertexBuffer(u,Zl.members),W.createIndexBuffer(G),o.aW.simpleSegment(0,0,u.length,G.length))})(e,a);return this._tileMeshCache[c]=r,r}recalculate(e){}hasTransition(){let e=Ct(),a=!1;return a=a||(e-this._errorMeasurementLastChangeTime)/1e3<.7,a=a||this._errorMeasurement&&this._errorMeasurement.awaitingQuery,a}setErrorQueryLatitudeDegrees(e){this._errorQueryLatitudeDegrees=e}}let Ic=new o.t({type:new o.D(o.u.projection.type)});class vn extends o.E{constructor(e){super(),this._transitionable=new o.x(Ic,void 0),this.setProjection(e),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new o.H(0)),this._mercatorProjection=new Gl,this._verticalPerspectiveProjection=new Nd}get transitionState(){let e=this.properties.get("type");if(typeof e=="string"&&e==="mercator")return 0;if(typeof e=="string"&&e==="vertical-perspective")return 1;if(e instanceof o.bv){if(e.from==="vertical-perspective"&&e.to==="mercator")return 1-e.transition;if(e.from==="mercator"&&e.to==="vertical-perspective")return e.transition}return 1}get useGlobeRendering(){return this.transitionState>0}get latitudeErrorCorrectionRadians(){return this._verticalPerspectiveProjection.latitudeErrorCorrectionRadians}get currentProjection(){return this.useGlobeRendering?this._verticalPerspectiveProjection:this._mercatorProjection}get name(){return"globe"}get useSubdivision(){return this.currentProjection.useSubdivision}get shaderVariantName(){return this.currentProjection.shaderVariantName}get shaderDefine(){return this.currentProjection.shaderDefine}get shaderPreludeCode(){return this.currentProjection.shaderPreludeCode}get vertexShaderPreludeCode(){return this.currentProjection.vertexShaderPreludeCode}get subdivisionGranularity(){return this.currentProjection.subdivisionGranularity}get useGlobeControls(){return this.transitionState>0}destroy(){this._mercatorProjection.destroy(),this._verticalPerspectiveProjection.destroy()}updateGPUdependent(e){this._mercatorProjection.updateGPUdependent(e),this._verticalPerspectiveProjection.updateGPUdependent(e)}getMeshFromTileID(e,a,c,r,W){return this.currentProjection.getMeshFromTileID(e,a,c,r,W)}setProjection(e){this._transitionable.setValue("type",e?.type||"mercator")}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()||this.currentProjection.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}setErrorQueryLatitudeDegrees(e){this._verticalPerspectiveProjection.setErrorQueryLatitudeDegrees(e),this._mercatorProjection.setErrorQueryLatitudeDegrees(e)}}function Qr(m){let e=Uc(m.worldSize,m.center.lat);return 2*Math.PI*e}function ca(m,e,a,c,r){let W=1/(1<<r),h=e/o.a4*W+c*W,g=o.bx((m/o.a4*W+a*W)*Math.PI*2+Math.PI,2*Math.PI),u=2*Math.atan(Math.exp(Math.PI-h*Math.PI*2))-.5*Math.PI,G=Math.cos(u),Y=new Float64Array(3);return Y[0]=Math.sin(g)*G,Y[1]=Math.sin(u),Y[2]=Math.cos(g)*G,Y}function kl(m){return(function(e,a){let c=Math.cos(a),r=new Float64Array(3);return r[0]=Math.sin(e)*c,r[1]=Math.sin(a),r[2]=Math.cos(e)*c,r})(m.lng*Math.PI/180,m.lat*Math.PI/180)}function Uc(m,e){return m/(2*Math.PI)/Math.cos(e*Math.PI/180)}function kr(m){let e=Math.asin(m[1])/Math.PI*180,a=Math.sqrt(m[0]*m[0]+m[2]*m[2]);if(a>1e-6){let c=m[0]/a,r=Math.acos(m[2]/a),W=(c>0?r:-r)/Math.PI*180;return new o.V(o.W(W,-180,180),e)}return new o.V(0,e)}function Ll(m){return Math.cos(m*Math.PI/180)}function hl(m,e){let a=Ll(m),c=Ll(e);return o.at(c/a)}function Di(m,e){let a=m.rotate(e.bearingInRadians),c=e.zoom+hl(e.center.lat,0),r=o.bt(1/Ll(e.center.lat),1/Ll(Math.min(Math.abs(e.center.lat),60)),o.bw(c,7,3,0,1)),W=360/Qr({worldSize:e.worldSize,center:{lat:e.center.lat}});return new o.V(e.center.lng-a.x*W*r,o.an(e.center.lat+a.y*W,-o.ao,o.ao))}function Hn(m){let e=.5*m,a=Math.sin(e),c=Math.cos(e);return Math.log(a+c)-Math.log(c-a)}function Oo(m,e,a,c){let r=m.lat+a*c;if(Math.abs(a)>1){let W=(Math.sign(m.lat+a)!==Math.sign(m.lat)?-Math.abs(m.lat):Math.abs(m.lat))*Math.PI/180,h=Math.abs(m.lat+a)*Math.PI/180,g=Hn(W+c*(h-W)),u=Hn(W),G=Hn(h);return new o.V(m.lng+e*((g-u)/(G-u)),r)}return new o.V(m.lng+e*c,r)}class Lr{constructor(e){this._cachePrevious=new Map,this._cache=new Map,this._hadAnyChanges=!1,this._boundingVolumeFactory=e}swapBuffers(){if(!this._hadAnyChanges)return;let e=this._cachePrevious;this._cachePrevious=this._cache,this._cache=e,this._cache.clear(),this._hadAnyChanges=!1}getTileBoundingVolume(e,a,c,r){let W=`${e.z}_${e.x}_${e.y}_${r?.terrain?"t":""}`,h=this._cache.get(W);if(h)return h;let g=this._cachePrevious.get(W);if(g)return this._cache.set(W,g),g;let u=this._boundingVolumeFactory(e,a,c,r);return this._cache.set(W,u),this._hadAnyChanges=!0,u}}class Oi{constructor(e,a,c,r){this.min=c,this.max=r,this.points=e,this.planes=a}static fromAabb(e,a){let c=[];for(let r=0;r<8;r++)c.push([1&~r?e[0]:a[0],(r>>1&1)==1?a[1]:e[1],(r>>2&1)==1?a[2]:e[2]]);return new Oi(c,[[-1,0,0,a[0]],[1,0,0,-e[0]],[0,-1,0,a[1]],[0,1,0,-e[1]],[0,0,-1,a[2]],[0,0,1,-e[2]]],e,a)}static fromCenterSizeAngles(e,a,c){let r=o.bA([],c[0],c[1],c[2]),W=o.bB([],[a[0],0,0],r),h=o.bB([],[0,a[1],0],r),g=o.bB([],[0,0,a[2]],r),u=[...e],G=[...e];for(let y=0;y<8;y++)for(let J=0;J<3;J++){let S=e[J]+W[J]*(1&~y?-1:1)+h[J]*((y>>1&1)==1?1:-1)+g[J]*((y>>2&1)==1?1:-1);u[J]=Math.min(u[J],S),G[J]=Math.max(G[J],S)}let Y=[];for(let y=0;y<8;y++){let J=[...e];o.a$(J,J,o.a_([],W,1&~y?-1:1)),o.a$(J,J,o.a_([],h,(y>>1&1)==1?1:-1)),o.a$(J,J,o.a_([],g,(y>>2&1)==1?1:-1)),Y.push(J)}return new Oi(Y,[[...W,-o.b4(W,Y[0])],[...h,-o.b4(h,Y[0])],[...g,-o.b4(g,Y[0])],[-W[0],-W[1],-W[2],-o.b4(W,Y[7])],[-h[0],-h[1],-h[2],-o.b4(h,Y[7])],[-g[0],-g[1],-g[2],-o.b4(g,Y[7])]],u,G)}intersectsFrustum(e){let a=!0,c=this.points.length,r=this.planes.length,W=e.planes.length,h=e.points.length;for(let g=0;g<W;g++){let u=e.planes[g],G=0;for(let Y=0;Y<c;Y++){let y=this.points[Y];u[0]*y[0]+u[1]*y[1]+u[2]*y[2]+u[3]>=0&&G++}if(G===0)return 0;G<c&&(a=!1)}if(a)return 2;for(let g=0;g<r;g++){let u=this.planes[g],G=0;for(let Y=0;Y<h;Y++){let y=e.points[Y];u[0]*y[0]+u[1]*y[1]+u[2]*y[2]+u[3]>=0&&G++}if(G===0)return 0}return 1}intersectsPlane(e){let a=this.points.length,c=0;for(let r=0;r<a;r++){let W=this.points[r];e[0]*W[0]+e[1]*W[1]+e[2]*W[2]+e[3]>=0&&c++}return c===a?2:c===0?0:1}}function Mc(m,e,a){let c=m-e;return c<0?-c:Math.max(0,c-a)}function fo(m,e,a,c,r){let W=m-a,h;return h=W<0?Math.min(-W,1+W-r):W>1?Math.min(Math.max(W-r,0),1-W):0,Math.max(h,Mc(e,c,r))}class Qb{constructor(){this._boundingVolumeCache=new Lr(this._computeTileBoundingVolume)}prepareNextFrame(){this._boundingVolumeCache.swapBuffers()}distanceToTile2d(e,a,c,r){let W=1<<c.z,h=1/W,g=c.x/W,u=c.y/W,G=2;return G=Math.min(G,fo(e,a,g,u,h)),G=Math.min(G,fo(e,a,g+.5,-u-h,h)),G=Math.min(G,fo(e,a,g+.5,2-u-h,h)),G}getWrap(e,a,c){let r=1<<a.z,W=1/r,h=a.x/r,g=Mc(e.x,h,W),u=Mc(e.x,h-1,W),G=Mc(e.x,h+1,W),Y=Math.min(g,u,G);return Y===G?1:Y===u?-1:0}allowVariableZoom(e,a){return Ht(e,a)>4}allowWorldCopies(){return!1}getTileBoundingVolume(e,a,c,r){return this._boundingVolumeCache.getTileBoundingVolume(e,a,c,r)}_computeTileBoundingVolume(e,a,c,r){var W,h;let g=0,u=0;if(r?.terrain){let G=new o.a1(e.z,a,e.z,e.x,e.y),Y=r.terrain.getMinMaxElevation(G);g=(W=Y.minElevation)!==null&&W!==void 0?W:Math.min(0,c),u=(h=Y.maxElevation)!==null&&h!==void 0?h:Math.max(0,c)}if(g/=o.bD,u/=o.bD,g+=1,u+=1,e.z<=0)return Oi.fromAabb([-u,-u,-u],[u,u,u]);if(e.z===1)return Oi.fromAabb([e.x===0?-u:0,e.y===0?0:-u,-u],[e.x===0?0:u,e.y===0?u:0,u]);{let G=[ca(0,0,e.x,e.y,e.z),ca(o.a4,0,e.x,e.y,e.z),ca(o.a4,o.a4,e.x,e.y,e.z),ca(0,o.a4,e.x,e.y,e.z)],Y=[];for(let mt of G)Y.push(o.a_([],mt,u));if(u!==g)for(let mt of G)Y.push(o.a_([],mt,g));e.y===0&&Y.push([0,1,0]),e.y===(1<<e.z)-1&&Y.push([0,-1,0]);let y=[1,1,1],J=[-1,-1,-1];for(let mt of Y)for(let Zt=0;Zt<3;Zt++)y[Zt]=Math.min(y[Zt],mt[Zt]),J[Zt]=Math.max(J[Zt],mt[Zt]);let S=ca(o.a4/2,o.a4/2,e.x,e.y,e.z),L=o.b3([],[0,1,0],S);o.b2(L,L);let w=o.b3([],S,L);o.b2(w,w);let v=o.b3([],G[2],G[1]);o.b2(v,v);let O=o.b3([],G[0],G[3]);o.b2(O,O),Y.push(o.a_([],S,u)),e.y>=(1<<e.z)/2&&Y.push(o.a_([],ca(o.a4/2,0,e.x,e.y,e.z),u)),e.y<(1<<e.z)/2&&Y.push(o.a_([],ca(o.a4/2,o.a4,e.x,e.y,e.z),u));let K=Er(S,Y),tt=Er(w,Y),_=[-S[0],-S[1],-S[2],K.max],et=[S[0],S[1],S[2],-K.min],it=[-w[0],-w[1],-w[2],tt.max],q=[w[0],w[1],w[2],-tt.min],ct=[...v,0],ht=[...O,0],bt=[];return e.y===0?bt.push(o.bC(ht,ct,_),o.bC(ht,ct,et)):bt.push(o.bC(it,ct,_),o.bC(it,ct,et),o.bC(it,ht,_),o.bC(it,ht,et)),e.y===(1<<e.z)-1?bt.push(o.bC(ht,ct,_),o.bC(ht,ct,et)):bt.push(o.bC(q,ct,_),o.bC(q,ct,et),o.bC(q,ht,_),o.bC(q,ht,et)),new Oi(bt,[_,et,it,q,ct,ht],y,J)}}}function Er(m,e){let a=1/0,c=-1/0;for(let r of e){let W=o.b4(m,r);a=Math.min(a,W),c=Math.max(c,W)}return{min:a,max:c}}class Yc{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(e){this._helper.setMinZoom(e)}setMaxZoom(e){this._helper.setMaxZoom(e)}setMinPitch(e){this._helper.setMinPitch(e)}setMaxPitch(e){this._helper.setMaxPitch(e)}setRenderWorldCopies(e){this._helper.setRenderWorldCopies(e)}setBearing(e){this._helper.setBearing(e)}setPitch(e){this._helper.setPitch(e)}setRoll(e){this._helper.setRoll(e)}setFov(e){this._helper.setFov(e)}setZoom(e){this._helper.setZoom(e)}setCenter(e){this._helper.setCenter(e)}setElevation(e){this._helper.setElevation(e)}setMinElevationForCurrentTile(e){this._helper.setMinElevationForCurrentTile(e)}setPadding(e){this._helper.setPadding(e)}interpolatePadding(e,a,c){return this._helper.interpolatePadding(e,a,c)}isPaddingEqual(e){return this._helper.isPaddingEqual(e)}resize(e,a){this._helper.resize(e,a)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(e){this._helper.setMaxBounds(e)}setConstrainOverride(e){this._helper.setConstrainOverride(e)}overrideNearFarZ(e,a){this._helper.overrideNearFarZ(e,a)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(e){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),e)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get constrainOverride(){return this._helper.constrainOverride}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(e){}constructor(e){this._cachedClippingPlane=o.bE(),this._projectionMatrix=o.bi(),this._globeViewProjMatrix32f=o.bh(),this._globeViewProjMatrixNoCorrection=o.bi(),this._globeViewProjMatrixNoCorrectionInverted=o.bi(),this._globeProjMatrixInverted=o.bi(),this._cameraPosition=o.by(),this._globeLatitudeErrorCorrectionRadians=0,this.defaultConstrain=(a,c)=>{let r=o.an(a.lat,-o.ao,o.ao),W=o.an(+c,this.minZoom+hl(0,r),this.maxZoom);return{center:new o.V(a.lng,r),zoom:W}},this.applyConstrain=(a,c)=>this._helper.applyConstrain(a,c),this._helper=new bi({calcMatrices:()=>{this._calcMatrices()},defaultConstrain:(a,c)=>this.defaultConstrain(a,c)},e),this._coveringTilesDetailsProvider=new Qb}clone(){let e=new Yc;return e.apply(this),e}apply(e,a){this._globeLatitudeErrorCorrectionRadians=a||0,this._helper.apply(e)}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._globeViewProjMatrixNoCorrection}get inverseProjectionMatrix(){return this._globeProjMatrixInverted}get cameraPosition(){let e=o.by();return e[0]=this._cameraPosition[0],e[1]=this._cameraPosition[1],e[2]=this._cameraPosition[2],e}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}getProjectionData(e){let{overscaledTileID:a,applyGlobeMatrix:c}=e,r=this._helper.getMercatorTileCoordinates(a);return{mainMatrix:this._globeViewProjMatrix32f,tileMercatorCoords:r,clippingPlane:this._cachedClippingPlane,projectionTransition:c?1:0,fallbackMatrix:this._globeViewProjMatrix32f}}_computeClippingPlane(e){let a=this.pitchInRadians,c=this.cameraToCenterDistance/e,r=Math.sin(a)*c,W=Math.cos(a)*c+1,h=1/Math.sqrt(r*r+W*W)*1,g=-r,u=W,G=Math.sqrt(g*g+u*u);g/=G,u/=G;let Y=[0,g,u];o.bF(Y,Y,[0,0,0],-this.bearingInRadians),o.bG(Y,Y,[0,0,0],-1*this.center.lat*Math.PI/180),o.bH(Y,Y,[0,0,0],this.center.lng*Math.PI/180);let y=1/o.b6(Y);return o.a_(Y,Y,y),[...Y,-h*y]}isLocationOccluded(e){return!this.isSurfacePointVisible(kl(e))}transformLightDirection(e){let a=this._helper._center.lng*Math.PI/180,c=this._helper._center.lat*Math.PI/180,r=Math.cos(c),W=[Math.sin(a)*r,Math.sin(c),Math.cos(a)*r],h=[W[2],0,-W[0]],g=[0,0,0];o.b3(g,h,W),o.b2(h,h),o.b2(g,g);let u=[0,0,0];return o.b2(u,[h[0]*e[0]+g[0]*e[1]+W[0]*e[2],h[1]*e[0]+g[1]*e[1]+W[1]*e[2],h[2]*e[0]+g[2]*e[1]+W[2]*e[2]]),u}getPixelScale(){return 1/Math.cos(this._helper._center.lat*Math.PI/180)}getCircleRadiusCorrection(){return Math.cos(this._helper._center.lat*Math.PI/180)}getPitchedTextCorrection(e,a,c){let r=(function(g,u,G){let Y=1/(1<<G.z);return new o.aa(g/o.a4*Y+G.x*Y,u/o.a4*Y+G.y*Y)})(e,a,c.canonical),W=(h=r.y,[o.bx(r.x*Math.PI*2+Math.PI,2*Math.PI),2*Math.atan(Math.exp(Math.PI-h*Math.PI*2))-.5*Math.PI]);var h;return this.getCircleRadiusCorrection()/Math.cos(W[1])}projectTileCoordinates(e,a,c,r){let W=c.canonical,h=ca(e,a,W.x,W.y,W.z),g=1+(r?r(e,a):0)/o.bD,u=[h[0]*g,h[1]*g,h[2]*g,1];o.aG(u,u,this._globeViewProjMatrixNoCorrection);let G=this._cachedClippingPlane,Y=G[0]*h[0]+G[1]*h[1]+G[2]*h[2]+G[3]<0;return{point:new o.P(u[0]/u[3],u[1]/u[3]),signedDistanceFromCamera:u[3],isOccluded:Y}}_calcMatrices(){if(!this._helper._width||!this._helper._height)return;let e=Uc(this.worldSize,this.center.lat),a=o.bj(),c=o.bj();this._helper.autoCalculateNearFarZ&&(this._helper._nearZ=.5,this._helper._farZ=this.cameraToCenterDistance+2*e),o.bd(a,this.fovInRadians,this.width/this.height,this._helper._nearZ,this._helper._farZ);let r=this.centerOffset;a[8]=2*-r.x/this._helper._width,a[9]=2*r.y/this._helper._height,this._projectionMatrix=o.be(a),this._globeProjMatrixInverted=o.bj(),o.aA(this._globeProjMatrixInverted,a),o.O(a,a,[0,0,-this.cameraToCenterDistance]),o.bf(a,a,this.rollInRadians),o.bg(a,a,-this.pitchInRadians),o.bf(a,a,this.bearingInRadians),o.O(a,a,[0,0,-e]);let W=o.by();W[0]=e,W[1]=e,W[2]=e,o.bg(c,a,this.center.lat*Math.PI/180),o.bI(c,c,-this.center.lng*Math.PI/180),o.Q(c,c,W),this._globeViewProjMatrixNoCorrection=c,o.bg(a,a,this.center.lat*Math.PI/180-this._globeLatitudeErrorCorrectionRadians),o.bI(a,a,-this.center.lng*Math.PI/180),o.Q(a,a,W),this._globeViewProjMatrix32f=new Float32Array(a),this._globeViewProjMatrixNoCorrectionInverted=o.bj(),o.aA(this._globeViewProjMatrixNoCorrectionInverted,c);let h=o.by();this._cameraPosition=o.by(),this._cameraPosition[2]=this.cameraToCenterDistance/e,o.bF(this._cameraPosition,this._cameraPosition,h,-this.rollInRadians),o.bG(this._cameraPosition,this._cameraPosition,h,this.pitchInRadians),o.bF(this._cameraPosition,this._cameraPosition,h,-this.bearingInRadians),o.a$(this._cameraPosition,this._cameraPosition,[0,0,1]),o.bG(this._cameraPosition,this._cameraPosition,h,-this.center.lat*Math.PI/180),o.bH(this._cameraPosition,this._cameraPosition,h,this.center.lng*Math.PI/180),this._cachedClippingPlane=this._computeClippingPlane(e);let g=o.be(this._globeViewProjMatrixNoCorrectionInverted);o.Q(g,g,[1,1,-1]),this._cachedFrustum=Ha.fromInvProjectionMatrix(g,1,0,this._cachedClippingPlane,!0)}calculateFogMatrix(e){o.w("calculateFogMatrix is not supported on globe projection.");let a=o.bj();return o.ar(a),a}getVisibleUnwrappedCoordinates(e){return[new o.bb(0,e)]}getCameraFrustum(){return this._cachedFrustum}getClippingPlane(){return this._cachedClippingPlane}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(e){e&&o.w("terrain is not fully supported on vertical perspective projection."),this._helper.recalculateZoomAndCenter(0)}maxPitchScaleFactor(){return 1}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(e,a){if(!this._globeViewProjMatrixNoCorrection)return 1;let c=kl(e);o.a_(c,c,1+a/o.bD);let r=o.bE();return o.aG(r,[c[0],c[1],c[2],1],this._globeViewProjMatrixNoCorrection),r[2]/r[3]}populateCache(e){}getBounds(){let e=.5*this.width,a=.5*this.height,c=[new o.P(0,0),new o.P(e,0),new o.P(this.width,0),new o.P(this.width,a),new o.P(this.width,this.height),new o.P(e,this.height),new o.P(0,this.height),new o.P(0,a)],r=[];for(let y of c)r.push(this.unprojectScreenPoint(y));let W=0,h=0,g=0,u=0,G=this.center;for(let y of r){let J=o.bJ(G.lng,y.lng),S=o.bJ(G.lat,y.lat);J<h&&(h=J),J>W&&(W=J),S<u&&(u=S),S>g&&(g=S)}let Y=[G.lng+h,G.lat+u,G.lng+W,G.lat+g];return this.isSurfacePointOnScreen([0,1,0])&&(Y[3]=90,Y[0]=-180,Y[2]=180),this.isSurfacePointOnScreen([0,-1,0])&&(Y[1]=-90,Y[0]=-180,Y[2]=180),new Ee(Y)}calculateCenterFromCameraLngLatAlt(e,a,c,r){return this._helper.calculateCenterFromCameraLngLatAlt(e,a,c,r)}setLocationAtPoint(e,a){let c=kl(this.unprojectScreenPoint(a)),r=kl(e),W=o.by();o.bK(W);let h=o.by();o.bH(h,c,W,-this.center.lng*Math.PI/180),o.bG(h,h,W,this.center.lat*Math.PI/180);let g=r[0]*r[0]+r[2]*r[2],u=h[0]*h[0];if(g<u)return;let G=Math.sqrt(g-u),Y=-G,y=o.bL(r[0],r[2],h[0],G),J=o.bL(r[0],r[2],h[0],Y),S=o.by();o.bH(S,r,W,-y);let L=o.bL(S[1],S[2],h[1],h[2]),w=o.by();o.bH(w,r,W,-J);let v=o.bL(w[1],w[2],h[1],h[2]),O=.5*Math.PI,K=L>=-O&&L<=O,tt=v>=-O&&v<=O,_,et;if(K&&tt){let ht=this.center.lng*Math.PI/180,bt=this.center.lat*Math.PI/180;o.bM(y,ht)+o.bM(L,bt)<o.bM(J,ht)+o.bM(v,bt)?(_=y,et=L):(_=J,et=v)}else if(K)_=y,et=L;else{if(!tt)return;_=J,et=v}let it=_/Math.PI*180,q=et/Math.PI*180,ct=this.center.lat;this.setCenter(new o.V(it,o.an(q,-90,90))),this.setZoom(this.zoom+hl(ct,this.center.lat))}locationToScreenPoint(e,a){let c=kl(e);if(a){let r=a.getElevationForLngLatZoom(e,this._helper._tileZoom);o.a_(c,c,1+r/o.bD)}return this._projectSurfacePointToScreen(c)}_projectSurfacePointToScreen(e){let a=o.bE();return o.aG(a,[...e,1],this._globeViewProjMatrixNoCorrection),a[0]/=a[3],a[1]/=a[3],new o.P((.5*a[0]+.5)*this.width,(.5*-a[1]+.5)*this.height)}screenPointToMercatorCoordinate(e,a){if(a){let c=a.pointCoordinate(e);if(c)return c}return o.aa.fromLngLat(this.unprojectScreenPoint(e))}screenPointToLocation(e,a){var c;return(c=this.screenPointToMercatorCoordinate(e,a))===null||c===void 0?void 0:c.toLngLat()}isPointOnMapSurface(e,a){let c=this._cameraPosition,r=this.getRayDirectionFromPixel(e);return!!this.rayPlanetIntersection(c,r)}getRayDirectionFromPixel(e){let a=o.bE();a[0]=e.x/this.width*2-1,a[1]=-1*(e.y/this.height*2-1),a[2]=1,a[3]=1,o.aG(a,a,this._globeViewProjMatrixNoCorrectionInverted),a[0]/=a[3],a[1]/=a[3],a[2]/=a[3];let c=o.by();c[0]=a[0]-this._cameraPosition[0],c[1]=a[1]-this._cameraPosition[1],c[2]=a[2]-this._cameraPosition[2];let r=o.by();return o.b2(r,c),r}isSurfacePointVisible(e){let a=this._cachedClippingPlane;return a[0]*e[0]+a[1]*e[1]+a[2]*e[2]+a[3]>=0}isSurfacePointOnScreen(e){if(!this.isSurfacePointVisible(e))return!1;let a=o.bE();return o.aG(a,[...e,1],this._globeViewProjMatrixNoCorrection),a[0]/=a[3],a[1]/=a[3],a[2]/=a[3],a[0]>-1&&a[0]<1&&a[1]>-1&&a[1]<1&&a[2]>-1&&a[2]<1}rayPlanetIntersection(e,a){let c=o.b4(e,a),r=o.by(),W=o.by();o.a_(W,a,c),o.b1(r,e,W);let h=1-o.b4(r,r);if(h<0)return null;let g=o.b4(e,e)-1,u=-c+(c<0?1:-1)*Math.sqrt(h),G=g/u,Y=u;return{tMin:Math.min(G,Y),tMax:Math.max(G,Y)}}unprojectScreenPoint(e){let a=this._cameraPosition,c=this.getRayDirectionFromPixel(e),r=this.rayPlanetIntersection(a,c);if(r){let Y=o.by();o.a$(Y,a,[c[0]*r.tMin,c[1]*r.tMin,c[2]*r.tMin]);let y=o.by();return o.b2(y,Y),kr(y)}let W=this._cachedClippingPlane,h=W[0]*c[0]+W[1]*c[1]+W[2]*c[2],g=-o.ba(W,a)/h,u=o.by();if(g>0)o.a$(u,a,[c[0]*g,c[1]*g,c[2]*g]);else{let Y=o.by();o.a$(Y,a,[2*c[0],2*c[1],2*c[2]]);let y=o.ba(this._cachedClippingPlane,Y);o.b1(u,Y,[this._cachedClippingPlane[0]*y,this._cachedClippingPlane[1]*y,this._cachedClippingPlane[2]*y])}let G=(function(Y){let y=o.by();return y[0]=Y[0]*-Y[3],y[1]=Y[1]*-Y[3],y[2]=Y[2]*-Y[3],{center:y,radius:Math.sqrt(1-Y[3]*Y[3])}})(W);return kr((function(Y,y,J){let S=o.by();o.b1(S,J,Y);let L=o.by();return o.bz(L,Y,S,y/o.b8(S)),L})(G.center,G.radius,u))}getMatrixForModel(e,a){let c=o.V.convert(e),r=1/o.bD,W=o.bi();return o.bI(W,W,c.lng/180*Math.PI),o.bg(W,W,-c.lat/180*Math.PI),o.O(W,W,[0,0,1+a/o.bD]),o.bg(W,W,.5*Math.PI),o.Q(W,W,[r,r,r]),W}getProjectionDataForCustomLayer(e=!0){let a=this.getProjectionData({overscaledTileID:new o.a1(0,0,0,0,0),applyGlobeMatrix:e});return a.tileMercatorCoords=[0,0,1,1],a}getFastPathSimpleProjectionMatrix(e){}}class xc{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(e){this._helper.setMinZoom(e)}setMaxZoom(e){this._helper.setMaxZoom(e)}setMinPitch(e){this._helper.setMinPitch(e)}setMaxPitch(e){this._helper.setMaxPitch(e)}setRenderWorldCopies(e){this._helper.setRenderWorldCopies(e)}setBearing(e){this._helper.setBearing(e)}setPitch(e){this._helper.setPitch(e)}setRoll(e){this._helper.setRoll(e)}setFov(e){this._helper.setFov(e)}setZoom(e){this._helper.setZoom(e)}setCenter(e){this._helper.setCenter(e)}setElevation(e){this._helper.setElevation(e)}setMinElevationForCurrentTile(e){this._helper.setMinElevationForCurrentTile(e)}setPadding(e){this._helper.setPadding(e)}interpolatePadding(e,a,c){return this._helper.interpolatePadding(e,a,c)}isPaddingEqual(e){return this._helper.isPaddingEqual(e)}resize(e,a,c=!0){this._helper.resize(e,a,c)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(e){this._helper.setMaxBounds(e)}setConstrainOverride(e){this._helper.setConstrainOverride(e)}overrideNearFarZ(e,a){this._helper.overrideNearFarZ(e,a)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(e){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),e)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get constrainOverride(){return this._helper.constrainOverride}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}get isGlobeRendering(){return this._globeness>0}setTransitionState(e,a){this._globeness=e,this._globeLatitudeErrorCorrectionRadians=a,this._calcMatrices(),this._verticalPerspectiveTransform.getCoveringTilesDetailsProvider().prepareNextFrame(),this._mercatorTransform.getCoveringTilesDetailsProvider().prepareNextFrame()}get currentTransform(){return this.isGlobeRendering?this._verticalPerspectiveTransform:this._mercatorTransform}constructor(e){this._globeLatitudeErrorCorrectionRadians=0,this._globeness=1,this.defaultConstrain=(a,c)=>this.currentTransform.defaultConstrain(a,c),this.applyConstrain=(a,c)=>this._helper.applyConstrain(a,c),this._helper=new bi({calcMatrices:()=>{this._calcMatrices()},defaultConstrain:(a,c)=>this.defaultConstrain(a,c)},e),this._globeness=1,this._mercatorTransform=new je,this._verticalPerspectiveTransform=new Yc}clone(){let e=new xc;return e._globeness=this._globeness,e._globeLatitudeErrorCorrectionRadians=this._globeLatitudeErrorCorrectionRadians,e.apply(this),e}apply(e){this._helper.apply(e),this._mercatorTransform.apply(this),this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians)}get projectionMatrix(){return this.currentTransform.projectionMatrix}get modelViewProjectionMatrix(){return this.currentTransform.modelViewProjectionMatrix}get inverseProjectionMatrix(){return this.currentTransform.inverseProjectionMatrix}get cameraPosition(){return this.currentTransform.cameraPosition}getProjectionData(e){let a=this._mercatorTransform.getProjectionData(e),c=this._verticalPerspectiveTransform.getProjectionData(e);return{mainMatrix:this.isGlobeRendering?c.mainMatrix:a.mainMatrix,clippingPlane:c.clippingPlane,tileMercatorCoords:c.tileMercatorCoords,projectionTransition:e.applyGlobeMatrix?this._globeness:0,fallbackMatrix:a.fallbackMatrix}}isLocationOccluded(e){return this.currentTransform.isLocationOccluded(e)}transformLightDirection(e){return this.currentTransform.transformLightDirection(e)}getPixelScale(){return o.bt(this._mercatorTransform.getPixelScale(),this._verticalPerspectiveTransform.getPixelScale(),this._globeness)}getCircleRadiusCorrection(){return o.bt(this._mercatorTransform.getCircleRadiusCorrection(),this._verticalPerspectiveTransform.getCircleRadiusCorrection(),this._globeness)}getPitchedTextCorrection(e,a,c){let r=this._mercatorTransform.getPitchedTextCorrection(e,a,c),W=this._verticalPerspectiveTransform.getPitchedTextCorrection(e,a,c);return o.bt(r,W,this._globeness)}projectTileCoordinates(e,a,c,r){return this.currentTransform.projectTileCoordinates(e,a,c,r)}_calcMatrices(){this._helper._width&&this._helper._height&&(this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians),this._helper._nearZ=this._verticalPerspectiveTransform.nearZ,this._helper._farZ=this._verticalPerspectiveTransform.farZ,this._mercatorTransform.apply(this,!0,this.isGlobeRendering),this._helper._nearZ=this._mercatorTransform.nearZ,this._helper._farZ=this._mercatorTransform.farZ)}calculateFogMatrix(e){return this.currentTransform.calculateFogMatrix(e)}getVisibleUnwrappedCoordinates(e){return this.currentTransform.getVisibleUnwrappedCoordinates(e)}getCameraFrustum(){return this.currentTransform.getCameraFrustum()}getClippingPlane(){return this.currentTransform.getClippingPlane()}getCoveringTilesDetailsProvider(){return this.currentTransform.getCoveringTilesDetailsProvider()}recalculateZoomAndCenter(e){this._mercatorTransform.recalculateZoomAndCenter(e),this._verticalPerspectiveTransform.recalculateZoomAndCenter(e)}maxPitchScaleFactor(){return this._mercatorTransform.maxPitchScaleFactor()}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(e,a){return this.currentTransform.lngLatToCameraDepth(e,a)}populateCache(e){this._mercatorTransform.populateCache(e),this._verticalPerspectiveTransform.populateCache(e)}getBounds(){return this.currentTransform.getBounds()}calculateCenterFromCameraLngLatAlt(e,a,c,r){return this._helper.calculateCenterFromCameraLngLatAlt(e,a,c,r)}setLocationAtPoint(e,a){if(!this.isGlobeRendering)return this._mercatorTransform.setLocationAtPoint(e,a),void this.apply(this._mercatorTransform);this._verticalPerspectiveTransform.setLocationAtPoint(e,a),this.apply(this._verticalPerspectiveTransform)}locationToScreenPoint(e,a){return this.currentTransform.locationToScreenPoint(e,a)}screenPointToMercatorCoordinate(e,a){return this.currentTransform.screenPointToMercatorCoordinate(e,a)}screenPointToLocation(e,a){return this.currentTransform.screenPointToLocation(e,a)}isPointOnMapSurface(e,a){return this.currentTransform.isPointOnMapSurface(e,a)}getRayDirectionFromPixel(e){return this._verticalPerspectiveTransform.getRayDirectionFromPixel(e)}getMatrixForModel(e,a){return this.currentTransform.getMatrixForModel(e,a)}getProjectionDataForCustomLayer(e=!0){let a=this._mercatorTransform.getProjectionDataForCustomLayer(e);if(!this.isGlobeRendering)return a;let c=this._verticalPerspectiveTransform.getProjectionDataForCustomLayer(e);return c.fallbackMatrix=a.mainMatrix,c}getFastPathSimpleProjectionMatrix(e){return this.currentTransform.getFastPathSimpleProjectionMatrix(e)}}class Wi{get useGlobeControls(){return!0}handlePanInertia(e,a){let c=Di(e,a);return Math.abs(c.lng-a.center.lng)>180&&(c.lng=a.center.lng+179.5*Math.sign(c.lng-a.center.lng)),{easingCenter:c,easingOffset:new o.P(0,0)}}handleMapControlsRollPitchBearingZoom(e,a){let c=e.around,r=a.screenPointToLocation(c);e.bearingDelta&&a.setBearing(a.bearing+e.bearingDelta),e.pitchDelta&&a.setPitch(a.pitch+e.pitchDelta),e.rollDelta&&a.setRoll(a.roll+e.rollDelta);let W=a.zoom;e.zoomDelta&&a.setZoom(a.zoom+e.zoomDelta);let h=a.zoom-W;if(h===0)return;let g=o.bJ(a.center.lng,r.lng),u=g/(Math.abs(g/180)+1),G=o.bJ(a.center.lat,r.lat),Y=a.getRayDirectionFromPixel(c),y=a.cameraPosition,J=-1*o.b4(y,Y),S=o.by();o.a$(S,y,[Y[0]*J,Y[1]*J,Y[2]*J]);let L=o.b6(S)-1,w=Math.exp(.5*-Math.max(L-.3,0)),v=Uc(a.worldSize,a.center.lat)/Math.min(a.width,a.height),O=o.bw(v,.9,.5,1,.25),K=(1-o.aq(-h))*Math.min(w,O),tt=a.center.lat,_=a.zoom,et=new o.V(a.center.lng+u*K,o.an(a.center.lat+G*K,-o.ao,o.ao));a.setLocationAtPoint(r,c);let it=a.center,q=o.bw(Math.abs(g),45,85,0,1),ct=o.bw(v,.75,.35,0,1),ht=Math.pow(Math.max(q,ct),.25),bt=o.bJ(it.lng,et.lng),mt=o.bJ(it.lat,et.lat);a.setCenter(new o.V(it.lng+bt*ht,it.lat+mt*ht).wrap()),a.setZoom(_+hl(tt,a.center.lat))}handleMapControlsPan(e,a,c){if(!e.panDelta)return;let r=a.center.lat,W=a.zoom;a.setCenter(Di(e.panDelta,a).wrap()),a.setZoom(W+hl(r,a.center.lat))}cameraForBoxAndBearing(e,a,c,r,W){let h=ud(e,a,c,r,W),g=a.left/W.width*2-1,u=(W.width-a.right)/W.width*2-1,G=a.top/W.height*-2+1,Y=(W.height-a.bottom)/W.height*-2+1,y=o.bJ(c.getWest(),c.getEast())<0,J=y?c.getEast():c.getWest(),S=y?c.getWest():c.getEast(),L=Math.max(c.getNorth(),c.getSouth()),w=Math.min(c.getNorth(),c.getSouth()),v=J+.5*o.bJ(J,S),O=L+.5*o.bJ(L,w),K=W.clone();K.setCenter(h.center),K.setBearing(h.bearing),K.setPitch(0),K.setRoll(0),K.setZoom(h.zoom);let tt=K.modelViewProjectionMatrix,_=[kl(c.getNorthWest()),kl(c.getNorthEast()),kl(c.getSouthWest()),kl(c.getSouthEast()),kl(new o.V(S,O)),kl(new o.V(J,O)),kl(new o.V(v,L)),kl(new o.V(v,w))],et=kl(h.center),it=Number.POSITIVE_INFINITY;for(let q of _)g<0&&(it=Wi.getLesserNonNegativeNonNull(it,Wi.solveVectorScale(q,et,tt,"x",g))),u>0&&(it=Wi.getLesserNonNegativeNonNull(it,Wi.solveVectorScale(q,et,tt,"x",u))),G>0&&(it=Wi.getLesserNonNegativeNonNull(it,Wi.solveVectorScale(q,et,tt,"y",G))),Y<0&&(it=Wi.getLesserNonNegativeNonNull(it,Wi.solveVectorScale(q,et,tt,"y",Y)));if(Number.isFinite(it)&&it!==0)return h.zoom=K.zoom+o.at(it),h;jn()}handleJumpToCenterZoom(e,a){let c=e.center.lat,r=e.applyConstrain(a.center?o.V.convert(a.center):e.center,e.zoom).center;e.setCenter(r.wrap());let W=a.zoom!==void 0?+a.zoom:e.zoom+hl(c,r.lat);e.zoom!==W&&e.setZoom(W)}handleEaseTo(e,a){let c=e.zoom,r=e.center,W=e.padding,h={roll:e.roll,pitch:e.pitch,bearing:e.bearing},g={roll:a.roll===void 0?e.roll:a.roll,pitch:a.pitch===void 0?e.pitch:a.pitch,bearing:a.bearing===void 0?e.bearing:a.bearing},u=a.zoom!==void 0,G=!e.isPaddingEqual(a.padding),Y=!1,y=a.center?o.V.convert(a.center):r,J=e.applyConstrain(y,c).center;Gc(e,J);let S=e.clone();S.setCenter(J),S.setZoom(u?+a.zoom:c+hl(r.lat,y.lat)),S.setBearing(a.bearing);let L=new o.P(o.an(e.centerPoint.x+a.offsetAsPoint.x,0,e.width),o.an(e.centerPoint.y+a.offsetAsPoint.y,0,e.height));S.setLocationAtPoint(J,L);let w=(a.offset&&a.offsetAsPoint.mag())>0?S.center:J,v=u?+a.zoom:c+hl(r.lat,w.lat),O=c+hl(r.lat,0),K=v+hl(w.lat,0),tt=o.bJ(r.lng,w.lng),_=o.bJ(r.lat,w.lat),et=o.aq(K-O);return Y=v!==c,{easeFunc:it=>{if(o.bn(h,g)||Da({startEulerAngles:h,endEulerAngles:g,tr:e,k:it,useSlerp:h.roll!=g.roll}),G&&e.interpolatePadding(W,a.padding,it),a.around)o.w("Easing around a point is not supported under globe projection."),e.setLocationAtPoint(a.around,a.aroundPoint);else{let q=K>O?Math.min(2,et):Math.max(.5,et),ct=Math.pow(q,1-it),ht=Oo(r,tt,_,it*ct);e.setCenter(ht.wrap())}if(Y){let q=o.G.number(O,K,it)+hl(0,e.center.lat);e.setZoom(q)}},isZooming:Y,elevationCenter:w}}handleFlyTo(e,a){let c=a.zoom!==void 0,r=e.center,W=e.zoom,h=e.padding,g=!e.isPaddingEqual(a.padding),u=e.applyConstrain(o.V.convert(a.center||a.locationAtOffset),W).center,G=c?+a.zoom:e.zoom+hl(e.center.lat,u.lat),Y=e.clone();Y.setCenter(u),Y.setZoom(G),Y.setBearing(a.bearing);let y=new o.P(o.an(e.centerPoint.x+a.offsetAsPoint.x,0,e.width),o.an(e.centerPoint.y+a.offsetAsPoint.y,0,e.height));Y.setLocationAtPoint(u,y);let J=Y.center;Gc(e,J);let S=(function(_,et,it){let q=kl(et),ct=kl(it),ht=o.b4(q,ct),bt=Math.acos(ht),mt=Qr(_);return bt/(2*Math.PI)*mt})(e,r,J),L=W+hl(r.lat,0),w=G+hl(J.lat,0),v=o.aq(w-L),O;if(typeof a.minZoom=="number"){let _=+a.minZoom+hl(J.lat,0),et=Math.min(_,L,w)+hl(0,J.lat),it=e.applyConstrain(J,et).zoom+hl(J.lat,0);O=o.aq(it-L)}let K=o.bJ(r.lng,J.lng),tt=o.bJ(r.lat,J.lat);return{easeFunc:(_,et,it,q)=>{let ct=Oo(r,K,tt,it);g&&e.interpolatePadding(h,a.padding,_);let ht=_===1?J:ct;e.setCenter(ht.wrap());let bt=L+o.at(et);e.setZoom(_===1?G:bt+hl(0,ht.lat))},scaleOfZoom:v,targetCenter:J,scaleOfMinZoom:O,pixelPathLength:S}}static solveVectorScale(e,a,c,r,W){let h=r==="x"?[c[0],c[4],c[8],c[12]]:[c[1],c[5],c[9],c[13]],g=[c[3],c[7],c[11],c[15]],u=e[0]*h[0]+e[1]*h[1]+e[2]*h[2],G=e[0]*g[0]+e[1]*g[1]+e[2]*g[2],Y=a[0]*h[0]+a[1]*h[1]+a[2]*h[2],y=a[0]*g[0]+a[1]*g[1]+a[2]*g[2];return Y+W*G===u+W*y||g[3]*(u-Y)+h[3]*(y-G)+u*y==Y*G?null:(Y+h[3]-W*y-W*g[3])/(Y-u-W*y+W*G)}static getLesserNonNegativeNonNull(e,a){return a!==null&&a>=0&&a<e?a:e}}class Tc{constructor(e){this._globe=e,this._mercatorCameraHelper=new mi,this._verticalPerspectiveCameraHelper=new Wi}get useGlobeControls(){return this._globe.useGlobeRendering}get currentHelper(){return this.useGlobeControls?this._verticalPerspectiveCameraHelper:this._mercatorCameraHelper}handlePanInertia(e,a){return this.currentHelper.handlePanInertia(e,a)}handleMapControlsRollPitchBearingZoom(e,a){return this.currentHelper.handleMapControlsRollPitchBearingZoom(e,a)}handleMapControlsPan(e,a,c){this.currentHelper.handleMapControlsPan(e,a,c)}cameraForBoxAndBearing(e,a,c,r,W){return this.currentHelper.cameraForBoxAndBearing(e,a,c,r,W)}handleJumpToCenterZoom(e,a){this.currentHelper.handleJumpToCenterZoom(e,a)}handleEaseTo(e,a){return this.currentHelper.handleEaseTo(e,a)}handleFlyTo(e,a){return this.currentHelper.handleFlyTo(e,a)}}let sn=(m,e)=>o.B(m,e&&e.filter((a=>a.identifier!=="source.canvas"))),_o=o.bN();class Id extends o.E{constructor(e,a={}){var c,r;super(),this._rtlPluginLoaded=()=>{for(let h in this.tileManagers){let g=this.tileManagers[h].getSource().type;g!=="vector"&&g!=="geojson"||this.tileManagers[h].reload()}},this.map=e,this.dispatcher=new Al(zi(),e._getMapId()),this.dispatcher.registerMessageHandler("GG",((h,g)=>this.getGlyphs(h,g))),this.dispatcher.registerMessageHandler("GI",((h,g)=>this.getImages(h,g))),this.dispatcher.registerMessageHandler("GDA",((h,g)=>this.getDashes(h,g))),this.imageManager=new Me,this.imageManager.setEventedParent(this);let W=((c=e._container)===null||c===void 0?void 0:c.lang)||typeof document<"u"&&((r=document.documentElement)===null||r===void 0?void 0:r.lang)||void 0;this.glyphManager=new Fl(e._requestManager,a.localIdeographFontFamily,W),this.lineAtlas=new Ea(256,512),this.crossTileSymbolIndex=new cn,this._setInitialValues(),this._resetUpdates(),this.dispatcher.broadcast("SR",o.bO()),wi().on(Ai,this._rtlPluginLoaded),this.on("data",(h=>{if(h.dataType!=="source"||h.sourceDataType!=="metadata")return;let g=this.tileManagers[h.sourceId];if(!g)return;let u=g.getSource();if(u&&u.vectorLayerIds)for(let G in this._layers){let Y=this._layers[G];Y.source===u.id&&this._validateLayer(Y)}}))}_setInitialValues(){var e;this._spritesImagesIds={},this._layers={},this._order=[],this.tileManagers={},this.zoomHistory=new o.bP,this._availableImages=[],this._globalState={},this._serializedLayers={},this.stylesheet=null,this.light=null,this.sky=null,this.projection&&(this.projection.destroy(),delete this.projection),this._loaded=!1,this._changed=!1,this._updatedLayers={},this._updatedSources={},this._changedImages={},this._glyphsDidChange=!1,this._updatedPaintProps={},this._layerOrderChanged=!1,this.crossTileSymbolIndex=new(((e=this.crossTileSymbolIndex)===null||e===void 0?void 0:e.constructor)||Object),this.pauseablePlacement=void 0,this.placement=void 0,this.z=0}setGlobalStateProperty(e,a){var c,r,W;this._checkLoaded();let h=a===null?(W=(r=(c=this.stylesheet.state)===null||c===void 0?void 0:c[e])===null||r===void 0?void 0:r.default)!==null&&W!==void 0?W:null:a;if(o.bQ(h,this._globalState[e]))return this;this._globalState[e]=h,this._applyGlobalStateChanges([e])}getGlobalState(){return this._globalState}setGlobalState(e){this._checkLoaded();let a=[];for(let c in e)!o.bQ(this._globalState[c],e[c].default)&&(a.push(c),this._globalState[c]=e[c].default);this._applyGlobalStateChanges(a)}_applyGlobalStateChanges(e){if(e.length===0)return;let a=new Set,c={};for(let r of e){c[r]=this._globalState[r];for(let W in this._layers){let h=this._layers[W],g=h.getLayoutAffectingGlobalStateRefs(),u=h.getPaintAffectingGlobalStateRefs();if(g.has(r)&&a.add(h.source),u.has(r))for(let{name:G,value:Y}of u.get(r))this._updatePaintProperty(h,G,Y)}}this.dispatcher.broadcast("UGS",c);for(let r in this.tileManagers)a.has(r)&&(this._reloadSource(r),this._changed=!0)}loadURL(e,a={},c){this.fire(new o.l("dataloading",{dataType:"style"})),a.validate=typeof a.validate!="boolean"||a.validate;let r=this.map._requestManager.transformRequest(e,"Style");this._loadStyleRequest=new AbortController;let W=this._loadStyleRequest;o.j(r,this._loadStyleRequest).then((h=>{this._loadStyleRequest=null,this._load(h.data,a,c)})).catch((h=>{this._loadStyleRequest=null,h&&!W.signal.aborted&&this.fire(new o.k(h))}))}loadJSON(e,a={},c){this.fire(new o.l("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,ft.frameAsync(this._frameRequest).then((()=>{this._frameRequest=null,a.validate=a.validate!==!1,this._load(e,a,c)})).catch((()=>{}))}loadEmpty(){this.fire(new o.l("dataloading",{dataType:"style"})),this._load(_o,{validate:!1})}_load(e,a,c){var r,W;let h=a.transformStyle?a.transformStyle(c,e):e;if(!a.validate||!sn(this,o.C(h))){h=Object.assign({},h),this._loaded=!0,this.stylesheet=h;for(let g in h.sources)this.addSource(g,h.sources[g],{validate:!1});h.sprite?this._loadSprite(h.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(h.glyphs),this._createLayers(),this.light=new Ei(this.stylesheet.light),this._setProjectionInternal(((r=this.stylesheet.projection)===null||r===void 0?void 0:r.type)||"mercator"),this.sky=new Xi(this.stylesheet.sky),this.map.setTerrain((W=this.stylesheet.terrain)!==null&&W!==void 0?W:null),this.fire(new o.l("data",{dataType:"style"})),this.fire(new o.l("style.load"))}}_createLayers(){var e,a,c;let r=o.bR(this.stylesheet.layers);this.setGlobalState((e=this.stylesheet.state)!==null&&e!==void 0?e:null),this.dispatcher.broadcast("SL",r),this._order=r.map((W=>W.id)),this._layers={},this._serializedLayers=null;for(let W of r){let h=o.bS(W,this._globalState);if(h.setEventedParent(this,{layer:{id:W.id}}),this._layers[W.id]=h,o.bT(h)&&this.tileManagers[h.source]){let g=(c=(a=W.paint)===null||a===void 0?void 0:a["raster-fade-duration"])!==null&&c!==void 0?c:h.paint.get("raster-fade-duration");this.tileManagers[h.source].setRasterFadeDuration(g)}}}_loadSprite(e,a=!1,c=void 0){let r;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,(function(W,h,g,u){return o._(this,void 0,void 0,(function*(){let G=ue(W),Y=g>1?"@2x":"",y={},J={};for(let{id:S,url:L}of G){let w=h.transformRequest(Qe(L,Y,".json"),"SpriteJSON");y[S]=o.j(w,u);let v=h.transformRequest(Qe(L,Y,".png"),"SpriteImage");J[S]=ce.getImage(v,u)}return yield Promise.all([...Object.values(y),...Object.values(J)]),(function(S,L){return o._(this,void 0,void 0,(function*(){let w={};for(let v in S){w[v]={};let O=ft.getImageCanvasContext((yield L[v]).data),K=(yield S[v]).data;for(let tt in K){let{width:_,height:et,x:it,y:q,sdf:ct,pixelRatio:ht,stretchX:bt,stretchY:mt,content:Zt,textFitWidth:Jt,textFitHeight:Yt}=K[tt];w[v][tt]={data:null,pixelRatio:ht,sdf:ct,stretchX:bt,stretchY:mt,content:Zt,textFitWidth:Jt,textFitHeight:Yt,spriteData:{width:_,height:et,x:it,y:q,context:O}}}}return w}))})(y,J)}))})(e,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then((W=>{if(this._spriteRequest=null,W)for(let h in W){this._spritesImagesIds[h]=[];let g=this._spritesImagesIds[h]?this._spritesImagesIds[h].filter((u=>!(u in W))):[];for(let u of g)this.imageManager.removeImage(u),this._changedImages[u]=!0;for(let u in W[h]){let G=h==="default"?u:`${h}:${u}`;this._spritesImagesIds[h].push(G),G in this.imageManager.images?this.imageManager.updateImage(G,W[h][u],!1):this.imageManager.addImage(G,W[h][u]),a&&(this._changedImages[G]=!0)}}})).catch((W=>{this._spriteRequest=null,r=W,this.fire(new o.k(r))})).finally((()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),a&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new o.l("data",{dataType:"style"})),c&&c(r)}))}_unloadSprite(){for(let e of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(e),this._changedImages[e]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new o.l("data",{dataType:"style"}))}_validateLayer(e){let a=this.tileManagers[e.source];if(!a)return;let c=e.sourceLayer;if(!c)return;let r=a.getSource();(r.type==="geojson"||r.vectorLayerIds&&r.vectorLayerIds.indexOf(c)===-1)&&this.fire(new o.k(new Error(`Source layer "${c}" does not exist on source "${r.id}" as specified by style layer "${e.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(let e in this.tileManagers)if(!this.tileManagers[e].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(e,a=!1){let c=this._serializedAllLayers();if(!e||e.length===0)return Object.values(a?o.bU(c):c);let r=[];for(let W of e)if(c[W]){let h=a?o.bU(c[W]):c[W];r.push(h)}return r}_serializedAllLayers(){let e=this._serializedLayers;if(e)return e;e=this._serializedLayers={};let a=Object.keys(this._layers);for(let c of a){let r=this._layers[c];r.type!=="custom"&&(e[c]=r.serialize())}return e}hasTransitions(){var e,a,c;if(!((e=this.light)===null||e===void 0)&&e.hasTransition()||!((a=this.sky)===null||a===void 0)&&a.hasTransition()||!((c=this.projection)===null||c===void 0)&&c.hasTransition())return!0;for(let r in this.tileManagers)if(this.tileManagers[r].hasTransition())return!0;for(let r in this._layers)if(this._layers[r].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(e){if(!this._loaded)return;let a=this._changed;if(a){let r=Object.keys(this._updatedLayers),W=Object.keys(this._removedLayers);(r.length||W.length)&&this._updateWorkerLayers(r,W);for(let h in this._updatedSources){let g=this._updatedSources[h];if(g==="reload")this._reloadSource(h);else{if(g!=="clear")throw new Error(`Invalid action ${g}`);this._clearSource(h)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(let h in this._updatedPaintProps)this._layers[h].updateTransitions(e);this.light.updateTransitions(e),this.sky.updateTransitions(e),this._resetUpdates()}let c={};for(let r in this.tileManagers){let W=this.tileManagers[r];c[r]=W.used,W.used=!1}for(let r of this._order){let W=this._layers[r];W.recalculate(e,this._availableImages),!W.isHidden(e.zoom)&&W.source&&(this.tileManagers[W.source].used=!0)}for(let r in c){let W=this.tileManagers[r];!!c[r]!=!!W.used&&W.fire(new o.l("data",{sourceDataType:"visibility",dataType:"source",sourceId:r}))}this.light.recalculate(e),this.sky.recalculate(e),this.projection.recalculate(e),this.z=e.zoom,a&&this.fire(new o.l("data",{dataType:"style"}))}_updateTilesForChangedImages(){let e=Object.keys(this._changedImages);if(e.length){for(let a in this.tileManagers)this.tileManagers[a].reloadTilesForDependencies(["icons","patterns"],e);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(let e in this.tileManagers)this.tileManagers[e].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(e,a){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(e,!1),removedIds:a})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(e,a={}){var c;this._checkLoaded();let r=this.serialize();if(e=a.transformStyle?a.transformStyle(r,e):e,((c=a.validate)===null||c===void 0||c)&&sn(this,o.C(e)))return!1;(e=o.bU(e)).layers=o.bR(e.layers);let W=o.bV(r,e),h=this._getOperationsToPerform(W);if(h.unimplemented.length>0)throw new Error(`Unimplemented: ${h.unimplemented.join(", ")}.`);if(h.operations.length===0)return!1;for(let g of h.operations)g();return this.stylesheet=e,this._serializedLayers=null,!0}_getOperationsToPerform(e){let a=[],c=[];for(let r of e)switch(r.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":case"setRoll":continue;case"addLayer":a.push((()=>this.addLayer.apply(this,r.args)));break;case"removeLayer":a.push((()=>this.removeLayer.apply(this,r.args)));break;case"setPaintProperty":a.push((()=>this.setPaintProperty.apply(this,r.args)));break;case"setLayoutProperty":a.push((()=>this.setLayoutProperty.apply(this,r.args)));break;case"setFilter":a.push((()=>this.setFilter.apply(this,r.args)));break;case"addSource":a.push((()=>this.addSource.apply(this,r.args)));break;case"removeSource":a.push((()=>this.removeSource.apply(this,r.args)));break;case"setLayerZoomRange":a.push((()=>this.setLayerZoomRange.apply(this,r.args)));break;case"setLight":a.push((()=>this.setLight.apply(this,r.args)));break;case"setGeoJSONSourceData":a.push((()=>this.setGeoJSONSourceData.apply(this,r.args)));break;case"setGlyphs":a.push((()=>this.setGlyphs.apply(this,r.args)));break;case"setSprite":a.push((()=>this.setSprite.apply(this,r.args)));break;case"setTerrain":a.push((()=>this.map.setTerrain.apply(this,r.args)));break;case"setSky":a.push((()=>this.setSky.apply(this,r.args)));break;case"setProjection":this.setProjection.apply(this,r.args);break;case"setGlobalState":a.push((()=>this.setGlobalState.apply(this,r.args)));break;case"setTransition":a.push((()=>{}));break;default:c.push(r.command)}return{operations:a,unimplemented:c}}addImage(e,a){if(this.getImage(e))return this.fire(new o.k(new Error(`An image named "${e}" already exists.`)));this.imageManager.addImage(e,a),this._afterImageUpdated(e)}updateImage(e,a){this.imageManager.updateImage(e,a)}getImage(e){return this.imageManager.getImage(e)}removeImage(e){if(!this.getImage(e))return this.fire(new o.k(new Error(`An image named "${e}" does not exist.`)));this.imageManager.removeImage(e),this._afterImageUpdated(e)}_afterImageUpdated(e){this._availableImages=this.imageManager.listImages(),this._changedImages[e]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new o.l("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(e,a,c={}){if(this._checkLoaded(),this.tileManagers[e]!==void 0)throw new Error(`Source "${e}" already exists.`);if(!a.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(a).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(a.type)>=0&&this._validate(o.C.source,`sources.${e}`,a,null,c))return;this.map&&this.map._collectResourceTiming&&(a.collectResourceTiming=!0);let r=this.tileManagers[e]=new be(e,a,this.dispatcher);r.style=this,r.setEventedParent(this,(()=>({isSourceLoaded:r.loaded(),source:r.serialize(),sourceId:e}))),r.onAdd(this.map),this._changed=!0}removeSource(e){if(this._checkLoaded(),this.tileManagers[e]===void 0)throw new Error("There is no source with this ID");for(let c in this._layers)if(this._layers[c].source===e)return this.fire(new o.k(new Error(`Source "${e}" cannot be removed while layer "${c}" is using it.`)));let a=this.tileManagers[e];delete this.tileManagers[e],delete this._updatedSources[e],a.fire(new o.l("data",{sourceDataType:"metadata",dataType:"source",sourceId:e})),a.setEventedParent(null),a.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(e,a){if(this._checkLoaded(),this.tileManagers[e]===void 0)throw new Error(`There is no source with this ID=${e}`);let c=this.tileManagers[e].getSource();if(c.type!=="geojson")throw new Error(`geojsonSource.type is ${c.type}, which is !== 'geojson`);c.setData(a),this._changed=!0}getSource(e){return this.tileManagers[e]&&this.tileManagers[e].getSource()}addLayer(e,a,c={}){this._checkLoaded();let r=e.id;if(this.getLayer(r))return void this.fire(new o.k(new Error(`Layer "${r}" already exists on this map.`)));let W;if(e.type==="custom"){if(sn(this,o.bW(e)))return;W=o.bS(e,this._globalState)}else{if("source"in e&&typeof e.source=="object"&&(this.addSource(r,e.source),e=o.bU(e),e=o.e(e,{source:r})),this._validate(o.C.layer,`layers.${r}`,e,{arrayIndex:-1},c))return;W=o.bS(e,this._globalState),this._validateLayer(W),W.setEventedParent(this,{layer:{id:r}})}let h=a?this._order.indexOf(a):this._order.length;if(a&&h===-1)this.fire(new o.k(new Error(`Cannot add layer "${r}" before non-existing layer "${a}".`)));else{if(this._order.splice(h,0,r),this._layerOrderChanged=!0,this._layers[r]=W,this._removedLayers[r]&&W.source&&W.type!=="custom"){let g=this._removedLayers[r];delete this._removedLayers[r],g.type!==W.type?this._updatedSources[W.source]="clear":(this._updatedSources[W.source]="reload",this.tileManagers[W.source].pause())}this._updateLayer(W),W.onAdd&&W.onAdd(this.map)}}moveLayer(e,a){if(this._checkLoaded(),this._changed=!0,!this._layers[e])return void this.fire(new o.k(new Error(`The layer '${e}' does not exist in the map's style and cannot be moved.`)));if(e===a)return;let c=this._order.indexOf(e);this._order.splice(c,1);let r=a?this._order.indexOf(a):this._order.length;a&&r===-1?this.fire(new o.k(new Error(`Cannot move layer "${e}" before non-existing layer "${a}".`))):(this._order.splice(r,0,e),this._layerOrderChanged=!0)}removeLayer(e){this._checkLoaded();let a=this._layers[e];if(!a)return void this.fire(new o.k(new Error(`Cannot remove non-existing layer "${e}".`)));a.setEventedParent(null);let c=this._order.indexOf(e);this._order.splice(c,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[e]=a,delete this._layers[e],this._serializedLayers&&delete this._serializedLayers[e],delete this._updatedLayers[e],delete this._updatedPaintProps[e],a.onRemove&&a.onRemove(this.map)}getLayer(e){return this._layers[e]}getLayersOrder(){return[...this._order]}hasLayer(e){return e in this._layers}setLayerZoomRange(e,a,c){this._checkLoaded();let r=this.getLayer(e);r?r.minzoom===a&&r.maxzoom===c||(a!=null&&(r.minzoom=a),c!=null&&(r.maxzoom=c),this._updateLayer(r)):this.fire(new o.k(new Error(`Cannot set the zoom range of non-existing layer "${e}".`)))}setFilter(e,a,c={}){this._checkLoaded();let r=this.getLayer(e);if(r){if(!o.bQ(r.filter,a))return a==null?(r.setFilter(void 0),void this._updateLayer(r)):void(this._validate(o.C.filter,`layers.${r.id}.filter`,a,null,c)||(r.setFilter(o.bU(a)),this._updateLayer(r)))}else this.fire(new o.k(new Error(`Cannot filter non-existing layer "${e}".`)))}getFilter(e){return o.bU(this.getLayer(e).filter)}setLayoutProperty(e,a,c,r={}){this._checkLoaded();let W=this.getLayer(e);W?o.bQ(W.getLayoutProperty(a),c)||(W.setLayoutProperty(a,c,r),this._updateLayer(W)):this.fire(new o.k(new Error(`Cannot style non-existing layer "${e}".`)))}getLayoutProperty(e,a){let c=this.getLayer(e);if(c)return c.getLayoutProperty(a);this.fire(new o.k(new Error(`Cannot get style of non-existing layer "${e}".`)))}setPaintProperty(e,a,c,r={}){this._checkLoaded();let W=this.getLayer(e);W?o.bQ(W.getPaintProperty(a),c)||this._updatePaintProperty(W,a,c,r):this.fire(new o.k(new Error(`Cannot style non-existing layer "${e}".`)))}_updatePaintProperty(e,a,c,r={}){e.setPaintProperty(a,c,r)&&this._updateLayer(e),o.bT(e)&&a==="raster-fade-duration"&&this.tileManagers[e.source].setRasterFadeDuration(c),this._changed=!0,this._updatedPaintProps[e.id]=!0,this._serializedLayers=null}getPaintProperty(e,a){return this.getLayer(e).getPaintProperty(a)}setFeatureState(e,a){this._checkLoaded();let c=e.source,r=e.sourceLayer,W=this.tileManagers[c];if(W===void 0)return void this.fire(new o.k(new Error(`The source '${c}' does not exist in the map's style.`)));let h=W.getSource().type;h==="geojson"&&r?this.fire(new o.k(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):h!=="vector"||r?(e.id===void 0&&this.fire(new o.k(new Error("The feature id parameter must be provided."))),W.setFeatureState(r,e.id,a)):this.fire(new o.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(e,a){this._checkLoaded();let c=e.source,r=this.tileManagers[c];if(r===void 0)return void this.fire(new o.k(new Error(`The source '${c}' does not exist in the map's style.`)));let W=r.getSource().type,h=W==="vector"?e.sourceLayer:void 0;W!=="vector"||h?a&&typeof e.id!="string"&&typeof e.id!="number"?this.fire(new o.k(new Error("A feature id is required to remove its specific state property."))):r.removeFeatureState(h,e.id,a):this.fire(new o.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(e){this._checkLoaded();let a=e.source,c=e.sourceLayer,r=this.tileManagers[a];if(r!==void 0)return r.getSource().type!=="vector"||c?(e.id===void 0&&this.fire(new o.k(new Error("The feature id parameter must be provided."))),r.getFeatureState(c,e.id)):void this.fire(new o.k(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new o.k(new Error(`The source '${a}' does not exist in the map's style.`)))}getTransition(){return o.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;let e=o.bX(this.tileManagers,(W=>W.serialize())),a=this._serializeByIds(this._order,!0),c=this.map.getTerrain()||void 0,r=this.stylesheet;return o.bY({version:r.version,name:r.name,metadata:r.metadata,light:r.light,sky:r.sky,center:r.center,zoom:r.zoom,bearing:r.bearing,pitch:r.pitch,sprite:r.sprite,glyphs:r.glyphs,transition:r.transition,projection:r.projection,sources:e,layers:a,terrain:c},(W=>W!==void 0))}_updateLayer(e){this._updatedLayers[e.id]=!0,e.source&&!this._updatedSources[e.source]&&this.tileManagers[e.source].getSource().type!=="raster"&&(this._updatedSources[e.source]="reload",this.tileManagers[e.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(e){let a=h=>this._layers[h].type==="fill-extrusion",c={},r=[];for(let h=this._order.length-1;h>=0;h--){let g=this._order[h];if(a(g)){c[g]=h;for(let u of e){let G=u[g];if(G)for(let Y of G)r.push(Y)}}}r.sort(((h,g)=>g.intersectionZ-h.intersectionZ));let W=[];for(let h=this._order.length-1;h>=0;h--){let g=this._order[h];if(a(g))for(let u=r.length-1;u>=0;u--){let G=r[u].feature;if(c[G.layer.id]<h)break;W.push(G),r.pop()}else for(let u of e){let G=u[g];if(G)for(let Y of G)W.push(Y.feature)}}return W}queryRenderedFeatures(e,a,c){a&&a.filter&&this._validate(o.C.filter,"queryRenderedFeatures.filter",a.filter,null,a);let r={};if(a&&a.layers){if(!(Array.isArray(a.layers)||a.layers instanceof Set))return this.fire(new o.k(new Error("parameters.layers must be an Array or a Set of strings"))),[];for(let G of a.layers){let Y=this._layers[G];if(!Y)return this.fire(new o.k(new Error(`The layer '${G}' does not exist in the map's style and cannot be queried for features.`))),[];r[Y.source]=!0}}let W=[];a.availableImages=this._availableImages;let h=this._serializedAllLayers(),g=a.layers instanceof Set?a.layers:Array.isArray(a.layers)?new Set(a.layers):null,u=Object.assign(Object.assign({},a),{layers:g,globalState:this._globalState});for(let G in this.tileManagers)a.layers&&!r[G]||W.push(Ra(this.tileManagers[G],this._layers,h,e,u,c,this.map.terrain?(Y,y,J)=>this.map.terrain.getElevation(Y,y,J):void 0));return this.placement&&W.push((function(G,Y,y,J,S,L,w){let v={},O=L.queryRenderedSymbols(J),K=[];for(let tt of Object.keys(O).map(Number))K.push(w[tt]);K.sort(Le);for(let tt of K){let _=tt.featureIndex.lookupSymbolFeatures(O[tt.bucketInstanceId],Y,tt.bucketIndex,tt.sourceLayerIndex,{filterSpec:S.filter,globalState:S.globalState},S.layers,S.availableImages,G);for(let et in _){let it=v[et]=v[et]||[],q=_[et];q.sort(((ct,ht)=>{let bt=tt.featureSortOrder;if(bt){let mt=bt.indexOf(ct.featureIndex);return bt.indexOf(ht.featureIndex)-mt}return ht.featureIndex-ct.featureIndex}));for(let ct of q)it.push(ct)}}return(function(tt,_,et){for(let it in tt)for(let q of tt[it])si(q,et[_[it].source]);return tt})(v,G,y)})(this._layers,h,this.tileManagers,e,u,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(W)}querySourceFeatures(e,a){a?.filter&&this._validate(o.C.filter,"querySourceFeatures.filter",a.filter,null,a);let c=this.tileManagers[e];return c?(function(r,W){let h=r.getRenderableIds().map((G=>r.getTileByID(G))),g=[],u={};for(let G=0;G<h.length;G++){let Y=h[G],y=Y.tileID.canonical.key;u[y]||(u[y]=!0,Y.querySourceFeatures(g,W))}return g})(c,a?Object.assign(Object.assign({},a),{globalState:this._globalState}):{globalState:this._globalState}):[]}getLight(){return this.light.getLight()}setLight(e,a={}){this._checkLoaded();let c=this.light.getLight(),r=!1;for(let h in e)if(!o.bQ(e[h],c[h])){r=!0;break}if(!r)return;let W={now:Ct(),transition:o.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(e,a),this.light.updateTransitions(W)}getProjection(){var e;return(e=this.stylesheet)===null||e===void 0?void 0:e.projection}setProjection(e){if(this._checkLoaded(),this.projection){if(this.projection.name===e.type)return;this.projection.destroy(),delete this.projection}this.stylesheet.projection=e,this._setProjectionInternal(e.type)}getSky(){var e;return(e=this.stylesheet)===null||e===void 0?void 0:e.sky}setSky(e,a={}){this._checkLoaded();let c=this.getSky(),r=!1;if(!e&&!c)return;if(e&&!c)r=!0;else if(!e&&c)r=!0;else for(let h in e)if(!o.bQ(e[h],c[h])){r=!0;break}if(!r)return;let W={now:Ct(),transition:o.e({duration:300,delay:0},this.stylesheet.transition)};this.stylesheet.sky=e,this.sky.setSky(e,a),this.sky.updateTransitions(W)}_setProjectionInternal(e){let a=(function(c,r){let W={constrainOverride:r};if(Array.isArray(c)){let h=new vn({type:c});return{projection:h,transform:new xc(W),cameraHelper:new Tc(h)}}switch(c){case"mercator":return{projection:new Gl,transform:new je(W),cameraHelper:new mi};case"globe":{let h=new vn({type:["interpolate",["linear"],["zoom"],11,"vertical-perspective",12,"mercator"]});return{projection:h,transform:new xc(W),cameraHelper:new Tc(h)}}case"vertical-perspective":return{projection:new Nd,transform:new Yc(W),cameraHelper:new Wi};default:return o.w(`Unknown projection name: ${c}. Falling back to mercator projection.`),{projection:new Gl,transform:new je(W),cameraHelper:new mi}}})(e,this.map.transformConstrain);this.projection=a.projection,this.map.migrateProjection(a.transform,a.cameraHelper);for(let c in this.tileManagers)this.tileManagers[c].reload()}_validate(e,a,c,r,W={}){return(!W||W.validate!==!1)&&sn(this,e.call(o.C,o.e({key:a,style:this.serialize(),value:c,styleSpec:o.u},r)))}_remove(e=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),wi().off(Ai,this._rtlPluginLoaded);for(let a in this._layers)this._layers[a].setEventedParent(null);for(let a in this.tileManagers){let c=this.tileManagers[a];c.setEventedParent(null),c.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),e&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(e)}_clearSource(e){this.tileManagers[e].clearTiles()}_reloadSource(e){this.tileManagers[e].resume(),this.tileManagers[e].reload()}_updateSources(e){for(let a in this.tileManagers)this.tileManagers[a].update(e,this.map.terrain)}_generateCollisionBoxes(){for(let e in this.tileManagers)this._reloadSource(e)}_updatePlacement(e,a,c,r,W=!1){let h=!1,g=!1,u={};for(let G of this._order){let Y=this._layers[G];if(Y.type!=="symbol")continue;if(!u[Y.source]){let J=this.tileManagers[Y.source];u[Y.source]=J.getRenderableIds(!0).map((S=>J.getTileByID(S))).sort(((S,L)=>L.tileID.overscaledZ-S.tileID.overscaledZ||(S.tileID.isLessThan(L.tileID)?-1:1)))}let y=this.crossTileSymbolIndex.addLayer(Y,u[Y.source],e.center.lng);h=h||y}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((W=W||this._layerOrderChanged||c===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(Ct(),e.zoom))&&(this.pauseablePlacement=new Br(e,this.map.terrain,this._order,W,a,c,r,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,u),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(Ct()),g=!0),h&&this.pauseablePlacement.placement.setStale()),g||h)for(let G of this._order){let Y=this._layers[G];Y.type==="symbol"&&this.placement.updateLayerOpacities(Y,u[Y.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(Ct())}_releaseSymbolFadeTiles(){for(let e in this.tileManagers)this.tileManagers[e].releaseSymbolFadeTiles()}getImages(e,a){return o._(this,void 0,void 0,(function*(){let c=yield this.imageManager.getImages(a.icons);this._updateTilesForChangedImages();let r=this.tileManagers[a.source];return r&&r.setDependencies(a.tileID.key,a.type,a.icons),c}))}getGlyphs(e,a){return o._(this,void 0,void 0,(function*(){let c=yield this.glyphManager.getGlyphs(a.stacks),r=this.tileManagers[a.source];return r&&r.setDependencies(a.tileID.key,a.type,[""]),c}))}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(e,a={}){this._checkLoaded(),e&&this._validate(o.C.glyphs,"glyphs",e,null,a)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=e,this.glyphManager.entries={},this.glyphManager.setURL(e))}getDashes(e,a){return o._(this,void 0,void 0,(function*(){let c={};for(let[r,W]of Object.entries(a.dashes))c[r]=this.lineAtlas.getDash(W.dasharray,W.round);return c}))}addSprite(e,a,c={},r){this._checkLoaded();let W=[{id:e,url:a}],h=[...ue(this.stylesheet.sprite),...W];this._validate(o.C.sprite,"sprite",h,null,c)||(this.stylesheet.sprite=h,this._loadSprite(W,!0,r))}removeSprite(e){this._checkLoaded();let a=ue(this.stylesheet.sprite);if(a.find((c=>c.id===e))){if(this._spritesImagesIds[e])for(let c of this._spritesImagesIds[e])this.imageManager.removeImage(c),this._changedImages[c]=!0;a.splice(a.findIndex((c=>c.id===e)),1),this.stylesheet.sprite=a.length>0?a:void 0,delete this._spritesImagesIds[e],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new o.l("data",{dataType:"style"}))}else this.fire(new o.k(new Error(`Sprite "${e}" doesn't exists on this map.`)))}getSprite(){return ue(this.stylesheet.sprite)}setSprite(e,a={},c){this._checkLoaded(),e&&this._validate(o.C.sprite,"sprite",e,null,a)||(this.stylesheet.sprite=e,e?this._loadSprite(e,!0,c):(this._unloadSprite(),c&&c(null)))}destroy(){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null);for(let e in this.tileManagers){let a=this.tileManagers[e];if(a.setEventedParent(null),a._tiles){for(let c in a._tiles)a._tiles[c].unloadVectorData();a._tiles={}}a._cache.reset(),a.onRemove(this.map)}this.tileManagers={},this.imageManager&&(this.imageManager.setEventedParent(null),this.imageManager.destroy(),this._availableImages=[],this._spritesImagesIds={}),this.glyphManager&&this.glyphManager.destroy();for(let e in this._layers){let a=this._layers[e];a.setEventedParent(null),a.onRemove&&a.onRemove(this.map)}this._setInitialValues(),this.setEventedParent(null),this.dispatcher.unregisterMessageHandler("GG"),this.dispatcher.unregisterMessageHandler("GI"),this.dispatcher.unregisterMessageHandler("GDA"),this.dispatcher.remove(!0),this._listeners={},this._oneTimeListeners={}}}var oa=o.aT([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class kb{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(e,a,c,r,W,h,g,u,G){this.context=e;let Y=this.boundPaintVertexBuffers.length!==r.length;for(let y=0;!Y&&y<r.length;y++)this.boundPaintVertexBuffers[y]!==r[y]&&(Y=!0);!this.vao||this.boundProgram!==a||this.boundLayoutVertexBuffer!==c||Y||this.boundIndexBuffer!==W||this.boundVertexOffset!==h||this.boundDynamicVertexBuffer!==g||this.boundDynamicVertexBuffer2!==u||this.boundDynamicVertexBuffer3!==G?this.freshBind(a,c,r,W,h,g,u,G):(e.bindVertexArray.set(this.vao),g&&g.bind(),W&&W.dynamicDraw&&W.bind(),u&&u.bind(),G&&G.bind())}freshBind(e,a,c,r,W,h,g,u){let G=e.numAttributes,Y=this.context,y=Y.gl;this.vao&&this.destroy(),this.vao=Y.createVertexArray(),Y.bindVertexArray.set(this.vao),this.boundProgram=e,this.boundLayoutVertexBuffer=a,this.boundPaintVertexBuffers=c,this.boundIndexBuffer=r,this.boundVertexOffset=W,this.boundDynamicVertexBuffer=h,this.boundDynamicVertexBuffer2=g,this.boundDynamicVertexBuffer3=u,a.enableAttributes(y,e);for(let J of c)J.enableAttributes(y,e);h&&h.enableAttributes(y,e),g&&g.enableAttributes(y,e),u&&u.enableAttributes(y,e),a.bind(),a.setVertexAttribPointers(y,e,W);for(let J of c)J.bind(),J.setVertexAttribPointers(y,e,W);h&&(h.bind(),h.setVertexAttribPointers(y,e,W)),r&&r.bind(),g&&(g.bind(),g.setVertexAttribPointers(y,e,W)),u&&(u.bind(),u.setVertexAttribPointers(y,e,W)),Y.currentNumAttributes=G}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}let Ko=(m,e,a,c,r)=>({u_texture:0,u_ele_delta:m,u_fog_matrix:e,u_fog_color:a?a.properties.get("fog-color"):o.bo.white,u_fog_ground_blend:a?a.properties.get("fog-ground-blend"):1,u_fog_ground_blend_opacity:r?0:a?a.calculateFogBlendOpacity(c):0,u_horizon_color:a?a.properties.get("horizon-color"):o.bo.white,u_horizon_fog_blend:a?a.properties.get("horizon-fog-blend"):1,u_is_globe_mode:r?1:0}),Ud={mainMatrix:"u_projection_matrix",tileMercatorCoords:"u_projection_tile_mercator_coords",clippingPlane:"u_projection_clipping_plane",projectionTransition:"u_projection_transition",fallbackMatrix:"u_projection_fallback_matrix"};function Oa(m){let e=[];for(let a=0;a<m.length;a++){if(m[a]===null)continue;let c=m[a].split(" ");e.push(c.pop())}return e}class Lb{constructor(e,a,c,r,W,h,g,u,G=[]){let Y=e.gl;this.program=Y.createProgram();let y=Oa(a.staticAttributes),J=c?c.getBinderAttributes():[],S=y.concat(J),L=yi.prelude.staticUniforms?Oa(yi.prelude.staticUniforms):[],w=g.staticUniforms?Oa(g.staticUniforms):[],v=a.staticUniforms?Oa(a.staticUniforms):[],O=c?c.getBinderUniforms():[],K=L.concat(w).concat(v).concat(O),tt=[];for(let bt of K)tt.indexOf(bt)<0&&tt.push(bt);let _=c?c.defines():[];Hi(Y)&&_.unshift("#version 300 es"),W&&_.push("#define OVERDRAW_INSPECTOR;"),h&&_.push("#define TERRAIN3D;"),u&&_.push(u),G&&_.push(...G);let et=_.concat(yi.prelude.fragmentSource,g.fragmentSource,a.fragmentSource).join(`
`),it=_.concat(yi.prelude.vertexSource,g.vertexSource,a.vertexSource).join(`
`);Hi(Y)||(et=(function(bt){return bt.replace(/\bin\s/g,"varying ").replace("out highp vec4 fragColor;","").replace(/fragColor/g,"gl_FragColor").replace(/texture\(/g,"texture2D(")})(et),it=(function(bt){return bt.replace(/\bin\s/g,"attribute ").replace(/\bout\s/g,"varying ").replace(/texture\(/g,"texture2D(")})(it));let q=Y.createShader(Y.FRAGMENT_SHADER);if(Y.isContextLost())return void(this.failedToCreate=!0);if(Y.shaderSource(q,et),Y.compileShader(q),!Y.getShaderParameter(q,Y.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${Y.getShaderInfoLog(q)}`);Y.attachShader(this.program,q);let ct=Y.createShader(Y.VERTEX_SHADER);if(Y.isContextLost())return void(this.failedToCreate=!0);if(Y.shaderSource(ct,it),Y.compileShader(ct),!Y.getShaderParameter(ct,Y.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${Y.getShaderInfoLog(ct)}`);Y.attachShader(this.program,ct),this.attributes={};let ht={};this.numAttributes=S.length;for(let bt=0;bt<this.numAttributes;bt++)S[bt]&&(Y.bindAttribLocation(this.program,bt,S[bt]),this.attributes[S[bt]]=bt);if(Y.linkProgram(this.program),!Y.getProgramParameter(this.program,Y.LINK_STATUS))throw new Error(`Program failed to link: ${Y.getProgramInfoLog(this.program)}`);Y.deleteShader(ct),Y.deleteShader(q);for(let bt=0;bt<tt.length;bt++){let mt=tt[bt];if(mt&&!ht[mt]){let Zt=Y.getUniformLocation(this.program,mt);Zt&&(ht[mt]=Zt)}}this.fixedUniforms=r(e,ht),this.terrainUniforms=((bt,mt)=>({u_depth:new o.bZ(bt,mt.u_depth),u_terrain:new o.bZ(bt,mt.u_terrain),u_terrain_dim:new o.bp(bt,mt.u_terrain_dim),u_terrain_matrix:new o.b$(bt,mt.u_terrain_matrix),u_terrain_unpack:new o.c0(bt,mt.u_terrain_unpack),u_terrain_exaggeration:new o.bp(bt,mt.u_terrain_exaggeration)}))(e,ht),this.projectionUniforms=((bt,mt)=>({u_projection_matrix:new o.b$(bt,mt.u_projection_matrix),u_projection_tile_mercator_coords:new o.c0(bt,mt.u_projection_tile_mercator_coords),u_projection_clipping_plane:new o.c0(bt,mt.u_projection_clipping_plane),u_projection_transition:new o.bp(bt,mt.u_projection_transition),u_projection_fallback_matrix:new o.b$(bt,mt.u_projection_fallback_matrix)}))(e,ht),this.binderUniforms=c?c.getUniforms(e,ht):[]}draw(e,a,c,r,W,h,g,u,G,Y,y,J,S,L,w,v,O,K,tt){let _=e.gl;if(this.failedToCreate)return;if(e.program.set(this.program),e.setDepthMode(c),e.setStencilMode(r),e.setColorMode(W),e.setCullFace(h),u){e.activeTexture.set(_.TEXTURE2),_.bindTexture(_.TEXTURE_2D,u.depthTexture),e.activeTexture.set(_.TEXTURE3),_.bindTexture(_.TEXTURE_2D,u.texture);for(let it in this.terrainUniforms)this.terrainUniforms[it].set(u[it])}if(G)for(let it in G)this.projectionUniforms[Ud[it]].set(G[it]);if(g)for(let it in this.fixedUniforms)this.fixedUniforms[it].set(g[it]);v&&v.setUniforms(e,this.binderUniforms,L,{zoom:w});let et=0;switch(a){case _.LINES:et=2;break;case _.TRIANGLES:et=3;break;case _.LINE_STRIP:et=1}for(let it of S.get()){let q=it.vaos||(it.vaos={});(q[Y]||(q[Y]=new kb)).bind(e,this,y,v?v.getPaintVertexBuffers():[],J,it.vertexOffset,O,K,tt),_.drawElements(a,it.primitiveLength*et,_.UNSIGNED_SHORT,it.primitiveOffset*et*2)}}}function Md(m,e,a){let c=1/o.aM(a,1,e.transform.tileZoom),r=Math.pow(2,a.tileID.overscaledZ),W=a.tileSize*Math.pow(2,e.transform.tileZoom)/r,h=W*(a.tileID.canonical.x+a.tileID.wrap*r),g=W*a.tileID.canonical.y;return{u_image:0,u_texsize:a.imageAtlasTexture.size,u_scale:[c,m.fromScale,m.toScale],u_fade:m.t,u_pixel_coord_upper:[h>>16,g>>16],u_pixel_coord_lower:[65535&h,65535&g]}}let zr=(m,e,a,c)=>{let r=m.style.light,W=r.properties.get("position"),h=[W.x,W.y,W.z],g=o.c3();r.properties.get("anchor")==="viewport"&&o.c4(g,m.transform.bearingInRadians),o.c5(h,h,g);let u=m.transform.transformLightDirection(h),G=r.properties.get("color");return{u_lightpos:h,u_lightpos_globe:u,u_lightintensity:r.properties.get("intensity"),u_lightcolor:[G.r,G.g,G.b],u_vertical_gradient:+e,u_opacity:a,u_fill_translate:c}},Dn=(m,e,a,c,r,W,h)=>o.e(zr(m,e,a,c),Md(W,m,h),{u_height_factor:-Math.pow(2,r.overscaledZ)/h.tileSize/8}),jr=(m,e,a,c)=>o.e(Md(e,m,a),{u_fill_translate:c}),Ar=(m,e)=>({u_world:m,u_fill_translate:e}),Eb=(m,e,a,c,r)=>o.e(jr(m,e,a,r),{u_world:c}),wr=(m,e,a,c,r)=>{let W=m.transform,h,g,u=0;if(a.paint.get("circle-pitch-alignment")==="map"){let G=o.aM(e,1,W.zoom);h=!0,g=[G,G],u=G/(o.a4*Math.pow(2,e.tileID.overscaledZ))*2*Math.PI*r}else h=!1,g=W.pixelsToGLUnits;return{u_camera_to_center_distance:W.cameraToCenterDistance,u_scale_with_map:+(a.paint.get("circle-pitch-scale")==="map"),u_pitch_with_map:+h,u_device_pixel_ratio:m.pixelRatio,u_extrude_scale:g,u_globe_extrude_scale:u,u_translate:c}},Po=m=>({u_pixel_extrude_scale:[1/m.width,1/m.height]}),vr=m=>({u_viewport_size:[m.width,m.height]}),qo=(m,e=1)=>({u_color:m,u_overlay:0,u_overlay_scale:e}),$o=(m,e,a,c)=>{let r=o.aM(m,1,e)/(o.a4*Math.pow(2,m.tileID.overscaledZ))*2*Math.PI*c;return{u_extrude_scale:o.aM(m,1,e),u_intensity:a,u_globe_extrude_scale:r}},ts=(m,e,a,c)=>{let r=o.N();o.c6(r,0,m.width,m.height,0,0,1);let W=m.context.gl;return{u_matrix:r,u_world:[W.drawingBufferWidth,W.drawingBufferHeight],u_image:a,u_color_ramp:c,u_opacity:e.paint.get("heatmap-opacity")}},rn=(m,e,a)=>{let c=a.paint.get("hillshade-accent-color"),r;switch(a.paint.get("hillshade-method")){case"basic":r=4;break;case"combined":r=1;break;case"igor":r=2;break;case"multidirectional":r=3;break;default:r=0}let W=a.getIlluminationProperties();for(let h=0;h<W.directionRadians.length;h++)a.paint.get("hillshade-illumination-anchor")==="viewport"&&(W.directionRadians[h]+=m.transform.bearingInRadians);return{u_image:0,u_latrange:Dr(0,e.tileID),u_exaggeration:a.paint.get("hillshade-exaggeration"),u_altitudes:W.altitudeRadians,u_azimuths:W.directionRadians,u_accent:c,u_method:r,u_highlights:W.highlightColor,u_shadows:W.shadowColor}},Hr=(m,e)=>{let a=e.stride,c=o.N();return o.c6(c,0,o.a4,-o.a4,0,0,1),o.O(c,c,[0,-o.a4,0]),{u_matrix:c,u_image:1,u_dimension:[a,a],u_zoom:m.overscaledZ,u_unpack:e.getUnpackVector()}};function Dr(m,e){let a=Math.pow(2,e.canonical.z),c=e.canonical.y;return[new o.aa(0,c/a).toLngLat().lat,new o.aa(0,(c+1)/a).toLngLat().lat]}let Yd=(m,e,a=0)=>({u_image:0,u_unpack:e.getUnpackVector(),u_dimension:[e.stride,e.stride],u_elevation_stops:1,u_color_stops:4,u_color_ramp_size:a,u_opacity:m.paint.get("color-relief-opacity")}),Xc=(m,e,a,c)=>{let r=m.transform;return{u_translation:es(m,e,a),u_ratio:c/o.aM(e,1,r.zoom),u_device_pixel_ratio:m.pixelRatio,u_units_to_pixels:[1/r.pixelsToGLUnits[0],1/r.pixelsToGLUnits[1]]}},xd=(m,e,a,c,r)=>o.e(Xc(m,e,a,c),{u_image:0,u_image_height:r}),zb=(m,e,a,c,r)=>{let W=m.transform,h=Jc(e,W);return{u_translation:es(m,e,a),u_texsize:e.imageAtlasTexture.size,u_ratio:c/o.aM(e,1,W.zoom),u_device_pixel_ratio:m.pixelRatio,u_image:0,u_scale:[h,r.fromScale,r.toScale],u_fade:r.t,u_units_to_pixels:[1/W.pixelsToGLUnits[0],1/W.pixelsToGLUnits[1]]}},jb=(m,e,a,c,r)=>{let W=Jc(e,m.transform);return o.e(Xc(m,e,a,c),{u_tileratio:W,u_crossfade_from:r.fromScale,u_crossfade_to:r.toScale,u_image:0,u_mix:r.t,u_lineatlas_width:m.lineAtlas.width,u_lineatlas_height:m.lineAtlas.height})},Or=(m,e,a,c,r,W)=>{let h=Jc(e,m.transform);return o.e(Xc(m,e,a,c),{u_image:0,u_image_height:W,u_tileratio:h,u_crossfade_from:r.fromScale,u_crossfade_to:r.toScale,u_image_dash:1,u_mix:r.t,u_lineatlas_width:m.lineAtlas.width,u_lineatlas_height:m.lineAtlas.height})};function Jc(m,e){return 1/o.aM(m,1,e.tileZoom)}function es(m,e,a){return o.aN(m.transform,e,a.paint.get("line-translate"),a.paint.get("line-translate-anchor"))}let ls=(m,e,a,c,r)=>{return{u_tl_parent:m,u_scale_parent:e,u_buffer_scale:1,u_fade_t:a.mix,u_opacity:a.opacity*c.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:c.paint.get("raster-brightness-min"),u_brightness_high:c.paint.get("raster-brightness-max"),u_saturation_factor:(h=c.paint.get("raster-saturation"),h>0?1-1/(1.001-h):-h),u_contrast_factor:(W=c.paint.get("raster-contrast"),W>0?1/(1-W):1+W),u_spin_weights:fr(c.paint.get("raster-hue-rotate")),u_coords_top:[r[0].x,r[0].y,r[1].x,r[1].y],u_coords_bottom:[r[3].x,r[3].y,r[2].x,r[2].y]};var W,h};function fr(m){m*=Math.PI/180;let e=Math.sin(m),a=Math.cos(m);return[(2*a+1)/3,(-Math.sqrt(3)*e-a+1)/3,(Math.sqrt(3)*e-a+1)/3]}let Td=(m,e,a,c,r,W,h,g,u,G,Y,y,J)=>{let S=h.transform;return{u_is_size_zoom_constant:+(m==="constant"||m==="source"),u_is_size_feature_constant:+(m==="constant"||m==="camera"),u_size_t:e?e.uSizeT:0,u_size:e?e.uSize:0,u_camera_to_center_distance:S.cameraToCenterDistance,u_pitch:S.pitch/360*2*Math.PI,u_rotate_symbol:+a,u_aspect_ratio:S.width/S.height,u_fade_change:h.options.fadeDuration?h.symbolFadeChange:1,u_label_plane_matrix:g,u_coord_matrix:u,u_is_text:+Y,u_pitch_with_map:+c,u_is_along_line:r,u_is_variable_anchor:W,u_texsize:y,u_texture:0,u_translation:G,u_pitched_scale:J}},sa=(m,e,a,c,r,W,h,g,u,G,Y,y,J,S)=>{let L=h.transform;return o.e(Td(m,e,a,c,r,W,h,g,u,G,Y,y,S),{u_gamma_scale:c?Math.cos(L.pitch*Math.PI/180)*L.cameraToCenterDistance:1,u_device_pixel_ratio:h.pixelRatio,u_is_halo:1})},is=(m,e,a,c,r,W,h,g,u,G,Y,y,J)=>o.e(sa(m,e,a,c,r,W,h,g,u,G,!0,Y,0,J),{u_texsize_icon:y,u_texture_icon:1}),as=(m,e)=>({u_opacity:m,u_color:e}),ns=(m,e,a,c,r)=>o.e((function(W,h,g,u){let G=g.imageManager.getPattern(W.from.toString()),Y=g.imageManager.getPattern(W.to.toString()),{width:y,height:J}=g.imageManager.getPixelSize(),S=Math.pow(2,u.tileID.overscaledZ),L=u.tileSize*Math.pow(2,g.transform.tileZoom)/S,w=L*(u.tileID.canonical.x+u.tileID.wrap*S),v=L*u.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:G.tl,u_pattern_br_a:G.br,u_pattern_tl_b:Y.tl,u_pattern_br_b:Y.br,u_texsize:[y,J],u_mix:h.t,u_pattern_size_a:G.displaySize,u_pattern_size_b:Y.displaySize,u_scale_a:h.fromScale,u_scale_b:h.toScale,u_tile_units_to_pixels:1/o.aM(u,1,g.transform.tileZoom),u_pixel_coord_upper:[w>>16,v>>16],u_pixel_coord_lower:[65535&w,65535&v]}})(a,r,e,c),{u_opacity:m}),ds=(m,e)=>{},cs={fillExtrusion:(m,e)=>({u_lightpos:new o.c1(m,e.u_lightpos),u_lightpos_globe:new o.c1(m,e.u_lightpos_globe),u_lightintensity:new o.bp(m,e.u_lightintensity),u_lightcolor:new o.c1(m,e.u_lightcolor),u_vertical_gradient:new o.bp(m,e.u_vertical_gradient),u_opacity:new o.bp(m,e.u_opacity),u_fill_translate:new o.c2(m,e.u_fill_translate)}),fillExtrusionPattern:(m,e)=>({u_lightpos:new o.c1(m,e.u_lightpos),u_lightpos_globe:new o.c1(m,e.u_lightpos_globe),u_lightintensity:new o.bp(m,e.u_lightintensity),u_lightcolor:new o.c1(m,e.u_lightcolor),u_vertical_gradient:new o.bp(m,e.u_vertical_gradient),u_height_factor:new o.bp(m,e.u_height_factor),u_opacity:new o.bp(m,e.u_opacity),u_fill_translate:new o.c2(m,e.u_fill_translate),u_image:new o.bZ(m,e.u_image),u_texsize:new o.c2(m,e.u_texsize),u_pixel_coord_upper:new o.c2(m,e.u_pixel_coord_upper),u_pixel_coord_lower:new o.c2(m,e.u_pixel_coord_lower),u_scale:new o.c1(m,e.u_scale),u_fade:new o.bp(m,e.u_fade)}),fill:(m,e)=>({u_fill_translate:new o.c2(m,e.u_fill_translate)}),fillPattern:(m,e)=>({u_image:new o.bZ(m,e.u_image),u_texsize:new o.c2(m,e.u_texsize),u_pixel_coord_upper:new o.c2(m,e.u_pixel_coord_upper),u_pixel_coord_lower:new o.c2(m,e.u_pixel_coord_lower),u_scale:new o.c1(m,e.u_scale),u_fade:new o.bp(m,e.u_fade),u_fill_translate:new o.c2(m,e.u_fill_translate)}),fillOutline:(m,e)=>({u_world:new o.c2(m,e.u_world),u_fill_translate:new o.c2(m,e.u_fill_translate)}),fillOutlinePattern:(m,e)=>({u_world:new o.c2(m,e.u_world),u_image:new o.bZ(m,e.u_image),u_texsize:new o.c2(m,e.u_texsize),u_pixel_coord_upper:new o.c2(m,e.u_pixel_coord_upper),u_pixel_coord_lower:new o.c2(m,e.u_pixel_coord_lower),u_scale:new o.c1(m,e.u_scale),u_fade:new o.bp(m,e.u_fade),u_fill_translate:new o.c2(m,e.u_fill_translate)}),circle:(m,e)=>({u_camera_to_center_distance:new o.bp(m,e.u_camera_to_center_distance),u_scale_with_map:new o.bZ(m,e.u_scale_with_map),u_pitch_with_map:new o.bZ(m,e.u_pitch_with_map),u_extrude_scale:new o.c2(m,e.u_extrude_scale),u_device_pixel_ratio:new o.bp(m,e.u_device_pixel_ratio),u_globe_extrude_scale:new o.bp(m,e.u_globe_extrude_scale),u_translate:new o.c2(m,e.u_translate)}),collisionBox:(m,e)=>({u_pixel_extrude_scale:new o.c2(m,e.u_pixel_extrude_scale)}),collisionCircle:(m,e)=>({u_viewport_size:new o.c2(m,e.u_viewport_size)}),debug:(m,e)=>({u_color:new o.b_(m,e.u_color),u_overlay:new o.bZ(m,e.u_overlay),u_overlay_scale:new o.bp(m,e.u_overlay_scale)}),depth:ds,clippingMask:ds,heatmap:(m,e)=>({u_extrude_scale:new o.bp(m,e.u_extrude_scale),u_intensity:new o.bp(m,e.u_intensity),u_globe_extrude_scale:new o.bp(m,e.u_globe_extrude_scale)}),heatmapTexture:(m,e)=>({u_matrix:new o.b$(m,e.u_matrix),u_world:new o.c2(m,e.u_world),u_image:new o.bZ(m,e.u_image),u_color_ramp:new o.bZ(m,e.u_color_ramp),u_opacity:new o.bp(m,e.u_opacity)}),hillshade:(m,e)=>({u_image:new o.bZ(m,e.u_image),u_latrange:new o.c2(m,e.u_latrange),u_exaggeration:new o.bp(m,e.u_exaggeration),u_altitudes:new o.c8(m,e.u_altitudes),u_azimuths:new o.c8(m,e.u_azimuths),u_accent:new o.b_(m,e.u_accent),u_method:new o.bZ(m,e.u_method),u_shadows:new o.c7(m,e.u_shadows),u_highlights:new o.c7(m,e.u_highlights)}),hillshadePrepare:(m,e)=>({u_matrix:new o.b$(m,e.u_matrix),u_image:new o.bZ(m,e.u_image),u_dimension:new o.c2(m,e.u_dimension),u_zoom:new o.bp(m,e.u_zoom),u_unpack:new o.c0(m,e.u_unpack)}),colorRelief:(m,e)=>({u_image:new o.bZ(m,e.u_image),u_unpack:new o.c0(m,e.u_unpack),u_dimension:new o.c2(m,e.u_dimension),u_elevation_stops:new o.bZ(m,e.u_elevation_stops),u_color_stops:new o.bZ(m,e.u_color_stops),u_color_ramp_size:new o.bZ(m,e.u_color_ramp_size),u_opacity:new o.bp(m,e.u_opacity)}),line:(m,e)=>({u_translation:new o.c2(m,e.u_translation),u_ratio:new o.bp(m,e.u_ratio),u_device_pixel_ratio:new o.bp(m,e.u_device_pixel_ratio),u_units_to_pixels:new o.c2(m,e.u_units_to_pixels)}),lineGradient:(m,e)=>({u_translation:new o.c2(m,e.u_translation),u_ratio:new o.bp(m,e.u_ratio),u_device_pixel_ratio:new o.bp(m,e.u_device_pixel_ratio),u_units_to_pixels:new o.c2(m,e.u_units_to_pixels),u_image:new o.bZ(m,e.u_image),u_image_height:new o.bp(m,e.u_image_height)}),linePattern:(m,e)=>({u_translation:new o.c2(m,e.u_translation),u_texsize:new o.c2(m,e.u_texsize),u_ratio:new o.bp(m,e.u_ratio),u_device_pixel_ratio:new o.bp(m,e.u_device_pixel_ratio),u_image:new o.bZ(m,e.u_image),u_units_to_pixels:new o.c2(m,e.u_units_to_pixels),u_scale:new o.c1(m,e.u_scale),u_fade:new o.bp(m,e.u_fade)}),lineSDF:(m,e)=>({u_translation:new o.c2(m,e.u_translation),u_ratio:new o.bp(m,e.u_ratio),u_device_pixel_ratio:new o.bp(m,e.u_device_pixel_ratio),u_units_to_pixels:new o.c2(m,e.u_units_to_pixels),u_image:new o.bZ(m,e.u_image),u_mix:new o.bp(m,e.u_mix),u_tileratio:new o.bp(m,e.u_tileratio),u_crossfade_from:new o.bp(m,e.u_crossfade_from),u_crossfade_to:new o.bp(m,e.u_crossfade_to),u_lineatlas_width:new o.bp(m,e.u_lineatlas_width),u_lineatlas_height:new o.bp(m,e.u_lineatlas_height)}),lineGradientSDF:(m,e)=>({u_translation:new o.c2(m,e.u_translation),u_ratio:new o.bp(m,e.u_ratio),u_device_pixel_ratio:new o.bp(m,e.u_device_pixel_ratio),u_units_to_pixels:new o.c2(m,e.u_units_to_pixels),u_image:new o.bZ(m,e.u_image),u_image_height:new o.bp(m,e.u_image_height),u_tileratio:new o.bp(m,e.u_tileratio),u_crossfade_from:new o.bp(m,e.u_crossfade_from),u_crossfade_to:new o.bp(m,e.u_crossfade_to),u_image_dash:new o.bZ(m,e.u_image_dash),u_mix:new o.bp(m,e.u_mix),u_lineatlas_width:new o.bp(m,e.u_lineatlas_width),u_lineatlas_height:new o.bp(m,e.u_lineatlas_height)}),raster:(m,e)=>({u_tl_parent:new o.c2(m,e.u_tl_parent),u_scale_parent:new o.bp(m,e.u_scale_parent),u_buffer_scale:new o.bp(m,e.u_buffer_scale),u_fade_t:new o.bp(m,e.u_fade_t),u_opacity:new o.bp(m,e.u_opacity),u_image0:new o.bZ(m,e.u_image0),u_image1:new o.bZ(m,e.u_image1),u_brightness_low:new o.bp(m,e.u_brightness_low),u_brightness_high:new o.bp(m,e.u_brightness_high),u_saturation_factor:new o.bp(m,e.u_saturation_factor),u_contrast_factor:new o.bp(m,e.u_contrast_factor),u_spin_weights:new o.c1(m,e.u_spin_weights),u_coords_top:new o.c0(m,e.u_coords_top),u_coords_bottom:new o.c0(m,e.u_coords_bottom)}),symbolIcon:(m,e)=>({u_is_size_zoom_constant:new o.bZ(m,e.u_is_size_zoom_constant),u_is_size_feature_constant:new o.bZ(m,e.u_is_size_feature_constant),u_size_t:new o.bp(m,e.u_size_t),u_size:new o.bp(m,e.u_size),u_camera_to_center_distance:new o.bp(m,e.u_camera_to_center_distance),u_pitch:new o.bp(m,e.u_pitch),u_rotate_symbol:new o.bZ(m,e.u_rotate_symbol),u_aspect_ratio:new o.bp(m,e.u_aspect_ratio),u_fade_change:new o.bp(m,e.u_fade_change),u_label_plane_matrix:new o.b$(m,e.u_label_plane_matrix),u_coord_matrix:new o.b$(m,e.u_coord_matrix),u_is_text:new o.bZ(m,e.u_is_text),u_pitch_with_map:new o.bZ(m,e.u_pitch_with_map),u_is_along_line:new o.bZ(m,e.u_is_along_line),u_is_variable_anchor:new o.bZ(m,e.u_is_variable_anchor),u_texsize:new o.c2(m,e.u_texsize),u_texture:new o.bZ(m,e.u_texture),u_translation:new o.c2(m,e.u_translation),u_pitched_scale:new o.bp(m,e.u_pitched_scale)}),symbolSDF:(m,e)=>({u_is_size_zoom_constant:new o.bZ(m,e.u_is_size_zoom_constant),u_is_size_feature_constant:new o.bZ(m,e.u_is_size_feature_constant),u_size_t:new o.bp(m,e.u_size_t),u_size:new o.bp(m,e.u_size),u_camera_to_center_distance:new o.bp(m,e.u_camera_to_center_distance),u_pitch:new o.bp(m,e.u_pitch),u_rotate_symbol:new o.bZ(m,e.u_rotate_symbol),u_aspect_ratio:new o.bp(m,e.u_aspect_ratio),u_fade_change:new o.bp(m,e.u_fade_change),u_label_plane_matrix:new o.b$(m,e.u_label_plane_matrix),u_coord_matrix:new o.b$(m,e.u_coord_matrix),u_is_text:new o.bZ(m,e.u_is_text),u_pitch_with_map:new o.bZ(m,e.u_pitch_with_map),u_is_along_line:new o.bZ(m,e.u_is_along_line),u_is_variable_anchor:new o.bZ(m,e.u_is_variable_anchor),u_texsize:new o.c2(m,e.u_texsize),u_texture:new o.bZ(m,e.u_texture),u_gamma_scale:new o.bp(m,e.u_gamma_scale),u_device_pixel_ratio:new o.bp(m,e.u_device_pixel_ratio),u_is_halo:new o.bZ(m,e.u_is_halo),u_translation:new o.c2(m,e.u_translation),u_pitched_scale:new o.bp(m,e.u_pitched_scale)}),symbolTextAndIcon:(m,e)=>({u_is_size_zoom_constant:new o.bZ(m,e.u_is_size_zoom_constant),u_is_size_feature_constant:new o.bZ(m,e.u_is_size_feature_constant),u_size_t:new o.bp(m,e.u_size_t),u_size:new o.bp(m,e.u_size),u_camera_to_center_distance:new o.bp(m,e.u_camera_to_center_distance),u_pitch:new o.bp(m,e.u_pitch),u_rotate_symbol:new o.bZ(m,e.u_rotate_symbol),u_aspect_ratio:new o.bp(m,e.u_aspect_ratio),u_fade_change:new o.bp(m,e.u_fade_change),u_label_plane_matrix:new o.b$(m,e.u_label_plane_matrix),u_coord_matrix:new o.b$(m,e.u_coord_matrix),u_is_text:new o.bZ(m,e.u_is_text),u_pitch_with_map:new o.bZ(m,e.u_pitch_with_map),u_is_along_line:new o.bZ(m,e.u_is_along_line),u_is_variable_anchor:new o.bZ(m,e.u_is_variable_anchor),u_texsize:new o.c2(m,e.u_texsize),u_texsize_icon:new o.c2(m,e.u_texsize_icon),u_texture:new o.bZ(m,e.u_texture),u_texture_icon:new o.bZ(m,e.u_texture_icon),u_gamma_scale:new o.bp(m,e.u_gamma_scale),u_device_pixel_ratio:new o.bp(m,e.u_device_pixel_ratio),u_is_halo:new o.bZ(m,e.u_is_halo),u_translation:new o.c2(m,e.u_translation),u_pitched_scale:new o.bp(m,e.u_pitched_scale)}),background:(m,e)=>({u_opacity:new o.bp(m,e.u_opacity),u_color:new o.b_(m,e.u_color)}),backgroundPattern:(m,e)=>({u_opacity:new o.bp(m,e.u_opacity),u_image:new o.bZ(m,e.u_image),u_pattern_tl_a:new o.c2(m,e.u_pattern_tl_a),u_pattern_br_a:new o.c2(m,e.u_pattern_br_a),u_pattern_tl_b:new o.c2(m,e.u_pattern_tl_b),u_pattern_br_b:new o.c2(m,e.u_pattern_br_b),u_texsize:new o.c2(m,e.u_texsize),u_mix:new o.bp(m,e.u_mix),u_pattern_size_a:new o.c2(m,e.u_pattern_size_a),u_pattern_size_b:new o.c2(m,e.u_pattern_size_b),u_scale_a:new o.bp(m,e.u_scale_a),u_scale_b:new o.bp(m,e.u_scale_b),u_pixel_coord_upper:new o.c2(m,e.u_pixel_coord_upper),u_pixel_coord_lower:new o.c2(m,e.u_pixel_coord_lower),u_tile_units_to_pixels:new o.bp(m,e.u_tile_units_to_pixels)}),terrain:(m,e)=>({u_texture:new o.bZ(m,e.u_texture),u_ele_delta:new o.bp(m,e.u_ele_delta),u_fog_matrix:new o.b$(m,e.u_fog_matrix),u_fog_color:new o.b_(m,e.u_fog_color),u_fog_ground_blend:new o.bp(m,e.u_fog_ground_blend),u_fog_ground_blend_opacity:new o.bp(m,e.u_fog_ground_blend_opacity),u_horizon_color:new o.b_(m,e.u_horizon_color),u_horizon_fog_blend:new o.bp(m,e.u_horizon_fog_blend),u_is_globe_mode:new o.bp(m,e.u_is_globe_mode)}),terrainDepth:(m,e)=>({u_ele_delta:new o.bp(m,e.u_ele_delta)}),terrainCoords:(m,e)=>({u_texture:new o.bZ(m,e.u_texture),u_terrain_coords_id:new o.bp(m,e.u_terrain_coords_id),u_ele_delta:new o.bp(m,e.u_ele_delta)}),projectionErrorMeasurement:(m,e)=>({u_input:new o.bp(m,e.u_input),u_output_expected:new o.bp(m,e.u_output_expected)}),atmosphere:(m,e)=>({u_sun_pos:new o.c1(m,e.u_sun_pos),u_atmosphere_blend:new o.bp(m,e.u_atmosphere_blend),u_globe_position:new o.c1(m,e.u_globe_position),u_globe_radius:new o.bp(m,e.u_globe_radius),u_inv_proj_matrix:new o.b$(m,e.u_inv_proj_matrix)}),sky:(m,e)=>({u_sky_color:new o.b_(m,e.u_sky_color),u_horizon_color:new o.b_(m,e.u_horizon_color),u_horizon:new o.c2(m,e.u_horizon),u_horizon_normal:new o.c2(m,e.u_horizon_normal),u_sky_horizon_blend:new o.bp(m,e.u_sky_horizon_blend),u_sky_blend:new o.bp(m,e.u_sky_blend)})};class bn{constructor(e,a,c){this.context=e;let r=e.gl;this.buffer=r.createBuffer(),this.dynamicDraw=!!c,this.context.unbindVAO(),e.bindElementBuffer.set(this.buffer),r.bufferData(r.ELEMENT_ARRAY_BUFFER,a.arrayBuffer,this.dynamicDraw?r.DYNAMIC_DRAW:r.STATIC_DRAW),this.dynamicDraw||delete a.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(e){let a=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),a.bufferSubData(a.ELEMENT_ARRAY_BUFFER,0,e.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}let os={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Ab{constructor(e,a,c,r){this.length=a.length,this.attributes=c,this.itemSize=a.bytesPerElement,this.dynamicDraw=r,this.context=e;let W=e.gl;this.buffer=W.createBuffer(),e.bindVertexBuffer.set(this.buffer),W.bufferData(W.ARRAY_BUFFER,a.arrayBuffer,this.dynamicDraw?W.DYNAMIC_DRAW:W.STATIC_DRAW),this.dynamicDraw||delete a.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(e){if(e.length!==this.length)throw new Error(`Length of new data is ${e.length}, which doesn't match current length of ${this.length}`);let a=this.context.gl;this.bind(),a.bufferSubData(a.ARRAY_BUFFER,0,e.arrayBuffer)}enableAttributes(e,a){for(let c=0;c<this.attributes.length;c++){let r=a.attributes[this.attributes[c].name];r!==void 0&&e.enableVertexAttribArray(r)}}setVertexAttribPointers(e,a,c){for(let r=0;r<this.attributes.length;r++){let W=this.attributes[r],h=a.attributes[W.name];h!==void 0&&e.vertexAttribPointer(h,W.components,e[os[W.type]],!1,this.itemSize,W.offset+this.itemSize*(c||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Fe{constructor(e){this.gl=e.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(e){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class wb extends Fe{getDefault(){return o.bo.transparent}set(e){let a=this.current;(e.r!==a.r||e.g!==a.g||e.b!==a.b||e.a!==a.a||this.dirty)&&(this.gl.clearColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class vb extends Fe{getDefault(){return 1}set(e){(e!==this.current||this.dirty)&&(this.gl.clearDepth(e),this.current=e,this.dirty=!1)}}class _r extends Fe{getDefault(){return 0}set(e){(e!==this.current||this.dirty)&&(this.gl.clearStencil(e),this.current=e,this.dirty=!1)}}class Hb extends Fe{getDefault(){return[!0,!0,!0,!0]}set(e){let a=this.current;(e[0]!==a[0]||e[1]!==a[1]||e[2]!==a[2]||e[3]!==a[3]||this.dirty)&&(this.gl.colorMask(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class Kr extends Fe{getDefault(){return!0}set(e){(e!==this.current||this.dirty)&&(this.gl.depthMask(e),this.current=e,this.dirty=!1)}}class yc extends Fe{getDefault(){return 255}set(e){(e!==this.current||this.dirty)&&(this.gl.stencilMask(e),this.current=e,this.dirty=!1)}}class Bc extends Fe{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(e){let a=this.current;(e.func!==a.func||e.ref!==a.ref||e.mask!==a.mask||this.dirty)&&(this.gl.stencilFunc(e.func,e.ref,e.mask),this.current=e,this.dirty=!1)}}class Sc extends Fe{getDefault(){let e=this.gl;return[e.KEEP,e.KEEP,e.KEEP]}set(e){let a=this.current;(e[0]!==a[0]||e[1]!==a[1]||e[2]!==a[2]||this.dirty)&&(this.gl.stencilOp(e[0],e[1],e[2]),this.current=e,this.dirty=!1)}}class ss extends Fe{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;let a=this.gl;e?a.enable(a.STENCIL_TEST):a.disable(a.STENCIL_TEST),this.current=e,this.dirty=!1}}class mn extends Fe{getDefault(){return[0,1]}set(e){let a=this.current;(e[0]!==a[0]||e[1]!==a[1]||this.dirty)&&(this.gl.depthRange(e[0],e[1]),this.current=e,this.dirty=!1)}}class Xd extends Fe{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;let a=this.gl;e?a.enable(a.DEPTH_TEST):a.disable(a.DEPTH_TEST),this.current=e,this.dirty=!1}}class On extends Fe{getDefault(){return this.gl.LESS}set(e){(e!==this.current||this.dirty)&&(this.gl.depthFunc(e),this.current=e,this.dirty=!1)}}class Bi extends Fe{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;let a=this.gl;e?a.enable(a.BLEND):a.disable(a.BLEND),this.current=e,this.dirty=!1}}class Pr extends Fe{getDefault(){let e=this.gl;return[e.ONE,e.ZERO]}set(e){let a=this.current;(e[0]!==a[0]||e[1]!==a[1]||this.dirty)&&(this.gl.blendFunc(e[0],e[1]),this.current=e,this.dirty=!1)}}class qr extends Fe{getDefault(){return o.bo.transparent}set(e){let a=this.current;(e.r!==a.r||e.g!==a.g||e.b!==a.b||e.a!==a.a||this.dirty)&&(this.gl.blendColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class rs extends Fe{getDefault(){return this.gl.FUNC_ADD}set(e){(e!==this.current||this.dirty)&&(this.gl.blendEquation(e),this.current=e,this.dirty=!1)}}class Wn extends Fe{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;let a=this.gl;e?a.enable(a.CULL_FACE):a.disable(a.CULL_FACE),this.current=e,this.dirty=!1}}class Cc extends Fe{getDefault(){return this.gl.BACK}set(e){(e!==this.current||this.dirty)&&(this.gl.cullFace(e),this.current=e,this.dirty=!1)}}class Qc extends Fe{getDefault(){return this.gl.CCW}set(e){(e!==this.current||this.dirty)&&(this.gl.frontFace(e),this.current=e,this.dirty=!1)}}class Jd extends Fe{getDefault(){return null}set(e){(e!==this.current||this.dirty)&&(this.gl.useProgram(e),this.current=e,this.dirty=!1)}}class kc extends Fe{getDefault(){return this.gl.TEXTURE0}set(e){(e!==this.current||this.dirty)&&(this.gl.activeTexture(e),this.current=e,this.dirty=!1)}}class $r extends Fe{getDefault(){let e=this.gl;return[0,0,e.drawingBufferWidth,e.drawingBufferHeight]}set(e){let a=this.current;(e[0]!==a[0]||e[1]!==a[1]||e[2]!==a[2]||e[3]!==a[3]||this.dirty)&&(this.gl.viewport(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class fn extends Fe{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;let a=this.gl;a.bindFramebuffer(a.FRAMEBUFFER,e),this.current=e,this.dirty=!1}}class _n extends Fe{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;let a=this.gl;a.bindRenderbuffer(a.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class t0 extends Fe{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;let a=this.gl;a.bindTexture(a.TEXTURE_2D,e),this.current=e,this.dirty=!1}}class bs extends Fe{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;let a=this.gl;a.bindBuffer(a.ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class We extends Fe{getDefault(){return null}set(e){let a=this.gl;a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class Lc extends Fe{getDefault(){return null}set(e){var a;if(e===this.current&&!this.dirty)return;let c=this.gl;Hi(c)?c.bindVertexArray(e):(a=c.getExtension("OES_vertex_array_object"))===null||a===void 0||a.bindVertexArrayOES(e),this.current=e,this.dirty=!1}}class Db extends Fe{getDefault(){return 4}set(e){if(e===this.current&&!this.dirty)return;let a=this.gl;a.pixelStorei(a.UNPACK_ALIGNMENT,e),this.current=e,this.dirty=!1}}class e0 extends Fe{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;let a=this.gl;a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e),this.current=e,this.dirty=!1}}class yd extends Fe{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;let a=this.gl;a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,e),this.current=e,this.dirty=!1}}class ms extends Fe{constructor(e,a){super(e),this.context=e,this.parent=a}getDefault(){return null}}class Ob extends ms{setDirty(){this.dirty=!0}set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let a=this.gl;a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,e,0),this.current=e,this.dirty=!1}}class l0 extends ms{set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let a=this.gl;a.framebufferRenderbuffer(a.FRAMEBUFFER,a.DEPTH_ATTACHMENT,a.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class fb extends ms{set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let a=this.gl;a.framebufferRenderbuffer(a.FRAMEBUFFER,a.DEPTH_STENCIL_ATTACHMENT,a.RENDERBUFFER,e),this.current=e,this.dirty=!1}}let Ec="Framebuffer is not complete";class zc{constructor(e,a,c,r,W){this.context=e,this.width=a,this.height=c;let h=e.gl,g=this.framebuffer=h.createFramebuffer();if(this.colorAttachment=new Ob(e,g),r)this.depthAttachment=W?new fb(e,g):new l0(e,g);else if(W)throw new Error("Stencil cannot be set without depth");if(h.checkFramebufferStatus(h.FRAMEBUFFER)!==h.FRAMEBUFFER_COMPLETE)throw new Error(Ec)}destroy(){let e=this.context.gl,a=this.colorAttachment.get();if(a&&e.deleteTexture(a),this.depthAttachment){let c=this.depthAttachment.get();c&&e.deleteRenderbuffer(c)}e.deleteFramebuffer(this.framebuffer)}}class jc{constructor(e){var a,c;if(this.gl=e,this.clearColor=new wb(this),this.clearDepth=new vb(this),this.clearStencil=new _r(this),this.colorMask=new Hb(this),this.depthMask=new Kr(this),this.stencilMask=new yc(this),this.stencilFunc=new Bc(this),this.stencilOp=new Sc(this),this.stencilTest=new ss(this),this.depthRange=new mn(this),this.depthTest=new Xd(this),this.depthFunc=new On(this),this.blend=new Bi(this),this.blendFunc=new Pr(this),this.blendColor=new qr(this),this.blendEquation=new rs(this),this.cullFace=new Wn(this),this.cullFaceSide=new Cc(this),this.frontFace=new Qc(this),this.program=new Jd(this),this.activeTexture=new kc(this),this.viewport=new $r(this),this.bindFramebuffer=new fn(this),this.bindRenderbuffer=new _n(this),this.bindTexture=new t0(this),this.bindVertexBuffer=new bs(this),this.bindElementBuffer=new We(this),this.bindVertexArray=new Lc(this),this.pixelStoreUnpack=new Db(this),this.pixelStoreUnpackPremultiplyAlpha=new e0(this),this.pixelStoreUnpackFlipY=new yd(this),this.extTextureFilterAnisotropic=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=e.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE),Hi(e)){this.HALF_FLOAT=e.HALF_FLOAT;let r=e.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(a=e.RGBA16F)!==null&&a!==void 0?a:r?.RGBA16F_EXT,this.RGB16F=(c=e.RGB16F)!==null&&c!==void 0?c:r?.RGB16F_EXT,e.getExtension("EXT_color_buffer_float")}else{e.getExtension("EXT_color_buffer_half_float"),e.getExtension("OES_texture_half_float_linear");let r=e.getExtension("OES_texture_half_float");this.HALF_FLOAT=r?.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(e,a){return new bn(this,e,a)}createVertexBuffer(e,a,c){return new Ab(this,e,a,c)}createRenderbuffer(e,a,c){let r=this.gl,W=r.createRenderbuffer();return this.bindRenderbuffer.set(W),r.renderbufferStorage(r.RENDERBUFFER,e,a,c),this.bindRenderbuffer.set(null),W}createFramebuffer(e,a,c,r){return new zc(this,e,a,c,r)}clear({color:e,depth:a,stencil:c}){let r=this.gl,W=0;e&&(W|=r.COLOR_BUFFER_BIT,this.clearColor.set(e),this.colorMask.set([!0,!0,!0,!0])),a!==void 0&&(W|=r.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(a),this.depthMask.set(!0)),c!==void 0&&(W|=r.STENCIL_BUFFER_BIT,this.clearStencil.set(c),this.stencilMask.set(255)),r.clear(W)}setCullFace(e){e.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(e.mode),this.frontFace.set(e.frontFace))}setDepthMode(e){e.func!==this.gl.ALWAYS||e.mask?(this.depthTest.set(!0),this.depthFunc.set(e.func),this.depthMask.set(e.mask),this.depthRange.set(e.range)):this.depthTest.set(!1)}setStencilMode(e){e.test.func!==this.gl.ALWAYS||e.mask?(this.stencilTest.set(!0),this.stencilMask.set(e.mask),this.stencilOp.set([e.fail,e.depthFail,e.pass]),this.stencilFunc.set({func:e.test.func,ref:e.ref,mask:e.test.mask})):this.stencilTest.set(!1)}setColorMode(e){o.bQ(e.blendFunction,Ae.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(e.blendFunction),this.blendColor.set(e.blendColor)),this.colorMask.set(e.mask)}createVertexArray(){var e;return Hi(this.gl)?this.gl.createVertexArray():(e=this.gl.getExtension("OES_vertex_array_object"))===null||e===void 0?void 0:e.createVertexArrayOES()}deleteVertexArray(e){var a;return Hi(this.gl)?this.gl.deleteVertexArray(e):(a=this.gl.getExtension("OES_vertex_array_object"))===null||a===void 0?void 0:a.deleteVertexArrayOES(e)}unbindVAO(){this.bindVertexArray.set(null)}}let Zn;function Ac(m,e,a,c,r){let W=m.context,h=m.transform,g=W.gl,u=m.useProgram("collisionBox"),G=[],Y=0,y=0;for(let O=0;O<c.length;O++){let K=c[O],tt=e.getTile(K).getBucket(a);if(!tt)continue;let _=r?tt.textCollisionBox:tt.iconCollisionBox,et=tt.collisionCircleArray;et.length>0&&(G.push({circleArray:et,circleOffset:y,coord:K}),Y+=et.length/4,y=Y),_&&u.draw(W,g.LINES,de.disabled,Ve.disabled,m.colorModeForRenderPass(),pe.disabled,Po(m.transform),m.style.map.terrain&&m.style.map.terrain.getTerrainData(K),h.getProjectionData({overscaledTileID:K,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),a.id,_.layoutVertexBuffer,_.indexBuffer,_.segments,null,m.transform.zoom,null,null,_.collisionVertexBuffer)}if(!r||!G.length)return;let J=m.useProgram("collisionCircle"),S=new o.c9;S.resize(4*Y),S._trim();let L=0;for(let O of G)for(let K=0;K<O.circleArray.length/4;K++){let tt=4*K,_=O.circleArray[tt+0],et=O.circleArray[tt+1],it=O.circleArray[tt+2],q=O.circleArray[tt+3];S.emplace(L++,_,et,it,q,0),S.emplace(L++,_,et,it,q,1),S.emplace(L++,_,et,it,q,2),S.emplace(L++,_,et,it,q,3)}(!Zn||Zn.length<2*Y)&&(Zn=(function(O){let K=2*O,tt=new o.cb;tt.resize(K),tt._trim();for(let _=0;_<K;_++){let et=6*_;tt.uint16[et+0]=4*_+0,tt.uint16[et+1]=4*_+1,tt.uint16[et+2]=4*_+2,tt.uint16[et+3]=4*_+2,tt.uint16[et+4]=4*_+3,tt.uint16[et+5]=4*_+0}return tt})(Y));let w=W.createIndexBuffer(Zn,!0),v=W.createVertexBuffer(S,o.ca.members,!0);for(let O of G){let K=vr(m.transform);J.draw(W,g.TRIANGLES,de.disabled,Ve.disabled,m.colorModeForRenderPass(),pe.disabled,K,m.style.map.terrain&&m.style.map.terrain.getTerrainData(O.coord),null,a.id,v,w,o.aW.simpleSegment(0,2*O.circleOffset,O.circleArray.length,O.circleArray.length/2),null,m.transform.zoom,null,null,null)}v.destroy(),w.destroy()}let i0=o.ar(new Float32Array(16));function wc(m,e,a,c,r,W){let{horizontalAlign:h,verticalAlign:g}=o.aR(m);return new o.P((-(h-.5)*e/r+c[0])*W,(-(g-.5)*a/r+c[1])*W)}function vc(m,e,a,c,r,W){let h=e.tileAnchorPoint.add(new o.P(e.translation[0],e.translation[1]));if(e.pitchWithMap){let g=c.mult(W);a||(g=g.rotate(-r));let u=h.add(g);return jt(u.x,u.y,e.pitchedLabelPlaneMatrix,e.getElevation).point}if(a){let g=vi(e.tileAnchorPoint.x+1,e.tileAnchorPoint.y,e).point.sub(m),u=Math.atan(g.y/g.x)+(g.x<0?Math.PI:0);return m.add(c.rotate(u))}return m.add(c)}function Hc(m,e,a,c,r,W,h,g,u,G,Y,y){let J=m.text.placedSymbolArray,S=m.text.dynamicLayoutVertexArray,L=m.icon.dynamicLayoutVertexArray,w={};S.clear();for(let v=0;v<J.length;v++){let O=J.get(v),K=O.hidden||!O.crossTileID||m.allowVerticalPlacement&&!O.placedOrientation?null:c[O.crossTileID];if(K){let tt=new o.P(O.anchorX,O.anchorY),_={getElevation:y,width:r.width,height:r.height,pitchedLabelPlaneMatrix:W,pitchWithMap:a,transform:r,tileAnchorPoint:tt,translation:G,unwrappedTileID:Y},et=a?kn(tt.x,tt.y,_):vi(tt.x,tt.y,_),it=_t(r.cameraToCenterDistance,et.signedDistanceFromCamera),q=o.az(m.textSizeData,g,O)*it/o.aL;a&&(q*=m.tilePixelRatio/h);let{width:ct,height:ht,anchor:bt,textOffset:mt,textBoxScale:Zt}=K,Jt=wc(bt,ct,ht,mt,Zt,q),Yt=r.getPitchedTextCorrection(tt.x+G[0],tt.y+G[1],Y),Gt=vc(et.point,_,e,Jt,-r.bearingInRadians,Yt),zt=m.allowVerticalPlacement&&O.placedOrientation===o.ay.vertical?Math.PI/2:0;for(let ee=0;ee<O.numGlyphs;ee++)o.aF(S,Gt,zt);u&&O.associatedIconIndex>=0&&(w[O.associatedIconIndex]={shiftedAnchor:Gt,angle:zt})}else aa(O.numGlyphs,S)}if(u){L.clear();let v=m.icon.placedSymbolArray;for(let O=0;O<v.length;O++){let K=v.get(O);if(K.hidden)aa(K.numGlyphs,L);else{let tt=w[O];if(tt)for(let _=0;_<K.numGlyphs;_++)o.aF(L,tt.shiftedAnchor,tt.angle);else aa(K.numGlyphs,L)}}m.icon.dynamicLayoutVertexBuffer.updateData(L)}m.text.dynamicLayoutVertexBuffer.updateData(S)}function Kn(m,e,a){return a.iconsInText&&e?"symbolTextAndIcon":m?"symbolSDF":"symbolIcon"}function Dc(m,e,a,c,r,W,h,g,u,G,Y,y,J){let S=m.context,L=S.gl,w=m.transform,v=g==="map",O=u==="map",K=g!=="viewport"&&a.layout.get("symbol-placement")!=="point",tt=v&&!O&&!K,_=!a.layout.get("symbol-sort-key").isConstant(),et=!1,it=m.getDepthModeForSublayer(0,de.ReadOnly),q=a._unevaluatedLayout.hasValue("text-variable-anchor")||a._unevaluatedLayout.hasValue("text-variable-anchor-offset"),ct=[],ht=w.getCircleRadiusCorrection();for(let bt of c){let mt=e.getTile(bt),Zt=mt.getBucket(a);if(!Zt)continue;let Jt=r?Zt.text:Zt.icon;if(!Jt||!Jt.segments.get().length||!Jt.hasVisibleVertices)continue;let Yt=Jt.programConfigurations.get(a.id),Gt=r||Zt.sdfIcons,zt=r?Zt.textSizeData:Zt.iconSizeData,ee=O||w.pitch!==0,te=m.useProgram(Kn(Gt,r,Zt),Yt),Se=o.ax(zt,w.zoom),Ce=m.style.map.terrain&&m.style.map.terrain.getTerrainData(bt),fe,Ye,Vl,we,ol=[0,0],al=null;if(r)Ye=mt.glyphAtlasTexture,Vl=L.LINEAR,fe=mt.glyphAtlasTexture.size,Zt.iconsInText&&(ol=mt.imageAtlasTexture.size,al=mt.imageAtlasTexture,we=ee||m.options.rotating||m.options.zooming||zt.kind==="composite"||zt.kind==="camera"?L.LINEAR:L.NEAREST);else{let $e=a.layout.get("icon-size").constantOr(0)!==1||Zt.iconsNeedLinear;Ye=mt.imageAtlasTexture,Vl=Gt||m.options.rotating||m.options.zooming||$e||ee?L.LINEAR:L.NEAREST,fe=mt.imageAtlasTexture.size}let sl=o.aM(mt,1,m.transform.zoom),hi=Wl(v,m.transform,sl),Ya=o.N();o.aA(Ya,hi);let ra=Je(O,v,m.transform,sl),Ka=o.aN(w,mt,W,h),Pa=w.getProjectionData({overscaledTileID:bt,applyGlobeMatrix:!J,applyTerrainMatrix:!0}),un=q&&Zt.hasTextData(),Qi=a.layout.get("icon-text-fit")!=="none"&&un&&Zt.hasIconData();if(K){let $e=m.style.map.terrain?(pl,xe)=>m.style.map.terrain.getElevation(bt,pl,xe):null,_e=a.layout.get("text-rotation-alignment")==="map";nn(Zt,m,r,hi,Ya,O,G,_e,bt.toUnwrapped(),w.width,w.height,Ka,$e)}let xa=r&&q||Qi,Ii=K||xa?i0:O?hi:m.transform.clipSpaceToPixelsMatrix,Ta=Gt&&a.paint.get(r?"text-halo-width":"icon-halo-width").constantOr(1)!==0,Fn;Fn=Gt?Zt.iconsInText?is(zt.kind,Se,tt,O,K,xa,m,Ii,ra,Ka,fe,ol,ht):sa(zt.kind,Se,tt,O,K,xa,m,Ii,ra,Ka,r,fe,0,ht):Td(zt.kind,Se,tt,O,K,xa,m,Ii,ra,Ka,r,fe,ht);let Gn={program:te,buffers:Jt,uniformValues:Fn,projectionData:Pa,atlasTexture:Ye,atlasTextureIcon:al,atlasInterpolation:Vl,atlasInterpolationIcon:we,isSDF:Gt,hasHalo:Ta};if(_&&Zt.canOverlap){et=!0;let $e=Jt.segments.get();for(let _e of $e)ct.push({segments:new o.aW([_e]),sortKey:_e.sortKey,state:Gn,terrainData:Ce})}else ct.push({segments:Jt.segments,sortKey:0,state:Gn,terrainData:Ce})}et&&ct.sort(((bt,mt)=>bt.sortKey-mt.sortKey));for(let bt of ct){let mt=bt.state;if(S.activeTexture.set(L.TEXTURE0),mt.atlasTexture.bind(mt.atlasInterpolation,L.CLAMP_TO_EDGE),mt.atlasTextureIcon&&(S.activeTexture.set(L.TEXTURE1),mt.atlasTextureIcon&&mt.atlasTextureIcon.bind(mt.atlasInterpolationIcon,L.CLAMP_TO_EDGE)),mt.isSDF){let Zt=mt.uniformValues;mt.hasHalo&&(Zt.u_is_halo=1,a0(mt.buffers,bt.segments,a,m,mt.program,it,Y,y,Zt,mt.projectionData,bt.terrainData)),Zt.u_is_halo=0}a0(mt.buffers,bt.segments,a,m,mt.program,it,Y,y,mt.uniformValues,mt.projectionData,bt.terrainData)}}function a0(m,e,a,c,r,W,h,g,u,G,Y){let y=c.context;r.draw(y,y.gl.TRIANGLES,W,h,g,pe.backCCW,u,Y,G,a.id,m.layoutVertexBuffer,m.indexBuffer,e,a.paint,c.transform.zoom,m.programConfigurations.get(a.id),m.dynamicLayoutVertexBuffer,m.opacityVertexBuffer)}function Bd(m,e,a,c,r){let W=m.context,h=W.gl,g=Ve.disabled,u=new Ae([h.ONE,h.ONE],o.bo.transparent,[!0,!0,!0,!0]),G=e.getBucket(a);if(!G)return;let Y=c.key,y=a.heatmapFbos.get(Y);y||(y=Ws(W,e.tileSize,e.tileSize),a.heatmapFbos.set(Y,y)),W.bindFramebuffer.set(y.framebuffer),W.viewport.set([0,0,e.tileSize,e.tileSize]),W.clear({color:o.bo.transparent});let J=G.programConfigurations.get(a.id),S=m.useProgram("heatmap",J,!r),L=m.transform.getProjectionData({overscaledTileID:e.tileID,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),w=m.style.map.terrain.getTerrainData(c);S.draw(W,h.TRIANGLES,de.disabled,g,u,pe.disabled,$o(e,m.transform.zoom,a.paint.get("heatmap-intensity"),1),w,L,a.id,G.layoutVertexBuffer,G.indexBuffer,G.segments,a.paint,m.transform.zoom,J)}function _b(m,e,a,c,r){let W=m.context,h=W.gl,g=m.transform;W.setColorMode(m.colorModeForRenderPass());let u=Sd(W,e),G=a.key,Y=e.heatmapFbos.get(G);if(!Y)return;W.activeTexture.set(h.TEXTURE0),h.bindTexture(h.TEXTURE_2D,Y.colorAttachment.get()),W.activeTexture.set(h.TEXTURE1),u.bind(h.LINEAR,h.CLAMP_TO_EDGE);let y=g.getProjectionData({overscaledTileID:a,applyTerrainMatrix:r,applyGlobeMatrix:!c});m.useProgram("heatmapTexture").draw(W,h.TRIANGLES,de.disabled,Ve.disabled,m.colorModeForRenderPass(),pe.disabled,ts(m,e,0,1),null,y,e.id,m.rasterBoundsBuffer,m.quadTriangleIndexBuffer,m.rasterBoundsSegments,e.paint,g.zoom),Y.destroy(),e.heatmapFbos.delete(G)}function Ws(m,e,a){var c,r;let W=m.gl,h=W.createTexture();W.bindTexture(W.TEXTURE_2D,h),W.texParameteri(W.TEXTURE_2D,W.TEXTURE_WRAP_S,W.CLAMP_TO_EDGE),W.texParameteri(W.TEXTURE_2D,W.TEXTURE_WRAP_T,W.CLAMP_TO_EDGE),W.texParameteri(W.TEXTURE_2D,W.TEXTURE_MIN_FILTER,W.LINEAR),W.texParameteri(W.TEXTURE_2D,W.TEXTURE_MAG_FILTER,W.LINEAR);let g=(c=m.HALF_FLOAT)!==null&&c!==void 0?c:W.UNSIGNED_BYTE,u=(r=m.RGBA16F)!==null&&r!==void 0?r:W.RGBA;W.texImage2D(W.TEXTURE_2D,0,u,e,a,0,W.RGBA,g,null);let G=m.createFramebuffer(e,a,!1,!1);return G.colorAttachment.set(h),G}function Sd(m,e){return e.colorRampTexture||(e.colorRampTexture=new o.T(m,e.colorRamp,m.gl.RGBA)),e.colorRampTexture}function Oc(m,e,a,c,r,W,h,g){let u=256;if(r.stepInterpolant){let G=e.getSource().maxzoom,Y=h.canonical.z===G?Math.ceil(1<<m.transform.maxZoom-h.canonical.z):1;u=o.an(o.cd(W.maxLineLength/o.a4*1024*Y),256,a.maxTextureSize)}return g.gradient=o.ce({expression:r.gradientExpression(),evaluationKey:"lineProgress",resolution:u,image:g.gradient||void 0,clips:W.lineClipsArray}),g.texture?g.texture.update(g.gradient):g.texture=new o.T(a,g.gradient,c.RGBA),g.version=r.gradientVersion,g.texture}function n0(m,e,a,c,r){m.activeTexture.set(e.TEXTURE0),a.imageAtlasTexture.bind(e.LINEAR,e.CLAMP_TO_EDGE),c.updatePaintBuffers(r)}function d0(m,e,a,c,r,W){(r||m.lineAtlas.dirty)&&(e.activeTexture.set(a.TEXTURE0),m.lineAtlas.bind(e)),c.updatePaintBuffers(W)}function fc(m,e,a,c,r,W,h){let g=W.gradients[r.id],u=g.texture;r.gradientVersion!==g.version&&(u=Oc(m,e,a,c,r,W,h,g)),a.activeTexture.set(c.TEXTURE0),u.bind(r.stepInterpolant?c.NEAREST:c.LINEAR,c.CLAMP_TO_EDGE)}function Zs(m,e,a,c,r,W,h,g,u){let G=W.gradients[r.id],Y=G.texture;r.gradientVersion!==G.version&&(Y=Oc(m,e,a,c,r,W,h,G)),a.activeTexture.set(c.TEXTURE0),Y.bind(r.stepInterpolant?c.NEAREST:c.LINEAR,c.CLAMP_TO_EDGE),a.activeTexture.set(c.TEXTURE1),m.lineAtlas.bind(a),g.updatePaintBuffers(u)}function c0(m,e,a,c,r){if(!a||!c||!c.imageAtlas)return;let W=c.imageAtlas.patternPositions,h=W[a.to.toString()],g=W[a.from.toString()];if(!h&&g&&(h=g),!g&&h&&(g=h),!h||!g){let u=r.getPaintProperty(e);h=W[u],g=W[u]}h&&g&&m.setConstantPatternPositions(h,g)}function hs(m,e,a,c,r,W,h,g){let u=m.context.gl,G="fill-pattern",Y=a.paint.get(G),y=Y&&Y.constantOr(1),J=a.getCrossfadeParameters(),S,L,w,v,O,K=m.transform,tt=a.paint.get("fill-translate"),_=a.paint.get("fill-translate-anchor");h?(L=y&&!a.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",S=u.LINES):(L=y?"fillPattern":"fill",S=u.TRIANGLES);let et=Y.constantOr(null);for(let it of c){let q=e.getTile(it);if(y&&!q.patternsLoaded())continue;let ct=q.getBucket(a);if(!ct)continue;let ht=ct.programConfigurations.get(a.id),bt=m.useProgram(L,ht),mt=m.style.map.terrain&&m.style.map.terrain.getTerrainData(it);y&&(m.context.activeTexture.set(u.TEXTURE0),q.imageAtlasTexture.bind(u.LINEAR,u.CLAMP_TO_EDGE),ht.updatePaintBuffers(J)),c0(ht,G,et,q,a);let Zt=K.getProjectionData({overscaledTileID:it,applyGlobeMatrix:!g,applyTerrainMatrix:!0}),Jt=o.aN(K,q,tt,_);if(h){v=ct.indexBuffer2,O=ct.segments2;let Gt=[u.drawingBufferWidth,u.drawingBufferHeight];w=L==="fillOutlinePattern"&&y?Eb(m,J,q,Gt,Jt):Ar(Gt,Jt)}else v=ct.indexBuffer,O=ct.segments,w=y?jr(m,J,q,Jt):{u_fill_translate:Jt};let Yt=m.stencilModeForClipping(it);bt.draw(m.context,S,r,Yt,W,pe.backCCW,w,mt,Zt,a.id,ct.layoutVertexBuffer,v,O,a.paint,m.transform.zoom,ht)}}function Oe(m,e,a,c,r,W,h,g){let u=m.context,G=u.gl,Y="fill-extrusion-pattern",y=a.paint.get(Y),J=y.constantOr(1),S=a.getCrossfadeParameters(),L=a.paint.get("fill-extrusion-opacity"),w=y.constantOr(null),v=m.transform;for(let O of c){let K=e.getTile(O),tt=K.getBucket(a);if(!tt)continue;let _=m.style.map.terrain&&m.style.map.terrain.getTerrainData(O),et=tt.programConfigurations.get(a.id),it=m.useProgram(J?"fillExtrusionPattern":"fillExtrusion",et);J&&(m.context.activeTexture.set(G.TEXTURE0),K.imageAtlasTexture.bind(G.LINEAR,G.CLAMP_TO_EDGE),et.updatePaintBuffers(S));let q=v.getProjectionData({overscaledTileID:O,applyGlobeMatrix:!g,applyTerrainMatrix:!0});c0(et,Y,w,K,a);let ct=o.aN(v,K,a.paint.get("fill-extrusion-translate"),a.paint.get("fill-extrusion-translate-anchor")),ht=a.paint.get("fill-extrusion-vertical-gradient"),bt=J?Dn(m,ht,L,ct,O,S,K):zr(m,ht,L,ct);it.draw(u,u.gl.TRIANGLES,r,W,h,pe.backCCW,bt,_,q,a.id,tt.layoutVertexBuffer,tt.indexBuffer,tt.segments,a.paint,m.transform.zoom,et,m.style.map.terrain&&tt.centroidVertexBuffer)}}function Ia(m,e,a,c,r,W,h,g,u){var G;let Y=m.style.projection,y=m.context,J=m.transform,S=y.gl,L=[`#define NUM_ILLUMINATION_SOURCES ${a.paint.get("hillshade-highlight-color").values.length}`],w=m.useProgram("hillshade",null,!1,L),v=!m.options.moving;for(let O of c){let K=e.getTile(O),tt=K.fbo;if(!tt)continue;let _=Y.getMeshFromTileID(y,O.canonical,g,!0,"raster"),et=(G=m.style.map.terrain)===null||G===void 0?void 0:G.getTerrainData(O);y.activeTexture.set(S.TEXTURE0),S.bindTexture(S.TEXTURE_2D,tt.colorAttachment.get());let it=J.getProjectionData({overscaledTileID:O,aligned:v,applyGlobeMatrix:!u,applyTerrainMatrix:!0});w.draw(y,S.TRIANGLES,W,r[O.overscaledZ],h,pe.backCCW,rn(m,K,a),et,it,a.id,_.vertexBuffer,_.indexBuffer,_.segments)}}function Zi(m,e,a,c,r,W,h,g,u){var G;let Y=m.style.projection,y=m.context,J=m.transform,S=y.gl,L=m.useProgram("colorRelief"),w=!m.options.moving,v=!0,O=0;for(let K of c){let tt=e.getTile(K),_=tt.dem;if(v){let bt=S.getParameter(S.MAX_TEXTURE_SIZE),{elevationTexture:mt,colorTexture:Zt}=a.getColorRampTextures(y,bt,_.getUnpackVector());y.activeTexture.set(S.TEXTURE1),mt.bind(S.NEAREST,S.CLAMP_TO_EDGE),y.activeTexture.set(S.TEXTURE4),Zt.bind(S.LINEAR,S.CLAMP_TO_EDGE),v=!1,O=mt.size[0]}if(!_||!_.data)continue;let et=_.stride,it=_.getPixels();if(y.activeTexture.set(S.TEXTURE0),y.pixelStoreUnpackPremultiplyAlpha.set(!1),tt.demTexture=tt.demTexture||m.getTileTexture(et),tt.demTexture){let bt=tt.demTexture;bt.update(it,{premultiply:!1}),bt.bind(S.LINEAR,S.CLAMP_TO_EDGE)}else tt.demTexture=new o.T(y,it,S.RGBA,{premultiply:!1}),tt.demTexture.bind(S.LINEAR,S.CLAMP_TO_EDGE);let q=Y.getMeshFromTileID(y,K.canonical,g,!0,"raster"),ct=(G=m.style.map.terrain)===null||G===void 0?void 0:G.getTerrainData(K),ht=J.getProjectionData({overscaledTileID:K,aligned:w,applyGlobeMatrix:!u,applyTerrainMatrix:!0});L.draw(y,S.TRIANGLES,W,r[K.overscaledZ],h,pe.backCCW,Yd(a,tt.dem,O),ct,ht,a.id,q.vertexBuffer,q.indexBuffer,q.segments)}}let Cd=[new o.P(0,0),new o.P(o.a4,0),new o.P(o.a4,o.a4),new o.P(0,o.a4)];function hn(m,e,a,c,r,W,h,g,u=!1,G=!1){let Y=c[c.length-1].overscaledZ,y=m.context,J=y.gl,S=m.useProgram("raster"),L=m.transform,w=m.style.projection,v=m.colorModeForRenderPass(),O=!m.options.moving,K=a.paint.get("raster-opacity"),tt=a.paint.get("raster-resampling"),_=a.paint.get("raster-fade-duration"),et=!!m.style.map.terrain;for(let it of c){let q=m.getDepthModeForSublayer(it.overscaledZ-Y,K===1?de.ReadWrite:de.ReadOnly,J.LESS),ct=e.getTile(it),ht=tt==="nearest"?J.NEAREST:J.LINEAR;y.activeTexture.set(J.TEXTURE0),ct.texture.bind(ht,J.CLAMP_TO_EDGE,J.LINEAR_MIPMAP_NEAREST),y.activeTexture.set(J.TEXTURE1);let{parentTile:bt,parentScaleBy:mt,parentTopLeft:Zt,fadeValues:Jt}=o0(ct,e,_,et);ct.fadeOpacity=Jt.tileOpacity,bt?(bt.fadeOpacity=Jt.parentTileOpacity,bt.texture.bind(ht,J.CLAMP_TO_EDGE,J.LINEAR_MIPMAP_NEAREST)):ct.texture.bind(ht,J.CLAMP_TO_EDGE,J.LINEAR_MIPMAP_NEAREST),ct.texture.useMipmap&&y.extTextureFilterAnisotropic&&m.transform.pitch>20&&J.texParameterf(J.TEXTURE_2D,y.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,y.extTextureFilterAnisotropicMax);let Yt=m.style.map.terrain&&m.style.map.terrain.getTerrainData(it),Gt=L.getProjectionData({overscaledTileID:it,aligned:O,applyGlobeMatrix:!G,applyTerrainMatrix:!0}),zt=ls(Zt,mt,Jt.fadeMix,a,g),ee=w.getMeshFromTileID(y,it.canonical,W,h,"raster");S.draw(y,J.TRIANGLES,q,r?r[it.overscaledZ]:Ve.disabled,v,u?pe.frontCCW:pe.backCCW,zt,Yt,Gt,a.id,ee.vertexBuffer,ee.indexBuffer,ee.segments)}}function o0(m,e,a,c){let r={parentTile:null,parentScaleBy:1,parentTopLeft:[0,0],fadeValues:{tileOpacity:1,parentTileOpacity:1,fadeMix:{opacity:1,mix:0}}};if(a===0||c)return r;if(m.fadingParentID){let W=e.getLoadedTile(m.fadingParentID);if(!W)return r;let h=Math.pow(2,W.tileID.overscaledZ-m.tileID.overscaledZ),g=[m.tileID.canonical.x*h%1,m.tileID.canonical.y*h%1],u=(function(G,Y,y){let J=Ct(),S=(J-Y.timeAdded)/y,L=G.fadingDirection===nt.Incoming,w=o.an((J-G.timeAdded)/y,0,1),v=o.an(1-S,0,1),O=L?w:v;return{tileOpacity:O,parentTileOpacity:L?v:w,fadeMix:{opacity:1,mix:1-O}}})(m,W,a);return{parentTile:W,parentScaleBy:h,parentTopLeft:g,fadeValues:u}}if(m.selfFading){let W=(function(h,g){let u=(Ct()-h.timeAdded)/g,G=o.an(u,0,1);return{tileOpacity:G,fadeMix:{opacity:G,mix:0}}})(m,a);return{parentTile:null,parentScaleBy:1,parentTopLeft:[0,0],fadeValues:W}}return r}let Pn=new o.bo(1,0,0,1),Vs=new o.bo(0,1,0,1),Qd=new o.bo(0,0,1,1),ps=new o.bo(1,0,1,1),s0=new o.bo(0,1,1,1);function gs(m,e,a,c){kd(m,0,e+a/2,m.transform.width,a,c)}function Rs(m,e,a,c){kd(m,e-a/2,0,a,m.transform.height,c)}function kd(m,e,a,c,r,W){let h=m.context,g=h.gl;g.enable(g.SCISSOR_TEST),g.scissor(e*m.pixelRatio,a*m.pixelRatio,c*m.pixelRatio,r*m.pixelRatio),h.clear({color:W}),g.disable(g.SCISSOR_TEST)}function r0(m,e,a){let c=m.context,r=c.gl,W=m.useProgram("debug"),h=de.disabled,g=Ve.disabled,u=m.colorModeForRenderPass(),G="$debug",Y=m.style.map.terrain&&m.style.map.terrain.getTerrainData(a);c.activeTexture.set(r.TEXTURE0);let y=e.getTileByID(a.key).latestRawTileData,J=Math.floor((y&&y.byteLength||0)/1024),S=e.getTile(a).tileSize,L=512/Math.min(S,512)*(a.overscaledZ/m.transform.zoom)*.5,w=a.canonical.toString();a.overscaledZ!==a.canonical.z&&(w+=` => ${a.overscaledZ}`),(function(O,K){O.initDebugOverlayCanvas();let tt=O.debugOverlayCanvas,_=O.context.gl,et=O.debugOverlayCanvas.getContext("2d");et.clearRect(0,0,tt.width,tt.height),et.shadowColor="white",et.shadowBlur=2,et.lineWidth=1.5,et.strokeStyle="white",et.textBaseline="top",et.font="bold 36px Open Sans, sans-serif",et.fillText(K,5,5),et.strokeText(K,5,5),O.debugOverlayTexture.update(tt),O.debugOverlayTexture.bind(_.LINEAR,_.CLAMP_TO_EDGE)})(m,`${w} ${J}kB`);let v=m.transform.getProjectionData({overscaledTileID:a,applyGlobeMatrix:!0,applyTerrainMatrix:!0});W.draw(c,r.TRIANGLES,h,g,Ae.alphaBlended,pe.disabled,qo(o.bo.transparent,L),null,v,G,m.debugBuffer,m.quadTriangleIndexBuffer,m.debugSegments),W.draw(c,r.LINE_STRIP,h,g,u,pe.disabled,qo(o.bo.red),Y,v,G,m.debugBuffer,m.tileBorderIndexBuffer,m.debugSegments)}function fa(m,e,a,c){let{isRenderingGlobe:r}=c,W=m.context,h=W.gl,g=m.transform,u=m.colorModeForRenderPass(),G=m.getDepthModeFor3D(),Y=m.useProgram("terrain");W.bindFramebuffer.set(null),W.viewport.set([0,0,m.width,m.height]);for(let y of a){let J=e.getTerrainMesh(y.tileID),S=m.renderToTexture.getTexture(y),L=e.getTerrainData(y.tileID);W.activeTexture.set(h.TEXTURE0),h.bindTexture(h.TEXTURE_2D,S.texture);let w=e.getMeshFrameDelta(g.zoom),v=g.calculateFogMatrix(y.tileID.toUnwrapped()),O=Ko(w,v,m.style.sky,g.pitch,r),K=g.getProjectionData({overscaledTileID:y.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});Y.draw(W,h.TRIANGLES,G,Ve.disabled,u,pe.backCCW,O,L,K,"terrain",J.vertexBuffer,J.indexBuffer,J.segments)}}function us(m,e){if(!e.mesh){let a=new o.aV;a.emplaceBack(-1,-1),a.emplaceBack(1,-1),a.emplaceBack(1,1),a.emplaceBack(-1,1);let c=new o.aX;c.emplaceBack(0,1,2),c.emplaceBack(0,2,3),e.mesh=new va(m.createVertexBuffer(a,Zl.members),m.createIndexBuffer(c),o.aW.simpleSegment(0,0,a.length,c.length))}return e.mesh}class b0{constructor(e,a){this.context=new jc(e),this.transform=a,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:o.ar(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=be.maxOverzooming+be.maxUnderzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new cn}resize(e,a,c){if(this.width=Math.floor(e*c),this.height=Math.floor(a*c),this.pixelRatio=c,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(let r of this.style._order)this.style._layers[r].resize()}setup(){let e=this.context,a=new o.aV;a.emplaceBack(0,0),a.emplaceBack(o.a4,0),a.emplaceBack(0,o.a4),a.emplaceBack(o.a4,o.a4),this.tileExtentBuffer=e.createVertexBuffer(a,Zl.members),this.tileExtentSegments=o.aW.simpleSegment(0,0,4,2);let c=new o.aV;c.emplaceBack(0,0),c.emplaceBack(o.a4,0),c.emplaceBack(0,o.a4),c.emplaceBack(o.a4,o.a4),this.debugBuffer=e.createVertexBuffer(c,Zl.members),this.debugSegments=o.aW.simpleSegment(0,0,4,5);let r=new o.cg;r.emplaceBack(0,0,0,0),r.emplaceBack(o.a4,0,o.a4,0),r.emplaceBack(0,o.a4,0,o.a4),r.emplaceBack(o.a4,o.a4,o.a4,o.a4),this.rasterBoundsBuffer=e.createVertexBuffer(r,oa.members),this.rasterBoundsSegments=o.aW.simpleSegment(0,0,4,2);let W=new o.aV;W.emplaceBack(0,0),W.emplaceBack(o.a4,0),W.emplaceBack(0,o.a4),W.emplaceBack(o.a4,o.a4),this.rasterBoundsBufferPosOnly=e.createVertexBuffer(W,Zl.members),this.rasterBoundsSegmentsPosOnly=o.aW.simpleSegment(0,0,4,5);let h=new o.aV;h.emplaceBack(0,0),h.emplaceBack(1,0),h.emplaceBack(0,1),h.emplaceBack(1,1),this.viewportBuffer=e.createVertexBuffer(h,Zl.members),this.viewportSegments=o.aW.simpleSegment(0,0,4,2);let g=new o.ch;g.emplaceBack(0),g.emplaceBack(1),g.emplaceBack(3),g.emplaceBack(2),g.emplaceBack(0),this.tileBorderIndexBuffer=e.createIndexBuffer(g);let u=new o.aX;u.emplaceBack(1,0,2),u.emplaceBack(1,2,3),this.quadTriangleIndexBuffer=e.createIndexBuffer(u);let G=this.context.gl;this.stencilClearMode=new Ve({func:G.ALWAYS,mask:0},0,255,G.ZERO,G.ZERO,G.ZERO),this.tileExtentMesh=new va(this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}clearStencil(){let e=this.context,a=e.gl;this.nextStencilID=1,this.currentStencilSource=void 0;let c=o.N();o.c6(c,0,this.width,this.height,0,0,1),o.Q(c,c,[a.drawingBufferWidth,a.drawingBufferHeight,0]);let r={mainMatrix:c,tileMercatorCoords:[0,0,1,1],clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:c};this.useProgram("clippingMask",null,!0).draw(e,a.TRIANGLES,de.disabled,this.stencilClearMode,Ae.disabled,pe.disabled,null,null,r,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(e,a,c){if(this.currentStencilSource===e.source||!e.isTileClipped()||!a||!a.length)return;this.currentStencilSource=e.source,this.nextStencilID+a.length>256&&this.clearStencil();let r=this.context;r.setColorMode(Ae.disabled),r.setDepthMode(de.disabled);let W={};for(let h of a)W[h.key]=this.nextStencilID++;this._renderTileMasks(W,a,c,!0),this._renderTileMasks(W,a,c,!1),this._tileClippingMaskIDs=W}_renderTileMasks(e,a,c,r){let W=this.context,h=W.gl,g=this.style.projection,u=this.transform,G=this.useProgram("clippingMask");for(let Y of a){let y=e[Y.key],J=this.style.map.terrain&&this.style.map.terrain.getTerrainData(Y),S=g.getMeshFromTileID(this.context,Y.canonical,r,!0,"stencil"),L=u.getProjectionData({overscaledTileID:Y,applyGlobeMatrix:!c,applyTerrainMatrix:!0});G.draw(W,h.TRIANGLES,de.disabled,new Ve({func:h.ALWAYS,mask:0},y,255,h.KEEP,h.KEEP,h.REPLACE),Ae.disabled,c?pe.disabled:pe.backCCW,null,J,L,"$clipping",S.vertexBuffer,S.indexBuffer,S.segments)}}_renderTilesDepthBuffer(){let e=this.context,a=e.gl,c=this.style.projection,r=this.transform,W=this.useProgram("depth"),h=this.getDepthModeFor3D(),g=ie(r,{tileSize:r.tileSize});for(let u of g){let G=this.style.map.terrain&&this.style.map.terrain.getTerrainData(u),Y=c.getMeshFromTileID(this.context,u.canonical,!0,!0,"raster"),y=r.getProjectionData({overscaledTileID:u,applyGlobeMatrix:!0,applyTerrainMatrix:!0});W.draw(e,a.TRIANGLES,h,Ve.disabled,Ae.disabled,pe.backCCW,null,G,y,"$clipping",Y.vertexBuffer,Y.indexBuffer,Y.segments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();let e=this.nextStencilID++,a=this.context.gl;return new Ve({func:a.NOTEQUAL,mask:255},e,255,a.KEEP,a.KEEP,a.REPLACE)}stencilModeForClipping(e){let a=this.context.gl;return new Ve({func:a.EQUAL,mask:255},this._tileClippingMaskIDs[e.key],0,a.KEEP,a.KEEP,a.REPLACE)}getStencilConfigForOverlapAndUpdateStencilID(e){let a=this.context.gl,c=e.sort(((h,g)=>g.overscaledZ-h.overscaledZ)),r=c[c.length-1].overscaledZ,W=c[0].overscaledZ-r+1;if(W>1){this.currentStencilSource=void 0,this.nextStencilID+W>256&&this.clearStencil();let h={};for(let g=0;g<W;g++)h[g+r]=new Ve({func:a.GEQUAL,mask:255},g+this.nextStencilID,255,a.KEEP,a.KEEP,a.REPLACE);return this.nextStencilID+=W,[h,c]}return[{[r]:Ve.disabled},c]}stencilConfigForOverlapTwoPass(e){let a=this.context.gl,c=e.sort(((h,g)=>g.overscaledZ-h.overscaledZ)),r=c[c.length-1].overscaledZ,W=c[0].overscaledZ-r+1;if(this.clearStencil(),W>1){let h={},g={};for(let u=0;u<W;u++)h[u+r]=new Ve({func:a.GREATER,mask:255},W+1+u,255,a.KEEP,a.KEEP,a.REPLACE),g[u+r]=new Ve({func:a.GREATER,mask:255},1+u,255,a.KEEP,a.KEEP,a.REPLACE);return this.nextStencilID=2*W+1,[h,g,c]}return this.nextStencilID=3,[{[r]:new Ve({func:a.GREATER,mask:255},2,255,a.KEEP,a.KEEP,a.REPLACE)},{[r]:new Ve({func:a.GREATER,mask:255},1,255,a.KEEP,a.KEEP,a.REPLACE)},c]}colorModeForRenderPass(){let e=this.context.gl;return this._showOverdrawInspector?new Ae([e.CONSTANT_COLOR,e.ONE],new o.bo(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Ae.unblended:Ae.alphaBlended}getDepthModeForSublayer(e,a,c){if(!this.opaquePassEnabledForLayer())return de.disabled;let r=1-((1+this.currentLayer)*this.numSublayers+e)*this.depthEpsilon;return new de(c||this.context.gl.LEQUAL,a,[r,r])}getDepthModeFor3D(){return new de(this.context.gl.LEQUAL,de.ReadWrite,this.depthRangeFor3D)}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(e,a){var c,r;this.style=e,this.options=a,this.lineAtlas=e.lineAtlas,this.imageManager=e.imageManager,this.glyphManager=e.glyphManager,this.symbolFadeChange=e.placement.symbolFadeChange(Ct()),this.imageManager.beginFrame();let W=this.style._order,h=this.style.tileManagers,g={},u={},G={},Y={isRenderingToTexture:!1,isRenderingGlobe:((c=e.projection)===null||c===void 0?void 0:c.transitionState)>0};for(let J in h){let S=h[J];S.used&&S.prepare(this.context),g[J]=S.getVisibleCoordinates(!1),u[J]=g[J].slice().reverse(),G[J]=S.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let J=0;J<W.length;J++)if(this.style._layers[W[J]].is3D()){this.opaquePassCutoff=J;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(let J of W){let S=this.style._layers[J];if(!S.hasOffscreenPass()||S.isHidden(this.transform.zoom))continue;let L=u[S.source];(S.type==="custom"||L.length)&&this.renderLayer(this,h[S.source],S,L,Y)}if((r=this.style.projection)===null||r===void 0||r.updateGPUdependent({context:this.context,useProgram:J=>this.useProgram(J)}),this.context.viewport.set([0,0,this.width,this.height]),this.context.bindFramebuffer.set(null),this.context.clear({color:a.showOverdrawInspector?o.bo.black:o.bo.transparent,depth:1}),this.clearStencil(),this.style.sky&&(function(J,S){let L=J.context,w=L.gl,v=((it,q,ct)=>{let ht=Math.cos(q.rollInRadians),bt=Math.sin(q.rollInRadians),mt=st(q),Zt=q.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}).projectionTransition;return{u_sky_color:it.properties.get("sky-color"),u_horizon_color:it.properties.get("horizon-color"),u_horizon:[(q.width/2-mt*bt)*ct,(q.height/2+mt*ht)*ct],u_horizon_normal:[-bt,ht],u_sky_horizon_blend:it.properties.get("sky-horizon-blend")*q.height/2*ct,u_sky_blend:Zt}})(S,J.style.map.transform,J.pixelRatio),O=new de(w.LEQUAL,de.ReadWrite,[0,1]),K=Ve.disabled,tt=J.colorModeForRenderPass(),_=J.useProgram("sky"),et=us(L,S);_.draw(L,w.TRIANGLES,O,K,tt,pe.disabled,v,null,void 0,"sky",et.vertexBuffer,et.indexBuffer,et.segments)})(this,this.style.sky),this._showOverdrawInspector=a.showOverdrawInspector,this.depthRangeFor3D=[0,1-(e._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=W.length-1;this.currentLayer>=0;this.currentLayer--){let J=this.style._layers[W[this.currentLayer]],S=h[J.source],L=g[J.source];this._renderTileClippingMasks(J,L,!1),this.renderLayer(this,S,J,L,Y)}this.renderPass="translucent";let y=!1;for(this.currentLayer=0;this.currentLayer<W.length;this.currentLayer++){let J=this.style._layers[W[this.currentLayer]],S=h[J.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(J,Y))continue;this.opaquePassEnabledForLayer()||y||(y=!0,Y.isRenderingGlobe&&!this.style.map.terrain&&this._renderTilesDepthBuffer());let L=(J.type==="symbol"?G:u)[J.source];this._renderTileClippingMasks(J,g[J.source],!!this.renderToTexture),this.renderLayer(this,S,J,L,Y)}if(Y.isRenderingGlobe&&(function(J,S,L){let w=J.context,v=w.gl,O=J.useProgram("atmosphere"),K=new de(v.LEQUAL,de.ReadOnly,[0,1]),tt=J.transform,_=(function(Zt,Jt){let Yt=Zt.properties.get("position"),Gt=[-Yt.x,-Yt.y,-Yt.z],zt=o.ar(new Float64Array(16));return Zt.properties.get("anchor")==="map"&&(o.bf(zt,zt,Jt.rollInRadians),o.bg(zt,zt,-Jt.pitchInRadians),o.bf(zt,zt,Jt.bearingInRadians),o.bg(zt,zt,Jt.center.lat*Math.PI/180),o.bI(zt,zt,-Jt.center.lng*Math.PI/180)),o.cf(Gt,Gt,zt),Gt})(L,J.transform),et=tt.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),it=S.properties.get("atmosphere-blend")*et.projectionTransition;if(it===0)return;let q=Uc(tt.worldSize,tt.center.lat),ct=tt.inverseProjectionMatrix,ht=new Float64Array(4);ht[3]=1,o.aG(ht,ht,tt.modelViewProjectionMatrix),ht[0]/=ht[3],ht[1]/=ht[3],ht[2]/=ht[3],ht[3]=1,o.aG(ht,ht,ct),ht[0]/=ht[3],ht[1]/=ht[3],ht[2]/=ht[3],ht[3]=1;let bt=((Zt,Jt,Yt,Gt,zt)=>({u_sun_pos:Zt,u_atmosphere_blend:Jt,u_globe_position:Yt,u_globe_radius:Gt,u_inv_proj_matrix:zt}))(_,it,[ht[0],ht[1],ht[2]],q,ct),mt=us(w,S);O.draw(w,v.TRIANGLES,K,Ve.disabled,Ae.alphaBlended,pe.disabled,bt,null,null,"atmosphere",mt.vertexBuffer,mt.indexBuffer,mt.segments)})(this,this.style.sky,this.style.light),this.options.showTileBoundaries){let J=(function(S,L){let w=null,v=Object.values(S._layers).flatMap((_=>_.source&&!_.isHidden(L)?[S.tileManagers[_.source]]:[])),O=v.filter((_=>_.getSource().type==="vector")),K=v.filter((_=>_.getSource().type!=="vector")),tt=_=>{(!w||w.getSource().maxzoom<_.getSource().maxzoom)&&(w=_)};return O.forEach((_=>tt(_))),w||K.forEach((_=>tt(_))),w})(this.style,this.transform.zoom);J&&(function(S,L,w){for(let v=0;v<w.length;v++)r0(S,L,w[v])})(this,J,J.getVisibleCoordinates())}this.options.showPadding&&(function(J){let S=J.transform.padding;gs(J,J.transform.height-(S.top||0),3,Pn),gs(J,S.bottom||0,3,Vs),Rs(J,S.left||0,3,Qd),Rs(J,J.transform.width-(S.right||0),3,ps);let L=J.transform.centerPoint;(function(w,v,O,K){kd(w,v-1,O-10,2,20,K),kd(w,v-10,O-1,20,2,K)})(J,L.x,J.transform.height-L.y,s0)})(this),this.context.setDefault()}maybeDrawDepthAndCoords(e){if(!this.style||!this.style.map||!this.style.map.terrain)return;let a=this.terrainFacilitator.matrix,c=this.transform.modelViewProjectionMatrix,r=this.terrainFacilitator.dirty;r||(r=e?!o.ci(a,c):!o.cj(a,c)),r||(r=this.style.map.terrain.tileManager.anyTilesAfterTime(this.terrainFacilitator.renderTime)),r&&(o.ck(a,c),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,(function(W,h){let g=W.context,u=g.gl,G=W.transform,Y=Ae.unblended,y=new de(u.LEQUAL,de.ReadWrite,[0,1]),J=h.tileManager.getRenderableTiles(),S=W.useProgram("terrainDepth");g.bindFramebuffer.set(h.getFramebuffer("depth").framebuffer),g.viewport.set([0,0,W.width/devicePixelRatio,W.height/devicePixelRatio]),g.clear({color:o.bo.transparent,depth:1});for(let L of J){let w=h.getTerrainMesh(L.tileID),v=h.getTerrainData(L.tileID),O=G.getProjectionData({overscaledTileID:L.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0}),K={u_ele_delta:h.getMeshFrameDelta(G.zoom)};S.draw(g,u.TRIANGLES,y,Ve.disabled,Y,pe.backCCW,K,v,O,"terrain",w.vertexBuffer,w.indexBuffer,w.segments)}g.bindFramebuffer.set(null),g.viewport.set([0,0,W.width,W.height])})(this,this.style.map.terrain),(function(W,h){let g=W.context,u=g.gl,G=W.transform,Y=Ae.unblended,y=new de(u.LEQUAL,de.ReadWrite,[0,1]),J=h.getCoordsTexture(),S=h.tileManager.getRenderableTiles(),L=W.useProgram("terrainCoords");g.bindFramebuffer.set(h.getFramebuffer("coords").framebuffer),g.viewport.set([0,0,W.width/devicePixelRatio,W.height/devicePixelRatio]),g.clear({color:o.bo.transparent,depth:1}),h.coordsIndex=[];for(let w of S){let v=h.getTerrainMesh(w.tileID),O=h.getTerrainData(w.tileID);g.activeTexture.set(u.TEXTURE0),u.bindTexture(u.TEXTURE_2D,J.texture);let K={u_terrain_coords_id:(255-h.coordsIndex.length)/255,u_texture:0,u_ele_delta:h.getMeshFrameDelta(G.zoom)},tt=G.getProjectionData({overscaledTileID:w.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});L.draw(g,u.TRIANGLES,y,Ve.disabled,Y,pe.backCCW,K,O,tt,"terrain",v.vertexBuffer,v.indexBuffer,v.segments),h.coordsIndex.push(w.tileID.key)}g.bindFramebuffer.set(null),g.viewport.set([0,0,W.width,W.height])})(this,this.style.map.terrain))}renderLayer(e,a,c,r,W){c.isHidden(this.transform.zoom)||(c.type==="background"||c.type==="custom"||(r||[]).length)&&(this.id=c.id,o.cl(c)?(function(h,g,u,G,Y,y){if(h.renderPass!=="translucent")return;let{isRenderingToTexture:J}=y,S=Ve.disabled,L=h.colorModeForRenderPass();(u._unevaluatedLayout.hasValue("text-variable-anchor")||u._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&(function(w,v,O,K,tt,_,et,it,q){let ct=v.transform,ht=v.style.map.terrain,bt=tt==="map",mt=_==="map";for(let Zt of w){let Jt=K.getTile(Zt),Yt=Jt.getBucket(O);if(!Yt||!Yt.text||!Yt.text.segments.get().length)continue;let Gt=o.ax(Yt.textSizeData,ct.zoom),zt=o.aM(Jt,1,v.transform.zoom),ee=Wl(bt,v.transform,zt),te=O.layout.get("icon-text-fit")!=="none"&&Yt.hasIconData();if(Gt){let Se=Math.pow(2,ct.zoom-Jt.tileID.overscaledZ),Ce=ht?(fe,Ye)=>ht.getElevation(Zt,fe,Ye):null;Hc(Yt,bt,mt,q,ct,ee,Se,Gt,te,o.aN(ct,Jt,et,it),Zt.toUnwrapped(),Ce)}}})(G,h,u,g,u.layout.get("text-rotation-alignment"),u.layout.get("text-pitch-alignment"),u.paint.get("text-translate"),u.paint.get("text-translate-anchor"),Y),u.paint.get("icon-opacity").constantOr(1)!==0&&Dc(h,g,u,G,!1,u.paint.get("icon-translate"),u.paint.get("icon-translate-anchor"),u.layout.get("icon-rotation-alignment"),u.layout.get("icon-pitch-alignment"),u.layout.get("icon-keep-upright"),S,L,J),u.paint.get("text-opacity").constantOr(1)!==0&&Dc(h,g,u,G,!0,u.paint.get("text-translate"),u.paint.get("text-translate-anchor"),u.layout.get("text-rotation-alignment"),u.layout.get("text-pitch-alignment"),u.layout.get("text-keep-upright"),S,L,J),g.map.showCollisionBoxes&&(Ac(h,g,u,G,!0),Ac(h,g,u,G,!1))})(e,a,c,r,this.style.placement.variableOffsets,W):o.cm(c)?(function(h,g,u,G,Y){if(h.renderPass!=="translucent")return;let{isRenderingToTexture:y}=Y,J=u.paint.get("circle-opacity"),S=u.paint.get("circle-stroke-width"),L=u.paint.get("circle-stroke-opacity"),w=!u.layout.get("circle-sort-key").isConstant();if(J.constantOr(1)===0&&(S.constantOr(1)===0||L.constantOr(1)===0))return;let v=h.context,O=v.gl,K=h.transform,tt=h.getDepthModeForSublayer(0,de.ReadOnly),_=Ve.disabled,et=h.colorModeForRenderPass(),it=[],q=K.getCircleRadiusCorrection();for(let ct=0;ct<G.length;ct++){let ht=G[ct],bt=g.getTile(ht),mt=bt.getBucket(u);if(!mt)continue;let Zt=u.paint.get("circle-translate"),Jt=u.paint.get("circle-translate-anchor"),Yt=o.aN(K,bt,Zt,Jt),Gt=mt.programConfigurations.get(u.id),zt=h.useProgram("circle",Gt),ee=mt.layoutVertexBuffer,te=mt.indexBuffer,Se=h.style.map.terrain&&h.style.map.terrain.getTerrainData(ht),Ce={programConfiguration:Gt,program:zt,layoutVertexBuffer:ee,indexBuffer:te,uniformValues:wr(h,bt,u,Yt,q),terrainData:Se,projectionData:K.getProjectionData({overscaledTileID:ht,applyGlobeMatrix:!y,applyTerrainMatrix:!0})};if(w){let fe=mt.segments.get();for(let Ye of fe)it.push({segments:new o.aW([Ye]),sortKey:Ye.sortKey,state:Ce})}else it.push({segments:mt.segments,sortKey:0,state:Ce})}w&&it.sort(((ct,ht)=>ct.sortKey-ht.sortKey));for(let ct of it){let{programConfiguration:ht,program:bt,layoutVertexBuffer:mt,indexBuffer:Zt,uniformValues:Jt,terrainData:Yt,projectionData:Gt}=ct.state;bt.draw(v,O.TRIANGLES,tt,_,et,pe.backCCW,Jt,Yt,Gt,u.id,mt,Zt,ct.segments,u.paint,h.transform.zoom,ht)}})(e,a,c,r,W):o.cn(c)?(function(h,g,u,G,Y){if(u.paint.get("heatmap-opacity")===0)return;let y=h.context,{isRenderingToTexture:J,isRenderingGlobe:S}=Y;if(h.style.map.terrain){for(let L of G){let w=g.getTile(L);g.hasRenderableParent(L)||(h.renderPass==="offscreen"?Bd(h,w,u,L,S):h.renderPass==="translucent"&&_b(h,u,L,J,S))}y.viewport.set([0,0,h.width,h.height])}else h.renderPass==="offscreen"?(function(L,w,v,O){let K=L.context,tt=K.gl,_=L.transform,et=Ve.disabled,it=new Ae([tt.ONE,tt.ONE],o.bo.transparent,[!0,!0,!0,!0]);(function(q,ct,ht){let bt=q.gl;q.activeTexture.set(bt.TEXTURE1),q.viewport.set([0,0,ct.width/4,ct.height/4]);let mt=ht.heatmapFbos.get(o.cc);mt?(bt.bindTexture(bt.TEXTURE_2D,mt.colorAttachment.get()),q.bindFramebuffer.set(mt.framebuffer)):(mt=Ws(q,ct.width/4,ct.height/4),ht.heatmapFbos.set(o.cc,mt))})(K,L,v),K.clear({color:o.bo.transparent});for(let q=0;q<O.length;q++){let ct=O[q];if(w.hasRenderableParent(ct))continue;let ht=w.getTile(ct),bt=ht.getBucket(v);if(!bt)continue;let mt=bt.programConfigurations.get(v.id),Zt=L.useProgram("heatmap",mt),Jt=_.getProjectionData({overscaledTileID:ct,applyGlobeMatrix:!0,applyTerrainMatrix:!1}),Yt=_.getCircleRadiusCorrection();Zt.draw(K,tt.TRIANGLES,de.disabled,et,it,pe.backCCW,$o(ht,_.zoom,v.paint.get("heatmap-intensity"),Yt),null,Jt,v.id,bt.layoutVertexBuffer,bt.indexBuffer,bt.segments,v.paint,_.zoom,mt)}K.viewport.set([0,0,L.width,L.height])})(h,g,u,G):h.renderPass==="translucent"&&(function(L,w){let v=L.context,O=v.gl;v.setColorMode(L.colorModeForRenderPass());let K=w.heatmapFbos.get(o.cc);K&&(v.activeTexture.set(O.TEXTURE0),O.bindTexture(O.TEXTURE_2D,K.colorAttachment.get()),v.activeTexture.set(O.TEXTURE1),Sd(v,w).bind(O.LINEAR,O.CLAMP_TO_EDGE),L.useProgram("heatmapTexture").draw(v,O.TRIANGLES,de.disabled,Ve.disabled,L.colorModeForRenderPass(),pe.disabled,ts(L,w,0,1),null,null,w.id,L.viewportBuffer,L.quadTriangleIndexBuffer,L.viewportSegments,w.paint,L.transform.zoom))})(h,u)})(e,a,c,r,W):o.co(c)?(function(h,g,u,G,Y){if(h.renderPass!=="translucent")return;let{isRenderingToTexture:y}=Y,J=u.paint.get("line-opacity"),S=u.paint.get("line-width");if(J.constantOr(1)===0||S.constantOr(1)===0)return;let L=h.getDepthModeForSublayer(0,de.ReadOnly),w=h.colorModeForRenderPass(),v=u.paint.get("line-dasharray"),O=v.constantOr(1),K=u.paint.get("line-pattern"),tt=K.constantOr(1),_=u.paint.get("line-gradient"),et=u.getCrossfadeParameters(),it;it=tt?"linePattern":O&&_?"lineGradientSDF":O?"lineSDF":_?"lineGradient":"line";let q=h.context,ct=q.gl,ht=h.transform,bt=!0;for(let mt of G){let Zt=g.getTile(mt);if(tt&&!Zt.patternsLoaded())continue;let Jt=Zt.getBucket(u);if(!Jt)continue;let Yt=Jt.programConfigurations.get(u.id),Gt=h.context.program.get(),zt=h.useProgram(it,Yt),ee=bt||zt.program!==Gt,te=h.style.map.terrain&&h.style.map.terrain.getTerrainData(mt),Se=K.constantOr(null),Ce=v&&v.constantOr(null);if(Se&&Zt.imageAtlas){let ol=Zt.imageAtlas,al=ol.patternPositions[Se.to.toString()],sl=ol.patternPositions[Se.from.toString()];al&&sl&&Yt.setConstantPatternPositions(al,sl)}else if(Ce){let ol=u.layout.get("line-cap")==="round",al=h.lineAtlas.getDash(Ce.to,ol),sl=h.lineAtlas.getDash(Ce.from,ol);Yt.setConstantDashPositions(al,sl)}let fe=ht.getProjectionData({overscaledTileID:mt,applyGlobeMatrix:!y,applyTerrainMatrix:!0}),Ye=ht.getPixelScale(),Vl;tt?(Vl=zb(h,Zt,u,Ye,et),n0(q,ct,Zt,Yt,et)):O&&_?(Vl=Or(h,Zt,u,Ye,et,Jt.lineClipsArray.length),Zs(h,g,q,ct,u,Jt,mt,Yt,et)):O?(Vl=jb(h,Zt,u,Ye,et),d0(h,q,ct,Yt,ee,et)):_?(Vl=xd(h,Zt,u,Ye,Jt.lineClipsArray.length),fc(h,g,q,ct,u,Jt,mt)):Vl=Xc(h,Zt,u,Ye);let we=h.stencilModeForClipping(mt);zt.draw(q,ct.TRIANGLES,L,we,w,pe.disabled,Vl,te,fe,u.id,Jt.layoutVertexBuffer,Jt.indexBuffer,Jt.segments,u.paint,h.transform.zoom,Yt,Jt.layoutVertexBuffer2),bt=!1}})(e,a,c,r,W):o.cp(c)?(function(h,g,u,G,Y){let y=u.paint.get("fill-color"),J=u.paint.get("fill-opacity");if(J.constantOr(1)===0)return;let{isRenderingToTexture:S}=Y,L=h.colorModeForRenderPass(),w=u.paint.get("fill-pattern"),v=h.opaquePassEnabledForLayer()&&!w.constantOr(1)&&y.constantOr(o.bo.transparent).a===1&&J.constantOr(0)===1?"opaque":"translucent";if(h.renderPass===v){let O=h.getDepthModeForSublayer(1,h.renderPass==="opaque"?de.ReadWrite:de.ReadOnly);hs(h,g,u,G,O,L,!1,S)}if(h.renderPass==="translucent"&&u.paint.get("fill-antialias")){let O=h.getDepthModeForSublayer(u.getPaintProperty("fill-outline-color")?2:0,de.ReadOnly);hs(h,g,u,G,O,L,!0,S)}})(e,a,c,r,W):o.cq(c)?(function(h,g,u,G,Y){let y=u.paint.get("fill-extrusion-opacity");if(y===0)return;let{isRenderingToTexture:J}=Y;if(h.renderPass==="translucent"){let S=new de(h.context.gl.LEQUAL,de.ReadWrite,h.depthRangeFor3D);if(y!==1||u.paint.get("fill-extrusion-pattern").constantOr(1))Oe(h,g,u,G,S,Ve.disabled,Ae.disabled,J),Oe(h,g,u,G,S,h.stencilModeFor3D(),h.colorModeForRenderPass(),J);else{let L=h.colorModeForRenderPass();Oe(h,g,u,G,S,Ve.disabled,L,J)}}})(e,a,c,r,W):o.cr(c)?(function(h,g,u,G,Y){if(h.renderPass!=="offscreen"&&h.renderPass!=="translucent")return;let{isRenderingToTexture:y}=Y,J=h.context,S=h.style.projection.useSubdivision,L=h.getDepthModeForSublayer(0,de.ReadOnly),w=h.colorModeForRenderPass();if(h.renderPass==="offscreen")(function(v,O,K,tt,_,et,it){let q=v.context,ct=q.gl;for(let ht of K){let bt=O.getTile(ht),mt=bt.dem;if(!mt||!mt.data||!bt.needsHillshadePrepare)continue;let Zt=mt.dim,Jt=mt.stride,Yt=mt.getPixels();if(q.activeTexture.set(ct.TEXTURE1),q.pixelStoreUnpackPremultiplyAlpha.set(!1),bt.demTexture=bt.demTexture||v.getTileTexture(Jt),bt.demTexture){let zt=bt.demTexture;zt.update(Yt,{premultiply:!1}),zt.bind(ct.NEAREST,ct.CLAMP_TO_EDGE)}else bt.demTexture=new o.T(q,Yt,ct.RGBA,{premultiply:!1}),bt.demTexture.bind(ct.NEAREST,ct.CLAMP_TO_EDGE);q.activeTexture.set(ct.TEXTURE0);let Gt=bt.fbo;if(!Gt){let zt=new o.T(q,{width:Zt,height:Zt,data:null},ct.RGBA);zt.bind(ct.LINEAR,ct.CLAMP_TO_EDGE),Gt=bt.fbo=q.createFramebuffer(Zt,Zt,!0,!1),Gt.colorAttachment.set(zt.texture)}q.bindFramebuffer.set(Gt.framebuffer),q.viewport.set([0,0,Zt,Zt]),v.useProgram("hillshadePrepare").draw(q,ct.TRIANGLES,_,et,it,pe.disabled,Hr(bt.tileID,mt),null,null,tt.id,v.rasterBoundsBuffer,v.quadTriangleIndexBuffer,v.rasterBoundsSegments),bt.needsHillshadePrepare=!1}})(h,g,G,u,L,Ve.disabled,w),J.viewport.set([0,0,h.width,h.height]);else if(h.renderPass==="translucent")if(S){let[v,O,K]=h.stencilConfigForOverlapTwoPass(G);Ia(h,g,u,K,v,L,w,!1,y),Ia(h,g,u,K,O,L,w,!0,y)}else{let[v,O]=h.getStencilConfigForOverlapAndUpdateStencilID(G);Ia(h,g,u,O,v,L,w,!1,y)}})(e,a,c,r,W):o.cs(c)?(function(h,g,u,G,Y){if(h.renderPass!=="translucent"||!G.length)return;let{isRenderingToTexture:y}=Y,J=h.style.projection.useSubdivision,S=h.getDepthModeForSublayer(0,de.ReadOnly),L=h.colorModeForRenderPass();if(J){let[w,v,O]=h.stencilConfigForOverlapTwoPass(G);Zi(h,g,u,O,w,S,L,!1,y),Zi(h,g,u,O,v,S,L,!0,y)}else{let[w,v]=h.getStencilConfigForOverlapAndUpdateStencilID(G);Zi(h,g,u,v,w,S,L,!1,y)}})(e,a,c,r,W):o.bT(c)?(function(h,g,u,G,Y){if(h.renderPass!=="translucent"||u.paint.get("raster-opacity")===0||!G.length)return;let{isRenderingToTexture:y}=Y,J=g.getSource(),S=h.style.projection.useSubdivision;if(J instanceof Ql)hn(h,g,u,G,null,!1,!1,J.tileCoords,J.flippedWindingOrder,y);else if(S){let[L,w,v]=h.stencilConfigForOverlapTwoPass(G);hn(h,g,u,v,L,!1,!0,Cd,!1,y),hn(h,g,u,v,w,!0,!0,Cd,!1,y)}else{let[L,w]=h.getStencilConfigForOverlapAndUpdateStencilID(G);hn(h,g,u,w,L,!1,!0,Cd,!1,y)}})(e,a,c,r,W):o.ct(c)?(function(h,g,u,G,Y){let y=u.paint.get("background-color"),J=u.paint.get("background-opacity");if(J===0)return;let{isRenderingToTexture:S}=Y,L=h.context,w=L.gl,v=h.style.projection,O=h.transform,K=O.tileSize,tt=u.paint.get("background-pattern");if(h.isPatternMissing(tt))return;let _=!tt&&y.a===1&&J===1&&h.opaquePassEnabledForLayer()?"opaque":"translucent";if(h.renderPass!==_)return;let et=Ve.disabled,it=h.getDepthModeForSublayer(0,_==="opaque"?de.ReadWrite:de.ReadOnly),q=h.colorModeForRenderPass(),ct=h.useProgram(tt?"backgroundPattern":"background"),ht=G||ie(O,{tileSize:K,terrain:h.style.map.terrain});tt&&(L.activeTexture.set(w.TEXTURE0),h.imageManager.bind(h.context));let bt=u.getCrossfadeParameters();for(let mt of ht){let Zt=O.getProjectionData({overscaledTileID:mt,applyGlobeMatrix:!S,applyTerrainMatrix:!0}),Jt=tt?ns(J,h,tt,{tileID:mt,tileSize:K},bt):as(J,y),Yt=h.style.map.terrain&&h.style.map.terrain.getTerrainData(mt),Gt=v.getMeshFromTileID(L,mt.canonical,!1,!0,"raster");ct.draw(L,w.TRIANGLES,it,et,q,pe.backCCW,Jt,Yt,Zt,u.id,Gt.vertexBuffer,Gt.indexBuffer,Gt.segments)}})(e,0,c,r,W):o.cu(c)&&(function(h,g,u,G){let{isRenderingGlobe:Y}=G,y=h.context,J=u.implementation,S=h.style.projection,L=h.transform,w=L.getProjectionDataForCustomLayer(Y),v={farZ:L.farZ,nearZ:L.nearZ,fov:L.fov*Math.PI/180,modelViewProjectionMatrix:L.modelViewProjectionMatrix,projectionMatrix:L.projectionMatrix,shaderData:{variantName:S.shaderVariantName,vertexShaderPrelude:`const float PI = 3.141592653589793;
uniform mat4 u_projection_matrix;
${S.shaderPreludeCode.vertexSource}`,define:S.shaderDefine},defaultProjectionData:w},O=J.renderingMode?J.renderingMode:"2d";if(h.renderPass==="offscreen"){let K=J.prerender;K&&(h.setCustomLayerDefaults(),y.setColorMode(h.colorModeForRenderPass()),K.call(J,y.gl,v),y.setDirty(),h.setBaseState())}else if(h.renderPass==="translucent"){h.setCustomLayerDefaults(),y.setColorMode(h.colorModeForRenderPass()),y.setStencilMode(Ve.disabled);let K=O==="3d"?h.getDepthModeFor3D():h.getDepthModeForSublayer(0,de.ReadOnly);y.setDepthMode(K),J.render(y.gl,v),y.setDirty(),h.setBaseState(),y.bindFramebuffer.set(null)}})(e,0,c,W))}saveTileTexture(e){let a=this._tileTextures[e.size[0]];a?a.push(e):this._tileTextures[e.size[0]]=[e]}getTileTexture(e){let a=this._tileTextures[e];return a&&a.length>0?a.pop():null}isPatternMissing(e){if(!e)return!1;if(!e.from||!e.to)return!0;let a=this.imageManager.getPattern(e.from.toString()),c=this.imageManager.getPattern(e.to.toString());return!a||!c}useProgram(e,a,c=!1,r=[]){this.cache=this.cache||{};let W=!!this.style.map.terrain,h=this.style.projection,g=c?yi.projectionMercator:h.shaderPreludeCode,u=c?wl:h.shaderDefine,G=e+(a?a.cacheKey:"")+`/${c?vl:h.shaderVariantName}`+(this._showOverdrawInspector?"/overdraw":"")+(W?"/terrain":"")+(r?`/${r.join("/")}`:"");return this.cache[G]||(this.cache[G]=new Lb(this.context,yi[e],a,cs[e],this._showOverdrawInspector,W,g,u,r)),this.cache[G]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){let e=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(e.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new o.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){var e,a;if(this._tileTextures){for(let c in this._tileTextures){let r=this._tileTextures[c];if(r)for(let W of r)W.destroy()}this._tileTextures={}}if(this.tileExtentBuffer&&this.tileExtentBuffer.destroy(),this.debugBuffer&&this.debugBuffer.destroy(),this.rasterBoundsBuffer&&this.rasterBoundsBuffer.destroy(),this.rasterBoundsBufferPosOnly&&this.rasterBoundsBufferPosOnly.destroy(),this.viewportBuffer&&this.viewportBuffer.destroy(),this.tileBorderIndexBuffer&&this.tileBorderIndexBuffer.destroy(),this.quadTriangleIndexBuffer&&this.quadTriangleIndexBuffer.destroy(),this.tileExtentMesh&&((e=this.tileExtentMesh.vertexBuffer)===null||e===void 0||e.destroy()),this.tileExtentMesh&&((a=this.tileExtentMesh.indexBuffer)===null||a===void 0||a.destroy()),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this.cache){for(let c in this.cache){let r=this.cache[c];r&&r.program&&this.context.gl.deleteProgram(r.program)}this.cache={}}this.context&&this.context.setDefault()}overLimit(){let{drawingBufferWidth:e,drawingBufferHeight:a}=this.context.gl;return this.width!==e||this.height!==a}}function Fs(m,e){let a,c=!1,r=null,W=null,h=()=>{r=null,c&&(m.apply(W,a),r=setTimeout(h,e),c=!1)};return(...g)=>(c=!0,W=this,a=g,r||h(),r)}class Gs{constructor(e){this._getCurrentHash=()=>{let a=window.location.hash.replace("#","");if(this._hashName){let c;return a.split("&").map((r=>r.split("="))).forEach((r=>{r[0]===this._hashName&&(c=r)})),(c&&c[1]||"").split("/")}return a.split("/")},this._onHashChange=()=>{let a=this._getCurrentHash();if(!this._isValidHash(a))return!1;let c=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(a[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+a[2],+a[1]],zoom:+a[0],bearing:c,pitch:+(a[4]||0)}),!0},this._updateHashUnthrottled=()=>{let a=window.location.href.replace(/(#.*)?$/,this.getHashString());window.history.replaceState(window.history.state,null,a)},this._removeHash=()=>{let a=this._getCurrentHash();if(a.length===0)return;let c=a.join("/"),r=c;r.split("&").length>0&&(r=r.split("&")[0]),this._hashName&&(r=`${this._hashName}=${c}`);let W=window.location.hash.replace(r,"");W.startsWith("#&")?W=W.slice(0,1)+W.slice(2):W==="#"&&(W="");let h=window.location.href.replace(/(#.+)?$/,W);h=h.replace("&&","&"),window.history.replaceState(window.history.state,null,h)},this._updateHash=Fs(this._updateHashUnthrottled,300),this._hashName=e&&encodeURIComponent(e)}addTo(e){return this._map=e,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),this._removeHash(),delete this._map,this}getHashString(e){let a=this._map.getCenter(),c=Math.round(100*this._map.getZoom())/100,r=Math.ceil((c*Math.LN2+Math.log(512/360/.5))/Math.LN10),W=Math.pow(10,r),h=Math.round(a.lng*W)/W,g=Math.round(a.lat*W)/W,u=this._map.getBearing(),G=this._map.getPitch(),Y="";if(Y+=e?`/${h}/${g}/${c}`:`${c}/${g}/${h}`,(u||G)&&(Y+="/"+Math.round(10*u)/10),G&&(Y+=`/${Math.round(G)}`),this._hashName){let y=this._hashName,J=!1,S=window.location.hash.slice(1).split("&").map((L=>{let w=L.split("=")[0];return w===y?(J=!0,`${w}=${Y}`):L})).filter((L=>L));return J||S.push(`${y}=${Y}`),`#${S.join("&")}`}return`#${Y}`}_isValidHash(e){if(e.length<3||e.some(isNaN))return!1;try{new o.V(+e[2],+e[1])}catch{return!1}let a=+e[0],c=+(e[3]||0),r=+(e[4]||0);return a>=this._map.getMinZoom()&&a<=this._map.getMaxZoom()&&c>=-180&&c<=180&&r>=this._map.getMinPitch()&&r<=this._map.getMaxPitch()}}let qn={linearity:.3,easing:o.cv(0,0,.3,1)},m0=o.e({deceleration:2500,maxSpeed:1400},qn),W0=o.e({deceleration:20,maxSpeed:1400},qn),Z0=o.e({deceleration:1e3,maxSpeed:360},qn),_c=o.e({deceleration:1e3,maxSpeed:90},qn),h0=o.e({deceleration:1e3,maxSpeed:360},qn);class Si{constructor(e){this._map=e,this.clear()}clear(){this._inertiaBuffer=[]}record(e){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:Ct(),settings:e})}_drainInertiaBuffer(){let e=this._inertiaBuffer,a=Ct();for(;e.length>0&&a-e[0].time>160;)e.shift()}_onMoveEnd(e){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;let a={zoom:0,bearing:0,pitch:0,roll:0,pan:new o.P(0,0),pinchAround:void 0,around:void 0};for(let{settings:W}of this._inertiaBuffer)a.zoom+=W.zoomDelta||0,a.bearing+=W.bearingDelta||0,a.pitch+=W.pitchDelta||0,a.roll+=W.rollDelta||0,W.panDelta&&a.pan._add(W.panDelta),W.around&&(a.around=W.around),W.pinchAround&&(a.pinchAround=W.pinchAround);let c=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,r={};if(a.pan.mag()){let W=$n(a.pan.mag(),c,o.e({},m0,e||{})),h=a.pan.mult(W.amount/a.pan.mag()),g=this._map.cameraHelper.handlePanInertia(h,this._map.transform);r.center=g.easingCenter,r.offset=g.easingOffset,ei(r,W)}if(a.zoom){let W=$n(a.zoom,c,W0);r.zoom=this._map.transform.zoom+W.amount,ei(r,W)}if(a.bearing){let W=$n(a.bearing,c,Z0);r.bearing=this._map.transform.bearing+o.an(W.amount,-179,179),ei(r,W)}if(a.pitch){let W=$n(a.pitch,c,_c);r.pitch=this._map.transform.pitch+W.amount,ei(r,W)}if(a.roll){let W=$n(a.roll,c,h0);r.roll=this._map.transform.roll+o.an(W.amount,-179,179),ei(r,W)}if(r.zoom||r.bearing){let W=a.pinchAround===void 0?a.around:a.pinchAround;r.around=W?this._map.unproject(W):this._map.getCenter()}return this.clear(),o.e(r,{noMoveStart:!0})}}function ei(m,e){(!m.duration||m.duration<e.duration)&&(m.duration=e.duration,m.easing=e.easing)}function $n(m,e,a){let{maxSpeed:c,linearity:r,deceleration:W}=a,h=o.an(m*r/(e/1e3),-c,c),g=Math.abs(h)/(W*r);return{easing:a.easing,duration:1e3*g,amount:h*(g/2)}}class qe extends o.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,a,c,r={}){c=c instanceof MouseEvent?c:new MouseEvent(e,c);let W=rt.mousePos(a.getCanvas(),c),h=a.unproject(W);super(e,o.e({point:W,lngLat:h,originalEvent:c},r)),this._defaultPrevented=!1,this.target=a}}class Ld extends o.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,a,c){let r=e==="touchend"?c.changedTouches:c.touches,W=rt.touchPos(a.getCanvasContainer(),r),h=W.map((u=>a.unproject(u))),g=W.reduce(((u,G,Y,y)=>u.add(G.div(y.length))),new o.P(0,0));super(e,{points:W,point:g,lngLats:h,lngLat:a.unproject(g),originalEvent:c}),this._defaultPrevented=!1}}class Vn extends o.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,a,c){super(e,{originalEvent:c}),this._defaultPrevented=!1}}class Kb{constructor(e,a){this._map=e,this._clickTolerance=a.clickTolerance}reset(){delete this._mousedownPos}wheel(e){return this._firePreventable(new Vn(e.type,this._map,e))}mousedown(e,a){return this._mousedownPos=a,this._firePreventable(new qe(e.type,this._map,e))}mouseup(e){this._map.fire(new qe(e.type,this._map,e))}click(e,a){this._mousedownPos&&this._mousedownPos.dist(a)>=this._clickTolerance||this._map.fire(new qe(e.type,this._map,e))}dblclick(e){return this._firePreventable(new qe(e.type,this._map,e))}mouseover(e){this._map.fire(new qe(e.type,this._map,e))}mouseout(e){this._map.fire(new qe(e.type,this._map,e))}touchstart(e){return this._firePreventable(new Ld(e.type,this._map,e))}touchmove(e){this._map.fire(new Ld(e.type,this._map,e))}touchend(e){this._map.fire(new Ld(e.type,this._map,e))}touchcancel(e){this._map.fire(new Ld(e.type,this._map,e))}_firePreventable(e){if(this._map.fire(e),e.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Pb{constructor(e){this._map=e}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(e){this._map.fire(new qe(e.type,this._map,e))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new qe("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(e){this._delayContextMenu?this._contextMenuEvent=e:this._ignoreContextMenu||this._map.fire(new qe(e.type,this._map,e)),this._map.listens("contextmenu")&&e.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Ed{constructor(e){this._map=e}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(e){return this.transform.screenPointToLocation(o.P.convert(e),this._map.terrain)}}class V0{constructor(e,a){this._map=e,this._tr=new Ed(e),this._el=e.getCanvasContainer(),this._container=e.getContainer(),this._clickTolerance=a.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(e,a){this.isEnabled()&&e.shiftKey&&e.button===0&&(rt.disableDrag(),this._startPos=this._lastPos=a,this._active=!0)}mousemoveWindow(e,a){if(!this._active)return;let c=a;if(this._lastPos.equals(c)||!this._box&&c.dist(this._startPos)<this._clickTolerance)return;let r=this._startPos;this._lastPos=c,this._box||(this._box=rt.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",e));let W=Math.min(r.x,c.x),h=Math.max(r.x,c.x),g=Math.min(r.y,c.y),u=Math.max(r.y,c.y);rt.setTransform(this._box,`translate(${W}px,${g}px)`),this._box.style.width=h-W+"px",this._box.style.height=u-g+"px"}mouseupWindow(e,a){if(!this._active||e.button!==0)return;let c=this._startPos,r=a;if(this.reset(),rt.suppressClick(),c.x!==r.x||c.y!==r.y)return this._map.fire(new o.l("boxzoomend",{originalEvent:e})),{cameraAnimation:W=>W.fitScreenCoordinates(c,r,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",e)}keydown(e){this._active&&e.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",e))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(rt.remove(this._box),this._box=null),rt.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(e,a){return this._map.fire(new o.l(e,{originalEvent:a}))}}function Kc(m,e){if(m.length!==e.length)throw new Error(`The number of touches and points are not equal - touches ${m.length}, points ${e.length}`);let a={};for(let c=0;c<m.length;c++)a[m[c].identifier]=e[c];return a}class zd{constructor(e){this.reset(),this.numTouches=e.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(e,a,c){(this.centroid||c.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=e.timeStamp),c.length===this.numTouches&&(this.centroid=(function(r){let W=new o.P(0,0);for(let h of r)W._add(h);return W.div(r.length)})(a),this.touches=Kc(c,a)))}touchmove(e,a,c){if(this.aborted||!this.centroid)return;let r=Kc(c,a);for(let W in this.touches){let h=r[W];(!h||h.dist(this.touches[W])>30)&&(this.aborted=!0)}}touchend(e,a,c){if((!this.centroid||e.timeStamp-this.startTime>500)&&(this.aborted=!0),c.length===0){let r=!this.aborted&&this.centroid;if(this.reset(),r)return r}}}class fi{constructor(e){this.singleTap=new zd(e),this.numTaps=e.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(e,a,c){this.singleTap.touchstart(e,a,c)}touchmove(e,a,c){this.singleTap.touchmove(e,a,c)}touchend(e,a,c){let r=this.singleTap.touchend(e,a,c);if(r){let W=e.timeStamp-this.lastTime<500,h=!this.lastTap||this.lastTap.dist(r)<30;if(W&&h||this.reset(),this.count++,this.lastTime=e.timeStamp,this.lastTap=r,this.count===this.numTaps)return this.reset(),r}}}class Qt{constructor(e){this._tr=new Ed(e),this._zoomIn=new fi({numTouches:1,numTaps:2}),this._zoomOut=new fi({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(e,a,c){this._zoomIn.touchstart(e,a,c),this._zoomOut.touchstart(e,a,c)}touchmove(e,a,c){this._zoomIn.touchmove(e,a,c),this._zoomOut.touchmove(e,a,c)}touchend(e,a,c){let r=this._zoomIn.touchend(e,a,c),W=this._zoomOut.touchend(e,a,c),h=this._tr;return r?(this._active=!0,e.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:g=>g.easeTo({duration:300,zoom:h.zoom+1,around:h.unproject(r)},{originalEvent:e})}):W?(this._active=!0,e.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:g=>g.easeTo({duration:300,zoom:h.zoom-1,around:h.unproject(W)},{originalEvent:e})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class td{constructor(e){this._enabled=!!e.enable,this._moveStateManager=e.moveStateManager,this._clickTolerance=e.clickTolerance||1,this._moveFunction=e.move,this._activateOnStart=!!e.activateOnStart,e.assignEvents(this),this.reset()}reset(e){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(e)}_move(...e){let a=this._moveFunction(...e);if(a.bearingDelta||a.pitchDelta||a.rollDelta||a.around||a.panDelta)return this._active=!0,a}dragStart(e,a){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(e)&&(this._moveStateManager.startMove(e),this._lastPoint=Array.isArray(a)?a[0]:a,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(e,a){if(!this.isEnabled())return;let c=this._lastPoint;if(!c)return;if(e.preventDefault(),!this._moveStateManager.isValidMoveEvent(e))return void this.reset(e);let r=Array.isArray(a)?a[0]:a;return!this._moved&&r.dist(c)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=r,this._move(c,r))}dragEnd(e){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(e)&&(this._moved&&rt.suppressClick(),this.reset(e))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}let Ns=0,p0=2,jd={[Ns]:1,[p0]:2};class Ua{constructor(e){this._correctEvent=e.checkCorrectEvent}startMove(e){let a=rt.mouseButton(e);this._eventButton=a}endMove(e){delete this._eventButton}isValidStartEvent(e){return this._correctEvent(e)}isValidMoveEvent(e){return!(function(a,c){let r=jd[c];return a.buttons===void 0||(a.buttons&r)!==r})(e,this._eventButton)}isValidEndEvent(e){return rt.mouseButton(e)===this._eventButton}}class Is{constructor(){this._firstTouch=void 0}_isOneFingerTouch(e){return e.targetTouches.length===1}_isSameTouchEvent(e){return e.targetTouches[0].identifier===this._firstTouch}startMove(e){this._firstTouch=e.targetTouches[0].identifier}endMove(e){delete this._firstTouch}isValidStartEvent(e){return this._isOneFingerTouch(e)}isValidMoveEvent(e){return this._isOneFingerTouch(e)&&this._isSameTouchEvent(e)}isValidEndEvent(e){return this._isOneFingerTouch(e)&&this._isSameTouchEvent(e)}}class qb{constructor(e=new Ua({checkCorrectEvent:()=>!0}),a=new Is){this.mouseMoveStateManager=e,this.oneFingerTouchMoveStateManager=a}_executeRelevantHandler(e,a,c){return e instanceof MouseEvent?a(e):typeof TouchEvent<"u"&&e instanceof TouchEvent?c(e):void 0}startMove(e){this._executeRelevantHandler(e,(a=>this.mouseMoveStateManager.startMove(a)),(a=>this.oneFingerTouchMoveStateManager.startMove(a)))}endMove(e){this._executeRelevantHandler(e,(a=>this.mouseMoveStateManager.endMove(a)),(a=>this.oneFingerTouchMoveStateManager.endMove(a)))}isValidStartEvent(e){return this._executeRelevantHandler(e,(a=>this.mouseMoveStateManager.isValidStartEvent(a)),(a=>this.oneFingerTouchMoveStateManager.isValidStartEvent(a)))}isValidMoveEvent(e){return this._executeRelevantHandler(e,(a=>this.mouseMoveStateManager.isValidMoveEvent(a)),(a=>this.oneFingerTouchMoveStateManager.isValidMoveEvent(a)))}isValidEndEvent(e){return this._executeRelevantHandler(e,(a=>this.mouseMoveStateManager.isValidEndEvent(a)),(a=>this.oneFingerTouchMoveStateManager.isValidEndEvent(a)))}}let ed=m=>{m.mousedown=m.dragStart,m.mousemoveWindow=m.dragMove,m.mouseup=m.dragEnd,m.contextmenu=e=>{e.preventDefault()}};class g0{constructor(e,a){this._clickTolerance=e.clickTolerance||1,this._map=a,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new o.P(0,0)}_shouldBePrevented(e){return e<(this._map.cooperativeGestures.isEnabled()?2:1)}touchstart(e,a,c){return this._calculateTransform(e,a,c)}touchmove(e,a,c){if(this._active){if(!this._shouldBePrevented(c.length))return e.preventDefault(),this._calculateTransform(e,a,c);this._map.cooperativeGestures.notifyGestureBlocked("touch_pan",e)}}touchend(e,a,c){this._calculateTransform(e,a,c),this._active&&this._shouldBePrevented(c.length)&&this.reset()}touchcancel(){this.reset()}_calculateTransform(e,a,c){c.length>0&&(this._active=!0);let r=Kc(c,a),W=new o.P(0,0),h=new o.P(0,0),g=0;for(let G in r){let Y=r[G],y=this._touches[G];y&&(W._add(Y),h._add(Y.sub(y)),g++,r[G]=Y)}if(this._touches=r,this._shouldBePrevented(g)||!h.mag())return;let u=h.div(g);return this._sum._add(u),this._sum.mag()<this._clickTolerance?void 0:{around:W.div(g),panDelta:u}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ad{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(e,a,c){this._firstTwoTouches||c.length<2||(this._firstTwoTouches=[c[0].identifier,c[1].identifier],this._start([a[0],a[1]]))}touchmove(e,a,c){if(!this._firstTwoTouches)return;e.preventDefault();let[r,W]=this._firstTwoTouches,h=Pc(c,a,r),g=Pc(c,a,W);if(!h||!g)return;let u=this._aroundCenter?null:h.add(g).div(2);return this._move([h,g],u,e)}touchend(e,a,c){if(!this._firstTwoTouches)return;let[r,W]=this._firstTwoTouches,h=Pc(c,a,r),g=Pc(c,a,W);h&&g||(this._active&&rt.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(e){this._enabled=!0,this._aroundCenter=!!e&&e.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function Pc(m,e,a){for(let c=0;c<m.length;c++)if(m[c].identifier===a)return e[c]}function Us(m,e){return Math.log(m/e)/Math.LN2}class R0 extends Ad{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(e){this._startDistance=this._distance=e[0].dist(e[1])}_move(e,a){let c=this._distance;if(this._distance=e[0].dist(e[1]),this._active||!(Math.abs(Us(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Us(this._distance,c),pinchAround:a}}}function u0(m,e){return 180*m.angleWith(e)/Math.PI}class Ms extends Ad{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(e){this._startVector=this._vector=e[0].sub(e[1]),this._minDiameter=e[0].dist(e[1])}_move(e,a,c){let r=this._vector;if(this._vector=e[0].sub(e[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:u0(this._vector,r),pinchAround:a}}_isBelowThreshold(e){this._minDiameter=Math.min(this._minDiameter,e.mag());let a=25/(Math.PI*this._minDiameter)*360,c=u0(e,this._startVector);return Math.abs(c)<a}}function Ys(m){return Math.abs(m.y)>Math.abs(m.x)}class xs extends Ad{constructor(e){super(),this._currentTouchCount=0,this._map=e}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(e,a,c){super.touchstart(e,a,c),this._currentTouchCount=c.length}_start(e){this._lastPoints=e,Ys(e[0].sub(e[1]))&&(this._valid=!1)}_move(e,a,c){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;let r=e[0].sub(this._lastPoints[0]),W=e[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(r,W,c.timeStamp),this._valid?(this._lastPoints=e,this._active=!0,{pitchDelta:(r.y+W.y)/2*-.5}):void 0}gestureBeginsVertically(e,a,c){if(this._valid!==void 0)return this._valid;let r=e.mag()>=2,W=a.mag()>=2;if(!r&&!W)return;if(!r||!W)return this._firstMove===void 0&&(this._firstMove=c),c-this._firstMove<100&&void 0;let h=e.y>0==a.y>0;return Ys(e)&&Ys(a)&&h}}let $b={panStep:100,bearingStep:15,pitchStep:10};class F0{constructor(e){this._tr=new Ed(e);let a=$b;this._panStep=a.panStep,this._bearingStep=a.bearingStep,this._pitchStep=a.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(e){if(e.altKey||e.ctrlKey||e.metaKey)return;let a=0,c=0,r=0,W=0,h=0;switch(e.keyCode){case 61:case 107:case 171:case 187:a=1;break;case 189:case 109:case 173:a=-1;break;case 37:e.shiftKey?c=-1:(e.preventDefault(),W=-1);break;case 39:e.shiftKey?c=1:(e.preventDefault(),W=1);break;case 38:e.shiftKey?r=1:(e.preventDefault(),h=-1);break;case 40:e.shiftKey?r=-1:(e.preventDefault(),h=1);break;default:return}return this._rotationDisabled&&(c=0,r=0),{cameraAnimation:g=>{let u=this._tr;g.easeTo({duration:300,easeId:"keyboardHandler",easing:_a,zoom:a?Math.round(u.zoom)+a*(e.shiftKey?2:1):u.zoom,bearing:u.bearing+c*this._bearingStep,pitch:u.pitch+r*this._pitchStep,offset:[-W*this._panStep,-h*this._panStep],center:u.center},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function _a(m){return m*(2-m)}let Ge=4.000244140625,tm=1/450;class wd{constructor(e,a){this._onTimeout=c=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(c)},this._map=e,this._tr=new Ed(e),this._triggerRenderFrame=a,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=tm}setZoomRate(e){this._defaultZoomRate=e}setWheelZoomRate(e){this._wheelZoomRate=e}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(e){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!e&&e.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}_shouldBePrevented(e){return!!this._map.cooperativeGestures.isEnabled()&&!(e.ctrlKey||this._map.cooperativeGestures.isBypassed(e))}wheel(e){if(!this.isEnabled())return;if(this._shouldBePrevented(e))return void this._map.cooperativeGestures.notifyGestureBlocked("wheel_zoom",e);let a=e.deltaMode===WheelEvent.DOM_DELTA_LINE?40*e.deltaY:e.deltaY,c=Ct(),r=c-(this._lastWheelEventTime||0);this._lastWheelEventTime=c,a!==0&&a%Ge==0?this._type="wheel":a!==0&&Math.abs(a)<4?this._type="trackpad":r>400?(this._type=null,this._lastValue=a,this._timeout=setTimeout(this._onTimeout,40,e)):this._type||(this._type=Math.abs(r*a)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,a+=this._lastValue)),e.shiftKey&&a&&(a/=4),this._type&&(this._lastWheelEvent=e,this._delta-=a,this._active||this._start(e)),e.preventDefault()}_start(e){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);let a=rt.mousePos(this._map.getCanvas(),e),c=this._tr;this._aroundPoint=this._aroundCenter?c.transform.locationToScreenPoint(o.V.convert(c.center)):a,this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;let e=this._tr.transform;if(typeof this._lastExpectedZoom=="number"){let g=e.zoom-this._lastExpectedZoom;typeof this._startZoom=="number"&&(this._startZoom+=g),typeof this._targetZoom=="number"&&(this._targetZoom+=g)}if(this._delta!==0){let g=this._type==="wheel"&&Math.abs(this._delta)>Ge?this._wheelZoomRate:this._defaultZoomRate,u=2/(1+Math.exp(-Math.abs(this._delta*g)));this._delta<0&&u!==0&&(u=1/u);let G=typeof this._targetZoom!="number"?e.scale:o.aq(this._targetZoom);this._targetZoom=e.applyConstrain(e.getCameraLngLat(),o.at(G*u)).zoom,this._type==="wheel"&&(this._startZoom=e.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}let a=typeof this._targetZoom!="number"?e.zoom:this._targetZoom,c=this._startZoom,r=this._easing,W,h=!1;if(this._type==="wheel"&&c&&r){let g=Ct()-this._lastWheelEventTime,u=Math.min((g+5)/200,1),G=r(u);W=o.G.number(c,a,G),u<1?this._frameId||(this._frameId=!0):h=!0}else W=a,h=!0;return this._active=!0,h&&(this._active=!1,this._finishTimeout=setTimeout((()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._lastExpectedZoom,delete this._finishTimeout}),200)),this._lastExpectedZoom=W,{noInertia:!0,needsRenderFrame:!h,zoomDelta:W-e.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(e){let a=o.cx;if(this._prevEase){let c=this._prevEase,r=(Ct()-c.start)/c.duration,W=c.easing(r+.01)-c.easing(r),h=.27/Math.sqrt(W*W+1e-4)*.01,g=Math.sqrt(.0729-h*h);a=o.cv(h,g,.25,1)}return this._prevEase={start:Ct(),duration:e,easing:a},a}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,delete this._lastExpectedZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class vd{constructor(e,a){this._clickZoom=e,this._tapZoom=a}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Ts{constructor(e){this._tr=new Ed(e),this.reset()}reset(){this._active=!1}dblclick(e,a){return e.preventDefault(),{cameraAnimation:c=>{c.easeTo({duration:300,zoom:this._tr.zoom+(e.shiftKey?-1:1),around:this._tr.unproject(a)},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class G0{constructor(){this._tap=new fi({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(e,a,c){if(!this._swipePoint)if(this._tapTime){let r=a[0],W=e.timeStamp-this._tapTime<500,h=this._tapPoint.dist(r)<30;W&&h?c.length>0&&(this._swipePoint=r,this._swipeTouch=c[0].identifier):this.reset()}else this._tap.touchstart(e,a,c)}touchmove(e,a,c){if(this._tapTime){if(this._swipePoint){if(c[0].identifier!==this._swipeTouch)return;let r=a[0],W=r.y-this._swipePoint.y;return this._swipePoint=r,e.preventDefault(),this._active=!0,{zoomDelta:W/128}}}else this._tap.touchmove(e,a,c)}touchend(e,a,c){if(this._tapTime)this._swipePoint&&c.length===0&&this.reset();else{let r=this._tap.touchend(e,a,c);r&&(this._tapTime=e.timeStamp,this._tapPoint=r)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Xs{constructor(e,a,c){this._el=e,this._mousePan=a,this._touchPan=c}enable(e){this._inertiaOptions=e||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Js{constructor(e,a,c,r){this._pitchWithRotate=e.pitchWithRotate,this._rollEnabled=e.rollEnabled,this._mouseRotate=a,this._mousePitch=c,this._mouseRoll=r}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable(),this._rollEnabled&&this._mouseRoll.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable(),this._mouseRoll.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())&&(!this._rollEnabled||this._mouseRoll.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()||this._mouseRoll.isActive()}}class N0{constructor(e,a,c,r){this._el=e,this._touchZoom=a,this._touchRotate=c,this._tapDragZoom=r,this._rotationDisabled=!1,this._enabled=!0}enable(e){this._touchZoom.enable(e),this._rotationDisabled||this._touchRotate.enable(e),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class _i{constructor(e,a){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=e,this._options=a,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;let e=this._map.getCanvasContainer();e.classList.add("maplibregl-cooperative-gestures"),this._container=rt.create("div","maplibregl-cooperative-gesture-screen",e);let a=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(a=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));let c=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),r=document.createElement("div");r.className="maplibregl-desktop-message",r.textContent=a,this._container.appendChild(r);let W=document.createElement("div");W.className="maplibregl-mobile-message",W.textContent=c,this._container.appendChild(W),this._container.setAttribute("aria-hidden","true")}_destroyUI(){this._container&&(rt.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destroyUI()}isEnabled(){return this._enabled}isBypassed(e){return e[this._bypassKey]}notifyGestureBlocked(e,a){this._enabled&&(this._map.fire(new o.l("cooperativegestureprevented",{gestureType:e,originalEvent:a})),this._container.classList.add("maplibregl-show"),setTimeout((()=>{this._container.classList.remove("maplibregl-show")}),100))}}let pn=m=>m.zoom||m.drag||m.roll||m.pitch||m.rotate;class At extends o.l{}function Dt(m){return m.panDelta&&m.panDelta.mag()||m.zoomDelta||m.bearingDelta||m.pitchDelta||m.rollDelta}class Hd{constructor(e,a){this.handleWindowEvent=r=>{this.handleEvent(r,`${r.type}Window`)},this.handleEvent=(r,W)=>{if(r.type==="blur")return void this.stop(!0);this._updatingCamera=!0;let h=r.type==="renderFrame"?void 0:r,g={needsRenderFrame:!1},u={},G={};for(let{handlerName:J,handler:S,allowed:L}of this._handlers){if(!S.isEnabled())continue;let w;if(this._blockedByActive(G,L,J))S.reset();else if(S[W||r.type]){if(o.cy(r,W||r.type)){let v=rt.mousePos(this._map.getCanvas(),r);w=S[W||r.type](r,v)}else if(o.cz(r,W||r.type)){let v=this._getMapTouches(r.touches),O=rt.touchPos(this._map.getCanvas(),v);w=S[W||r.type](r,O,v)}else o.cA(W||r.type)||(w=S[W||r.type](r));this.mergeHandlerResult(g,u,w,J,h),w&&w.needsRenderFrame&&this._triggerRenderFrame()}(w||S.isActive())&&(G[J]=S)}let Y={};for(let J in this._previousActiveHandlers)G[J]||(Y[J]=h);this._previousActiveHandlers=G,(Object.keys(Y).length||Dt(g))&&(this._changes.push([g,u,Y]),this._triggerRenderFrame()),(Object.keys(G).length||Dt(g))&&this._map._stop(!0),this._updatingCamera=!1;let{cameraAnimation:y}=g;y&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],y(this._map))},this._map=e,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Si(e),this._bearingSnap=a.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(a);let c=this._el;this._listeners=[[c,"touchstart",{passive:!0}],[c,"touchmove",{passive:!1}],[c,"touchend",void 0],[c,"touchcancel",void 0],[c,"mousedown",void 0],[c,"mousemove",void 0],[c,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[c,"mouseover",void 0],[c,"mouseout",void 0],[c,"dblclick",void 0],[c,"click",void 0],[c,"keydown",{capture:!1}],[c,"keyup",void 0],[c,"wheel",{passive:!1}],[c,"contextmenu",void 0],[window,"blur",void 0]];for(let[r,W,h]of this._listeners)rt.addEventListener(r,W,r===document?this.handleWindowEvent:this.handleEvent,h)}destroy(){for(let[e,a,c]of this._listeners)rt.removeEventListener(e,a,e===document?this.handleWindowEvent:this.handleEvent,c)}_addDefaultHandlers(e){let a=this._map,c=a.getCanvasContainer();this._add("mapEvent",new Kb(a,e));let r=a.boxZoom=new V0(a,e);this._add("boxZoom",r),e.interactive&&e.boxZoom&&r.enable();let W=a.cooperativeGestures=new _i(a,e.cooperativeGestures);this._add("cooperativeGestures",W),e.cooperativeGestures&&W.enable();let h=new Qt(a),g=new Ts(a);a.doubleClickZoom=new vd(g,h),this._add("tapZoom",h),this._add("clickZoom",g),e.interactive&&e.doubleClickZoom&&a.doubleClickZoom.enable();let u=new G0;this._add("tapDragZoom",u);let G=a.touchPitch=new xs(a);this._add("touchPitch",G),e.interactive&&e.touchPitch&&a.touchPitch.enable(e.touchPitch);let Y=()=>a.project(a.getCenter()),y=(function({enable:_,clickTolerance:et,aroundCenter:it=!0,minPixelCenterThreshold:q=100,rotateDegreesPerPixelMoved:ct=.8},ht){let bt=new Ua({checkCorrectEvent:mt=>rt.mouseButton(mt)===0&&mt.ctrlKey||rt.mouseButton(mt)===2&&!mt.ctrlKey});return new td({clickTolerance:et,move:(mt,Zt)=>{let Jt=ht();if(it&&Math.abs(Jt.y-mt.y)>q)return{bearingDelta:o.cw(new o.P(mt.x,Zt.y),Zt,Jt)};let Yt=(Zt.x-mt.x)*ct;return it&&Zt.y<Jt.y&&(Yt=-Yt),{bearingDelta:Yt}},moveStateManager:bt,enable:_,assignEvents:ed})})(e,Y),J=(function({enable:_,clickTolerance:et,pitchDegreesPerPixelMoved:it=-.5}){let q=new Ua({checkCorrectEvent:ct=>rt.mouseButton(ct)===0&&ct.ctrlKey||rt.mouseButton(ct)===2});return new td({clickTolerance:et,move:(ct,ht)=>({pitchDelta:(ht.y-ct.y)*it}),moveStateManager:q,enable:_,assignEvents:ed})})(e),S=(function({enable:_,clickTolerance:et,rollDegreesPerPixelMoved:it=.3},q){let ct=new Ua({checkCorrectEvent:ht=>rt.mouseButton(ht)===2&&ht.ctrlKey});return new td({clickTolerance:et,move:(ht,bt)=>{let mt=q(),Zt=(bt.x-ht.x)*it;return bt.y<mt.y&&(Zt=-Zt),{rollDelta:Zt}},moveStateManager:ct,enable:_,assignEvents:ed})})(e,Y);a.dragRotate=new Js(e,y,J,S),this._add("mouseRotate",y,["mousePitch"]),this._add("mousePitch",J,["mouseRotate","mouseRoll"]),this._add("mouseRoll",S,["mousePitch"]),e.interactive&&e.dragRotate&&a.dragRotate.enable();let L=(function({enable:_,clickTolerance:et}){let it=new Ua({checkCorrectEvent:q=>rt.mouseButton(q)===0&&!q.ctrlKey});return new td({clickTolerance:et,move:(q,ct)=>({around:ct,panDelta:ct.sub(q)}),activateOnStart:!0,moveStateManager:it,enable:_,assignEvents:ed})})(e),w=new g0(e,a);a.dragPan=new Xs(c,L,w),this._add("mousePan",L),this._add("touchPan",w,["touchZoom","touchRotate"]),e.interactive&&e.dragPan&&a.dragPan.enable(e.dragPan);let v=new Ms,O=new R0;a.touchZoomRotate=new N0(c,O,v,u),this._add("touchRotate",v,["touchPan","touchZoom"]),this._add("touchZoom",O,["touchPan","touchRotate"]),e.interactive&&e.touchZoomRotate&&a.touchZoomRotate.enable(e.touchZoomRotate),this._add("blockableMapEvent",new Pb(a));let K=a.scrollZoom=new wd(a,(()=>this._triggerRenderFrame()));this._add("scrollZoom",K,["mousePan"]),e.interactive&&e.scrollZoom&&a.scrollZoom.enable(e.scrollZoom);let tt=a.keyboard=new F0(a);this._add("keyboard",tt),e.interactive&&e.keyboard&&a.keyboard.enable()}_add(e,a,c){this._handlers.push({handlerName:e,handler:a,allowed:c}),this._handlersById[e]=a}stop(e){if(!this._updatingCamera){for(let{handler:a}of this._handlers)a.reset();this._inertia.clear(),this._fireEvents({},{},e),this._changes=[]}}isActive(){for(let{handler:e}of this._handlers)if(e.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!pn(this._eventsInProgress)||this.isZooming()}_blockedByActive(e,a,c){for(let r in e)if(r!==c&&(!a||a.indexOf(r)<0))return!0;return!1}_getMapTouches(e){let a=[];for(let c of e)this._el.contains(c.target)&&a.push(c);return a}mergeHandlerResult(e,a,c,r,W){if(!c)return;o.e(e,c);let h={handlerName:r,originalEvent:c.originalEvent||W};c.zoomDelta!==void 0&&(a.zoom=h),c.panDelta!==void 0&&(a.drag=h),c.rollDelta!==void 0&&(a.roll=h),c.pitchDelta!==void 0&&(a.pitch=h),c.bearingDelta!==void 0&&(a.rotate=h)}_applyChanges(){let e={},a={},c={};for(let[r,W,h]of this._changes)r.panDelta&&(e.panDelta=(e.panDelta||new o.P(0,0))._add(r.panDelta)),r.zoomDelta&&(e.zoomDelta=(e.zoomDelta||0)+r.zoomDelta),r.bearingDelta&&(e.bearingDelta=(e.bearingDelta||0)+r.bearingDelta),r.pitchDelta&&(e.pitchDelta=(e.pitchDelta||0)+r.pitchDelta),r.rollDelta&&(e.rollDelta=(e.rollDelta||0)+r.rollDelta),r.around!==void 0&&(e.around=r.around),r.pinchAround!==void 0&&(e.pinchAround=r.pinchAround),r.noInertia&&(e.noInertia=r.noInertia),o.e(a,W),o.e(c,h);this._updateMapTransform(e,a,c),this._changes=[]}_updateMapTransform(e,a,c){let r=this._map,W=r._getTransformForUpdate(),h=r.terrain;if(!(Dt(e)||h&&this._terrainMovement))return this._fireEvents(a,c,!0);r._stop(!0);let{panDelta:g,zoomDelta:u,bearingDelta:G,pitchDelta:Y,rollDelta:y,around:J,pinchAround:S}=e;S!==void 0&&(J=S),J=J||r.transform.centerPoint,h&&!W.isPointOnMapSurface(J)&&(J=W.centerPoint);let L={panDelta:g,zoomDelta:u,rollDelta:y,pitchDelta:Y,bearingDelta:G,around:J};this._map.cameraHelper.useGlobeControls&&!W.isPointOnMapSurface(J)&&(J=W.centerPoint);let w=J.distSqr(W.centerPoint)<.01?W.center:W.screenPointToLocation(g?J.sub(g):J);this._handleMapControls({terrain:h,tr:W,deltasForHelper:L,preZoomAroundLoc:w,combinedEventsInProgress:a,panDelta:g}),r._applyUpdatedTransform(W),this._map._update(),e.noInertia||this._inertia.record(e),this._fireEvents(a,c,!0)}_handleMapControls({terrain:e,tr:a,deltasForHelper:c,preZoomAroundLoc:r,combinedEventsInProgress:W,panDelta:h}){let g=this._map.cameraHelper;if(g.handleMapControlsRollPitchBearingZoom(c,a),e)return g.useGlobeControls?(this._terrainMovement||!W.drag&&!W.zoom||(this._terrainMovement=!0,this._map._elevationFreeze=!0),void g.handleMapControlsPan(c,a,r)):this._terrainMovement||!W.drag&&!W.zoom?void(W.drag&&this._terrainMovement&&h?a.setCenter(a.screenPointToLocation(a.centerPoint.sub(h))):g.handleMapControlsPan(c,a,r)):(this._terrainMovement=!0,this._map._elevationFreeze=!0,void g.handleMapControlsPan(c,a,r));g.handleMapControlsPan(c,a,r)}_fireEvents(e,a,c){let r=pn(this._eventsInProgress),W=pn(e),h={};for(let y in e){let{originalEvent:J}=e[y];this._eventsInProgress[y]||(h[`${y}start`]=J),this._eventsInProgress[y]=e[y]}!r&&W&&this._fireEvent("movestart",W.originalEvent);for(let y in h)this._fireEvent(y,h[y]);W&&this._fireEvent("move",W.originalEvent);for(let y in e){let{originalEvent:J}=e[y];this._fireEvent(y,J)}let g={},u;for(let y in this._eventsInProgress){let{handlerName:J,originalEvent:S}=this._eventsInProgress[y];this._handlersById[J].isActive()||(delete this._eventsInProgress[y],u=a[J]||S,g[`${y}end`]=u)}for(let y in g)this._fireEvent(y,g[y]);let G=pn(this._eventsInProgress),Y=(r||W)&&!G;if(Y&&this._terrainMovement){this._map._elevationFreeze=!1,this._terrainMovement=!1;let y=this._map._getTransformForUpdate();this._map.getCenterClampedToGround()&&y.recalculateZoomAndCenter(this._map.terrain),this._map._applyUpdatedTransform(y)}if(c&&Y){this._updatingCamera=!0;let y=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),J=S=>S!==0&&-this._bearingSnap<S&&S<this._bearingSnap;!y||!y.essential&&ft.prefersReducedMotion?(this._map.fire(new o.l("moveend",{originalEvent:u})),J(this._map.getBearing())&&this._map.resetNorth()):(J(y.bearing||this._map.getBearing())&&(y.bearing=0),y.freezeElevation=!0,this._map.easeTo(y,{originalEvent:u})),this._updatingCamera=!1}}_fireEvent(e,a){this._map.fire(new o.l(e,a?{originalEvent:a}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add((e=>{delete this._frameId,this.handleEvent(new At("renderFrame",{timeStamp:e})),this._applyChanges()}))}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class I0 extends o.E{constructor(e,a,c){super(),this._renderFrameCallback=()=>{let r=Math.min((Ct()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(r)),r<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=e,this._bearingSnap=c.bearingSnap,this.cameraHelper=a,this.on("moveend",(()=>{delete this._requestedCameraState}))}migrateProjection(e,a){e.apply(this.transform),this.transform=e,this.cameraHelper=a}getCenter(){return new o.V(this.transform.center.lng,this.transform.center.lat)}setCenter(e,a){return this.jumpTo({center:e},a)}getCenterElevation(){return this.transform.elevation}setCenterElevation(e,a){return this.jumpTo({elevation:e},a),this}getCenterClampedToGround(){return this._centerClampedToGround}setCenterClampedToGround(e){this._centerClampedToGround=e}panBy(e,a,c){return e=o.P.convert(e).mult(-1),this.panTo(this.transform.center,o.e({offset:e},a),c)}panTo(e,a,c){return this.easeTo(o.e({center:e},a),c)}getZoom(){return this.transform.zoom}setZoom(e,a){return this.jumpTo({zoom:e},a),this}zoomTo(e,a,c){return this.easeTo(o.e({zoom:e},a),c)}zoomIn(e,a){return this.zoomTo(this.getZoom()+1,e,a),this}zoomOut(e,a){return this.zoomTo(this.getZoom()-1,e,a),this}getVerticalFieldOfView(){return this.transform.fov}setVerticalFieldOfView(e,a){return e!=this.transform.fov&&(this.transform.setFov(e),this.fire(new o.l("movestart",a)).fire(new o.l("move",a)).fire(new o.l("moveend",a))),this}getBearing(){return this.transform.bearing}setBearing(e,a){return this.jumpTo({bearing:e},a),this}getPadding(){return this.transform.padding}setPadding(e,a){return this.jumpTo({padding:e},a),this}rotateTo(e,a,c){return this.easeTo(o.e({bearing:e},a),c)}resetNorth(e,a){return this.rotateTo(0,o.e({duration:1e3},e),a),this}resetNorthPitch(e,a){return this.easeTo(o.e({bearing:0,pitch:0,roll:0,duration:1e3},e),a),this}snapToNorth(e,a){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(e,a):this}getPitch(){return this.transform.pitch}setPitch(e,a){return this.jumpTo({pitch:e},a),this}getRoll(){return this.transform.roll}setRoll(e,a){return this.jumpTo({roll:e},a),this}cameraForBounds(e,a){e=Ee.convert(e).adjustAntiMeridian();let c=a&&a.bearing||0;return this._cameraForBoxAndBearing(e.getNorthWest(),e.getSouthEast(),c,a)}_cameraForBoxAndBearing(e,a,c,r){let W={top:0,bottom:0,right:0,left:0};if(typeof(r=o.e({padding:W,offset:[0,0],maxZoom:this.transform.maxZoom},r)).padding=="number"){let G=r.padding;r.padding={top:G,bottom:G,right:G,left:G}}let h=o.e(W,r.padding);r.padding=h;let g=this.transform,u=new Ee(e,a);return this.cameraHelper.cameraForBoxAndBearing(r,h,u,c,g)}fitBounds(e,a,c){return this._fitInternal(this.cameraForBounds(e,a),a,c)}fitScreenCoordinates(e,a,c,r,W){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.screenPointToLocation(o.P.convert(e)),this.transform.screenPointToLocation(o.P.convert(a)),c,r),r,W)}_fitInternal(e,a,c){return e?(delete(a=o.e(e,a)).padding,a.linear?this.easeTo(a,c):this.flyTo(a,c)):this}jumpTo(e,a){this.stop();let c=this._getTransformForUpdate(),r=!1,W=!1,h=!1,g=c.zoom;this.cameraHelper.handleJumpToCenterZoom(c,e);let u=c.zoom!==g;return"elevation"in e&&c.elevation!==+e.elevation&&c.setElevation(+e.elevation),"bearing"in e&&c.bearing!==+e.bearing&&(r=!0,c.setBearing(+e.bearing)),"pitch"in e&&c.pitch!==+e.pitch&&(W=!0,c.setPitch(+e.pitch)),"roll"in e&&c.roll!==+e.roll&&(h=!0,c.setRoll(+e.roll)),e.padding==null||c.isPaddingEqual(e.padding)||c.setPadding(e.padding),this._applyUpdatedTransform(c),this.fire(new o.l("movestart",a)).fire(new o.l("move",a)),u&&this.fire(new o.l("zoomstart",a)).fire(new o.l("zoom",a)).fire(new o.l("zoomend",a)),r&&this.fire(new o.l("rotatestart",a)).fire(new o.l("rotate",a)).fire(new o.l("rotateend",a)),W&&this.fire(new o.l("pitchstart",a)).fire(new o.l("pitch",a)).fire(new o.l("pitchend",a)),h&&this.fire(new o.l("rollstart",a)).fire(new o.l("roll",a)).fire(new o.l("rollend",a)),this.fire(new o.l("moveend",a))}calculateCameraOptionsFromTo(e,a,c,r=0){let W=o.aa.fromLngLat(e,a),h=o.aa.fromLngLat(c,r),g=h.x-W.x,u=h.y-W.y,G=h.z-W.z,Y=Math.hypot(g,u,G);if(Y===0)throw new Error("Can't calculate camera options with same From and To");let y=Math.hypot(g,u),J=o.at(this.transform.cameraToCenterDistance/Y/this.transform.tileSize),S=180*Math.atan2(g,-u)/Math.PI,L=180*Math.acos(y/Y)/Math.PI;return L=G<0?90-L:90+L,{center:h.toLngLat(),elevation:r,zoom:J,pitch:L,bearing:S}}calculateCameraOptionsFromCameraLngLatAltRotation(e,a,c,r,W){let h=this.transform.calculateCenterFromCameraLngLatAlt(e,a,c,r);return{center:h.center,elevation:h.elevation,zoom:h.zoom,bearing:c,pitch:r,roll:W}}easeTo(e,a){this._stop(!1,e.easeId),((e=o.e({offset:[0,0],duration:500,easing:o.cx},e)).animate===!1||!e.essential&&ft.prefersReducedMotion)&&(e.duration=0);let c=this._getTransformForUpdate(),r=this.getBearing(),W=c.pitch,h=c.roll,g="bearing"in e?this._normalizeBearing(e.bearing,r):r,u="pitch"in e?+e.pitch:W,G="roll"in e?this._normalizeBearing(e.roll,h):h,Y="padding"in e?e.padding:c.padding,y=o.P.convert(e.offset),J,S;e.around&&(J=o.V.convert(e.around),S=c.locationToScreenPoint(J));let L={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching,rolling:this._rolling},w=this.cameraHelper.handleEaseTo(c,{bearing:g,pitch:u,roll:G,padding:Y,around:J,aroundPoint:S,offsetAsPoint:y,offset:e.offset,zoom:e.zoom,center:e.center});return this._rotating=this._rotating||r!==g,this._pitching=this._pitching||u!==W,this._rolling=this._rolling||G!==h,this._padding=!c.isPaddingEqual(Y),this._zooming=this._zooming||w.isZooming,this._easeId=e.easeId,this._prepareEase(a,e.noMoveStart,L),this.terrain&&this._prepareElevation(w.elevationCenter),this._ease((v=>{w.easeFunc(v),this.terrain&&!e.freezeElevation&&this._updateElevation(v),this._applyUpdatedTransform(c),this._fireMoveEvents(a)}),(v=>{this.terrain&&e.freezeElevation&&this._finalizeElevation(),this._afterEase(a,v)}),e),this}_prepareEase(e,a,c={}){this._moving=!0,a||c.moving||this.fire(new o.l("movestart",e)),this._zooming&&!c.zooming&&this.fire(new o.l("zoomstart",e)),this._rotating&&!c.rotating&&this.fire(new o.l("rotatestart",e)),this._pitching&&!c.pitching&&this.fire(new o.l("pitchstart",e)),this._rolling&&!c.rolling&&this.fire(new o.l("rollstart",e))}_prepareElevation(e){this._elevationCenter=e,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(e,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(e){this._elevationStart!==void 0&&this._elevationCenter!==void 0||this._prepareElevation(this.transform.center),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom));let a=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(e<1&&a!==this._elevationTarget){let c=this._elevationTarget-this._elevationStart;this._elevationStart+=e*(c-(a-(c*e+this._elevationStart))/(1-e)),this._elevationTarget=a}this.transform.setElevation(o.G.number(this._elevationStart,this._elevationTarget,e))}_finalizeElevation(){this._elevationFreeze=!1,this.getCenterClampedToGround()&&this.transform.recalculateZoomAndCenter(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate||this.terrain?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_elevateCameraIfInsideTerrain(e){if(!this.terrain&&e.elevation>=0&&e.pitch<=90)return{};let a=e.getCameraLngLat(),c=e.getCameraAltitude(),r=this.terrain?this.terrain.getElevationForLngLatZoom(a,e.zoom):0;if(c<r){let W=this.calculateCameraOptionsFromTo(a,r,e.center,e.elevation);return{pitch:W.pitch,zoom:W.zoom}}return{}}_applyUpdatedTransform(e){let a=[];if(a.push((r=>this._elevateCameraIfInsideTerrain(r))),this.transformCameraUpdate&&a.push((r=>this.transformCameraUpdate(r))),!a.length)return;let c=e.clone();for(let r of a){let W=c.clone(),{center:h,zoom:g,roll:u,pitch:G,bearing:Y,elevation:y}=r(W);h&&W.setCenter(h),y!==void 0&&W.setElevation(y),g!==void 0&&W.setZoom(g),u!==void 0&&W.setRoll(u),G!==void 0&&W.setPitch(G),Y!==void 0&&W.setBearing(Y),c.apply(W)}this.transform.apply(c)}_fireMoveEvents(e){this.fire(new o.l("move",e)),this._zooming&&this.fire(new o.l("zoom",e)),this._rotating&&this.fire(new o.l("rotate",e)),this._pitching&&this.fire(new o.l("pitch",e)),this._rolling&&this.fire(new o.l("roll",e))}_afterEase(e,a){if(this._easeId&&a&&this._easeId===a)return;delete this._easeId;let c=this._zooming,r=this._rotating,W=this._pitching,h=this._rolling;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._rolling=!1,this._padding=!1,c&&this.fire(new o.l("zoomend",e)),r&&this.fire(new o.l("rotateend",e)),W&&this.fire(new o.l("pitchend",e)),h&&this.fire(new o.l("rollend",e)),this.fire(new o.l("moveend",e))}flyTo(e,a){if(!e.essential&&ft.prefersReducedMotion){let Zt=o.U(e,["center","zoom","bearing","pitch","roll","elevation","padding"]);return this.jumpTo(Zt,a)}this.stop(),e=o.e({offset:[0,0],speed:1.2,curve:1.42,easing:o.cx},e);let c=this._getTransformForUpdate(),r=c.bearing,W=c.pitch,h=c.roll,g=c.padding,u="bearing"in e?this._normalizeBearing(e.bearing,r):r,G="pitch"in e?+e.pitch:W,Y="roll"in e?this._normalizeBearing(e.roll,h):h,y="padding"in e?e.padding:c.padding,J=o.P.convert(e.offset),S=c.centerPoint.add(J),L=c.screenPointToLocation(S),w=this.cameraHelper.handleFlyTo(c,{bearing:u,pitch:G,roll:Y,padding:y,locationAtOffset:L,offsetAsPoint:J,center:e.center,minZoom:e.minZoom,zoom:e.zoom}),v=e.curve,O=Math.max(c.width,c.height),K=O/w.scaleOfZoom,tt=w.pixelPathLength;typeof w.scaleOfMinZoom=="number"&&(v=Math.sqrt(O/w.scaleOfMinZoom/tt*2));let _=v*v;function et(Zt){let Jt=(K*K-O*O+(Zt?-1:1)*_*_*tt*tt)/(2*(Zt?K:O)*_*tt);return Math.log(Math.sqrt(Jt*Jt+1)-Jt)}function it(Zt){return(Math.exp(Zt)-Math.exp(-Zt))/2}function q(Zt){return(Math.exp(Zt)+Math.exp(-Zt))/2}let ct=et(!1),ht=function(Zt){return q(ct)/q(ct+v*Zt)},bt=function(Zt){return O*((q(ct)*(it(Jt=ct+v*Zt)/q(Jt))-it(ct))/_)/tt;var Jt},mt=(et(!0)-ct)/v;if(Math.abs(tt)<2e-6||!isFinite(mt)){if(Math.abs(O-K)<1e-6)return this.easeTo(e,a);let Zt=K<O?-1:1;mt=Math.abs(Math.log(K/O))/v,bt=()=>0,ht=Jt=>Math.exp(Zt*v*Jt)}return e.duration="duration"in e?+e.duration:1e3*mt/("screenSpeed"in e?+e.screenSpeed/v:+e.speed),e.maxDuration&&e.duration>e.maxDuration&&(e.duration=0),this._zooming=!0,this._rotating=r!==u,this._pitching=G!==W,this._rolling=Y!==h,this._padding=!c.isPaddingEqual(y),this._prepareEase(a,!1),this.terrain&&this._prepareElevation(w.targetCenter),this._ease((Zt=>{let Jt=Zt*mt,Yt=1/ht(Jt),Gt=bt(Jt);this._rotating&&c.setBearing(o.G.number(r,u,Zt)),this._pitching&&c.setPitch(o.G.number(W,G,Zt)),this._rolling&&c.setRoll(o.G.number(h,Y,Zt)),this._padding&&(c.interpolatePadding(g,y,Zt),S=c.centerPoint.add(J)),w.easeFunc(Zt,Yt,Gt,S),this.terrain&&!e.freezeElevation&&this._updateElevation(Zt),this._applyUpdatedTransform(c),this._fireMoveEvents(a)}),(()=>{this.terrain&&e.freezeElevation&&this._finalizeElevation(),this._afterEase(a)}),e),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(e,a){var c;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){let r=this._onEaseEnd;delete this._onEaseEnd,r.call(this,a)}return e||(c=this.handlers)===null||c===void 0||c.stop(!1),this}_ease(e,a,c){c.animate===!1||c.duration===0?(e(1),a()):(this._easeStart=Ct(),this._easeOptions=c,this._onEaseFrame=e,this._onEaseEnd=a,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(e,a){e=o.W(e,-180,180);let c=Math.abs(e-a);return Math.abs(e-360-a)<c&&(e-=360),Math.abs(e+360-a)<c&&(e+=360),e}queryTerrainElevation(e){return this.terrain?this.terrain.getElevationForLngLatZoom(o.V.convert(e),this.transform.tileZoom):null}}let Dd={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class Dl{constructor(e=Dd){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=a=>{!a||a.sourceDataType!=="metadata"&&a.sourceDataType!=="visibility"&&a.dataType!=="style"&&a.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=e}getDefaultPosition(){return"bottom-right"}onAdd(e){return this._map=e,this._compact=this.options.compact,this._container=rt.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=rt.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=rt.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){rt.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(e,a){let c=this._map._getUIString(`AttributionControl.${a}`);e.title=c,e.setAttribute("aria-label",c)}_updateAttributions(){if(!this._map.style)return;let e=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?e=e.concat(this.options.customAttribution.map((r=>typeof r!="string"?"":r))):typeof this.options.customAttribution=="string"&&e.push(this.options.customAttribution)),this._map.style.stylesheet){let r=this._map.style.stylesheet;this.styleOwner=r.owner,this.styleId=r.id}let a=this._map.style.tileManagers;for(let r in a){let W=a[r];if(W.used||W.usedForTerrain){let h=W.getSource();h.attribution&&e.indexOf(h.attribution)<0&&e.push(h.attribution)}}e=e.filter((r=>String(r).trim())),e.sort(((r,W)=>r.length-W.length)),e=e.filter(((r,W)=>{for(let h=W+1;h<e.length;h++)if(e[h].indexOf(r)>=0)return!1;return!0}));let c=e.join(" | ");c!==this._attribHTML&&(this._attribHTML=c,e.length?(this._innerContainer.innerHTML=rt.sanitize(c),this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class Ci{constructor(e={}){this._updateCompact=()=>{let a=this._container.children;if(a.length){let c=a[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&c.classList.add("maplibregl-compact"):c.classList.remove("maplibregl-compact")}},this.options=e}getDefaultPosition(){return"bottom-left"}onAdd(e){this._map=e,this._compact=this.options&&this.options.compact,this._container=rt.create("div","maplibregl-ctrl");let a=rt.create("a","maplibregl-ctrl-logo");return a.target="_blank",a.rel="noopener nofollow",a.href="https://maplibre.org/",a.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),a.setAttribute("rel","noopener nofollow"),this._container.appendChild(a),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){rt.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class U0{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(e){let a=++this._id;return this._queue.push({callback:e,id:a,cancelled:!1}),a}remove(e){let a=this._currentlyRunning,c=a?this._queue.concat(a):this._queue;for(let r of c)if(r.id===e)return void(r.cancelled=!0)}run(e=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");let a=this._currentlyRunning=this._queue;this._queue=[];for(let c of a)if(!c.cancelled&&(c.callback(e),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var em=o.aT([{name:"a_pos3d",type:"Int16",components:3}]);class lm extends o.E{constructor(e){super(),this._lastTilesetChange=Ct(),this.tileManager=e,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.deltaZoom=1,this.tileSize=e._source.tileSize*2**this.deltaZoom,e.usedForTerrain=!0,e.tileSize=this.tileSize}destruct(){this.tileManager.usedForTerrain=!1,this.tileManager.tileSize=null}getSource(){return this.tileManager._source}update(e,a){this.tileManager.update(e,a),this._renderableTilesKeys=[];let c={};for(let r of ie(e,{tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:a,calculateTileZoom:this.tileManager._source.calculateTileZoom}))c[r.key]=!0,this._renderableTilesKeys.push(r.key),this._tiles[r.key]||(r.terrainRttPosMatrix32f=new Float64Array(16),o.c6(r.terrainRttPosMatrix32f,0,o.a4,o.a4,0,0,1),this._tiles[r.key]=new Q(r,this.tileSize),this._lastTilesetChange=Ct());for(let r in this._tiles)c[r]||delete this._tiles[r]}freeRtt(e){for(let a in this._tiles){let c=this._tiles[a];(!e||c.tileID.equals(e)||c.tileID.isChildOf(e)||e.isChildOf(c.tileID))&&(c.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map((e=>this.getTileByID(e)))}getTileByID(e){return this._tiles[e]}getTerrainCoords(e,a){return a?this._getTerrainCoordsForTileRanges(e,a):this._getTerrainCoordsForRegularTile(e)}_getTerrainCoordsForRegularTile(e){let a={};for(let c of this._renderableTilesKeys){let r=this._tiles[c].tileID,W=e.clone(),h=o.bj();if(r.canonical.equals(e.canonical))o.c6(h,0,o.a4,o.a4,0,0,1);else if(r.canonical.isChildOf(e.canonical)){let g=r.canonical.z-e.canonical.z,u=r.canonical.x-(r.canonical.x>>g<<g),G=r.canonical.y-(r.canonical.y>>g<<g),Y=o.a4>>g;o.c6(h,0,Y,Y,0,0,1),o.O(h,h,[-u*Y,-G*Y,0])}else{if(!e.canonical.isChildOf(r.canonical))continue;{let g=e.canonical.z-r.canonical.z,u=e.canonical.x-(e.canonical.x>>g<<g),G=e.canonical.y-(e.canonical.y>>g<<g),Y=o.a4>>g;o.c6(h,0,o.a4,o.a4,0,0,1),o.O(h,h,[u*Y,G*Y,0]),o.Q(h,h,[1/2**g,1/2**g,0])}}W.terrainRttPosMatrix32f=new Float32Array(h),a[c]=W}return a}_getTerrainCoordsForTileRanges(e,a){let c={};for(let r of this._renderableTilesKeys){let W=this._tiles[r].tileID;if(!this._isWithinTileRanges(W,a))continue;let h=e.clone(),g=o.bj();if(W.canonical.z===e.canonical.z){let u=e.canonical.x-W.canonical.x,G=e.canonical.y-W.canonical.y;o.c6(g,0,o.a4,o.a4,0,0,1),o.O(g,g,[u*o.a4,G*o.a4,0])}else if(W.canonical.z>e.canonical.z){let u=W.canonical.z-e.canonical.z,G=W.canonical.x-(W.canonical.x>>u<<u),Y=W.canonical.y-(W.canonical.y>>u<<u),y=e.canonical.x-(W.canonical.x>>u),J=e.canonical.y-(W.canonical.y>>u),S=o.a4>>u;o.c6(g,0,S,S,0,0,1),o.O(g,g,[-G*S+y*o.a4,-Y*S+J*o.a4,0])}else{let u=e.canonical.z-W.canonical.z,G=e.canonical.x-(e.canonical.x>>u<<u),Y=e.canonical.y-(e.canonical.y>>u<<u),y=(e.canonical.x>>u)-W.canonical.x,J=(e.canonical.y>>u)-W.canonical.y,S=o.a4<<u;o.c6(g,0,S,S,0,0,1),o.O(g,g,[G*o.a4+y*S,Y*o.a4+J*S,0])}h.terrainRttPosMatrix32f=new Float32Array(g),c[r]=h}return c}getSourceTile(e,a){let c=this.tileManager._source,r=e.overscaledZ-this.deltaZoom;if(r>c.maxzoom&&(r=c.maxzoom),r<c.minzoom)return null;this._sourceTileCache[e.key]||(this._sourceTileCache[e.key]=e.scaledTo(r).key);let W=this.tileManager.getTileByID(this._sourceTileCache[e.key]);if((!W||!W.dem)&&a)for(;r>=c.minzoom&&(!W||!W.dem);)W=this.tileManager.getTileByID(e.scaledTo(r--).key);return W}anyTilesAfterTime(e=Date.now()){return this._lastTilesetChange>=e}_isWithinTileRanges(e,a){return a[e.canonical.z]&&e.canonical.x>=a[e.canonical.z].minTileX&&e.canonical.x<=a[e.canonical.z].maxTileX&&e.canonical.y>=a[e.canonical.z].minTileY&&e.canonical.y<=a[e.canonical.z].maxTileY}}class im{constructor(e,a,c){this._meshCache={},this.painter=e,this.tileManager=new lm(a),this.options=c,this.exaggeration=typeof c.exaggeration=="number"?c.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(e,a,c,r=o.a4){var W;if(!(a>=0&&a<r&&c>=0&&c<r))return 0;let h=this.getTerrainData(e),g=(W=h.tile)===null||W===void 0?void 0:W.dem;if(!g)return 0;let u=o.cB([],[a/r*o.a4,c/r*o.a4],h.u_terrain_matrix),G=[u[0]*g.dim,u[1]*g.dim],Y=Math.floor(G[0]),y=Math.floor(G[1]),J=G[0]-Y,S=G[1]-y;return g.get(Y,y)*(1-J)*(1-S)+g.get(Y+1,y)*J*(1-S)+g.get(Y,y+1)*(1-J)*S+g.get(Y+1,y+1)*J*S}getElevationForLngLatZoom(e,a){if(!o.cC(a,e.wrap()))return 0;let{tileID:c,mercatorX:r,mercatorY:W}=this._getOverscaledTileIDFromLngLatZoom(e,a);return this.getElevation(c,r%o.a4,W%o.a4,o.a4)}getElevation(e,a,c,r=o.a4){return this.getDEMElevation(e,a,c,r)*this.exaggeration}getTerrainData(e){if(!this._emptyDemTexture){let r=this.painter.context,W=new o.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new o.T(r,W,r.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new o.T(r,new o.R({width:1,height:1}),r.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(r.gl.NEAREST,r.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=o.ar([])}let a=this.tileManager.getSourceTile(e,!0);if(a&&a.dem&&(!a.demTexture||a.needsTerrainPrepare)){let r=this.painter.context;a.demTexture=this.painter.getTileTexture(a.dem.stride),a.demTexture?a.demTexture.update(a.dem.getPixels(),{premultiply:!1}):a.demTexture=new o.T(r,a.dem.getPixels(),r.gl.RGBA,{premultiply:!1}),a.demTexture.bind(r.gl.NEAREST,r.gl.CLAMP_TO_EDGE),a.needsTerrainPrepare=!1}let c=a&&a+a.tileID.key+e.key;if(c&&!this._demMatrixCache[c]){let r=this.tileManager.getSource().maxzoom,W=e.canonical.z-a.tileID.canonical.z;e.overscaledZ>e.canonical.z&&(e.canonical.z>=r?W=e.canonical.z-r:o.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));let h=e.canonical.x-(e.canonical.x>>W<<W),g=e.canonical.y-(e.canonical.y>>W<<W),u=o.cD(new Float64Array(16),[1/(o.a4<<W),1/(o.a4<<W),0]);o.O(u,u,[h*o.a4,g*o.a4,0]),this._demMatrixCache[e.key]={matrix:u,coord:e}}return{u_depth:2,u_terrain:3,u_terrain_dim:a&&a.dem&&a.dem.dim||1,u_terrain_matrix:c?this._demMatrixCache[e.key].matrix:this._emptyDemMatrix,u_terrain_unpack:a&&a.dem&&a.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(a&&a.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:a}}getFramebuffer(e){let a=this.painter,c=a.width/devicePixelRatio,r=a.height/devicePixelRatio;return!this._fbo||this._fbo.width===c&&this._fbo.height===r||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new o.T(a.context,{width:c,height:r,data:null},a.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(a.context.gl.NEAREST,a.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new o.T(a.context,{width:c,height:r,data:null},a.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(a.context.gl.NEAREST,a.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=a.context.createFramebuffer(c,r,!0,!1),this._fbo.depthAttachment.set(a.context.createRenderbuffer(a.context.gl.DEPTH_COMPONENT16,c,r))),this._fbo.colorAttachment.set(e==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){let e=this.painter.context;if(this._coordsTexture)return this._coordsTexture;let a=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let W=0,h=0;W<this._coordsTextureSize;W++)for(let g=0;g<this._coordsTextureSize;g++,h+=4)a[h+0]=255&g,a[h+1]=255&W,a[h+2]=g>>8<<4|W>>8,a[h+3]=0;let c=new o.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(a.buffer)),r=new o.T(e,c,e.gl.RGBA,{premultiply:!1});return r.bind(e.gl.NEAREST,e.gl.CLAMP_TO_EDGE),this._coordsTexture=r,r}pointCoordinate(e){this.painter.maybeDrawDepthAndCoords(!0);let a=new Uint8Array(4),c=this.painter.context,r=c.gl,W=Math.round(e.x*this.painter.pixelRatio/devicePixelRatio),h=Math.round(e.y*this.painter.pixelRatio/devicePixelRatio),g=Math.round(this.painter.height/devicePixelRatio);c.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),r.readPixels(W,g-h-1,1,1,r.RGBA,r.UNSIGNED_BYTE,a),c.bindFramebuffer.set(null);let u=a[0]+(a[2]>>4<<8),G=a[1]+((15&a[2])<<8),Y=this.coordsIndex[255-a[3]],y=Y&&this.tileManager.getTileByID(Y);if(!y)return null;let J=this._coordsTextureSize,S=(1<<y.tileID.canonical.z)*J;return new o.aa((y.tileID.canonical.x*J+u)/S+y.tileID.wrap,(y.tileID.canonical.y*J+G)/S,this.getElevation(y.tileID,u,G,J))}depthAtPoint(e){let a=new Uint8Array(4),c=this.painter.context,r=c.gl;return c.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),r.readPixels(e.x,this.painter.height/devicePixelRatio-e.y-1,1,1,r.RGBA,r.UNSIGNED_BYTE,a),c.bindFramebuffer.set(null),(a[0]/16777216+a[1]/65536+a[2]/256+a[3])/256}getTerrainMesh(e){var a;let c=((a=this.painter.style.projection)===null||a===void 0?void 0:a.transitionState)>0,r=c&&e.canonical.y===0,W=c&&e.canonical.y===(1<<e.canonical.z)-1,h=`m_${r?"n":""}_${W?"s":""}`;if(this._meshCache[h])return this._meshCache[h];let g=this.painter.context,u=new o.cE,G=new o.aX,Y=this.meshSize,y=o.a4/Y,J=Y*Y;for(let q=0;q<=Y;q++)for(let ct=0;ct<=Y;ct++)u.emplaceBack(ct*y,q*y,0);for(let q=0;q<J;q+=Y+1)for(let ct=0;ct<Y;ct++)G.emplaceBack(ct+q,Y+ct+q+1,Y+ct+q+2),G.emplaceBack(ct+q,Y+ct+q+2,ct+q+1);let S=u.length,L=S+(Y+1),w=(Y+1)*Y,v=r?o.bq:0,O=r?0:1,K=W?o.br:o.a4,tt=W?0:1;for(let q=0;q<=Y;q++)u.emplaceBack(q*y,v,O);for(let q=0;q<=Y;q++)u.emplaceBack(q*y,K,tt);for(let q=0;q<Y;q++)G.emplaceBack(w+q,L+q,L+q+1),G.emplaceBack(w+q,L+q+1,w+q+1),G.emplaceBack(0+q,S+q+1,S+q),G.emplaceBack(0+q,0+q+1,S+q+1);let _=u.length,et=_+2*(Y+1);for(let q of[0,1])for(let ct=0;ct<=Y;ct++)for(let ht of[0,1])u.emplaceBack(q*o.a4,ct*y,ht);for(let q=0;q<2*Y;q+=2)G.emplaceBack(_+q,_+q+1,_+q+3),G.emplaceBack(_+q,_+q+3,_+q+2),G.emplaceBack(et+q,et+q+3,et+q+1),G.emplaceBack(et+q,et+q+2,et+q+3);let it=new va(g.createVertexBuffer(u,em.members),g.createIndexBuffer(G),o.aW.simpleSegment(0,0,u.length,G.length));return this._meshCache[h]=it,it}getMeshFrameDelta(e){return 2*Math.PI*o.bD/Math.pow(2,Math.max(e,0))/5}getMinTileElevationForLngLatZoom(e,a){var c;let{tileID:r}=this._getOverscaledTileIDFromLngLatZoom(e,a);return(c=this.getMinMaxElevation(r).minElevation)!==null&&c!==void 0?c:0}getMinMaxElevation(e){let a=this.getTerrainData(e).tile,c={minElevation:null,maxElevation:null};return a&&a.dem&&(c.minElevation=a.dem.min*this.exaggeration,c.maxElevation=a.dem.max*this.exaggeration),c}_getOverscaledTileIDFromLngLatZoom(e,a){let c=o.aa.fromLngLat(e.wrap()),r=(1<<a)*o.a4,W=c.x*r,h=c.y*r,g=Math.floor(W/o.a4),u=Math.floor(h/o.a4);return{tileID:new o.a1(a,0,a,g,u),mercatorX:W,mercatorY:h}}}class Od{constructor(e,a,c){this._context=e,this._size=a,this._tileSize=c,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(let e of this._objects)e.texture.destroy(),e.fbo.destroy()}_createObject(e){let a=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),c=new o.T(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return c.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),this._context.extTextureFilterAnisotropic&&this._context.gl.texParameterf(this._context.gl.TEXTURE_2D,this._context.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,this._context.extTextureFilterAnisotropicMax),a.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),a.colorAttachment.set(c.texture),{id:e,fbo:a,texture:c,stamp:-1,inUse:!1}}getObjectForId(e){return this._objects[e]}useObject(e){e.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter((a=>e.id!==a)),this._recentlyUsed.push(e.id)}stampObject(e){e.stamp=++this._stamp}getOrCreateFreeObject(){for(let a of this._recentlyUsed)if(!this._objects[a].inUse)return this._objects[a];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");let e=this._createObject(this._objects.length);return this._objects.push(e),e}freeObject(e){e.inUse=!1}freeAllObjects(){for(let e of this._objects)this.freeObject(e)}isFull(){return!(this._objects.length<this._size)&&this._objects.some((e=>!e.inUse))===!1}}let Ne={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0,"color-relief":!0};class il{constructor(e,a){this.painter=e,this.terrain=a,this.pool=new Od(e.context,30,a.tileManager.tileSize*a.qualityFactor)}destruct(){this.pool.destruct()}getTexture(e){return this.pool.getObjectForId(e.rtt[this._stacks.length-1].id).texture}prepareForRender(e,a){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.tileManager.getRenderableTiles(),this._renderableLayerIds=e._order.filter((c=>!e._layers[c].isHidden(a))),this._coordsAscending={};for(let c in e.tileManagers){this._coordsAscending[c]={};let r=e.tileManagers[c].getVisibleCoordinates(),W=e.tileManagers[c].getSource(),h=W instanceof Ql?W.terrainTileRanges:null;for(let g of r){let u=this.terrain.tileManager.getTerrainCoords(g,h);for(let G in u)this._coordsAscending[c][G]||(this._coordsAscending[c][G]=[]),this._coordsAscending[c][G].push(u[G])}}this._coordsAscendingStr={};for(let c of e._order){let r=e._layers[c],W=r.source;if(Ne[r.type]&&!this._coordsAscendingStr[W]){this._coordsAscendingStr[W]={};for(let h in this._coordsAscending[W])this._coordsAscendingStr[W][h]=this._coordsAscending[W][h].map((g=>g.key)).sort().join()}}for(let c of this._renderableTiles)for(let r in this._coordsAscendingStr){let W=this._coordsAscendingStr[r][c.tileID.key];W&&W!==c.rttCoords[r]&&(c.rtt=[])}}renderLayer(e,a){if(e.isHidden(this.painter.transform.zoom))return!1;let c=Object.assign(Object.assign({},a),{isRenderingToTexture:!0}),r=e.type,W=this.painter,h=this._renderableLayerIds[this._renderableLayerIds.length-1]===e.id;if(Ne[r]&&(this._prevType&&Ne[this._prevType]||this._stacks.push([]),this._prevType=r,this._stacks[this._stacks.length-1].push(e.id),!h))return!0;if(Ne[this._prevType]||Ne[r]&&h){this._prevType=r;let g=this._stacks.length-1,u=this._stacks[g]||[];for(let G of this._renderableTiles){if(this.pool.isFull()&&(fa(this.painter,this.terrain,this._rttTiles,c),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(G),G.rtt[g]){let y=this.pool.getObjectForId(G.rtt[g].id);if(y.stamp===G.rtt[g].stamp){this.pool.useObject(y);continue}}let Y=this.pool.getOrCreateFreeObject();this.pool.useObject(Y),this.pool.stampObject(Y),G.rtt[g]={id:Y.id,stamp:Y.stamp},W.context.bindFramebuffer.set(Y.fbo.framebuffer),W.context.clear({color:o.bo.transparent,stencil:0}),W.currentStencilSource=void 0;for(let y=0;y<u.length;y++){let J=W.style._layers[u[y]],S=J.source?this._coordsAscending[J.source][G.tileID.key]:[G.tileID];W.context.viewport.set([0,0,Y.fbo.width,Y.fbo.height]),W._renderTileClippingMasks(J,S,!0),W.renderLayer(W,W.style.tileManagers[J.source],J,S,c),J.source&&(G.rttCoords[J.source]=this._coordsAscendingStr[J.source][G.tileID.key])}}return fa(this.painter,this.terrain,this._rttTiles,c),this._rttTiles=[],this.pool.freeAllObjects(),Ne[r]}return!1}}let M0={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","Map.Title":"Map","Marker.Title":"Map marker","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","Popup.Close":"Close popup","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","GlobeControl.Enable":"Enable globe","GlobeControl.Disable":"Disable globe","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use \u2318 + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},fd=lt,_d={hash:!1,interactive:!0,bearingSnap:7,attributionControl:Dd,maplibreLogo:!1,refreshExpiredTiles:!0,canvasContextAttributes:{antialias:!1,preserveDrawingBuffer:!1,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,desynchronized:!1,contextType:void 0},scrollZoom:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],elevation:0,zoom:0,bearing:0,pitch:0,roll:0,renderWorldCopies:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:o.a.MAX_TILE_CACHE_ZOOM_LEVELS,transformRequest:null,transformCameraUpdate:null,transformConstrain:null,fadeDuration:300,crossSourceCollisions:!0,clickTolerance:3,localIdeographFontFamily:"sans-serif",pitchWithRotate:!0,rollEnabled:!1,reduceMotion:void 0,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0,centerClampedToGround:!0,experimentalZoomLevelsToOverscale:void 0},ys={showCompass:!0,showZoom:!0,visualizePitch:!1,visualizeRoll:!0};class Bs{constructor(e,a,c=!1){this.mousedown=W=>{this.startMove(W,rt.mousePos(this.element,W)),rt.addEventListener(window,"mousemove",this.mousemove),rt.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=W=>{this.move(W,rt.mousePos(this.element,W))},this.mouseup=W=>{this._rotatePitchHandler.dragEnd(W),this.offTemp()},this.touchstart=W=>{W.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=rt.touchPos(this.element,W.targetTouches)[0],this.startMove(W,this._startPos),rt.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),rt.addEventListener(window,"touchend",this.touchend))},this.touchmove=W=>{W.targetTouches.length!==1?this.reset():(this._lastPos=rt.touchPos(this.element,W.targetTouches)[0],this.move(W,this._lastPos))},this.touchend=W=>{W.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this._rotatePitchHandler.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10,this.element=a;let r=new qb;this._rotatePitchHandler=new td({clickTolerance:3,move:(W,h)=>{let g=a.getBoundingClientRect(),u=new o.P((g.bottom-g.top)/2,(g.right-g.left)/2);return{bearingDelta:o.cw(new o.P(W.x,h.y),h,u),pitchDelta:c?-.5*(h.y-W.y):void 0}},moveStateManager:r,enable:!0,assignEvents:()=>{}}),this.map=e,rt.addEventListener(a,"mousedown",this.mousedown),rt.addEventListener(a,"touchstart",this.touchstart,{passive:!1}),rt.addEventListener(a,"touchcancel",this.reset)}startMove(e,a){this._rotatePitchHandler.dragStart(e,a),rt.disableDrag()}move(e,a){let c=this.map,{bearingDelta:r,pitchDelta:W}=this._rotatePitchHandler.dragMove(e,a)||{};r&&c.setBearing(c.getBearing()+r),W&&c.setPitch(c.getPitch()+W)}off(){let e=this.element;rt.removeEventListener(e,"mousedown",this.mousedown),rt.removeEventListener(e,"touchstart",this.touchstart,{passive:!1}),rt.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),rt.removeEventListener(window,"touchend",this.touchend),rt.removeEventListener(e,"touchcancel",this.reset),this.offTemp()}offTemp(){rt.enableDrag(),rt.removeEventListener(window,"mousemove",this.mousemove),rt.removeEventListener(window,"mouseup",this.mouseup),rt.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),rt.removeEventListener(window,"touchend",this.touchend)}}let Ma;function ld(m,e,a,c=!1){if(c||!a.getCoveringTilesDetailsProvider().allowWorldCopies())return m?.wrap();let r=new o.V(m.lng,m.lat);if(m=new o.V(m.lng,m.lat),e){let W=new o.V(m.lng-360,m.lat),h=new o.V(m.lng+360,m.lat),g=a.locationToScreenPoint(m).distSqr(e);a.locationToScreenPoint(W).distSqr(e)<g?m=W:a.locationToScreenPoint(h).distSqr(e)<g&&(m=h)}for(;Math.abs(m.lng-a.center.lng)>180;){let W=a.locationToScreenPoint(m);if(W.x>=0&&W.y>=0&&W.x<=a.width&&W.y<=a.height)break;m.lng>a.center.lng?m.lng-=360:m.lng+=360}return m.lng!==r.lng&&a.isPointOnMapSurface(a.locationToScreenPoint(m))?m:r}let Kd={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function qc(m,e,a){let c=m.classList;for(let r in Kd)c.remove(`maplibregl-${a}-anchor-${r}`);c.add(`maplibregl-${a}-anchor-${e}`)}class Pd extends o.E{constructor(e){if(super(),this._onKeyPress=a=>{let c=a.code,r=a.charCode||a.keyCode;c!=="Space"&&c!=="Enter"&&r!==32&&r!==13||this.togglePopup()},this._onMapClick=a=>{let c=a.originalEvent.target,r=this._element;this._popup&&(c===r||r.contains(c))&&this.togglePopup()},this._update=a=>{if(!this._map)return;let c=this._map.loaded()&&!this._map.isMoving();(a?.type==="terrain"||a?.type==="render"&&!c)&&this._map.once("render",this._update),this._lngLat=ld(this._lngLat,this._flatPos,this._map.transform),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationToScreenPoint(this._lngLat)._add(this._offset));let r="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?r=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(r=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let W="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?W="rotateX(0deg)":this._pitchAlignment==="map"&&(W=`rotateX(${this._map.getPitch()}deg)`),this._subpixelPositioning||a&&a.type!=="moveend"||(this._pos=this._pos.round()),rt.setTransform(this._element,`${Kd[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${W} ${r}`),ft.frameAsync(new AbortController).then((()=>{this._updateOpacity(a&&a.type==="moveend")})).catch((()=>{}))},this._onMove=a=>{if(!this._isDragging){let c=this._clickTolerance||this._map._clickTolerance;this._isDragging=a.point.dist(this._pointerdownPos)>=c}this._isDragging&&(this._pos=a.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new o.l("dragstart"))),this.fire(new o.l("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new o.l("dragend")),this._state="inactive"},this._addDragHandler=a=>{this._element.contains(a.originalEvent.target)&&(a.preventDefault(),this._positionDelta=a.point.sub(this._pos).add(this._offset),this._pointerdownPos=a.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=e&&e.anchor||"center",this._color=e&&e.color||"#3FB1CE",this._scale=e&&e.scale||1,this._draggable=e&&e.draggable||!1,this._clickTolerance=e&&e.clickTolerance||0,this._subpixelPositioning=e&&e.subpixelPositioning||!1,this._isDragging=!1,this._state="inactive",this._rotation=e&&e.rotation||0,this._rotationAlignment=e&&e.rotationAlignment||"auto",this._pitchAlignment=e&&e.pitchAlignment&&e.pitchAlignment!=="auto"?e.pitchAlignment:this._rotationAlignment,this.setOpacity(e?.opacity,e?.opacityWhenCovered),e&&e.element)this._element=e.element,this._offset=o.P.convert(e&&e.offset||[0,0]);else{this._defaultMarker=!0,this._element=rt.create("div");let a=rt.createNS("http://www.w3.org/2000/svg","svg"),c=41,r=27;a.setAttributeNS(null,"display","block"),a.setAttributeNS(null,"height",`${c}px`),a.setAttributeNS(null,"width",`${r}px`),a.setAttributeNS(null,"viewBox",`0 0 ${r} ${c}`);let W=rt.createNS("http://www.w3.org/2000/svg","g");W.setAttributeNS(null,"stroke","none"),W.setAttributeNS(null,"stroke-width","1"),W.setAttributeNS(null,"fill","none"),W.setAttributeNS(null,"fill-rule","evenodd");let h=rt.createNS("http://www.w3.org/2000/svg","g");h.setAttributeNS(null,"fill-rule","nonzero");let g=rt.createNS("http://www.w3.org/2000/svg","g");g.setAttributeNS(null,"transform","translate(3.0, 29.0)"),g.setAttributeNS(null,"fill","#000000");let u=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(let O of u){let K=rt.createNS("http://www.w3.org/2000/svg","ellipse");K.setAttributeNS(null,"opacity","0.04"),K.setAttributeNS(null,"cx","10.5"),K.setAttributeNS(null,"cy","5.80029008"),K.setAttributeNS(null,"rx",O.rx),K.setAttributeNS(null,"ry",O.ry),g.appendChild(K)}let G=rt.createNS("http://www.w3.org/2000/svg","g");G.setAttributeNS(null,"fill",this._color);let Y=rt.createNS("http://www.w3.org/2000/svg","path");Y.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),G.appendChild(Y);let y=rt.createNS("http://www.w3.org/2000/svg","g");y.setAttributeNS(null,"opacity","0.25"),y.setAttributeNS(null,"fill","#000000");let J=rt.createNS("http://www.w3.org/2000/svg","path");J.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),y.appendChild(J);let S=rt.createNS("http://www.w3.org/2000/svg","g");S.setAttributeNS(null,"transform","translate(6.0, 7.0)"),S.setAttributeNS(null,"fill","#FFFFFF");let L=rt.createNS("http://www.w3.org/2000/svg","g");L.setAttributeNS(null,"transform","translate(8.0, 8.0)");let w=rt.createNS("http://www.w3.org/2000/svg","circle");w.setAttributeNS(null,"fill","#000000"),w.setAttributeNS(null,"opacity","0.25"),w.setAttributeNS(null,"cx","5.5"),w.setAttributeNS(null,"cy","5.5"),w.setAttributeNS(null,"r","5.4999962");let v=rt.createNS("http://www.w3.org/2000/svg","circle");v.setAttributeNS(null,"fill","#FFFFFF"),v.setAttributeNS(null,"cx","5.5"),v.setAttributeNS(null,"cy","5.5"),v.setAttributeNS(null,"r","5.4999962"),L.appendChild(w),L.appendChild(v),h.appendChild(g),h.appendChild(G),h.appendChild(y),h.appendChild(S),h.appendChild(L),a.appendChild(h),a.setAttributeNS(null,"height",c*this._scale+"px"),a.setAttributeNS(null,"width",r*this._scale+"px"),this._element.appendChild(a),this._offset=o.P.convert(e&&e.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",(a=>{a.preventDefault()})),this._element.addEventListener("mousedown",(a=>{a.preventDefault()})),qc(this._element,this._anchor,"marker"),e&&e.className)for(let a of e.className.split(" "))this._element.classList.add(a);this._popup=null}addTo(e){return this.remove(),this._map=e,this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label",e._getUIString("Marker.Title")),this._element.hasAttribute("role")||this._element.setAttribute("role","button"),e.getCanvasContainer().appendChild(this._element),e.on("move",this._update),e.on("moveend",this._update),e.on("terrain",this._update),e.on("projectiontransition",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("terrain",this._update),this._map.off("projectiontransition",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),rt.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(e){return this._lngLat=o.V.convert(e),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(e){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),e){if(!("offset"in e.options)){let r=Math.abs(13.5)/Math.SQRT2;e.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[r,-1*(38.1-13.5+r)],"bottom-right":[-r,-1*(38.1-13.5+r)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=e,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}setSubpixelPositioning(e){return this._subpixelPositioning=e,this}getPopup(){return this._popup}togglePopup(){let e=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:e?(e.isOpen()?e.remove():(e.setLngLat(this._lngLat),e.addTo(this._map)),this):this}_updateOpacity(e=!1){var a,c;let r=(a=this._map)===null||a===void 0?void 0:a.terrain,W=this._map.transform.isLocationOccluded(this._lngLat);if(!r||W){let S=W?this._opacityWhenCovered:this._opacity;return void(this._element.style.opacity!==S&&(this._element.style.opacity=S))}if(e)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout((()=>{this._opacityTimeout=null}),100)}let h=this._map,g=h.terrain.depthAtPoint(this._pos),u=h.terrain.getElevationForLngLatZoom(this._lngLat,h.transform.tileZoom);if(h.transform.lngLatToCameraDepth(this._lngLat,u)-g<.006)return void(this._element.style.opacity=this._opacity);let G=-this._offset.y/h.transform.pixelsPerMeter,Y=Math.sin(h.getPitch()*Math.PI/180)*G,y=h.terrain.depthAtPoint(new o.P(this._pos.x,this._pos.y-this._offset.y)),J=h.transform.lngLatToCameraDepth(this._lngLat,u+Y)-y>.006;!((c=this._popup)===null||c===void 0)&&c.isOpen()&&J&&this._popup.remove(),this._element.style.opacity=J?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(e){return this._offset=o.P.convert(e),this._update(),this}addClassName(e){this._element.classList.add(e)}removeClassName(e){this._element.classList.remove(e)}toggleClassName(e){return this._element.classList.toggle(e)}setDraggable(e){return this._draggable=!!e,this._map&&(e?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(e){return this._rotation=e||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(e){return this._rotationAlignment=e||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(e){return this._pitchAlignment=e&&e!=="auto"?e:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(e,a){return(this._opacity===void 0||e===void 0&&a===void 0)&&(this._opacity="1",this._opacityWhenCovered="0.2"),e!==void 0&&(this._opacity=e),a!==void 0&&(this._opacityWhenCovered=a),this._map&&this._updateOpacity(!0),this}}let Ss={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0},id=0,gn=!1,Cs={maxWidth:100,unit:"metric"};function $c(m,e,a){let c=a&&a.maxWidth||100,r=m._container.clientHeight/2,W=m._container.clientWidth/2,h=m.unproject([W-c/2,r]),g=m.unproject([W+c/2,r]),u=Math.round(m.project(g).x-m.project(h).x),G=Math.min(c,u,m._container.clientWidth),Y=h.distanceTo(g);if(a&&a.unit==="imperial"){let y=3.2808*Y;y>5280?Rn(e,G,y/5280,m._getUIString("ScaleControl.Miles")):Rn(e,G,y,m._getUIString("ScaleControl.Feet"))}else a&&a.unit==="nautical"?Rn(e,G,Y/1852,m._getUIString("ScaleControl.NauticalMiles")):Y>=1e3?Rn(e,G,Y/1e3,m._getUIString("ScaleControl.Kilometers")):Rn(e,G,Y,m._getUIString("ScaleControl.Meters"))}function Rn(m,e,a,c){let r=(function(W){let h=Math.pow(10,`${Math.floor(W)}`.length-1),g=W/h;return g=g>=10?10:g>=5?5:g>=3?3:g>=2?2:g>=1?1:(function(u){let G=Math.pow(10,Math.ceil(-Math.log(u)/Math.LN10));return Math.round(u*G)/G})(g),h*g})(a);m.style.width=e*(r/a)+"px",m.innerHTML=`${r}&nbsp;${c}`}let to={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1,locationOccludedOpacity:void 0},Qs=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function eo(m){if(m){if(typeof m=="number"){let e=Math.round(Math.abs(m)/Math.SQRT2);return{center:new o.P(0,0),top:new o.P(0,m),"top-left":new o.P(e,e),"top-right":new o.P(-e,e),bottom:new o.P(0,-m),"bottom-left":new o.P(e,-e),"bottom-right":new o.P(-e,-e),left:new o.P(m,0),right:new o.P(-m,0)}}if(m instanceof o.P||Array.isArray(m)){let e=o.P.convert(m);return{center:e,top:e,"top-left":e,"top-right":e,bottom:e,"bottom-left":e,"bottom-right":e,left:e,right:e}}return{center:o.P.convert(m.center||[0,0]),top:o.P.convert(m.top||[0,0]),"top-left":o.P.convert(m["top-left"]||[0,0]),"top-right":o.P.convert(m["top-right"]||[0,0]),bottom:o.P.convert(m.bottom||[0,0]),"bottom-left":o.P.convert(m["bottom-left"]||[0,0]),"bottom-right":o.P.convert(m["bottom-right"]||[0,0]),left:o.P.convert(m.left||[0,0]),right:o.P.convert(m.right||[0,0])}}return eo(new o.P(0,0))}let lo=lt;I.AJAXError=o.cI,I.Event=o.l,I.Evented=o.E,I.LngLat=o.V,I.MercatorCoordinate=o.aa,I.Point=o.P,I.addProtocol=o.cJ,I.config=o.a,I.removeProtocol=o.cK,I.AttributionControl=Dl,I.BoxZoomHandler=V0,I.CanvasSource=ja,I.CooperativeGesturesHandler=_i,I.DoubleClickZoomHandler=vd,I.DragPanHandler=Xs,I.DragRotateHandler=Js,I.EdgeInsets=Be,I.FullscreenControl=class extends o.E{constructor(m={}){super(),this._onFullscreenChange=()=>{var e;let a=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((e=a?.shadowRoot)===null||e===void 0)&&e.fullscreenElement;)a=a.shadowRoot.fullscreenElement;a===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,m&&m.container&&(m.container instanceof HTMLElement?this._container=m.container:o.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(m){return this._map=m,this._container||(this._container=this._map.getContainer()),this._controlContainer=rt.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){rt.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){let m=this._fullscreenButton=rt.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);rt.create("span","maplibregl-ctrl-icon",m).setAttribute("aria-hidden","true"),m.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){let m=this._getTitle();this._fullscreenButton.setAttribute("aria-label",m),this._fullscreenButton.title=m}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new o.l("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new o.l("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},I.GeoJSONSource=la,I.GeolocateControl=class extends o.E{constructor(m){super(),this._onSuccess=e=>{if(this._map){if(this._isOutOfMapMaxBounds(e))return this._setErrorState(),this.fire(new o.l("outofmaxbounds",e)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=e,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(e),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(e),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new o.l("geolocate",e)),this._finish()}},this._updateCamera=e=>{let a=new o.V(e.coords.longitude,e.coords.latitude),c=e.coords.accuracy,r=this._map.getBearing(),W=o.e({bearing:r},this.options.fitBoundsOptions),h=Ee.fromLngLat(a,c);this._map.fitBounds(h,W,{geolocateSource:!0})},this._updateMarker=e=>{if(e){let a=new o.V(e.coords.longitude,e.coords.latitude);this._accuracyCircleMarker.setLngLat(a).addTo(this._map),this._userLocationDotMarker.setLngLat(a).addTo(this._map),this._accuracy=e.coords.accuracy,this._updateCircleRadiusIfNeeded()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onUpdate=()=>{this._updateCircleRadiusIfNeeded()},this._onError=e=>{if(this._map){if(e.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;let a=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=a,this._geolocateButton.setAttribute("aria-label",a),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(e.code===3&&gn)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new o.l("error",e)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=()=>{this._map&&(this._container.addEventListener("contextmenu",(e=>e.preventDefault())),this._geolocateButton=rt.create("button","maplibregl-ctrl-geolocate",this._container),rt.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",this._geolocateButton.disabled=!0)},this._finishSetupUI=e=>{if(this._map){if(e===!1){o.w("Geolocation support is not available so the GeolocateControl will be disabled.");let a=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=a,this._geolocateButton.setAttribute("aria-label",a)}else{let a=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=a,this._geolocateButton.setAttribute("aria-label",a)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=rt.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new Pd({element:this._dotElement}),this._circleElement=rt.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Pd({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onUpdate),this._map.on("move",this._onUpdate),this._map.on("rotate",this._onUpdate),this._map.on("pitch",this._onUpdate)),this._geolocateButton.addEventListener("click",(()=>this.trigger())),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",(a=>{let c=a?.[0]instanceof ResizeObserverEntry;a.geolocateSource||this._watchState!=="ACTIVE_LOCK"||c||this._map.isZooming()||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new o.l("trackuserlocationend")),this.fire(new o.l("userlocationlostfocus")))}))}},this.options=o.e({},Ss,m)}onAdd(m){return this._map=m,this._container=rt.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),(function(){return o._(this,arguments,void 0,(function*(e=!1){if(Ma!==void 0&&!e)return Ma;if(window.navigator.permissions===void 0)return Ma=!!window.navigator.geolocation,Ma;try{Ma=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{Ma=!!window.navigator.geolocation}return Ma}))})().then((e=>this._finishSetupUI(e))),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),rt.remove(this._container),this._map.off("zoom",this._onUpdate),this._map.off("move",this._onUpdate),this._map.off("rotate",this._onUpdate),this._map.off("pitch",this._onUpdate),this._map=void 0,id=0,gn=!1}_isOutOfMapMaxBounds(m){let e=this._map.getMaxBounds(),a=m.coords;return e&&(a.longitude<e.getWest()||a.longitude>e.getEast()||a.latitude<e.getSouth()||a.latitude>e.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":case"BACKGROUND_ERROR":case"OFF":case void 0:break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadiusIfNeeded(){let m=this._userLocationDotMarker.getLngLat();if(!(this.options.showUserLocation&&this.options.showAccuracyCircle&&this._accuracy&&m))return;let e=this._map.project(m),a=this._map.unproject([e.x+100,e.y]),c=m.distanceTo(a)/100,r=2*this._accuracy/c;this._circleElement.style.width=`${r.toFixed(2)}px`,this._circleElement.style.height=`${r.toFixed(2)}px`}trigger(){if(!this._setup)return o.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new o.l("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":id--,gn=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new o.l("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new o.l("trackuserlocationstart")),this.fire(new o.l("userlocationfocus"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let m;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),id++,id>1?(m={maximumAge:6e5,timeout:0},gn=!0):(m=this.options.positionOptions,gn=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,m)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},I.GlobeControl=class{constructor(){this._toggleProjection=()=>{var m;let e=(m=this._map.getProjection())===null||m===void 0?void 0:m.type;this._map.setProjection(e!=="mercator"&&e?{type:"mercator"}:{type:"globe"}),this._updateGlobeIcon()},this._updateGlobeIcon=()=>{var m;this._globeButton.classList.remove("maplibregl-ctrl-globe"),this._globeButton.classList.remove("maplibregl-ctrl-globe-enabled"),((m=this._map.getProjection())===null||m===void 0?void 0:m.type)==="globe"?(this._globeButton.classList.add("maplibregl-ctrl-globe-enabled"),this._globeButton.title=this._map._getUIString("GlobeControl.Disable")):(this._globeButton.classList.add("maplibregl-ctrl-globe"),this._globeButton.title=this._map._getUIString("GlobeControl.Enable"))}}onAdd(m){return this._map=m,this._container=rt.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._globeButton=rt.create("button","maplibregl-ctrl-globe",this._container),rt.create("span","maplibregl-ctrl-icon",this._globeButton).setAttribute("aria-hidden","true"),this._globeButton.type="button",this._globeButton.addEventListener("click",this._toggleProjection),this._updateGlobeIcon(),this._map.on("styledata",this._updateGlobeIcon),this._container}onRemove(){rt.remove(this._container),this._map.off("styledata",this._updateGlobeIcon),this._globeButton.removeEventListener("click",this._toggleProjection),this._map=void 0}},I.Hash=Gs,I.ImageSource=Ql,I.KeyboardHandler=F0,I.LngLatBounds=Ee,I.LogoControl=Ci,I.Map=class extends I0{constructor(m){var e,a;o.cF.mark(o.cG.create);let c=Object.assign(Object.assign(Object.assign({},_d),m),{canvasContextAttributes:Object.assign(Object.assign({},_d.canvasContextAttributes),m.canvasContextAttributes)});if(c.minZoom!=null&&c.maxZoom!=null&&c.minZoom>c.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(c.minPitch!=null&&c.maxPitch!=null&&c.minPitch>c.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(c.minPitch!=null&&c.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(c.maxPitch!=null&&c.maxPitch>180)throw new Error("maxPitch must be less than or equal to 180");let r=new je,W=new mi;if(c.minZoom!==void 0&&r.setMinZoom(c.minZoom),c.maxZoom!==void 0&&r.setMaxZoom(c.maxZoom),c.minPitch!==void 0&&r.setMinPitch(c.minPitch),c.maxPitch!==void 0&&r.setMaxPitch(c.maxPitch),c.renderWorldCopies!==void 0&&r.setRenderWorldCopies(c.renderWorldCopies),c.transformConstrain!==null&&r.setConstrainOverride(c.transformConstrain),super(r,W,{bearingSnap:c.bearingSnap}),this._idleTriggered=!1,this._crossFadingFactor=1,this._renderTaskQueue=new U0,this._controls=[],this._mapId=o.ag(),this._lostContextStyle={style:null,images:null},this._contextLost=g=>{g.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.painter.destroy();for(let u of Object.values(this.style._layers))if(u.type==="custom"&&console.warn(`Custom layer with id '${u.id}' cannot be restored after WebGL context loss. You will need to re-add it manually after context restoration.`),u._listeners)for(let[G]of Object.entries(u._listeners))console.warn(`Custom layer with id '${u.id}' had event listeners for event '${G}' which cannot be restored after WebGL context loss. You will need to re-add them manually after context restoration.`);this._lostContextStyle=this._getStyleAndImages(),this.style.destroy(),this.style=null,this.fire(new o.l("webglcontextlost",{originalEvent:g}))},this._contextRestored=g=>{this._lostContextStyle.style&&this.setStyle(this._lostContextStyle.style,{diff:!1}),this._lostContextStyle.images&&(this.style.imageManager.images=this._lostContextStyle.images),this._setupPainter(),this.resize(),this._update(),this.fire(new o.l("webglcontextrestored",{originalEvent:g}))},this._onMapScroll=g=>{if(g.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=c.interactive,this._maxTileCacheSize=c.maxTileCacheSize,this._maxTileCacheZoomLevels=c.maxTileCacheZoomLevels,this._canvasContextAttributes=Object.assign({},c.canvasContextAttributes),this._trackResize=c.trackResize===!0,this._bearingSnap=c.bearingSnap,this._centerClampedToGround=c.centerClampedToGround,this._refreshExpiredTiles=c.refreshExpiredTiles===!0,this._fadeDuration=c.fadeDuration,this._crossSourceCollisions=c.crossSourceCollisions===!0,this._collectResourceTiming=c.collectResourceTiming===!0,this._locale=Object.assign(Object.assign({},M0),c.locale),this._clickTolerance=c.clickTolerance,this._overridePixelRatio=c.pixelRatio,this._maxCanvasSize=c.maxCanvasSize,this._zoomLevelsToOverscale=c.experimentalZoomLevelsToOverscale,this.transformCameraUpdate=c.transformCameraUpdate,this.transformConstrain=c.transformConstrain,this.cancelPendingTileRequestsWhileZooming=c.cancelPendingTileRequestsWhileZooming===!0,c.reduceMotion!==void 0&&(ft.prefersReducedMotion=c.reduceMotion),this._imageQueueHandle=ce.addThrottleControl((()=>this.isMoving())),this._requestManager=new ge(c.transformRequest),typeof c.container=="string"){if(this._container=document.getElementById(c.container),!this._container)throw new Error(`Container '${c.container}' not found.`)}else{if(!(c.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=c.container}if(c.maxBounds&&this.setMaxBounds(c.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",(()=>this._update(!1))),this.on("moveend",(()=>this._update(!1))),this.on("zoom",(()=>this._update(!0))),this.on("terrain",(()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)})),this.once("idle",(()=>{this._idleTriggered=!0})),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let g=!1,u=Fs((G=>{this._trackResize&&!this._removed&&(this.resize(G),this.redraw())}),50);this._resizeObserver=new ResizeObserver((G=>{g?u(G):g=!0})),this._resizeObserver.observe(this._container)}this.handlers=new Hd(this,c),this._hash=c.hash&&new Gs(typeof c.hash=="string"&&c.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:c.center,elevation:c.elevation,zoom:c.zoom,bearing:c.bearing,pitch:c.pitch,roll:c.roll}),c.bounds&&(this.resize(),this.fitBounds(c.bounds,o.e({},c.fitBoundsOptions,{duration:0}))));let h=typeof c.style=="string"||((a=(e=c.style)===null||e===void 0?void 0:e.projection)===null||a===void 0?void 0:a.type)!=="globe";this.resize(null,h),this._localIdeographFontFamily=c.localIdeographFontFamily,this._validateStyle=c.validateStyle,c.style&&this.setStyle(c.style,{localIdeographFontFamily:c.localIdeographFontFamily}),c.attributionControl&&this.addControl(new Dl(typeof c.attributionControl=="boolean"?void 0:c.attributionControl)),c.maplibreLogo&&this.addControl(new Ci,c.logoPosition),this.on("style.load",(()=>{if(h||this._resizeTransform(),this.transform.unmodified){let g=o.U(this.style.stylesheet,["center","zoom","bearing","pitch","roll"]);this.jumpTo(g)}})),this.on("data",(g=>{this._update(g.dataType==="style"),this.fire(new o.l(`${g.dataType}data`,g))})),this.on("dataloading",(g=>{this.fire(new o.l(`${g.dataType}dataloading`,g))})),this.on("dataabort",(g=>{this.fire(new o.l("sourcedataabort",g))}))}_getMapId(){return this._mapId}setGlobalStateProperty(m,e){return this.style.setGlobalStateProperty(m,e),this._update(!0)}getGlobalState(){return this.style.getGlobalState()}addControl(m,e){if(e===void 0&&(e=m.getDefaultPosition?m.getDefaultPosition():"top-right"),!m||!m.onAdd)return this.fire(new o.k(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));let a=m.onAdd(this);this._controls.push(m);let c=this._controlPositions[e];return e.indexOf("bottom")!==-1?c.insertBefore(a,c.firstChild):c.appendChild(a),this}removeControl(m){if(!m||!m.onRemove)return this.fire(new o.k(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));let e=this._controls.indexOf(m);return e>-1&&this._controls.splice(e,1),m.onRemove(this),this}hasControl(m){return this._controls.indexOf(m)>-1}coveringTiles(m){return ie(this.transform,m)}calculateCameraOptionsFromTo(m,e,a,c){return c==null&&this.terrain&&(c=this.terrain.getElevationForLngLatZoom(a,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(m,e,a,c)}resize(m,e=!0){let[a,c]=this._containerDimensions(),r=this._getClampedPixelRatio(a,c);if(this._resizeCanvas(a,c,r),this.painter.resize(a,c,r),this.painter.overLimit()){let h=this.painter.context.gl;this._maxCanvasSize=[h.drawingBufferWidth,h.drawingBufferHeight];let g=this._getClampedPixelRatio(a,c);this._resizeCanvas(a,c,g),this.painter.resize(a,c,g)}this._resizeTransform(e);let W=!this._moving;return W&&(this.stop(),this.fire(new o.l("movestart",m)).fire(new o.l("move",m))),this.fire(new o.l("resize",m)),W&&this.fire(new o.l("moveend",m)),this}_resizeTransform(m=!0){var e;let[a,c]=this._containerDimensions();this.transform.resize(a,c,m),(e=this._requestedCameraState)===null||e===void 0||e.resize(a,c,m)}_getClampedPixelRatio(m,e){let{0:a,1:c}=this._maxCanvasSize,r=this.getPixelRatio(),W=m*r,h=e*r;return Math.min(W>a?a/W:1,h>c?c/h:1)*r}getPixelRatio(){var m;return(m=this._overridePixelRatio)!==null&&m!==void 0?m:devicePixelRatio}setPixelRatio(m){this._overridePixelRatio=m,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(m){return this.transform.setMaxBounds(Ee.convert(m)),this._update()}setMinZoom(m){if((m=m??-2)>=-2&&m<=this.transform.maxZoom)return this.transform.setMinZoom(m),this._update(),this.getZoom()<m&&this.setZoom(m),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(m){if((m=m??22)>=this.transform.minZoom)return this.transform.setMaxZoom(m),this._update(),this.getZoom()>m&&this.setZoom(m),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(m){if((m=m??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(m>=0&&m<=this.transform.maxPitch)return this.transform.setMinPitch(m),this._update(),this.getPitch()<m&&this.setPitch(m),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(m){if((m=m??60)>180)throw new Error("maxPitch must be less than or equal to 180");if(m>=this.transform.minPitch)return this.transform.setMaxPitch(m),this._update(),this.getPitch()>m&&this.setPitch(m),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(m){return this.transform.setRenderWorldCopies(m),this._update()}setTransformConstrain(m){return this.transform.setConstrainOverride(m),this._update()}project(m){return this.transform.locationToScreenPoint(o.V.convert(m),this.style&&this.terrain)}unproject(m){return this.transform.screenPointToLocation(o.P.convert(m),this.terrain)}isMoving(){var m;return this._moving||((m=this.handlers)===null||m===void 0?void 0:m.isMoving())}isZooming(){var m;return this._zooming||((m=this.handlers)===null||m===void 0?void 0:m.isZooming())}isRotating(){var m;return this._rotating||((m=this.handlers)===null||m===void 0?void 0:m.isRotating())}_createDelegatedListener(m,e,a){if(m==="mouseenter"||m==="mouseover"){let c=!1;return{layers:e,listener:a,delegates:{mousemove:W=>{let h=e.filter((u=>this.getLayer(u))),g=h.length!==0?this.queryRenderedFeatures(W.point,{layers:h}):[];g.length?c||(c=!0,a.call(this,new qe(m,this,W.originalEvent,{features:g}))):c=!1},mouseout:()=>{c=!1}}}}if(m==="mouseleave"||m==="mouseout"){let c=!1;return{layers:e,listener:a,delegates:{mousemove:h=>{let g=e.filter((u=>this.getLayer(u)));(g.length!==0?this.queryRenderedFeatures(h.point,{layers:g}):[]).length?c=!0:c&&(c=!1,a.call(this,new qe(m,this,h.originalEvent)))},mouseout:h=>{c&&(c=!1,a.call(this,new qe(m,this,h.originalEvent)))}}}}{let c=r=>{let W=e.filter((g=>this.getLayer(g))),h=W.length!==0?this.queryRenderedFeatures(r.point,{layers:W}):[];h.length&&(r.features=h,a.call(this,r),delete r.features)};return{layers:e,listener:a,delegates:{[m]:c}}}}_saveDelegatedListener(m,e){this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[m]=this._delegatedListeners[m]||[],this._delegatedListeners[m].push(e)}_removeDelegatedListener(m,e,a){if(!this._delegatedListeners||!this._delegatedListeners[m])return;let c=this._delegatedListeners[m];for(let r=0;r<c.length;r++){let W=c[r];if(W.listener===a&&W.layers.length===e.length&&W.layers.every((h=>e.includes(h)))){for(let h in W.delegates)this.off(h,W.delegates[h]);return void c.splice(r,1)}}}on(m,e,a){if(a===void 0)return super.on(m,e);let c=typeof e=="string"?[e]:e,r=this._createDelegatedListener(m,c,a);this._saveDelegatedListener(m,r);for(let W in r.delegates)this.on(W,r.delegates[W]);return{unsubscribe:()=>{this._removeDelegatedListener(m,c,a)}}}once(m,e,a){if(a===void 0)return super.once(m,e);let c=typeof e=="string"?[e]:e,r=this._createDelegatedListener(m,c,a);for(let W in r.delegates){let h=r.delegates[W];r.delegates[W]=(...g)=>{this._removeDelegatedListener(m,c,a),h(...g)}}this._saveDelegatedListener(m,r);for(let W in r.delegates)this.once(W,r.delegates[W]);return this}off(m,e,a){return a===void 0?super.off(m,e):(this._removeDelegatedListener(m,typeof e=="string"?[e]:e,a),this)}queryRenderedFeatures(m,e){if(!this.style)return[];let a,c=m instanceof o.P||Array.isArray(m),r=c?m:[[0,0],[this.transform.width,this.transform.height]];if(e=e||(c?{}:m)||{},r instanceof o.P||typeof r[0]=="number")a=[o.P.convert(r)];else{let W=o.P.convert(r[0]),h=o.P.convert(r[1]);a=[W,new o.P(h.x,W.y),h,new o.P(W.x,h.y),W]}return this.style.queryRenderedFeatures(a,e,this.transform)}querySourceFeatures(m,e){return this.style.querySourceFeatures(m,e)}setStyle(m,e){return(e=o.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},e)).diff!==!1&&e.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&m?(this._diffStyle(m,e),this):(this._localIdeographFontFamily=e.localIdeographFontFamily,this._updateStyle(m,e))}setTransformRequest(m){return this._requestManager.setTransformRequest(m),this}_getUIString(m){let e=this._locale[m];if(e==null)throw new Error(`Missing UI string '${m}'`);return e}_updateStyle(m,e){var a,c;if(e.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",(()=>this._updateStyle(m,e)));let r=this.style&&e.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!m)),m?(this.style=new Id(this,e||{}),this.style.setEventedParent(this,{style:this.style}),typeof m=="string"?this.style.loadURL(m,e,r):this.style.loadJSON(m,e,r),this):((c=(a=this.style)===null||a===void 0?void 0:a.projection)===null||c===void 0||c.destroy(),delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new Id(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(m,e){if(typeof m=="string"){let a=this._requestManager.transformRequest(m,"Style");o.j(a,new AbortController).then((c=>{this._updateDiff(c.data,e)})).catch((c=>{c&&this.fire(new o.k(c))}))}else typeof m=="object"&&this._updateDiff(m,e)}_updateDiff(m,e){try{this.style.setState(m,e)&&this._update(!0)}catch(a){o.w(`Unable to perform style diff: ${a.message||a.error||a}.  Rebuilding the style from scratch.`),this._updateStyle(m,e)}}getStyle(){if(this.style)return this.style.serialize()}_getStyleAndImages(){return this.style?{style:this.style.serialize(),images:this.style.imageManager.cloneImages()}:{style:null,images:{}}}isStyleLoaded(){return this.style?this.style.loaded():o.w("There is no style added to the map.")}addSource(m,e){return this._lazyInitEmptyStyle(),this.style.addSource(m,e),this._update(!0)}isSourceLoaded(m){let e=this.style&&this.style.tileManagers[m];if(e!==void 0)return e.loaded();this.fire(new o.k(new Error(`There is no tile manager with ID '${m}'`)))}setTerrain(m){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),m){let e=this.style.tileManagers[m.source];if(!e)throw new Error(`cannot load terrain, because there exists no source with ID: ${m.source}`);this.terrain===null&&e.reload();for(let a in this.style._layers){let c=this.style._layers[a];c.type==="hillshade"&&c.source===m.source&&o.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality."),c.type==="color-relief"&&c.source===m.source&&o.w("You are using the same source for a color-relief layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new im(this.painter,e,m),this.painter.renderToTexture=new il(this.painter,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._terrainDataCallback=a=>{var c;a.dataType==="style"?this.terrain.tileManager.freeRtt():a.dataType==="source"&&a.tile&&(a.sourceId!==m.source||this._elevationFreeze||(this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))),((c=a.source)===null||c===void 0?void 0:c.type)==="image"?this.terrain.tileManager.freeRtt():this.terrain.tileManager.freeRtt(a.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.tileManager.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0);return this.fire(new o.l("terrain",{terrain:m})),this}getTerrain(){var m,e;return(e=(m=this.terrain)===null||m===void 0?void 0:m.options)!==null&&e!==void 0?e:null}areTilesLoaded(){let m=this.style&&this.style.tileManagers;for(let e in m){let a=m[e]._tiles;for(let c in a){let r=a[c];if(r.state!=="loaded"&&r.state!=="errored")return!1}}return!0}removeSource(m){return this.style.removeSource(m),this._update(!0)}getSource(m){return this.style.getSource(m)}setSourceTileLodParams(m,e,a){if(a){let c=this.getSource(a);if(!c)throw new Error(`There is no source with ID "${a}", cannot set LOD parameters`);c.calculateTileZoom=gt(Math.max(1,m),Math.max(1,e))}else for(let c in this.style.tileManagers)this.style.tileManagers[c].getSource().calculateTileZoom=gt(Math.max(1,m),Math.max(1,e));return this._update(!0),this}refreshTiles(m,e){let a=this.style.tileManagers[m];if(!a)throw new Error(`There is no tile manager with ID "${m}", cannot refresh tile`);e===void 0?a.reload(!0):a.refreshTiles(e.map((c=>new o.ad(c.z,c.x,c.y))))}addImage(m,e,a={}){let{pixelRatio:c=1,sdf:r=!1,stretchX:W,stretchY:h,content:g,textFitWidth:u,textFitHeight:G}=a;if(this._lazyInitEmptyStyle(),!(e instanceof HTMLImageElement||o.b(e))){if(e.width===void 0||e.height===void 0)return this.fire(new o.k(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{let{width:Y,height:y,data:J}=e,S=e;return this.style.addImage(m,{data:new o.R({width:Y,height:y},new Uint8Array(J)),pixelRatio:c,stretchX:W,stretchY:h,content:g,textFitWidth:u,textFitHeight:G,sdf:r,version:0,userImage:S}),S.onAdd&&S.onAdd(this,m),this}}{let{width:Y,height:y,data:J}=ft.getImageData(e);this.style.addImage(m,{data:new o.R({width:Y,height:y},J),pixelRatio:c,stretchX:W,stretchY:h,content:g,textFitWidth:u,textFitHeight:G,sdf:r,version:0})}}updateImage(m,e){let a=this.style.getImage(m);if(!a)return this.fire(new o.k(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));let c=e instanceof HTMLImageElement||o.b(e)?ft.getImageData(e):e,{width:r,height:W,data:h}=c;if(r===void 0||W===void 0)return this.fire(new o.k(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(r!==a.data.width||W!==a.data.height)return this.fire(new o.k(new Error("The width and height of the updated image must be that same as the previous version of the image")));let g=!(e instanceof HTMLImageElement||o.b(e));return a.data.replace(h,g),this.style.updateImage(m,a),this}getImage(m){return this.style.getImage(m)}hasImage(m){return m?!!this.style.getImage(m):(this.fire(new o.k(new Error("Missing required image id"))),!1)}removeImage(m){this.style.removeImage(m)}loadImage(m){return ce.getImage(this._requestManager.transformRequest(m,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(m,e){return this._lazyInitEmptyStyle(),this.style.addLayer(m,e),this._update(!0)}moveLayer(m,e){return this.style.moveLayer(m,e),this._update(!0)}removeLayer(m){return this.style.removeLayer(m),this._update(!0)}getLayer(m){return this.style.getLayer(m)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(m,e,a){return this.style.setLayerZoomRange(m,e,a),this._update(!0)}setFilter(m,e,a={}){return this.style.setFilter(m,e,a),this._update(!0)}getFilter(m){return this.style.getFilter(m)}setPaintProperty(m,e,a,c={}){return this.style.setPaintProperty(m,e,a,c),this._update(!0)}getPaintProperty(m,e){return this.style.getPaintProperty(m,e)}setLayoutProperty(m,e,a,c={}){return this.style.setLayoutProperty(m,e,a,c),this._update(!0)}getLayoutProperty(m,e){return this.style.getLayoutProperty(m,e)}setGlyphs(m,e={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(m,e),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(m,e,a={}){return this._lazyInitEmptyStyle(),this.style.addSprite(m,e,a,(c=>{c||this._update(!0)})),this}removeSprite(m){return this._lazyInitEmptyStyle(),this.style.removeSprite(m),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(m,e={}){return this._lazyInitEmptyStyle(),this.style.setSprite(m,e,(a=>{a||this._update(!0)})),this}setLight(m,e={}){return this._lazyInitEmptyStyle(),this.style.setLight(m,e),this._update(!0)}getLight(){return this.style.getLight()}setSky(m,e={}){return this._lazyInitEmptyStyle(),this.style.setSky(m,e),this._update(!0)}getSky(){return this.style.getSky()}setFeatureState(m,e){return this.style.setFeatureState(m,e),this._update()}removeFeatureState(m,e){return this.style.removeFeatureState(m,e),this._update()}getFeatureState(m){return this.style.getFeatureState(m)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let m=0,e=0;return this._container&&(m=this._container.clientWidth||400,e=this._container.clientHeight||300),[m,e]}_setupContainer(){let m=this._container;m.classList.add("maplibregl-map");let e=this._canvasContainer=rt.create("div","maplibregl-canvas-container",m);this._interactive&&e.classList.add("maplibregl-interactive"),this._canvas=rt.create("canvas","maplibregl-canvas",e),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",this._interactive?"0":"-1"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region");let a=this._containerDimensions(),c=this._getClampedPixelRatio(a[0],a[1]);this._resizeCanvas(a[0],a[1],c);let r=this._controlContainer=rt.create("div","maplibregl-control-container",m),W=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach((h=>{W[h]=rt.create("div",`maplibregl-ctrl-${h} `,r)})),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(m,e,a){this._canvas.width=Math.floor(a*m),this._canvas.height=Math.floor(a*e),this._canvas.style.width=`${m}px`,this._canvas.style.height=`${e}px`}_setupPainter(){let m=Object.assign(Object.assign({},this._canvasContextAttributes),{alpha:!0,depth:!0,stencil:!0,premultipliedAlpha:!0}),e=null;this._canvas.addEventListener("webglcontextcreationerror",(c=>{e={requestedAttributes:m},c&&(e.statusMessage=c.statusMessage,e.type=c.type)}),{once:!0});let a=null;if(a=this._canvasContextAttributes.contextType?this._canvas.getContext(this._canvasContextAttributes.contextType,m):this._canvas.getContext("webgl2",m)||this._canvas.getContext("webgl",m),!a){let c="Failed to initialize WebGL";throw e?(e.message=c,new Error(JSON.stringify(e))):new Error(c)}this.painter=new b0(a,this.transform),ne.testSupport(a)}migrateProjection(m,e){super.migrateProjection(m,e),this.painter.transform=m,this.fire(new o.l("projectiontransition",{newProjection:this.style.projection.name}))}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(m){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||m,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(m){return this._update(),this._renderTaskQueue.add(m)}_cancelRenderFrame(m){this._renderTaskQueue.remove(m)}_render(m){var e,a,c,r,W;let h=this._idleTriggered?this._fadeDuration:0,g=((e=this.style.projection)===null||e===void 0?void 0:e.transitionState)>0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(m),this._removed)return;let u=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;let y=this.transform.zoom,J=Ct();this.style.zoomHistory.update(y,J);let S=new o.H(y,{now:J,fadeDuration:h,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),L=S.crossFadingFactor();L===1&&L===this._crossFadingFactor||(u=!0,this._crossFadingFactor=L),this.style.update(S)}let G=((a=this.style.projection)===null||a===void 0?void 0:a.transitionState)>0!==g;(c=this.style.projection)===null||c===void 0||c.setErrorQueryLatitudeDegrees(this.transform.center.lat),this.transform.setTransitionState((r=this.style.projection)===null||r===void 0?void 0:r.transitionState,(W=this.style.projection)===null||W===void 0?void 0:W.latitudeErrorCorrectionRadians),this.style&&(this._sourcesDirty||G)&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.tileManager.update(this.transform,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),!this._elevationFreeze&&this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0)),this._placementDirty=this.style&&this.style._updatePlacement(this.transform,this.showCollisionBoxes,h,this._crossSourceCollisions,G),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:h,showPadding:this.showPadding}),this.fire(new o.l("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,o.cF.mark(o.cG.load),this.fire(new o.l("load"))),this.style&&(this.style.hasTransitions()||u)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();let Y=this._sourcesDirty||this._styleDirty||this._placementDirty;return Y||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new o.l("idle")),!this._loaded||this._fullyLoaded||Y||(this._fullyLoaded=!0,o.cF.mark(o.cG.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var m;this._hash&&this._hash.remove();for(let a of this._controls)a.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),ce.removeThrottleControl(this._imageQueueHandle),(m=this._resizeObserver)===null||m===void 0||m.disconnect();let e=this.painter.context.gl.getExtension("WEBGL_lose_context");e?.loseContext&&e.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),rt.remove(this._canvasContainer),rt.remove(this._controlContainer),this._container.removeEventListener("scroll",this._onMapScroll,!1),this._container.classList.remove("maplibregl-map"),o.cF.clearMetrics(),this._removed=!0,this.fire(new o.l("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,ft.frame(this._frameRequest,(m=>{o.cF.frame(m),this._frameRequest=null;try{this._render(m)}catch(e){if(!o.cH(e)&&!(function(a){return a.message===Ec})(e))throw e}}),(()=>{})))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(m){this._showTileBoundaries!==m&&(this._showTileBoundaries=m,this._update())}get showPadding(){return!!this._showPadding}set showPadding(m){this._showPadding!==m&&(this._showPadding=m,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(m){this._showCollisionBoxes!==m&&(this._showCollisionBoxes=m,m?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(m){this._showOverdrawInspector!==m&&(this._showOverdrawInspector=m,this._update())}get repaint(){return!!this._repaint}set repaint(m){this._repaint!==m&&(this._repaint=m,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(m){this._vertices=m,this._update()}get version(){return fd}getCameraTargetElevation(){return this.transform.elevation}getProjection(){return this.style.getProjection()}setProjection(m){return this._lazyInitEmptyStyle(),this.style.setProjection(m),this._update(!0)}},I.MapMouseEvent=qe,I.MapTouchEvent=Ld,I.MapWheelEvent=Vn,I.Marker=Pd,I.NavigationControl=class{constructor(m){this._updateZoomButtons=()=>{let e=this._map.getZoom(),a=e===this._map.getMaxZoom(),c=e===this._map.getMinZoom();this._zoomInButton.disabled=a,this._zoomOutButton.disabled=c,this._zoomInButton.setAttribute("aria-disabled",a.toString()),this._zoomOutButton.setAttribute("aria-disabled",c.toString())},this._rotateCompassArrow=()=>{this._compassIcon.style.transform=this.options.visualizePitch&&this.options.visualizeRoll?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateZ(${-this._map.transform.roll}deg) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizeRoll?`rotate(${-this._map.transform.bearing-this._map.transform.roll}deg)`:`rotate(${-this._map.transform.bearing}deg)`},this._setButtonTitle=(e,a)=>{let c=this._map._getUIString(`NavigationControl.${a}`);e.title=c,e.setAttribute("aria-label",c)},this.options=o.e({},ys,m),this._container=rt.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",(e=>e.preventDefault())),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",(e=>this._map.zoomIn({},{originalEvent:e}))),rt.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",(e=>this._map.zoomOut({},{originalEvent:e}))),rt.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",(e=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:e}):this._map.resetNorth({},{originalEvent:e})})),this._compassIcon=rt.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(m){return this._map=m,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.on("roll",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Bs(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){rt.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.off("roll",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(m,e){let a=rt.create("button",m,this._container);return a.type="button",a.addEventListener("click",e),a}},I.Popup=class extends o.E{constructor(m){super(),this._updateOpacity=()=>{this.options.locationOccludedOpacity!==void 0&&(this._container.style.opacity=this._map.transform.isLocationOccluded(this.getLngLat())?`${this.options.locationOccludedOpacity}`:"")},this.remove=()=>(this._content&&rt.remove(this._content),this._container&&(rt.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new o.l("close"))),this),this._onMouseUp=e=>{this._update(e.point)},this._onMouseMove=e=>{this._update(e.point)},this._onDrag=e=>{this._update(e.point)},this._update=e=>{if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=rt.create("div","maplibregl-popup",this._map.getContainer()),this._tip=rt.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(let h of this.options.className.split(" "))this._container.classList.add(h);this._closeButton&&this._closeButton.setAttribute("aria-label",this._map._getUIString("Popup.Close")),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=ld(this._lngLat,this._flatPos,this._map.transform,this._trackPointer),this._trackPointer&&!e)return;let a=this._flatPos=this._pos=this._trackPointer&&e?e:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&e?e:this._map.transform.locationToScreenPoint(this._lngLat));let c=this.options.anchor,r=eo(this.options.offset);if(!c){let h=this._container.offsetWidth,g=this._container.offsetHeight,u;u=a.y+r.bottom.y<g?["top"]:a.y>this._map.transform.height-g?["bottom"]:[],a.x<h/2?u.push("left"):a.x>this._map.transform.width-h/2&&u.push("right"),c=u.length===0?"bottom":u.join("-")}let W=a.add(r[c]);this.options.subpixelPositioning||(W=W.round()),rt.setTransform(this._container,`${Kd[c]} translate(${W.x}px,${W.y}px)`),qc(this._container,c,"popup"),this._updateOpacity()},this._onClose=()=>{this.remove()},this.options=o.e(Object.create(to),m)}addTo(m){return this._map&&this.remove(),this._map=m,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new o.l("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(m){return this._lngLat=o.V.convert(m),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(m){return this.setDOMContent(document.createTextNode(m))}setHTML(m){let e=document.createDocumentFragment(),a=document.createElement("body"),c;for(a.innerHTML=m;c=a.firstChild,c;)e.appendChild(c);return this.setDOMContent(e)}getMaxWidth(){var m;return(m=this._container)===null||m===void 0?void 0:m.style.maxWidth}setMaxWidth(m){return this.options.maxWidth=m,this._update(),this}setDOMContent(m){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=rt.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(m),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(m){return this._container&&this._container.classList.add(m),this}removeClassName(m){return this._container&&this._container.classList.remove(m),this}setOffset(m){return this.options.offset=m,this._update(),this}toggleClassName(m){if(this._container)return this._container.classList.toggle(m)}setSubpixelPositioning(m){this.options.subpixelPositioning=m}_createCloseButton(){this.options.closeButton&&(this._closeButton=rt.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;let m=this._container.querySelector(Qs);m&&m.focus()}},I.RasterDEMTileSource=ea,I.RasterTileSource=za,I.ScaleControl=class{constructor(m){this._onMove=()=>{$c(this._map,this._container,this.options)},this.setUnit=e=>{this.options.unit=e,$c(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},Cs),m)}getDefaultPosition(){return"bottom-left"}onAdd(m){return this._map=m,this._container=rt.create("div","maplibregl-ctrl maplibregl-ctrl-scale",m.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){rt.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},I.ScrollZoomHandler=wd,I.Style=Id,I.TerrainControl=class{constructor(m){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=m}onAdd(m){return this._map=m,this._container=rt.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=rt.create("button","maplibregl-ctrl-terrain",this._container),rt.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){rt.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},I.TwoFingersTouchPitchHandler=xs,I.TwoFingersTouchRotateHandler=Ms,I.TwoFingersTouchZoomHandler=R0,I.TwoFingersTouchZoomRotateHandler=N0,I.VectorTileSource=ui,I.VideoSource=ua,I.addSourceType=(m,e)=>o._(void 0,void 0,void 0,(function*(){if(Fa(m))throw new Error(`A source type called "${m}" already exists.`);((a,c)=>{ia[a]=c})(m,e)})),I.clearPrewarmedResources=function(){let m=ml;m&&(m.isPreloaded()&&m.numActive()===1?(m.release(ci),ml=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},I.createTileMesh=Nc,I.getMaxParallelImageRequests=function(){return o.a.MAX_PARALLEL_IMAGE_REQUESTS},I.getRTLTextPluginStatus=function(){return wi().getRTLTextPluginStatus()},I.getVersion=function(){return lo},I.getWorkerCount=function(){return gi.workerCount},I.getWorkerUrl=function(){return o.a.WORKER_URL},I.importScriptInWorkers=function(m){return ji().broadcast("IS",m)},I.isTimeFrozen=function(){return le.isFrozen()},I.now=Ct,I.prewarm=function(){zi().acquire(ci)},I.restoreNow=function(){le.restoreNow()},I.setMaxParallelImageRequests=function(m){o.a.MAX_PARALLEL_IMAGE_REQUESTS=m},I.setNow=function(m){le.setNow(m)},I.setRTLTextPlugin=function(m,e){return wi().setRTLTextPlugin(m,e)},I.setWorkerCount=function(m){gi.workerCount=m},I.setWorkerUrl=function(m){o.a.WORKER_URL=m}}));var E=M;return E}))});var f1=dR($Z());function th(M){if(!M)throw new Error("geojson is required");switch(M.type){case"Feature":return eh(M);case"FeatureCollection":return cR(M);case"Point":case"LineString":case"Polygon":case"MultiPoint":case"MultiLineString":case"MultiPolygon":case"GeometryCollection":return a1(M);default:throw new Error("unknown GeoJSON type")}}function eh(M){let p={type:"Feature"};return Object.keys(M).forEach(U=>{switch(U){case"type":case"properties":case"geometry":return;default:p[U]=M[U]}}),p.properties=lh(M.properties),M.geometry==null?p.geometry=null:p.geometry=a1(M.geometry),p}function lh(M){let p={};return M&&Object.keys(M).forEach(U=>{let E=M[U];typeof E=="object"?E===null?p[U]=null:Array.isArray(E)?p[U]=E.map(I=>I):p[U]=lh(E):p[U]=E}),p}function cR(M){let p={type:"FeatureCollection"};return Object.keys(M).forEach(U=>{switch(U){case"type":case"features":return;default:p[U]=M[U]}}),p.features=M.features.map(U=>eh(U)),p}function a1(M){let p={type:M.type};return M.bbox&&(p.bbox=M.bbox),M.type==="GeometryCollection"?(p.geometries=M.geometries.map(U=>a1(U)),p):(p.coordinates=ih(M.coordinates),p)}function ih(M){let p=M;return typeof p[0]!="object"?p.slice():p.map(U=>ih(U))}var $i=63710088e-1,oR={centimeters:$i*100,centimetres:$i*100,degrees:360/(2*Math.PI),feet:$i*3.28084,inches:$i*39.37,kilometers:$i/1e3,kilometres:$i/1e3,meters:$i,metres:$i,miles:$i/1609.344,millimeters:$i*1e3,millimetres:$i*1e3,nauticalmiles:$i/1852,radians:1,yards:$i*1.0936};function sR(M,p,U={}){let E={type:"Feature"};return(U.id===0||U.id)&&(E.id=U.id),U.bbox&&(E.bbox=U.bbox),E.properties=p||{},E.geometry=M,E}function n1(M,p,U={}){if(!M)throw new Error("coordinates is required");if(!Array.isArray(M))throw new Error("coordinates must be an Array");if(M.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!ah(M[0])||!ah(M[1]))throw new Error("coordinates must contain numbers");return sR({type:"Point",coordinates:M},p,U)}function nh(M,p={}){let U={type:"FeatureCollection"};return p.id&&(U.id=p.id),p.bbox&&(U.bbox=p.bbox),U.features=M,U}function dh(M,p="kilometers"){let U=oR[p];if(!U)throw new Error(p+" units is invalid");return M*U}function cr(M){return M%360*Math.PI/180}function ah(M){return!isNaN(M)&&M!==null&&!Array.isArray(M)}function d1(M){if(!M)throw new Error("coord is required");if(!Array.isArray(M)){if(M.type==="Feature"&&M.geometry!==null&&M.geometry.type==="Point")return[...M.geometry.coordinates];if(M.type==="Point")return[...M.coordinates]}if(Array.isArray(M)&&M.length>=2&&!Array.isArray(M[0])&&!Array.isArray(M[1]))return[...M];throw new Error("coord must be GeoJSON Point or an Array of numbers")}function ch(M,p,U={}){var E=d1(M),I=d1(p),o=cr(I[1]-E[1]),lt=cr(I[0]-E[0]),Ft=cr(E[1]),Ut=cr(I[1]),Et=Math.pow(Math.sin(o/2),2)+Math.pow(Math.sin(lt/2),2)*Math.cos(Ft)*Math.cos(Ut);return dh(2*Math.atan2(Math.sqrt(Et),Math.sqrt(1-Et)),U.units)}function oh(M,p){if(M.type==="Feature")p(M,0);else if(M.type==="FeatureCollection")for(var U=0;U<M.features.length&&p(M.features[U],U)!==!1;U++);}var rR=Object.defineProperty,bR=Object.defineProperties,mR=Object.getOwnPropertyDescriptors,sh=Object.getOwnPropertySymbols,WR=Object.prototype.hasOwnProperty,ZR=Object.prototype.propertyIsEnumerable,rh=(M,p,U)=>p in M?rR(M,p,{enumerable:!0,configurable:!0,writable:!0,value:U}):M[p]=U,bh=(M,p)=>{for(var U in p||(p={}))WR.call(p,U)&&rh(M,U,p[U]);if(sh)for(var U of sh(p))ZR.call(p,U)&&rh(M,U,p[U]);return M},mh=(M,p)=>bR(M,mR(p));function hR(M,p,U={}){if(!M)throw new Error("targetPoint is required");if(!p)throw new Error("points is required");let E=1/0,I=0;oh(p,(lt,Ft)=>{let Ut=ch(M,lt,U);Ut<E&&(I=Ft,E=Ut)});let o=th(p.features[I]);return mh(bh({},o),{properties:mh(bh({},o.properties),{featureIndex:I,distanceToPoint:E})})}var c1=hR;var mb={};aR(mb,{afterMain:()=>gh,afterRead:()=>hh,afterWrite:()=>Fh,applyStyles:()=>Uo,arrow:()=>ab,auto:()=>or,basePlacements:()=>xn,beforeMain:()=>Vh,beforeRead:()=>Wh,beforeWrite:()=>Rh,bottom:()=>Sl,clippingParents:()=>o1,computeStyles:()=>Yo,createPopper:()=>pr,createPopperBase:()=>Xh,createPopperLite:()=>Jh,detectOverflow:()=>Ti,end:()=>rd,eventListeners:()=>xo,flip:()=>ob,hide:()=>sb,left:()=>ul,main:()=>ph,modifierPhases:()=>r1,offset:()=>rb,placements:()=>rr,popper:()=>cc,popperGenerator:()=>hc,popperOffsets:()=>Jo,preventOverflow:()=>bb,read:()=>Zh,reference:()=>s1,right:()=>Il,start:()=>ln,top:()=>bl,variationPlacements:()=>ib,viewport:()=>sr,write:()=>uh});var bl="top",Sl="bottom",Il="right",ul="left",or="auto",xn=[bl,Sl,Il,ul],ln="start",rd="end",o1="clippingParents",sr="viewport",cc="popper",s1="reference",ib=xn.reduce(function(M,p){return M.concat([p+"-"+ln,p+"-"+rd])},[]),rr=[].concat(xn,[or]).reduce(function(M,p){return M.concat([p,p+"-"+ln,p+"-"+rd])},[]),Wh="beforeRead",Zh="read",hh="afterRead",Vh="beforeMain",ph="main",gh="afterMain",Rh="beforeWrite",uh="write",Fh="afterWrite",r1=[Wh,Zh,hh,Vh,ph,gh,Rh,uh,Fh];function ql(M){return M?(M.nodeName||"").toLowerCase():null}function dl(M){if(M==null)return window;if(M.toString()!=="[object Window]"){var p=M.ownerDocument;return p&&p.defaultView||window}return M}function Wa(M){var p=dl(M).Element;return M instanceof p||M instanceof Element}function jl(M){var p=dl(M).HTMLElement;return M instanceof p||M instanceof HTMLElement}function Io(M){if(typeof ShadowRoot>"u")return!1;var p=dl(M).ShadowRoot;return M instanceof p||M instanceof ShadowRoot}function VR(M){var p=M.state;Object.keys(p.elements).forEach(function(U){var E=p.styles[U]||{},I=p.attributes[U]||{},o=p.elements[U];!jl(o)||!ql(o)||(Object.assign(o.style,E),Object.keys(I).forEach(function(lt){var Ft=I[lt];Ft===!1?o.removeAttribute(lt):o.setAttribute(lt,Ft===!0?"":Ft)}))})}function pR(M){var p=M.state,U={popper:{position:p.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(p.elements.popper.style,U.popper),p.styles=U,p.elements.arrow&&Object.assign(p.elements.arrow.style,U.arrow),function(){Object.keys(p.elements).forEach(function(E){var I=p.elements[E],o=p.attributes[E]||{},lt=Object.keys(p.styles.hasOwnProperty(E)?p.styles[E]:U[E]),Ft=lt.reduce(function(Ut,Et){return Ut[Et]="",Ut},{});!jl(I)||!ql(I)||(Object.assign(I.style,Ft),Object.keys(o).forEach(function(Ut){I.removeAttribute(Ut)}))})}}var Uo={name:"applyStyles",enabled:!0,phase:"write",fn:VR,effect:pR,requires:["computeStyles"]};function $l(M){return M.split("-")[0]}var Qa=Math.max,oc=Math.min,Tn=Math.round;function Mo(){var M=navigator.userAgentData;return M!=null&&M.brands&&Array.isArray(M.brands)?M.brands.map(function(p){return p.brand+"/"+p.version}).join(" "):navigator.userAgent}function br(){return!/^((?!chrome|android).)*safari/i.test(Mo())}function Za(M,p,U){p===void 0&&(p=!1),U===void 0&&(U=!1);var E=M.getBoundingClientRect(),I=1,o=1;p&&jl(M)&&(I=M.offsetWidth>0&&Tn(E.width)/M.offsetWidth||1,o=M.offsetHeight>0&&Tn(E.height)/M.offsetHeight||1);var lt=Wa(M)?dl(M):window,Ft=lt.visualViewport,Ut=!br()&&U,Et=(E.left+(Ut&&Ft?Ft.offsetLeft:0))/I,Bt=(E.top+(Ut&&Ft?Ft.offsetTop:0))/o,ft=E.width/I,le=E.height/o;return{width:ft,height:le,top:Bt,right:Et+ft,bottom:Bt+le,left:Et,x:Et,y:Bt}}function sc(M){var p=Za(M),U=M.offsetWidth,E=M.offsetHeight;return Math.abs(p.width-U)<=1&&(U=p.width),Math.abs(p.height-E)<=1&&(E=p.height),{x:M.offsetLeft,y:M.offsetTop,width:U,height:E}}function mr(M,p){var U=p.getRootNode&&p.getRootNode();if(M.contains(p))return!0;if(U&&Io(U)){var E=p;do{if(E&&M.isSameNode(E))return!0;E=E.parentNode||E.host}while(E)}return!1}function xi(M){return dl(M).getComputedStyle(M)}function b1(M){return["table","td","th"].indexOf(ql(M))>=0}function di(M){return((Wa(M)?M.ownerDocument:M.document)||window.document).documentElement}function Xn(M){return ql(M)==="html"?M:M.assignedSlot||M.parentNode||(Io(M)?M.host:null)||di(M)}function Gh(M){return!jl(M)||xi(M).position==="fixed"?null:M.offsetParent}function gR(M){var p=/firefox/i.test(Mo()),U=/Trident/i.test(Mo());if(U&&jl(M)){var E=xi(M);if(E.position==="fixed")return null}var I=Xn(M);for(Io(I)&&(I=I.host);jl(I)&&["html","body"].indexOf(ql(I))<0;){var o=xi(I);if(o.transform!=="none"||o.perspective!=="none"||o.contain==="paint"||["transform","perspective"].indexOf(o.willChange)!==-1||p&&o.willChange==="filter"||p&&o.filter&&o.filter!=="none")return I;I=I.parentNode}return null}function ka(M){for(var p=dl(M),U=Gh(M);U&&b1(U)&&xi(U).position==="static";)U=Gh(U);return U&&(ql(U)==="html"||ql(U)==="body"&&xi(U).position==="static")?p:U||gR(M)||p}function rc(M){return["top","bottom"].indexOf(M)>=0?"x":"y"}function bc(M,p,U){return Qa(M,oc(p,U))}function Nh(M,p,U){var E=bc(M,p,U);return E>U?U:E}function Wr(){return{top:0,right:0,bottom:0,left:0}}function Zr(M){return Object.assign({},Wr(),M)}function hr(M,p){return p.reduce(function(U,E){return U[E]=M,U},{})}var RR=function(p,U){return p=typeof p=="function"?p(Object.assign({},U.rects,{placement:U.placement})):p,Zr(typeof p!="number"?p:hr(p,xn))};function uR(M){var p,U=M.state,E=M.name,I=M.options,o=U.elements.arrow,lt=U.modifiersData.popperOffsets,Ft=$l(U.placement),Ut=rc(Ft),Et=[ul,Il].indexOf(Ft)>=0,Bt=Et?"height":"width";if(!(!o||!lt)){var ft=RR(I.padding,U),le=sc(o),Ct=Ut==="y"?bl:ul,rt=Ut==="y"?Sl:Il,ne=U.rects.reference[Bt]+U.rects.reference[Ut]-lt[Ut]-U.rects.popper[Bt],Kt=lt[Ut]-U.rects.reference[Ut],$t=ka(o),Ie=$t?Ut==="y"?$t.clientHeight||0:$t.clientWidth||0:0,Ue=ne/2-Kt/2,oe=ft[Ct],ce=Ie-le[Bt]-ft[rt],ge=Ie/2-le[Bt]/2+Ue,ue=bc(oe,ge,ce),Qe=Ut;U.modifiersData[E]=(p={},p[Qe]=ue,p.centerOffset=ue-ge,p)}}function FR(M){var p=M.state,U=M.options,E=U.element,I=E===void 0?"[data-popper-arrow]":E;I!=null&&(typeof I=="string"&&(I=p.elements.popper.querySelector(I),!I)||mr(p.elements.popper,I)&&(p.elements.arrow=I))}var ab={name:"arrow",enabled:!0,phase:"main",fn:uR,effect:FR,requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function ha(M){return M.split("-")[1]}var GR={top:"auto",right:"auto",bottom:"auto",left:"auto"};function NR(M,p){var U=M.x,E=M.y,I=p.devicePixelRatio||1;return{x:Tn(U*I)/I||0,y:Tn(E*I)/I||0}}function Ih(M){var p,U=M.popper,E=M.popperRect,I=M.placement,o=M.variation,lt=M.offsets,Ft=M.position,Ut=M.gpuAcceleration,Et=M.adaptive,Bt=M.roundOffsets,ft=M.isFixed,le=lt.x,Ct=le===void 0?0:le,rt=lt.y,ne=rt===void 0?0:rt,Kt=typeof Bt=="function"?Bt({x:Ct,y:ne}):{x:Ct,y:ne};Ct=Kt.x,ne=Kt.y;var $t=lt.hasOwnProperty("x"),Ie=lt.hasOwnProperty("y"),Ue=ul,oe=bl,ce=window;if(Et){var ge=ka(U),ue="clientHeight",Qe="clientWidth";if(ge===dl(U)&&(ge=di(U),xi(ge).position!=="static"&&Ft==="absolute"&&(ue="scrollHeight",Qe="scrollWidth")),ge=ge,I===bl||(I===ul||I===Il)&&o===rd){oe=Sl;var ke=ft&&ge===ce&&ce.visualViewport?ce.visualViewport.height:ge[ue];ne-=ke-E.height,ne*=Ut?1:-1}if(I===ul||(I===bl||I===Sl)&&o===rd){Ue=Il;var Me=ft&&ge===ce&&ce.visualViewport?ce.visualViewport.width:ge[Qe];Ct-=Me-E.width,Ct*=Ut?1:-1}}var He=Object.assign({position:Ft},Et&&GR),Cl=Bt===!0?NR({x:Ct,y:ne},dl(U)):{x:Ct,y:ne};if(Ct=Cl.x,ne=Cl.y,Ut){var cl;return Object.assign({},He,(cl={},cl[oe]=Ie?"0":"",cl[Ue]=$t?"0":"",cl.transform=(ce.devicePixelRatio||1)<=1?"translate("+Ct+"px, "+ne+"px)":"translate3d("+Ct+"px, "+ne+"px, 0)",cl))}return Object.assign({},He,(p={},p[oe]=Ie?ne+"px":"",p[Ue]=$t?Ct+"px":"",p.transform="",p))}function IR(M){var p=M.state,U=M.options,E=U.gpuAcceleration,I=E===void 0?!0:E,o=U.adaptive,lt=o===void 0?!0:o,Ft=U.roundOffsets,Ut=Ft===void 0?!0:Ft,Et={placement:$l(p.placement),variation:ha(p.placement),popper:p.elements.popper,popperRect:p.rects.popper,gpuAcceleration:I,isFixed:p.options.strategy==="fixed"};p.modifiersData.popperOffsets!=null&&(p.styles.popper=Object.assign({},p.styles.popper,Ih(Object.assign({},Et,{offsets:p.modifiersData.popperOffsets,position:p.options.strategy,adaptive:lt,roundOffsets:Ut})))),p.modifiersData.arrow!=null&&(p.styles.arrow=Object.assign({},p.styles.arrow,Ih(Object.assign({},Et,{offsets:p.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:Ut})))),p.attributes.popper=Object.assign({},p.attributes.popper,{"data-popper-placement":p.placement})}var Yo={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:IR,data:{}};var nb={passive:!0};function UR(M){var p=M.state,U=M.instance,E=M.options,I=E.scroll,o=I===void 0?!0:I,lt=E.resize,Ft=lt===void 0?!0:lt,Ut=dl(p.elements.popper),Et=[].concat(p.scrollParents.reference,p.scrollParents.popper);return o&&Et.forEach(function(Bt){Bt.addEventListener("scroll",U.update,nb)}),Ft&&Ut.addEventListener("resize",U.update,nb),function(){o&&Et.forEach(function(Bt){Bt.removeEventListener("scroll",U.update,nb)}),Ft&&Ut.removeEventListener("resize",U.update,nb)}}var xo={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:UR,data:{}};var MR={left:"right",right:"left",bottom:"top",top:"bottom"};function To(M){return M.replace(/left|right|bottom|top/g,function(p){return MR[p]})}var YR={start:"end",end:"start"};function db(M){return M.replace(/start|end/g,function(p){return YR[p]})}function mc(M){var p=dl(M),U=p.pageXOffset,E=p.pageYOffset;return{scrollLeft:U,scrollTop:E}}function Wc(M){return Za(di(M)).left+mc(M).scrollLeft}function m1(M,p){var U=dl(M),E=di(M),I=U.visualViewport,o=E.clientWidth,lt=E.clientHeight,Ft=0,Ut=0;if(I){o=I.width,lt=I.height;var Et=br();(Et||!Et&&p==="fixed")&&(Ft=I.offsetLeft,Ut=I.offsetTop)}return{width:o,height:lt,x:Ft+Wc(M),y:Ut}}function W1(M){var p,U=di(M),E=mc(M),I=(p=M.ownerDocument)==null?void 0:p.body,o=Qa(U.scrollWidth,U.clientWidth,I?I.scrollWidth:0,I?I.clientWidth:0),lt=Qa(U.scrollHeight,U.clientHeight,I?I.scrollHeight:0,I?I.clientHeight:0),Ft=-E.scrollLeft+Wc(M),Ut=-E.scrollTop;return xi(I||U).direction==="rtl"&&(Ft+=Qa(U.clientWidth,I?I.clientWidth:0)-o),{width:o,height:lt,x:Ft,y:Ut}}function Zc(M){var p=xi(M),U=p.overflow,E=p.overflowX,I=p.overflowY;return/auto|scroll|overlay|hidden/.test(U+I+E)}function cb(M){return["html","body","#document"].indexOf(ql(M))>=0?M.ownerDocument.body:jl(M)&&Zc(M)?M:cb(Xn(M))}function bd(M,p){var U;p===void 0&&(p=[]);var E=cb(M),I=E===((U=M.ownerDocument)==null?void 0:U.body),o=dl(E),lt=I?[o].concat(o.visualViewport||[],Zc(E)?E:[]):E,Ft=p.concat(lt);return I?Ft:Ft.concat(bd(Xn(lt)))}function Xo(M){return Object.assign({},M,{left:M.x,top:M.y,right:M.x+M.width,bottom:M.y+M.height})}function xR(M,p){var U=Za(M,!1,p==="fixed");return U.top=U.top+M.clientTop,U.left=U.left+M.clientLeft,U.bottom=U.top+M.clientHeight,U.right=U.left+M.clientWidth,U.width=M.clientWidth,U.height=M.clientHeight,U.x=U.left,U.y=U.top,U}function Uh(M,p,U){return p===sr?Xo(m1(M,U)):Wa(p)?xR(p,U):Xo(W1(di(M)))}function TR(M){var p=bd(Xn(M)),U=["absolute","fixed"].indexOf(xi(M).position)>=0,E=U&&jl(M)?ka(M):M;return Wa(E)?p.filter(function(I){return Wa(I)&&mr(I,E)&&ql(I)!=="body"}):[]}function Z1(M,p,U,E){var I=p==="clippingParents"?TR(M):[].concat(p),o=[].concat(I,[U]),lt=o[0],Ft=o.reduce(function(Ut,Et){var Bt=Uh(M,Et,E);return Ut.top=Qa(Bt.top,Ut.top),Ut.right=oc(Bt.right,Ut.right),Ut.bottom=oc(Bt.bottom,Ut.bottom),Ut.left=Qa(Bt.left,Ut.left),Ut},Uh(M,lt,E));return Ft.width=Ft.right-Ft.left,Ft.height=Ft.bottom-Ft.top,Ft.x=Ft.left,Ft.y=Ft.top,Ft}function Vr(M){var p=M.reference,U=M.element,E=M.placement,I=E?$l(E):null,o=E?ha(E):null,lt=p.x+p.width/2-U.width/2,Ft=p.y+p.height/2-U.height/2,Ut;switch(I){case bl:Ut={x:lt,y:p.y-U.height};break;case Sl:Ut={x:lt,y:p.y+p.height};break;case Il:Ut={x:p.x+p.width,y:Ft};break;case ul:Ut={x:p.x-U.width,y:Ft};break;default:Ut={x:p.x,y:p.y}}var Et=I?rc(I):null;if(Et!=null){var Bt=Et==="y"?"height":"width";switch(o){case ln:Ut[Et]=Ut[Et]-(p[Bt]/2-U[Bt]/2);break;case rd:Ut[Et]=Ut[Et]+(p[Bt]/2-U[Bt]/2);break;default:}}return Ut}function Ti(M,p){p===void 0&&(p={});var U=p,E=U.placement,I=E===void 0?M.placement:E,o=U.strategy,lt=o===void 0?M.strategy:o,Ft=U.boundary,Ut=Ft===void 0?o1:Ft,Et=U.rootBoundary,Bt=Et===void 0?sr:Et,ft=U.elementContext,le=ft===void 0?cc:ft,Ct=U.altBoundary,rt=Ct===void 0?!1:Ct,ne=U.padding,Kt=ne===void 0?0:ne,$t=Zr(typeof Kt!="number"?Kt:hr(Kt,xn)),Ie=le===cc?s1:cc,Ue=M.rects.popper,oe=M.elements[rt?Ie:le],ce=Z1(Wa(oe)?oe:oe.contextElement||di(M.elements.popper),Ut,Bt,lt),ge=Za(M.elements.reference),ue=Vr({reference:ge,element:Ue,strategy:"absolute",placement:I}),Qe=Xo(Object.assign({},Ue,ue)),ke=le===cc?Qe:ge,Me={top:ce.top-ke.top+$t.top,bottom:ke.bottom-ce.bottom+$t.bottom,left:ce.left-ke.left+$t.left,right:ke.right-ce.right+$t.right},He=M.modifiersData.offset;if(le===cc&&He){var Cl=He[I];Object.keys(Me).forEach(function(cl){var pi=[Il,Sl].indexOf(cl)>=0?1:-1,Fl=[bl,Sl].indexOf(cl)>=0?"y":"x";Me[cl]+=Cl[Fl]*pi})}return Me}function h1(M,p){p===void 0&&(p={});var U=p,E=U.placement,I=U.boundary,o=U.rootBoundary,lt=U.padding,Ft=U.flipVariations,Ut=U.allowedAutoPlacements,Et=Ut===void 0?rr:Ut,Bt=ha(E),ft=Bt?Ft?ib:ib.filter(function(rt){return ha(rt)===Bt}):xn,le=ft.filter(function(rt){return Et.indexOf(rt)>=0});le.length===0&&(le=ft);var Ct=le.reduce(function(rt,ne){return rt[ne]=Ti(M,{placement:ne,boundary:I,rootBoundary:o,padding:lt})[$l(ne)],rt},{});return Object.keys(Ct).sort(function(rt,ne){return Ct[rt]-Ct[ne]})}function XR(M){if($l(M)===or)return[];var p=To(M);return[db(M),p,db(p)]}function JR(M){var p=M.state,U=M.options,E=M.name;if(!p.modifiersData[E]._skip){for(var I=U.mainAxis,o=I===void 0?!0:I,lt=U.altAxis,Ft=lt===void 0?!0:lt,Ut=U.fallbackPlacements,Et=U.padding,Bt=U.boundary,ft=U.rootBoundary,le=U.altBoundary,Ct=U.flipVariations,rt=Ct===void 0?!0:Ct,ne=U.allowedAutoPlacements,Kt=p.options.placement,$t=$l(Kt),Ie=$t===Kt,Ue=Ut||(Ie||!rt?[To(Kt)]:XR(Kt)),oe=[Kt].concat(Ue).reduce(function(el,ml){return el.concat($l(ml)===or?h1(p,{placement:ml,boundary:Bt,rootBoundary:ft,padding:Et,flipVariations:rt,allowedAutoPlacements:ne}):ml)},[]),ce=p.rects.reference,ge=p.rects.popper,ue=new Map,Qe=!0,ke=oe[0],Me=0;Me<oe.length;Me++){var He=oe[Me],Cl=$l(He),cl=ha(He)===ln,pi=[bl,Sl].indexOf(Cl)>=0,Fl=pi?"width":"height",Ul=Ti(p,{placement:He,boundary:Bt,rootBoundary:ft,altBoundary:le,padding:Et}),se=pi?cl?Il:ul:cl?Sl:bl;ce[Fl]>ge[Fl]&&(se=To(se));var Ei=To(se),Ml=[];if(o&&Ml.push(Ul[Cl]<=0),Ft&&Ml.push(Ul[se]<=0,Ul[Ei]<=0),Ml.every(function(el){return el})){ke=He,Qe=!1;break}ue.set(He,Ml)}if(Qe)for(var Xi=rt?3:1,Ea=function(ml){var ll=oe.find(function(zi){var Al=ue.get(zi);if(Al)return Al.slice(0,ml).every(function(ji){return ji})});if(ll)return ke=ll,"break"},ci=Xi;ci>0;ci--){var gi=Ea(ci);if(gi==="break")break}p.placement!==ke&&(p.modifiersData[E]._skip=!0,p.placement=ke,p.reset=!0)}}var ob={name:"flip",enabled:!0,phase:"main",fn:JR,requiresIfExists:["offset"],data:{_skip:!1}};function Mh(M,p,U){return U===void 0&&(U={x:0,y:0}),{top:M.top-p.height-U.y,right:M.right-p.width+U.x,bottom:M.bottom-p.height+U.y,left:M.left-p.width-U.x}}function Yh(M){return[bl,Il,Sl,ul].some(function(p){return M[p]>=0})}function yR(M){var p=M.state,U=M.name,E=p.rects.reference,I=p.rects.popper,o=p.modifiersData.preventOverflow,lt=Ti(p,{elementContext:"reference"}),Ft=Ti(p,{altBoundary:!0}),Ut=Mh(lt,E),Et=Mh(Ft,I,o),Bt=Yh(Ut),ft=Yh(Et);p.modifiersData[U]={referenceClippingOffsets:Ut,popperEscapeOffsets:Et,isReferenceHidden:Bt,hasPopperEscaped:ft},p.attributes.popper=Object.assign({},p.attributes.popper,{"data-popper-reference-hidden":Bt,"data-popper-escaped":ft})}var sb={name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:yR};function BR(M,p,U){var E=$l(M),I=[ul,bl].indexOf(E)>=0?-1:1,o=typeof U=="function"?U(Object.assign({},p,{placement:M})):U,lt=o[0],Ft=o[1];return lt=lt||0,Ft=(Ft||0)*I,[ul,Il].indexOf(E)>=0?{x:Ft,y:lt}:{x:lt,y:Ft}}function SR(M){var p=M.state,U=M.options,E=M.name,I=U.offset,o=I===void 0?[0,0]:I,lt=rr.reduce(function(Bt,ft){return Bt[ft]=BR(ft,p.rects,o),Bt},{}),Ft=lt[p.placement],Ut=Ft.x,Et=Ft.y;p.modifiersData.popperOffsets!=null&&(p.modifiersData.popperOffsets.x+=Ut,p.modifiersData.popperOffsets.y+=Et),p.modifiersData[E]=lt}var rb={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:SR};function CR(M){var p=M.state,U=M.name;p.modifiersData[U]=Vr({reference:p.rects.reference,element:p.rects.popper,strategy:"absolute",placement:p.placement})}var Jo={name:"popperOffsets",enabled:!0,phase:"read",fn:CR,data:{}};function V1(M){return M==="x"?"y":"x"}function QR(M){var p=M.state,U=M.options,E=M.name,I=U.mainAxis,o=I===void 0?!0:I,lt=U.altAxis,Ft=lt===void 0?!1:lt,Ut=U.boundary,Et=U.rootBoundary,Bt=U.altBoundary,ft=U.padding,le=U.tether,Ct=le===void 0?!0:le,rt=U.tetherOffset,ne=rt===void 0?0:rt,Kt=Ti(p,{boundary:Ut,rootBoundary:Et,padding:ft,altBoundary:Bt}),$t=$l(p.placement),Ie=ha(p.placement),Ue=!Ie,oe=rc($t),ce=V1(oe),ge=p.modifiersData.popperOffsets,ue=p.rects.reference,Qe=p.rects.popper,ke=typeof ne=="function"?ne(Object.assign({},p.rects,{placement:p.placement})):ne,Me=typeof ke=="number"?{mainAxis:ke,altAxis:ke}:Object.assign({mainAxis:0,altAxis:0},ke),He=p.modifiersData.offset?p.modifiersData.offset[p.placement]:null,Cl={x:0,y:0};if(ge){if(o){var cl,pi=oe==="y"?bl:ul,Fl=oe==="y"?Sl:Il,Ul=oe==="y"?"height":"width",se=ge[oe],Ei=se+Kt[pi],Ml=se-Kt[Fl],Xi=Ct?-Qe[Ul]/2:0,Ea=Ie===ln?ue[Ul]:Qe[Ul],ci=Ie===ln?-Qe[Ul]:-ue[Ul],gi=p.elements.arrow,el=Ct&&gi?sc(gi):{width:0,height:0},ml=p.modifiersData["arrow#persistent"]?p.modifiersData["arrow#persistent"].padding:Wr(),ll=ml[pi],zi=ml[Fl],Al=bc(0,ue[Ul],el[Ul]),ji=Ue?ue[Ul]/2-Xi-Al-ll-Me.mainAxis:Ea-Al-ll-Me.mainAxis,oi=Ue?-ue[Ul]/2+Xi+Al+zi+Me.mainAxis:ci+Al+zi+Me.mainAxis,Ra=p.elements.arrow&&ka(p.elements.arrow),Le=Ra?oe==="y"?Ra.clientTop||0:Ra.clientLeft||0:0,si=(cl=He?.[oe])!=null?cl:0,Ji=se+ji-si-Le,Ee=se+oi-si,Ri=bc(Ct?oc(Ei,Ji):Ei,se,Ct?Qa(Ml,Ee):Ml);ge[oe]=Ri,Cl[oe]=Ri-se}if(Ft){var ui,za=oe==="x"?bl:ul,ea=oe==="x"?Sl:Il,Yl=ge[ce],Fi=ce==="y"?"height":"width",la=Yl+Kt[za],Ql=Yl-Kt[ea],ua=[bl,ul].indexOf($t)!==-1,ja=(ui=He?.[ce])!=null?ui:0,ia=ua?la:Yl-ue[Fi]-Qe[Fi]-ja+Me.altAxis,Fa=ua?Yl+ue[Fi]+Qe[Fi]-ja-Me.altAxis:Ql,Ai=Ct&&ua?Nh(ia,Yl,Fa):bc(Ct?ia:la,Yl,Ct?Fa:Ql);ge[ce]=Ai,Cl[ce]=Ai-Yl}p.modifiersData[E]=Cl}}var bb={name:"preventOverflow",enabled:!0,phase:"main",fn:QR,requiresIfExists:["offset"]};function p1(M){return{scrollLeft:M.scrollLeft,scrollTop:M.scrollTop}}function g1(M){return M===dl(M)||!jl(M)?mc(M):p1(M)}function kR(M){var p=M.getBoundingClientRect(),U=Tn(p.width)/M.offsetWidth||1,E=Tn(p.height)/M.offsetHeight||1;return U!==1||E!==1}function R1(M,p,U){U===void 0&&(U=!1);var E=jl(p),I=jl(p)&&kR(p),o=di(p),lt=Za(M,I,U),Ft={scrollLeft:0,scrollTop:0},Ut={x:0,y:0};return(E||!E&&!U)&&((ql(p)!=="body"||Zc(o))&&(Ft=g1(p)),jl(p)?(Ut=Za(p,!0),Ut.x+=p.clientLeft,Ut.y+=p.clientTop):o&&(Ut.x=Wc(o))),{x:lt.left+Ft.scrollLeft-Ut.x,y:lt.top+Ft.scrollTop-Ut.y,width:lt.width,height:lt.height}}function LR(M){var p=new Map,U=new Set,E=[];M.forEach(function(o){p.set(o.name,o)});function I(o){U.add(o.name);var lt=[].concat(o.requires||[],o.requiresIfExists||[]);lt.forEach(function(Ft){if(!U.has(Ft)){var Ut=p.get(Ft);Ut&&I(Ut)}}),E.push(o)}return M.forEach(function(o){U.has(o.name)||I(o)}),E}function u1(M){var p=LR(M);return r1.reduce(function(U,E){return U.concat(p.filter(function(I){return I.phase===E}))},[])}function F1(M){var p;return function(){return p||(p=new Promise(function(U){Promise.resolve().then(function(){p=void 0,U(M())})})),p}}function G1(M){var p=M.reduce(function(U,E){var I=U[E.name];return U[E.name]=I?Object.assign({},I,E,{options:Object.assign({},I.options,E.options),data:Object.assign({},I.data,E.data)}):E,U},{});return Object.keys(p).map(function(U){return p[U]})}var xh={placement:"bottom",modifiers:[],strategy:"absolute"};function Th(){for(var M=arguments.length,p=new Array(M),U=0;U<M;U++)p[U]=arguments[U];return!p.some(function(E){return!(E&&typeof E.getBoundingClientRect=="function")})}function hc(M){M===void 0&&(M={});var p=M,U=p.defaultModifiers,E=U===void 0?[]:U,I=p.defaultOptions,o=I===void 0?xh:I;return function(Ft,Ut,Et){Et===void 0&&(Et=o);var Bt={placement:"bottom",orderedModifiers:[],options:Object.assign({},xh,o),modifiersData:{},elements:{reference:Ft,popper:Ut},attributes:{},styles:{}},ft=[],le=!1,Ct={state:Bt,setOptions:function($t){var Ie=typeof $t=="function"?$t(Bt.options):$t;ne(),Bt.options=Object.assign({},o,Bt.options,Ie),Bt.scrollParents={reference:Wa(Ft)?bd(Ft):Ft.contextElement?bd(Ft.contextElement):[],popper:bd(Ut)};var Ue=u1(G1([].concat(E,Bt.options.modifiers)));return Bt.orderedModifiers=Ue.filter(function(oe){return oe.enabled}),rt(),Ct.update()},forceUpdate:function(){if(!le){var $t=Bt.elements,Ie=$t.reference,Ue=$t.popper;if(Th(Ie,Ue)){Bt.rects={reference:R1(Ie,ka(Ue),Bt.options.strategy==="fixed"),popper:sc(Ue)},Bt.reset=!1,Bt.placement=Bt.options.placement,Bt.orderedModifiers.forEach(function(Me){return Bt.modifiersData[Me.name]=Object.assign({},Me.data)});for(var oe=0;oe<Bt.orderedModifiers.length;oe++){if(Bt.reset===!0){Bt.reset=!1,oe=-1;continue}var ce=Bt.orderedModifiers[oe],ge=ce.fn,ue=ce.options,Qe=ue===void 0?{}:ue,ke=ce.name;typeof ge=="function"&&(Bt=ge({state:Bt,options:Qe,name:ke,instance:Ct})||Bt)}}}},update:F1(function(){return new Promise(function(Kt){Ct.forceUpdate(),Kt(Bt)})}),destroy:function(){ne(),le=!0}};if(!Th(Ft,Ut))return Ct;Ct.setOptions(Et).then(function(Kt){!le&&Et.onFirstUpdate&&Et.onFirstUpdate(Kt)});function rt(){Bt.orderedModifiers.forEach(function(Kt){var $t=Kt.name,Ie=Kt.options,Ue=Ie===void 0?{}:Ie,oe=Kt.effect;if(typeof oe=="function"){var ce=oe({state:Bt,name:$t,instance:Ct,options:Ue}),ge=function(){};ft.push(ce||ge)}})}function ne(){ft.forEach(function(Kt){return Kt()}),ft=[]}return Ct}}var Xh=hc();var ER=[xo,Jo,Yo,Uo],Jh=hc({defaultModifiers:ER});var zR=[xo,Jo,Yo,Uo,rb,ob,bb,ab,sb],pr=hc({defaultModifiers:zR});var md=new Map,N1={set(M,p,U){md.has(M)||md.set(M,new Map);let E=md.get(M);if(!E.has(p)&&E.size!==0){console.error(`Bootstrap doesn't allow more than one instance per element. Bound instance: ${Array.from(E.keys())[0]}.`);return}E.set(p,U)},get(M,p){return md.has(M)&&md.get(M).get(p)||null},remove(M,p){if(!md.has(M))return;let U=md.get(M);U.delete(p),U.size===0&&md.delete(M)}},jR=1e6,AR=1e3,E1="transitionend",dV=M=>(M&&window.CSS&&window.CSS.escape&&(M=M.replace(/#([^\s"#']+)/g,(p,U)=>`#${CSS.escape(U)}`)),M),wR=M=>M==null?`${M}`:Object.prototype.toString.call(M).match(/\s([a-z]+)/i)[1].toLowerCase(),vR=M=>{do M+=Math.floor(Math.random()*jR);while(document.getElementById(M));return M},HR=M=>{if(!M)return 0;let{transitionDuration:p,transitionDelay:U}=window.getComputedStyle(M),E=Number.parseFloat(p),I=Number.parseFloat(U);return!E&&!I?0:(p=p.split(",")[0],U=U.split(",")[0],(Number.parseFloat(p)+Number.parseFloat(U))*AR)},cV=M=>{M.dispatchEvent(new Event(E1))},Jn=M=>!M||typeof M!="object"?!1:(typeof M.jquery<"u"&&(M=M[0]),typeof M.nodeType<"u"),Wd=M=>Jn(M)?M.jquery?M[0]:M:typeof M=="string"&&M.length>0?document.querySelector(dV(M)):null,Eo=M=>{if(!Jn(M)||M.getClientRects().length===0)return!1;let p=getComputedStyle(M).getPropertyValue("visibility")==="visible",U=M.closest("details:not([open])");if(!U)return p;if(U!==M){let E=M.closest("summary");if(E&&E.parentNode!==U||E===null)return!1}return p},Zd=M=>!M||M.nodeType!==Node.ELEMENT_NODE||M.classList.contains("disabled")?!0:typeof M.disabled<"u"?M.disabled:M.hasAttribute("disabled")&&M.getAttribute("disabled")!=="false",oV=M=>{if(!document.documentElement.attachShadow)return null;if(typeof M.getRootNode=="function"){let p=M.getRootNode();return p instanceof ShadowRoot?p:null}return M instanceof ShadowRoot?M:M.parentNode?oV(M.parentNode):null},Fb=()=>{},Nr=M=>{M.offsetHeight},sV=()=>window.jQuery&&!document.body.hasAttribute("data-bs-no-jquery")?window.jQuery:null,I1=[],DR=M=>{document.readyState==="loading"?(I1.length||document.addEventListener("DOMContentLoaded",()=>{for(let p of I1)p()}),I1.push(M)):M()},Va=()=>document.documentElement.dir==="rtl",ga=M=>{DR(()=>{let p=sV();if(p){let U=M.NAME,E=p.fn[U];p.fn[U]=M.jQueryInterface,p.fn[U].Constructor=M,p.fn[U].noConflict=()=>(p.fn[U]=E,M.jQueryInterface)}})},Li=(M,p=[],U=M)=>typeof M=="function"?M.call(...p):U,rV=(M,p,U=!0)=>{if(!U){Li(M);return}let I=HR(p)+5,o=!1,lt=({target:Ft})=>{Ft===p&&(o=!0,p.removeEventListener(E1,lt),Li(M))};p.addEventListener(E1,lt),setTimeout(()=>{o||cV(p)},I)},v1=(M,p,U,E)=>{let I=M.length,o=M.indexOf(p);return o===-1?!U&&E?M[I-1]:M[0]:(o+=U?1:-1,E&&(o=(o+I)%I),M[Math.max(0,Math.min(o,I-1))])},OR=/[^.]*(?=\..*)\.|.*/,fR=/\..*/,_R=/::\d+$/,U1={},yh=1,bV={mouseenter:"mouseover",mouseleave:"mouseout"},KR=new Set(["click","dblclick","mouseup","mousedown","contextmenu","mousewheel","DOMMouseScroll","mouseover","mouseout","mousemove","selectstart","selectend","keydown","keypress","keyup","orientationchange","touchstart","touchmove","touchend","touchcancel","pointerdown","pointermove","pointerup","pointerleave","pointercancel","gesturestart","gesturechange","gestureend","focus","blur","change","reset","select","submit","focusin","focusout","load","unload","beforeunload","resize","move","DOMContentLoaded","readystatechange","error","abort","scroll"]);function mV(M,p){return p&&`${p}::${yh++}`||M.uidEvent||yh++}function WV(M){let p=mV(M);return M.uidEvent=p,U1[p]=U1[p]||{},U1[p]}function PR(M,p){return function U(E){return H1(E,{delegateTarget:M}),U.oneOff&&yt.off(M,E.type,p),p.apply(M,[E])}}function qR(M,p,U){return function E(I){let o=M.querySelectorAll(p);for(let{target:lt}=I;lt&&lt!==this;lt=lt.parentNode)for(let Ft of o)if(Ft===lt)return H1(I,{delegateTarget:lt}),E.oneOff&&yt.off(M,I.type,p,U),U.apply(lt,[I])}}function ZV(M,p,U=null){return Object.values(M).find(E=>E.callable===p&&E.delegationSelector===U)}function hV(M,p,U){let E=typeof p=="string",I=E?U:p||U,o=VV(M);return KR.has(o)||(o=M),[E,I,o]}function Bh(M,p,U,E,I){if(typeof p!="string"||!M)return;let[o,lt,Ft]=hV(p,U,E);p in bV&&(lt=(rt=>function(ne){if(!ne.relatedTarget||ne.relatedTarget!==ne.delegateTarget&&!ne.delegateTarget.contains(ne.relatedTarget))return rt.call(this,ne)})(lt));let Ut=WV(M),Et=Ut[Ft]||(Ut[Ft]={}),Bt=ZV(Et,lt,o?U:null);if(Bt){Bt.oneOff=Bt.oneOff&&I;return}let ft=mV(lt,p.replace(OR,"")),le=o?qR(M,U,lt):PR(M,lt);le.delegationSelector=o?U:null,le.callable=lt,le.oneOff=I,le.uidEvent=ft,Et[ft]=le,M.addEventListener(Ft,le,o)}function z1(M,p,U,E,I){let o=ZV(p[U],E,I);o&&(M.removeEventListener(U,o,!!I),delete p[U][o.uidEvent])}function $R(M,p,U,E){let I=p[U]||{};for(let[o,lt]of Object.entries(I))o.includes(E)&&z1(M,p,U,lt.callable,lt.delegationSelector)}function VV(M){return M=M.replace(fR,""),bV[M]||M}var yt={on(M,p,U,E){Bh(M,p,U,E,!1)},one(M,p,U,E){Bh(M,p,U,E,!0)},off(M,p,U,E){if(typeof p!="string"||!M)return;let[I,o,lt]=hV(p,U,E),Ft=lt!==p,Ut=WV(M),Et=Ut[lt]||{},Bt=p.startsWith(".");if(typeof o<"u"){if(!Object.keys(Et).length)return;z1(M,Ut,lt,o,I?U:null);return}if(Bt)for(let ft of Object.keys(Ut))$R(M,Ut,ft,p.slice(1));for(let[ft,le]of Object.entries(Et)){let Ct=ft.replace(_R,"");(!Ft||p.includes(Ct))&&z1(M,Ut,lt,le.callable,le.delegationSelector)}},trigger(M,p,U){if(typeof p!="string"||!M)return null;let E=sV(),I=VV(p),o=p!==I,lt=null,Ft=!0,Ut=!0,Et=!1;o&&E&&(lt=E.Event(p,U),E(M).trigger(lt),Ft=!lt.isPropagationStopped(),Ut=!lt.isImmediatePropagationStopped(),Et=lt.isDefaultPrevented());let Bt=H1(new Event(p,{bubbles:Ft,cancelable:!0}),U);return Et&&Bt.preventDefault(),Ut&&M.dispatchEvent(Bt),Bt.defaultPrevented&&lt&&lt.preventDefault(),Bt}};function H1(M,p={}){for(let[U,E]of Object.entries(p))try{M[U]=E}catch{Object.defineProperty(M,U,{configurable:!0,get(){return E}})}return M}function Sh(M){if(M==="true")return!0;if(M==="false")return!1;if(M===Number(M).toString())return Number(M);if(M===""||M==="null")return null;if(typeof M!="string")return M;try{return JSON.parse(decodeURIComponent(M))}catch{return M}}function M1(M){return M.replace(/[A-Z]/g,p=>`-${p.toLowerCase()}`)}var yn={setDataAttribute(M,p,U){M.setAttribute(`data-bs-${M1(p)}`,U)},removeDataAttribute(M,p){M.removeAttribute(`data-bs-${M1(p)}`)},getDataAttributes(M){if(!M)return{};let p={},U=Object.keys(M.dataset).filter(E=>E.startsWith("bs")&&!E.startsWith("bsConfig"));for(let E of U){let I=E.replace(/^bs/,"");I=I.charAt(0).toLowerCase()+I.slice(1),p[I]=Sh(M.dataset[E])}return p},getDataAttribute(M,p){return Sh(M.getAttribute(`data-bs-${M1(p)}`))}},gc=class{static get Default(){return{}}static get DefaultType(){return{}}static get NAME(){throw new Error('You have to implement the static method "NAME", for each component!')}_getConfig(p){return p=this._mergeConfigObj(p),p=this._configAfterMerge(p),this._typeCheckConfig(p),p}_configAfterMerge(p){return p}_mergeConfigObj(p,U){let E=Jn(U)?yn.getDataAttribute(U,"config"):{};return{...this.constructor.Default,...typeof E=="object"?E:{},...Jn(U)?yn.getDataAttributes(U):{},...typeof p=="object"?p:{}}}_typeCheckConfig(p,U=this.constructor.DefaultType){for(let[E,I]of Object.entries(U)){let o=p[E],lt=Jn(o)?"element":wR(o);if(!new RegExp(I).test(lt))throw new TypeError(`${this.constructor.NAME.toUpperCase()}: Option "${E}" provided type "${lt}" but expected type "${I}".`)}}},tu="5.3.8",ta=class extends gc{constructor(p,U){super(),p=Wd(p),p&&(this._element=p,this._config=this._getConfig(U),N1.set(this._element,this.constructor.DATA_KEY,this))}dispose(){N1.remove(this._element,this.constructor.DATA_KEY),yt.off(this._element,this.constructor.EVENT_KEY);for(let p of Object.getOwnPropertyNames(this))this[p]=null}_queueCallback(p,U,E=!0){rV(p,U,E)}_getConfig(p){return p=this._mergeConfigObj(p,this._element),p=this._configAfterMerge(p),this._typeCheckConfig(p),p}static getInstance(p){return N1.get(Wd(p),this.DATA_KEY)}static getOrCreateInstance(p,U={}){return this.getInstance(p)||new this(p,typeof U=="object"?U:null)}static get VERSION(){return tu}static get DATA_KEY(){return`bs.${this.NAME}`}static get EVENT_KEY(){return`.${this.DATA_KEY}`}static eventName(p){return`${p}${this.EVENT_KEY}`}},Y1=M=>{let p=M.getAttribute("data-bs-target");if(!p||p==="#"){let U=M.getAttribute("href");if(!U||!U.includes("#")&&!U.startsWith("."))return null;U.includes("#")&&!U.startsWith("#")&&(U=`#${U.split("#")[1]}`),p=U&&U!=="#"?U.trim():null}return p?p.split(",").map(U=>dV(U)).join(","):null},qt={find(M,p=document.documentElement){return[].concat(...Element.prototype.querySelectorAll.call(p,M))},findOne(M,p=document.documentElement){return Element.prototype.querySelector.call(p,M)},children(M,p){return[].concat(...M.children).filter(U=>U.matches(p))},parents(M,p){let U=[],E=M.parentNode.closest(p);for(;E;)U.push(E),E=E.parentNode.closest(p);return U},prev(M,p){let U=M.previousElementSibling;for(;U;){if(U.matches(p))return[U];U=U.previousElementSibling}return[]},next(M,p){let U=M.nextElementSibling;for(;U;){if(U.matches(p))return[U];U=U.nextElementSibling}return[]},focusableChildren(M){let p=["a","button","input","textarea","select","details","[tabindex]",'[contenteditable="true"]'].map(U=>`${U}:not([tabindex^="-"])`).join(",");return this.find(p,M).filter(U=>!Zd(U)&&Eo(U))},getSelectorFromElement(M){let p=Y1(M);return p&&qt.findOne(p)?p:null},getElementFromSelector(M){let p=Y1(M);return p?qt.findOne(p):null},getMultipleElementsFromSelector(M){let p=Y1(M);return p?qt.find(p):[]}},Jb=(M,p="hide")=>{let U=`click.dismiss${M.EVENT_KEY}`,E=M.NAME;yt.on(document,U,`[data-bs-dismiss="${E}"]`,function(I){if(["A","AREA"].includes(this.tagName)&&I.preventDefault(),Zd(this))return;let o=qt.getElementFromSelector(this)||this.closest(`.${E}`);M.getOrCreateInstance(o)[p]()})},eu="alert",lu="bs.alert",pV=`.${lu}`,iu=`close${pV}`,au=`closed${pV}`,nu="fade",du="show",Gb=class M extends ta{static get NAME(){return eu}close(){if(yt.trigger(this._element,iu).defaultPrevented)return;this._element.classList.remove(du);let U=this._element.classList.contains(nu);this._queueCallback(()=>this._destroyElement(),this._element,U)}_destroyElement(){this._element.remove(),yt.trigger(this._element,au),this.dispose()}static jQueryInterface(p){return this.each(function(){let U=M.getOrCreateInstance(this);if(typeof p=="string"){if(U[p]===void 0||p.startsWith("_")||p==="constructor")throw new TypeError(`No method named "${p}"`);U[p](this)}})}};Jb(Gb,"close");ga(Gb);var cu="button",ou="bs.button",su=`.${ou}`,ru=".data-api",bu="active",Ch='[data-bs-toggle="button"]',mu=`click${su}${ru}`,Nb=class M extends ta{static get NAME(){return cu}toggle(){this._element.setAttribute("aria-pressed",this._element.classList.toggle(bu))}static jQueryInterface(p){return this.each(function(){let U=M.getOrCreateInstance(this);p==="toggle"&&U[p]()})}};yt.on(document,mu,Ch,M=>{M.preventDefault();let p=M.target.closest(Ch);Nb.getOrCreateInstance(p).toggle()});ga(Nb);var Wu="swipe",zo=".bs.swipe",Zu=`touchstart${zo}`,hu=`touchmove${zo}`,Vu=`touchend${zo}`,pu=`pointerdown${zo}`,gu=`pointerup${zo}`,Ru="touch",uu="pen",Fu="pointer-event",Gu=40,Nu={endCallback:null,leftCallback:null,rightCallback:null},Iu={endCallback:"(function|null)",leftCallback:"(function|null)",rightCallback:"(function|null)"},Ib=class M extends gc{constructor(p,U){super(),this._element=p,!(!p||!M.isSupported())&&(this._config=this._getConfig(U),this._deltaX=0,this._supportPointerEvents=!!window.PointerEvent,this._initEvents())}static get Default(){return Nu}static get DefaultType(){return Iu}static get NAME(){return Wu}dispose(){yt.off(this._element,zo)}_start(p){if(!this._supportPointerEvents){this._deltaX=p.touches[0].clientX;return}this._eventIsPointerPenTouch(p)&&(this._deltaX=p.clientX)}_end(p){this._eventIsPointerPenTouch(p)&&(this._deltaX=p.clientX-this._deltaX),this._handleSwipe(),Li(this._config.endCallback)}_move(p){this._deltaX=p.touches&&p.touches.length>1?0:p.touches[0].clientX-this._deltaX}_handleSwipe(){let p=Math.abs(this._deltaX);if(p<=Gu)return;let U=p/this._deltaX;this._deltaX=0,U&&Li(U>0?this._config.rightCallback:this._config.leftCallback)}_initEvents(){this._supportPointerEvents?(yt.on(this._element,pu,p=>this._start(p)),yt.on(this._element,gu,p=>this._end(p)),this._element.classList.add(Fu)):(yt.on(this._element,Zu,p=>this._start(p)),yt.on(this._element,hu,p=>this._move(p)),yt.on(this._element,Vu,p=>this._end(p)))}_eventIsPointerPenTouch(p){return this._supportPointerEvents&&(p.pointerType===uu||p.pointerType===Ru)}static isSupported(){return"ontouchstart"in document.documentElement||navigator.maxTouchPoints>0}},Uu="carousel",Mu="bs.carousel",pd=`.${Mu}`,gV=".data-api",Yu="ArrowLeft",xu="ArrowRight",Tu=500,gr="next",yo="prev",So="left",Rb="right",Xu=`slide${pd}`,x1=`slid${pd}`,Ju=`keydown${pd}`,yu=`mouseenter${pd}`,Bu=`mouseleave${pd}`,Su=`dragstart${pd}`,Cu=`load${pd}${gV}`,Qu=`click${pd}${gV}`,RV="carousel",Wb="active",ku="slide",Lu="carousel-item-end",Eu="carousel-item-start",zu="carousel-item-next",ju="carousel-item-prev",uV=".active",FV=".carousel-item",Au=uV+FV,wu=".carousel-item img",vu=".carousel-indicators",Hu="[data-bs-slide], [data-bs-slide-to]",Du='[data-bs-ride="carousel"]',Ou={[Yu]:Rb,[xu]:So},fu={interval:5e3,keyboard:!0,pause:"hover",ride:!1,touch:!0,wrap:!0},_u={interval:"(number|boolean)",keyboard:"boolean",pause:"(string|boolean)",ride:"(boolean|string)",touch:"boolean",wrap:"boolean"},ur=class M extends ta{constructor(p,U){super(p,U),this._interval=null,this._activeElement=null,this._isSliding=!1,this.touchTimeout=null,this._swipeHelper=null,this._indicatorsElement=qt.findOne(vu,this._element),this._addEventListeners(),this._config.ride===RV&&this.cycle()}static get Default(){return fu}static get DefaultType(){return _u}static get NAME(){return Uu}next(){this._slide(gr)}nextWhenVisible(){!document.hidden&&Eo(this._element)&&this.next()}prev(){this._slide(yo)}pause(){this._isSliding&&cV(this._element),this._clearInterval()}cycle(){this._clearInterval(),this._updateInterval(),this._interval=setInterval(()=>this.nextWhenVisible(),this._config.interval)}_maybeEnableCycle(){if(this._config.ride){if(this._isSliding){yt.one(this._element,x1,()=>this.cycle());return}this.cycle()}}to(p){let U=this._getItems();if(p>U.length-1||p<0)return;if(this._isSliding){yt.one(this._element,x1,()=>this.to(p));return}let E=this._getItemIndex(this._getActive());if(E===p)return;let I=p>E?gr:yo;this._slide(I,U[p])}dispose(){this._swipeHelper&&this._swipeHelper.dispose(),super.dispose()}_configAfterMerge(p){return p.defaultInterval=p.interval,p}_addEventListeners(){this._config.keyboard&&yt.on(this._element,Ju,p=>this._keydown(p)),this._config.pause==="hover"&&(yt.on(this._element,yu,()=>this.pause()),yt.on(this._element,Bu,()=>this._maybeEnableCycle())),this._config.touch&&Ib.isSupported()&&this._addTouchEventListeners()}_addTouchEventListeners(){for(let E of qt.find(wu,this._element))yt.on(E,Su,I=>I.preventDefault());let U={leftCallback:()=>this._slide(this._directionToOrder(So)),rightCallback:()=>this._slide(this._directionToOrder(Rb)),endCallback:()=>{this._config.pause==="hover"&&(this.pause(),this.touchTimeout&&clearTimeout(this.touchTimeout),this.touchTimeout=setTimeout(()=>this._maybeEnableCycle(),Tu+this._config.interval))}};this._swipeHelper=new Ib(this._element,U)}_keydown(p){if(/input|textarea/i.test(p.target.tagName))return;let U=Ou[p.key];U&&(p.preventDefault(),this._slide(this._directionToOrder(U)))}_getItemIndex(p){return this._getItems().indexOf(p)}_setActiveIndicatorElement(p){if(!this._indicatorsElement)return;let U=qt.findOne(uV,this._indicatorsElement);U.classList.remove(Wb),U.removeAttribute("aria-current");let E=qt.findOne(`[data-bs-slide-to="${p}"]`,this._indicatorsElement);E&&(E.classList.add(Wb),E.setAttribute("aria-current","true"))}_updateInterval(){let p=this._activeElement||this._getActive();if(!p)return;let U=Number.parseInt(p.getAttribute("data-bs-interval"),10);this._config.interval=U||this._config.defaultInterval}_slide(p,U=null){if(this._isSliding)return;let E=this._getActive(),I=p===gr,o=U||v1(this._getItems(),E,I,this._config.wrap);if(o===E)return;let lt=this._getItemIndex(o),Ft=Ct=>yt.trigger(this._element,Ct,{relatedTarget:o,direction:this._orderToDirection(p),from:this._getItemIndex(E),to:lt});if(Ft(Xu).defaultPrevented||!E||!o)return;let Et=!!this._interval;this.pause(),this._isSliding=!0,this._setActiveIndicatorElement(lt),this._activeElement=o;let Bt=I?Eu:Lu,ft=I?zu:ju;o.classList.add(ft),Nr(o),E.classList.add(Bt),o.classList.add(Bt);let le=()=>{o.classList.remove(Bt,ft),o.classList.add(Wb),E.classList.remove(Wb,ft,Bt),this._isSliding=!1,Ft(x1)};this._queueCallback(le,E,this._isAnimated()),Et&&this.cycle()}_isAnimated(){return this._element.classList.contains(ku)}_getActive(){return qt.findOne(Au,this._element)}_getItems(){return qt.find(FV,this._element)}_clearInterval(){this._interval&&(clearInterval(this._interval),this._interval=null)}_directionToOrder(p){return Va()?p===So?yo:gr:p===So?gr:yo}_orderToDirection(p){return Va()?p===yo?So:Rb:p===yo?Rb:So}static jQueryInterface(p){return this.each(function(){let U=M.getOrCreateInstance(this,p);if(typeof p=="number"){U.to(p);return}if(typeof p=="string"){if(U[p]===void 0||p.startsWith("_")||p==="constructor")throw new TypeError(`No method named "${p}"`);U[p]()}})}};yt.on(document,Qu,Hu,function(M){let p=qt.getElementFromSelector(this);if(!p||!p.classList.contains(RV))return;M.preventDefault();let U=ur.getOrCreateInstance(p),E=this.getAttribute("data-bs-slide-to");if(E){U.to(E),U._maybeEnableCycle();return}if(yn.getDataAttribute(this,"slide")==="next"){U.next(),U._maybeEnableCycle();return}U.prev(),U._maybeEnableCycle()});yt.on(window,Cu,()=>{let M=qt.find(Du);for(let p of M)ur.getOrCreateInstance(p)});ga(ur);var Ku="collapse",Pu="bs.collapse",Ir=`.${Pu}`,qu=".data-api",$u=`show${Ir}`,tF=`shown${Ir}`,eF=`hide${Ir}`,lF=`hidden${Ir}`,iF=`click${Ir}${qu}`,T1="show",Qo="collapse",Zb="collapsing",aF="collapsed",nF=`:scope .${Qo} .${Qo}`,dF="collapse-horizontal",cF="width",oF="height",sF=".collapse.show, .collapse.collapsing",j1='[data-bs-toggle="collapse"]',rF={parent:null,toggle:!0},bF={parent:"(null|element)",toggle:"boolean"},Ub=class M extends ta{constructor(p,U){super(p,U),this._isTransitioning=!1,this._triggerArray=[];let E=qt.find(j1);for(let I of E){let o=qt.getSelectorFromElement(I),lt=qt.find(o).filter(Ft=>Ft===this._element);o!==null&&lt.length&&this._triggerArray.push(I)}this._initializeChildren(),this._config.parent||this._addAriaAndCollapsedClass(this._triggerArray,this._isShown()),this._config.toggle&&this.toggle()}static get Default(){return rF}static get DefaultType(){return bF}static get NAME(){return Ku}toggle(){this._isShown()?this.hide():this.show()}show(){if(this._isTransitioning||this._isShown())return;let p=[];if(this._config.parent&&(p=this._getFirstLevelChildren(sF).filter(Ft=>Ft!==this._element).map(Ft=>M.getOrCreateInstance(Ft,{toggle:!1}))),p.length&&p[0]._isTransitioning||yt.trigger(this._element,$u).defaultPrevented)return;for(let Ft of p)Ft.hide();let E=this._getDimension();this._element.classList.remove(Qo),this._element.classList.add(Zb),this._element.style[E]=0,this._addAriaAndCollapsedClass(this._triggerArray,!0),this._isTransitioning=!0;let I=()=>{this._isTransitioning=!1,this._element.classList.remove(Zb),this._element.classList.add(Qo,T1),this._element.style[E]="",yt.trigger(this._element,tF)},lt=`scroll${E[0].toUpperCase()+E.slice(1)}`;this._queueCallback(I,this._element,!0),this._element.style[E]=`${this._element[lt]}px`}hide(){if(this._isTransitioning||!this._isShown()||yt.trigger(this._element,eF).defaultPrevented)return;let U=this._getDimension();this._element.style[U]=`${this._element.getBoundingClientRect()[U]}px`,Nr(this._element),this._element.classList.add(Zb),this._element.classList.remove(Qo,T1);for(let I of this._triggerArray){let o=qt.getElementFromSelector(I);o&&!this._isShown(o)&&this._addAriaAndCollapsedClass([I],!1)}this._isTransitioning=!0;let E=()=>{this._isTransitioning=!1,this._element.classList.remove(Zb),this._element.classList.add(Qo),yt.trigger(this._element,lF)};this._element.style[U]="",this._queueCallback(E,this._element,!0)}_isShown(p=this._element){return p.classList.contains(T1)}_configAfterMerge(p){return p.toggle=!!p.toggle,p.parent=Wd(p.parent),p}_getDimension(){return this._element.classList.contains(dF)?cF:oF}_initializeChildren(){if(!this._config.parent)return;let p=this._getFirstLevelChildren(j1);for(let U of p){let E=qt.getElementFromSelector(U);E&&this._addAriaAndCollapsedClass([U],this._isShown(E))}}_getFirstLevelChildren(p){let U=qt.find(nF,this._config.parent);return qt.find(p,this._config.parent).filter(E=>!U.includes(E))}_addAriaAndCollapsedClass(p,U){if(p.length)for(let E of p)E.classList.toggle(aF,!U),E.setAttribute("aria-expanded",U)}static jQueryInterface(p){let U={};return typeof p=="string"&&/show|hide/.test(p)&&(U.toggle=!1),this.each(function(){let E=M.getOrCreateInstance(this,U);if(typeof p=="string"){if(typeof E[p]>"u")throw new TypeError(`No method named "${p}"`);E[p]()}})}};yt.on(document,iF,j1,function(M){(M.target.tagName==="A"||M.delegateTarget&&M.delegateTarget.tagName==="A")&&M.preventDefault();for(let p of qt.getMultipleElementsFromSelector(this))Ub.getOrCreateInstance(p,{toggle:!1}).toggle()});ga(Ub);var Qh="dropdown",mF="bs.dropdown",Rc=`.${mF}`,D1=".data-api",WF="Escape",kh="Tab",ZF="ArrowUp",Lh="ArrowDown",hF=2,VF=`hide${Rc}`,pF=`hidden${Rc}`,gF=`show${Rc}`,RF=`shown${Rc}`,GV=`click${Rc}${D1}`,NV=`keydown${Rc}${D1}`,uF=`keyup${Rc}${D1}`,Co="show",FF="dropup",GF="dropend",NF="dropstart",IF="dropup-center",UF="dropdown-center",Vc='[data-bs-toggle="dropdown"]:not(.disabled):not(:disabled)',MF=`${Vc}.${Co}`,ub=".dropdown-menu",YF=".navbar",xF=".navbar-nav",TF=".dropdown-menu .dropdown-item:not(.disabled):not(:disabled)",XF=Va()?"top-end":"top-start",JF=Va()?"top-start":"top-end",yF=Va()?"bottom-end":"bottom-start",BF=Va()?"bottom-start":"bottom-end",SF=Va()?"left-start":"right-start",CF=Va()?"right-start":"left-start",QF="top",kF="bottom",LF={autoClose:!0,boundary:"clippingParents",display:"dynamic",offset:[0,2],popperConfig:null,reference:"toggle"},EF={autoClose:"(boolean|string)",boundary:"(string|element)",display:"string",offset:"(array|string|function)",popperConfig:"(null|object|function)",reference:"(string|element|object)"},hd=class M extends ta{constructor(p,U){super(p,U),this._popper=null,this._parent=this._element.parentNode,this._menu=qt.next(this._element,ub)[0]||qt.prev(this._element,ub)[0]||qt.findOne(ub,this._parent),this._inNavbar=this._detectNavbar()}static get Default(){return LF}static get DefaultType(){return EF}static get NAME(){return Qh}toggle(){return this._isShown()?this.hide():this.show()}show(){if(Zd(this._element)||this._isShown())return;let p={relatedTarget:this._element};if(!yt.trigger(this._element,gF,p).defaultPrevented){if(this._createPopper(),"ontouchstart"in document.documentElement&&!this._parent.closest(xF))for(let E of[].concat(...document.body.children))yt.on(E,"mouseover",Fb);this._element.focus(),this._element.setAttribute("aria-expanded",!0),this._menu.classList.add(Co),this._element.classList.add(Co),yt.trigger(this._element,RF,p)}}hide(){if(Zd(this._element)||!this._isShown())return;let p={relatedTarget:this._element};this._completeHide(p)}dispose(){this._popper&&this._popper.destroy(),super.dispose()}update(){this._inNavbar=this._detectNavbar(),this._popper&&this._popper.update()}_completeHide(p){if(!yt.trigger(this._element,VF,p).defaultPrevented){if("ontouchstart"in document.documentElement)for(let E of[].concat(...document.body.children))yt.off(E,"mouseover",Fb);this._popper&&this._popper.destroy(),this._menu.classList.remove(Co),this._element.classList.remove(Co),this._element.setAttribute("aria-expanded","false"),yn.removeDataAttribute(this._menu,"popper"),yt.trigger(this._element,pF,p)}}_getConfig(p){if(p=super._getConfig(p),typeof p.reference=="object"&&!Jn(p.reference)&&typeof p.reference.getBoundingClientRect!="function")throw new TypeError(`${Qh.toUpperCase()}: Option "reference" provided type "object" without a required "getBoundingClientRect" method.`);return p}_createPopper(){if(typeof mb>"u")throw new TypeError("Bootstrap's dropdowns require Popper (https://popper.js.org/docs/v2/)");let p=this._element;this._config.reference==="parent"?p=this._parent:Jn(this._config.reference)?p=Wd(this._config.reference):typeof this._config.reference=="object"&&(p=this._config.reference);let U=this._getPopperConfig();this._popper=pr(p,this._menu,U)}_isShown(){return this._menu.classList.contains(Co)}_getPlacement(){let p=this._parent;if(p.classList.contains(GF))return SF;if(p.classList.contains(NF))return CF;if(p.classList.contains(IF))return QF;if(p.classList.contains(UF))return kF;let U=getComputedStyle(this._menu).getPropertyValue("--bs-position").trim()==="end";return p.classList.contains(FF)?U?JF:XF:U?BF:yF}_detectNavbar(){return this._element.closest(YF)!==null}_getOffset(){let{offset:p}=this._config;return typeof p=="string"?p.split(",").map(U=>Number.parseInt(U,10)):typeof p=="function"?U=>p(U,this._element):p}_getPopperConfig(){let p={placement:this._getPlacement(),modifiers:[{name:"preventOverflow",options:{boundary:this._config.boundary}},{name:"offset",options:{offset:this._getOffset()}}]};return(this._inNavbar||this._config.display==="static")&&(yn.setDataAttribute(this._menu,"popper","static"),p.modifiers=[{name:"applyStyles",enabled:!1}]),{...p,...Li(this._config.popperConfig,[void 0,p])}}_selectMenuItem({key:p,target:U}){let E=qt.find(TF,this._menu).filter(I=>Eo(I));E.length&&v1(E,U,p===Lh,!E.includes(U)).focus()}static jQueryInterface(p){return this.each(function(){let U=M.getOrCreateInstance(this,p);if(typeof p=="string"){if(typeof U[p]>"u")throw new TypeError(`No method named "${p}"`);U[p]()}})}static clearMenus(p){if(p.button===hF||p.type==="keyup"&&p.key!==kh)return;let U=qt.find(MF);for(let E of U){let I=M.getInstance(E);if(!I||I._config.autoClose===!1)continue;let o=p.composedPath(),lt=o.includes(I._menu);if(o.includes(I._element)||I._config.autoClose==="inside"&&!lt||I._config.autoClose==="outside"&&lt||I._menu.contains(p.target)&&(p.type==="keyup"&&p.key===kh||/input|select|option|textarea|form/i.test(p.target.tagName)))continue;let Ft={relatedTarget:I._element};p.type==="click"&&(Ft.clickEvent=p),I._completeHide(Ft)}}static dataApiKeydownHandler(p){let U=/input|textarea/i.test(p.target.tagName),E=p.key===WF,I=[ZF,Lh].includes(p.key);if(!I&&!E||U&&!E)return;p.preventDefault();let o=this.matches(Vc)?this:qt.prev(this,Vc)[0]||qt.next(this,Vc)[0]||qt.findOne(Vc,p.delegateTarget.parentNode),lt=M.getOrCreateInstance(o);if(I){p.stopPropagation(),lt.show(),lt._selectMenuItem(p);return}lt._isShown()&&(p.stopPropagation(),lt.hide(),o.focus())}};yt.on(document,NV,Vc,hd.dataApiKeydownHandler);yt.on(document,NV,ub,hd.dataApiKeydownHandler);yt.on(document,GV,hd.clearMenus);yt.on(document,uF,hd.clearMenus);yt.on(document,GV,Vc,function(M){M.preventDefault(),hd.getOrCreateInstance(this).toggle()});ga(hd);var IV="backdrop",zF="fade",Eh="show",zh=`mousedown.bs.${IV}`,jF={className:"modal-backdrop",clickCallback:null,isAnimated:!1,isVisible:!0,rootElement:"body"},AF={className:"string",clickCallback:"(function|null)",isAnimated:"boolean",isVisible:"boolean",rootElement:"(element|string)"},Mb=class extends gc{constructor(p){super(),this._config=this._getConfig(p),this._isAppended=!1,this._element=null}static get Default(){return jF}static get DefaultType(){return AF}static get NAME(){return IV}show(p){if(!this._config.isVisible){Li(p);return}this._append();let U=this._getElement();this._config.isAnimated&&Nr(U),U.classList.add(Eh),this._emulateAnimation(()=>{Li(p)})}hide(p){if(!this._config.isVisible){Li(p);return}this._getElement().classList.remove(Eh),this._emulateAnimation(()=>{this.dispose(),Li(p)})}dispose(){this._isAppended&&(yt.off(this._element,zh),this._element.remove(),this._isAppended=!1)}_getElement(){if(!this._element){let p=document.createElement("div");p.className=this._config.className,this._config.isAnimated&&p.classList.add(zF),this._element=p}return this._element}_configAfterMerge(p){return p.rootElement=Wd(p.rootElement),p}_append(){if(this._isAppended)return;let p=this._getElement();this._config.rootElement.append(p),yt.on(p,zh,()=>{Li(this._config.clickCallback)}),this._isAppended=!0}_emulateAnimation(p){rV(p,this._getElement(),this._config.isAnimated)}},wF="focustrap",vF="bs.focustrap",Yb=`.${vF}`,HF=`focusin${Yb}`,DF=`keydown.tab${Yb}`,OF="Tab",fF="forward",jh="backward",_F={autofocus:!0,trapElement:null},KF={autofocus:"boolean",trapElement:"element"},xb=class extends gc{constructor(p){super(),this._config=this._getConfig(p),this._isActive=!1,this._lastTabNavDirection=null}static get Default(){return _F}static get DefaultType(){return KF}static get NAME(){return wF}activate(){this._isActive||(this._config.autofocus&&this._config.trapElement.focus(),yt.off(document,Yb),yt.on(document,HF,p=>this._handleFocusin(p)),yt.on(document,DF,p=>this._handleKeydown(p)),this._isActive=!0)}deactivate(){this._isActive&&(this._isActive=!1,yt.off(document,Yb))}_handleFocusin(p){let{trapElement:U}=this._config;if(p.target===document||p.target===U||U.contains(p.target))return;let E=qt.focusableChildren(U);E.length===0?U.focus():this._lastTabNavDirection===jh?E[E.length-1].focus():E[0].focus()}_handleKeydown(p){p.key===OF&&(this._lastTabNavDirection=p.shiftKey?jh:fF)}},Ah=".fixed-top, .fixed-bottom, .is-fixed, .sticky-top",wh=".sticky-top",hb="padding-right",vh="margin-right",Fr=class{constructor(){this._element=document.body}getWidth(){let p=document.documentElement.clientWidth;return Math.abs(window.innerWidth-p)}hide(){let p=this.getWidth();this._disableOverFlow(),this._setElementAttributes(this._element,hb,U=>U+p),this._setElementAttributes(Ah,hb,U=>U+p),this._setElementAttributes(wh,vh,U=>U-p)}reset(){this._resetElementAttributes(this._element,"overflow"),this._resetElementAttributes(this._element,hb),this._resetElementAttributes(Ah,hb),this._resetElementAttributes(wh,vh)}isOverflowing(){return this.getWidth()>0}_disableOverFlow(){this._saveInitialAttribute(this._element,"overflow"),this._element.style.overflow="hidden"}_setElementAttributes(p,U,E){let I=this.getWidth(),o=lt=>{if(lt!==this._element&&window.innerWidth>lt.clientWidth+I)return;this._saveInitialAttribute(lt,U);let Ft=window.getComputedStyle(lt).getPropertyValue(U);lt.style.setProperty(U,`${E(Number.parseFloat(Ft))}px`)};this._applyManipulationCallback(p,o)}_saveInitialAttribute(p,U){let E=p.style.getPropertyValue(U);E&&yn.setDataAttribute(p,U,E)}_resetElementAttributes(p,U){let E=I=>{let o=yn.getDataAttribute(I,U);if(o===null){I.style.removeProperty(U);return}yn.removeDataAttribute(I,U),I.style.setProperty(U,o)};this._applyManipulationCallback(p,E)}_applyManipulationCallback(p,U){if(Jn(p)){U(p);return}for(let E of qt.find(p,this._element))U(E)}},PF="modal",qF="bs.modal",pa=`.${qF}`,$F=".data-api",tG="Escape",eG=`hide${pa}`,lG=`hidePrevented${pa}`,UV=`hidden${pa}`,MV=`show${pa}`,iG=`shown${pa}`,aG=`resize${pa}`,nG=`click.dismiss${pa}`,dG=`mousedown.dismiss${pa}`,cG=`keydown.dismiss${pa}`,oG=`click${pa}${$F}`,Hh="modal-open",sG="fade",Dh="show",X1="modal-static",rG=".modal.show",bG=".modal-dialog",mG=".modal-body",WG='[data-bs-toggle="modal"]',ZG={backdrop:!0,focus:!0,keyboard:!0},hG={backdrop:"(boolean|string)",focus:"boolean",keyboard:"boolean"},ko=class M extends ta{constructor(p,U){super(p,U),this._dialog=qt.findOne(bG,this._element),this._backdrop=this._initializeBackDrop(),this._focustrap=this._initializeFocusTrap(),this._isShown=!1,this._isTransitioning=!1,this._scrollBar=new Fr,this._addEventListeners()}static get Default(){return ZG}static get DefaultType(){return hG}static get NAME(){return PF}toggle(p){return this._isShown?this.hide():this.show(p)}show(p){this._isShown||this._isTransitioning||yt.trigger(this._element,MV,{relatedTarget:p}).defaultPrevented||(this._isShown=!0,this._isTransitioning=!0,this._scrollBar.hide(),document.body.classList.add(Hh),this._adjustDialog(),this._backdrop.show(()=>this._showElement(p)))}hide(){!this._isShown||this._isTransitioning||yt.trigger(this._element,eG).defaultPrevented||(this._isShown=!1,this._isTransitioning=!0,this._focustrap.deactivate(),this._element.classList.remove(Dh),this._queueCallback(()=>this._hideModal(),this._element,this._isAnimated()))}dispose(){yt.off(window,pa),yt.off(this._dialog,pa),this._backdrop.dispose(),this._focustrap.deactivate(),super.dispose()}handleUpdate(){this._adjustDialog()}_initializeBackDrop(){return new Mb({isVisible:!!this._config.backdrop,isAnimated:this._isAnimated()})}_initializeFocusTrap(){return new xb({trapElement:this._element})}_showElement(p){document.body.contains(this._element)||document.body.append(this._element),this._element.style.display="block",this._element.removeAttribute("aria-hidden"),this._element.setAttribute("aria-modal",!0),this._element.setAttribute("role","dialog"),this._element.scrollTop=0;let U=qt.findOne(mG,this._dialog);U&&(U.scrollTop=0),Nr(this._element),this._element.classList.add(Dh);let E=()=>{this._config.focus&&this._focustrap.activate(),this._isTransitioning=!1,yt.trigger(this._element,iG,{relatedTarget:p})};this._queueCallback(E,this._dialog,this._isAnimated())}_addEventListeners(){yt.on(this._element,cG,p=>{if(p.key===tG){if(this._config.keyboard){this.hide();return}this._triggerBackdropTransition()}}),yt.on(window,aG,()=>{this._isShown&&!this._isTransitioning&&this._adjustDialog()}),yt.on(this._element,dG,p=>{yt.one(this._element,nG,U=>{if(!(this._element!==p.target||this._element!==U.target)){if(this._config.backdrop==="static"){this._triggerBackdropTransition();return}this._config.backdrop&&this.hide()}})})}_hideModal(){this._element.style.display="none",this._element.setAttribute("aria-hidden",!0),this._element.removeAttribute("aria-modal"),this._element.removeAttribute("role"),this._isTransitioning=!1,this._backdrop.hide(()=>{document.body.classList.remove(Hh),this._resetAdjustments(),this._scrollBar.reset(),yt.trigger(this._element,UV)})}_isAnimated(){return this._element.classList.contains(sG)}_triggerBackdropTransition(){if(yt.trigger(this._element,lG).defaultPrevented)return;let U=this._element.scrollHeight>document.documentElement.clientHeight,E=this._element.style.overflowY;E==="hidden"||this._element.classList.contains(X1)||(U||(this._element.style.overflowY="hidden"),this._element.classList.add(X1),this._queueCallback(()=>{this._element.classList.remove(X1),this._queueCallback(()=>{this._element.style.overflowY=E},this._dialog)},this._dialog),this._element.focus())}_adjustDialog(){let p=this._element.scrollHeight>document.documentElement.clientHeight,U=this._scrollBar.getWidth(),E=U>0;if(E&&!p){let I=Va()?"paddingLeft":"paddingRight";this._element.style[I]=`${U}px`}if(!E&&p){let I=Va()?"paddingRight":"paddingLeft";this._element.style[I]=`${U}px`}}_resetAdjustments(){this._element.style.paddingLeft="",this._element.style.paddingRight=""}static jQueryInterface(p,U){return this.each(function(){let E=M.getOrCreateInstance(this,p);if(typeof p=="string"){if(typeof E[p]>"u")throw new TypeError(`No method named "${p}"`);E[p](U)}})}};yt.on(document,oG,WG,function(M){let p=qt.getElementFromSelector(this);["A","AREA"].includes(this.tagName)&&M.preventDefault(),yt.one(p,MV,I=>{I.defaultPrevented||yt.one(p,UV,()=>{Eo(this)&&this.focus()})});let U=qt.findOne(rG);U&&ko.getInstance(U).hide(),ko.getOrCreateInstance(p).toggle(this)});Jb(ko);ga(ko);var VG="offcanvas",pG="bs.offcanvas",Bn=`.${pG}`,YV=".data-api",gG=`load${Bn}${YV}`,RG="Escape",Oh="show",fh="showing",_h="hiding",uG="offcanvas-backdrop",xV=".offcanvas.show",FG=`show${Bn}`,GG=`shown${Bn}`,NG=`hide${Bn}`,Kh=`hidePrevented${Bn}`,TV=`hidden${Bn}`,IG=`resize${Bn}`,UG=`click${Bn}${YV}`,MG=`keydown.dismiss${Bn}`,YG='[data-bs-toggle="offcanvas"]',xG={backdrop:!0,keyboard:!0,scroll:!1},TG={backdrop:"(boolean|string)",keyboard:"boolean",scroll:"boolean"},Vd=class M extends ta{constructor(p,U){super(p,U),this._isShown=!1,this._backdrop=this._initializeBackDrop(),this._focustrap=this._initializeFocusTrap(),this._addEventListeners()}static get Default(){return xG}static get DefaultType(){return TG}static get NAME(){return VG}toggle(p){return this._isShown?this.hide():this.show(p)}show(p){if(this._isShown||yt.trigger(this._element,FG,{relatedTarget:p}).defaultPrevented)return;this._isShown=!0,this._backdrop.show(),this._config.scroll||new Fr().hide(),this._element.setAttribute("aria-modal",!0),this._element.setAttribute("role","dialog"),this._element.classList.add(fh);let E=()=>{(!this._config.scroll||this._config.backdrop)&&this._focustrap.activate(),this._element.classList.add(Oh),this._element.classList.remove(fh),yt.trigger(this._element,GG,{relatedTarget:p})};this._queueCallback(E,this._element,!0)}hide(){if(!this._isShown||yt.trigger(this._element,NG).defaultPrevented)return;this._focustrap.deactivate(),this._element.blur(),this._isShown=!1,this._element.classList.add(_h),this._backdrop.hide();let U=()=>{this._element.classList.remove(Oh,_h),this._element.removeAttribute("aria-modal"),this._element.removeAttribute("role"),this._config.scroll||new Fr().reset(),yt.trigger(this._element,TV)};this._queueCallback(U,this._element,!0)}dispose(){this._backdrop.dispose(),this._focustrap.deactivate(),super.dispose()}_initializeBackDrop(){let p=()=>{if(this._config.backdrop==="static"){yt.trigger(this._element,Kh);return}this.hide()},U=!!this._config.backdrop;return new Mb({className:uG,isVisible:U,isAnimated:!0,rootElement:this._element.parentNode,clickCallback:U?p:null})}_initializeFocusTrap(){return new xb({trapElement:this._element})}_addEventListeners(){yt.on(this._element,MG,p=>{if(p.key===RG){if(this._config.keyboard){this.hide();return}yt.trigger(this._element,Kh)}})}static jQueryInterface(p){return this.each(function(){let U=M.getOrCreateInstance(this,p);if(typeof p=="string"){if(U[p]===void 0||p.startsWith("_")||p==="constructor")throw new TypeError(`No method named "${p}"`);U[p](this)}})}};yt.on(document,UG,YG,function(M){let p=qt.getElementFromSelector(this);if(["A","AREA"].includes(this.tagName)&&M.preventDefault(),Zd(this))return;yt.one(p,TV,()=>{Eo(this)&&this.focus()});let U=qt.findOne(xV);U&&U!==p&&Vd.getInstance(U).hide(),Vd.getOrCreateInstance(p).toggle(this)});yt.on(window,gG,()=>{for(let M of qt.find(xV))Vd.getOrCreateInstance(M).show()});yt.on(window,IG,()=>{for(let M of qt.find("[aria-modal][class*=show][class*=offcanvas-]"))getComputedStyle(M).position!=="fixed"&&Vd.getOrCreateInstance(M).hide()});Jb(Vd);ga(Vd);var XG=/^aria-[\w-]*$/i,XV={"*":["class","dir","id","lang","role",XG],a:["target","href","title","rel"],area:[],b:[],br:[],col:[],code:[],dd:[],div:[],dl:[],dt:[],em:[],hr:[],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],i:[],img:["src","srcset","alt","title","width","height"],li:[],ol:[],p:[],pre:[],s:[],small:[],span:[],sub:[],sup:[],strong:[],u:[],ul:[]},JG=new Set(["background","cite","href","itemtype","longdesc","poster","src","xlink:href"]),yG=/^(?!javascript:)(?:[a-z0-9+.-]+:|[^&:/?#]*(?:[/?#]|$))/i,BG=(M,p)=>{let U=M.nodeName.toLowerCase();return p.includes(U)?JG.has(U)?!!yG.test(M.nodeValue):!0:p.filter(E=>E instanceof RegExp).some(E=>E.test(U))};function SG(M,p,U){if(!M.length)return M;if(U&&typeof U=="function")return U(M);let I=new window.DOMParser().parseFromString(M,"text/html"),o=[].concat(...I.body.querySelectorAll("*"));for(let lt of o){let Ft=lt.nodeName.toLowerCase();if(!Object.keys(p).includes(Ft)){lt.remove();continue}let Ut=[].concat(...lt.attributes),Et=[].concat(p["*"]||[],p[Ft]||[]);for(let Bt of Ut)BG(Bt,Et)||lt.removeAttribute(Bt.nodeName)}return I.body.innerHTML}var CG="TemplateFactory",QG={allowList:XV,content:{},extraClass:"",html:!1,sanitize:!0,sanitizeFn:null,template:"<div></div>"},kG={allowList:"object",content:"object",extraClass:"(string|function)",html:"boolean",sanitize:"boolean",sanitizeFn:"(null|function)",template:"string"},LG={entry:"(string|element|function|null)",selector:"(string|element)"},A1=class extends gc{constructor(p){super(),this._config=this._getConfig(p)}static get Default(){return QG}static get DefaultType(){return kG}static get NAME(){return CG}getContent(){return Object.values(this._config.content).map(p=>this._resolvePossibleFunction(p)).filter(Boolean)}hasContent(){return this.getContent().length>0}changeContent(p){return this._checkContent(p),this._config.content={...this._config.content,...p},this}toHtml(){let p=document.createElement("div");p.innerHTML=this._maybeSanitize(this._config.template);for(let[I,o]of Object.entries(this._config.content))this._setContent(p,o,I);let U=p.children[0],E=this._resolvePossibleFunction(this._config.extraClass);return E&&U.classList.add(...E.split(" ")),U}_typeCheckConfig(p){super._typeCheckConfig(p),this._checkContent(p.content)}_checkContent(p){for(let[U,E]of Object.entries(p))super._typeCheckConfig({selector:U,entry:E},LG)}_setContent(p,U,E){let I=qt.findOne(E,p);if(I){if(U=this._resolvePossibleFunction(U),!U){I.remove();return}if(Jn(U)){this._putElementInTemplate(Wd(U),I);return}if(this._config.html){I.innerHTML=this._maybeSanitize(U);return}I.textContent=U}}_maybeSanitize(p){return this._config.sanitize?SG(p,this._config.allowList,this._config.sanitizeFn):p}_resolvePossibleFunction(p){return Li(p,[void 0,this])}_putElementInTemplate(p,U){if(this._config.html){U.innerHTML="",U.append(p);return}U.textContent=p.textContent}},EG="tooltip",zG=new Set(["sanitize","allowList","sanitizeFn"]),J1="fade",jG="modal",Vb="show",AG=".tooltip-inner",Ph=`.${jG}`,qh="hide.bs.modal",Rr="hover",y1="focus",B1="click",wG="manual",vG="hide",HG="hidden",DG="show",OG="shown",fG="inserted",_G="click",KG="focusin",PG="focusout",qG="mouseenter",$G="mouseleave",tN={AUTO:"auto",TOP:"top",RIGHT:Va()?"left":"right",BOTTOM:"bottom",LEFT:Va()?"right":"left"},eN={allowList:XV,animation:!0,boundary:"clippingParents",container:!1,customClass:"",delay:0,fallbackPlacements:["top","right","bottom","left"],html:!1,offset:[0,6],placement:"top",popperConfig:null,sanitize:!0,sanitizeFn:null,selector:!1,template:'<div class="tooltip" role="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>',title:"",trigger:"hover focus"},lN={allowList:"object",animation:"boolean",boundary:"(string|element)",container:"(string|element|boolean)",customClass:"(string|function)",delay:"(number|object)",fallbackPlacements:"array",html:"boolean",offset:"(array|string|function)",placement:"(string|function)",popperConfig:"(null|object|function)",sanitize:"boolean",sanitizeFn:"(null|function)",selector:"(string|boolean)",template:"string",title:"(string|element|function)",trigger:"string"},Lo=class M extends ta{constructor(p,U){if(typeof mb>"u")throw new TypeError("Bootstrap's tooltips require Popper (https://popper.js.org/docs/v2/)");super(p,U),this._isEnabled=!0,this._timeout=0,this._isHovered=null,this._activeTrigger={},this._popper=null,this._templateFactory=null,this._newContent=null,this.tip=null,this._setListeners(),this._config.selector||this._fixTitle()}static get Default(){return eN}static get DefaultType(){return lN}static get NAME(){return EG}enable(){this._isEnabled=!0}disable(){this._isEnabled=!1}toggleEnabled(){this._isEnabled=!this._isEnabled}toggle(){if(this._isEnabled){if(this._isShown()){this._leave();return}this._enter()}}dispose(){clearTimeout(this._timeout),yt.off(this._element.closest(Ph),qh,this._hideModalHandler),this._element.getAttribute("data-bs-original-title")&&this._element.setAttribute("title",this._element.getAttribute("data-bs-original-title")),this._disposePopper(),super.dispose()}show(){if(this._element.style.display==="none")throw new Error("Please use show on visible elements");if(!(this._isWithContent()&&this._isEnabled))return;let p=yt.trigger(this._element,this.constructor.eventName(DG)),E=(oV(this._element)||this._element.ownerDocument.documentElement).contains(this._element);if(p.defaultPrevented||!E)return;this._disposePopper();let I=this._getTipElement();this._element.setAttribute("aria-describedby",I.getAttribute("id"));let{container:o}=this._config;if(this._element.ownerDocument.documentElement.contains(this.tip)||(o.append(I),yt.trigger(this._element,this.constructor.eventName(fG))),this._popper=this._createPopper(I),I.classList.add(Vb),"ontouchstart"in document.documentElement)for(let Ft of[].concat(...document.body.children))yt.on(Ft,"mouseover",Fb);let lt=()=>{yt.trigger(this._element,this.constructor.eventName(OG)),this._isHovered===!1&&this._leave(),this._isHovered=!1};this._queueCallback(lt,this.tip,this._isAnimated())}hide(){if(!this._isShown()||yt.trigger(this._element,this.constructor.eventName(vG)).defaultPrevented)return;if(this._getTipElement().classList.remove(Vb),"ontouchstart"in document.documentElement)for(let I of[].concat(...document.body.children))yt.off(I,"mouseover",Fb);this._activeTrigger[B1]=!1,this._activeTrigger[y1]=!1,this._activeTrigger[Rr]=!1,this._isHovered=null;let E=()=>{this._isWithActiveTrigger()||(this._isHovered||this._disposePopper(),this._element.removeAttribute("aria-describedby"),yt.trigger(this._element,this.constructor.eventName(HG)))};this._queueCallback(E,this.tip,this._isAnimated())}update(){this._popper&&this._popper.update()}_isWithContent(){return!!this._getTitle()}_getTipElement(){return this.tip||(this.tip=this._createTipElement(this._newContent||this._getContentForTemplate())),this.tip}_createTipElement(p){let U=this._getTemplateFactory(p).toHtml();if(!U)return null;U.classList.remove(J1,Vb),U.classList.add(`bs-${this.constructor.NAME}-auto`);let E=vR(this.constructor.NAME).toString();return U.setAttribute("id",E),this._isAnimated()&&U.classList.add(J1),U}setContent(p){this._newContent=p,this._isShown()&&(this._disposePopper(),this.show())}_getTemplateFactory(p){return this._templateFactory?this._templateFactory.changeContent(p):this._templateFactory=new A1({...this._config,content:p,extraClass:this._resolvePossibleFunction(this._config.customClass)}),this._templateFactory}_getContentForTemplate(){return{[AG]:this._getTitle()}}_getTitle(){return this._resolvePossibleFunction(this._config.title)||this._element.getAttribute("data-bs-original-title")}_initializeOnDelegatedTarget(p){return this.constructor.getOrCreateInstance(p.delegateTarget,this._getDelegateConfig())}_isAnimated(){return this._config.animation||this.tip&&this.tip.classList.contains(J1)}_isShown(){return this.tip&&this.tip.classList.contains(Vb)}_createPopper(p){let U=Li(this._config.placement,[this,p,this._element]),E=tN[U.toUpperCase()];return pr(this._element,p,this._getPopperConfig(E))}_getOffset(){let{offset:p}=this._config;return typeof p=="string"?p.split(",").map(U=>Number.parseInt(U,10)):typeof p=="function"?U=>p(U,this._element):p}_resolvePossibleFunction(p){return Li(p,[this._element,this._element])}_getPopperConfig(p){let U={placement:p,modifiers:[{name:"flip",options:{fallbackPlacements:this._config.fallbackPlacements}},{name:"offset",options:{offset:this._getOffset()}},{name:"preventOverflow",options:{boundary:this._config.boundary}},{name:"arrow",options:{element:`.${this.constructor.NAME}-arrow`}},{name:"preSetPlacement",enabled:!0,phase:"beforeMain",fn:E=>{this._getTipElement().setAttribute("data-popper-placement",E.state.placement)}}]};return{...U,...Li(this._config.popperConfig,[void 0,U])}}_setListeners(){let p=this._config.trigger.split(" ");for(let U of p)if(U==="click")yt.on(this._element,this.constructor.eventName(_G),this._config.selector,E=>{let I=this._initializeOnDelegatedTarget(E);I._activeTrigger[B1]=!(I._isShown()&&I._activeTrigger[B1]),I.toggle()});else if(U!==wG){let E=U===Rr?this.constructor.eventName(qG):this.constructor.eventName(KG),I=U===Rr?this.constructor.eventName($G):this.constructor.eventName(PG);yt.on(this._element,E,this._config.selector,o=>{let lt=this._initializeOnDelegatedTarget(o);lt._activeTrigger[o.type==="focusin"?y1:Rr]=!0,lt._enter()}),yt.on(this._element,I,this._config.selector,o=>{let lt=this._initializeOnDelegatedTarget(o);lt._activeTrigger[o.type==="focusout"?y1:Rr]=lt._element.contains(o.relatedTarget),lt._leave()})}this._hideModalHandler=()=>{this._element&&this.hide()},yt.on(this._element.closest(Ph),qh,this._hideModalHandler)}_fixTitle(){let p=this._element.getAttribute("title");p&&(!this._element.getAttribute("aria-label")&&!this._element.textContent.trim()&&this._element.setAttribute("aria-label",p),this._element.setAttribute("data-bs-original-title",p),this._element.removeAttribute("title"))}_enter(){if(this._isShown()||this._isHovered){this._isHovered=!0;return}this._isHovered=!0,this._setTimeout(()=>{this._isHovered&&this.show()},this._config.delay.show)}_leave(){this._isWithActiveTrigger()||(this._isHovered=!1,this._setTimeout(()=>{this._isHovered||this.hide()},this._config.delay.hide))}_setTimeout(p,U){clearTimeout(this._timeout),this._timeout=setTimeout(p,U)}_isWithActiveTrigger(){return Object.values(this._activeTrigger).includes(!0)}_getConfig(p){let U=yn.getDataAttributes(this._element);for(let E of Object.keys(U))zG.has(E)&&delete U[E];return p={...U,...typeof p=="object"&&p?p:{}},p=this._mergeConfigObj(p),p=this._configAfterMerge(p),this._typeCheckConfig(p),p}_configAfterMerge(p){return p.container=p.container===!1?document.body:Wd(p.container),typeof p.delay=="number"&&(p.delay={show:p.delay,hide:p.delay}),typeof p.title=="number"&&(p.title=p.title.toString()),typeof p.content=="number"&&(p.content=p.content.toString()),p}_getDelegateConfig(){let p={};for(let[U,E]of Object.entries(this._config))this.constructor.Default[U]!==E&&(p[U]=E);return p.selector=!1,p.trigger="manual",p}_disposePopper(){this._popper&&(this._popper.destroy(),this._popper=null),this.tip&&(this.tip.remove(),this.tip=null)}static jQueryInterface(p){return this.each(function(){let U=M.getOrCreateInstance(this,p);if(typeof p=="string"){if(typeof U[p]>"u")throw new TypeError(`No method named "${p}"`);U[p]()}})}};ga(Lo);var iN="popover",aN=".popover-header",nN=".popover-body",dN={...Lo.Default,content:"",offset:[0,8],placement:"right",template:'<div class="popover" role="tooltip"><div class="popover-arrow"></div><h3 class="popover-header"></h3><div class="popover-body"></div></div>',trigger:"click"},cN={...Lo.DefaultType,content:"(null|string|element|function)"},w1=class M extends Lo{static get Default(){return dN}static get DefaultType(){return cN}static get NAME(){return iN}_isWithContent(){return this._getTitle()||this._getContent()}_getContentForTemplate(){return{[aN]:this._getTitle(),[nN]:this._getContent()}}_getContent(){return this._resolvePossibleFunction(this._config.content)}static jQueryInterface(p){return this.each(function(){let U=M.getOrCreateInstance(this,p);if(typeof p=="string"){if(typeof U[p]>"u")throw new TypeError(`No method named "${p}"`);U[p]()}})}};ga(w1);var oN="scrollspy",sN="bs.scrollspy",O1=`.${sN}`,rN=".data-api",bN=`activate${O1}`,$h=`click${O1}`,mN=`load${O1}${rN}`,WN="dropdown-item",Bo="active",ZN='[data-bs-spy="scroll"]',S1="[href]",hN=".nav, .list-group",tV=".nav-link",VN=".nav-item",pN=".list-group-item",gN=`${tV}, ${VN} > ${tV}, ${pN}`,RN=".dropdown",uN=".dropdown-toggle",FN={offset:null,rootMargin:"0px 0px -25%",smoothScroll:!1,target:null,threshold:[.1,.5,1]},GN={offset:"(number|null)",rootMargin:"string",smoothScroll:"boolean",target:"element",threshold:"array"},Tb=class M extends ta{constructor(p,U){super(p,U),this._targetLinks=new Map,this._observableSections=new Map,this._rootElement=getComputedStyle(this._element).overflowY==="visible"?null:this._element,this._activeTarget=null,this._observer=null,this._previousScrollData={visibleEntryTop:0,parentScrollTop:0},this.refresh()}static get Default(){return FN}static get DefaultType(){return GN}static get NAME(){return oN}refresh(){this._initializeTargetsAndObservables(),this._maybeEnableSmoothScroll(),this._observer?this._observer.disconnect():this._observer=this._getNewObserver();for(let p of this._observableSections.values())this._observer.observe(p)}dispose(){this._observer.disconnect(),super.dispose()}_configAfterMerge(p){return p.target=Wd(p.target)||document.body,p.rootMargin=p.offset?`${p.offset}px 0px -30%`:p.rootMargin,typeof p.threshold=="string"&&(p.threshold=p.threshold.split(",").map(U=>Number.parseFloat(U))),p}_maybeEnableSmoothScroll(){this._config.smoothScroll&&(yt.off(this._config.target,$h),yt.on(this._config.target,$h,S1,p=>{let U=this._observableSections.get(p.target.hash);if(U){p.preventDefault();let E=this._rootElement||window,I=U.offsetTop-this._element.offsetTop;if(E.scrollTo){E.scrollTo({top:I,behavior:"smooth"});return}E.scrollTop=I}}))}_getNewObserver(){let p={root:this._rootElement,threshold:this._config.threshold,rootMargin:this._config.rootMargin};return new IntersectionObserver(U=>this._observerCallback(U),p)}_observerCallback(p){let U=lt=>this._targetLinks.get(`#${lt.target.id}`),E=lt=>{this._previousScrollData.visibleEntryTop=lt.target.offsetTop,this._process(U(lt))},I=(this._rootElement||document.documentElement).scrollTop,o=I>=this._previousScrollData.parentScrollTop;this._previousScrollData.parentScrollTop=I;for(let lt of p){if(!lt.isIntersecting){this._activeTarget=null,this._clearActiveClass(U(lt));continue}let Ft=lt.target.offsetTop>=this._previousScrollData.visibleEntryTop;if(o&&Ft){if(E(lt),!I)return;continue}!o&&!Ft&&E(lt)}}_initializeTargetsAndObservables(){this._targetLinks=new Map,this._observableSections=new Map;let p=qt.find(S1,this._config.target);for(let U of p){if(!U.hash||Zd(U))continue;let E=qt.findOne(decodeURI(U.hash),this._element);Eo(E)&&(this._targetLinks.set(decodeURI(U.hash),U),this._observableSections.set(U.hash,E))}}_process(p){this._activeTarget!==p&&(this._clearActiveClass(this._config.target),this._activeTarget=p,p.classList.add(Bo),this._activateParents(p),yt.trigger(this._element,bN,{relatedTarget:p}))}_activateParents(p){if(p.classList.contains(WN)){qt.findOne(uN,p.closest(RN)).classList.add(Bo);return}for(let U of qt.parents(p,hN))for(let E of qt.prev(U,gN))E.classList.add(Bo)}_clearActiveClass(p){p.classList.remove(Bo);let U=qt.find(`${S1}.${Bo}`,p);for(let E of U)E.classList.remove(Bo)}static jQueryInterface(p){return this.each(function(){let U=M.getOrCreateInstance(this,p);if(typeof p=="string"){if(U[p]===void 0||p.startsWith("_")||p==="constructor")throw new TypeError(`No method named "${p}"`);U[p]()}})}};yt.on(window,mN,()=>{for(let M of qt.find(ZN))Tb.getOrCreateInstance(M)});ga(Tb);var NN="tab",IN="bs.tab",uc=`.${IN}`,UN=`hide${uc}`,MN=`hidden${uc}`,YN=`show${uc}`,xN=`shown${uc}`,TN=`click${uc}`,XN=`keydown${uc}`,JN=`load${uc}`,yN="ArrowLeft",eV="ArrowRight",BN="ArrowUp",lV="ArrowDown",C1="Home",iV="End",pc="active",aV="fade",Q1="show",SN="dropdown",JV=".dropdown-toggle",CN=".dropdown-menu",k1=`:not(${JV})`,QN='.list-group, .nav, [role="tablist"]',kN=".nav-item, .list-group-item",LN=`.nav-link${k1}, .list-group-item${k1}, [role="tab"]${k1}`,yV='[data-bs-toggle="tab"], [data-bs-toggle="pill"], [data-bs-toggle="list"]',L1=`${LN}, ${yV}`,EN=`.${pc}[data-bs-toggle="tab"], .${pc}[data-bs-toggle="pill"], .${pc}[data-bs-toggle="list"]`,Gr=class M extends ta{constructor(p){super(p),this._parent=this._element.closest(QN),this._parent&&(this._setInitialAttributes(this._parent,this._getChildren()),yt.on(this._element,XN,U=>this._keydown(U)))}static get NAME(){return NN}show(){let p=this._element;if(this._elemIsActive(p))return;let U=this._getActiveElem(),E=U?yt.trigger(U,UN,{relatedTarget:p}):null;yt.trigger(p,YN,{relatedTarget:U}).defaultPrevented||E&&E.defaultPrevented||(this._deactivate(U,p),this._activate(p,U))}_activate(p,U){if(!p)return;p.classList.add(pc),this._activate(qt.getElementFromSelector(p));let E=()=>{if(p.getAttribute("role")!=="tab"){p.classList.add(Q1);return}p.removeAttribute("tabindex"),p.setAttribute("aria-selected",!0),this._toggleDropDown(p,!0),yt.trigger(p,xN,{relatedTarget:U})};this._queueCallback(E,p,p.classList.contains(aV))}_deactivate(p,U){if(!p)return;p.classList.remove(pc),p.blur(),this._deactivate(qt.getElementFromSelector(p));let E=()=>{if(p.getAttribute("role")!=="tab"){p.classList.remove(Q1);return}p.setAttribute("aria-selected",!1),p.setAttribute("tabindex","-1"),this._toggleDropDown(p,!1),yt.trigger(p,MN,{relatedTarget:U})};this._queueCallback(E,p,p.classList.contains(aV))}_keydown(p){if(![yN,eV,BN,lV,C1,iV].includes(p.key))return;p.stopPropagation(),p.preventDefault();let U=this._getChildren().filter(I=>!Zd(I)),E;if([C1,iV].includes(p.key))E=U[p.key===C1?0:U.length-1];else{let I=[eV,lV].includes(p.key);E=v1(U,p.target,I,!0)}E&&(E.focus({preventScroll:!0}),M.getOrCreateInstance(E).show())}_getChildren(){return qt.find(L1,this._parent)}_getActiveElem(){return this._getChildren().find(p=>this._elemIsActive(p))||null}_setInitialAttributes(p,U){this._setAttributeIfNotExists(p,"role","tablist");for(let E of U)this._setInitialAttributesOnChild(E)}_setInitialAttributesOnChild(p){p=this._getInnerElement(p);let U=this._elemIsActive(p),E=this._getOuterElement(p);p.setAttribute("aria-selected",U),E!==p&&this._setAttributeIfNotExists(E,"role","presentation"),U||p.setAttribute("tabindex","-1"),this._setAttributeIfNotExists(p,"role","tab"),this._setInitialAttributesOnTargetPanel(p)}_setInitialAttributesOnTargetPanel(p){let U=qt.getElementFromSelector(p);U&&(this._setAttributeIfNotExists(U,"role","tabpanel"),p.id&&this._setAttributeIfNotExists(U,"aria-labelledby",`${p.id}`))}_toggleDropDown(p,U){let E=this._getOuterElement(p);if(!E.classList.contains(SN))return;let I=(o,lt)=>{let Ft=qt.findOne(o,E);Ft&&Ft.classList.toggle(lt,U)};I(JV,pc),I(CN,Q1),E.setAttribute("aria-expanded",U)}_setAttributeIfNotExists(p,U,E){p.hasAttribute(U)||p.setAttribute(U,E)}_elemIsActive(p){return p.classList.contains(pc)}_getInnerElement(p){return p.matches(L1)?p:qt.findOne(L1,p)}_getOuterElement(p){return p.closest(kN)||p}static jQueryInterface(p){return this.each(function(){let U=M.getOrCreateInstance(this);if(typeof p=="string"){if(U[p]===void 0||p.startsWith("_")||p==="constructor")throw new TypeError(`No method named "${p}"`);U[p]()}})}};yt.on(document,TN,yV,function(M){["A","AREA"].includes(this.tagName)&&M.preventDefault(),!Zd(this)&&Gr.getOrCreateInstance(this).show()});yt.on(window,JN,()=>{for(let M of qt.find(EN))Gr.getOrCreateInstance(M)});ga(Gr);var zN="toast",jN="bs.toast",gd=`.${jN}`,AN=`mouseover${gd}`,wN=`mouseout${gd}`,vN=`focusin${gd}`,HN=`focusout${gd}`,DN=`hide${gd}`,ON=`hidden${gd}`,fN=`show${gd}`,_N=`shown${gd}`,KN="fade",nV="hide",pb="show",gb="showing",PN={animation:"boolean",autohide:"boolean",delay:"number"},qN={animation:!0,autohide:!0,delay:5e3},Xb=class M extends ta{constructor(p,U){super(p,U),this._timeout=null,this._hasMouseInteraction=!1,this._hasKeyboardInteraction=!1,this._setListeners()}static get Default(){return qN}static get DefaultType(){return PN}static get NAME(){return zN}show(){if(yt.trigger(this._element,fN).defaultPrevented)return;this._clearTimeout(),this._config.animation&&this._element.classList.add(KN);let U=()=>{this._element.classList.remove(gb),yt.trigger(this._element,_N),this._maybeScheduleHide()};this._element.classList.remove(nV),Nr(this._element),this._element.classList.add(pb,gb),this._queueCallback(U,this._element,this._config.animation)}hide(){if(!this.isShown()||yt.trigger(this._element,DN).defaultPrevented)return;let U=()=>{this._element.classList.add(nV),this._element.classList.remove(gb,pb),yt.trigger(this._element,ON)};this._element.classList.add(gb),this._queueCallback(U,this._element,this._config.animation)}dispose(){this._clearTimeout(),this.isShown()&&this._element.classList.remove(pb),super.dispose()}isShown(){return this._element.classList.contains(pb)}_maybeScheduleHide(){this._config.autohide&&(this._hasMouseInteraction||this._hasKeyboardInteraction||(this._timeout=setTimeout(()=>{this.hide()},this._config.delay)))}_onInteraction(p,U){switch(p.type){case"mouseover":case"mouseout":{this._hasMouseInteraction=U;break}case"focusin":case"focusout":{this._hasKeyboardInteraction=U;break}}if(U){this._clearTimeout();return}let E=p.relatedTarget;this._element===E||this._element.contains(E)||this._maybeScheduleHide()}_setListeners(){yt.on(this._element,AN,p=>this._onInteraction(p,!0)),yt.on(this._element,wN,p=>this._onInteraction(p,!1)),yt.on(this._element,vN,p=>this._onInteraction(p,!0)),yt.on(this._element,HN,p=>this._onInteraction(p,!1))}_clearTimeout(){clearTimeout(this._timeout),this._timeout=null}static jQueryInterface(p){return this.each(function(){let U=M.getOrCreateInstance(this,p);if(typeof p=="string"){if(typeof U[p]>"u")throw new TypeError(`No method named "${p}"`);U[p](this)}})}};Jb(Xb);ga(Xb);var BV={id:"greggs_points",type:"circle",source:"greggs",minzoom:7,paint:{"circle-radius":{stops:[[9,10],[11,20],[16,35]]},"circle-color":"rgb(251, 169, 23)","circle-stroke-color":"rgb(8, 66, 125)","circle-stroke-width":1.5,"circle-opacity":["interpolate",["linear"],["zoom"],7,0,8,1,9,.5],"circle-stroke-opacity":["interpolate",["linear"],["zoom"],7,0,8,1]}},SV={id:"greggs_heat",type:"heatmap",source:"greggs",maxzoom:9,paint:{"heatmap-weight":["interpolate",["linear"],1.25,0,0,6,1],"heatmap-intensity":["interpolate",["linear"],["zoom"],0,1,9,3],"heatmap-color":["interpolate",["linear"],["heatmap-density"],0,"rgba(8, 66, 125, 0)",.2,"rgb(57,87,105)",.4,"rgb(105,107,84)",.6,"rgb(154,128,64)",.8,"rgb(202,148,43)",1,"rgb(251, 169, 23)"],"heatmap-radius":["interpolate",["linear"],["zoom"],0,2,9,20],"heatmap-opacity":["interpolate",["linear"],["zoom"],7,1,9,0]}},CV={id:"pret_points",type:"circle",source:"pret",minzoom:7,layout:{visibility:"none"},paint:{"circle-radius":{stops:[[9,10],[11,20],[16,35]]},"circle-color":"rgb(140, 29, 38)","circle-stroke-color":"rgb(255, 255, 255)","circle-stroke-width":1.5,"circle-opacity":["interpolate",["linear"],["zoom"],7,0,8,1,9,.5],"circle-stroke-opacity":["interpolate",["linear"],["zoom"],7,0,8,1]}},QV={id:"pret_heat",type:"heatmap",source:"pret",maxzoom:9,layout:{visibility:"none"},paint:{"heatmap-weight":["interpolate",["linear"],1.25,0,0,6,1],"heatmap-intensity":["interpolate",["linear"],["zoom"],0,1,9,3],"heatmap-color":["interpolate",["linear"],["heatmap-density"],0,"rgba(255, 255, 255, 0)",.2,"rgb(232, 210, 452)",.4,"rgb(209, 165, 348)",.6,"rgb(186, 119, 245)",.8,"rgb(163, 74, 141)",1,"rgb(140, 29, 38)"],"heatmap-radius":["interpolate",["linear"],["zoom"],0,2,9,20],"heatmap-opacity":["interpolate",["linear"],["zoom"],7,1,9,0]}};var $N={weekday:"long",year:"numeric",month:"long",day:"numeric"},La=new f1.default.Map({container:"map",style:"https://tiles.openfreemap.org/styles/liberty",zoom:5.205985389161131,center:{lng:-3.8,lat:53.82777852234969},customAttribution:'Uses <a href="https://ratings.food.gov.uk">FHRS</a> Data'}),_1={},Ur="greggs",yb={greggs:{url:"static/latest_greggs.geojson",p_layer:BV,h_layer:SV},pret:{url:"static/latest_pret.geojson",p_layer:CV,h_layer:QV}};async function tI(M){var p=[];p.push(Object.keys(yb).forEach(function(U){fetch(yb[U].url).then(E=>E.json()).then(E=>{M.addSource(U,{type:"geojson",data:E}).addLayer(yb[U].p_layer).addLayer(yb[U].h_layer),_1[U]=nh(E.features)})})),await Promise.all(p)}La.on("load",function(){tI(this),"geolocation"in navigator||(document.getElementById("locate").style.display="none")});["greggs","pret"].forEach(function(M){La.on("click",M+"_points",function(p){var U=p.features[0].geometry.coordinates.slice();let I=new Date(p.features[0].properties.RatingDate).toLocaleDateString("en-GB",$N);for(var o=`<p>Post Code: ${p.features[0].properties.PostCode} in ${p.features[0].properties.LocalAuthorityName}</p><p>FHRS Rating: ${p.features[0].properties.RatingValue}</p><p>Rating Date: ${I}</p>`;Math.abs(p.lngLat.lng-U[0])>180;)U[0]+=p.lngLat.lng>U[0]?360:-360;let lt=`
          <div class="card border border-dark bg-primary-subtle m-2">
            <div class="card-body">
                <ul class="list-group list-group-flush">
                    <li class="list-group-item"><strong>Address:</strong> ${p.features[0].properties.PostCode} in ${p.features[0].properties.LocalAuthorityName}</li>
                    <li class="list-group-item"><strong>FHRS Rating:</strong> ${p.features[0].properties.RatingValue}</li>
                    <li class="list-group-item"><strong>Rating Date:</strong> ${I}</li>
                </ul>
            </div>
          </div>
        `;new f1.default.Popup().setLngLat(U).setHTML(lt).addTo(La)}),La.on("mouseenter",M+"_points",function(){La.getCanvas().style.cursor="pointer"}),La.on("mouseleave",M+"_points",function(){La.getCanvas().style.cursor=""})});document.getElementById("lookup").addEventListener("submit",function(M){M.preventDefault();var p=document.querySelector("input").value;document.querySelector("input").value="",fetch("https://api.postcodes.io/postcodes/"+p).then(U=>U.json()).then(function(U){document.getElementById("inputPostcode").classList.remove("is-invalid");var E=n1([U.result.longitude,U.result.latitude]),I=c1(E,_1[Ur]);La.flyTo({center:I.geometry.coordinates,zoom:14,essential:!0})}).catch(function(){document.querySelector(".invalid-feedback").textContent="Enter a valid UK Post Code",document.getElementById("inputPostcode").classList.add("is-invalid")})});document.getElementById("switch").addEventListener("click",function(){if(Ur=="greggs"){Ur="pret",La.setLayoutProperty("greggs_points","visibility","none").setLayoutProperty("greggs_heat","visibility","none").setLayoutProperty("pret_points","visibility","visible").setLayoutProperty("pret_heat","visibility","visible");let M=document.getElementById("pcbutton");M.textContent="Nearest Pret",M.classList.remove("greggs"),M.classList.add("pret"),document.getElementById("switch").textContent="Switch to Greggs"}else{Ur="greggs",La.setLayoutProperty("pret_points","visibility","none").setLayoutProperty("pret_heat","visibility","none").setLayoutProperty("greggs_points","visibility","visible").setLayoutProperty("greggs_heat","visibility","visible");let M=document.getElementById("pcbutton");M.textContent="Nearest Greggs",M.classList.remove("pret"),M.classList.add("greggs"),document.getElementById("switch").textContent="Switch to Pret"}});function eI(M){var p=n1([M.coords.longitude,M.coords.latitude]),U=c1(p,_1[Ur]);La.flyTo({center:U.geometry.coordinates,zoom:14,essential:!0})}function lI(){document.getElementById("inputPostcode").classList.add("is-invalid"),document.querySelector(".invalid-feedback").textContent="Couldn't geolocate you!"}document.getElementById("locate").addEventListener("click",function(){navigator.geolocation.getCurrentPosition(eI,lI,{enableHighAccuracy:!0,timeout:2500})});
/*! Bundled license information:

maplibre-gl/dist/maplibre-gl.js:
  (**
   * MapLibre GL JS
   * @license 3-Clause BSD. Full text of license: https://github.com/maplibre/maplibre-gl-js/blob/v5.13.0/LICENSE.txt
   *)

bootstrap/dist/js/bootstrap.esm.js:
  (*!
    * Bootstrap v5.3.8 (https://getbootstrap.com/)
    * Copyright 2011-2025 The Bootstrap Authors (https://github.com/twbs/bootstrap/graphs/contributors)
    * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE)
    *)
*/
//# sourceMappingURL=bundle.js.map
